<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>5.3. SOAP Web Service（サーバ/クライアント） &#8212; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.7.2.RELEASE documentation</title>
    <link rel="stylesheet" href="../../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '5.7.2.RELEASE',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="6. データアクセス" href="../DataAccessDetail/index.html" />
    <link rel="prev" title="5.2. RESTクライアント（HTTPクライアント）" href="RestClient.html" /><script async src="https://www.googletagmanager.com/gtag/js?id=G-847V2Q99G8"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date()); gtag('config', 'G-847V2Q99G8');
</script>
<script src="../../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../../_static/solarized-dark.css" rel="stylesheet">
<link href="../../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../DataAccessDetail/index.html" title="6. データアクセス"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="RestClient.html" title="5.2. RESTクライアント（HTTPクライアント）"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.7.2.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">5. Web Service</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>

  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">5.3. SOAP Web Service（サーバ/クライアント）</a><ul>
<li><a class="reference internal" href="#overview">5.3.1. Overview</a><ul>
<li><a class="reference internal" href="#soap">5.3.1.1. SOAPとは</a></li>
<li><a class="reference internal" href="#jax-ws">5.3.1.2. JAX-WSとは</a></li>
<li><a class="reference internal" href="#jax-wsweb">5.3.1.3. JAX-WSを利用したWebサービスの開発について</a></li>
<li><a class="reference internal" href="#spring-frameworkjax-ws">5.3.1.4. Spring FrameworkのJAX-WS連携機能について</a><ul>
<li><a class="reference internal" href="#soapoverviewaboutrestfulmodulestructure">5.3.1.4.1. JAX-WSを利用したWebサービスのモジュールの構成</a></li>
</ul>
</li>
<li><a class="reference internal" href="#weburl">5.3.1.5. Webサービスとして公開されるURL</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use">5.3.2. How to use</a><ul>
<li><a class="reference internal" href="#soaphowtousewebapplicationconstruction">5.3.2.1. SOAPサーバの作成</a><ul>
<li><a class="reference internal" href="#id4">5.3.2.1.1. プロジェクトの構成</a></li>
<li><a class="reference internal" href="#soapapplicationconfiguration">5.3.2.1.2. アプリケーションの設定</a></li>
<li><a class="reference internal" href="#web">5.3.2.1.3. Webサービスの実装</a></li>
<li><a class="reference internal" href="#soaphowtouseservervalidation">5.3.2.1.4. 入力チェックの実装</a></li>
<li><a class="reference internal" href="#id7">5.3.2.1.5. セキュリティ対策</a></li>
<li><a class="reference internal" href="#id8">5.3.2.1.6. 例外ハンドリングの実装</a></li>
<li><a class="reference internal" href="#mtom">5.3.2.1.7. MTOMを利用した大容量のバイナリデータを扱う方法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id9">5.3.2.2. クライアントの作成</a><ul>
<li><a class="reference internal" href="#id10">5.3.2.2.1. プロジェクトの構成</a></li>
<li><a class="reference internal" href="#soaphowtousewebserviceclient">5.3.2.2.2. Webサービス クライアントの実装</a></li>
<li><a class="reference internal" href="#id12">5.3.2.2.3. セキュリティ対策</a></li>
<li><a class="reference internal" href="#soaphowtouseexceptionhandler">5.3.2.2.4. 例外ハンドリングの実装</a></li>
<li><a class="reference internal" href="#id14">5.3.2.2.5. タイムアウトの設定</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#appendix">5.3.3. Appendix</a><ul>
<li><a class="reference internal" href="#soapappendixaddproject">5.3.3.1. SOAPサーバ用にプロジェクトの設定を変更する</a><ul>
<li><a class="reference internal" href="#id16">5.3.3.1.1. 既存プロジェクトの変更</a></li>
<li><a class="reference internal" href="#model">5.3.3.1.2. modelプロジェクトの作成</a></li>
<li><a class="reference internal" href="#webservice">5.3.3.1.3. webserviceプロジェクトの作成</a></li>
</ul>
</li>
<li><a class="reference internal" href="#soapappendixpackageserver">5.3.3.2. SOAPサーバのパッケージ構成</a><ul>
<li><a class="reference internal" href="#server-projectname-domain">5.3.3.2.1. [server projectName]-domain</a></li>
<li><a class="reference internal" href="#server-projectname-web">5.3.3.2.2. [server projectName]-web</a></li>
<li><a class="reference internal" href="#server-projectname-env">5.3.3.2.3. [server projectName]-env</a></li>
<li><a class="reference internal" href="#server-projectname-model">5.3.3.2.4. [server projectName]-model</a></li>
<li><a class="reference internal" href="#server-projectname-webservice">5.3.3.2.5. [server projectName]-webservice</a></li>
</ul>
</li>
<li><a class="reference internal" href="#soapappendixpackageclient">5.3.3.3. クライアントのパッケージ構成</a><ul>
<li><a class="reference internal" href="#client-projectname-domain">5.3.3.3.1. [client projectName]-domain</a></li>
<li><a class="reference internal" href="#client-projectname-web">5.3.3.3.2. [client projectName]-web</a></li>
<li><a class="reference internal" href="#client-projectname-env">5.3.3.3.3. [client projectName]-env</a></li>
</ul>
</li>
<li><a class="reference internal" href="#wsimport">5.3.3.4. wsimportについて</a><ul>
<li><a class="reference internal" href="#id19">5.3.3.4.1. wsimportの使い道</a></li>
<li><a class="reference internal" href="#id20">5.3.3.4.2. wsimportの使い方</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tomcatweb">5.3.3.5. Tomcat上でのWebサービス開発</a><ul>
<li><a class="reference internal" href="#cxfservlet">5.3.3.5.1. CXFServletを使用する場合の設定</a></li>
<li><a class="reference internal" href="#pojo">5.3.3.5.2. POJO方式で必要な設定</a></li>
<li><a class="reference internal" href="#springbeanautowiringsupport">5.3.3.5.3. SpringBeanAutowiringSupportを継承する方式で必要な設定</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="RestClient.html"
                        title="previous chapter">5.2. RESTクライアント（HTTPクライアント）</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../DataAccessDetail/index.html"
                        title="next chapter">6. データアクセス</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/ArchitectureInDetail/WebServiceDetail/SOAP.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="soap-web-service">
<h1>5.3. SOAP Web Service（サーバ/クライアント）<a class="headerlink" href="#soap-web-service" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="id1">
<p class="topic-title">目次</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id21">Overview</a><ul>
<li><a class="reference internal" href="#soap" id="id22">SOAPとは</a></li>
<li><a class="reference internal" href="#jax-ws" id="id23">JAX-WSとは</a></li>
<li><a class="reference internal" href="#jax-wsweb" id="id24">JAX-WSを利用したWebサービスの開発について</a></li>
<li><a class="reference internal" href="#spring-frameworkjax-ws" id="id25">Spring FrameworkのJAX-WS連携機能について</a><ul>
<li><a class="reference internal" href="#soapoverviewaboutrestfulmodulestructure" id="id26">JAX-WSを利用したWebサービスのモジュールの構成</a></li>
</ul>
</li>
<li><a class="reference internal" href="#weburl" id="id27">Webサービスとして公開されるURL</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use" id="id28">How to use</a><ul>
<li><a class="reference internal" href="#soaphowtousewebapplicationconstruction" id="id29">SOAPサーバの作成</a><ul>
<li><a class="reference internal" href="#id4" id="id30">プロジェクトの構成</a></li>
<li><a class="reference internal" href="#soapapplicationconfiguration" id="id31">アプリケーションの設定</a></li>
<li><a class="reference internal" href="#web" id="id32">Webサービスの実装</a></li>
<li><a class="reference internal" href="#soaphowtouseservervalidation" id="id33">入力チェックの実装</a></li>
<li><a class="reference internal" href="#id7" id="id34">セキュリティ対策</a></li>
<li><a class="reference internal" href="#id8" id="id35">例外ハンドリングの実装</a></li>
<li><a class="reference internal" href="#mtom" id="id36">MTOMを利用した大容量のバイナリデータを扱う方法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id9" id="id37">クライアントの作成</a><ul>
<li><a class="reference internal" href="#id10" id="id38">プロジェクトの構成</a></li>
<li><a class="reference internal" href="#soaphowtousewebserviceclient" id="id39">Webサービス クライアントの実装</a></li>
<li><a class="reference internal" href="#id12" id="id40">セキュリティ対策</a></li>
<li><a class="reference internal" href="#soaphowtouseexceptionhandler" id="id41">例外ハンドリングの実装</a></li>
<li><a class="reference internal" href="#id14" id="id42">タイムアウトの設定</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#appendix" id="id43">Appendix</a><ul>
<li><a class="reference internal" href="#soapappendixaddproject" id="id44">SOAPサーバ用にプロジェクトの設定を変更する</a><ul>
<li><a class="reference internal" href="#id16" id="id45">既存プロジェクトの変更</a></li>
<li><a class="reference internal" href="#model" id="id46">modelプロジェクトの作成</a></li>
<li><a class="reference internal" href="#webservice" id="id47">webserviceプロジェクトの作成</a></li>
</ul>
</li>
<li><a class="reference internal" href="#soapappendixpackageserver" id="id48">SOAPサーバのパッケージ構成</a><ul>
<li><a class="reference internal" href="#server-projectname-domain" id="id49">[server projectName]-domain</a></li>
<li><a class="reference internal" href="#server-projectname-web" id="id50">[server projectName]-web</a></li>
<li><a class="reference internal" href="#server-projectname-env" id="id51">[server projectName]-env</a></li>
<li><a class="reference internal" href="#server-projectname-model" id="id52">[server projectName]-model</a></li>
<li><a class="reference internal" href="#server-projectname-webservice" id="id53">[server projectName]-webservice</a></li>
</ul>
</li>
<li><a class="reference internal" href="#soapappendixpackageclient" id="id54">クライアントのパッケージ構成</a><ul>
<li><a class="reference internal" href="#client-projectname-domain" id="id55">[client projectName]-domain</a></li>
<li><a class="reference internal" href="#client-projectname-web" id="id56">[client projectName]-web</a></li>
<li><a class="reference internal" href="#client-projectname-env" id="id57">[client projectName]-env</a></li>
</ul>
</li>
<li><a class="reference internal" href="#wsimport" id="id58">wsimportについて</a><ul>
<li><a class="reference internal" href="#id19" id="id59">wsimportの使い道</a></li>
<li><a class="reference internal" href="#id20" id="id60">wsimportの使い方</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tomcatweb" id="id61">Tomcat上でのWebサービス開発</a><ul>
<li><a class="reference internal" href="#cxfservlet" id="id62">CXFServletを使用する場合の設定</a></li>
<li><a class="reference internal" href="#pojo" id="id63">POJO方式で必要な設定</a></li>
<li><a class="reference internal" href="#springbeanautowiringsupport" id="id64">SpringBeanAutowiringSupportを継承する方式で必要な設定</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<span id="soapoverview"></span><h2><a class="toc-backref" href="#id21">5.3.1. Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>本節では、SOAP Web Serviceの基本的な概念とJAX-WSを使用したSOAPサーバ、クライアント双方の開発について説明する。</p>
<p>実装に対する具体的な説明については、</p>
<ul>
<li><div class="first line-block">
<div class="line">「<a class="reference internal" href="#soaphowtouse"><span class="std std-ref">How to use</span></a>」</div>
<div class="line">JAX-WSを使用したSOAP Web Serviceのアプリケーション構成やAPIの実装方法について説明している。</div>
</div>
</li>
</ul>
<p>を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="soap">
<span id="soapoverviewaboutsoapwebservice"></span><h3><a class="toc-backref" href="#id22">5.3.1.1. SOAPとは</a><a class="headerlink" href="#soap" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">SOAPとは、XMLで記述されたメッセージをコンピュータ間で送受信を行うためのプロトコルである。</div>
<div class="line">もともとは「<strong>S</strong>imple <strong>O</strong>bject <strong>A</strong>ccess <strong>P</strong>rotocol」の略であった。</div>
<div class="line">しかし現在では、「SOAP」はなにかの略ではなく、固有名詞であるとW3Cは宣言している。</div>
<div class="line">W3CによるSOAP1.1、SOAP1.2の仕様はW3Cにより定義されている。</div>
<div class="line">詳細は、<a class="reference external" href="https://www.w3.org/TR/soap/">W3C -SOAP Specifications-</a>を参照されたい。</div>
</div>
<div class="line-block">
<div class="line">本ガイドラインでは、以下の図のような構成でのSOAP Web Serviceを行う場合を想定して説明する。</div>
<div class="line">ただし、下記の構成以外でのSOAP Web Serviceの場合にも応用可能である。（例：クライアントがバッチの場合など）</div>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/SOAPServerAndClient.png"><img alt="Server and Client for SOAP" src="../../_images/SOAPServerAndClient.png" style="width: 100%;" /></a>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">クライアントは、別のSOAPサーバへの通信を行うWebアプリケーションを想定している。</div>
<div class="line">クライアントと呼んでいるがWebアプリケーション想定なので注意が必要である。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">SOAPサーバは、Webサービスを公開し、クライアントからのSOAP Web ServiceによるXMLを受信して処理を行う。データベースなどにアクセスを行い、業務処理を行うことを想定している。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">SOAP Web ServiceではXMLを使用して情報のやり取りを行う。</div>
<div class="line">今回の想定では、SOAPサーバ、クライアントどちらもJavaである想定としているが、他のプラットフォームでも問題なく通信可能である。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="jax-ws">
<span id="soapoverviewjaxws"></span><h3><a class="toc-backref" href="#id23">5.3.1.2. JAX-WSとは</a><a class="headerlink" href="#jax-ws" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">JAX-WSとは、「<strong>J</strong>ava <strong>A</strong>PI for <strong>X</strong>ML-Based <strong>W</strong>eb <strong>S</strong>ervices」の略であり、SOAPなどを使ったWebサービスを扱うためのJava標準APIである。</div>
<div class="line">JAX-WSを用いることで、JavaのオブジェクトをSOAPの仕様に沿ったXMLに変換して送信することが可能である。</div>
<div class="line">そのため、SOAP Web Serviceとしては、XMLでやり取りが行われるものの、利用者は、XMLの構造をあまり意識せずデータを扱うことができる。</div>
<div class="line">Oracle WebLogic ServerやJBoss Enterprise Application Platformなど主要なJakarta EE（Java EE）サーバはJAX-WS実装をサーバ側で有しており、特別なライブラリを追加せずにその機能を使用して簡単にWebサービスを公開することができる。</div>
<div class="line">ただし、Tomcatは、JAX-WSを実装していないため、使用する際には別途JAX-WS実装ライブラリを追加する必要がある。</div>
<div class="line">詳細は、「<a class="reference internal" href="#soapappendixtomcatwebservice"><span class="std std-ref">Tomcat上でのWebサービス開発</span></a>」を参照されたい。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="jax-wsweb">
<span id="soapoverviewaboutrestfulwebservicedevelopment"></span><h3><a class="toc-backref" href="#id24">5.3.1.3. JAX-WSを利用したWebサービスの開発について</a><a class="headerlink" href="#jax-wsweb" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">TERASOLUNA Server Framework for Java (5.x)では、APサーバのJAX-WS実装とSpringの機能を利用してWebサービスの開発を行うことを推奨する。</div>
<div class="line">SOAPサーバ、クライアントどちらにおいても、通常のWebアプリケーション同様に、ブランクプロジェクト内のwebプロジェクトから作成したWARファイルをAPサーバにデプロイすることで、SOAP Web Serviceを実現することができる。</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>APサーバのJAX-WS実装によって、JAX-WS仕様への対応状況や実際のWebサービスの動作やが異なる場合があり、必ずしも本ガイドラインの実装が全てのAPサーバで同様に動作するわけではない。</p>
<p class="last">開発を始める前には必ず、「<a class="reference internal" href="#soapapplicationconfiguration"><span class="std std-ref">アプリケーションの設定</span></a>」のNoteから使用するAPサーバのマニュアルを確認されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="spring-frameworkjax-ws">
<span id="soapoverviewjaxwsspring"></span><h3><a class="toc-backref" href="#id25">5.3.1.4. Spring FrameworkのJAX-WS連携機能について</a><a class="headerlink" href="#spring-frameworkjax-ws" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Spring FrameworkはJAX-WSの連携機能をサポートしており、その機能を使用することでJAX-WSを利用して作成されたSOAP Web Serviceに接続するアプリケーションを簡単に実装することができる。</div>
<div class="line">以下はその機能を用いた、推奨アクセスフローの概要である。</div>
<div class="line">ここではSOAPのクライアント(図左)であるWebアプリケーションがSOAPサーバ(図右)にアクセスすることを前提としている。</div>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/SOAPProcessFlow.png"><img alt="Server and Client Projects for SOAP" src="../../_images/SOAPProcessFlow.png" style="width: 80%;" /></a>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">[クライアント] ControllerがServiceを呼び出す。</div>
<div class="line">通常の呼び出しと変更点は特にない。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">[クライアント] ServiceがSOAPサーバ提供側で用意したWebServiceインターフェースを呼び出す。</div>
<div class="line">この図では、ServiceがWebServiceインターフェースを呼び出しているが、要件に応じてControllerから直接WebServiceインターフェースを呼び出してもよい。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">[クライアント] WebServiceインターフェースが呼び出されると実体として「動的プロキシ(Dynamic Proxy)」(以下「プロキシ」)が呼び出される。</div>
<div class="line">このプロキシは<code class="docutils literal"><span class="pre">org.springframework.remoting.jaxws.JaxWsPortProxyFactoryBean</span></code>が生成したWebServiceインターフェースの実装クラスである。</div>
<div class="line">この実装クラスがServiceにインジェクションされ、ServiceはWebServiceインターフェースのメソッドを呼び出すだけで、SOAP Web Serviceを利用した処理を行うことができる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">プロキシが、SOAPサーバのWebServiceインターフェースを呼び出す。</div>
<div class="line">SOAPサーバとクライアントでの値のやり取りはDomain Objectを使用して行う。</div>
</div>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">厳密には、SOAPサーバとクライアントはXMLを使用して通信を行っている。
送信時、および受信時にはJAXBを使用して、Domain ObjectとXMLの相互変換が行われているが、SOAP Web Service作成者はXMLをあまり意識せず、開発を行うことができるようになっている。</p>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">[サーバ] WebServiceインターフェースが呼び出されると実体としてWebService実装クラスが呼び出される。</div>
<div class="line">SOAPサーバでは、WebServiceインターフェースの実装クラスとしてWebService実装クラスを用意する。</div>
<div class="line">このWebService実装クラスは、<code class="docutils literal"><span class="pre">org.springframework.web.context.support.SpringBeanAutowiringSupport</span></code>を継承することで、SpringのDIコンテナ上のBeanを<code class="docutils literal"><span class="pre">&#64;Autowired</span></code>などでインジェクションすることができる。</div>
</div>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p>WebService実装クラスは、Spring Frameworkが提供するDispatcherServlet上ではなく、APサーバのJAX-WSエンジンが実装するサーブレットとして動作する。このためガイドラインのアプリケーション層の実装に記載している実装方法とは以下のような違いがあることに注意されたい。</p>
<ul class="simple">
<li>WebService実装クラスがSpringのDIコンテナ上で管理されないため、例えばSpringのAOPによる横断的な処理をかけることができない。（ただし、JAX-WS実装としてApache CXFを利用する場合にはSpringのDIコンテナ上で管理される）</li>
<li>SpringのControllerクラスではないため、 <code class="docutils literal"><span class="pre">&#64;ControllerAdvice</span></code>や <code class="docutils literal"><span class="pre">&#64;ExceptionHandler</span></code> などが適用されない。</li>
</ul>
<p>また、SOAPサーバは、<code class="docutils literal"><span class="pre">&#64;Inject</span></code>ではなく、<code class="docutils literal"><span class="pre">&#64;Autowired</span></code>でインジェクションすることを推奨する。</p>
<p><code class="docutils literal"><span class="pre">&#64;Inject</span></code>の場合、Jakarta EE（Java EE）サーバが提供するDI機能で使用されるため、Jakarta EE（Java EE）サーバのDIコンテナに存在しないとエラーになってしまう。</p>
<p class="last">上記に対して、<code class="docutils literal"><span class="pre">&#64;Autowired</span></code>であればSpringのDI機能のみで使用されるため、意図せずJakarta EE（Java EE）サーバのDI機能でエラーになるのを防止することができる。</p>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">[サーバ] WebService実装クラスでは、業務処理を行うServiceを呼び出す。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">[サーバ] Serviceでは、Repositoryなどを使用して業務処理を実行する。</div>
<div class="line">通常の呼び出しと変更点は特にない。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Springでは、ドキュメントドリブンでWebサービスを開発するSpring Web Servicesが提供されているが、ここでは扱わない。
詳細は<a class="reference external" href="https://spring.io/projects/spring-ws">Spring Web Services</a>を参照されたい。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">SpringでのJAX-WS実装の詳細は、<a class="reference external" href="https://docs.spring.io/spring-framework/docs/5.3.24/reference/html/integration.html#remoting">Spring Framework Documentation -Remoting and Web Services-</a>を参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="soapoverviewaboutrestfulmodulestructure">
<span id="id2"></span><h4><a class="toc-backref" href="#id26">5.3.1.4.1. JAX-WSを利用したWebサービスのモジュールの構成</a><a class="headerlink" href="#soapoverviewaboutrestfulmodulestructure" title="Permalink to this headline">¶</a></h4>
<p>JAX-WSを利用したWebサービスを作成する場合、既存のブランクプロジェクトとは別に以下2つのプロジェクトを追加することを推奨する。</p>
<ul class="simple">
<li>modelプロジェクト</li>
<li>webserviceプロジェクト</li>
</ul>
<div class="line-block">
<div class="line">modelプロジェクトは、Webサービスの引数や返り値に使用するDomain Objectを格納する。</div>
<div class="line">webserviceプロジェクトは、Webサービスを呼び出すインターフェースを格納する。</div>
<div class="line">この2つはSOAPサーバからクライアントに配布する必要があるクラスのみ格納するプロジェクトである。</div>
<div class="line">配布する範囲を明確に識別するため、別プロジェクトにすることを推奨している。</div>
</div>
<p>本ガイドラインでは、マルチプロジェクトで以下のような構成を用いる。</p>
<p>ここでもクライアントはWebアプリケーションであることを前提とするが、デスクトップアプリケーションやコマンドラインインターフェースから呼び出す場合も基本的な考え方は同じである。</p>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/SOAPClientAndServerProjects.png"><img alt="Server and Client Projects for SOAP" src="../../_images/SOAPClientAndServerProjects.png" style="width: 80%;" /></a>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">クライアントを作成する場合、従来のマルチプロジェクトにSOAPサーバから提供されるmodelプロジェクトとwebserviceプロジェクトを追加する。</div>
<div class="line">ここではサーバとクライアントをともに開発することを前提としている。</div>
<div class="line">これらのプロジェクトの詳細については「<a class="reference internal" href="#soaphowtousewebapplicationconstruction"><span class="std std-ref">SOAPサーバの作成</span></a>」で説明する。</div>
<div class="line">追加方法については「<a class="reference internal" href="#soapappendixaddproject"><span class="std std-ref">SOAPサーバ用にプロジェクトの設定を変更する</span></a>」を参照されたい。</div>
<div class="line"><br /></div>
<div class="line">サーバとクライアントの開発が別々で、modelプロジェクトとwebserviceプロジェクトが提供されない場合、もしくはJava以外でSOAPサーバが作成されている場合には、modelプロジェクト内のDomain Objectとwebserviceプロジェクト内のWebサービスインターフェースを自分で作成する必要がある。</div>
<div class="line">wsimportを使用することで、WSDLから簡単にDomain ObjectとWebサービスインターフェースを作成することができる。</div>
<div class="line">詳細については「<a class="reference internal" href="#soapappendixwsimport"><span class="std std-ref">wsimportについて</span></a>」を参照されたい。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">SOAPサーバを作成する場合、従来のマルチプロジェクトに追加してmodelプロジェクトとwebserviceプロジェクトを追加する。</div>
<div class="line">クライアントにこれら2つのプロジェクトを公開する。</div>
<div class="line">クライアントへのmodelプロジェクト、webserviceプロジェクトの公開方法は、Mavenの依存関係への追加を想定している。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">結果として、プロジェクトは次のような構成となる。</div>
<div class="line">以下は、SOAPサーバのプロジェクト構成である。</div>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/SOAPServerPackageExplorer.png"><img alt="Package explorer for SOAP server projects" src="../../_images/SOAPServerPackageExplorer.png" style="width: 50%;" /></a>
</div>
<p>以下は、クライアントのプロジェクト構成である。</p>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/SOAPClientPackageExplorer.png"><img alt="Package explorer for SOAP client projects" src="../../_images/SOAPClientPackageExplorer.png" style="width: 42%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="weburl">
<h3><a class="toc-backref" href="#id27">5.3.1.5. Webサービスとして公開されるURL</a><a class="headerlink" href="#weburl" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">SOAP Web Serviceを作成するとWSDL（<strong>W</strong>eb <strong>S</strong>ervices <strong>D</strong>escription <strong>L</strong>anguage）というWebサービスのインターフェース定義が公開され、クライアントはこの定義をもとにSOAP Web Serviceを実行する。</div>
<div class="line">WSDLの詳細は、<a class="reference external" href="https://www.w3.org/TR/wsdl/">W3C -Web Services Description Language (WSDL)-</a>を参照されたい。</div>
</div>
<div class="line-block">
<div class="line">WSDL内には、Webサービス実行時のアクセスURLやメソッド名、引数、戻り値などが定義される。</div>
<div class="line">本ガイドラインの通りにSOAP Web Serviceを作成すると、以下のURLでWSDLが公開される。</div>
<div class="line">クライアントではこのURLを指定する必要がある。</div>
</div>
<ul class="simple">
<li><cite>http://AAA.BBB.CCC.DDD:XXXX/コンテキストルート/Webサービス名?wsdl</cite></li>
</ul>
<p>WSDL内で定義されるエンドポイントアドレスは以下のURLである。</p>
<ul class="simple">
<li><cite>http://AAA.BBB.CCC.DDD:XXXX/コンテキストルート/Webサービス名</cite></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">本ガイドラインでは、マルチプロジェクト構成のwebプロジェクトをWARファイル化して、APサーバにデプロイする前提である。その場合、コンテキストルートは基本的に、[server projectName]-webとなる。ただし、APサーバによって異なるので注意すること。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">本ガイドラインでは、SOAPサーバ、クライアントともにWebアプリケーションとして公開する前提であるため、クライアントではWSDLのURLを指定している。URLではなく、WSDLをファイルとして用意してクライアントを作成することも可能である。
詳細は、<a class="reference internal" href="#soaphowtousewebserviceclient"><span class="std std-ref">Webサービス クライアントの実装</span></a>を参照されたい。</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>本ガイドラインでは、APサーバ（Tomcatの場合は使用するライブラリ）でコンテキストルートのマッピングを切り替え以下のようなURLでアクセスするように設定している。</p>
<ul class="simple">
<li><cite>http://AAA.BBB.CCC.DDD:XXXX/[server projectName]-web/ws/TodoWebService?wsdl</cite></li>
</ul>
<p>このコンテキストルート直下ではないURLにWebサービスをマッピングさせる方法は、APサーバごとに異なる。
詳細は以下を参照してほしい。</p>
<blockquote class="last">
<div><table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="50%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">APサーバ名</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Apache Tomcat</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><a class="reference internal" href="#soapappendixtomcatwebservice"><span class="std std-ref">Tomcat上でのWebサービス開発</span></a></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Oracle WebLogic Server</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">TBD</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">JBoss Enterprise Application Platform</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">TBD</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="how-to-use">
<span id="soaphowtouse"></span><h2><a class="toc-backref" href="#id28">5.3.2. How to use</a><a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h2>
<p>本節では、SOAP Web Serviceの具体的な作成方法について説明する。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="soaphowtousewebapplicationconstruction">
<span id="id3"></span><h3><a class="toc-backref" href="#id29">5.3.2.1. SOAPサーバの作成</a><a class="headerlink" href="#soaphowtousewebapplicationconstruction" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id4">
<h4><a class="toc-backref" href="#id30">5.3.2.1.1. プロジェクトの構成</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p><strong>各プロジェクトの依存関係</strong></p>
<div class="line-block">
<div class="line">「<a class="reference internal" href="#soapoverviewaboutrestfulwebservicedevelopment"><span class="std std-ref">JAX-WSを利用したWebサービスの開発について</span></a>」で述べたとおり、modelプロジェクトとwebserviceプロジェクトを追加する。</div>
<div class="line">追加方法は「<a class="reference internal" href="#soapappendixaddproject"><span class="std std-ref">SOAPサーバ用にプロジェクトの設定を変更する</span></a>」を参照されたい。</div>
<div class="line">またそれに伴い、既存のプロジェクトに依存関係を追加することが必要となる。</div>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/SOAPServerProjects.png"><img alt="Server Projects for SOAP" src="../../_images/SOAPServerProjects.png" style="width: 80%;" /></a>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="30%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">プロジェクト名</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">webプロジェクト</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Webサービス実装クラスを配置する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">domainプロジェクト</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">WebServiceの実装クラスから呼び出されるServiceを配置する。</div>
<div class="line">その他、Repositoryなどは従来と同じである。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">webserviceプロジェクト</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">公開するWebServiceのインターフェースをここに配置する。</div>
<div class="line">クライアントはこのインターフェースを使用してWebサービスを実行する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">modelプロジェクト</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ドメイン層に属するクラスのうち、SOAP Web Serviceで使用するクラスのみをここに配置する。</div>
<div class="line">クライアントからの入力値や返却結果はこのプロジェクト内のクラスを使用する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="soapapplicationconfiguration">
<span id="id5"></span><h4><a class="toc-backref" href="#id31">5.3.2.1.2. アプリケーションの設定</a><a class="headerlink" href="#soapapplicationconfiguration" title="Permalink to this headline">¶</a></h4>
<p><strong>Webサービスを公開する際の初期設定</strong></p>
<div class="line-block">
<div class="line">APサーバとしてTomcatを使用する場合は、「<a class="reference internal" href="#soapappendixtomcatwebservice"><span class="std std-ref">Tomcat上でのWebサービス開発</span></a>」を実施する必要がある。</div>
<div class="line">その他、APサーバによってWebサービス公開の方法は違うので、詳細は各APサーバのマニュアルを参照されたい。</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>以下、参考資料として、APサーバのマニュアルを記述しておく。
必ず、使用するバージョンとあっているか確認してから参照すること。</p>
<p>Oracle WebLogic Server 12.2.1.4: <a class="reference external" href="https://docs.oracle.com/en/middleware/fusion-middleware/weblogic-server/12.2.1.4/wsovr/weblogic-web-service-stand.html#GUID-FB83E047-F696-4B96-A982-140C0C8AD7EF">Understanding WebLogic Web Services for Oracle WebLogic Server -Features and Standards Supported by WebLogic Web Services-</a></p>
<p>Oracle WebLogic Server 14.1.1.0: <a class="reference external" href="https://docs.oracle.com/en/middleware/standalone/weblogic-server/14.1.1.0/wsovr/weblogic-web-service-stand.html#GUID-FB83E047-F696-4B96-A982-140C0C8AD7EF">Understanding WebLogic Web Services for Oracle WebLogic Server -Features and Standards Supported by WebLogic Web Services-</a></p>
<p>JBoss Enterprise Application Platform 7.3: <a class="reference external" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.3/html/developing_web_services_applications/developing_jax_ws_web_services">DEVELOPING JAX-WS WEB SERVICES</a></p>
<p>JBoss Enterprise Application Platform 6.4: <a class="reference external" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/6.4/html/development_guide/chap-jax-ws_web_services">JAX-WS WEB SERVICES</a></p>
<p class="last">WebSphere Application Server 9.0: <a class="reference external" href="https://www.ibm.com/docs/en/was/9.0.5?topic=services-web">IBM Knowledge Center - Web services</a></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>パッケージのコンポーネントスキャン設定</strong></p>
<p>Webサービスで使用するコンポーネントをスキャンするため、<code class="docutils literal"><span class="pre">[server</span> <span class="pre">projectName]-ws.xml</span></code>を作成し、コンポーネントスキャンの定義を行い、Webサービスにインジェクションできるようにする。</p>
<p><em>[server projectName]-web/src/main/resources/META-INF/spring/[server projectName]-ws.xml</em></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;</span>
<span class="s">         http://www.springframework.org/schema/beans</span>
<span class="s">         https://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">         http://www.springframework.org/schema/context</span>
<span class="s">         https://www.springframework.org/schema/context/spring-context.xsd&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&quot;com.example.ws&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Webサービスで使用するコンポーネントが格納されているパッケージを指定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><em>[server projectName]-web/src/main/webapp/WEB-INF/web.xml</em></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;context-param&gt;</span>
    <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
    <span class="c">&lt;!-- Root ApplicationContext --&gt;</span>
    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;param-value&gt;</span>
        classpath*:META-INF/spring/applicationContext.xml
        classpath*:META-INF/spring/spring-security.xml
<span class="hll">        classpath*:META-INF/spring/[server projectName]-ws.xml
</span>    <span class="nt">&lt;/param-value&gt;</span>
<span class="nt">&lt;/context-param&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">[server</span> <span class="pre">projectName]-ws.xml</span></code>をルート<code class="docutils literal"><span class="pre">ApplicationContext</span></code>生成時の読み込み対象に加える。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>入力チェックを行うための定義</strong></p>
<div class="line-block">
<div class="line">入力チェックにはメソッドバリデーションを使用するため、以下の定義を追加する。</div>
<div class="line">入力チェックの詳細は <a class="reference internal" href="#soaphowtouseservervalidation"><span class="std std-ref">入力チェックの実装</span></a>を参照されたい。</div>
</div>
<p><em>[server projectName]-web/src/main/resources/META-INF/spring/applicationContext.xml</em></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.validation.beanvalidation.MethodValidationPostProcessor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;validator&quot;</span> <span class="na">ref=</span><span class="s">&quot;validator&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;validator&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.validation.beanvalidation.LocalValidatorFactoryBean&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="web">
<span id="soaphowtousewebserviceimpl"></span><h4><a class="toc-backref" href="#id32">5.3.2.1.3. Webサービスの実装</a><a class="headerlink" href="#web" title="Permalink to this headline">¶</a></h4>
<p>以下の作成を行う。</p>
<ul class="simple">
<li>Domain Objectの作成</li>
<li>WebServiceインターフェイスの作成</li>
<li>WebService実装クラスの作成</li>
</ul>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/SOAPServerClass.png"><img alt="Server Projects for SOAP" src="../../_images/SOAPServerClass.png" style="width: 80%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Domain Objectの作成</strong></p>
<div class="line-block">
<div class="line">modelプロジェクト内に、Webサービスの引数や返り値に使用するDomain Objectを作成する。</div>
<div class="line"><code class="docutils literal"><span class="pre">java.io.Serializable</span></code>インターフェースを実装した一般のJavaBeanと特に変わりはない。</div>
</div>
<p><em>[server projectName]-model/src/main/java/com/example/domain/model/Todo.java</em></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.domain.model</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Todo</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">todoId</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">title</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">description</span><span class="p">;</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">finished</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">Date</span> <span class="n">createdAt</span><span class="p">;</span>

    <span class="c1">// omitted setter and getter</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>WebServiceインターフェイスの作成</strong></p>
<p>webserviceプロジェクト内にWebサービスを呼び出すインターフェースを作成する。</p>
<p><em>[server projectName]-webservice/src/main/java/com/example/ws/todo/TodoWebService.java</em></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.ws.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.jws.WebMethod</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.jws.WebParam</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.jws.WebResult</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.jws.WebService</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.ws.webfault.WebFaultException</span><span class="p">;</span>

<span class="nd">@WebService</span><span class="p">(</span><span class="n">targetNamespace</span> <span class="o">=</span> <span class="s">&quot;http://example.com/todo&quot;</span><span class="p">)</span> <span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoWebService</span> <span class="p">{</span>

    <span class="nd">@WebMethod</span> <span class="c1">// (2)</span>
    <span class="nd">@WebResult</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;todo&quot;</span><span class="p">)</span> <span class="c1">// (3)</span>
    <span class="n">Todo</span> <span class="nf">getTodo</span><span class="p">(</span><span class="nd">@WebParam</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;todoId&quot;</span><span class="p">)</span> <span class="cm">/* (4) */</span> <span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">WebFaultException</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line"><code class="docutils literal"><span class="pre">&#64;WebService</span></code>を付けることで、WebServiceインターフェースであることを宣言する。</div>
<div class="line"><code class="docutils literal"><span class="pre">targetNamespace</span></code>属性には、名前空間を定義するが、これは作成するWebサービスのパッケージ名と合わせることを推奨する。</div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><code class="docutils literal"><span class="pre">targetNamespace</span></code>属性の値は一意にする必要がある。そのため、ガイドライン上のソースを流用する場合は必ず変更すること。</p>
</div>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">targetNamespace</span></code>属性の値はWSDL上に定義され、このWebサービスの名前空間を決定し、一意に特定するために使用される。</p>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Webサービスのメソッドとして公開するメソッドに<code class="docutils literal"><span class="pre">&#64;WebMethod</span></code>を付ける。</div>
<div class="line">このアノテーションを付けることにより、WSDL上にメソッドが公開され、外部から使用することが可能になる。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">返り値に<code class="docutils literal"><span class="pre">&#64;WebResult</span></code>を付け、名前を<code class="docutils literal"><span class="pre">name</span></code>属性に指定する。返り値がない場合は不要。</div>
<div class="line">このアノテーションを付けることにより、WSDL上に返り値として公開される。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">引数に<code class="docutils literal"><span class="pre">&#64;WebParam</span></code>を付け、名前を<code class="docutils literal"><span class="pre">name</span></code>属性に指定する。</div>
<div class="line">このアノテーションを付けることにより、WSDL上に引数が公開され、外部から呼び出すときの必要なパラメータとして定義される。</div>
<div class="line"><code class="docutils literal"><span class="pre">WebFaultException</span></code>の詳細は「<a class="reference internal" href="#soaphowtouseexceptionhandler"><span class="std std-ref">例外ハンドリングの実装</span></a>」を参照されたい。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>パッケージ名および、ネームスペースの付け方について</strong></p>
<p>パッケージ名が以下のような形式になっている場合</p>
<blockquote>
<div><ul class="simple">
<li>【ドメイン】.【アプリケーション名(システム名)】.ws.【ユースケース名】</li>
</ul>
</div></blockquote>
<p>本ガイドラインでは、以下のようなネームスペースにすることを推奨する。</p>
<blockquote class="last">
<div><ul class="simple">
<li><a class="reference external" href="http:/">http:/</a>/【ドメイン】/【アプリケーション名(システム名)】</li>
</ul>
</div></blockquote>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>ネームスペースとパッケージ名の関係</strong></p>
<p>ドメインをcom.example、アプリケーション名をtodoとした場合、Namespaceは以下のようなJavaのパッケージと紐づけられる。</p>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/SOAPURL.png"><img alt="Server and Client Projects for SOAP" src="../../_images/SOAPURL.png" style="width: 50%;" /></a>
</div>
<p class="last">仕様ではないが、Namespaceとパッケージの命名について、<a class="reference external" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_fuse/6.0/html/developing_applications_using_jax-ws/jaxwsdatanamespacemapping">XML Namespace Mapping(Red Hat JBoss Fuse)</a>にまとまっている。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>WebService実装クラスの作成</strong></p>
<p>webプロジェクト内にWebServiceインターフェースの実装クラスを作成する。</p>
<p><em>[server projectName]-web/src/main/java/com/example/ws/todo/TodoWebServiceImpl.java</em></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.ws.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.jws.HandlerChain</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.jws.WebService</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.ws.BindingType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.ws.soap.SOAPBinding</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.context.support.SpringBeanAutowiringSupport</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.domain.service.TodoService</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.ws.webfault.WebFaultException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.ws.exception.WsExceptionHandler</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.ws.todo.TodoWebService</span><span class="p">;</span>


<span class="nd">@WebService</span><span class="p">(</span>
        <span class="n">portName</span> <span class="o">=</span> <span class="s">&quot;TodoWebPort&quot;</span><span class="p">,</span>
        <span class="n">serviceName</span> <span class="o">=</span> <span class="s">&quot;TodoWebService&quot;</span><span class="p">,</span>
        <span class="n">targetNamespace</span> <span class="o">=</span> <span class="s">&quot;http://example.com/todo&quot;</span><span class="p">,</span>
        <span class="n">endpointInterface</span> <span class="o">=</span> <span class="s">&quot;com.example.ws.todo.TodoWebService&quot;</span><span class="p">)</span> <span class="c1">// (1)</span>
<span class="nd">@BindingType</span><span class="p">(</span><span class="n">SOAPBinding</span><span class="p">.</span><span class="na">SOAP12HTTP_BINDING</span><span class="p">)</span> <span class="c1">// (2)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoWebServiceImpl</span> <span class="kd">extends</span> <span class="n">SpringBeanAutowiringSupport</span> <span class="kd">implements</span> <span class="n">TodoWebService</span> <span class="p">{</span> <span class="c1">// (3)</span>

    <span class="nd">@Autowired</span> <span class="c1">// (4)</span>
    <span class="n">TodoService</span> <span class="n">todoService</span><span class="p">;</span>

    <span class="nd">@Override</span> <span class="c1">// (5)</span>
    <span class="kd">public</span> <span class="n">Todo</span> <span class="nf">getTodo</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">WebFaultException</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">todoService</span><span class="p">.</span><span class="na">getTodo</span><span class="p">(</span><span class="n">todoId</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line"><code class="docutils literal"><span class="pre">&#64;WebService</span></code>を付けることで、WebServiceの実装クラスであることを宣言する。</div>
<div class="line"><code class="docutils literal"><span class="pre">portName</span></code>属性は、WSDL上のポート名として公開される。</div>
<div class="line"><code class="docutils literal"><span class="pre">serviceName</span></code>属性は、WSDL上のサービス名として公開される。</div>
<div class="line"><code class="docutils literal"><span class="pre">targetNamespace</span></code>属性は、WSDL上で使用されるネームスペース。</div>
<div class="line"><code class="docutils literal"><span class="pre">endpointInterface</span></code>属性は、このクラスが実装しているWebサービスのインターフェース名を定義する。</div>
</div>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">TodoWebService</span></code>インターフェースでは、<code class="docutils literal"><span class="pre">&#64;WebService</span></code>の属性として<code class="docutils literal"><span class="pre">portName</span></code>属性, <code class="docutils literal"><span class="pre">serviceName</span></code>属性, <code class="docutils literal"><span class="pre">endpointInterface</span></code>属性を設定してはいけない。これは、このインターフェースはWSDL上の<code class="docutils literal"><span class="pre">portType</span></code>要素に対応しており、Webサービスの内容を記述する要素ではないためである。</p>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line"><code class="docutils literal"><span class="pre">&#64;BindingType</span></code>を付けることで、バインディングの方式を設定する。</div>
<div class="line"><code class="docutils literal"><span class="pre">SOAPBinding.SOAP12HTTP_BINDING</span></code>を定義するとSOAP1.2でのバインディングとなる。</div>
<div class="line">何もつけない場合は、SOAP1.1でのバインディングとなる。</div>
</div>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p>使用するAPサーバのJAX-WS実装により、バインディング方式で挙動が異なる場合があるため注意すること。</p>
<p class="last">たとえば、WebSphere Application Serverの特定のバージョンではSOAP1.2でのバインディングの場合にWSDLが自動生成されない。詳細については<a class="reference external" href="https://www.ibm.com/docs/en/radfws/9.7?topic=SSRTLW_9.7.0/com.ibm.webservice.doc/topics/jaxws/cwsandoc001.html">IBM Knowledge Center - Using annotations to create web services</a>を参照されたい。</p>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">先ほど作成した<code class="docutils literal"><span class="pre">TodoWebService</span></code>インターフェースを実装する。</div>
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.web.context.support.SpringBeanAutowiringSupport</span></code>を継承することで、SpringのBeanをDIできるようにする。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Serviceをインジェクションする。</div>
<div class="line">通常のControllerでServiceを呼び出す場合と変わりはない。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Serviceを呼び出して業務処理を実行する。</div>
<div class="line">通常のControllerでServiceを呼び出す場合と変わりはない。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Webサービス関連のクラスはwsパッケージ配下にまとめることを推奨する。これは、アプリケーション層のクラスはappパッケージ配下に配置することを推奨しており、それらと区別をしやすくするためである。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="soaphowtouseservervalidation">
<span id="id6"></span><h4><a class="toc-backref" href="#id33">5.3.2.1.4. 入力チェックの実装</a><a class="headerlink" href="#soaphowtouseservervalidation" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">SOAP Web Serviceにより送信されたパラメータの入力チェックには、Springから提供されているメソッドバリデーションを使用する。</div>
<div class="line">メソッドバリデーションの詳細については<a class="reference internal" href="../WebApplicationDetail/Validation.html#methodvalidationonspringframeworkhowtouseapplytarget"><span class="std std-ref">Method Validation対象のメソッドにするための定義方法</span></a>を参照されたい。</div>
<div class="line">以下のように、Serviceのインターフェースに入力チェック内容を定義する。</div>
</div>
<p><em>[server projectName]-domain/src/main/java/com/example/domain/service/todo/TodoService.java</em></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.domain.service.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.Valid</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.groups.Default</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.validation.annotation.Validated</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="p">;</span>

<span class="nd">@Validated</span> <span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoService</span> <span class="p">{</span>

    <span class="n">Todo</span> <span class="nf">getTodo</span><span class="p">(</span><span class="nd">@NotNull</span> <span class="n">String</span> <span class="n">todoId</span><span class="p">);</span> <span class="c1">// (2)</span>

    <span class="n">Todo</span> <span class="nf">createTodo</span><span class="p">(</span><span class="nd">@Valid</span> <span class="n">Todo</span> <span class="n">todo</span><span class="p">);</span> <span class="c1">// (3)</span>

    <span class="nd">@Validated</span><span class="p">({</span> <span class="n">Default</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">Todo</span><span class="p">.</span><span class="na">Update</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span> <span class="c1">// (4)</span>
    <span class="n">Todo</span> <span class="nf">updateTodo</span><span class="p">(</span><span class="nd">@Valid</span> <span class="n">Todo</span> <span class="n">todo</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">&#64;Validated</span></code>を付けることで、このインターフェースの実装クラスが入力チェック対象であることを宣言する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">引数をチェックする場合には、引数自体にアノテーションを付ける。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">JavaBeanの入力チェックを行う場合も、引数に<code class="docutils literal"><span class="pre">&#64;Valid</span></code>を付ける。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">&#64;Validated</span></code>にグループを指定し、特定の条件を絞って入力チェックすることも可能である。</div>
<div class="line">グループの詳細は次のJavaBeanの説明で記述する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><em>[server projectName]-model/src/main/java/com/example/domain/model/Todo.java</em></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.domain.model</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.constraints.Null</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="p">;</span>

<span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Todo</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>

    <span class="c1">// (2)</span>
    <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Create</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Update</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="nd">@Null</span><span class="p">(</span><span class="n">groups</span> <span class="o">=</span> <span class="n">Create</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
    <span class="nd">@NotNull</span><span class="p">(</span><span class="n">groups</span> <span class="o">=</span> <span class="n">Update</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">todoId</span><span class="p">;</span>

    <span class="nd">@NotNull</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">title</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">description</span><span class="p">;</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">finished</span><span class="p">;</span>

    <span class="nd">@Null</span><span class="p">(</span><span class="n">groups</span> <span class="o">=</span> <span class="n">Create</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">createdAt</span><span class="p">;</span>

    <span class="c1">// omitted setter and getter</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Bean ValidationでJavaBeanの入力チェックを定義する。</div>
<div class="line">詳細は「<a class="reference internal" href="../WebApplicationDetail/Validation.html"><span class="doc">入力チェック</span></a>」を参照されたい。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">バリデーションのグループ化を行うために使用するインターフェースを定義する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id7">
<h4><a class="toc-backref" href="#id34">5.3.2.1.5. セキュリティ対策</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<p><strong>認証処理</strong></p>
<div class="line-block">
<div class="line">SOAPの認証・認可方式に関して、本ガイドラインではSpring SecurityでBasic認証を行う方法とServiceでの認可の方法のみ紹介する。</div>
<div class="line">WS-Securityは扱わない。</div>
<div class="line">詳細な利用方法は、「<a class="reference internal" href="../../Security/Authentication.html"><span class="doc">認証</span></a>」と「<a class="reference internal" href="../../Security/Authorization.html"><span class="doc">認可</span></a>」を参照されたい。</div>
</div>
<p>以下にSOAP Web Serviceに対して、Basic認証を行うSpring Securityの設定例を示す。</p>
<p><em>[server projectName]-web/src/main/resources/META-INF/spring/spring-security.xml</em></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;sec:http</span> <span class="na">pattern=</span><span class="s">&quot;/ws/**&quot;</span>
          <span class="na">create-session=</span><span class="s">&quot;stateless&quot;</span>
          <span class="na">once-per-request=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;sec:csrf</span> <span class="na">disabled=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;sec:http-basic</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/sec:http&gt;</span>

<span class="c">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;sec:authentication-manager&gt;</span>
   <span class="nt">&lt;sec:authentication-provider</span> <span class="na">user-service-ref=</span><span class="s">&quot;sampleUserDetailsService&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/sec:authentication-manager&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">sec:http-basic</span></code>タグを記述するとBasic認証を行うことができる。</div>
<div class="line"><code class="docutils literal"><span class="pre">pattern</span></code>属性を使用して、Webサービスを実行する部分のみ認証を行う。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">authentication-provider</span></code>を利用して、認証方式を定義する。</div>
<div class="line">実際の認証およびユーザ情報取得は<code class="docutils literal"><span class="pre">UserDetailsService</span></code>を作成して実施する必要がある。</div>
<div class="line">詳細は「<a class="reference internal" href="../../Security/Authentication.html"><span class="doc">認証</span></a>」を参照されたい。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>認可処理</strong></p>
<div class="line-block">
<div class="line">認可はServiceごとにアノテーションを付けて行う。</div>
<div class="line">詳細は「<a class="reference internal" href="../../Security/Authorization.html"><span class="doc">認可</span></a>」のアクセス認可(Method)を参照されたい。</div>
</div>
<p><em>[server projectName]-web/src/main/resources/META-INF/spring/spring-security.xml</em></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;sec:global-method-security</span> <span class="na">pre-post-annotations=</span><span class="s">&quot;enabled&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">&lt;sec:global-method-security&gt;</span></code>要素の<code class="docutils literal"><span class="pre">pre-post-annotations</span></code>属性を<code class="docutils literal"><span class="pre">enabled</span></code>に指定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><em>[server projectName]-domain/src/main/java/com/example/domain/service/todo/TodoServiceImpl.java</em></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoServiceImpl</span> <span class="kd">implements</span> <span class="n">TodoService</span> <span class="p">{</span>

    <span class="c1">// omitted</span>

    <span class="c1">// (1)</span>
    <span class="nd">@PreAuthorize</span><span class="p">(</span><span class="s">&quot;isAuthenticated()&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="nf">getTodos</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// omitted</span>
    <span class="p">}</span>

    <span class="nd">@PreAuthorize</span><span class="p">(</span><span class="s">&quot;hasRole(&#39;ROLE_ADMIN&#39;)&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">Todo</span> <span class="nf">createTodo</span><span class="p">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// omitted</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">認可処理を行うメソッドに<code class="docutils literal"><span class="pre">org.springframework.security.access.prepost.PreAuthorize</span></code>アノテーションを設定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>CSRF対策</strong></p>
<div class="line-block">
<div class="line">SOAP Web Serviceはセッションを利用せず、ステートレスな通信にすべきである。</div>
<div class="line">そのため、セッションを利用するCSRF対策を行わないようにするための設定方法について以下に記述する。</div>
<div class="line">CSRFの詳細は「<a class="reference internal" href="../../Security/CSRF.html"><span class="doc">CSRF対策</span></a>」を参照されたい。</div>
<div class="line">ブランクプロジェクトのデフォルトの設定では、CSRF対策が有効化されている。</div>
<div class="line">そのため、以下の設定を追加し、SOAP Web Serviceのリクエストに対して、CSRF対策の処理が行われないようにする。</div>
</div>
<p><em>[server projectName]-web/src/main/resources/META-INF/spring/spring-security.xml</em></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;sec:http</span> <span class="na">pattern=</span><span class="s">&quot;/ws/**&quot;</span>
    <span class="na">create-session=</span><span class="s">&quot;stateless&quot;</span>
    <span class="na">once-per-request=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;sec:http-basic</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;sec:csrf</span> <span class="na">disabled=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/sec:http&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">SOAP Web Service用のSpring Securityの定義を追加する。</div>
<div class="line"><code class="docutils literal"><span class="pre">&lt;sec:http&gt;</span></code>要素の<code class="docutils literal"><span class="pre">pattern</span></code>属性にSOAP Web Service用のリクエストパスのURLパターンを指定する。</div>
<div class="line">このコード例では、<code class="docutils literal"><span class="pre">/ws/</span></code>で始まるリクエストパスをSOAP Web Service用のリクエストパスとしている。</div>
<div class="line">また、<code class="docutils literal"><span class="pre">create-session</span></code>属性を<code class="docutils literal"><span class="pre">stateless</span></code>とする事で、Spring Securityの処理でセッションが使用されなくなる。</div>
<div class="line"><br /></div>
<div class="line">CSRF対策を無効化するために、<code class="docutils literal"><span class="pre">&lt;sec:csrf&gt;</span></code>要素の<code class="docutils literal"><span class="pre">disabled</span></code>属性を<code class="docutils literal"><span class="pre">true</span></code>に指定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id8">
<h4><a class="toc-backref" href="#id35">5.3.2.1.6. 例外ハンドリングの実装</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">SOAPサーバで例外が発生した場合にクライアントへ伝えるためには専用の例外クラスをスローする必要がある。</div>
<div class="line">その実装を以下に記述する。</div>
</div>
<p><strong>SOAPサーバで発生する例外</strong></p>
<p>SOAPサーバで発生した例外はこれから記述する例外を実装したクラス（SOAPFault）を使用することで、クライアントへの通知メッセージを決定することができる。</p>
<p>具体的には以下のクラスを作成する。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="30%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">クラス名</th>
<th class="head">概要</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">ErrorBean</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">発生した例外のコードとメッセージなどを保持するクラス。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">WebFaultType</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">例外の種類を判別するために使用する列挙型。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">WebFaultBean</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">ErrorBean</span></code>と<code class="docutils literal"><span class="pre">WebFaultType</span></code>を保持するクラス。<code class="docutils literal"><span class="pre">ErrorBean</span></code>を<code class="docutils literal"><span class="pre">List</span></code>で保持して例外情報を複数保持できる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">WebFaultException</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">WebFaultBean</span></code>を保持する例外クラス。</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>これらの例外はSOAPサーバ、クライアントで共用するため、[server projectName]-webserviceに配置する。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><em>[server projectName]-webservice/src/main/java/com/example/ws/webfault/ErrorBean.java</em></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.ws.webfault</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ErrorBean</span> <span class="p">{</span> <span class="c1">// (1)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">code</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">message</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">path</span><span class="p">;</span>

    <span class="c1">// omitted setter and getter</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">例外のメッセージなどを保持するクラスを作成する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><em>[server projectName]-webservice/src/main/java/com/example/ws/webfault/WebFaultType.java</em></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.ws.webfault</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">WebFaultType</span> <span class="p">{</span> <span class="c1">// (2)</span>
    <span class="n">AccessDeniedFault</span><span class="p">,</span>
    <span class="n">BusinessFault</span><span class="p">,</span>
    <span class="n">ResourceNotFoundFault</span><span class="p">,</span>
    <span class="n">ValidationFault</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">例外の種類を判別するために使用する列挙型を定義する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><em>[server projectName]-webservice/src/main/java/com/example/ws/webfault/WebFaultBean.java</em></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.ws.webfault</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebFaultBean</span> <span class="p">{</span> <span class="c1">// (3)</span>

    <span class="kd">private</span> <span class="n">WebFaultType</span> <span class="n">type</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ErrorBean</span><span class="o">&gt;</span> <span class="n">errors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ErrorBean</span><span class="o">&gt;</span><span class="p">();</span>

    <span class="kd">public</span> <span class="nf">WebFaultBean</span><span class="p">(</span><span class="n">WebFaultType</span> <span class="n">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">type</span> <span class="o">=</span> <span class="n">type</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addError</span><span class="p">(</span><span class="n">String</span> <span class="n">code</span><span class="p">,</span> <span class="n">String</span> <span class="n">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">addError</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addError</span><span class="p">(</span><span class="n">String</span> <span class="n">code</span><span class="p">,</span> <span class="n">String</span> <span class="n">message</span><span class="p">,</span> <span class="n">String</span> <span class="n">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">errors</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="n">ErrorBean</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">path</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="c1">// omitted setter and getter</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">ErrorBean</span></code>と<code class="docutils literal"><span class="pre">WebFaultType</span></code>を保持するクラスを作成する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><em>[server projectName]-webservice/src/main/java/com/example/ws/webfault/WebFaultException.java</em></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.ws.webfault</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.xml.ws.WebFault</span><span class="p">;</span>

<span class="nd">@WebFault</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;WebFault&quot;</span><span class="p">,</span> <span class="n">targetNamespace</span> <span class="o">=</span> <span class="s">&quot;http://example.com/todo&quot;</span><span class="p">)</span> <span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebFaultException</span> <span class="kd">extends</span> <span class="n">Exception</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="n">WebFaultBean</span> <span class="n">faultInfo</span><span class="p">;</span> <span class="c1">// (2)</span>

    <span class="kd">public</span> <span class="nf">WebFaultException</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="nf">WebFaultException</span><span class="p">(</span><span class="n">String</span> <span class="n">message</span><span class="p">,</span> <span class="n">WebFaultBean</span> <span class="n">faultInfo</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">faultInfo</span> <span class="o">=</span> <span class="n">faultInfo</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="nf">WebFaultException</span><span class="p">(</span><span class="n">String</span> <span class="n">message</span><span class="p">,</span> <span class="n">WebFaultBean</span> <span class="n">faultInfo</span><span class="p">,</span> <span class="n">Throwable</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">faultInfo</span> <span class="o">=</span> <span class="n">faultInfo</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ErrorBean</span><span class="o">&gt;</span> <span class="nf">getErrors</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">faultInfo</span><span class="p">.</span><span class="na">getErrors</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">WebFaultType</span> <span class="nf">getType</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">faultInfo</span><span class="p">.</span><span class="na">getType</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="c1">// omitted setter and getter</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Exception継承クラスに<code class="docutils literal"><span class="pre">&#64;WebFault</span></code>を付けて、SOAPFaultであることを宣言する。</div>
<div class="line"><code class="docutils literal"><span class="pre">name</span></code>属性には、クライアントに送信するSOAPFaultの<code class="docutils literal"><span class="pre">name</span></code>属性を設定する。</div>
<div class="line"><code class="docutils literal"><span class="pre">targetNamespace</span></code>属性には、使用するネームスペースを設定する。Webサービスと同じにする必要がある。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">faultInfoをフィールドに保持させるとともに、コード例のように以下のようなコンストラクタとメソッドを持たせる。</div>
</div>
<ul class="last simple">
<li>メッセージ文字列とfaultInfoを引数とするコンストラクタ</li>
<li>メッセージ文字列とfaultInfoと原因例外を引数とするコンストラクタ</li>
<li>getFaultInfoメソッド</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>WebFaultExceptionにRuntimeExceptionではなく、Exceptionを継承させている理由</strong></p>
<p class="last"><code class="docutils literal"><span class="pre">WebFaultException</span></code>の親クラスを<code class="docutils literal"><span class="pre">RuntimeException</span></code>にすれば、例外の処理をもっと簡略化することができそうに見える。しかし、親クラスを<code class="docutils literal"><span class="pre">RuntimeException</span></code>にしてはいけない。<a class="reference external" href="https://jcp.org/en/jsr/detail?id=224">JSR 224: JavaTM API for XML-Based Web Services</a>でも明確にしてはいけないと宣言されている。実際に試してみても、APサーバのJAX-WS実装次第ではあるが、クライアントで<code class="docutils literal"><span class="pre">&#64;WebFault</span></code>を付けた例外クラス（<code class="docutils literal"><span class="pre">WebFaultException</span></code>）を取得することができず、エラーの種類やメッセージを取得することができなくなる。AOPを使用して例外処理を実施していないのも<code class="docutils literal"><span class="pre">Exception</span></code>を継承しているためである。</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>WebFaultExceptionのコンストラクタとフィールドについて</strong></p>
<p class="last"><code class="docutils literal"><span class="pre">WebFaultException</span></code>には、デフォルトコンストラクタと各フィールドに対応するsetterが必須となる。これは、クライアントの内部処理で、<code class="docutils literal"><span class="pre">WebFaultException</span></code>を作成する際に使用するためである。そのため、各フィールドをfinalにすることも不可能である。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">この<code class="docutils literal"><span class="pre">WebFaultException</span></code>を継承し、クライアントへ伝えたい種類分、子クラスを作成する。</div>
<div class="line">たとえば以下のような子クラスを作成する。</div>
</div>
<ul class="simple">
<li>業務エラー例外</li>
<li>入力エラー例外</li>
<li>リソース未検出エラー例外</li>
<li>排他エラー例外</li>
<li>認可エラー例外</li>
<li>システムエラー例外</li>
</ul>
<p>下記は、業務エラー例外の例である。</p>
<p><em>[server projectName]-webservice/src/main/java/com/example/ws/webfault/BusinessFaultException.java</em></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.ws.webfault</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.xml.ws.WebFault</span><span class="p">;</span>

<span class="nd">@WebFault</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;BusinessFault&quot;</span><span class="p">,</span> <span class="n">targetNamespace</span> <span class="o">=</span> <span class="s">&quot;http://example.com/todo&quot;</span><span class="p">)</span> <span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BusinessFaultException</span> <span class="kd">extends</span> <span class="n">WebFaultException</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="nf">BusinessFaultException</span><span class="p">(</span><span class="n">String</span> <span class="n">message</span><span class="p">,</span> <span class="n">WebFaultBean</span> <span class="n">faultInfo</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">faultInfo</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="nf">BusinessFaultException</span><span class="p">(</span><span class="n">String</span> <span class="n">message</span><span class="p">,</span> <span class="n">WebFaultBean</span> <span class="n">faultInfo</span><span class="p">,</span> <span class="n">Throwable</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">faultInfo</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">WebFaultException</span></code>を継承し、コンストラクタのみ作成する。</div>
<div class="line">フィールドやその他メソッドは親クラスのメソッドを使用するため記述不要である。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>発生する例外をSOAPFaultでラップする例外ハンドラー</strong></p>
<p>Serviceから発生する実行時例外をSOAPFaultでラップするために例外ハンドラークラスを作成する。
本ガイドラインではWebService実装クラスがこのハンドラーを用いて例外を変換してスローする方針とする。</p>
<p>Serviceからスローされる例外は以下を想定している。必要に応じて追加されたい。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="60%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">例外名</th>
<th class="head">内容</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.security.access.AccessDeniedException</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">認可エラー時の例外</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">javax.validation.ConstraintViolationException</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">入力チェックエラー時の例外</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.exception.ResourceNotFoundException</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">リソースが見つからない場合の例外</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.exception.BusinessException</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">業務例外</div>
</div>
</td>
</tr>
</tbody>
</table>
<p><em>[server projectName]-web/src/main/java/com/example/ws/exception/WsExceptionHandler.java</em></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.ws.exception</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.Iterator</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.ConstraintViolation</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.ConstraintViolationException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.Path</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.MessageSource</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.access.AccessDeniedException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.exception.BusinessException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.exception.ExceptionCodeResolver</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.exception.ExceptionLogger</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.exception.ResourceNotFoundException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.exception.SystemException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessage</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessages</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.example.ws.webfault.WebFaultBean</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.ws.webfault.WebFaultException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.ws.webfault.WebFaultType</span><span class="p">;</span>

<span class="nd">@Component</span>  <span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WsExceptionHandler</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="n">MessageSource</span> <span class="n">messageSource</span><span class="p">;</span> <span class="c1">// (2)</span>

    <span class="nd">@Autowired</span>
    <span class="n">ExceptionCodeResolver</span> <span class="n">exceptionCodeResolver</span><span class="p">;</span> <span class="c1">// (3)</span>

    <span class="nd">@Autowired</span>
    <span class="n">ExceptionLogger</span> <span class="n">exceptionLogger</span><span class="p">;</span> <span class="c1">// (4)</span>

    <span class="c1">// (5)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">translateException</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">WebFaultException</span> <span class="p">{</span>
        <span class="n">loggingException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
        <span class="n">WebFaultBean</span> <span class="n">faultInfo</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="k">instanceof</span> <span class="n">AccessDeniedException</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">faultInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WebFaultBean</span><span class="p">(</span><span class="n">WebFaultType</span><span class="p">.</span><span class="na">AccessDeniedFault</span><span class="p">);</span>
            <span class="n">faultInfo</span><span class="p">.</span><span class="na">addError</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getName</span><span class="p">(),</span> <span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="k">instanceof</span> <span class="n">ConstraintViolationException</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">faultInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WebFaultBean</span><span class="p">(</span><span class="n">WebFaultType</span><span class="p">.</span><span class="na">ValidationFault</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="na">addErrors</span><span class="p">(</span><span class="n">faultInfo</span><span class="p">,</span> <span class="p">((</span><span class="n">ConstraintViolationException</span><span class="p">)</span> <span class="n">e</span><span class="p">).</span><span class="na">getConstraintViolations</span><span class="p">());</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="k">instanceof</span> <span class="n">ResourceNotFoundException</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">faultInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WebFaultBean</span><span class="p">(</span><span class="n">WebFaultType</span><span class="p">.</span><span class="na">ResourceNotFoundFault</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="na">addErrors</span><span class="p">(</span><span class="n">faultInfo</span><span class="p">,</span> <span class="p">((</span><span class="n">ResourceNotFoundException</span><span class="p">)</span> <span class="n">e</span><span class="p">).</span><span class="na">getResultMessages</span><span class="p">());</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="k">instanceof</span> <span class="n">BusinessException</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">faultInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WebFaultBean</span><span class="p">(</span><span class="n">WebFaultType</span><span class="p">.</span><span class="na">BusinessFault</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="na">addErrors</span><span class="p">(</span><span class="n">faultInfo</span><span class="p">,</span> <span class="p">((</span><span class="n">BusinessException</span><span class="p">)</span> <span class="n">e</span><span class="p">).</span><span class="na">getResultMessages</span><span class="p">());</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// not translate.</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">SystemException</span><span class="p">(</span><span class="s">&quot;e.ex.fw.9001&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">throw</span> <span class="k">new</span> <span class="n">WebFaultException</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">(),</span> <span class="n">faultInfo</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="na">getCause</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">loggingException</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">exceptionLogger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">addErrors</span><span class="p">(</span><span class="n">WebFaultBean</span> <span class="n">faultInfo</span><span class="p">,</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">ConstraintViolation</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">constraintViolations</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">ConstraintViolation</span><span class="o">&lt;?&gt;</span> <span class="n">v</span> <span class="p">:</span> <span class="n">constraintViolations</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Path</span><span class="p">.</span><span class="na">Node</span><span class="o">&gt;</span> <span class="n">pathIt</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="na">getPropertyPath</span><span class="p">().</span><span class="na">iterator</span><span class="p">();</span>
            <span class="n">pathIt</span><span class="p">.</span><span class="na">next</span><span class="p">();</span> <span class="c1">// method name node (skip)</span>
            <span class="n">Path</span><span class="p">.</span><span class="na">Node</span> <span class="n">methodArgumentNameNode</span> <span class="o">=</span> <span class="n">pathIt</span><span class="p">.</span><span class="na">next</span><span class="p">();</span>
            <span class="n">faultInfo</span><span class="p">.</span><span class="na">addError</span><span class="p">(</span>
                <span class="n">v</span><span class="p">.</span><span class="na">getConstraintDescriptor</span><span class="p">().</span><span class="na">getAnnotation</span><span class="p">().</span><span class="na">annotationType</span><span class="p">().</span><span class="na">getSimpleName</span><span class="p">(),</span>
                <span class="n">v</span><span class="p">.</span><span class="na">getMessage</span><span class="p">(),</span>
                <span class="n">pathIt</span><span class="p">.</span><span class="na">hasNext</span><span class="p">()</span> <span class="o">?</span> <span class="n">pathIt</span><span class="p">.</span><span class="na">next</span><span class="p">().</span><span class="na">toString</span><span class="p">()</span> <span class="p">:</span> <span class="n">methodArgumentNameNode</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
        <span class="p">}</span>

    <span class="p">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">addErrors</span><span class="p">(</span><span class="n">WebFaultBean</span> <span class="n">faultInfo</span><span class="p">,</span> <span class="n">ResultMessages</span> <span class="n">resultMessages</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Locale</span> <span class="n">locale</span> <span class="o">=</span> <span class="n">Locale</span><span class="p">.</span><span class="na">getDefault</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">ResultMessage</span> <span class="n">message</span> <span class="p">:</span> <span class="n">resultMessages</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">faultInfo</span><span class="p">.</span><span class="na">addError</span><span class="p">(</span>
                <span class="n">message</span><span class="p">.</span><span class="na">getCode</span><span class="p">(),</span>
                <span class="n">messageSource</span><span class="p">.</span><span class="na">getMessage</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">getCode</span><span class="p">(),</span> <span class="n">message</span><span class="p">.</span><span class="na">getArgs</span><span class="p">(),</span> <span class="n">message</span><span class="p">.</span><span class="na">getText</span><span class="p">(),</span> <span class="n">locale</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">本クラスをDIコンテナに管理をさせるため、<code class="docutils literal"><span class="pre">&#64;Component</span></code>を付ける。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">出力するメッセージを取得するために<code class="docutils literal"><span class="pre">MessageSource</span></code>を使用する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">共通ライブラリが提供する<code class="docutils literal"><span class="pre">ExceptionCodeResolverMessageSource</span></code>を使用して例外の種類と例外コードをマッピングする。</div>
<div class="line">詳細は、「<a class="reference internal" href="../WebApplicationDetail/ExceptionHandling.html"><span class="doc">例外ハンドリング</span></a>」を参照されたい。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">共通ライブラリが提供する<code class="docutils literal"><span class="pre">ExceptionLogger</span></code>を使用して例外情報を例外に出力する。</div>
<div class="line">詳細は、「<a class="reference internal" href="../WebApplicationDetail/ExceptionHandling.html"><span class="doc">例外ハンドリング</span></a>」を参照されたい。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Serviceから発生しうる各例外について、<code class="docutils literal"><span class="pre">SOAPFault</span></code>へのラップを行う。</div>
<div class="line">例外のマッピングは冒頭の表を参考されたい。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>その他の例外の扱いについて</strong></p>
<p class="last">その他の例外発生時（上記の<code class="docutils literal"><span class="pre">translateException</span></code>メソッドのelse部分）では、クライアントでは詳細な例外の内容は通知されず、<code class="docutils literal"><span class="pre">com.sun.xml.internal.ws.fault.ServerSOAPFaultException</span></code>が発生するのみとなる。他の例外同様にラップしてクライアント側に通知することも可能である。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Serviceで発生した例外をWebサービス内から例外ハンドラーを呼び出し、ラップする</strong></p>
<p>Webサービスクラスにて、例外ハンドラーを呼び出す。以下はその例である。</p>
<p><em>[server projectName]-web/src/main/java/com/example/ws/todo/TodoWebServiceImpl.java</em></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@WebService</span><span class="p">(</span>
        <span class="n">portName</span> <span class="o">=</span> <span class="s">&quot;TodoWebPort&quot;</span><span class="p">,</span>
        <span class="n">serviceName</span> <span class="o">=</span> <span class="s">&quot;TodoWebService&quot;</span><span class="p">,</span>
        <span class="n">targetNamespace</span> <span class="o">=</span> <span class="s">&quot;http://example.com/todo&quot;</span><span class="p">,</span>
        <span class="n">endpointInterface</span> <span class="o">=</span> <span class="s">&quot;com.example.ws.todo.TodoWebService&quot;</span><span class="p">)</span>
<span class="nd">@BindingType</span><span class="p">(</span><span class="n">SOAPBinding</span><span class="p">.</span><span class="na">SOAP12HTTP_BINDING</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoWebServiceImpl</span> <span class="kd">extends</span> <span class="n">SpringBeanAutowiringSupport</span> <span class="kd">implements</span> <span class="n">TodoWebService</span> <span class="p">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">TodoService</span> <span class="n">todoService</span><span class="p">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">WsExceptionHandler</span> <span class="n">handler</span><span class="p">;</span> <span class="c1">// (1)</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Todo</span> <span class="nf">getTodo</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">WebFaultException</span> <span class="cm">/* (2) */</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">todoService</span><span class="p">.</span><span class="na">getTodo</span><span class="p">(</span><span class="n">todoId</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">RuntimeException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">handler</span><span class="p">.</span><span class="na">translateException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span> <span class="c1">// (3)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">例外ハンドラーをインジェクションする。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">WebFaultException</span></code>にラップしてスローするため、throws句を付ける。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">実行時例外が発生した場合は、例外ハンドラークラスに処理を委譲する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="mtom">
<h4><a class="toc-backref" href="#id36">5.3.2.1.7. MTOMを利用した大容量のバイナリデータを扱う方法</a><a class="headerlink" href="#mtom" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">SOAPでは、バイナリデータを扱う場合、Byte配列にマッピングすることで、送受信を行うことができる。</div>
<div class="line">ただし、大容量のバイナリデータを扱う場合、ヒープが枯渇するなどの問題が発生することがある。</div>
<div class="line">そこで、MTOM（Message Transmission Optimization Mechanism）に準拠した実装を行うことで、最適化した状態で添付ファイルとしてバイナリデータを扱うことができる。</div>
<div class="line">詳細な定義は <a class="reference external" href="https://www.w3.org/TR/soap12-mtom/">W3C -SOAP Message Transmission Optimization Mechanism-</a>を参照されたい。</div>
<div class="line">以下にその方法を記述する。</div>
</div>
<p><em>[server projectName]-webservice/src/main/java/com/example/ws/todo/TodoWebService.java</em></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.ws.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.activation.DataHandler</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.jws.WebMethod</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.jws.WebParam</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.jws.WebResult</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.jws.WebService</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.bind.annotation.XmlMimeType</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.ws.webfault.WebFaultException</span><span class="p">;</span>

<span class="nd">@WebService</span><span class="p">(</span><span class="n">targetNamespace</span> <span class="o">=</span> <span class="s">&quot;http://example.com/todo&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoWebService</span> <span class="p">{</span>

    <span class="c1">// omitted</span>

    <span class="nd">@WebMethod</span>
    <span class="kt">void</span> <span class="nf">uploadFile</span><span class="p">(</span><span class="nd">@XmlMimeType</span><span class="p">(</span><span class="s">&quot;application/octet-stream&quot;</span><span class="p">)</span> <span class="cm">/* (1) */</span> <span class="n">DataHandler</span> <span class="n">dataHandler</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">WebFaultException</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">バイナリデータを処理する<code class="docutils literal"><span class="pre">javax.activation.DataHandler</span></code>に対して<code class="docutils literal"><span class="pre">&#64;XmlMimeType</span></code>を付ける。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><em>[server projectName]-web/src/main/java/com/example/ws/todo/TodoWebServiceImpl.java</em></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.ws.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.activation.DataHandler</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.jws.HandlerChain</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.jws.WebService</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.ws.BindingType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.ws.soap.MTOM</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.ws.soap.SOAPBinding</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.context.support.SpringBeanAutowiringSupport</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.exception.SystemException</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.domain.service.TodoService</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.ws.webfault.WebFaultException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.ws.exception.WsExceptionHandler</span><span class="p">;</span>

<span class="c1">// (1)</span>
<span class="nd">@MTOM</span>
<span class="nd">@WebService</span><span class="p">(</span>
        <span class="n">portName</span> <span class="o">=</span> <span class="s">&quot;TodoWebPort&quot;</span><span class="p">,</span>
        <span class="n">serviceName</span> <span class="o">=</span> <span class="s">&quot;TodoWebService&quot;</span><span class="p">,</span>
        <span class="n">targetNamespace</span> <span class="o">=</span> <span class="s">&quot;http://example.com/todo&quot;</span><span class="p">,</span>
        <span class="n">endpointInterface</span> <span class="o">=</span> <span class="s">&quot;com.example.ws.todo.TodoWebService&quot;</span><span class="p">)</span>
<span class="nd">@BindingType</span><span class="p">(</span><span class="n">SOAPBinding</span><span class="p">.</span><span class="na">SOAP12HTTP_BINDING</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoWebServiceImpl</span> <span class="kd">extends</span> <span class="n">SpringBeanAutowiringSupport</span> <span class="kd">implements</span> <span class="n">TodoWebService</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="n">TodoService</span> <span class="n">todoService</span><span class="p">;</span>

    <span class="c1">// omitted</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">uploadFile</span><span class="p">(</span><span class="n">DataHandler</span> <span class="n">dataHandler</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">WebFaultException</span> <span class="p">{</span>

        <span class="k">try</span> <span class="p">(</span><span class="n">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="n">dataHandler</span><span class="p">.</span><span class="na">getInputStream</span><span class="p">()){</span> <span class="c1">// (2)</span>
            <span class="n">todoService</span><span class="p">.</span><span class="na">uploadFile</span><span class="p">(</span><span class="n">inputStream</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">handler</span><span class="p">.</span><span class="na">translateException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">&#64;MTOM</span></code>を付けて、MTOMに準拠した実装を使用することを宣言する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">javax.activation.DataHandler</span></code>から<code class="docutils literal"><span class="pre">java.io.InputStream</span></code>を取得してファイルを扱う。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id9">
<h3><a class="toc-backref" href="#id37">5.3.2.2. クライアントの作成</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id10">
<h4><a class="toc-backref" href="#id38">5.3.2.2.1. プロジェクトの構成</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<p>「<a class="reference internal" href="#soapoverviewaboutrestfulwebservicedevelopment"><span class="std std-ref">JAX-WSを利用したWebサービスの開発について</span></a>」で述べたとおり、modelプロジェクトとwebserviceプロジェクトをSOAPサーバから受領する前提である。</p>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/SOAPClientProjects.png"><img alt="Client Projects for SOAP" src="../../_images/SOAPClientProjects.png" style="width: 80%;" /></a>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="30%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">プロジェクト名</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">webプロジェクト</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Controllerを作成する。</div>
<div class="line">通常の画面遷移時のControllerと特に変更点はない。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">domainプロジェクト</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Serviceクラスからwebserviceプロジェクトで用意されたWebServeインターフェースを使用してWebサービスを呼び出す。</div>
<div class="line">SOAPサーバと通信する際に使用するWebServiceインターフェースを実装したプロキシを定義する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">webserviceプロジェクト</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">SOAPサーバと同じ資材を配置する。</div>
<div class="line">クライアントはこのインターフェースを使用してWebサービスを実行する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">modelプロジェクト</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">SOAPサーバと同じ資材を配置する。</div>
<div class="line">SOAPサーバに渡す入力値や返却結果はこのプロジェクト内のクラスを使用する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">envプロジェクト</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">domainプロジェクトで定義したプロキシの環境依存する値を定義する。</div>
<div class="line">プロキシの定義から環境依存する値をプロパティファイルに集約し、プロパティファイルのみenvプロジェクトに配置する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>プロキシの定義ついて</strong></p>
<p>試験用SOAPサーバ、本番用SOAPサーバ等、複数環境向けのプロキシを定義する際に発生する重複部分を排除し、管理を容易にするために、当ガイドラインではプロキシの定義はdomainプロジェクトで行い、環境依存する値はプロパティファイルに集約、プロパティファイルのみenvプロジェクトに配置することを推奨する。</p>
<p class="last">ユニットテストでプロキシのスタブやモックを使用する場合は、ユニットテスト用のコンポーネントを定義するためのBean定義ファイル(test-context.xml)にBeanを定義する。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="soaphowtousewebserviceclient">
<span id="id11"></span><h4><a class="toc-backref" href="#id39">5.3.2.2.2. Webサービス クライアントの実装</a><a class="headerlink" href="#soaphowtousewebserviceclient" title="Permalink to this headline">¶</a></h4>
<p>以下のクラスの実装を行う。</p>
<ul class="simple">
<li>WebServiceインターフェースを実装したプロキシの定義</li>
<li>ServiceクラスからWebServiceインターフェース経由でWebサービスを呼び出す。</li>
</ul>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/SOAPClientClass.png"><img alt="Server Projects for SOAP" src="../../_images/SOAPClientClass.png" style="width: 80%;" /></a>
</div>
<p><strong>WebServiceインターフェースを実装したプロキシの作成</strong></p>
<p>WebServiceインターフェースを実装したプロキシを生成する<code class="docutils literal"><span class="pre">org.springframework.remoting.jaxws.JaxWsPortProxyFactoryBean</span></code>の定義を行う。</p>
<p><em>[client projectName]-domain/src/main/resources/META-INF/spring/[client projectName]-domain.xml</em></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;todoWebService&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.springframework.remoting.jaxws.JaxWsPortProxyFactoryBean&quot;</span><span class="nt">&gt;</span><span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;serviceInterface&quot;</span> <span class="na">value=</span><span class="s">&quot;com.example.ws.todo.TodoWebService&quot;</span> <span class="nt">/&gt;</span><span class="c">&lt;!-- (2) --&gt;</span>
    <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;serviceName&quot;</span> <span class="na">value=</span><span class="s">&quot;TodoWebService&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;portName&quot;</span> <span class="na">value=</span><span class="s">&quot;TodoWebPort&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;namespaceUri&quot;</span> <span class="na">value=</span><span class="s">&quot;http://example.com/todo&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;wsdlDocumentResource&quot;</span> <span class="na">value=</span><span class="s">&quot;${webservice.todoWebService.wsdlDocumentResource}&quot;</span> <span class="nt">/&gt;</span><span class="c">&lt;!-- (4) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;lookupServiceOnStartup&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span><span class="c">&lt;!-- (5) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<p><em>[client projectName]-env/src/main/resources/META-INF/spring/[client projectName]-infra.properties</em></p>
<div class="highlight-properties"><div class="highlight"><pre><span></span><span class="c"># (6)</span>
<span class="na">webservice.todoWebService.wsdlDocumentResource</span><span class="o">=</span><span class="s">http://AAA.BBB.CCC.DDD:XXXX/[server projectName]-web/ws/TodoWebService?wsdl</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.remoting.jaxws.JaxWsPortProxyFactoryBean</span></code>を定義する。このクラスが生成するプロキシを経由してSOAPサーバにアクセスできる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">serviceInterface</span></code>プロパティに本来このWebサービスが実装すべきインターフェースを定義する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">serviceName</span></code>、<code class="docutils literal"><span class="pre">portName</span></code>、<code class="docutils literal"><span class="pre">namespaceUri</span></code>プロパティにそれぞれSOAPサーバ側で定義している同じ内容を定義する必要がある。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">wsdlDocumentResource</span></code>プロパティに公開されているWDSLのURLを設定する。</div>
<div class="line">ここでは後述するプロパティファイルにURLを記述するため、プロパティのキーを指定している。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">lookupServiceOnStartup</span></code>プロパティにBean生成する時、SOAPサーバからWSDLファイルを取得するかどうかを設定する。falseの場合はBeanが初めて使用されるタイミングでWSDLファイルの取得が行われる。</div>
<div class="line">SOAPサーバからWSDLファイルの取得が不可能な場合でもWebサービス クライアントを起動させるために、<code class="docutils literal"><span class="pre">lookupServiceOnStartup</span></code>プロパティに<code class="docutils literal"><span class="pre">false</span></code>を指定することを推奨する。ただし、WSDLファイルをWebサービス クライアントで保持している場合は設定不要である。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line"><code class="docutils literal"><span class="pre">[client</span> <span class="pre">projectName]-domain.xml</span></code>で定義したプロパティのキーの値を設定する。WSDLのURLを記述する。</div>
</div>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p><strong>wsdlDocumentResourceへのWSDLファイルのURL以外の指定</strong></p>
<p class="last">上記の例では、SOAPサーバがWSDLファイルを公開している前提である。<code class="docutils literal"><span class="pre">classpath:</span></code>や<code class="docutils literal"><span class="pre">file:</span></code>プレフィックスを使用して指定することで静的ファイルを指定することもできる。指定できる文字列は、<a class="reference external" href="https://docs.spring.io/spring-framework/docs/5.3.24/reference/html/core.html#resources-resourceloader">Spring Framework Documentation -The ResourceLoader-</a>を参照されたい。</p>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>エンドポイントアドレスの上書き指定</strong></p>
<p>WSDLファイルには、Webサービス実行時のアクセスURL（エンドポイントアドレス）が記述されているため、クライアントではアクセスURLの設定は不要である。
ただし、WSDLファイルに記述されているURLではないURLにアクセスする場合、<code class="docutils literal"><span class="pre">org.springframework.remoting.jaxws.JaxWsPortProxyFactoryBean</span></code>の<code class="docutils literal"><span class="pre">endpointAddress</span></code>プロパティを設定することで上書きすることができる。
テストなどで、環境を切り替える場合に使用するとよい。
以下はその設定例である。</p>
<p><em>[client projectName]-domain/src/main/resources/META-INF/spring/[client projectName]-domain.xml</em></p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;todoWebService&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.springframework.remoting.jaxws.JaxWsPortProxyFactoryBean&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;serviceInterface&quot;</span> <span class="na">value=</span><span class="s">&quot;com.example.ws.todo.TodoWebService&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;serviceName&quot;</span> <span class="na">value=</span><span class="s">&quot;TodoWebService&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;portName&quot;</span> <span class="na">value=</span><span class="s">&quot;TodoWebPort&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;namespaceUri&quot;</span> <span class="na">value=</span><span class="s">&quot;http://example.com/todo&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;wsdlDocumentResource&quot;</span> <span class="na">value=</span><span class="s">&quot;${webservice.todoWebService.wsdlDocumentResource}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;endpointAddress&quot;</span> <span class="na">value=</span><span class="s">&quot;${webservice.todoWebService.endpointAddress}&quot;</span> <span class="nt">/&gt;</span><span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;lookupServiceOnStartup&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p><em>[client projectName]-env/src/main/resources/META-INF/spring/[client projectName]-infra.properties</em></p>
<blockquote class="last">
<div><div class="highlight-properties"><div class="highlight"><pre><span></span><span class="c"># (2)</span>
<span class="na">webservice.todoWebService.endpointAddress</span><span class="o">=</span><span class="s">http://AAA.BBB.CCC.DDD:XXXX/[server projectName]-web/ws/TodoWebService</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">エンドポイントアドレスを設定する。</div>
<div class="line">ここでは後述するプロパティファイルにURLを記述するため、プロパティのキーを指定している。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">[client</span> <span class="pre">projectName]-domain.xml</span></code>で定義したプロパティのキーの値を設定する。エンドポイントアドレスを記述する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>ServiceからWebサービスを呼び出す</strong></p>
<p>上記で作成したWebサービスをServiceでインジェクションして実行する。</p>
<p><em>[client projectName]-domain/src/main/java/com/example/domain/service/todo/TodoServiceImpl.java</em></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.soap.domain.service.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.ws.webfault.WebFaultException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.ws.todo.TodoWebService</span><span class="p">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoServiceImpl</span> <span class="kd">implements</span> <span class="n">TodoService</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="n">TodoWebService</span> <span class="n">todoWebService</span><span class="p">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">createTodo</span><span class="p">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// (1)</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">todoWebService</span><span class="p">.</span><span class="na">createTodo</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">WebFaultException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// (2)</span>
            <span class="c1">// handle exception…</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">TodoWebService</span></code>をインジェクションして、実行対象のServiceを呼び出す。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">サーバ側で、例外が発生した場合は、<code class="docutils literal"><span class="pre">WebFaultException</span></code>にラップされて送信される。</div>
<div class="line">内容に応じて処理を行う。</div>
<div class="line">例外処理の詳細は「<a class="reference internal" href="#soaphowtouseexceptionhandler"><span class="std std-ref">例外ハンドリングの実装</span></a>」を参照されたい。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>レスポンスの情報取得</strong></p>
<p>リトライを考慮するなど、レスポンスの情報をクライアントで取得したい場合、以下のように<code class="docutils literal"><span class="pre">javax.xml.ws.BindingProvider</span></code>クラスにキャストすることで取得できる。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">BindingProvider</span> <span class="n">provider</span> <span class="o">=</span> <span class="p">(</span><span class="n">BindingProvider</span><span class="p">)</span> <span class="n">todoWebService</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">provider</span><span class="p">.</span><span class="na">getResponseContext</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="n">MessageContext</span><span class="p">.</span><span class="na">HTTP_RESPONSE_CODE</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">BindingProvider</span></code>の詳細については <a class="reference external" href="https://download.oracle.com/otn-pub/jcp/jaxws-2.2-mrel3-evalu-oth-JSpec/jaxws-2_2-mrel3-spec.pdf">The Java API for XML-Based Web Services(JAX-WS) 2.2 -4.2 javax.xml.ws.BindingProvider-</a>を参照されたい。</p>
<p>ただし、クライアントの依存関係にApatch CXFライブラリが含まれる場合、通信エラー時に上記の方法でレスポンスの情報を取得することができない。
これは、依存関係にApatch CXFライブラリが含まれる場合は自動的にApatch CXFのプロキシが使用されるため、およびApache CXFのプロキシは通信エラーが発生した場合にレスポンスの情報をレスポンスコンテキストに保持しないためである。
Apache CXFのエラー処理については<a class="reference external" href="https://cxf.apache.org/docs/cxf-architecture.html#CXFArchitecture-FaultHandling">Apache CXF Software Architecture Guide -Fault Handling-</a>を参照されたい。</p>
<p class="last">Webサービスと別のWebサービスへのクライアントを持つ中継サービスのように、どうしてもクライアントにApache CXFライブラリの依存関係を含んでしまう場合は制限事項として注意されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id12">
<h4><a class="toc-backref" href="#id40">5.3.2.2.3. セキュリティ対策</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<p><strong>認証処理</strong></p>
<p><code class="docutils literal"><span class="pre">org.springframework.remoting.jaxws.JaxWsPortProxyFactoryBean</span></code>を使用している場合でBasic認証を使用しているSOAPサーバと通信をする場合には、bean定義にユーザ名とパスワードを追加するだけで認証を行うことができる。</p>
<p><em>[client projectName]-domain/src/main/resources/META-INF/spring/[client projectName]-domain.xml</em></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;todoWebService&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.springframework.remoting.jaxws.JaxWsPortProxyFactoryBean&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;serviceInterface&quot;</span> <span class="na">value=</span><span class="s">&quot;com.example.ws.todo.TodoWebService&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;serviceName&quot;</span> <span class="na">value=</span><span class="s">&quot;TodoWebService&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;portName&quot;</span> <span class="na">value=</span><span class="s">&quot;TodoWebPort&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;namespaceUri&quot;</span> <span class="na">value=</span><span class="s">&quot;http://example.com/todo&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;wsdlDocumentResource&quot;</span> <span class="na">value=</span><span class="s">&quot;${webservice.todoWebService.wsdlDocumentResource}&quot;</span> <span class="nt">/&gt;</span>
<span class="hll">    <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span> <span class="na">value=</span><span class="s">&quot;${webservice.todoWebService.username}&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">value=</span><span class="s">&quot;${webservice.todoWebService.password}&quot;</span> <span class="nt">/&gt;</span>
</span><span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<p><em>[client projectName]-env/src/main/resources/META-INF/spring/[client projectName]-infra.properties</em></p>
<div class="highlight-properties"><div class="highlight"><pre><span></span><span class="c"># (2)</span>
<span class="na">webservice.todoWebService.username</span><span class="o">=</span><span class="s">testuser</span>
<span class="na">webservice.todoWebService.password</span><span class="o">=</span><span class="s">password</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.remoting.jaxws.JaxWsPortProxyFactoryBean</span></code>のbean定義にusernameとpasswordを加えることでBasic認証における、認証情報を送信することができる。</div>
<div class="line">ユーザ名とパスワードをプロパティファイルに切り出した場合のサンプルである。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">[client</span> <span class="pre">projectName]-domain.xml</span></code>で定義したプロパティのキーの値を設定する。認証に使用するユーザ名とパスワードを記述する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="soaphowtouseexceptionhandler">
<span id="id13"></span><h4><a class="toc-backref" href="#id41">5.3.2.2.4. 例外ハンドリングの実装</a><a class="headerlink" href="#soaphowtouseexceptionhandler" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">SOAPサーバでは、<code class="docutils literal"><span class="pre">WebFaultException</span></code>に例外をラップして、スローすることを推奨している。</div>
<div class="line">クライアントは<code class="docutils literal"><span class="pre">WebFaultException</span></code>をキャッチして、その原因例外を判定してそれぞれの処理を行う。</div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">createTodo</span><span class="p">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">try</span> <span class="p">{</span>
        <span class="c1">// (1)</span>
        <span class="n">todoWebService</span><span class="p">.</span><span class="na">createTodo</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">WebFaultException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">        <span class="c1">// (2)</span>
</span><span class="hll">        <span class="k">switch</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getFaultInfo</span><span class="p">().</span><span class="na">getType</span><span class="p">())</span> <span class="p">{</span>
</span><span class="hll">        <span class="k">case</span> <span class="n">ValidationFault</span><span class="p">:</span>
</span><span class="hll">            <span class="c1">// handle exception…</span>
</span><span class="hll">            <span class="k">break</span><span class="p">;</span>
</span><span class="hll">        <span class="k">case</span> <span class="n">BusinessFault</span><span class="p">:</span>
</span><span class="hll">            <span class="c1">// handle exception…</span>
</span><span class="hll">            <span class="k">break</span><span class="p">;</span>
</span><span class="hll">        <span class="k">default</span><span class="p">:</span>
</span><span class="hll">            <span class="c1">// handle exception…</span>
</span><span class="hll">            <span class="k">break</span><span class="p">;</span>
</span><span class="hll">        <span class="p">}</span>
</span>    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Webサービスを呼び出す。throwsがついているため、<code class="docutils literal"><span class="pre">WebFaultException</span></code>をキャッチする必要がある。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">faultInfo</span></code>の種別で例外を判定し、それぞれの処理を記述する（画面にメッセージを出す、例外をスローするなど）</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id14">
<h4><a class="toc-backref" href="#id42">5.3.2.2.5. タイムアウトの設定</a><a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<p>クライアントで指定できるタイムアウトは大きく以下の2つがある。</p>
<ul class="simple">
<li>SOAPサーバとのコネクションタイムアウト</li>
<li>SOAPサーバへのリクエストタイムアウト</li>
</ul>
<div class="line-block">
<div class="line">どちらの設定も、<code class="docutils literal"><span class="pre">org.springframework.remoting.jaxws.JaxWsPortProxyFactoryBean</span></code>のカスタムプロパティに指定する必要がある。</div>
<div class="line">設定の方法は以下の通りである。</div>
</div>
<p><em>[client projectName]-domain/src/main/resources/META-INF/spring/[client projectName]-domain.xml</em></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;todoWebService&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.springframework.remoting.jaxws.JaxWsPortProxyFactoryBean&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;serviceInterface&quot;</span> <span class="na">value=</span><span class="s">&quot;com.example.ws.todo.TodoWebService&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;serviceName&quot;</span> <span class="na">value=</span><span class="s">&quot;TodoWebService&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;portName&quot;</span> <span class="na">value=</span><span class="s">&quot;TodoWebPort&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;namespaceUri&quot;</span> <span class="na">value=</span><span class="s">&quot;http://example.com/todo&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;wsdlDocumentResource&quot;</span> <span class="na">value=</span><span class="s">&quot;${webservice.todoWebService.wsdlDocumentResource}&quot;</span> <span class="nt">/&gt;</span>
<span class="hll">    <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;customProperties&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">        <span class="nt">&lt;map&gt;</span>
</span><span class="hll">            <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;com.sun.xml.internal.ws.connect.timeout&quot;</span> <span class="na">value=</span><span class="s">&quot;${webservice.connect.timeout}&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;com.sun.xml.internal.ws.request.timeout&quot;</span> <span class="na">value=</span><span class="s">&quot;${webservice.request.timeout}&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/map&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/property&gt;</span>
</span><span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<p><em>[client projectName]-env/src/main/resources/META-INF/spring/[client projectName]-infra.properties</em></p>
<div class="highlight-properties"><div class="highlight"><pre><span></span><span class="c"># (3)</span>
<span class="na">webservice.request.timeout</span><span class="o">=</span><span class="s">3000</span>
<span class="na">webservice.connect.timeout</span><span class="o">=</span><span class="s">3000</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">customProperties</span></code>プロパティにMapを指定することでカスタムプロパティを定義する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">コネクションタイムアウトとリクエストタイムアウトを定義する。</div>
<div class="line">それぞれの値をプロパティファイルに切り出した場合のサンプルである。</div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>タイムアウト定義に使用するキーについて</strong></p>
<p class="last">それぞれのタイムアウトを定義するキーはJAX-WSの実装により異なる値を設定する必要がある。
詳細は<a class="reference external" href="https://github.com/javaee/metro-jax-ws/issues/1166">JAX_WS-1166 Standardize timeout settings</a>を参照されたい。</p>
</div>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p>WebLogicで該当キーを指定する場合は、<code class="docutils literal"><span class="pre">value-type</span></code>属性で<code class="docutils literal"><span class="pre">Integer</span></code>型を指定する必要がある。</p>
<p>指定をしない場合、WebLogicのJAX-WS実装ライブラリが
<code class="docutils literal"><span class="pre">String</span></code>型から<code class="docutils literal"><span class="pre">Integer</span></code>型へのキャストを試みて失敗し、結果的に<code class="docutils literal"><span class="pre">ClassCastException</span></code>が原因の<code class="docutils literal"><span class="pre">org.springframework.remoting.RemoteAccessException</span></code>例外が発生する。</p>
<p>設定の方法は以下のとおりである。</p>
<blockquote class="last">
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;customProperties&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;map&gt;</span>
        <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;com.sun.xml.internal.ws.connect.timeout&quot;</span> <span class="na">value-type=</span><span class="s">&quot;java.lang.Integer&quot;</span> <span class="na">value=</span><span class="s">&quot;${webservice.connect.timeout}&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;com.sun.xml.internal.ws.request.timeout&quot;</span> <span class="na">value-type=</span><span class="s">&quot;java.lang.Integer&quot;</span> <span class="na">value=</span><span class="s">&quot;${webservice.request.timeout}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/map&gt;</span>
<span class="nt">&lt;/property&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">[client</span> <span class="pre">projectName]-domain.xml</span></code>で定義したプロパティのキーの値を設定する。コネクションタイムアウトとリクエストタイムアウトを記述する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="appendix">
<h2><a class="toc-backref" href="#id43">5.3.3. Appendix</a><a class="headerlink" href="#appendix" title="Permalink to this headline">¶</a></h2>
<div class="section" id="soapappendixaddproject">
<span id="id15"></span><h3><a class="toc-backref" href="#id44">5.3.3.1. SOAPサーバ用にプロジェクトの設定を変更する</a><a class="headerlink" href="#soapappendixaddproject" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">SOAPサーバを作成する場合、ブランクプロジェクトにmodelプロジェクトとwebserviceプロジェクトを追加することを推奨する。</div>
<div class="line">以下にその方法を記述する。</div>
</div>
<div class="line-block">
<div class="line">ブランクプロジェクトの初期状態は以下の構成になっている。</div>
<div class="line">なお、artifactIdにはブランクプロジェクト作成時に指定したartifactIdが設定される。</div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">artifactId</span>
<span class="go">├── pom.xml</span>
<span class="go">├── artifactId-domain</span>
<span class="go">├── artifactId-env</span>
<span class="go">├── artifactId-initdb</span>
<span class="go">├── artifactId-selenium</span>
<span class="go">└── artifactId-web</span>
</pre></div>
</div>
<p>以下のようなプロジェクト構成にする。</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">artifactId</span>
<span class="go">├── pom.xml</span>
<span class="go">├── artifactId-domain</span>
<span class="go">├── artifactId-env</span>
<span class="go">├── artifactId-initdb</span>
<span class="go">├── artifactId-selenium</span>
<span class="go">├── artifactId-web</span>
<span class="go">├── artifactId-model</span>
<span class="go">└── artifactId-webservice</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="id16">
<h4><a class="toc-backref" href="#id45">5.3.3.1.1. 既存プロジェクトの変更</a><a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">ブランクプロジェクトの初期状態では、ControllerなどWebアプリケーションの簡易実装が含まれている。</div>
<div class="line">そのままにしてもSOAP Web Serviceは実現可能だが、不要であるため、削除することを推奨する。</div>
<div class="line">削除対象は、「<a class="reference internal" href="../../ImplementationAtEachLayer/CreateWebApplicationProject.html"><span class="doc">Webアプリケーション向け開発プロジェクトの作成</span></a> の <a class="reference internal" href="../../ImplementationAtEachLayer/CreateWebApplicationProject.html#createwebapplicationprojectconfigurationmulti"><span class="std std-ref">マルチプロジェクトの構成</span></a>」を参照されたい。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="model">
<h4><a class="toc-backref" href="#id46">5.3.3.1.2. modelプロジェクトの作成</a><a class="headerlink" href="#model" title="Permalink to this headline">¶</a></h4>
<p>modelプロジェクトの構成について説明する。</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">artifactId-model</span>
<span class="go">    ├── pom.xml  ... (1)</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">項番</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">説明</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p class="first">modelモジュールの構成を定義するPOM(Project Object Model)ファイル。
このファイルでは、以下の定義を行う。</p>
<ul class="last simple">
<li>依存ライブラリとビルド用プラグインの定義</li>
<li>jarファイルを作成するための定義</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">pom.xml</span></code>は以下のようなイメージになる。必要に応じて編集する必要がある。</div>
<div class="line">実際には、「artifactId」と「groupId」はブランクプロジェクト作成時に指定した値を設定する必要がある。</div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>artifactId-model<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>groupId<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>artifactId<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;relativePath&gt;</span>../pom.xml<span class="nt">&lt;/relativePath&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
        <span class="c">&lt;!-- == Begin TERASOLUNA == --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.terasoluna.gfw<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>terasoluna-gfw-common-dependencies<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.terasoluna.gfw<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>terasoluna-gfw-jodatime-dependencies<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.terasoluna.gfw<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>terasoluna-gfw-security-core-dependencies<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.terasoluna.gfw<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>terasoluna-gfw-recommended-dependencies<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- == End TERASOLUNA == --&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="webservice">
<h4><a class="toc-backref" href="#id47">5.3.3.1.3. webserviceプロジェクトの作成</a><a class="headerlink" href="#webservice" title="Permalink to this headline">¶</a></h4>
<p>webserviceプロジェクトの構成について説明する。</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">artifactId-webservice</span>
<span class="go">    ├── pom.xml  ... (1)</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">項番</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">説明</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p class="first">webserviceモジュールの構成を定義するPOM(Project Object Model)ファイル。
このファイルでは、以下の定義を行う。</p>
<ul class="last simple">
<li>依存ライブラリとビルド用プラグインの定義</li>
<li>jarファイルを作成するための定義</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">pom.xml</span></code>は以下のようなイメージになる。必要に応じて編集する必要がある。</div>
<div class="line">実際には、「artifactId」と「groupId」はブランクプロジェクト作成時に指定した値を設定する必要がある。</div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>artifactId-webservice<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>groupId<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>artifactId<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;relativePath&gt;</span>../pom.xml<span class="nt">&lt;/relativePath&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>${project.groupId}<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>artifactId-model<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- == Begin TERASOLUNA == --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.terasoluna.gfw<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>terasoluna-gfw-common-dependencies<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.terasoluna.gfw<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>terasoluna-gfw-jodatime-dependencies<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.terasoluna.gfw<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>terasoluna-gfw-security-core-dependencies<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.terasoluna.gfw<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>terasoluna-gfw-recommended-dependencies<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- == End TERASOLUNA == --&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">webserviceプロジェクトのコンパイルのためにJAX-WS APIが必要となる。
Java SE 11環境にてJAX-WS APIを使用するには<a class="reference internal" href="../../Appendix/Java11Changes.html#remove-jax-ws-from-java11"><span class="std std-ref">JAX-WSの削除</span></a>を参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="soapappendixpackageserver">
<span id="id17"></span><h3><a class="toc-backref" href="#id48">5.3.3.2. SOAPサーバのパッケージ構成</a><a class="headerlink" href="#soapappendixpackageserver" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">SOAPサーバを作成するときの推奨する構成について、説明する。</div>
<div class="line">ガイドラインに従いプロジェクトを追加すると以下の構成となる。</div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">プロジェクト名</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">[server projectName]-domain</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">SOAPサーバのドメイン層に関するクラス・設定ファイルを格納するプロジェクト</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">[server projectName]-web</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">SOAPサーバのアプリケーション層に関するクラス・設定ファイルを格納するプロジェクト</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">[server projectName]-env</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">SOAPサーバの環境に依存するファイル等を格納するプロジェクト</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">[server projectName]-model</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">SOAPサーバのドメイン層に関するクラスの中で、Webサービス実行時に使用し、クライアントと共有するクラスを格納するプロジェクト</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">[server projectName]-webservice</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">SOAPサーバが提供するWebサービスのインターフェースを格納するプロジェクト</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="server-projectname-domain">
<h4><a class="toc-backref" href="#id49">5.3.3.2.1. [server projectName]-domain</a><a class="headerlink" href="#server-projectname-domain" title="Permalink to this headline">¶</a></h4>
<p>[server projectName]-modelの依存関係を追加するため、<code class="docutils literal"><span class="pre">pom.xml</span></code>に以下を追加する。</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>${project.groupId}<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>artifactId-model<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<p>その他のパッケージ構成は、通常のdomainプロジェクトと変わらないため、「<a class="reference internal" href="../../Overview/ApplicationLayering.html"><span class="doc">アプリケーションのレイヤ化</span></a> の <a class="reference internal" href="../../Overview/ApplicationLayering.html#application-layering-project-structure"><span class="std std-ref">プロジェクト構成</span></a>」を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="server-projectname-web">
<h4><a class="toc-backref" href="#id50">5.3.3.2.2. [server projectName]-web</a><a class="headerlink" href="#server-projectname-web" title="Permalink to this headline">¶</a></h4>
<p>[server projectName]-webserviceの依存関係を追加するため、<code class="docutils literal"><span class="pre">pom.xml</span></code>に以下を追加する。</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>${project.groupId}<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>artifactId-webservice<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>依存性の解決について</strong></p>
<p class="last">[server projectName]-modelの依存関係の定義は不要である。これは[server projectName]-webserviceから[server projectName]-modelへの依存関係が定義されているため、推移的に依存関係が追加されるためである。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>JAX-WSでは、XML電文のシリアライズにJAXBを利用しており、アプリケーションの実行にはJAXBがクラスパスに登録されている必要がある。
Java SE 11環境にてJAXBをクラスパスに登録するには<a class="reference internal" href="../../Appendix/Java11Changes.html#remove-jaxb-from-java11"><span class="std std-ref">JAXBの削除</span></a>を参照されたい。</p>
<p class="last">なお、「<a class="reference internal" href="#soapappendixtomcatwebservice"><span class="std std-ref">Tomcat上でのWebサービス開発</span></a>」で解説するApache CXFを利用する場合は、JAXBが自動的に依存関係に追加されることを確認している。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>[server projectName]-webのプロジェクト推奨構成を、以下に示す。</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">[server projectName]-web</span>
<span class="go">  └src</span>
<span class="go">      └main</span>
<span class="go">          ├java</span>
<span class="go">          │  └com</span>
<span class="go">          │      └example</span>
<span class="go">          │          ├app...(1)</span>
<span class="go">          │          └ws...(2)</span>
<span class="go">          │            ├exception...(3)</span>
<span class="go">          │            │  └WsExceptionHandler.java</span>
<span class="go">          │            ├abc</span>
<span class="go">          │            │  └AbcWebServiceImpl.java</span>
<span class="go">          │            └def</span>
<span class="go">          │                └DefWebServiceImpl.java</span>
<span class="go">          ├resources</span>
<span class="go">          │  ├META-INF</span>
<span class="go">          │  │  └spring</span>
<span class="go">          │  │      ├applicationContext.xml...(4)</span>
<span class="go">          │  │      ├application.properties...(5)</span>
<span class="go">          │  │      ├spring-mvc.xml ...(6)</span>
<span class="go">          │  │      ├spring-security.xml...(7)</span>
<span class="go">          │  │      └[server projectName]-ws.xml...(8)</span>
<span class="go">          │  └i18n</span>
<span class="go">          │      └application-messages.properties...(9)</span>
<span class="go">          └webapp</span>
<span class="go">              ├resources...(10)</span>
<span class="go">              └WEB-INF</span>
<span class="go">                  ├views ...(11)</span>
<span class="go">                  └web.xml...(12)</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">アプリケーション層の構成要素を格納するパッケージ。</div>
<div class="line">Webサービスのみ作成する場合は削除してもよい。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Webサービスの関連クラスを格納するパッケージ。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Webサービスの例外ハンドラーなどを格納するパッケージ。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">アプリケーション全体に関するBean定義を行う。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">アプリケーションで使用するプロパティを定義する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Spring MVCの設定を行うBean定義を行う。</div>
<div class="line">Webサービスのみ作成する場合は削除してもよい。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Spring Securityの設定を行うBean定義を行う。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Webサービスに関するBean定義を行う。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">画面表示用のメッセージ(国際化対応)定義を行う。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">静的リソース(css、js、画像など)を格納する。</div>
<div class="line">Webサービスのみ作成する場合は削除してもよい。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(11)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">View(jsp)を格納する。</div>
<div class="line">Webサービスのみ作成する場合は削除してもよい。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(12)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Servletのデプロイメント定義を行う。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>SOAPサーバの不要なファイル</strong></p>
<p class="last">SOAPサーバで、Webサービスのみを作成する場合、ブランクプロジェクトに存在するSpring MVCの設定ファイルなどは不要となるため、削除したほうが望ましい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="server-projectname-env">
<h4><a class="toc-backref" href="#id51">5.3.3.2.3. [server projectName]-env</a><a class="headerlink" href="#server-projectname-env" title="Permalink to this headline">¶</a></h4>
<p>[server projectName]-envについては、通常のenvプロジェクトと変わらないため、「<a class="reference internal" href="../../Overview/ApplicationLayering.html"><span class="doc">アプリケーションのレイヤ化</span></a> の <a class="reference internal" href="../../Overview/ApplicationLayering.html#application-layering-project-structure"><span class="std std-ref">プロジェクト構成</span></a>」を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="server-projectname-model">
<h4><a class="toc-backref" href="#id52">5.3.3.2.4. [server projectName]-model</a><a class="headerlink" href="#server-projectname-model" title="Permalink to this headline">¶</a></h4>
<p>[server projectName]-modelのプロジェクト推奨構成を、以下に示す。</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">[server projectName]-model</span>
<span class="go">  └src</span>
<span class="go">      └main</span>
<span class="go">          └java</span>
<span class="go">              └com</span>
<span class="go">                  └example</span>
<span class="go">                      └domain ...(1)</span>
<span class="go">                          └model ...(2)</span>
<span class="go">                              ├Xxx.java</span>
<span class="go">                              ├Yyy.java</span>
<span class="go">                              └Zzz.java</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ドメイン層の構成要素を格納するパッケージ。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Domain Objectの中でWebサービス実行時に使用するクラスを格納するパッケージ。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="server-projectname-webservice">
<h4><a class="toc-backref" href="#id53">5.3.3.2.5. [server projectName]-webservice</a><a class="headerlink" href="#server-projectname-webservice" title="Permalink to this headline">¶</a></h4>
<p>[server projectName]-webserviceのプロジェクト推奨構成を、以下に示す。</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">[server projectName]-webservice</span>
<span class="go">  └src</span>
<span class="go">      └main</span>
<span class="go">          └java</span>
<span class="go">              └com</span>
<span class="go">                  └example</span>
<span class="go">                      └ws...(1)</span>
<span class="go">                        ├webfault...(2)</span>
<span class="go">                        ├abc</span>
<span class="go">                        │  └AbcWebService.java</span>
<span class="go">                        └def</span>
<span class="go">                            └DefWebService.java</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Webサービスのインターフェースを格納するパッケージ。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Webサービスのwebfaultを格納するパッケージ。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="soapappendixpackageclient">
<span id="id18"></span><h3><a class="toc-backref" href="#id54">5.3.3.3. クライアントのパッケージ構成</a><a class="headerlink" href="#soapappendixpackageclient" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">クライアントを作成するときの推奨する構成について、説明する。</div>
<div class="line">ガイドラインに従いプロジェクトをSOAPサーバから提供されると以下の構成となる。</div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">プロジェクト名</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">[client projectName]-domain</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">クライアントのドメイン層に関するクラス・設定ファイルを格納するプロジェクト</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">[client projectName]-web</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">クライアントのアプリケーション層に関するクラス・設定ファイルを格納するプロジェクト</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">[client projectName]-env</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">クライアントの環境に依存するファイル等を格納するプロジェクト</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">[server projectName]-modelと[server projectName]-webserviceについては、前述の「 <a class="reference internal" href="#soapappendixpackageserver"><span class="std std-ref">SOAPサーバのパッケージ構成</span></a>」を参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="client-projectname-domain">
<h4><a class="toc-backref" href="#id55">5.3.3.3.1. [client projectName]-domain</a><a class="headerlink" href="#client-projectname-domain" title="Permalink to this headline">¶</a></h4>
<p>SOAPサーバから提供される[server projectName]-webserviceの依存関係を追加するため、<code class="docutils literal"><span class="pre">pom.xml</span></code>に以下を追加する。</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>${project.groupId}<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>artifactId-webservice<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>依存性の解決について</strong></p>
<p class="last">[server projectName]-webと同様に、この<code class="docutils literal"><span class="pre">pom.xml</span></code>には、[server projectName]-modelの依存関係の定義は不要である。これは[server projectName]-webserviceから[server projectName]-modelへの依存関係が定義されているため、推移的に依存関係が追加されるためである。</p>
</div>
<p>その他のパッケージ構成は、通常のdomainプロジェクトと変わらないため、「<a class="reference internal" href="../../Overview/ApplicationLayering.html"><span class="doc">アプリケーションのレイヤ化</span></a> の <a class="reference internal" href="../../Overview/ApplicationLayering.html#application-layering-project-structure"><span class="std std-ref">プロジェクト構成</span></a>」を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="client-projectname-web">
<h4><a class="toc-backref" href="#id56">5.3.3.3.2. [client projectName]-web</a><a class="headerlink" href="#client-projectname-web" title="Permalink to this headline">¶</a></h4>
<p>[client projectName]-webについては、通常のwebプロジェクトと変わらないため、「<a class="reference internal" href="../../Overview/ApplicationLayering.html"><span class="doc">アプリケーションのレイヤ化</span></a> の <a class="reference internal" href="../../Overview/ApplicationLayering.html#application-layering-project-structure"><span class="std std-ref">プロジェクト構成</span></a>」を参照されたい。</p>
</div>
<div class="section" id="client-projectname-env">
<h4><a class="toc-backref" href="#id57">5.3.3.3.3. [client projectName]-env</a><a class="headerlink" href="#client-projectname-env" title="Permalink to this headline">¶</a></h4>
<p>[client projectName]-envのプロジェクト推奨構成を、以下に示す。</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">[projectName]-env</span>
<span class="go">  ├configs ...(1)</span>
<span class="go">  │   └[envName] ...(2)</span>
<span class="go">  │       └resources ...(3)</span>
<span class="go">  └src</span>
<span class="go">      └main</span>
<span class="go">          └resources ...(4)</span>
<span class="go">             ├META-INF</span>
<span class="go">             │  └spring</span>
<span class="go">             │      ├[projectName]-env.xml ...(5)</span>
<span class="go">             │      └[projectName]-infra.properties ...(6)</span>
<span class="go">             ├dozer.properties</span>
<span class="go">             └logback.xml ...(7)</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">全環境の環境依存ファイルを管理するためのディレクトリ。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">環境毎の環境依存ファイルを管理するためのディレクトリ。</div>
<div class="line">ディレクトリ名は、環境を識別する名前を指定する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">環境毎の設定ファイルを管理するためのディレクトリ。</div>
<div class="line">サブディレクトリの構成や管理する設定ファイルは、(4)と同様。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ローカル開発環境用の設定ファイルを管理するためのディレクトリ。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ローカル開発環境用のBean定義を行う。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ローカル開発環境用のプロパティを定義する。</div>
<div class="line">WSDLのURLなど環境ごとに変更の可能性がある値を設定する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ローカル開発環境用のログ出力定義を行う。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="wsimport">
<span id="soapappendixwsimport"></span><h3><a class="toc-backref" href="#id58">5.3.3.4. wsimportについて</a><a class="headerlink" href="#wsimport" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">wsimportは Java SEに同梱されるコマンドライン・ツールである。</div>
<div class="line">WSDLファイルを読み取り、Webサービスを呼び出すことが可能なJavaクラス（オプションによってはソースも）を出力するツールである。</div>
</div>
<div class="section" id="id19">
<h4><a class="toc-backref" href="#id59">5.3.3.4.1. wsimportの使い道</a><a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">本ガイドラインでは、wsimportは以下の図のような場合に使用することを推奨している。</div>
<div class="line">クライアント作成時に、SOAPサーバで使用されるDomain ObjectやWebサービスインターフェースが使用できない場合でも、wsimportを使用することでWebサービスの実行ができるようになる。</div>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/SOAPModelNoProvide.png"><img alt="Server and Client Projects for SOAP" src="../../_images/SOAPModelNoProvide.png" style="width: 80%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id20">
<h4><a class="toc-backref" href="#id60">5.3.3.4.2. wsimportの使い方</a><a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">JDKのbinフォルダに格納されており、パスを通すだけで使用可能になる。</div>
<div class="line">コマンドライン上で以下のようにコマンドを実行すると、ソースファイルがカレントディレクトリに作成される。</div>
</div>
<div class="highlight-bat"><div class="highlight"><pre><span></span># (1)
wsimport -keep -p [出力するソースのパッケージ名] -s [出力するソースを格納する場所] [wsdlのURL]
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">wsimportの引数としてWSDLのURLを指定する。</div>
<div class="line">オプションとして以下を使用する。</div>
</div>
<blockquote>
<div><ul class="simple">
<li>-keep ソースも出力する。</li>
<li>-p 出力するソースのパッケージを指定する。</li>
<li>-s 出力するソースを格納する場所を指定する。</li>
</ul>
</div></blockquote>
<div class="last line-block">
<div class="line">その他オプションについては、<a class="reference external" href="https://docs.oracle.com/javase/8/docs/technotes/tools/windows/wsimport.html">Java Platform, Standard Edition Tools Reference -Web Services(wsimport)-</a>を参照されたい。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">wsimportはデフォルトの挙動としてclassファイルのみが出力される。動かすだけなら問題はないが、デバッグなどを実行したい場合に備えkeepオプションを付けてソースも保存することを推奨する。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>例えば、以下のようなコマンドとなる。</p>
<div class="highlight-bat"><div class="highlight"><pre><span></span>wsimport -keep -p com.example.ws.todo -s c:/tmp http://AAA.BBB.CCC.DDD:XXXX/soap-web/ws/TodoWebService?wsdl
</pre></div>
</div>
<p>作成されるソースは公開されているWebサービスに依存するが、本ガイドラインで使用している以下のJavaクラスが出力される。</p>
<ul class="simple">
<li>Webサービスインターフェース（ソース例では<code class="docutils literal"><span class="pre">TodoWebService.java</span></code>）</li>
<li>Domain Object（ソース例では<code class="docutils literal"><span class="pre">Todo.java</span></code>）</li>
</ul>
<div class="line-block">
<div class="line">wsimportで生成したクラスを1つのクライアントプロジェクトのみでしか使用しない場合は、これらをdomainプロジェクトへ配置すればよい。</div>
<div class="line">生成したクラスはインフラストラクチャ層(<a class="reference internal" href="../../Overview/ApplicationLayering.html#application-layering-integration-system-connector"><span class="std std-ref">Integration System Connector</span></a>)に所属するが、<a class="reference internal" href="../../Overview/ApplicationLayering.html#application-layering-project-structure"><span class="std std-ref">プロジェクト構成</span></a>のNoteで示したように通常はdomainプロジェクトに含めても問題ない。</div>
<div class="line">生成したクラスを複数のクライアントで使用する場合は、<a class="reference internal" href="#soapappendixaddproject"><span class="std std-ref">SOAPサーバ用にプロジェクトの設定を変更する</span></a>をもとに、modelプロジェクトとwebserviceプロジェクトを作成し、それぞれのクライアントから参照して使用することが望ましい。</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">出力されるJavaクラスは上記以外にも出力される。出力されたソースのみでクライアントを作成可能なソースである。ただし、本ガイドラインではクライアントは、<code class="docutils literal"><span class="pre">org.springframework.remoting.jaxws.JaxWsPortProxyFactoryBean</span></code>を使用する方針であるため、その他のJavaクラスは使用しないことを推奨する。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="tomcatweb">
<span id="soapappendixtomcatwebservice"></span><h3><a class="toc-backref" href="#id61">5.3.3.5. Tomcat上でのWebサービス開発</a><a class="headerlink" href="#tomcatweb" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">本ガイドラインでは、Jakarta EE（Java EE）サーバ上のJAX-WSを使う前提で記述されているが、Tomcatの場合、JAX-WS実装が存在しない。</div>
<div class="line">そのため、ここではSOAPサーバがTomcatの場合、JAX-WSの実装プロダクトとして<a class="reference external" href="https://cxf.apache.org/">Apache CXF</a>を使用する。設定を変更して<code class="docutils literal"><span class="pre">CXFServlet</span></code>を使用する必要がある。</div>
<div class="line">Apache CXFを使用する場合は、WebServiceクラスの実装方式は以下の2つが存在する。</div>
</div>
<ol class="arabic simple">
<li>POJOでWebサービス実装クラスを記述する方式</li>
<li><code class="docutils literal"><span class="pre">SpringBeanAutowiringSupport</span></code>を継承してWebサービス実装クラスを作成する方式 (これまで説明してきた方法)</li>
</ol>
<div class="line-block">
<div class="line">1の場合、Webサービス実装クラスがPOJOになるため、単体試験などをしやすくなる。ただし、この方式はTomcat以外のAPサーバでは、うまく動作しないことがある。そのため、ガイドライン本体では、この方式ではなく2の方式での実現を記述しているが、Tomcatのみを使用する場合、この1の方式を使用したほうがメリットが多いのでこちらを推奨する。</div>
<div class="line">2の場合、他のAPサーバ同様に実装をすることができる。運用はJakarta EE（Java EE）サーバであるが、開発中はTomcatを使用せざるをえないケースではこちらの方式を利用されたい。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="cxfservlet">
<h4><a class="toc-backref" href="#id62">5.3.3.5.1. CXFServletを使用する場合の設定</a><a class="headerlink" href="#cxfservlet" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">CXFServlet</span></code>を使用するため、<code class="docutils literal"><span class="pre">pom.xml</span></code>にライブラリの設定を記述する。</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apache.cxf<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>cxf-rt-frontend-jaxws<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>3.1.4<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apache.cxf<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>cxf-rt-transports-http<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>3.1.4<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">CXFServlet</span></code>を使用するため、Apache CXFライブラリへの依存関係を追加する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Java SE 11環境にてCXFServletを利用する場合</strong></p>
<p>Java SE 11でJAX-WSが削除されたことに伴い、関連技術であるSAAJも削除された。
CXFServletでは内部的にSAAJを使用しているため、SAAJの不足により期待しない挙動となることが確認されている。
具体的には、SOAP Faultの処理が正常に行なわれず、Webサービスのエラー時にSOAPクライアントに意図しない例外メッセージが返却される。</p>
<p>このため、CXFServletの実行時にはSAAJがクラスパスに登録されている必要がある。
Java SE 11では以下のようにsaaj-implを依存関係に追加する必要があるが、APサーバから提供される場合はこの限りではない。
例として、JBoss 7.2を利用する場合、JBossによりSAAJが提供されることを確認している。</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.sun.xml.messaging.saaj<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>saaj-impl<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<p>saaj-impl以外のJava SE 11環境にてJAX-WSを利用する場合に必要となる設定は<a class="reference internal" href="../../Appendix/Java11Changes.html#remove-jax-ws-from-java11"><span class="std std-ref">JAX-WSの削除</span></a>を参照されたい。</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">saaj-implのバージョンはterasoluna-gfw-parentが依存している<a class="reference external" href="https://docs.spring.io/spring-boot/docs/2.7.7/reference/htmlsingle/#dependency-versions">Spring Boot</a>で管理されているため、pom.xmlでのバージョンの指定は不要である。</p>
</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>次に<code class="docutils literal"><span class="pre">web.xml</span></code>にSOAP Web Serviceを受け付ける<code class="docutils literal"><span class="pre">CXFServlet</span></code>を定義する。</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;servlet&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>cxfServlet<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;servlet-class&gt;</span>org.apache.cxf.transport.servlet.CXFServlet<span class="nt">&lt;/servlet-class&gt;</span>
    <span class="nt">&lt;init-param&gt;</span>
        <span class="nt">&lt;param-name&gt;</span>config-location<span class="nt">&lt;/param-name&gt;</span>
        <span class="nt">&lt;param-value&gt;</span>classpath:/META-INF/spring/cxf-servlet.xml<span class="nt">&lt;/param-value&gt;</span>
    <span class="nt">&lt;/init-param&gt;</span>
    <span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
<span class="nt">&lt;/servlet&gt;</span>
<span class="c">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;servlet-mapping&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>cxfServlet<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/ws/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/servlet-mapping&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.apache.cxf.transport.servlet.CXFServlet</span></code>のサーブレット定義を行う。</div>
<div class="line"><code class="docutils literal"><span class="pre">config-location</span></code>には、後述する<code class="docutils literal"><span class="pre">cxf-servlet.xml</span></code>のパスを指定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">定義したサーブレットへのマッピングを定義する。この場合、コンテキスト名/ws配下にWebサービスが作成される。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="pojo">
<h4><a class="toc-backref" href="#id63">5.3.3.5.2. POJO方式で必要な設定</a><a class="headerlink" href="#pojo" title="Permalink to this headline">¶</a></h4>
<p>Webサービス実装クラスをエンドポイントとして設定する。</p>
<p><em>[server projectName]-web/src/main/resources/META-INF/spring/cxf-servlet.xml</em></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
    <span class="na">xmlns:jaxws=</span><span class="s">&quot;http://cxf.apache.org/jaxws&quot;</span> <span class="na">xmlns:soap=</span><span class="s">&quot;http://cxf.apache.org/bindings/soap&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans</span>
<span class="s">         https://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">         http://www.springframework.org/schema/context</span>
<span class="s">         https://www.springframework.org/schema/context/spring-context.xsd</span>
<span class="s">         http://cxf.apache.org/jaxws</span>
<span class="s">         http://cxf.apache.org/schemas/jaxws.xsd</span>
<span class="s">         http://cxf.apache.org/bindings/soap</span>
<span class="s">         http://cxf.apache.org/schemas/configuration/soap.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;jaxws:endpoint</span> <span class="na">id=</span><span class="s">&quot;todoWebEndpoint&quot;</span> <span class="na">implementor=</span><span class="s">&quot;#todoWebServiceImpl&quot;</span>
        <span class="na">address=</span><span class="s">&quot;/TodoWebService&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">公開するエンドポイントを定義する。</div>
<div class="line"><code class="docutils literal"><span class="pre">implementor</span></code>属性に、DIコンテナに登録済みのWebサービスクラスのbean名(「#bean名」形式)を指定する。</div>
<div class="line"><code class="docutils literal"><span class="pre">address</span></code>属性にWebサービスを公開するアドレスを指定する。</div>
<div class="line">アドレスは、公開するエンドポイントのパス部分のみ記述する。</div>
<div class="line">属性の詳細については<a class="reference external" href="https://cwiki.apache.org/confluence/display/CXF20DOC/JAX-WS+Configuration">Apache CXF JAX-WS Configuration</a>を参照されたい。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><code class="docutils literal"><span class="pre">TodoWebServiceImpl</span></code>をPOJOとして作成する。</p>
<p><em>[server projectName]-web/src/main/java/com/example/ws/todo/TodoWebServiceImpl.java</em></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.ws.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.jws.HandlerChain</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.jws.WebService</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.ws.BindingType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.ws.soap.SOAPBinding</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.context.support.SpringBeanAutowiringSupport</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.domain.service.TodoService</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.ws.webfault.WebFaultException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.ws.exception.WsExceptionHandler</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.ws.todo.TodoWebService</span><span class="p">;</span>

<span class="c1">// (1)</span>
<span class="nd">@Component</span>
<span class="nd">@WebService</span><span class="p">(</span>
      <span class="n">portName</span> <span class="o">=</span> <span class="s">&quot;TodoWebPort&quot;</span><span class="p">,</span>
      <span class="n">serviceName</span> <span class="o">=</span> <span class="s">&quot;TodoWebService&quot;</span><span class="p">,</span>
      <span class="n">targetNamespace</span> <span class="o">=</span> <span class="s">&quot;http://example.com/todo&quot;</span><span class="p">,</span>
      <span class="n">endpointInterface</span> <span class="o">=</span> <span class="s">&quot;com.example.ws.todo.TodoWebService&quot;</span><span class="p">)</span>
<span class="nd">@BindingType</span><span class="p">(</span><span class="n">SOAPBinding</span><span class="p">.</span><span class="na">SOAP12HTTP_BINDING</span><span class="p">)</span>
<span class="c1">// (2)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoWebServiceImpl</span> <span class="kd">implements</span> <span class="n">TodoWebService</span> <span class="p">{</span>

    <span class="c1">// omitted</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">&#64;Component</span></code> を付けて、DIコンテナへの登録を行う。</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">コンポーネントスキャンにてDIコンテナへの登録が可能であるため、POJOとして作成する。つまり、<code class="docutils literal"><span class="pre">org.springframework.web.context.support.SpringBeanAutowiringSupport</span></code>を継承する必要がなくなる。</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="springbeanautowiringsupport">
<h4><a class="toc-backref" href="#id64">5.3.3.5.3. SpringBeanAutowiringSupportを継承する方式で必要な設定</a><a class="headerlink" href="#springbeanautowiringsupport" title="Permalink to this headline">¶</a></h4>
<p>CXFServlet用のBean定義ファイルに、SOAPのエンドポイントとなるクラス名およびアドレスを定義する。</p>
<p><em>[server projectName]-web/src/main/resources/META-INF/spring/cxf-servlet.xml</em></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
    <span class="na">xmlns:jaxws=</span><span class="s">&quot;http://cxf.apache.org/jaxws&quot;</span> <span class="na">xmlns:soap=</span><span class="s">&quot;http://cxf.apache.org/bindings/soap&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans</span>
<span class="s">         https://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">         http://www.springframework.org/schema/context</span>
<span class="s">         https://www.springframework.org/schema/context/spring-context.xsd</span>
<span class="s">         http://cxf.apache.org/jaxws</span>
<span class="s">         http://cxf.apache.org/schemas/jaxws.xsd</span>
<span class="s">         http://cxf.apache.org/bindings/soap</span>
<span class="s">         http://cxf.apache.org/schemas/configuration/soap.xsd&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;jaxws:endpoint</span> <span class="na">id=</span><span class="s">&quot;todoWebEndpoint&quot;</span> <span class="na">implementor=</span><span class="s">&quot;com.example.ws.todo.TodoWebServiceImpl&quot;</span>
        <span class="na">address=</span><span class="s">&quot;/TodoWebService&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">公開するエンドポイントを定義する。</div>
<div class="line"><code class="docutils literal"><span class="pre">implementor</span></code>属性に公開するWebサービスの実装クラスを指定する。</div>
<div class="line"><code class="docutils literal"><span class="pre">address</span></code>属性にWebサービスを公開するアドレスを指定する。</div>
<div class="line">アドレスは、公開するエンドポイントのパス部分のみ記述する。</div>
<div class="line">属性の詳細については<a class="reference external" href="https://cwiki.apache.org/confluence/display/CXF20DOC/JAX-WS+Configuration">Apache CXF JAX-WS Configuration</a>を参照されたい。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../DataAccessDetail/index.html" title="6. データアクセス"
             >next</a> |</li>
        <li class="right" >
          <a href="RestClient.html" title="5.2. RESTクライアント（HTTPクライアント）"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.7.2.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >5. Web Service</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
      © Copyright 2013, NTT DATA Corporation. © Copyright 2013, NTT Corporation.
      Created using <a href="https://www.sphinx-doc.org/en/master/">Sphinx</a> 1.6.3.Theme is <a href="https://pypi.org/project/solar-theme/">Solar</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>