<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>4.6. メッセージ管理 &#8212; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.5.1.RELEASE documentation</title>
    <link rel="stylesheet" href="../../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '5.5.1.RELEASE',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="4.7. 国際化" href="Internationalization.html" />
    <link rel="prev" title="4.5. 二重送信防止" href="DoubleSubmitProtection.html" /><script src="../../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../../_static/solarized-dark.css" rel="stylesheet">
<link href="../../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Internationalization.html" title="4.7. 国際化"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="DoubleSubmitProtection.html" title="4.5. 二重送信防止"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.5.1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">4. Webアプリ開発機能</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>

  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4.6. メッセージ管理</a><ul>
<li><a class="reference internal" href="#overview">4.6.1. Overview</a><ul>
<li><a class="reference internal" href="#id3">4.6.1.1. メッセージタイプ</a></li>
<li><a class="reference internal" href="#id4">4.6.1.2. パターン別メッセージタイプの分類</a></li>
<li><a class="reference internal" href="#id">4.6.1.3. メッセージID体系</a><ul>
<li><a class="reference internal" href="#id5">4.6.1.3.1. タイトル</a></li>
<li><a class="reference internal" href="#message-management-label-rule">4.6.1.3.2. ラベル</a></li>
<li><a class="reference internal" href="#message-management-result-rule">4.6.1.3.3. 結果メッセージ</a><ul>
<li><a class="reference internal" href="#id8">4.6.1.3.3.1. 業務間で共通して使用するメッセージ</a></li>
<li><a class="reference internal" href="#message-properties-example">4.6.1.3.3.2. 各業務で個別に使用するメッセージ</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id10">4.6.1.3.4. 入力チェックエラーメッセージ</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use">4.6.2. How to use</a><ul>
<li><a class="reference internal" href="#id11">4.6.2.1. プロパティファイルに設定したメッセージの表示</a><ul>
<li><a class="reference internal" href="#id12">4.6.2.1.1. プロパティを使用する際の設定</a></li>
<li><a class="reference internal" href="#properties-display">4.6.2.1.2. プロパティに設定したメッセージの表示</a></li>
</ul>
</li>
<li><a class="reference internal" href="#message-display">4.6.2.2. 結果メッセージの表示</a><ul>
<li><a class="reference internal" href="#id15">4.6.2.2.1. 基本的な結果メッセージの使用方法</a></li>
<li><a class="reference internal" href="#id18">4.6.2.2.2. 結果メッセージの属性名指定</a></li>
<li><a class="reference internal" href="#id19">4.6.2.2.3. 業務例外メッセージの表示</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-extend">4.6.3. How to extend</a><ul>
<li><a class="reference internal" href="#id20">4.6.3.1. 独自メッセージタイプを作成する</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendix">4.6.4. Appendix</a><ul>
<li><a class="reference internal" href="#t-messagespanel">4.6.4.1. &lt;t:messagesPanel&gt;タグの属性変更</a></li>
<li><a class="reference internal" href="#resultmessages">4.6.4.2. ResultMessagesを使用しない結果メッセージの表示</a></li>
<li><a class="reference internal" href="#message-management-messagekeysgen">4.6.4.3. メッセージキー定数クラスの自動生成ツール</a></li>
</ul>
</li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="DoubleSubmitProtection.html"
                        title="previous chapter">4.5. 二重送信防止</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Internationalization.html"
                        title="next chapter">4.7. 国際化</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/ArchitectureInDetail/WebApplicationDetail/MessageManagement.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>4.6. メッセージ管理<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="admonition caution">
  <p class="first admonition-title">Caution</p>
  <p><strong>本バージョンの内容は既に古くなっています</strong>。最新のガイドラインは<a href="http://terasolunaorg.github.io/guideline/">こちら</a>からご参照ください。</p>
</div>
<div class="contents local topic" id="id2">
<p class="topic-title first">目次</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id23">Overview</a><ul>
<li><a class="reference internal" href="#id3" id="id24">メッセージタイプ</a></li>
<li><a class="reference internal" href="#id4" id="id25">パターン別メッセージタイプの分類</a></li>
<li><a class="reference internal" href="#id" id="id26">メッセージID体系</a><ul>
<li><a class="reference internal" href="#id5" id="id27">タイトル</a></li>
<li><a class="reference internal" href="#message-management-label-rule" id="id28">ラベル</a></li>
<li><a class="reference internal" href="#message-management-result-rule" id="id29">結果メッセージ</a><ul>
<li><a class="reference internal" href="#id8" id="id30">業務間で共通して使用するメッセージ</a></li>
<li><a class="reference internal" href="#message-properties-example" id="id31">各業務で個別に使用するメッセージ</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id10" id="id32">入力チェックエラーメッセージ</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use" id="id33">How to use</a><ul>
<li><a class="reference internal" href="#id11" id="id34">プロパティファイルに設定したメッセージの表示</a><ul>
<li><a class="reference internal" href="#id12" id="id35">プロパティを使用する際の設定</a></li>
<li><a class="reference internal" href="#properties-display" id="id36">プロパティに設定したメッセージの表示</a></li>
</ul>
</li>
<li><a class="reference internal" href="#message-display" id="id37">結果メッセージの表示</a><ul>
<li><a class="reference internal" href="#id15" id="id38">基本的な結果メッセージの使用方法</a></li>
<li><a class="reference internal" href="#id18" id="id39">結果メッセージの属性名指定</a></li>
<li><a class="reference internal" href="#id19" id="id40">業務例外メッセージの表示</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-extend" id="id41">How to extend</a><ul>
<li><a class="reference internal" href="#id20" id="id42">独自メッセージタイプを作成する</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendix" id="id43">Appendix</a><ul>
<li><a class="reference internal" href="#t-messagespanel" id="id44">&lt;t:messagesPanel&gt;タグの属性変更</a></li>
<li><a class="reference internal" href="#resultmessages" id="id45">ResultMessagesを使用しない結果メッセージの表示</a></li>
<li><a class="reference internal" href="#message-management-messagekeysgen" id="id46">メッセージキー定数クラスの自動生成ツール</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id23">4.6.1. Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">メッセージとは、画面や帳票等に表示する固定文言、またはユーザの画面操作の結果に応じて表示する動的文言を指す。</div>
<div class="line">また、エラーメッセージは、できるだけ細かく定義することを推奨する。</div>
</div>
<p></p>
<blockquote>
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>以下の場合において、運用中、あるいは運用前の試験の際、エラーの原因を究明できなくなるリスクが生じる。(開発中は、特に困らないかもしれない。)</p>
<ul class="simple">
<li>エラーメッセージを、1つのみ定義している</li>
<li>エラーメッセージを、「重要」と「警告」の2つしか定義していない</li>
</ul>
<p class="last">その結果、開発メンバが少ない中で、メッセージの定義変更を行い、開発が進むにつれて、修正コストが増えることになる。
そのため、あらかじめメッセージは、細かい粒度で定義しておくことを推奨する。</p>
</div>
</div></blockquote>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id24">4.6.1.1. メッセージタイプ</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">ユーザの画面操作の結果に応じて表示するメッセージは、内容に応じて、以下3種類のメッセージタイプに分けて管理する。</div>
<div class="line">メッセージを定義する際は、出力するメッセージが、どのタイプに属するか意識すること。</div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">メッセージタイプ</th>
<th class="head">カテゴリ</th>
<th class="head">概要</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>info</td>
<td>情報メッセージ</td>
<td>ユーザの操作による処理が正常に実行された後、画面に表示するメッセージ。</td>
</tr>
<tr class="row-odd"><td>warn</td>
<td>警告メッセージ</td>
<td>処理は継続できるが、注意喚起が必要な状態である場合に表示するメッセージ。（例：パスワード有効期限切れが近い場合の通知メッセージ）</td>
</tr>
<tr class="row-even"><td>error</td>
<td>入力エラーメッセージ</td>
<td>ユーザの入力値が不正な場合に、入力画面に表示するメッセージ。</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>業務エラーメッセージ</td>
<td>業務ロジックでエラーと判定された場合に表示するメッセージ</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>システムエラーメッセージ</td>
<td>システム起因のエラー（データベースとの接続失敗等）が発生し、ユーザの操作でリカバリできない場合に表示するメッセージ</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id25">4.6.1.2. パターン別メッセージタイプの分類</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>メッセージの出力パターンを、以下に示す。</p>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/message-pattern.png"><img alt="message pattern" src="../../_images/message-pattern.png" style="width: 95%;" /></a>
</div>
<p>メッセージパターンとメッセージの表示内容、及びメッセージタイプを、以下に示す。</p>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="5%" />
<col width="15%" />
<col width="20%" />
<col width="10%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">記号</th>
<th class="head">パターン</th>
<th class="head">表示内容</th>
<th class="head">メッセージタイプ</th>
<th class="head">例</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(A)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">タイトル</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">画面のタイトル</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
<td><ul class="first last simple">
<li>従業員登録画面</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ラベル</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">画面の項目名</div>
<div class="line">帳票の項目名</div>
<div class="line">コメント</div>
<div class="line">ガイダンス</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
<td><ul class="first last simple">
<li>ユーザー名</li>
<li>パスワード</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(B)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ダイアログ</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">確認メッセージ</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">info</div>
</div>
</td>
<td><ul class="first last simple">
<li>登録してよろしいでしょうか？</li>
<li>削除してよろしいでしょうか？</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(C)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">結果メッセージ</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">正常終了</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">info</div>
</div>
</td>
<td><ul class="first last simple">
<li>登録しました。</li>
<li>削除しました。</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(D)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">警告</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">warn</div>
</div>
</td>
<td><ul class="first last simple">
<li>パスワードの有効期限切れが間近です。パスワードを変更して下さい。</li>
<li>サーバが混み合っています。時間をおいてから再度実行して下さい。</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(E)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">単項目チェックエラー</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">error</div>
</div>
</td>
<td><ul class="first last simple">
<li>“ユーザー名”は必須です。</li>
<li>“名前”は20桁以内で入力してください。</li>
<li>“金額”には数字を入力してください。</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(F)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">相関チェックエラー</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">error</div>
</div>
</td>
<td><ul class="first last simple">
<li>“パスワード”と”パスワード(確認用)”が一致しません。</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(G)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">業務エラー</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">error</div>
</div>
</td>
<td><ul class="first last simple">
<li>キャンセル可能期間を過ぎているため、予約を取り消せません。</li>
<li>登録可能件数を超えているため、登録できません。</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(H)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">システムエラー</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">error</div>
</div>
</td>
<td><ul class="first last simple">
<li>XXXシステム閉塞中のため、しばらく経ってから再度実行して下さい</li>
<li>タイムアウトが発生しました。</li>
<li>システムエラーが発生しました。</li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id">
<h3><a class="toc-backref" href="#id26">4.6.1.3. メッセージID体系</a><a class="headerlink" href="#id" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">メッセージは、メッセージIDをつけて管理することを推奨する。</div>
<div class="line">主な理由は、以下3つの利点を得るためである。</div>
</div>
<ul class="simple">
<li>メッセージ変更時に、ソースコードを修正することなくメッセージを変更するため</li>
<li>メッセージの出力箇所を特定しやすくするため</li>
<li>国際化に対応できるため</li>
</ul>
<p>メッセージIDの決め方は、メンテナンス性向上のため、規約を作って統一することを強く推奨する。</p>
<div class="line-block">
<div class="line">メッセージパターン毎のメッセージID規約例を以下に示す。</div>
<div class="line">開発プロジェクトでメッセージID規約が定まっていない場合は、参考にされたい。</div>
</div>
<div class="section" id="id5">
<h4><a class="toc-backref" href="#id27">4.6.1.3.1. タイトル</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">画面のタイトルに使用する、メッセージIDの決め方について説明する。</div>
</div>
<ul>
<li><p class="first">フォーマット</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">接頭句</th>
<th class="head">区切り</th>
<th class="head">業務名</th>
<th class="head">区切り</th>
<th class="head">画面名</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">title</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">nnn*</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">nnn*</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">記述内容</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="13%" />
<col width="13%" />
<col width="31%" />
<col width="44%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項目</th>
<th class="head">位置</th>
<th class="head">内容</th>
<th class="head">備考</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">接頭句</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1-5桁目 (5桁)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">“title” (固定)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">業務名</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">可変長：任意</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">spring-mvc.xmlで定義したviewResolverのprefixの下のディレクトリ（JSPの上位ディレクトリ）</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">画面名</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">可変長：任意</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">JSP名</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ファイル名が”aaa.jsp”の場合”aaa”の部分</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">定義例</p>
<blockquote>
<div><div class="highlight-properties"><div class="highlight"><pre><span></span><span class="c"># &quot;/WEB-INF/views/admin/top.jsp&quot;の場合</span>
<span class="na">title.admin.top</span><span class="o">=</span><span class="s">Admin Top</span>
<span class="c"># &quot;/WEB-INF/views/staff/createForm.jsp&quot;の場合</span>
<span class="na">title.staff.createForm</span><span class="o">=</span><span class="s">Staff Register Input</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">本例は、Tilesを利用する場合に有効である。詳細は <a class="reference internal" href="TilesLayout.html"><span class="doc">Tilesによる画面レイアウト</span></a> を参照されたい。
Tilesを利用しない場合は、次に説明する<a class="reference internal" href="#message-management-label-rule"><span class="std std-ref">ラベル</span></a>の規約を利用しても良い。</p>
</div>
</div></blockquote>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="message-management-label-rule">
<span id="id6"></span><h4><a class="toc-backref" href="#id28">4.6.1.3.2. ラベル</a><a class="headerlink" href="#message-management-label-rule" title="Permalink to this headline">¶</a></h4>
<p>画面のラベル、帳票の固定文言に使用する、メッセージIDの決め方について説明する。</p>
<ul>
<li><p class="first">フォーマット</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="14%" />
<col width="14%" />
<col width="16%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">接頭句</th>
<th class="head">区切り</th>
<th class="head">プロジェクト区分</th>
<th class="head">区切り</th>
<th class="head">業務名</th>
<th class="head">区切り</th>
<th class="head">項目名</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">label</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">xx</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">nnn*</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">nnn*</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">記述内容</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="13%" />
<col width="13%" />
<col width="31%" />
<col width="44%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項目</th>
<th class="head">位置</th>
<th class="head">内容</th>
<th class="head">備考</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">接頭句</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1-5桁目 (5桁)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">“label” (固定)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">プロジェクト区分</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">7-8桁名 (2桁)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">プロジェクト名のアルファベット2桁表記</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">業務名</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">可変長：任意</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">項目名</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">可変長：任意</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ラベル名、説明文名</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>入力チェックエラーのメッセージに項目名(論理名)を含める場合は、</p>
<ul class="simple">
<li>フォームのモデル名 + “.” + フィールド名</li>
</ul>
<blockquote>
<div><div class="highlight-properties"><div class="highlight"><pre><span></span><span class="na">staffForm.staffName</span> <span class="o">=</span> <span class="s">Staff name</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>フィールド名</li>
</ul>
<blockquote>
<div><div class="highlight-properties"><div class="highlight"><pre><span></span><span class="na">staffName</span> <span class="o">=</span> <span class="s">Staff name</span>
</pre></div>
</div>
</div></blockquote>
<p class="last">にする必要がある。</p>
</div>
</div></blockquote>
</li>
<li><p class="first">使用例</p>
<blockquote>
<div><div class="highlight-properties"><div class="highlight"><pre><span></span><span class="c"># スタッフ登録画面のフォームの項目名</span>
<span class="c"># プロジェクト区分=em (Event Management System)</span>
<span class="na">label.em.staff.staffName</span><span class="o">=</span><span class="s">Staff name</span>
<span class="c"># ツアー検索画面に表示する説明文の場合</span>
<span class="c"># プロジェクト区分=tr (Tour Reservation System)</span>
<span class="na">label.tr.tourSearch.tourSearchMessage</span><span class="o">=</span><span class="s">You can search tours with the specified conditions.</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">プロジェクトが複数存在する場合に、メッセージIDが重複しないようにプロジェクト区分を定義する。
単一プロジェクトの場合でも、将来を見据えてプロジェクト区分を定義することを推奨する。</p>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="message-management-result-rule">
<span id="id7"></span><h4><a class="toc-backref" href="#id29">4.6.1.3.3. 結果メッセージ</a><a class="headerlink" href="#message-management-result-rule" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id8">
<h5><a class="toc-backref" href="#id30">4.6.1.3.3.1. 業務間で共通して使用するメッセージ</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h5>
<p>同一メッセージを定義しないように、複数の業務間で共有するメッセージについて説明する。</p>
<ul>
<li><p class="first">フォーマット</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="12%" />
<col width="12%" />
<col width="14%" />
<col width="12%" />
<col width="14%" />
<col width="12%" />
<col width="12%" />
<col width="12%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">メッセージタイプ</th>
<th class="head">区切り</th>
<th class="head">プロジェクト区分</th>
<th class="head">区切り</th>
<th class="head">共通メッセージ区分</th>
<th class="head">区切り</th>
<th class="head">エラーレベル</th>
<th class="head">連番</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">x</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">xx</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">fw</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">9</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">999</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">記述内容</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="22%" />
<col width="22%" />
<col width="44%" />
<col width="11%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項目</th>
<th class="head">位置</th>
<th class="head">内容</th>
<th class="head">備考</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">メッセージタイプ</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1桁目 (1桁)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">info  : i</div>
<div class="line">warn  : w</div>
<div class="line">error : e</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">プロジェクト区分</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">3-4桁目 (2桁)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">プロジェクト名のアルファベット2桁表記</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">共通メッセージ区分</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">6-7桁目 (2桁)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">“fw” (固定)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">エラーレベル</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">9桁 (1桁)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">0-1 : 正常メッセージ</div>
<div class="line">2-4 : 業務エラー（準正常）</div>
<div class="line">5-7 : 入力チェックエラー</div>
<div class="line">8 : 業務エラー（エラー）</div>
<div class="line">9 : システムエラー</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">連番</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">10-12桁目 (3桁)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">連番で利用する(000-999)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">メッセージ削除となっても連番は空き番として、削除しない</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">使用例</p>
<blockquote>
<div><div class="highlight-properties"><div class="highlight"><pre><span></span><span class="c"># 登録が成功した場合（正常メッセージ）</span>
<span class="na">i.ex.fw.0001</span><span class="o">=</span><span class="s">Registered successfully.</span>
<span class="c"># サーバリソース不足</span>
<span class="na">w.ex.fw.9002</span><span class="o">=</span><span class="s">Server busy. Please, try again.</span>
<span class="c"># システムエラー発生の場合（システムエラー）</span>
<span class="na">e.ex.fw.9001</span><span class="o">=</span><span class="s">A system error has occurred.</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="message-properties-example">
<span id="id9"></span><h5><a class="toc-backref" href="#id31">4.6.1.3.3.2. 各業務で個別に使用するメッセージ</a><a class="headerlink" href="#message-properties-example" title="Permalink to this headline">¶</a></h5>
<p>業務で個別に使用するメッセージについて説明する。</p>
<ul>
<li><p class="first">フォーマット</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="12%" />
<col width="12%" />
<col width="14%" />
<col width="12%" />
<col width="14%" />
<col width="12%" />
<col width="12%" />
<col width="12%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">メッセージタイプ</th>
<th class="head">区切り</th>
<th class="head">プロジェクト区分</th>
<th class="head">区切り</th>
<th class="head">業務メッセージ区分</th>
<th class="head">区切り</th>
<th class="head">エラーレベル</th>
<th class="head">連番</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">x</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">xx</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">xx</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">9</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">999</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">記述内容</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="22%" />
<col width="22%" />
<col width="44%" />
<col width="11%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項目</th>
<th class="head">位置</th>
<th class="head">内容</th>
<th class="head">備考</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">メッセージタイプ</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1桁目 (1桁)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">info  : i</div>
<div class="line">warn  : w</div>
<div class="line">error : e</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">プロジェクト区分</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">3-4桁目 (2桁)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">プロジェクト名のアルファベット2桁表記</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">業務メッセージ区分</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">6-7桁目 (2桁)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">業務IDなど業務毎に決める2桁の文字</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">エラーレベル</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">9桁 (1桁)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">0-1 : 正常メッセージ</div>
<div class="line">2-4 : 業務エラー（準正常）</div>
<div class="line">5-7 : 入力チェックエラー</div>
<div class="line">8 : 業務エラー（エラー）</div>
<div class="line">9 : システムエラー</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">連番</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">10-12桁目 (3桁)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">連番で利用する(000-999)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">メッセージ削除となっても連番は空き番として、削除しない</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">使用例</p>
<blockquote>
<div><div class="highlight-properties"><div class="highlight"><pre><span></span><span class="c"># ファイルのアップロードが成功した場合</span>
<span class="na">i.ex.an.0001</span><span class="o">=</span><span class="s">{0} upload completed.</span>
<span class="c"># パスワードの推奨変更期間が過ぎている場合</span>
<span class="na">w.ex.an.2001</span><span class="o">=</span><span class="s">The recommended change interval of password has passed. Please change your password.</span>
<span class="c"># ファイルサイズが制限を超えている場合</span>
<span class="na">e.ex.an.8001</span><span class="o">=</span><span class="s">Cannot upload, Because the file size must be less than {0}MB.</span>
<span class="c"># データに不整合がある場合</span>
<span class="na">e.ex.an.9001</span><span class="o">=</span><span class="s">There are inconsistencies in the data.</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id10">
<h4><a class="toc-backref" href="#id32">4.6.1.3.4. 入力チェックエラーメッセージ</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<p>入力チェックでエラーがある場合に出力するメッセージについては、<a class="reference internal" href="Validation.html#validation-message-def"><span class="std std-ref">エラーメッセージの定義</span></a>を参照されたい。</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p>入力チェックエラーの出力場所に関する基本方針を、以下に示す。</p>
<ul class="last">
<li><div class="first line-block">
<div class="line">単項目入力チェックエラーのメッセージは、対象の項目がわかるように項目の横に表示させる。</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">相関入力チェックエラーのメッセージは、ページ上部などにまとめて表示させる。</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">単項目チェックでもメッセージを項目の横に表示させにくい場合は、ページ上部に表示させる。</div>
<div class="line">その場合は、メッセージに項目名を含める。</div>
</div>
</li>
</ul>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="how-to-use">
<h2><a class="toc-backref" href="#id33">4.6.2. How to use</a><a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id11">
<h3><a class="toc-backref" href="#id34">4.6.2.1. プロパティファイルに設定したメッセージの表示</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id12">
<h4><a class="toc-backref" href="#id35">4.6.2.1.1. プロパティを使用する際の設定</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<p>メッセージ管理を行う<code class="docutils literal"><span class="pre">org.springframework.context.MessageSource</span></code>の実装クラスの定義を行う。</p>
<ul>
<li><p class="first">applicationContext.xml</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Message --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;messageSource&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.springframework.context.support.ResourceBundleMessageSource&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;basenames&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
        <span class="nt">&lt;list&gt;</span>
            <span class="nt">&lt;value&gt;</span>i18n/application-messages<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;/list&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">MessageSource</span></code>の定義。ここでは<code class="docutils literal"><span class="pre">ResourceBundleMessageSource</span></code>を使用する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">使用するメッセージプロパティの基底名を定義する。クラスパス相対で指定する。</div>
<div class="line">この例では”src/main/resources/i18n/application-messages.properties”を読み込む。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="properties-display">
<span id="id13"></span><h4><a class="toc-backref" href="#id36">4.6.2.1.2. プロパティに設定したメッセージの表示</a><a class="headerlink" href="#properties-display" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">application-messages.properties</p>
<blockquote>
<div><p>ここでは、<code class="file docutils literal"><span class="pre">application-messages.properties</span></code>にメッセージを定義する例を示す。</p>
<div class="highlight-properties"><div class="highlight"><pre><span></span><span class="na">label.aa.bb.year</span><span class="o">=</span><span class="s">Year</span>
<span class="na">label.aa.bb.month</span><span class="o">=</span><span class="s">Month</span>
<span class="na">label.aa.bb.day</span><span class="o">=</span><span class="s">Day</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>文字コード「ISO-8859-1」では表現できない文字(日本語など)は<code class="docutils literal"><span class="pre">native2ascii</span></code>コマンドで
ISO-8859-1に変換して使用することが多かった。しかし、JDK 6からは文字コードを指定できるようになったため、
変換する必要はない。文字コードUTF-8にすることで、propertiesファイルに直接日本語等を使用できる。</p>
<ul>
<li><p class="first">application-messages.properties</p>
<blockquote>
<div><div class="highlight-properties"><div class="highlight"><pre><span></span><span class="na">label.aa.bb.year</span><span class="o">=</span><span class="s">年</span>
<span class="na">label.aa.bb.month</span><span class="o">=</span><span class="s">月</span>
<span class="na">label.aa.bb.day</span><span class="o">=</span><span class="s">日</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>この場合、以下のように、<code class="docutils literal"><span class="pre">ResourceBundleMessageSource</span></code>にも読み込む文字コードを指定する必要がある。</p>
<ul>
<li><p class="first">applicationContext.xml</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">bean</span> <span class="n">id</span><span class="o">=</span><span class="s">&quot;messageSource&quot;</span>
    <span class="n">class</span><span class="o">=</span><span class="s">&quot;org.springframework.context.support.ResourceBundleMessageSource&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">property</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;basenames&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">list</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="n">i18n</span><span class="o">/</span><span class="n">application</span><span class="o">-</span><span class="n">messages</span><span class="o">&lt;/</span><span class="n">value</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">list</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">property</span><span class="o">&gt;</span>
<span class="hll">    <span class="o">&lt;</span><span class="n">property</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;defaultEncoding&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span> <span class="o">/&gt;</span>
</span><span class="o">&lt;/</span><span class="n">bean</span><span class="o">&gt;</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p class="last">デフォルトではISO-8859-1が使用されるため、日本語等をpropertiesファイルに直接記述したい場合は、
必ず<code class="docutils literal"><span class="pre">defaultEncoding</span></code>を設定すること。</p>
</div>
</div></blockquote>
</li>
<li><p class="first">JSP</p>
<blockquote>
<div><p>上記で設定したメッセージをJSPからは、<code class="docutils literal"><span class="pre">&lt;spring:message&gt;</span></code>タグを用いて表示できる。
<a class="reference internal" href="../../ImplementationAtEachLayer/ApplicationLayer.html#view-jsp-include-label"><span class="std std-ref">インクルード用の共通JSPの作成</span></a>の設定が必要である。</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;spring:message</span> <span class="na">code=</span><span class="s">&quot;label.aa.bb.year&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;spring:message</span> <span class="na">code=</span><span class="s">&quot;label.aa.bb.month&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;spring:message</span> <span class="na">code=</span><span class="s">&quot;label.aa.bb.day&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>フォームのラベルと使用する場合は、以下のように使用すれば良い。</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;form:form</span> <span class="na">modelAttribute=</span><span class="s">&quot;sampleForm&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;form:label</span> <span class="na">path=</span><span class="s">&quot;year&quot;</span><span class="nt">&gt;</span>
<span class="hll">        <span class="nt">&lt;spring:message</span> <span class="na">code=</span><span class="s">&quot;label.aa.bb.year&quot;</span> <span class="nt">/&gt;</span>
</span>    <span class="nt">&lt;/form:label&gt;</span>: <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;year&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;form:label</span> <span class="na">path=</span><span class="s">&quot;month&quot;</span><span class="nt">&gt;</span>
<span class="hll">        <span class="nt">&lt;spring:message</span> <span class="na">code=</span><span class="s">&quot;label.aa.bb.month&quot;</span> <span class="nt">/&gt;</span>
</span>    <span class="nt">&lt;/form:label&gt;</span>: <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;month&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;form:label</span> <span class="na">path=</span><span class="s">&quot;day&quot;</span><span class="nt">&gt;</span>
<span class="hll">        <span class="nt">&lt;spring:message</span> <span class="na">code=</span><span class="s">&quot;label.aa.bb.day&quot;</span> <span class="nt">/&gt;</span>
</span>    <span class="nt">&lt;/form:label&gt;</span>: <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;day&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form:form&gt;</span>
</pre></div>
</div>
<p>ブラウザで表示すると以下のように出力される。</p>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/message-management-ymd.png"><img alt="../../_images/message-management-ymd.png" src="../../_images/message-management-ymd.png" style="width: 40%;" /></a>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>国際化に対応する場合は、</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>src/main/resources/i18n
                    ├ application-messages.properties (英語メッセージ)
                    ├ application-messages_fr.properties (フランス語メッセージ)
                    ├ ...
                    └ application-messages_ja.properties (日本語メッセージ)
</pre></div>
</div>
<p class="last">というように各言語用のpropertiesファイルを作成すればよい。
詳細は、<a class="reference internal" href="Internationalization.html"><span class="doc">国際化</span></a>を参照されたい。</p>
</div>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="message-display">
<span id="id14"></span><h3><a class="toc-backref" href="#id37">4.6.2.2. 結果メッセージの表示</a><a class="headerlink" href="#message-display" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">サーバサイドでの処理の成功や、失敗を示す結果メッセージを格納するクラスとして、</div>
<div class="line">共通ライブラリでは、<code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.message.ResultMessages</span></code>、および<code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.message.ResultMessage</span></code>を提供している。</div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">クラス名</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">ResultMessages</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">結果メッセージの一覧とメッセージタイプを持つクラス。</div>
<div class="line">結果メッセージの一覧は<code class="docutils literal"><span class="pre">List&lt;ResultMessage&gt;</span></code>、メッセージタイプは<code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.message.ResultMessageType</span></code>インタフェースで表現される。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">ResultMessage</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">結果メッセージのメッセージID、または、メッセージ本文を持つクラス。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">この結果メッセージをJSPで表示するためのJSPタグライブラリとして、<code class="docutils literal"><span class="pre">&lt;t:messagesPanel&gt;</span></code>タグも提供される。</div>
</div>
<div class="section" id="id15">
<h4><a class="toc-backref" href="#id38">4.6.2.2.1. 基本的な結果メッセージの使用方法</a><a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<p>Controllerで<code class="docutils literal"><span class="pre">ResultMessages</span></code>を生成して画面に渡し、JSPで<code class="docutils literal"><span class="pre">&lt;t:messagesPanel&gt;</span></code>タグを使用して、
結果メッセージを表示する方法を説明する。</p>
<ul>
<li><p class="first">Controllerクラス</p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">ResultMessages</span></code>オブジェクトの生成方法、および画面へメッセージを渡す方法を示す。
application-messages.proertiesには、<a class="reference internal" href="#message-properties-example"><span class="std std-ref">各業務で個別に使用するメッセージ</span></a>の例が定義されていることとする。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.sample.app.message</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessages</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;message&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageController</span> <span class="o">{</span>

  <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ResultMessages</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">ResultMessages</span><span class="o">.</span><span class="na">error</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;e.ex.an.9001&quot;</span><span class="o">);</span> <span class="c1">// (1)</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">messages</span><span class="o">);</span> <span class="c1">// (2)</span>
    <span class="k">return</span> <span class="s">&quot;message/index&quot;</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">メッセージタイプが”error”である<code class="docutils literal"><span class="pre">ResultMessages</span></code>を作成し、</div>
<div class="line">メッセージIDが”e.ex.an.9001”である結果メッセージを設定する。</div>
<div class="line">この処理は次と同義である。</div>
<div class="line"><code class="docutils literal"><span class="pre">ResultMessages.error().add(ResultMessage.fromCode(&quot;e.ex.an.9001&quot;));</span></code></div>
<div class="line">メッセージIDを指定する場合は、<code class="docutils literal"><span class="pre">ResultMessage</span></code>オブジェクトの生成を省略できるため、省略することを推奨する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">ResultMessages</span></code>をModelに追加する。</div>
<div class="line">属性は指定しなくてよい。(属性名は”resultMessages”になる)</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">JSP</p>
<blockquote>
<div><p>WEB-INF/views/message/index.jspを、以下のように記述する。</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>Result Message Example<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Result Message<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;t:messagesPanel</span> <span class="nt">/&gt;</span><span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">&lt;t:messagesPanel&gt;</span></code> タグをデフォルト設定で使用する。</div>
<div class="line">デフォルトでは、属性名が”resultMessages”のオブジェクトを表示する。</div>
<div class="line">そのため、デフォルトではControllerからModelに<code class="docutils literal"><span class="pre">ResultMessages</span></code>を設定する際に、属性名を設定する必要がない。</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>ブラウザで表示すると、以下のように出力される。</p>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/message-management-resultmessage-basic.png"><img alt="../../_images/message-management-resultmessage-basic.png" src="../../_images/message-management-resultmessage-basic.png" style="width: 40%;" /></a>
</div>
<p><code class="docutils literal"><span class="pre">&lt;t:messagesPanel&gt;</span></code> によって出力されるHTMLを、以下に示す(説明しやすくするために整形している)。</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-error&quot;</span><span class="p">&gt;</span><span class="c">&lt;!-- (1) --&gt;</span>
  <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span><span class="c">&lt;!-- (2) --&gt;</span>
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>There are inconsistencies in the data.<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span><span class="c">&lt;!-- (3) --&gt;</span>
  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">メッセージタイプに対応して”alert-error”クラスが付与されている。デフォルトでは<code class="docutils literal"><span class="pre">&lt;div&gt;</span></code>タグのclassに”error error-[メッセージタイプ]”が付与される。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">結果メッセージのリストが<code class="docutils literal"><span class="pre">&lt;ul&gt;</span></code>タグで出力される。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">メッセージIDに対応するメッセージが<code class="docutils literal"><span class="pre">MessageSource</span></code>から解決される。</div>
</div>
</td>
</tr>
</tbody>
</table>
<p><code class="docutils literal"><span class="pre">&lt;t:messagesPanel&gt;</span></code>はclassを付けたHTMLを出力するだけであるため、見栄えは出力されたclassに合わせてCSSでカスタマイズする必要がある(後述する)。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">ResultMessages.error().add(ResultMessage.fromText(&quot;There</span> <span class="pre">are</span> <span class="pre">inconsistencies</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">data.&quot;));</span></code>というように、
メッセージの本文をハードコードすることもできるが、保守性を高めるため、メッセージキーを使用して<code class="docutils literal"><span class="pre">ResultMessage</span></code>オブジェクトを作成し、
メッセージ本文はプロパティファイルから取得することを推奨する。</p>
</div>
</div></blockquote>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>メッセージのプレースホルダに値を埋める場合は、次のように<code class="docutils literal"><span class="pre">add</span></code>メソッドの第二引数以降に設定すればよい。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">ResultMessages</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">ResultMessages</span><span class="o">.</span><span class="na">error</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;e.ex.an.8001&quot;</span><span class="o">,</span> <span class="mi">1024</span><span class="o">);</span>
<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">messages</span><span class="o">);</span>
</pre></div>
</div>
<p>この場合、<code class="docutils literal"><span class="pre">&lt;t:messagesPanel</span> <span class="pre">/&gt;</span></code>タグにより、以下のようなHTMLが出力される。</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-error&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Cannot upload, Because the file size must be less than 1,024MB.<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p></p>
<blockquote>
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>terasoluna-gfw-web 1.0.0.RELEASEを使用してプレースホルダに値を埋める場合の注意点</strong></p>
<p>terasoluna-gfw-web 1.0.0.RELEASEを使用している場合、<strong>プレースホルダにユーザの入力値を埋め込むとXSS脆弱性の危険がある。</strong>ユーザの入力値にXSS対策が必要な文字が含まれる可能性がある場合は、プレースホルダに値を埋め込まないようにすること。</p>
<p class="last">terasoluna-gfw-web 1.0.1.RELEASE以上を使用している場合は、ユーザの入力値をプレースホルダに埋め込んでもXSS脆弱性は発生しない。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><code class="docutils literal"><span class="pre">ResourceBundleMessageSource</span></code>はメッセージを生成する際に<code class="docutils literal"><span class="pre">java.text.MessageFormat</span></code>を使用するため、<code class="docutils literal"><span class="pre">1024</span></code>は
カンマ区切りで<code class="docutils literal"><span class="pre">1,024</span></code>と表示される。カンマが不要な場合は、プロパティファイルには以下のように設定する。</p>
<blockquote>
<div><div class="highlight-properties"><div class="highlight"><pre><span></span><span class="na">e.ex.an.8001</span><span class="o">=</span><span class="s">Cannot upload, Because the file size must be less than {0,number,#}MB.</span>
</pre></div>
</div>
</div></blockquote>
<p class="last">詳細は、<a class="reference external" href="http://docs.oracle.com/javase/8/docs/api/java/text/MessageFormat.html">Javadoc</a>を参照されたい。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>以下のように、複数の結果メッセージを設定することもできる。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">ResultMessages</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">ResultMessages</span><span class="o">.</span><span class="na">error</span><span class="o">()</span>
    <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;e.ex.an.9001&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;e.ex.an.8001&quot;</span><span class="o">,</span> <span class="mi">1024</span><span class="o">);</span>
<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">messages</span><span class="o">);</span>
</pre></div>
</div>
<p>この場合は、次のようなHTMLが出力される(JSPの変更は、不要である)。</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-error&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>There are inconsistencies in the data.<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Cannot upload, Because the file size must be less than 1,024MB.<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>infoメッセージを表示したい場合は、次のように<code class="docutils literal"><span class="pre">ResultMessages.info()</span></code>メソッドで<code class="docutils literal"><span class="pre">ResultMessages</span></code>オブジェクトを作成すればよい。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">ResultMessages</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">ResultMessages</span><span class="o">.</span><span class="na">info</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;i.ex.an.0001&quot;</span><span class="o">,</span> <span class="s">&quot;XXXX&quot;</span><span class="o">);</span>
<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">messages</span><span class="o">);</span>
</pre></div>
</div>
<p>以下のようなHTMLが、出力される。</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-info&quot;</span><span class="p">&gt;</span><span class="c">&lt;!-- (1) --&gt;</span>
  <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>XXXX upload completed.<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">メッセージタイプに対応して、出力されるclass名が”alert alert-<strong>info</strong>”に変わっている。</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>標準では、以下のメッセージタイプが用意されている。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="15%" />
<col width="30%" />
<col width="25%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">メッセージタイプ</th>
<th class="head"><code class="docutils literal"><span class="pre">ResultMessages</span></code>オブジェクトの作成</th>
<th class="head">デフォルトで出力されるclass名</th>
<th class="head">備考</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">success</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">ResultMessages.success()</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">alert alert-success</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">info</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">ResultMessages.info()</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">alert alert-info</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">warn</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">ResultMessages.warn()</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">alert alert-warn</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">メッセージタイプ「warning」の追加に伴い、terasoluna-gfw-common 5.0.0.RELEASEから非推奨。</div>
<div class="line"><strong>このメッセージタイプは将来削除される可能性がある。</strong></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">warning</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">ResultMessages.warning()</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">alert alert-warning</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">CSSフレームワークである<a class="reference external" href="http://getbootstrap.com/">Bootstrap</a> の<a class="reference external" href="https://getbootstrap.com/docs/3.3/components/#alerts">Alertsコンポーネント</a>で用意されているメッセージタイプをデフォルトでサポートするために、terasoluna-gfw-common 5.0.0.RELEASEから追加。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">error</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">ResultMessages.error()</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">alert alert-error</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">danger</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">ResultMessages.danger()</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">alert alert-danger</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>メッセージタイプに応じてCSSを定義されたい。以下に、CSSを適用した場合の例を示す。</p>
<div class="highlight-css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">alert</span> <span class="p">{</span>
  <span class="k">margin-bottom</span><span class="p">:</span> <span class="mi">15</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">padding</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span><span class="p">;</span>
  <span class="k">border-radius</span><span class="p">:</span> <span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">text-shadow</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">1</span><span class="kt">px</span> <span class="mi">0</span> <span class="mh">#ffffff</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">alert-info</span> <span class="p">{</span>
  <span class="k">background</span><span class="p">:</span> <span class="mh">#ebf7fd</span><span class="p">;</span>
  <span class="k">color</span><span class="p">:</span> <span class="mh">#2d7091</span><span class="p">;</span>
  <span class="k">border-color</span><span class="p">:</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">alert-warning</span> <span class="p">{</span>
  <span class="k">background</span><span class="p">:</span> <span class="mh">#fffceb</span><span class="p">;</span>
  <span class="k">color</span><span class="p">:</span> <span class="mh">#e28327</span><span class="p">;</span>
  <span class="k">border-color</span><span class="p">:</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">226</span><span class="p">,</span> <span class="mi">131</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">alert-error</span> <span class="p">{</span>
  <span class="k">background</span><span class="p">:</span> <span class="mh">#fff1f0</span><span class="p">;</span>
  <span class="k">color</span><span class="p">:</span> <span class="mh">#d85030</span><span class="p">;</span>
  <span class="k">border-color</span><span class="p">:</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">216</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">ResultMessages.error().add(&quot;e.ex.an.9001&quot;)</span></code>を<code class="docutils literal"><span class="pre">&lt;t:messagesPanel</span> <span class="pre">/&gt;</span></code>で出力した例</p>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/message-management-resultmessage-error.jpg"><img alt="../../_images/message-management-resultmessage-error.jpg" src="../../_images/message-management-resultmessage-error.jpg" style="width: 100%;" /></a>
</div>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">ResultMessages.warning().add(&quot;w.ex.an.2001&quot;)</span></code>を<code class="docutils literal"><span class="pre">&lt;t:messagesPanel</span> <span class="pre">/&gt;</span></code>で出力した例</p>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/message-management-resultmessage-warn.jpg"><img alt="../../_images/message-management-resultmessage-warn.jpg" src="../../_images/message-management-resultmessage-warn.jpg" style="width: 100%;" /></a>
</div>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">ResultMessages.info().add(&quot;i.ex.an.0001&quot;,</span> <span class="pre">&quot;XXXX&quot;)</span></code>を<code class="docutils literal"><span class="pre">&lt;t:messagesPanel</span> <span class="pre">/&gt;</span></code>で出力した例</p>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/message-management-resultmessage-info.jpg"><img alt="../../_images/message-management-resultmessage-info.jpg" src="../../_images/message-management-resultmessage-info.jpg" style="width: 100%;" /></a>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">successとdangerは、スタイルに多様性を持たせるために用意されている。本ガイドラインでは、successとinfo、errorとdangerは同義である。</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">CSSフレームワークである<a class="reference external" href="http://getbootstrap.com/">Bootstrap</a> の<a class="reference external" href="https://getbootstrap.com/docs/3.3/components/#alerts">Alertsコンポーネント</a>は、<code class="docutils literal"><span class="pre">&lt;t:messagesPanel</span> <span class="pre">/&gt;</span></code>のデフォルト設定で利用できる。</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>本例では、メッセージキーをハードコードで設定している。しかしながら、保守性を高めるためにも、メッセージキーは、定数クラスにまとめることを推奨する。</p>
<p class="last"><a class="reference internal" href="#message-management-messagekeysgen"><span class="std std-ref">メッセージキー定数クラスの自動生成ツール</span></a>を参照されたい。</p>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="id18">
<h4><a class="toc-backref" href="#id39">4.6.2.2.2. 結果メッセージの属性名指定</a><a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">ResultMessages</span></code>をModelに追加する場合、基本的には属性名を省略できる。</div>
<div class="line">ただし、<code class="docutils literal"><span class="pre">ResultMessages</span></code>は一つのメッセージタイプしか表現できない。</div>
<div class="line">1画面に異なるメッセージタイプの<code class="docutils literal"><span class="pre">ResultMessages</span></code>を<strong>同時に</strong>表示したい場合は、明示的に属性名を指定してModelに設定する必要がある。</div>
</div>
<ul>
<li><p class="first">Controller (MessageControllerに追加)</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;showMessages&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">showMessages</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;messages1&quot;</span><span class="o">,</span>
                <span class="n">ResultMessages</span><span class="o">.</span><span class="na">warning</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;w.ex.an.2001&quot;</span><span class="o">));</span> <span class="c1">// (1)</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;messages2&quot;</span><span class="o">,</span>
                <span class="n">ResultMessages</span><span class="o">.</span><span class="na">error</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;e.ex.an.9001&quot;</span><span class="o">));</span> <span class="c1">// (2)</span>

    <span class="k">return</span> <span class="s">&quot;message/showMessages&quot;</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">メッセージタイプが”warning”である、<code class="docutils literal"><span class="pre">ResultMessages</span></code>を属性名”messages1”でModelに追加する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">メッセージタイプが”info”である、<code class="docutils literal"><span class="pre">ResultMessages</span></code>を属性名”messages2”でModelに追加する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">JSP (WEB-INF/views/message/showMessages.jsp)</p>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>Result Message Example<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;style</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
.alert {
    margin-bottom: 15px;
    padding: 10px;
    border: 1px solid;
    border-radius: 4px;
    text-shadow: 0 1px 0 #ffffff;
}

.alert-info {
    background: #ebf7fd;
    color: #2d7091;
    border-color: rgba(45, 112, 145, 0.3);
}

.alert-warning {
    background: #fffceb;
    color: #e28327;
    border-color: rgba(226, 131, 39, 0.3);
}

.alert-error {
    background: #fff1f0;
    color: #d85030;
    border-color: rgba(216, 80, 48, 0.3);
}
<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Result Message<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;h2&gt;</span>Messages1<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;t:messagesPanel</span> <span class="na">messagesAttributeName=</span><span class="s">&quot;messages1&quot;</span> <span class="nt">/&gt;</span><span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;h2&gt;</span>Messages2<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;t:messagesPanel</span> <span class="na">messagesAttributeName=</span><span class="s">&quot;messages2&quot;</span> <span class="nt">/&gt;</span><span class="c">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">属性名が”messages1”である<code class="docutils literal"><span class="pre">ResultMessages</span></code>を表示する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">属性名が”messages2”である<code class="docutils literal"><span class="pre">ResultMessages</span></code>を表示する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>ブラウザで表示すると、以下のように出力される。</p>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/message-management-multiple-messages.jpg"><img alt="../../_images/message-management-multiple-messages.jpg" src="../../_images/message-management-multiple-messages.jpg" style="width: 80%;" /></a>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="id19">
<h4><a class="toc-backref" href="#id40">4.6.2.2.3. 業務例外メッセージの表示</a><a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.exception.BusinessException</span></code>と<code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.exception.ResourceNotFoundException</span></code>は</div>
<div class="line">内部で<code class="docutils literal"><span class="pre">ResultMessages</span></code>を保持している。</div>
</div>
<div class="line-block">
<div class="line">業務例外メッセージを表示する場合は、Serviceクラスで<code class="docutils literal"><span class="pre">ResultMessages</span></code>を設定した<code class="docutils literal"><span class="pre">BusinessException</span></code>をスローすること。</div>
<div class="line">Controllerクラスでは<code class="docutils literal"><span class="pre">BusinessException</span></code>をキャッチし、例外中の結果メッセージをModelに追加する。</div>
</div>
<ul>
<li><p class="first">Serviceクラス</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Service</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserServiceImpl</span> <span class="kd">implements</span> <span class="n">UserService</span> <span class="o">{</span>
    <span class="c1">// omitted</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">create</span><span class="o">(...)</span> <span class="o">{</span>

        <span class="c1">// omitted...</span>

        <span class="k">if</span> <span class="o">(...)</span> <span class="o">{</span>
            <span class="c1">// illegal state!</span>
            <span class="n">ResultMessages</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">ResultMessages</span><span class="o">.</span><span class="na">error</span><span class="o">()</span>
                                                    <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;e.ex.an.9001&quot;</span><span class="o">);</span> <span class="c1">// (1)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">BusinessException</span><span class="o">(</span><span class="n">messages</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">エラーメッセージを<code class="docutils literal"><span class="pre">ResultMessages</span></code>で作成し、<code class="docutils literal"><span class="pre">BusinessException</span></code>に設定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">Controllerクラス</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">create</span><span class="o">(</span><span class="nd">@Validated</span> <span class="n">UserForm</span> <span class="n">form</span><span class="o">,</span> <span class="n">BindingResult</span> <span class="n">result</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// omitted</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">BusinessException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ResultMessages</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">getResultMessages</span><span class="o">();</span> <span class="c1">// (1)</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">messages</span><span class="o">);</span>

        <span class="k">return</span> <span class="s">&quot;user/createForm&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// omitted</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">BusinessException</span></code>が保持する<code class="docutils literal"><span class="pre">ResultMessages</span></code>を取得し、Modelに追加する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
</ul>
<p>通常、エラーメッセージ表示する場合は、Controllerで<code class="docutils literal"><span class="pre">ResultMessages</span></code>オブジェクトを作成するのではなく、
こちらの方法を使用する。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="how-to-extend">
<h2><a class="toc-backref" href="#id41">4.6.3. How to extend</a><a class="headerlink" href="#how-to-extend" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id20">
<h3><a class="toc-backref" href="#id42">4.6.3.1. 独自メッセージタイプを作成する</a><a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">メッセージタイプを追加したい場合の、独自メッセージタイプ作成方法について説明する。</div>
<div class="line">通常は、用意されているメッセージタイプのみで十分であるが、採用しているCSSライブラリによっては</div>
<div class="line">メッセージタイプを追加したい場合がある。例えば”notice”というメッセージタイプを追加する場合を説明する。</div>
</div>
<div class="line-block">
<div class="line">まず、以下のように<code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.message.ResultMessageType</span></code>インタフェースを実装した</div>
<div class="line">独自メッセージタイプクラスを作成する。</div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessageType</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">ResultMessageTypes</span> <span class="kd">implements</span> <span class="n">ResultMessageType</span> <span class="o">{</span> <span class="c1">// (1)</span>
    <span class="n">NOTICE</span><span class="o">(</span><span class="s">&quot;notice&quot;</span><span class="o">);</span>

    <span class="kd">private</span> <span class="nf">ResultMessageTypes</span><span class="o">(</span><span class="n">String</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">type</span> <span class="o">=</span> <span class="n">type</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">type</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getType</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// (2)</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">type</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">type</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">ResultMessageType</span></code>インタフェースを実装したEnumを定義する。定数オブジェクトで作成してもよいが、Enumで作成することを推奨する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">getType</span></code>の返り値が出力されるCSSのclass名に対応する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">このメッセージタイプを使用して以下のように<code class="docutils literal"><span class="pre">ResultMessages</span></code>を作成する。</div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">ResultMessages</span> <span class="n">messages</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResultMessages</span><span class="o">(</span><span class="n">ResultMessageTypes</span><span class="o">.</span><span class="na">NOTICE</span><span class="o">)</span> <span class="c1">// (1)</span>
        <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;w.ex.an.2001&quot;</span><span class="o">);</span>
<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">messages</span><span class="o">);</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">ResultMessages</span></code>のコンストラクタに対象の<code class="docutils literal"><span class="pre">ResultMessageType</span></code>を指定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>この場合、<code class="docutils literal"><span class="pre">&lt;t:messagesPanel</span> <span class="pre">/&gt;</span></code> で以下のようなHTMLが出力される。</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-notice&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>The recommended change interval has passed password. Please change your password.<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p></p>
<blockquote>
<div><div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">拡張方法は、<code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.message.StandardResultMessageType</span></code>が参考になる。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="appendix">
<h2><a class="toc-backref" href="#id43">4.6.4. Appendix</a><a class="headerlink" href="#appendix" title="Permalink to this headline">¶</a></h2>
<div class="section" id="t-messagespanel">
<span id="message-management-messagepanel-attribute"></span><h3><a class="toc-backref" href="#id44">4.6.4.1. &lt;t:messagesPanel&gt;タグの属性変更</a><a class="headerlink" href="#t-messagespanel" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">&lt;t:messagesPanel&gt;</span></code>タグには、表示形式を変更する属性がいくつか用意されている。</p>
<table border="1" class="colwidths-given docutils" id="id22">
<caption><span class="caption-text"><code class="docutils literal"><span class="pre">&lt;t:messagesPanel&gt;</span></code>タグ 属性一覧</span><a class="headerlink" href="#id22" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="25%" />
<col width="55%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">オプション</th>
<th class="head">内容</th>
<th class="head">defaultの設定値</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>panelElement</td>
<td>結果メッセージ表示パネルの要素</td>
<td>div</td>
</tr>
<tr class="row-odd"><td>panelClassName</td>
<td>結果メッセージ表示パネルのCSS class名。</td>
<td>alert</td>
</tr>
<tr class="row-even"><td>panelTypeClassPrefix</td>
<td>CSS class名の接頭辞</td>
<td>alert-</td>
</tr>
<tr class="row-odd"><td>messagesType</td>
<td>メッセージタイプ。この属性が設定された場合。設定されたメッセージタイプが<code class="docutils literal"><span class="pre">ResultMessages</span></code>がもつメッセージタイプより優先されて使用される。</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>outerElement</td>
<td>結果メッセージ一覧を構成するHTMLの外側のタグ</td>
<td>ul</td>
</tr>
<tr class="row-odd"><td>innerElement</td>
<td>結果メッセージ一覧を構成するHTMLの内側のタグ</td>
<td>li</td>
</tr>
<tr class="row-even"><td>disableHtmlEscape</td>
<td><div class="first last line-block">
<div class="line">HTMLエスケープ処理を無効化するためのフラグ。</div>
<div class="line"><code class="docutils literal"><span class="pre">true</span></code>を指定する事で、出力するメッセージに対してHTMLエスケープ処理が行われなくなる。</div>
<div class="line">この属性は、出力するメッセージにHTMLを埋め込むことで、メッセージの装飾などができるようにするために用意している。</div>
<div class="line"><strong>trueを指定する場合は、XSS対策が必要な文字がメッセージ内に含まれない事が保証されていること。</strong></div>
<div class="line"><br /></div>
<div class="line">terasoluna-gfw-web 1.0.1.RELEASE以上で利用可能な属性である。</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">false</span></code></td>
</tr>
</tbody>
</table>
<p>例えば、CSSフレームワーク”<a class="reference external" href="http://www.bluetrip.org/">BlueTrip</a>”では以下のようなCSSが用意されている。</p>
<div class="highlight-css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">error</span><span class="o">,</span><span class="p">.</span><span class="nc">notice</span><span class="o">,</span><span class="p">.</span><span class="nc">success</span> <span class="p">{</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mf">.8</span><span class="kt">em</span><span class="p">;</span>
    <span class="k">margin-bottom</span><span class="p">:</span> <span class="mf">1.6</span><span class="kt">em</span><span class="p">;</span>
    <span class="k">border</span><span class="p">:</span> <span class="mi">2</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#ddd</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">error</span> <span class="p">{</span>
    <span class="k">background</span><span class="p">:</span> <span class="mh">#FBE3E4</span><span class="p">;</span>
    <span class="k">color</span><span class="p">:</span> <span class="mh">#8a1f11</span><span class="p">;</span>
    <span class="k">border-color</span><span class="p">:</span> <span class="mh">#FBC2C4</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">notice</span> <span class="p">{</span>
    <span class="k">background</span><span class="p">:</span> <span class="mh">#FFF6BF</span><span class="p">;</span>
    <span class="k">color</span><span class="p">:</span> <span class="mh">#514721</span><span class="p">;</span>
    <span class="k">border-color</span><span class="p">:</span> <span class="mh">#FFD324</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">success</span> <span class="p">{</span>
    <span class="k">background</span><span class="p">:</span> <span class="mh">#E6EFC2</span><span class="p">;</span>
    <span class="k">color</span><span class="p">:</span> <span class="mh">#264409</span><span class="p">;</span>
    <span class="k">border-color</span><span class="p">:</span> <span class="mh">#C6D880</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">このCSSを使用したい場合、<code class="docutils literal"><span class="pre">&lt;div</span> <span class="pre">class=&quot;error&quot;&gt;...&lt;/div&gt;</span></code>というようにメッセージが出力されてほしい。</div>
<div class="line">この場合、<code class="docutils literal"><span class="pre">&lt;t:messagesPanel&gt;</span></code>タグを以下のように使用すればよい(Controllerは修正不要である)。</div>
</div>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;t:messagesPanel</span> <span class="na">panelClassName=</span><span class="s">&quot;&quot;</span> <span class="na">panelTypeClassPrefix=</span><span class="s">&quot;&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>出力されるHTMLは以下のようになる。</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;error&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>There are inconsistencies in the data.<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>ブラウザで表示すると、以下のように出力される。</p>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/message-management-bluetrip-error.jpg"><img alt="../../_images/message-management-bluetrip-error.jpg" src="../../_images/message-management-bluetrip-error.jpg" style="width: 80%;" /></a>
</div>
<p>メッセージ一覧を表示するために<code class="docutils literal"><span class="pre">&lt;ul&gt;</span></code>タグを使用したくない場合は、
<code class="docutils literal"><span class="pre">outerElement</span></code>属性と<code class="docutils literal"><span class="pre">innerElement</span></code>属性を使用することでカスタマイズできる。</p>
<p>以下のように属性を設定した場合は、</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;t:messagesPanel</span> <span class="na">outerElement=</span><span class="s">&quot;&quot;</span> <span class="na">innerElement=</span><span class="s">&quot;span&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>次のようにHTMLが出力される。</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-error&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>There are inconsistencies in the data.<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>Cannot upload, Because the file size must be less than 1,024MB.<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>以下のようCSSを設定することで、</p>
<div class="highlight-css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">alert</span> <span class="o">&gt;</span> <span class="nt">span</span> <span class="p">{</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">block</span><span class="p">;</span> <span class="c">/* (1) */</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">“alert”クラスの要素の子となる<code class="docutils literal"><span class="pre">&lt;span&gt;</span></code>タグをブロックレベル要素にする。</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>ブラウザで次のように表示される。</p>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/message-management-messagespanel-span.jpg"><img alt="../../_images/message-management-messagespanel-span.jpg" src="../../_images/message-management-messagespanel-span.jpg" style="width: 60%;" /></a>
</div>
<div class="line-block">
<div class="line">disableHtmlEscape属性を<code class="docutils literal"><span class="pre">true</span></code>にした場合、以下のような出力イメージにする事ができる。</div>
<div class="line">下記の例では、メッセージの一部のフォントを「16pxの赤字」に装飾している。</div>
</div>
<ul class="simple">
<li>jsp</li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;spring:message</span> <span class="na">var=</span><span class="s">&quot;informationMessage&quot;</span> <span class="na">code=</span><span class="s">&quot;i.ex.od.0001&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;t:messagesPanel</span> <span class="na">messagesAttributeName=</span><span class="s">&quot;informationMessage&quot;</span>
    <span class="na">messagesType=</span><span class="s">&quot;alert alert-info&quot;</span>
<span class="hll">    <span class="na">disableHtmlEscape=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
</span></pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>properties</li>
</ul>
<blockquote>
<div><div class="highlight-properties"><div class="highlight"><pre><span></span><span class="na">i.ex.od.0001</span> <span class="o">=</span> <span class="s">Please confirm order content. &lt;font style=&quot;color: red; font-size: 16px;&quot;&gt;If this orders submitted, cannot cancel.&lt;/font&gt;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>出力イメージ</li>
</ul>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/message-management-disableHtmlEscape-true.png"><img alt="../../_images/message-management-disableHtmlEscape-true.png" src="../../_images/message-management-disableHtmlEscape-true.png" style="width: 100%;" /></a>
</div>
<p>disableHtmlEscape属性が<code class="docutils literal"><span class="pre">false</span></code>(デフォルト)の場合は、HTMLエスケープされて以下のような出力となる。</p>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/message-management-disableHtmlEscape-false.png"><img alt="../../_images/message-management-disableHtmlEscape-false.png" src="../../_images/message-management-disableHtmlEscape-false.png" style="width: 100%;" /></a>
</div>
</div></blockquote>
</div>
<div class="section" id="resultmessages">
<h3><a class="toc-backref" href="#id45">4.6.4.2. ResultMessagesを使用しない結果メッセージの表示</a><a class="headerlink" href="#resultmessages" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">&lt;t:messagesPanel&gt;</span></code>タグは<code class="docutils literal"><span class="pre">ResultMessages</span></code>オブジェクト以外にも</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">java.lang.String</span></code></li>
<li><code class="docutils literal"><span class="pre">java.lang.Exception</span></code></li>
<li><code class="docutils literal"><span class="pre">java.util.List</span></code></li>
</ul>
<p>オブジェクトも出力できる。</p>
<div class="line-block">
<div class="line">通常は<code class="docutils literal"><span class="pre">&lt;t:messagesPanel&gt;</span></code>タグは<code class="docutils literal"><span class="pre">ResultMessages</span></code>オブジェクトの出力用に使用するが、</div>
<div class="line">フレームワークがリクエストスコープに設定した文字列(エラーメッセージなど)を表示する場合にも使用できる。</div>
</div>
<div class="line-block">
<div class="line">例えば、Spring Securityのデフォルトの設定で使用される、<code class="docutils literal"><span class="pre">org.springframework.security.web.authentication.SimpleUrlAuthenticationFailureHandler</span></code>では、認証エラー時に発生した例外オブジェクトを<code class="docutils literal"><span class="pre">SPRING_SECURITY_LAST_EXCEPTION</span></code>という属性名で、リダイレクト時はセッション、フォワード時はリクエストスコープに格納する。</div>
<div class="line">この例外メッセージを、結果メッセージ同様に<code class="docutils literal"><span class="pre">&lt;t:messagesPanel&gt;</span></code>タグで出力したい場合は、以下のように設定すればよい。</div>
</div>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>Login<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;style</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
/* (1) */
.alert {
    margin-bottom: 15px;
    padding: 10px;
    border: 1px solid;
    border-radius: 4px;
    text-shadow: 0 1px 0 #ffffff;
}

.alert-error {
    background: #fff1f0;
    color: #d85030;
    border-color: rgba(216, 80, 48, 0.3);
}
<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">&quot;${param.containsKey(&#39;error&#39;)}&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t:messagesPanel</span> <span class="na">messagesType=</span><span class="s">&quot;error&quot;</span>
            <span class="na">messagesAttributeName=</span><span class="s">&quot;SPRING_SECURITY_LAST_EXCEPTION&quot;</span> <span class="nt">/&gt;</span><span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;/c:if&gt;</span>
    <span class="nt">&lt;form:form</span>
        <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/authentication&quot;</span>
        <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;fieldset&gt;</span>
            <span class="nt">&lt;legend&gt;</span>Login Form<span class="nt">&lt;/legend&gt;</span>
            <span class="nt">&lt;div&gt;</span>
                <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;</span>Username: <span class="nt">&lt;/label&gt;&lt;input</span>
                    <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;username&quot;</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div&gt;</span>
                <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;</span>Password:<span class="nt">&lt;/label&gt;&lt;input</span>
                    <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">id=</span><span class="s">&quot;password&quot;</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Login&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/fieldset&gt;</span>
    <span class="nt">&lt;/form:form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">結果メッセージ表示用のCSSを再掲する。実際はCSSファイルに記述することを強く推奨する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Exception</span></code>オブジェクトが格納されている属性名を<code class="docutils literal"><span class="pre">messagesAttributeName</span></code>属性で指定する。</div>
<div class="line">また、<code class="docutils literal"><span class="pre">ResultMessages</span></code>オブジェクトとは異なり、メッセージタイプの情報をもたないため、</div>
<div class="line"><code class="docutils literal"><span class="pre">messagesType</span></code>属性で、明示的に、メッセージタイプを指定する必要がある。</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>認証エラー時に出力されるHTMLは</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-error&quot;</span><span class="p">&gt;&lt;</span><span class="nt">ul</span><span class="p">&gt;&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Bad credentials<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;&lt;/</span><span class="nt">ul</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>であり、ブラウザでは以下のように出力される。</p>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/message-management-login-error.jpg"><img alt="../../_images/message-management-login-error.jpg" src="../../_images/message-management-login-error.jpg" style="width: 60%;" /></a>
</div>
<p></p>
<blockquote>
<div><div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">ログイン用のJSPの内容については、<a class="reference internal" href="../../Security/Authentication.html"><span class="doc">認証</span></a>を参照されたい。</p>
</div>
</div></blockquote>
</div>
<div class="section" id="message-management-messagekeysgen">
<span id="id21"></span><h3><a class="toc-backref" href="#id46">4.6.4.3. メッセージキー定数クラスの自動生成ツール</a><a class="headerlink" href="#message-management-messagekeysgen" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">これまでの例ではメッセージキーを文字列のハードコードで設定していたが、</div>
<div class="line">メッセージキーは定数クラスにまとめることを推奨する。</div>
</div>
<div class="line-block">
<div class="line">ここでは、簡易ツールとして、propertiesファイルからメッセージキー定数クラスを</div>
<div class="line">自動生成するプログラムおよび使用方法を紹介する。必要に応じてカスタマイズして利用されたい。</div>
</div>
<ol class="arabic">
<li><p class="first">メッセージキー定数クラスの作成</p>
<blockquote>
<div><p>まず空のメッセージキー定数クラスを作成する。ここでは<code class="docutils literal"><span class="pre">com.example.common.message.MessageKeys</span></code>とする。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.common.message</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageKeys</span> <span class="o">{</span>

<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">自動生成クラスの作成</p>
<blockquote>
<div><p>次に<code class="docutils literal"><span class="pre">MessageKeys</span></code>クラスと同じパッケージに<code class="docutils literal"><span class="pre">MessageKeysGen</span></code>クラスを作成し、以下のように記述する。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.common.message</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.BufferedReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileInputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStreamReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.PrintWriter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.regex.Pattern</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.commons.io.FileUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.io.IOUtils</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageKeysGen</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="c1">// message properties file</span>
        <span class="n">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">&quot;src/main/resources/i18n/application-messages.properties&quot;</span><span class="o">);</span>
        <span class="n">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">inputStream</span><span class="o">));</span>
        <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">targetClazz</span> <span class="o">=</span> <span class="n">MessageKeys</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
        <span class="n">File</span> <span class="n">output</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;src/main/java/&quot;</span>
                <span class="o">+</span> <span class="n">targetClazz</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">replaceAll</span><span class="o">(</span><span class="n">Pattern</span><span class="o">.</span><span class="na">quote</span><span class="o">(</span><span class="s">&quot;.&quot;</span><span class="o">),</span> <span class="s">&quot;/&quot;</span><span class="o">)</span>
                <span class="o">+</span> <span class="s">&quot;.java&quot;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;write &quot;</span> <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">());</span>
        <span class="n">PrintWriter</span> <span class="n">pw</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="n">FileUtils</span><span class="o">.</span><span class="na">openOutputStream</span><span class="o">(</span><span class="n">output</span><span class="o">));</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">pw</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;package &quot;</span> <span class="o">+</span> <span class="n">targetClazz</span><span class="o">.</span><span class="na">getPackage</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;;&quot;</span><span class="o">);</span>
            <span class="n">pw</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;/**&quot;</span><span class="o">);</span>
            <span class="n">pw</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot; * Message Id&quot;</span><span class="o">);</span>
            <span class="n">pw</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot; */&quot;</span><span class="o">);</span>
            <span class="n">pw</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;public class &quot;</span> <span class="o">+</span> <span class="n">targetClazz</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; {&quot;</span><span class="o">);</span>

            <span class="n">String</span> <span class="n">line</span><span class="o">;</span>
            <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">String</span><span class="o">[]</span> <span class="n">vals</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;=&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">vals</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">String</span> <span class="n">key</span> <span class="o">=</span> <span class="n">vals</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">trim</span><span class="o">();</span>
                    <span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">vals</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="na">trim</span><span class="o">();</span>
                    <span class="n">pw</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;    /** &quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s">&quot;=&quot;</span> <span class="o">+</span> <span class="n">value</span> <span class="o">+</span> <span class="s">&quot; */&quot;</span><span class="o">);</span>
                    <span class="n">pw</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;    public static final String &quot;</span>
                            <span class="o">+</span> <span class="n">key</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">().</span><span class="na">replaceAll</span><span class="o">(</span><span class="n">Pattern</span><span class="o">.</span><span class="na">quote</span><span class="o">(</span><span class="s">&quot;.&quot;</span><span class="o">),</span>
                                    <span class="s">&quot;_&quot;</span><span class="o">).</span><span class="na">replaceAll</span><span class="o">(</span><span class="n">Pattern</span><span class="o">.</span><span class="na">quote</span><span class="o">(</span><span class="s">&quot;-&quot;</span><span class="o">),</span> <span class="s">&quot;_&quot;</span><span class="o">)</span>
                            <span class="o">+</span> <span class="s">&quot; = \&quot;&quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s">&quot;\&quot;;&quot;</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="n">pw</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;}&quot;</span><span class="o">);</span>
            <span class="n">pw</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">IOUtils</span><span class="o">.</span><span class="na">closeQuietly</span><span class="o">(</span><span class="n">br</span><span class="o">);</span>
            <span class="n">IOUtils</span><span class="o">.</span><span class="na">closeQuietly</span><span class="o">(</span><span class="n">pw</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">メッセージプロパティファイルの用意</p>
<blockquote>
<div><p>src/main/resource/i18m/application-messages.propertiesにメッセージを定義する。ここでは例として、以下のように設定する。</p>
<div class="highlight-properties"><div class="highlight"><pre><span></span><span class="na">i.ex.an.0001</span><span class="o">=</span><span class="s">{0} upload completed.</span>
<span class="na">w.ex.an.2001</span><span class="o">=</span><span class="s">The recommended change interval has passed password. Please change your password.</span>
<span class="na">e.ex.an.8001</span><span class="o">=</span><span class="s">Cannot upload, Because the file size must be less than {0}MB.</span>
<span class="na">e.ex.an.9001</span><span class="o">=</span><span class="s">There are inconsistencies in the data.</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">自動生成クラスの実行</p>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/message-management-messagekeysgen.png"><img alt="../../_images/message-management-messagekeysgen.png" src="../../_images/message-management-messagekeysgen.png" style="width: 60%;" /></a>
</div>
<p><code class="docutils literal"><span class="pre">MessageKeys</span></code>クラスが、以下のように上書きされる。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.common.message</span><span class="o">;</span>
<span class="cm">/**</span>
<span class="cm"> * Message Id</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageKeys</span> <span class="o">{</span>
    <span class="cm">/** i.ex.an.0001={0} upload completed. */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">I_EX_AN_0001</span> <span class="o">=</span> <span class="s">&quot;i.ex.an.0001&quot;</span><span class="o">;</span>
    <span class="cm">/** w.ex.an.2001=The recommended change interval has passed password. Please change your password. */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">W_EX_AN_2001</span> <span class="o">=</span> <span class="s">&quot;w.ex.an.2001&quot;</span><span class="o">;</span>
    <span class="cm">/** e.ex.an.8001=Cannot upload, Because the file size must be less than {0}MB. */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">E_EX_AN_8001</span> <span class="o">=</span> <span class="s">&quot;e.ex.an.8001&quot;</span><span class="o">;</span>
    <span class="cm">/** e.ex.an.9001=There are inconsistencies in the data. */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">E_EX_AN_9001</span> <span class="o">=</span> <span class="s">&quot;e.ex.an.9001&quot;</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p></p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="Internationalization.html" title="4.7. 国際化"
             >next</a> |</li>
        <li class="right" >
          <a href="DoubleSubmitProtection.html" title="4.5. 二重送信防止"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.5.1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >4. Webアプリ開発機能</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
      © Copyright 2013, NTT DATA Corporation. © Copyright 2013, NTT Corporation.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.3.Theme is <a href="http://github.com/vimalkvn/solar-theme">Solar</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>
