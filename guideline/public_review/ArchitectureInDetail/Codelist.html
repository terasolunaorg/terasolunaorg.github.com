<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>5.14. コードリスト &#8212; TERASOLUNA Global Framework Development Guideline 1.0.0.publicreview documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/solar.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5.15. Ajax" href="Ajax.html" />
    <link rel="prev" title="5.13. 国際化" href="Internationalization.html" /><script async src="https://www.googletagmanager.com/gtag/js?id=G-847V2Q99G8"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date()); gtag('config', 'G-847V2Q99G8');
</script>
<script src="../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../_static/solarized-dark.css" rel="stylesheet">
<link href="../_static/jquery.treeview.css" rel="stylesheet">
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Ajax.html" title="5.15. Ajax"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Internationalization.html" title="5.13. 国際化"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Global Framework Development Guideline 1.0.0.publicreview documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U"><span class="section-number">5. </span>TERASOLUNA Global Frameworkの機能詳細</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">5.14. </span>コードリスト</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">5.14. コードリスト</a><ul>
<li><a class="reference internal" href="#overview">5.14.1. Overview</a></li>
<li><a class="reference internal" href="#how-to-use">5.14.2. How to use</a><ul>
<li><a class="reference internal" href="#simplemapcodelist">5.14.2.1. SimpleMapCodeListの使用方法</a><ul>
<li><a class="reference internal" href="#id3">5.14.2.1.1. コードリスト設定例</a></li>
<li><a class="reference internal" href="#jsp">5.14.2.1.2. JSPでのコードリスト使用</a></li>
<li><a class="reference internal" href="#java">5.14.2.1.3. Javaクラスでのコードリスト使用</a></li>
</ul>
</li>
<li><a class="reference internal" href="#numberrangecodelist">5.14.2.2. NumberRangeCodeListの使用方法</a><ul>
<li><a class="reference internal" href="#id4">5.14.2.2.1. コードリスト設定例</a></li>
<li><a class="reference internal" href="#id5">5.14.2.2.2. JSPでのコードリスト使用</a></li>
<li><a class="reference internal" href="#id6">5.14.2.2.3. Javaクラスでのコードリスト使用</a></li>
</ul>
</li>
<li><a class="reference internal" href="#jdbccodelist">5.14.2.3. JdbcCodeListの使用方法</a><ul>
<li><a class="reference internal" href="#id7">5.14.2.3.1. コードリスト設定例</a></li>
<li><a class="reference internal" href="#id8">5.14.2.3.2. JSPでのコードリスト使用</a></li>
<li><a class="reference internal" href="#id9">5.14.2.3.3. Javaクラスでのコードリスト使用</a></li>
</ul>
</li>
<li><a class="reference internal" href="#codelist-validate">5.14.2.4. コードリストを用いたコード値の入力チェック</a><ul>
<li><a class="reference internal" href="#existincodelist">5.14.2.4.1. &#64;ExistInCodeList の設定例</a></li>
</ul>
</li>
<li><a class="reference internal" href="#simplei18ncodelist">5.14.2.5. SimpleI18nCodeListの使用方法</a><ul>
<li><a class="reference internal" href="#id11">5.14.2.5.1. コードリスト設定例</a></li>
<li><a class="reference internal" href="#id12">5.14.2.5.2. JSPでのコードリスト使用</a></li>
<li><a class="reference internal" href="#id13">5.14.2.5.3. Javaクラスでのコードリスト使用</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-extend">5.14.3. How to extend</a><ul>
<li><a class="reference internal" href="#settingfetchsize">5.14.3.1. JdbcCodeListの読み込む件数が大きい場合</a></li>
<li><a class="reference internal" href="#codelisttaskscheduler">5.14.3.2. コードリストをリロードする場合</a><ul>
<li><a class="reference internal" href="#task-scheduler">5.14.3.2.1. Task Schedulerで実現する方法</a></li>
<li><a class="reference internal" href="#controller-service-refresh">5.14.3.2.2. Controller(Service)クラスでrefreshメソッドを呼び出す方法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#originalcustomizecodelist">5.14.3.3. コードリストを独自カスタマイズする方法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendix">5.14.4. Appendix</a><ul>
<li><a class="reference internal" href="#aftercodelisti18n">5.14.4.1. SimpleI18nCodeListのコードリスト設定方法</a><ul>
<li><a class="reference internal" href="#localjava-util-map-key-value">5.14.4.1.1. 行単位でLocal毎の<code class="docutils literal notranslate"><span class="pre">java.util.Map</span></code>(key=コード値, value=ラベル)を設定する</a></li>
<li><a class="reference internal" href="#java-util-map-key-locale-value">5.14.4.1.2. 列単位でコード値毎の<code class="docutils literal notranslate"><span class="pre">java.util.Map</span></code>(key=Locale, value=ラベル)を設定する</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="Internationalization.html"
                          title="previous chapter"><span class="section-number">5.13. </span>国際化</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="Ajax.html"
                          title="next chapter"><span class="section-number">5.15. </span>Ajax</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/ArchitectureInDetail/Codelist.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="id1">
<h1><span class="section-number">5.14. </span>コードリスト<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="id2">
<p class="topic-title">目次</p>
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id20">Overview</a></p></li>
<li><p><a class="reference internal" href="#how-to-use" id="id21">How to use</a></p>
<ul>
<li><p><a class="reference internal" href="#simplemapcodelist" id="id22">SimpleMapCodeListの使用方法</a></p>
<ul>
<li><p><a class="reference internal" href="#id3" id="id23">コードリスト設定例</a></p></li>
<li><p><a class="reference internal" href="#jsp" id="id24">JSPでのコードリスト使用</a></p></li>
<li><p><a class="reference internal" href="#java" id="id25">Javaクラスでのコードリスト使用</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#numberrangecodelist" id="id26">NumberRangeCodeListの使用方法</a></p>
<ul>
<li><p><a class="reference internal" href="#id4" id="id27">コードリスト設定例</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id28">JSPでのコードリスト使用</a></p></li>
<li><p><a class="reference internal" href="#id6" id="id29">Javaクラスでのコードリスト使用</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#jdbccodelist" id="id30">JdbcCodeListの使用方法</a></p>
<ul>
<li><p><a class="reference internal" href="#id7" id="id31">コードリスト設定例</a></p></li>
<li><p><a class="reference internal" href="#id8" id="id32">JSPでのコードリスト使用</a></p></li>
<li><p><a class="reference internal" href="#id9" id="id33">Javaクラスでのコードリスト使用</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#codelist-validate" id="id34">コードリストを用いたコード値の入力チェック</a></p>
<ul>
<li><p><a class="reference internal" href="#existincodelist" id="id35">&#64;ExistInCodeList の設定例</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#simplei18ncodelist" id="id36">SimpleI18nCodeListの使用方法</a></p>
<ul>
<li><p><a class="reference internal" href="#id11" id="id37">コードリスト設定例</a></p></li>
<li><p><a class="reference internal" href="#id12" id="id38">JSPでのコードリスト使用</a></p></li>
<li><p><a class="reference internal" href="#id13" id="id39">Javaクラスでのコードリスト使用</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#how-to-extend" id="id40">How to extend</a></p>
<ul>
<li><p><a class="reference internal" href="#settingfetchsize" id="id41">JdbcCodeListの読み込む件数が大きい場合</a></p></li>
<li><p><a class="reference internal" href="#codelisttaskscheduler" id="id42">コードリストをリロードする場合</a></p>
<ul>
<li><p><a class="reference internal" href="#task-scheduler" id="id43">Task Schedulerで実現する方法</a></p></li>
<li><p><a class="reference internal" href="#controller-service-refresh" id="id44">Controller(Service)クラスでrefreshメソッドを呼び出す方法</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#originalcustomizecodelist" id="id45">コードリストを独自カスタマイズする方法</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#appendix" id="id46">Appendix</a></p>
<ul>
<li><p><a class="reference internal" href="#aftercodelisti18n" id="id47">SimpleI18nCodeListのコードリスト設定方法</a></p>
<ul>
<li><p><a class="reference internal" href="#localjava-util-map-key-value" id="id48">行単位でLocal毎の<code class="docutils literal notranslate"><span class="pre">java.util.Map</span></code>(key=コード値, value=ラベル)を設定する</a></p></li>
<li><p><a class="reference internal" href="#java-util-map-key-locale-value" id="id49">列単位でコード値毎の<code class="docutils literal notranslate"><span class="pre">java.util.Map</span></code>(key=Locale, value=ラベル)を設定する</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<section id="overview">
<h2><a class="toc-backref" href="#id20" role="doc-backlink"><span class="section-number">5.14.1. </span>Overview</a><a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<div class="line-block">
<div class="line">コードリストとは、「コード値(value)とその表示名(label)」の集合である。</div>
</div>
<div class="line-block">
<div class="line">画面のセレクトボックスなどコード値を画面で表示する際のラベルへのマッピング表として利用される。</div>
</div>
<div class="line-block">
<div class="line">共通ライブラリでは、</div>
</div>
<ul class="simple">
<li><p>xmlファイルやDBに定義されたコードリストをアプリケーション起動時に読み込みキャッシュする機能</p></li>
<li><p>JSPやJavaクラスからコードリストを参照する機能</p></li>
<li><p>コードリストを用いて入力チェックするを行う機能</p></li>
</ul>
<div class="line-block">
<div class="line">を提供している。</div>
</div>
<div class="line-block">
<div class="line">また、応用的な使い方として、</div>
</div>
<ul class="simple">
<li><p>コードリストの国際化対応</p></li>
<li><p>キャッシュされたコードリストのリロード</p></li>
</ul>
<div class="line-block">
<div class="line">もサポートしている。</div>
</div>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>標準でリロードが可能なのは、DBに定義されたコードリストを使用する場合のみである。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">共通ライブラリでは、以下4種類のコードリスト実装を提供している。</div>
</div>
<span id="listofcodelist"></span><table class="docutils align-default" id="id18">
<caption><span class="caption-text"><strong>コードリスト種類一覧</strong></span><a class="headerlink" href="#id18" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 30%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>種類</p></th>
<th class="head"><p>内容</p></th>
<th class="head"><p>Reloadable</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.common.codelist.SimpleMapCodeList</span></code></p></td>
<td><p>xmlファイルに直接記述した内容を使用する。</p></td>
<td><p>NO</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.common.codelist.NumberRangeCodeList</span></code></p></td>
<td><p>数値の範囲のリストを作成する際に使用する。</p></td>
<td><p>NO</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.common.codelist.JdbcCodeList</span></code></p></td>
<td><p>DBから対象のコードをSQLで取得して使用する。</p></td>
<td><p>YES</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.common.codelist.i18n.SimpleI18nCodeList</span></code></p></td>
<td><p>java.util.Localeに応じたコードリストを使用する。</p></td>
<td><p>NO</p></td>
</tr>
</tbody>
</table>
<p>上記コードリストのインターフェースについて、共通ライブラリに <code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.common.codelist.CodeList</span></code> を提供している。</p>
<p>共通ライブラリで提供しているコードリストのクラス図構成を以下に示す。</p>
<figure class="align-center" id="id19">
<a class="reference internal image-reference" href="../_images/codelist-class-diagram.png"><img alt="codelist class diagram" src="../_images/codelist-class-diagram.png" style="width: 70%;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Picture - Image of codelist class diagram</strong></span><a class="headerlink" href="#id19" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="how-to-use">
<h2><a class="toc-backref" href="#id21" role="doc-backlink"><span class="section-number">5.14.2. </span>How to use</a><a class="headerlink" href="#how-to-use" title="Permalink to this heading">¶</a></h2>
<div class="line-block">
<div class="line">本項では、各種コードリストを使用する上での設定や実装方法を記述する。</div>
</div>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="#codelist-simple"><span class="std std-ref">SimpleMapCodeListの使用方法</span></a></p></li>
<li><p><a class="reference internal" href="#codelist-number"><span class="std std-ref">NumberRangeCodeListの使用方法</span></a></p></li>
<li><p><a class="reference internal" href="#codelist-jdbc"><span class="std std-ref">JdbcCodeListの使用方法</span></a></p></li>
<li><p><a class="reference internal" href="#codelisti18n"><span class="std std-ref">SimpleI18nCodeListの使用方法</span></a></p></li>
<li><p><a class="reference internal" href="#codelist-validate"><span class="std std-ref">コードリストを用いたコード値の入力チェック</span></a></p></li>
</ul>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="simplemapcodelist">
<span id="codelist-simple"></span><h3><a class="toc-backref" href="#id22" role="doc-backlink"><span class="section-number">5.14.2.1. </span>SimpleMapCodeListの使用方法</a><a class="headerlink" href="#simplemapcodelist" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.common.codelist.SimpleMapCodeList</span></code> とは、xmlファイルに定義した</div>
<div class="line">コード値をアプリケーション起動時に読み込み、そのまま使用するコードリストである。</div>
</div>
<ul class="simple">
<li><p>SimpleMapCodeListのイメージ</p></li>
</ul>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/codelist-simple.png"><img alt="codelist simple" src="../_images/codelist-simple.png" style="width: 70%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="id3">
<h4><a class="toc-backref" href="#id23" role="doc-backlink"><span class="section-number">5.14.2.1.1. </span>コードリスト設定例</a><a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h4>
<p>bean定義ファイルは、コードリスト用に作成することを推奨する。</p>
<p><strong>bean定義ファイル</strong></p>
<ul class="simple">
<li><p>xxx-codelist.xml</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="w"> </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;CL_ORDERSTATUS&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.codelist.SimpleMapCodeList&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
</span><span class="w">     </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;map&quot;</span><span class="nt">&gt;</span>
<span class="w">         </span><span class="nt">&lt;util:map&gt;</span>
<span class="hll"><span class="w">             </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Received&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (2) --&gt;</span>
</span><span class="w">             </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;2&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Sent&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">             </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;3&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Cancelled&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">         </span><span class="nt">&lt;/util:map&gt;</span>
<span class="w">     </span><span class="nt">&lt;/property&gt;</span>
<span class="w"> </span><span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">SimpleMapCodeListクラスをbean定義する。</div>
<div class="line">beanIDは、後述する <code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.web.codelist.CodeListInterceptor</span></code> のIDパターンに合致する名称にすること。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Mapの Key、Valueを定義する。</div>
<div class="line">map-class属性を省略した場合、 <code class="docutils literal notranslate"><span class="pre">java.util.LinkedHashMap</span></code> で登録されるため、上記例では、「名前と値」が、登録順にMapへ保持される。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">コードリスト用bean定義ファイルを作成後、既存bean定義ファイルにimportを行う必要がある。</div>
</div>
<ul class="simple">
<li><p>xxx-domain.xml</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="w"> </span><span class="nt">&lt;import</span><span class="w"> </span><span class="na">resource=</span><span class="s">&quot;classpath:META-INF/spring/projectName-codelist.xml&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
</span><span class="w"> </span><span class="nt">&lt;context:component-scan</span><span class="w"> </span><span class="na">base-package=</span><span class="s">&quot;com.example.domain&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="hll"><span class="w"> </span><span class="cm">&lt;!-- omitted --&gt;</span>
</span></pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">コードリスト用bean定義ファイルをimportする。</div>
<div class="line">component-scanしている間にimport先の情報が必要な場合があるため、</div>
<div class="line">importは <code class="docutils literal notranslate"><span class="pre">&lt;context:component-scan</span> <span class="pre">base-package=&quot;com.example.domain&quot;</span> <span class="pre">/&gt;</span></code> より上で設定する必要がある。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="jsp">
<span id="clientside"></span><h4><a class="toc-backref" href="#id24" role="doc-backlink"><span class="section-number">5.14.2.1.2. </span>JSPでのコードリスト使用</a><a class="headerlink" href="#jsp" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">共通ライブラリから提供しているインタセプターを用いることで、</div>
<div class="line">リクエストスコープに自動的に設定し、JSPからコードリストを容易に参照できる。</div>
</div>
<p><strong>bean定義ファイル</strong></p>
<ul class="simple">
<li><p>spring-mvc.xml</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">&lt;mvc:interceptors&gt;</span>
<span class="w">   </span><span class="nt">&lt;mvc:interceptor&gt;</span>
<span class="hll"><span class="w">     </span><span class="nt">&lt;mvc:mapping</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;/**&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
</span><span class="w">     </span><span class="nt">&lt;bean</span>
<span class="hll"><span class="w">       </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.codelist.CodeListInterceptor&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (2) --&gt;</span>
</span><span class="hll"><span class="w">       </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;codeListIdPattern&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;CL_.+&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (3) --&gt;</span>
</span><span class="w">     </span><span class="nt">&lt;/bean&gt;</span>
<span class="w">   </span><span class="nt">&lt;/mvc:interceptor&gt;</span>

<span class="w">   </span><span class="cm">&lt;!-- omitted --&gt;</span>

<span class="w"> </span><span class="nt">&lt;/mvc:interceptors&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">適用対象のパスを設定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">CodeListInterceptor クラスをbean定義する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">自動でリクエストスコープに設定するコードリストのbeanIDのパターンを設定する。</div>
<div class="line">パターンには <code class="docutils literal notranslate"><span class="pre">java.util.regex.Pattern</span></code> で使用する正規表現を設定すること。</div>
<div class="line">上記例では、idが”CL_XXX”形式で定義されているデータのみを対象とする。その場合、idが”CL_”で始まらないbean定義は取り込まれない。</div>
<div class="line">“CL_”で定義したbeanIDは、リクエストスコープに設定されるため、JSPで使用可能となる。</div>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>jspの実装例</strong></p>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;form:select</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;orderStatus&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;form:option</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="na">label=</span><span class="s">&quot;--Select--&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">  </span><span class="nt">&lt;form:options</span><span class="w"> </span><span class="na">items=</span><span class="s">&quot;${CL_ORDERSTATUS}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;/form:select&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">セレクトボックスの先頭にダミーの値を設定する場合、valueに空文字を指定すること。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">コードリストを定義したbeanIDを指定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>出力HTML</strong></p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">select</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;orderStatus&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;orderStatus&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>&quot;--Select--<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="p">&gt;</span>Received<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;2&quot;</span><span class="p">&gt;</span>Sent<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;3&quot;</span><span class="p">&gt;</span>Cancelled<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><strong>出力画面</strong></p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/codelist_selectbox.png"><img alt="codelist selectbox" src="../_images/codelist_selectbox.png" style="width: 30%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="java">
<span id="serverside"></span><h4><a class="toc-backref" href="#id25" role="doc-backlink"><span class="section-number">5.14.2.1.3. </span>Javaクラスでのコードリスト使用</a><a class="headerlink" href="#java" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">Javaクラスでコードリストを利用する場合、 <code class="docutils literal notranslate"><span class="pre">javax.inject.Inject</span></code> アノテーションと、</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">javax.inject.Named</span></code> アノテーションを設定してコードリストをインジェクションする。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;Named</span></code> にコードリスト名を指定する。</div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">javax.inject.Named</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.fw.common.codelist.CodeList</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CodeListController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Inject</span>
<span class="w">    </span><span class="nd">@Named</span><span class="p">(</span><span class="s">&quot;CL_ORDERSTATUS&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">CodeList</span><span class="w"> </span><span class="n">orderStatusCodeList</span><span class="p">;</span><span class="w"> </span><span class="c1">// (1)</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">existOrderStatus</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">target</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">orderStatusCodeList</span><span class="p">.</span><span class="na">asMap</span><span class="p">().</span><span class="na">containsKey</span><span class="p">(</span><span class="n">target</span><span class="p">);</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">beanIDが、”CL_ORDERSTATUS”であるコードリストをインジェクションする。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">CodeList#asMapメソッドでコードリストを <code class="docutils literal notranslate"><span class="pre">java.util.Map</span></code> 形式で取得する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="numberrangecodelist">
<span id="codelist-number"></span><h3><a class="toc-backref" href="#id26" role="doc-backlink"><span class="section-number">5.14.2.2. </span>NumberRangeCodeListの使用方法</a><a class="headerlink" href="#numberrangecodelist" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.common.codelist.NumberRangeCodeList</span></code> とは、</div>
<div class="line">アプリケーション起動時に、指定した数値の範囲をリストにするコードリストである。</div>
<div class="line">主に数だけのセレクトボックス、月や日付などのセレクトボックスに使用することを想定している。</div>
</div>
<ul class="simple">
<li><p>NumberRangeCodeListのイメージ</p></li>
</ul>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/codelist-number.png"><img alt="codelist number" src="../_images/codelist-number.png" style="width: 70%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>NumberRangeCodeListはアラビア数字のみ対応しており、漢数字やローマ数字には対応していない。
漢数字やローマ数字を表示したい場合はJdbcCodeList、SimpleMapCodeListに定義することで対応可能である。</p>
</div>
</div></blockquote>
<p>NumberRangeCodeListには、以下の特徴がある。</p>
<ol class="arabic simple">
<li><p>増加分(減少分)はintervalを設定することで変更できる。</p></li>
<li><p>Fromの値をToの値より小さくする場合、昇順にinterval分増加した値をFrom～Toの範囲分リストにする。</p></li>
<li><p>Toの値をFromの値より小さくする場合、降順にinterval分減少した値をTo～Fromの範囲分リストにする。</p></li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="id4">
<h4><a class="toc-backref" href="#id27" role="doc-backlink"><span class="section-number">5.14.2.2.1. </span>コードリスト設定例</a><a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h4>
<p>Fromの値をToの値より小さくする(From &lt; To)場合の実装例を、以下に示す。</p>
<p><strong>bean定義ファイル</strong></p>
<ul class="simple">
<li><p>xxx-codelist.xml</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;CL_MONTH&quot;</span>
<span class="w">    </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.codelist.NumberRangeCodeList&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;from&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;to&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;12&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (3) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;valueFormat&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;%d&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (4) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;labelFormat&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;%02d&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (5) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;interval&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (6) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">NumberRangeCodeListをbean定義する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">範囲開始の値を指定する。省略した場合、”0”が設定される。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">範囲終了の値を設定する。指定必須。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Mapに設定されるkeyのフォーマット形式を設定する。フォーマット形式は <code class="docutils literal notranslate"><span class="pre">java.lang.String.format</span></code> の形式が使用される。</div>
<div class="line">省略した場合、”%s”が設定される。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Mapに設定されるvalueのフォーマット形式を設定する。フォーマット形式は <code class="docutils literal notranslate"><span class="pre">java.lang.String.format</span></code> の形式が使用される。</div>
<div class="line">省略した場合、”%s”が設定される。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">増加する値を設定する。省略した場合、”1”が設定される。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id5">
<h4><a class="toc-backref" href="#id28" role="doc-backlink"><span class="section-number">5.14.2.2.2. </span>JSPでのコードリスト使用</a><a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">設定例の詳細は、前述した <a class="reference internal" href="#clientside"><span class="std std-ref">JSPでのコードリスト使用</span></a> を参照されたい。</div>
</div>
<p><strong>jspの実装例</strong></p>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;form:select</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;depMonth&quot;</span><span class="w"> </span><span class="na">items=</span><span class="s">&quot;${CL_MONTH}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p><strong>出力HTML</strong></p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">select</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;depMonth&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;depMonth&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="p">&gt;</span>01<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;2&quot;</span><span class="p">&gt;</span>02<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;3&quot;</span><span class="p">&gt;</span>03<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;4&quot;</span><span class="p">&gt;</span>04<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;5&quot;</span><span class="p">&gt;</span>05<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;6&quot;</span><span class="p">&gt;</span>06<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;7&quot;</span><span class="p">&gt;</span>07<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;8&quot;</span><span class="p">&gt;</span>08<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;9&quot;</span><span class="p">&gt;</span>09<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;10&quot;</span><span class="p">&gt;</span>10<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;11&quot;</span><span class="p">&gt;</span>11<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;12&quot;</span><span class="p">&gt;</span>12<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><strong>出力画面</strong></p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/codelist_numberrenge.png"><img alt="codelist numberrenge" src="../_images/codelist_numberrenge.png" style="width: 5%;" /></a>
</figure>
<p>次に、Toの値をFromの値より小さくする(To &lt; From)場合の実装例を、以下に示す。</p>
<p><strong>bean定義ファイル</strong></p>
<ul class="simple">
<li><p>xxx-codelist.xml</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;CL_BIRTH_YEAR&quot;</span>
<span class="w">    </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.codelist.NumberRangeCodeList&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;from&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;2013&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;to&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;2000&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">範囲開始の値を指定する。name属性”to”のvalue属性の値より大きい値を指定する。</div>
<div class="line">この指定によって、interval分減少した値を、To～Fromの範囲分のリストとして、降順に表示する。</div>
<div class="line">intervalは設定していないため、デフォルトの値1が適用される。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">範囲終了の値を設定する。</div>
<div class="line">本例では、2000を指定することにより、リストには2013～2000までの範囲で1ずつ減少して格納される。</div>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>jspの実装例</strong></p>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;form:select</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;depYear&quot;</span><span class="w"> </span><span class="na">items=</span><span class="s">&quot;${CL_Year}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p><strong>出力HTML</strong></p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">select</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;depYear&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;depYear&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;2013&quot;</span><span class="p">&gt;</span>2013<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;2012&quot;</span><span class="p">&gt;</span>2012<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;2011&quot;</span><span class="p">&gt;</span>2011<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;2010&quot;</span><span class="p">&gt;</span>2010<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;2009&quot;</span><span class="p">&gt;</span>2009<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;2008&quot;</span><span class="p">&gt;</span>2008<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;2007&quot;</span><span class="p">&gt;</span>2007<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;2006&quot;</span><span class="p">&gt;</span>2006<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;2005&quot;</span><span class="p">&gt;</span>2005<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;2004&quot;</span><span class="p">&gt;</span>2004<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;2003&quot;</span><span class="p">&gt;</span>2003<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;2002&quot;</span><span class="p">&gt;</span>2002<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;2001&quot;</span><span class="p">&gt;</span>2001<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;2000&quot;</span><span class="p">&gt;</span>2000<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><strong>出力画面</strong></p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/codelist_numberrenge2.png"><img alt="codelist numberrenge2" src="../_images/codelist_numberrenge2.png" style="width: 5%;" /></a>
</figure>
<p>次に、interval値を設定する場合の実装例を、以下に示す。</p>
<p><strong>bean定義ファイル</strong></p>
<ul class="simple">
<li><p>xxx-codelist.xml</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;CL_WEEK&quot;</span>
<span class="w">    </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.codelist.NumberRangeCodeList&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;from&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;to&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;31&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;valueFormat&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;%d&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;labelFormat&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;%02d&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;interval&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;7&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">増加(減少)値を指定する。この指定によって、interval分増加した値を、From～Toの範囲分のリストとして、昇順に表示する。</div>
<div class="line">また、intervalの値が範囲を超えた場合は出力されない。</div>
<div class="line">上記の例だと、リストには1,8,15,22,29が格納される。(36は範囲(1～31)を超えている為、出力されない)</div>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>jspの実装例</strong></p>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;form:select</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;depWeek&quot;</span><span class="w"> </span><span class="na">items=</span><span class="s">&quot;${CL_WEEK}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p><strong>出力HTML</strong></p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">select</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;depWeek&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;depWeek&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="p">&gt;</span>01<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;8&quot;</span><span class="p">&gt;</span>08<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;15&quot;</span><span class="p">&gt;</span>15<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;22&quot;</span><span class="p">&gt;</span>22<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;29&quot;</span><span class="p">&gt;</span>29<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><strong>出力画面</strong></p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/codelist_numberrenge3.png"><img alt="codelist numberrenge3" src="../_images/codelist_numberrenge3.png" style="width: 5%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id6">
<h4><a class="toc-backref" href="#id29" role="doc-backlink"><span class="section-number">5.14.2.2.3. </span>Javaクラスでのコードリスト使用</a><a class="headerlink" href="#id6" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">設定例の詳細は、前述した <a class="reference internal" href="#serverside"><span class="std std-ref">Javaクラスでのコードリスト使用</span></a> を参照されたい。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="jdbccodelist">
<span id="codelist-jdbc"></span><h3><a class="toc-backref" href="#id30" role="doc-backlink"><span class="section-number">5.14.2.3. </span>JdbcCodeListの使用方法</a><a class="headerlink" href="#jdbccodelist" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.common.codelist.JdbcCodeList</span></code> とは、アプリケーション起動時にDBから値を取得し、</div>
<div class="line">コードリストを作成するクラスである。このリストはキャッシュされる。</div>
<div class="line">また、取得する値はリロードにより動的に変更できる。詳細は <a class="reference internal" href="#codelisttaskscheduler"><span class="std std-ref">コードリストをリロードする場合</span></a> 参照されたい。</div>
</div>
<ul class="simple">
<li><p>JdbcCodeListのイメージ</p></li>
</ul>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/codelist-jdbc.png"><img alt="codelist simple" src="../_images/codelist-jdbc.png" style="width: 70%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="id7">
<h4><a class="toc-backref" href="#id31" role="doc-backlink"><span class="section-number">5.14.2.3.1. </span>コードリスト設定例</a><a class="headerlink" href="#id7" title="Permalink to this heading">¶</a></h4>
<p><strong>テーブル定義(authority)</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>authority_id</p></th>
<th class="head"><p>authority_name</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">01</div>
</div>
</td>
<td><div class="line-block">
<div class="line">STAFF_MANAGEMENT</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">02</div>
</div>
</td>
<td><div class="line-block">
<div class="line">MASTER_MANAGEMENT</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">03</div>
</div>
</td>
<td><div class="line-block">
<div class="line">STOCK_MANAGEMENT</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">04</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ORDER_MANAGEMENT</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">05</div>
</div>
</td>
<td><div class="line-block">
<div class="line">SHOW_SHOPPING_CENTER</div>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>bean定義ファイル</strong></p>
<ul class="simple">
<li><p>xxx-codelist.xml</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;CL_AUTHORITIES&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.codelist.JdbcCodeList&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;dataSource&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;querySql&quot;</span>
<span class="w">        </span><span class="na">value=</span><span class="s">&quot;SELECT authority_id, authority_name FROM authority ORDER BY authority_id&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;valueColumn&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;authority_id&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (3) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;labelColumn&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;authority_name&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (4) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">JdbcCodeListクラスをbean定義する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">querySqlプロパティに取得するSQLを記述する。その際、 <strong>必ず「ORDER BY」を指定し、順序を確定させること。</strong></div>
<div class="line">「ORDER BY」を指定しないと、取得する度に順序が変わってしまう。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">valueColumnプロパティに、MapのKeyに該当する値を設定する。この例ではauthority_idを設定している。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">labelColumnプロパティに、MapのValueに該当する値を設定する。この例ではauthority_nameを設定している。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id8">
<h4><a class="toc-backref" href="#id32" role="doc-backlink"><span class="section-number">5.14.2.3.2. </span>JSPでのコードリスト使用</a><a class="headerlink" href="#id8" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">下記に示す設定の詳細について、前述した <a class="reference internal" href="#clientside"><span class="std std-ref">JSPでのコードリスト使用</span></a> を参照されたい。</div>
</div>
<p><strong>jspの実装例</strong></p>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;form:checkboxes</span><span class="w"> </span><span class="na">items=</span><span class="s">&quot;${CL_AUTHORITIES}&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p><strong>出力HTML</strong></p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;authorities1&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;authorities&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;01&quot;</span><span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;authorities1&quot;</span><span class="p">&gt;</span>STAFF_MANAGEMENT<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;authorities2&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;authorities&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;02&quot;</span><span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;authorities2&quot;</span><span class="p">&gt;</span>MASTER_MANAGEMENT<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;authorities3&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;authorities&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;03&quot;</span><span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;authorities3&quot;</span><span class="p">&gt;</span>STOCK_MANAGEMENT<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;authorities4&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;authorities&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;04&quot;</span><span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;authorities4&quot;</span><span class="p">&gt;</span>ORDER_MANAGEMENT<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;authorities5&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;authorities&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;05&quot;</span><span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;authorities5&quot;</span><span class="p">&gt;</span>SHOW_SHOPPING_CENTER<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><strong>出力画面</strong></p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/codelist_checkbox.png"><img alt="codelist checkbox" src="../_images/codelist_checkbox.png" style="width: 30%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id9">
<h4><a class="toc-backref" href="#id33" role="doc-backlink"><span class="section-number">5.14.2.3.3. </span>Javaクラスでのコードリスト使用</a><a class="headerlink" href="#id9" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">下記に示す設定の詳細について、前述した <a class="reference internal" href="#serverside"><span class="std std-ref">Javaクラスでのコードリスト使用</span></a> を参照されたい。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="codelist-validate">
<span id="id10"></span><h3><a class="toc-backref" href="#id34" role="doc-backlink"><span class="section-number">5.14.2.4. </span>コードリストを用いたコード値の入力チェック</a><a class="headerlink" href="#codelist-validate" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line">入力値がコードリスト内に定義されたKey値であるかどうかチェックするような場合、</div>
<div class="line">共通ライブラリでは、BeanValidation用のアノテーション、 <code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.common.codelist.ExistInCodeList</span></code> を提供している。</div>
</div>
<div class="line-block">
<div class="line">BeanValidationや、メッセージ出力方法の詳細については、 <a class="reference internal" href="Validation.html"><span class="doc">入力チェック</span></a> を参照されたい。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="existincodelist">
<h4><a class="toc-backref" href="#id35" role="doc-backlink"><span class="section-number">5.14.2.4.1. </span>&#64;ExistInCodeList の設定例</a><a class="headerlink" href="#existincodelist" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">コードリストを用いた入力チェック方法について、以下に実装例を示す。</div>
</div>
<p><strong>bean定義ファイル</strong></p>
<ul class="simple">
<li><p>xxx-codelist.xml</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;CD_GENDER&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.codelist.SimpleMapCodeList&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;map&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;map&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;M&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Male&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;F&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Female&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/map&gt;</span>
<span class="w">    </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<p><strong>Formオブジェクト</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Person</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@ExistInCodeList</span><span class="p">(</span><span class="n">codeListId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;CD_GENDER&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">gender</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// getter and setter omitted</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">入力チェックを行いたいフィールドに対して、 <code class="docutils literal notranslate"><span class="pre">&#64;ExistInCodeList</span></code> アノテーションを設定し、</div>
<div class="line">codeListIdにチェック元となる、コードリストを指定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>上記の結果、 <code class="docutils literal notranslate"><span class="pre">gender</span></code> にM、F以外の文字が格納されている場合、エラーになる。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><code class="docutils literal notranslate"><span class="pre">&#64;ExistInCodeList</span></code> の入力チェックでサポートしている型は、 <code class="docutils literal notranslate"><span class="pre">String</span></code> または <code class="docutils literal notranslate"><span class="pre">Character</span></code> のみである。
そのため、 <code class="docutils literal notranslate"><span class="pre">&#64;ExistInCodeList</span></code> をつけるフィールドは意味的に整数型であっても、Stringで定義する必要がある。(年・月・日等)</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="simplei18ncodelist">
<span id="codelisti18n"></span><h3><a class="toc-backref" href="#id36" role="doc-backlink"><span class="section-number">5.14.2.5. </span>SimpleI18nCodeListの使用方法</a><a class="headerlink" href="#simplei18ncodelist" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.common.codelist.i18n.SimpleI18nCodeList</span></code> は、国際化に対応しているコードリストである。</div>
<div class="line">ロケール毎にコードリストを設定することで、ロケールに対応したコードリストを返却できる。</div>
</div>
<ul class="simple">
<li><p>SimpleI18nCodeListのイメージ</p></li>
</ul>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/codelist-i18n.png"><img alt="codelist i18n" src="../_images/codelist-i18n.png" style="width: 70%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="id11">
<h4><a class="toc-backref" href="#id37" role="doc-backlink"><span class="section-number">5.14.2.5.1. </span>コードリスト設定例</a><a class="headerlink" href="#id11" title="Permalink to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">SimpleI18nCodeList</span></code>は行が<code class="docutils literal notranslate"><span class="pre">Local</span></code>、列がコード値、セルの内容がラベルである2次元のテーブルをイメージすると理解しやすい。</p>
<div class="line-block">
<div class="line">料金を選択するセレクトボックスの場合の例に上げると以下のようなテーブルができる。</div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 15%" />
<col style="width: 15%" />
<col style="width: 15%" />
<col style="width: 15%" />
<col style="width: 15%" />
<col style="width: 15%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head stub"><p>row=Locale,column=Code</p></th>
<th class="head"><p>0</p></th>
<th class="head"><p>10000</p></th>
<th class="head"><p>20000</p></th>
<th class="head"><p>30000</p></th>
<th class="head"><p>40000</p></th>
<th class="head"><p>50000</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><th class="stub"><p>en</p></th>
<td><p>unlimited</p></td>
<td><p>Less than $10,000</p></td>
<td><p>Less than $20,000</p></td>
<td><p>Less than $30,000</p></td>
<td><p>Less than $40,000</p></td>
<td><p>Less than $50,000</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>ja</p></th>
<td><p>上限なし</p></td>
<td><p>10,000円以下</p></td>
<td><p>20,000円以下</p></td>
<td><p>30,000円以下</p></td>
<td><p>40,000円以下</p></td>
<td><p>50,000円以下</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">この国際化対応コードリストのテーブルを構築するために<code class="docutils literal notranslate"><span class="pre">SimpleI18nCodeList</span></code>は3つの設定方法を用意している。</div>
</div>
<ul class="simple">
<li><p>行単位でLocal毎の<code class="docutils literal notranslate"><span class="pre">CodeList</span></code>を設定する</p></li>
<li><p>行単位でLocal毎の<code class="docutils literal notranslate"><span class="pre">java.util.Map</span></code>(key=コード値, value=ラベル)を設定する</p></li>
<li><p>列単位でコード値毎の<code class="docutils literal notranslate"><span class="pre">java.util.Map</span></code>(key=Locale, value=ラベル)を設定する</p></li>
</ul>
<div class="line-block">
<div class="line">基本的には、「行単位でLocal毎の<code class="docutils literal notranslate"><span class="pre">CodeList</span></code>を設定する」方法でコードリストを設定することを推奨する。</div>
</div>
<div class="line-block">
<div class="line">上記例の料金を選択するセレクトボックスの場合を行単位でLocal毎の<code class="docutils literal notranslate"><span class="pre">CodeList</span></code>を設定する方法について説明する。</div>
<div class="line">他の設定方法については  <a class="reference internal" href="#aftercodelisti18n"><span class="std std-ref">SimpleI18nCodeListのコードリスト設定方法</span></a> 参照されたい。</div>
</div>
<ul>
<li><p>Bean定義ファイル(xxx-codelist.xml)</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;CL_I18N_PRICE&quot;</span>
<span class="w">    </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.codelist.i18n.SimpleI18nCodeList&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;rowsByCodeList&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">        </span><span class="nt">&lt;util:map&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;en&quot;</span><span class="w"> </span><span class="na">value-ref=</span><span class="s">&quot;CL_PRICE_EN&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;ja&quot;</span><span class="w"> </span><span class="na">value-ref=</span><span class="s">&quot;CL_PRICE_JA&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/util:map&gt;</span>
<span class="w">    </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">rowsByCodeListプロパティにkeyが<code class="docutils literal notranslate"><span class="pre">java.lang.Locale</span></code>のMapを設定する。</div>
<div class="line">Mapには、keyにロケール、value-refにロケールに対応したコードリストクラスの参照先を指定する。</div>
<div class="line">Mapのvalueは各ロケールに対応したコードリストクラスを参照する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">value-refのコードリストクラスについては、 <code class="docutils literal notranslate"><span class="pre">SimpleMapCodeList</span></code> や <code class="docutils literal notranslate"><span class="pre">JdbcCodeList</span></code> の2通りでコードリストを定義することができる。</div>
</div>
</li>
<li><p>Locale毎に<code class="docutils literal notranslate"><span class="pre">SimpleMapCodeList</span></code>を用意する場合のBean定義ファイル(xxx-codelist.xml)</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;CL_I18N_PRICE&quot;</span>
<span class="w">    </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.codelist.i18n.SimpleI18nCodeList&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;rowsByCodeList&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;util:map&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;en&quot;</span><span class="w"> </span><span class="na">value-ref=</span><span class="s">&quot;CL_PRICE_EN&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;ja&quot;</span><span class="w"> </span><span class="na">value-ref=</span><span class="s">&quot;CL_PRICE_JA&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/util:map&gt;</span>
<span class="w">    </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;CL_PRICE_EN&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.codelist.SimpleMapCodeList&quot;</span><span class="nt">&gt;</span><span class="w">  </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;map&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;util:map&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;unlimited&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;10000&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Less than $10,000&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;20000&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Less than $20,000&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;30000&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Less than $30,000&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;40000&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Less than $40,000&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;50000&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Less than $50,000&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/util:map&gt;</span>
<span class="w">    </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;CL_PRICE_JA&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.codelist.SimpleMapCodeList&quot;</span><span class="nt">&gt;</span><span class="w">  </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;map&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;util:map&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;上限なし&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;10000&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;10,000円以下&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;20000&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;20,000円以下&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;30000&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;30,000円以下&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;40000&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;40,000円以下&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;50000&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;50,000円以下&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/util:map&gt;</span>
<span class="w">    </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ロケールが”en”であるbean定義 <code class="docutils literal notranslate"><span class="pre">CL_PRICE_EN</span></code> について、コードリストクラスを <code class="docutils literal notranslate"><span class="pre">SimpleMapCodeList</span></code> で設定している。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ロケールが”ja”であるbean定義 <code class="docutils literal notranslate"><span class="pre">CL_PRICE_JA</span></code> について、コードリストクラスを <code class="docutils literal notranslate"><span class="pre">SimpleMapCodeList</span></code> で設定している。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
<li><p>Locale毎に<code class="docutils literal notranslate"><span class="pre">JdbcCodeList</span></code>を用意する場合のBean定義ファイル(xxx-codelist.xml)</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;CL_I18N_PRICE&quot;</span>
<span class="w">    </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.codelist.i18n.SimpleI18nCodeList&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;rowsByCodeList&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;util:map&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;en&quot;</span><span class="w"> </span><span class="na">value-ref=</span><span class="s">&quot;CL_PRICE_EN&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;ja&quot;</span><span class="w"> </span><span class="na">value-ref=</span><span class="s">&quot;CL_PRICE_JA&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/util:map&gt;</span>
<span class="w">    </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;CL_PRICE_EN&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.codelist.JdbcCodeList&quot;</span><span class="nt">&gt;</span><span class="w">  </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;dataSource&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;querySql&quot;</span>
<span class="w">        </span><span class="na">value=</span><span class="s">&quot;SELECT code, label FROM price WHERE locale = &#39;en&#39; ORDER BY code&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;valueColumn&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;code&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;labelColumn&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;label&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;CL_PRICE_JA&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.codelist.JdbcCodeList&quot;</span><span class="nt">&gt;</span><span class="w">  </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;dataSource&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;querySql&quot;</span>
<span class="w">        </span><span class="na">value=</span><span class="s">&quot;SELECT code, label FROM price WHERE locale = &#39;ja&#39; ORDER BY code&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;valueColumn&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;code&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;labelColumn&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;label&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ロケールが”en”であるbean定義 <code class="docutils literal notranslate"><span class="pre">CL_PRICE_EN</span></code> について、コードリストクラスを <code class="docutils literal notranslate"><span class="pre">JdbcCodeList</span></code> で設定している。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ロケールが”ja”であるbean定義 <code class="docutils literal notranslate"><span class="pre">CL_PRICE_JA</span></code> について、コードリストクラスを <code class="docutils literal notranslate"><span class="pre">JdbcCodeList</span></code> で設定している。</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>テーブル定義(priceテーブル)には以下のデータを投入する。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>locale</p></th>
<th class="head"><p>code</p></th>
<th class="head"><p>label</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">en</div>
</div>
</td>
<td><div class="line-block">
<div class="line">0</div>
</div>
</td>
<td><div class="line-block">
<div class="line">unlimited</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">en</div>
</div>
</td>
<td><div class="line-block">
<div class="line">10000</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Less than $10,000</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">en</div>
</div>
</td>
<td><div class="line-block">
<div class="line">20000</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Less than $20,000</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">en</div>
</div>
</td>
<td><div class="line-block">
<div class="line">30000</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Less than $30,000</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">en</div>
</div>
</td>
<td><div class="line-block">
<div class="line">40000</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Less than $40,000</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">en</div>
</div>
</td>
<td><div class="line-block">
<div class="line">50000</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Less than $50,000</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">ja</div>
</div>
</td>
<td><div class="line-block">
<div class="line">0</div>
</div>
</td>
<td><div class="line-block">
<div class="line">上限なし</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">ja</div>
</div>
</td>
<td><div class="line-block">
<div class="line">10000</div>
</div>
</td>
<td><div class="line-block">
<div class="line">10,000円以下</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">ja</div>
</div>
</td>
<td><div class="line-block">
<div class="line">20000</div>
</div>
</td>
<td><div class="line-block">
<div class="line">20,000円以下</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">ja</div>
</div>
</td>
<td><div class="line-block">
<div class="line">30000</div>
</div>
</td>
<td><div class="line-block">
<div class="line">30,000円以下</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">ja</div>
</div>
</td>
<td><div class="line-block">
<div class="line">40000</div>
</div>
</td>
<td><div class="line-block">
<div class="line">40,000円以下</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">ja</div>
</div>
</td>
<td><div class="line-block">
<div class="line">50000</div>
</div>
</td>
<td><div class="line-block">
<div class="line">50,000円以下</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>現時点で <code class="docutils literal notranslate"><span class="pre">SimpleI18nCodeList</span></code> はreloadableに対応していない。
<code class="docutils literal notranslate"><span class="pre">SimpleI18nCodeList</span></code> が参照している <code class="docutils literal notranslate"><span class="pre">JdbcCodeList</span></code> (reloadableなCodeList)をリロードしても、 <code class="docutils literal notranslate"><span class="pre">SimpleI18nCodeList</span></code> には反映されないことに注意。
もし、reloadableに対応したい場合は独自実装する必要がある。
実装方法については、 <a class="reference internal" href="#originalcustomizecodelist"><span class="std std-ref">コードリストを独自カスタマイズする方法</span></a> を参照されたい。</p>
</div>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id12">
<h4><a class="toc-backref" href="#id38" role="doc-backlink"><span class="section-number">5.14.2.5.2. </span>JSPでのコードリスト使用</a><a class="headerlink" href="#id12" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">基本的な設定は、前述した <a class="reference internal" href="#clientside"><span class="std std-ref">JSPでのコードリスト使用</span></a> と同様のため、説明は省略する。</div>
</div>
<p><strong>bean定義ファイル</strong></p>
<ul class="simple">
<li><p>spring-mvc.xml</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;mvc:interceptors&gt;</span>
<span class="w">  </span><span class="nt">&lt;mvc:interceptor&gt;</span>
<span class="w">    </span><span class="nt">&lt;mvc:mapping</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;/**&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;bean</span>
<span class="w">      </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.codelist.CodeListInterceptor&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;codeListIdPattern&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;CL_.+&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;fallbackTo&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;en&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w">  </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span>
<span class="w">  </span><span class="nt">&lt;/mvc:interceptor&gt;</span>

<span class="w">  </span><span class="cm">&lt;!-- omitted --&gt;</span>

<span class="nt">&lt;/mvc:interceptors&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">リクエストのロケールがコードリスト定義されていなかった場合、</div>
<div class="line">fallbackToプロパティに設定されたロケールでコードリストを取得する。</div>
<div class="line">fallbackToプロパティが設定されていない場合、JVMのデフォルトロケールがfallbackToプロパティとして使用される。</div>
<div class="line">fallbackToプロパティに設定されたロケールでも、コードリストが取得されない場合、WARNログを出力し、空のMapを返却する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>jspの実装例</strong></p>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;form:select</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;basePrice&quot;</span><span class="w"> </span><span class="na">items=</span><span class="s">&quot;${CL_I18N_PRICE}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p><strong>出力HTML lang=en</strong></p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">select</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;basePrice&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;basePrice&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;0&quot;</span><span class="p">&gt;</span>unlimited<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="p">&gt;</span>Less than $10,000<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;2&quot;</span><span class="p">&gt;</span>Less than $20,000<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;3&quot;</span><span class="p">&gt;</span>Less than $30,000<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;4&quot;</span><span class="p">&gt;</span>Less than $40,000<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;5&quot;</span><span class="p">&gt;</span>Less than $50,000<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><strong>出力HTML lang=ja</strong></p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">select</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;basePrice&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;basePrice&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;0&quot;</span><span class="p">&gt;</span>上限なし<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="p">&gt;</span>10,000円以下<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;2&quot;</span><span class="p">&gt;</span>20,000円以下<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;3&quot;</span><span class="p">&gt;</span>30,000円以下<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;4&quot;</span><span class="p">&gt;</span>40,000円以下<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;5&quot;</span><span class="p">&gt;</span>50,000円以下<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><strong>出力画面 lang=en</strong></p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/codelist_i18n_en.png"><img alt="codelist i18n en" src="../_images/codelist_i18n_en.png" style="width: 15%;" /></a>
</figure>
<p><strong>出力画面 lang=ja</strong></p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/codelist_i18n_ja.png"><img alt="codelist i18n ja" src="../_images/codelist_i18n_ja.png" style="width: 15%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id13">
<h4><a class="toc-backref" href="#id39" role="doc-backlink"><span class="section-number">5.14.2.5.3. </span>Javaクラスでのコードリスト使用</a><a class="headerlink" href="#id13" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">基本的な設定は、前述した <a class="reference internal" href="#serverside"><span class="std std-ref">Javaクラスでのコードリスト使用</span></a> と同様のため、説明は省略する。</div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CodeListController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Inject</span>
<span class="w">    </span><span class="nd">@Named</span><span class="p">(</span><span class="s">&quot;CL_I18N_PRICE&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">I18nCodeList</span><span class="w"> </span><span class="n">priceCodeList</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getPriceMessage</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">targetPrice</span><span class="p">,</span><span class="w"> </span><span class="n">Locale</span><span class="w"> </span><span class="n">locale</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="n">priceCodeList</span><span class="p">.</span><span class="na">asMap</span><span class="p">(</span><span class="n">locale</span><span class="p">).</span><span class="na">get</span><span class="p">(</span><span class="n">targetPrice</span><span class="p">);</span><span class="w">  </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">I18nCodeList#asMap(Locale)で対応したロケールのMapを取得することができる。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
</section>
<section id="how-to-extend">
<h2><a class="toc-backref" href="#id40" role="doc-backlink"><span class="section-number">5.14.3. </span>How to extend</a><a class="headerlink" href="#how-to-extend" title="Permalink to this heading">¶</a></h2>
<section id="settingfetchsize">
<span id="id14"></span><h3><a class="toc-backref" href="#id41" role="doc-backlink"><span class="section-number">5.14.3.1. </span>JdbcCodeListの読み込む件数が大きい場合</a><a class="headerlink" href="#settingfetchsize" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line">JdbcCodeListの読み込む件数が大きい(数百)場合、Webアプリの起動に時間が掛かる。</div>
<div class="line">原因は、DB問い合わせ時に全件取得することがあり、DBからリストを取得する時間がかかってしまうためである。</div>
<div class="line">(fetchSizeのデフォルト設定が、全件取得になっている場合がある。)</div>
</div>
<div class="line-block">
<div class="line">この問題は、fetchSizeを適切な値に指定することで解決できる。</div>
<div class="line">fetchSizeを変更するには <code class="docutils literal notranslate"><span class="pre">org.springframework.jdbc.core.JdbcTemplate</span></code> のfetchSizeを設定する必要がある。</div>
<div class="line">以下に実装例を示す。</div>
</div>
<p><strong>bean定義ファイル</strong></p>
<ul class="simple">
<li><p>xxx-infra.xml</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;jdbcTemplateForCodeList&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span><span class="w"> </span><span class="nt">&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;dataSource&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;fetchSize&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1000&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;AbstractJdbcCodeList&quot;</span>
<span class="w">    </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.codelist.JdbcCodeList&quot;</span><span class="w"> </span><span class="na">abstract=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (3) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;jdbcTemplate&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;jdbcTemplateForCodeList&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (4) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;CL_AUTHORITIES&quot;</span><span class="w"> </span><span class="na">parent=</span><span class="s">&quot;AbstractJdbcCodeList&quot;</span><span class="w"> </span><span class="nt">&gt;</span><span class="cm">&lt;!-- (5) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;querySql&quot;</span>
<span class="w">        </span><span class="na">value=</span><span class="s">&quot;SELECT authority_id, authority_name FROM authority ORDER BY authority_id&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;valueColumn&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;authority_id&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;labelColumn&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;authority_name&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">org.springframework.jdbc.core.JdbcTemplate</span></code> クラスをbean定義する。</div>
<div class="line">独自にfetchSizeを設定するために必要となる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">fetchSizeを設定する。適切な値を設定すること。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">JdbcCodeListの共通bean定義。</div>
<div class="line">他のJdbcCodeListの共通部分を設定している。そのため、基本JdbcCodeListのbean定義はこのbean定義を親クラスに設定する。</div>
<div class="line">abstract属性をtrueにすることで、このbeanはインスタンス化されない。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">(1)で設定したjdbcTemplateを設定。</div>
<div class="line">fetchSizeを設定したJdbcTemplateを、JdbcCodeListに格納している。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">JdbcCodeListのbean定義。</div>
<div class="line">parent属性を(3)のbean定義を親クラスとして設定することで、fetchSizeを設定したJdbcCodeListが設定される。</div>
<div class="line">このbean定義では、クエリに関する設定のみを行い、必要なCodeList分作成する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="codelisttaskscheduler">
<span id="id15"></span><h3><a class="toc-backref" href="#id42" role="doc-backlink"><span class="section-number">5.14.3.2. </span>コードリストをリロードする場合</a><a class="headerlink" href="#codelisttaskscheduler" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line">前述した共通ライブラリで提供しているコードリストは、アプリケーション起動時に読み込まれ、それ以降は、基本的に更新されない。</div>
<div class="line">しかし、コードリストのマスタデータを更新した時、コードリストも更新したい場合がある。</div>
<div class="line">例：JdbcCodeListを使用して、DBのマスタを変更した時にコードリストの更新を行う場合。</div>
</div>
<div class="line-block">
<div class="line">共通ライブラリでは、 <code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.common.codelist.ReloadableCodeList</span></code> インタフェースを用意している。</div>
<div class="line">上記インタフェースを実装したクラスは、refreshメソッドを実装しており、refreshメソッドを呼ぶことでコードリストの更新が可能となる。</div>
<div class="line">JdbcCodeListは、ReloadableCodeListインターフェースを実装しているため、コードリストの更新ができる。</div>
</div>
<div class="line-block">
<div class="line">コードリストの更新方法としては、以下2点の方法がある。</div>
</div>
<ol class="arabic simple">
<li><p>Task Schedulerで実現する方法</p></li>
<li><p>Controller(Service)クラスでrefreshメソッドを呼び出す方法</p></li>
</ol>
<div class="line-block">
<div class="line">本ガイドラインでは、<a class="reference external" href="http://docs.spring.io/spring/docs/3.2.x/spring-framework-reference/html/scheduling.html">Springから提供されているTask Scheduler</a>を使用して、コードリストを定期的にリロードする方式を基本的に推奨する。</div>
</div>
<div class="line-block">
<div class="line">ただし、任意のタイミングでコードリストをリフレッシュする必要がある場合はControllerクラスでrefreshメソッドを呼び出す方法で実現すればよい。</div>
</div>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>ReloadableCodeListインターフェースを実装しているコードリストについては、 <a class="reference internal" href="#listofcodelist"><span class="std std-ref">コードリスト種類一覧</span></a> を参照されたい。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="task-scheduler">
<h4><a class="toc-backref" href="#id43" role="doc-backlink"><span class="section-number">5.14.3.2.1. </span>Task Schedulerで実現する方法</a><a class="headerlink" href="#task-scheduler" title="Permalink to this heading">¶</a></h4>
<p>Task Schedulerの設定例について、以下に示す。</p>
<p><strong>bean定義ファイル</strong></p>
<ul class="simple">
<li><p>xxx-codelist.xml</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;task:scheduler</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;taskScheduler&quot;</span><span class="w"> </span><span class="na">pool-size=</span><span class="s">&quot;10&quot;</span><span class="nt">/&gt;</span><span class="w">  </span><span class="cm">&lt;!-- (1) --&gt;</span>

<span class="nt">&lt;task:scheduled-tasks</span><span class="w"> </span><span class="na">scheduler=</span><span class="s">&quot;taskScheduler&quot;</span><span class="nt">&gt;</span><span class="w">  </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;task:scheduled</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;CL_AUTHORITIES&quot;</span><span class="w"> </span><span class="na">method=</span><span class="s">&quot;refresh&quot;</span><span class="w"> </span><span class="na">cron=</span><span class="s">&quot;${cron.codelist.refreshTime}&quot;</span><span class="nt">/&gt;</span><span class="w">  </span><span class="cm">&lt;!-- (3) --&gt;</span>
<span class="nt">&lt;/task:scheduled-tasks&gt;</span>

<span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;CL_AUTHORITIES&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.codelist.JdbcCodeList&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;dataSource&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;querySql&quot;</span>
<span class="w">        </span><span class="na">value=</span><span class="s">&quot;SELECT authority_id, authority_name FROM authority ORDER BY authority_id&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;valueColumn&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;authority_id&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;labelColumn&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;authority_name&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;task:scheduler&gt;</span></code> の要素を定義する、pool-size属性にスレッドのプールサイズを指定する。</div>
<div class="line">pool-size属性を指定しない場合、”1” が設定される。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;task:scheduled-tasks&gt;</span></code> の要素を定義し、scheduler属性に、 <code class="docutils literal notranslate"><span class="pre">&lt;task:scheduler&gt;</span></code> のIDを設定する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;task:scheduled&gt;</span></code> 要素を定義する。method属性に、refreshメソッドを指定する。</div>
<div class="line">cron属性に、<code class="docutils literal notranslate"><span class="pre">org.springframework.scheduling.support.CronSequenceGenerator</span></code> でサポートされた形式で記述すること。</div>
<div class="line">cron属性は開発環境、商用環境など環境によってリロードするタイミングが変わることが想定されるため、プロパティファイルや、環境変数等から取得することを推奨する。</div>
<div class="line"><br /></div>
<div class="line"><strong>cron属性の設定例</strong></div>
<div class="line">「秒 分 時 月 年 曜日」で指定する。</div>
<div class="line">毎秒実行               「* * * * * *」</div>
<div class="line">毎時実行               「0 0 * * * *」</div>
<div class="line">平日の9-17時の毎時実行 「0 0 9-17 * * MON-FRI」</div>
<div class="line"><br /></div>
<div class="line">詳細はJavaDocを参照されたい。</div>
<div class="line"><a class="reference external" href="http://static.springsource.org/spring/docs/3.2.x/javadoc-api/org/springframework/scheduling/support/CronSequenceGenerator.html">http://static.springsource.org/spring/docs/3.2.x/javadoc-api/org/springframework/scheduling/support/CronSequenceGenerator.html</a></div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-service-refresh">
<h4><a class="toc-backref" href="#id44" role="doc-backlink"><span class="section-number">5.14.3.2.2. </span>Controller(Service)クラスでrefreshメソッドを呼び出す方法</a><a class="headerlink" href="#controller-service-refresh" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">refreshメソッドを直接呼び出す場合について、</div>
<div class="line">JdbcCodeListのrefreshメソッドをServiceクラスで呼び出す場合の実装例を、以下に示す。</div>
</div>
<p><strong>bean定義ファイル</strong></p>
<ul class="simple">
<li><p>xxx-codelist.xml</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;CL_AUTHORITIES&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.codelist.JdbcCodeList&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;dataSource&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;querySql&quot;</span>
<span class="w">        </span><span class="na">value=</span><span class="s">&quot;SELECT authority_id, authority_name FROM authority ORDER BY authority_id&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;valueColumn&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;authority_id&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;labelColumn&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;authority_name&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<p><strong>Controllerクラス</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;codelist&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CodeListContoller</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Inject</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">CodeListService</span><span class="w"> </span><span class="n">codeListService</span><span class="p">;</span><span class="w"> </span><span class="c1">// (1)</span>

<span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RequestMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;refresh&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">refreshJdbcCodeList</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">codeListService</span><span class="p">.</span><span class="na">refresh</span><span class="p">();</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;codelist/jdbcCodeList&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ReloadableCodeListクラスのrefreshメソッドを実行するServiceクラスをインジェクションする。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ReloadableCodeListクラスのrefreshメソッドを実行するServiceクラスのrefreshメソッドを実行する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>Serviceクラス</strong></p>
<p>以下は実装クラスのみ記述し、インターフェースクラスは省略。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Service</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CodeListServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">CodeListService</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (1)</span>

<span class="w">    </span><span class="nd">@Inject</span>
<span class="w">    </span><span class="nd">@Named</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;CL_AUTHORITIES&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">ReloadableCodeList</span><span class="w"> </span><span class="n">codeListItem</span><span class="p">;</span><span class="w"> </span><span class="c1">// (3)</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">refresh</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (4)</span>
<span class="w">        </span><span class="n">codeListItem</span><span class="p">.</span><span class="na">refresh</span><span class="p">();</span><span class="w"> </span><span class="c1">// (5)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">実装クラス <code class="docutils literal notranslate"><span class="pre">CodeListServiceImpl</span></code> は、インターフェース <code class="docutils literal notranslate"><span class="pre">CodeListService</span></code> を実装する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">コードリストをインジェクションするとき、 <code class="docutils literal notranslate"><span class="pre">&#64;Named</span></code> で、該当するコードリストを指定する。</div>
<div class="line">value属性に取得したいbeanのIDを指定すること。</div>
<div class="line">Bean定義ファイルに定義されているbeanタグのID属性”CL_AUTHORITIES”のコードリストがインジェクションされる。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">フィールドの型にReloadableCodeListインターフェースを定義すること。</div>
<div class="line">(1)で取得したBeanはReloadableCodeListインターフェースを実装していること。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Serviceクラスで定義したrefreshメソッド。</div>
<div class="line">Controllerクラスから呼び出されている。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ReloadableCodeListインターフェースを実装したコードリストのrefreshメソッド。</div>
<div class="line">refreshメソッドを実行することで、コードリストが更新される。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="originalcustomizecodelist">
<span id="id16"></span><h3><a class="toc-backref" href="#id45" role="doc-backlink"><span class="section-number">5.14.3.3. </span>コードリストを独自カスタマイズする方法</a><a class="headerlink" href="#originalcustomizecodelist" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line">共通ライブラリで提供している4種類のコードリストで実現できないコードリストを作成したい場合、コードリストを独自にカスタマイズすることができる。</div>
<div class="line">独自カスタマイズする場合、作成できるコードリストの種類と実装方法について、以下の表に示す。</div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 15%" />
<col style="width: 30%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>Reloadable</p></th>
<th class="head"><p>継承するクラス</p></th>
<th class="head"><p>実装箇所</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">不要</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.common.codelist.AbstractCodeList</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">asMap</span></code> をオーバライド</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">必要</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.common.codelist.AbstractReloadableCodeList</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">retrieveMap</span></code> をオーバライド</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.common.codelist.CodeList</span></code> 、 <code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.common.codelist.ReloadableCodeList</span></code> インターフェースを直接実装しても実現はできるが、共通ライブラリで提供されている抽象クラスを拡張することで、最低限の実装で済む。</div>
</div>
<div class="line-block">
<div class="line">以下に、独自カスタマイズの実例について示す。</div>
<div class="line">例として、今年と来年の年のリストを作るコードリストについて説明する。</div>
<div class="line">(例：今年が2013の場合、コードリストには、”2013、2014”の順で格納される。)</div>
</div>
<p><strong>コードリストクラス</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Component</span><span class="p">(</span><span class="s">&quot;CL_YEAR&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DepYearCodeList</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractCodeList</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (2)</span>

<span class="w">    </span><span class="nd">@Inject</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">DateFactory</span><span class="w"> </span><span class="n">dateFactory</span><span class="p">;</span><span class="w"> </span><span class="c1">// (3)</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">asMap</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// (4)</span>
<span class="w">        </span><span class="n">DateTime</span><span class="w"> </span><span class="n">dateTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dateFactory</span><span class="p">.</span><span class="na">newDateTime</span><span class="p">();</span>
<span class="w">        </span><span class="n">DateTime</span><span class="w"> </span><span class="n">nextYearDateTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dateTime</span><span class="p">.</span><span class="na">plusYears</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">depYearMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LinkedHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="p">();</span>

<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">thisYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dateTime</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="s">&quot;Y&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">nextYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nextYearDateTime</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="s">&quot;Y&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">depYearMap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">thisYear</span><span class="p">,</span><span class="w"> </span><span class="n">thisYear</span><span class="p">);</span>
<span class="w">        </span><span class="n">depYearMap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">nextYear</span><span class="p">,</span><span class="w"> </span><span class="n">nextYear</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">unmodifiableMap</span><span class="p">(</span><span class="n">depYearMap</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;Component</span></code> で、コードリストをコンポーネント登録する。</div>
<div class="line">Valueに <code class="docutils literal notranslate"><span class="pre">&quot;CL_YEAR&quot;</span></code> を指定することで、bean定義で設定したコードリストインターセプトによりコードリストをコンポーネント登録する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.common.codelist.AbstractCodeList</span></code> を継承する。</div>
<div class="line">今年と来年の年のリストを作る時、動的にシステム日付から算出して作成しているため、リロードは不要。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">システム日付のDateクラスを作成する <code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.common.date.DateFactory</span></code> をインジェクトしている。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">DateFactory</span></code> を利用して今年と来年の年を取得することができる。</div>
<div class="line">事前に、bean定義ファイルにDataFactory実装クラスを設定する必要がある。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">asMap()</span></code> メソッドをオーバライドして、今年と来年の年のリストを作成する。</div>
<div class="line">作成したいコードリスト毎に実装が異なる。</div>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>jspの実装例</strong></p>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;form:select</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;mostRecentYear&quot;</span><span class="w"> </span><span class="na">items=</span><span class="s">&quot;${CL_YEAR}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">items属性にコンポーネント登録した <code class="docutils literal notranslate"><span class="pre">&quot;CL_YEAR&quot;</span></code> を <code class="docutils literal notranslate"><span class="pre">${}</span></code> プレースホルダー で指定することで、該当のコードリストを取得することができる。</div>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>出力HTML</strong></p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">select</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;mostRecentYear&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;mostRecentYear&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;2013&quot;</span><span class="p">&gt;</span>2013<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;2014&quot;</span><span class="p">&gt;</span>2014<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><strong>出力画面</strong></p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/codelist_customizeCodelist.png"><img alt="customized codelist" src="../_images/codelist_customizeCodelist.png" style="width: 10%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>リロード可能であるCodeListを独自カスタマイズする場合、スレッドセーフになるように実装すること。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="appendix">
<h2><a class="toc-backref" href="#id46" role="doc-backlink"><span class="section-number">5.14.4. </span>Appendix</a><a class="headerlink" href="#appendix" title="Permalink to this heading">¶</a></h2>
<section id="aftercodelisti18n">
<span id="id17"></span><h3><a class="toc-backref" href="#id47" role="doc-backlink"><span class="section-number">5.14.4.1. </span>SimpleI18nCodeListのコードリスト設定方法</a><a class="headerlink" href="#aftercodelisti18n" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line">SimpleI18nCodeListのコードリスト設定について、 <a class="reference internal" href="#codelisti18n"><span class="std std-ref">SimpleI18nCodeListの使用方法</span></a> で設定されているコードリスト設定の他に2つ設定方法がある。</div>
<div class="line">料金を選択するセレクトボックスの場合の例を用いて、それぞれの設定方法を説明する。</div>
</div>
<section id="localjava-util-map-key-value">
<h4><a class="toc-backref" href="#id48" role="doc-backlink"><span class="section-number">5.14.4.1.1. </span>行単位でLocal毎の<code class="docutils literal notranslate"><span class="pre">java.util.Map</span></code>(key=コード値, value=ラベル)を設定する</a><a class="headerlink" href="#localjava-util-map-key-value" title="Permalink to this heading">¶</a></h4>
<p><strong>bean定義ファイル</strong></p>
<ul class="simple">
<li><p>xxx-codelist.xml</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;CL_I18N_PRICE&quot;</span>
<span class="w">    </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.codelist.i18n.SimpleI18nCodeList&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;rows&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">        </span><span class="nt">&lt;util:map&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;util:map&gt;</span>
<span class="w">                     </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;unlimited&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                     </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;10000&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Less than $10,000&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                     </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;20000&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Less than $20,000&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                     </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;30000&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Less than $30,000&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                     </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;40000&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Less than $40,000&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                     </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;50000&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Less than $50,000&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;/util:map&gt;</span>
<span class="w">            </span><span class="nt">&lt;/entry&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;ja&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;util:map&gt;</span>
<span class="w">                     </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;上限なし&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                     </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;10000&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;10,000円以下&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                     </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;20000&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;20,000円以下&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                     </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;30000&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;30,000円以下&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                     </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;40000&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;40,000円以下&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                     </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;50000&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;50,000円以下&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;/util:map&gt;</span>
<span class="w">            </span><span class="nt">&lt;/entry&gt;</span>
<span class="w">        </span><span class="nt">&lt;/util:map&gt;</span>
<span class="w">    </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">rowsプロパティに対して、”MapのMap”を設定する。外側のMapのkeyは<code class="docutils literal notranslate"><span class="pre">java.lang.Locale</span></code>である。</div>
<div class="line">内側のMapのkeyはコード値、valueはロケールに対応したラベルである。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="java-util-map-key-locale-value">
<h4><a class="toc-backref" href="#id49" role="doc-backlink"><span class="section-number">5.14.4.1.2. </span>列単位でコード値毎の<code class="docutils literal notranslate"><span class="pre">java.util.Map</span></code>(key=Locale, value=ラベル)を設定する</a><a class="headerlink" href="#java-util-map-key-locale-value" title="Permalink to this heading">¶</a></h4>
<p><strong>bean定義ファイル</strong></p>
<ul class="simple">
<li><p>xxx-codelist.xml</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;CL_I18N_PRICE&quot;</span>
<span class="w">    </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.codelist.i18n.SimpleI18nCodeList&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;columns&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">        </span><span class="nt">&lt;util:map&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;util:map&gt;</span>
<span class="w">                    </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;en&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;unlimited&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                    </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;ja&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;上限なし&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;/util:map&gt;</span>
<span class="w">            </span><span class="nt">&lt;/entry&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;10000&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;util:map&gt;</span>
<span class="w">                    </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;en&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Less than $10,000&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                    </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;ja&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;10,000円以下&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;/util:map&gt;</span>
<span class="w">            </span><span class="nt">&lt;/entry&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;20000&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;util:map&gt;</span>
<span class="w">                    </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;en&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Less than $20,000&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                    </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;ja&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;20,000円以下&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;/util:map&gt;</span>
<span class="w">            </span><span class="nt">&lt;/entry&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;30000&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;util:map&gt;</span>
<span class="w">                    </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;en&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Less than $30,000&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                    </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;ja&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;30,000円以下&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;/util:map&gt;</span>
<span class="w">            </span><span class="nt">&lt;/entry&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;40000&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;util:map&gt;</span>
<span class="w">                    </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;en&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Less than $40,000&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                    </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;ja&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;40,000円以下&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;/util:map&gt;</span>
<span class="w">            </span><span class="nt">&lt;/entry&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;50000&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;util:map&gt;</span>
<span class="w">                    </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;en&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Less than $50,000&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                    </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;ja&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;50,000円以下&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;/util:map&gt;</span>
<span class="w">            </span><span class="nt">&lt;/entry&gt;</span>
<span class="w">        </span><span class="nt">&lt;/util:map&gt;</span>
<span class="w">    </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">columnsプロパティに対して、”MapのMap”を設定する。外側のMapのkeyはコード値である。</div>
<div class="line">内側のMapのkeyは<code class="docutils literal notranslate"><span class="pre">java.lang.Locale</span></code>、valueはロケールに対応したラベルである。</div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="Ajax.html" title="5.15. Ajax"
             >next</a> |</li>
        <li class="right" >
          <a href="Internationalization.html" title="5.13. 国際化"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Global Framework Development Guideline 1.0.0.publicreview documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" ><span class="section-number">5. </span>TERASOLUNA Global Frameworkの機能詳細</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">5.14. </span>コードリスト</a></li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, NTT DATA.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 5.3.0.Theme by <a href="http://github.com/vkvn">vkvn</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>