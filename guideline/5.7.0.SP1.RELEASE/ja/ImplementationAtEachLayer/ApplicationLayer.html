<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>3.4. アプリケーション層の実装 &#8212; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.7.0.SP1.RELEASE documentation</title>
    <link rel="stylesheet" href="../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.7.0.SP1.RELEASE',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3.5. 開発プロジェクトのビルド" href="CreateProject.html" />
    <link rel="prev" title="3.3. インフラストラクチャ層の実装" href="InfrastructureLayer.html" /><script async src="https://www.googletagmanager.com/gtag/js?id=G-847V2Q99G8"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date()); gtag('config', 'G-847V2Q99G8');
</script>
<script src="../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../_static/solarized-dark.css" rel="stylesheet">
<link href="../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="CreateProject.html" title="3.5. 開発プロジェクトのビルド"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="InfrastructureLayer.html" title="3.3. インフラストラクチャ層の実装"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.7.0.SP1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">3. アプリケーション開発</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3.4. アプリケーション層の実装</a><ul>
<li><a class="reference internal" href="#controller">3.4.1. Controllerの実装</a><ul>
<li><a class="reference internal" href="#controller-new-label">3.4.1.1. Controllerクラスの作成方法</a></li>
<li><a class="reference internal" href="#controller-mapping-label">3.4.1.2. リクエストとハンドラメソッドのマッピング方法</a><ul>
<li><a class="reference internal" href="#controller-mapping-path-label">3.4.1.2.1. リクエストパスでマッピング</a></li>
<li><a class="reference internal" href="#http">3.4.1.2.2. HTTPメソッドでマッピング</a></li>
<li><a class="reference internal" href="#controller-mapping-params-label">3.4.1.2.3. リクエストパラメータでマッピング</a></li>
<li><a class="reference internal" href="#controller-mapping-headers-label">3.4.1.2.4. リクエストヘッダでマッピング</a></li>
<li><a class="reference internal" href="#content-type">3.4.1.2.5. Content-Typeヘッダでマッピング</a></li>
<li><a class="reference internal" href="#accept">3.4.1.2.6. Acceptヘッダでマッピング</a></li>
</ul>
</li>
<li><a class="reference internal" href="#controller-mapping-policy-label">3.4.1.3. リクエストとハンドラメソッドのマッピング方針</a><ul>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-overview-label">3.4.1.3.1. サンプルアプリケーションの概要</a></li>
<li><a class="reference internal" href="#url">3.4.1.3.2. リクエストURL</a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-mapping-design-label">3.4.1.3.3. リクエストとハンドラメソッドのマッピング</a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-form-impl-label">3.4.1.3.4. フォーム表示の実装</a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-confirm-impl-label">3.4.1.3.5. 入力内容確認表示の実装</a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-redo-impl-label">3.4.1.3.6. フォーム再表示の実装</a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-create-impl-label">3.4.1.3.7. 新規作成の実装</a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-complete-impl-label">3.4.1.3.8. 新規作成完了表示の実装</a></li>
<li><a class="reference internal" href="#html-form">3.4.1.3.9. HTML form上に複数のボタンを配置する場合の実装</a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-all-impl-label">3.4.1.3.10. サンプルアプリケーションのControllerのソースコード</a></li>
</ul>
</li>
<li><a class="reference internal" href="#controller-method-argument-label">3.4.1.4. ハンドラメソッドの引数について</a><ul>
<li><a class="reference internal" href="#view">3.4.1.4.1. 画面(View)にデータを渡す</a></li>
<li><a class="reference internal" href="#controller-method-argument-pathvariable-label">3.4.1.4.2. URLのパスから値を取得する</a></li>
<li><a class="reference internal" href="#controller-method-argument-requestparam-label">3.4.1.4.3. リクエストパラメータを個別に取得する</a></li>
<li><a class="reference internal" href="#controller-method-argument-form-label">3.4.1.4.4. リクエストパラメータをまとめて取得する</a></li>
<li><a class="reference internal" href="#controller-method-argument-validation-label">3.4.1.4.5. 入力チェックを行う</a></li>
<li><a class="reference internal" href="#controller-method-argument-redirectattributes-label">3.4.1.4.6. リダイレクト先にデータを渡す</a></li>
<li><a class="reference internal" href="#controller-method-argument-redirectattributes-param-label">3.4.1.4.7. リダイレクト先へリクエストパラメータを渡す</a></li>
<li><a class="reference internal" href="#controller-method-argument-redirectattributes-path-label">3.4.1.4.8. リダイレクト先URLのパスに値を埋め込む</a></li>
<li><a class="reference internal" href="#cookie">3.4.1.4.9. Cookieから値を取得する</a></li>
<li><a class="reference internal" href="#controller-method-argument-cookiewrite-label">3.4.1.4.10. Cookieに値を書き込む</a></li>
<li><a class="reference internal" href="#controller-method-argument-pagination-label">3.4.1.4.11. ページネーション情報を取得する</a></li>
<li><a class="reference internal" href="#controller-method-argument-upload-label">3.4.1.4.12. アップロードファイルを取得する</a></li>
<li><a class="reference internal" href="#controller-method-argument-message-label">3.4.1.4.13. 画面に結果メッセージを表示する</a></li>
</ul>
</li>
<li><a class="reference internal" href="#controller-method-return-label">3.4.1.5. ハンドラメソッドの返り値について</a><ul>
<li><a class="reference internal" href="#html">3.4.1.5.1. HTMLを応答する</a></li>
<li><a class="reference internal" href="#controller-method-return-download-label">3.4.1.5.2. ダウンロードデータを応答する</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id34">3.4.1.6. 処理の実装</a><ul>
<li><a class="reference internal" href="#controller-logic-correlationcheck-label">3.4.1.6.1. 入力値の相関チェック</a></li>
<li><a class="reference internal" href="#controller-logic-businesslogic-label">3.4.1.6.2. 業務処理の呼び出し</a></li>
<li><a class="reference internal" href="#controller-logic-domainobject-label">3.4.1.6.3. ドメインオブジェクトへの値反映</a></li>
<li><a class="reference internal" href="#controller-logic-formobject-label">3.4.1.6.4. フォームオブジェクトへの値反映</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#formobject">3.4.2. フォームオブジェクトの実装</a><ul>
<li><a class="reference internal" href="#formobject-new-label">3.4.2.1. フォームオブジェクトの作成方法</a><ul>
<li><a class="reference internal" href="#id41">3.4.2.1.1. フィールド単位の数値型変換</a></li>
<li><a class="reference internal" href="#applicationlayer-datetimeformat">3.4.2.1.2. フィールド単位の日時型変換</a></li>
<li><a class="reference internal" href="#id43">3.4.2.1.3. Controller単位の型変換</a></li>
<li><a class="reference internal" href="#id44">3.4.2.1.4. 入力チェック用のアノテーションの指定</a></li>
</ul>
</li>
<li><a class="reference internal" href="#formobject-init-label">3.4.2.2. フォームオブジェクトの初期化方法</a></li>
<li><a class="reference internal" href="#formobject-bindhtmlform-label">3.4.2.3. HTML formへのバインディング方法</a></li>
<li><a class="reference internal" href="#formobject-bindrequestparam-label">3.4.2.4. リクエストパラメータのバインディング方法</a><ul>
<li><a class="reference internal" href="#id48">3.4.2.4.1. バインディング結果の判定</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id49">3.4.3. Viewの実装</a><ul>
<li><a class="reference internal" href="#jsp">3.4.3.1. JSPの実装</a><ul>
<li><a class="reference internal" href="#view-jsp-include-label">3.4.3.1.1. インクルード用の共通JSPの作成</a></li>
<li><a class="reference internal" href="#view-jsp-out-label">3.4.3.1.2. モデルに格納されている値を表示する</a></li>
<li><a class="reference internal" href="#view-jsp-outnumber-label">3.4.3.1.3. モデルに格納されている数値を表示する</a></li>
<li><a class="reference internal" href="#view-jsp-outdate-label">3.4.3.1.4. モデルに格納されている日時を表示する</a></li>
<li><a class="reference internal" href="#view-jsp-requesturl-label">3.4.3.1.5. リクエストURLを生成する</a></li>
<li><a class="reference internal" href="#view-jsp-form-label">3.4.3.1.6. HTML formへフォームオブジェクトをバインドする</a></li>
<li><a class="reference internal" href="#view-jsp-errors-label">3.4.3.1.7. 入力チェックエラーを表示する</a></li>
<li><a class="reference internal" href="#view-jsp-resultmessages-label">3.4.3.1.8. 処理結果のメッセージを表示する</a></li>
<li><a class="reference internal" href="#view-jsp-codelist-label">3.4.3.1.9. コードリストを表示する</a></li>
<li><a class="reference internal" href="#view-jsp-message-label">3.4.3.1.10. 固定文言を表示する</a></li>
<li><a class="reference internal" href="#view-jsp-if-label">3.4.3.1.11. 条件によって表示を切り替える</a></li>
<li><a class="reference internal" href="#view-jsp-foreach-label">3.4.3.1.12. コレクションの要素に対して表示処理を繰り返す</a></li>
<li><a class="reference internal" href="#view-jsp-pagination-label">3.4.3.1.13. ページネーション用のリンクを表示する</a></li>
<li><a class="reference internal" href="#view-jsp-authorization-label">3.4.3.1.14. 権限によって表示を切り替える</a></li>
</ul>
</li>
<li><a class="reference internal" href="#javascript">3.4.3.2. JavaScriptの実装</a></li>
<li><a class="reference internal" href="#id71">3.4.3.3. スタイルシートの実装</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id72">3.4.4. 共通処理の実装</a><ul>
<li><a class="reference internal" href="#controller-common-process">3.4.4.1. Controllerの呼び出し前後で行う共通処理の実装</a><ul>
<li><a class="reference internal" href="#servlet-filter">3.4.4.1.1. Servlet Filterの実装</a></li>
<li><a class="reference internal" href="#handlerinterceptor">3.4.4.1.2. HandlerInterceptorの実装</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id74">3.4.4.2. Controllerの共通処理の実装</a><ul>
<li><a class="reference internal" href="#handlermethodargumentresolver">3.4.4.2.1. HandlerMethodArgumentResolverの実装</a></li>
<li><a class="reference internal" href="#controlleradvice">3.4.4.2.2. <code class="docutils literal"><span class="pre">&#64;ControllerAdvice</span></code>の実装</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id75">3.4.5. 二重送信防止について</a></li>
<li><a class="reference internal" href="#id76">3.4.6. セッションの使用について</a></li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="InfrastructureLayer.html"
                        title="previous chapter">3.3. インフラストラクチャ層の実装</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="CreateProject.html"
                        title="next chapter">3.5. 開発プロジェクトのビルド</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/ImplementationAtEachLayer/ApplicationLayer.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>3.4. アプリケーション層の実装<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="admonition caution">
  <p class="first admonition-title">Caution</p>
  <p><strong>本バージョンの内容は既に古くなっています</strong>。最新のガイドラインは<a href="http://terasolunaorg.github.io/guideline/">こちら</a>からご参照ください。</p>
</div>
<div class="contents local topic" id="id2">
<p class="topic-title">目次</p>
<ul class="simple">
<li><a class="reference internal" href="#controller" id="id83">Controllerの実装</a><ul>
<li><a class="reference internal" href="#controller-new-label" id="id84">Controllerクラスの作成方法</a></li>
<li><a class="reference internal" href="#controller-mapping-label" id="id85">リクエストとハンドラメソッドのマッピング方法</a><ul>
<li><a class="reference internal" href="#controller-mapping-path-label" id="id86">リクエストパスでマッピング</a></li>
<li><a class="reference internal" href="#http" id="id87">HTTPメソッドでマッピング</a></li>
<li><a class="reference internal" href="#controller-mapping-params-label" id="id88">リクエストパラメータでマッピング</a></li>
<li><a class="reference internal" href="#controller-mapping-headers-label" id="id89">リクエストヘッダでマッピング</a></li>
<li><a class="reference internal" href="#content-type" id="id90">Content-Typeヘッダでマッピング</a></li>
<li><a class="reference internal" href="#accept" id="id91">Acceptヘッダでマッピング</a></li>
</ul>
</li>
<li><a class="reference internal" href="#controller-mapping-policy-label" id="id92">リクエストとハンドラメソッドのマッピング方針</a><ul>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-overview-label" id="id93">サンプルアプリケーションの概要</a></li>
<li><a class="reference internal" href="#url" id="id94">リクエストURL</a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-mapping-design-label" id="id95">リクエストとハンドラメソッドのマッピング</a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-form-impl-label" id="id96">フォーム表示の実装</a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-confirm-impl-label" id="id97">入力内容確認表示の実装</a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-redo-impl-label" id="id98">フォーム再表示の実装</a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-create-impl-label" id="id99">新規作成の実装</a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-complete-impl-label" id="id100">新規作成完了表示の実装</a></li>
<li><a class="reference internal" href="#html-form" id="id101">HTML form上に複数のボタンを配置する場合の実装</a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-all-impl-label" id="id102">サンプルアプリケーションのControllerのソースコード</a></li>
</ul>
</li>
<li><a class="reference internal" href="#controller-method-argument-label" id="id103">ハンドラメソッドの引数について</a><ul>
<li><a class="reference internal" href="#view" id="id104">画面(View)にデータを渡す</a></li>
<li><a class="reference internal" href="#controller-method-argument-pathvariable-label" id="id105">URLのパスから値を取得する</a></li>
<li><a class="reference internal" href="#controller-method-argument-requestparam-label" id="id106">リクエストパラメータを個別に取得する</a></li>
<li><a class="reference internal" href="#controller-method-argument-form-label" id="id107">リクエストパラメータをまとめて取得する</a></li>
<li><a class="reference internal" href="#controller-method-argument-validation-label" id="id108">入力チェックを行う</a></li>
<li><a class="reference internal" href="#controller-method-argument-redirectattributes-label" id="id109">リダイレクト先にデータを渡す</a></li>
<li><a class="reference internal" href="#controller-method-argument-redirectattributes-param-label" id="id110">リダイレクト先へリクエストパラメータを渡す</a></li>
<li><a class="reference internal" href="#controller-method-argument-redirectattributes-path-label" id="id111">リダイレクト先URLのパスに値を埋め込む</a></li>
<li><a class="reference internal" href="#cookie" id="id112">Cookieから値を取得する</a></li>
<li><a class="reference internal" href="#controller-method-argument-cookiewrite-label" id="id113">Cookieに値を書き込む</a></li>
<li><a class="reference internal" href="#controller-method-argument-pagination-label" id="id114">ページネーション情報を取得する</a></li>
<li><a class="reference internal" href="#controller-method-argument-upload-label" id="id115">アップロードファイルを取得する</a></li>
<li><a class="reference internal" href="#controller-method-argument-message-label" id="id116">画面に結果メッセージを表示する</a></li>
</ul>
</li>
<li><a class="reference internal" href="#controller-method-return-label" id="id117">ハンドラメソッドの返り値について</a><ul>
<li><a class="reference internal" href="#html" id="id118">HTMLを応答する</a></li>
<li><a class="reference internal" href="#controller-method-return-download-label" id="id119">ダウンロードデータを応答する</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id34" id="id120">処理の実装</a><ul>
<li><a class="reference internal" href="#controller-logic-correlationcheck-label" id="id121">入力値の相関チェック</a></li>
<li><a class="reference internal" href="#controller-logic-businesslogic-label" id="id122">業務処理の呼び出し</a></li>
<li><a class="reference internal" href="#controller-logic-domainobject-label" id="id123">ドメインオブジェクトへの値反映</a></li>
<li><a class="reference internal" href="#controller-logic-formobject-label" id="id124">フォームオブジェクトへの値反映</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#formobject" id="id125">フォームオブジェクトの実装</a><ul>
<li><a class="reference internal" href="#formobject-new-label" id="id126">フォームオブジェクトの作成方法</a><ul>
<li><a class="reference internal" href="#id41" id="id127">フィールド単位の数値型変換</a></li>
<li><a class="reference internal" href="#applicationlayer-datetimeformat" id="id128">フィールド単位の日時型変換</a></li>
<li><a class="reference internal" href="#id43" id="id129">Controller単位の型変換</a></li>
<li><a class="reference internal" href="#id44" id="id130">入力チェック用のアノテーションの指定</a></li>
</ul>
</li>
<li><a class="reference internal" href="#formobject-init-label" id="id131">フォームオブジェクトの初期化方法</a></li>
<li><a class="reference internal" href="#formobject-bindhtmlform-label" id="id132">HTML formへのバインディング方法</a></li>
<li><a class="reference internal" href="#formobject-bindrequestparam-label" id="id133">リクエストパラメータのバインディング方法</a><ul>
<li><a class="reference internal" href="#id48" id="id134">バインディング結果の判定</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id49" id="id135">Viewの実装</a><ul>
<li><a class="reference internal" href="#jsp" id="id136">JSPの実装</a><ul>
<li><a class="reference internal" href="#view-jsp-include-label" id="id137">インクルード用の共通JSPの作成</a></li>
<li><a class="reference internal" href="#view-jsp-out-label" id="id138">モデルに格納されている値を表示する</a></li>
<li><a class="reference internal" href="#view-jsp-outnumber-label" id="id139">モデルに格納されている数値を表示する</a></li>
<li><a class="reference internal" href="#view-jsp-outdate-label" id="id140">モデルに格納されている日時を表示する</a></li>
<li><a class="reference internal" href="#view-jsp-requesturl-label" id="id141">リクエストURLを生成する</a></li>
<li><a class="reference internal" href="#view-jsp-form-label" id="id142">HTML formへフォームオブジェクトをバインドする</a></li>
<li><a class="reference internal" href="#view-jsp-errors-label" id="id143">入力チェックエラーを表示する</a></li>
<li><a class="reference internal" href="#view-jsp-resultmessages-label" id="id144">処理結果のメッセージを表示する</a></li>
<li><a class="reference internal" href="#view-jsp-codelist-label" id="id145">コードリストを表示する</a></li>
<li><a class="reference internal" href="#view-jsp-message-label" id="id146">固定文言を表示する</a></li>
<li><a class="reference internal" href="#view-jsp-if-label" id="id147">条件によって表示を切り替える</a></li>
<li><a class="reference internal" href="#view-jsp-foreach-label" id="id148">コレクションの要素に対して表示処理を繰り返す</a></li>
<li><a class="reference internal" href="#view-jsp-pagination-label" id="id149">ページネーション用のリンクを表示する</a></li>
<li><a class="reference internal" href="#view-jsp-authorization-label" id="id150">権限によって表示を切り替える</a></li>
</ul>
</li>
<li><a class="reference internal" href="#javascript" id="id151">JavaScriptの実装</a></li>
<li><a class="reference internal" href="#id71" id="id152">スタイルシートの実装</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id72" id="id153">共通処理の実装</a><ul>
<li><a class="reference internal" href="#controller-common-process" id="id154">Controllerの呼び出し前後で行う共通処理の実装</a><ul>
<li><a class="reference internal" href="#servlet-filter" id="id155">Servlet Filterの実装</a></li>
<li><a class="reference internal" href="#handlerinterceptor" id="id156">HandlerInterceptorの実装</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id74" id="id157">Controllerの共通処理の実装</a><ul>
<li><a class="reference internal" href="#handlermethodargumentresolver" id="id158">HandlerMethodArgumentResolverの実装</a></li>
<li><a class="reference internal" href="#controlleradvice" id="id159"><code class="docutils literal"><span class="pre">&#64;ControllerAdvice</span></code>の実装</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id75" id="id160">二重送信防止について</a></li>
<li><a class="reference internal" href="#id76" id="id161">セッションの使用について</a></li>
</ul>
</div>
<p>本節では、HTML formを使った画面遷移型のアプリケーションにおけるアプリケーション層の実装について説明する。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Ajaxの開発やREST APIの開発で必要となる実装についての説明は以下のページを参照されたい。</p>
<ul class="last simple">
<li><a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Ajax.html"><span class="doc">Ajax</span></a></li>
</ul>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>アプリケーション層の実装は、以下の3つにわかれる。</p>
<ol class="arabic">
<li><div class="first line-block">
<div class="line"><a class="reference internal" href="#controller-label"><span class="std std-ref">Controllerの実装</span></a></div>
<div class="line">Controllerは、リクエストの受付、業務処理の呼び出し、モデルの更新、Viewの決定といった処理を行い、リクエストを受けてからの一連の処理フローを制御する。</div>
<div class="line">アプリケーション層の実装において、もっとも重要な実装となる。</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><a class="reference internal" href="#formobject"><span class="std std-ref">フォームオブジェクトの実装</span></a></div>
<div class="line">フォームオブジェクトは、HTML formとアプリケーションの間での値の受け渡しを行う。</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><a class="reference internal" href="#id49"><span class="std std-ref">Viewの実装</span></a></div>
<div class="line">View(JSP)は、モデル（フォームオブジェクトやドメインオブジェクトなど）からデータを取得し、画面(HTML)を生成する。</div>
</div>
</li>
</ol>
<div class="section" id="controller">
<span id="controller-label"></span><h2><a class="toc-backref" href="#id83">3.4.1. Controllerの実装</a><a class="headerlink" href="#controller" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">まず、Controllerの実装から説明する。</div>
<div class="line">Controllerは、以下5つの役割を担う。</div>
</div>
<ol class="arabic">
<li><div class="first line-block">
<div class="line"><strong>リクエストを受け取るためのメソッドを提供する。</strong></div>
<div class="line"><code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code>アノテーションが付与されたメソッドを実装することで、リクエストを受け取ることができる。</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>リクエストパラメータの入力チェックを行う。</strong></div>
<div class="line">入力チェックが必要なリクエストを受け取るメソッドでは、<code class="docutils literal"><span class="pre">&#64;Validated</span></code>アノテーションをフォームオブジェクトの引数に指定することで、リクエストパラメータの入力チェックを行うことができる。</div>
<div class="line">単項目チェックはBean Validation、相関チェックはSpring Validator又はBean Validationでチェックを行う。</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>業務処理の呼び出しを行う。</strong></div>
<div class="line">Controllerでは業務処理の実装は行わず、Serviceのメソッドに処理を委譲する。</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>業務処理の処理結果をModelに反映する。</strong></div>
<div class="line">Serviceのメソッドから返却されたドメインオブジェクトを<code class="docutils literal"><span class="pre">Model</span></code>に反映することで、Viewから処理結果を参照できるようにする。</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>処理結果に対応するView名を返却する。</strong></div>
<div class="line">Controllerでは処理結果に対する描画処理を実装せず、描画処理はJSP等のViewで実装する。</div>
<div class="line">Controllerでは描画処理が実装されているViewのView名の返却のみ行う。</div>
<div class="line">View名に対応するViewの解決は、Spring Frameworkより提供されている<code class="docutils literal"><span class="pre">ViewResolver</span></code>によって行われ、処理結果に対応するView(JSPなど)が呼び出される仕組みになっている。</div>
</div>
</li>
</ol>
<div class="figure align-center" id="id77">
<a class="reference internal image-reference" href="../_images/application_logic-of-controller.png"><img alt="responsibility of logic" src="../_images/application_logic-of-controller.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - Logic of controller</strong></span></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Controllerでは、業務処理の呼び出し、処理結果の<code class="docutils literal"><span class="pre">Model</span></code>への反映、遷移先(View名)の決定などの <strong>ルーティング処理の実装に徹することを推奨する。</strong></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Controllerの実装について、以下4つの点に着目して説明する。</p>
<ul class="simple">
<li><a class="reference internal" href="#controller-new-label"><span class="std std-ref">Controllerクラスの作成方法</span></a></li>
<li><a class="reference internal" href="#controller-mapping-label"><span class="std std-ref">リクエストとハンドラメソッドのマッピング方法</span></a></li>
<li><a class="reference internal" href="#controller-method-argument-label"><span class="std std-ref">ハンドラメソッドの引数について</span></a></li>
<li><a class="reference internal" href="#controller-method-return-label"><span class="std std-ref">ハンドラメソッドの返り値について</span></a></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="controller-new-label">
<span id="id3"></span><h3><a class="toc-backref" href="#id84">3.4.1.1. Controllerクラスの作成方法</a><a class="headerlink" href="#controller-new-label" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><strong>Controllerは、POJOクラスに &#64;Controller アノテーションを付加したクラス (Annotation-based Controller)として作成する。</strong></div>
<div class="line">Spring MVCのControllerとしては、<code class="docutils literal"><span class="pre">org.springframework.web.servlet.mvc.Controller</span></code>インタフェースを実装する方法 (Interface-based Controller)もあるが、Spring3以降はDeprecatedになっているため、原則使用しない。</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleController</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-mapping-label">
<span id="id4"></span><h3><a class="toc-backref" href="#id85">3.4.1.2. リクエストとハンドラメソッドのマッピング方法</a><a class="headerlink" href="#controller-mapping-label" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">リクエストを受け取るメソッドは、<code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code>アノテーションを付与する。</div>
<div class="line">本ガイドラインでは、<code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code>が付加されたメソッドのことを「ハンドラメソッド」と呼ぶ。</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>リクエストとハンドラメソッドをマッピングするためのルールは、<code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code>アノテーションの属性に指定する。</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="10%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">属性名</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>value</td>
<td><div class="first last line-block">
<div class="line">マッピング対象にするリクエストパスを指定する(複数可)。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>method</td>
<td><div class="first last line-block">
<div class="line">マッピング対象にするHTTPメソッド(<code class="docutils literal"><span class="pre">RequestMethod</span></code>型)を指定する(複数可)。</div>
<div class="line">GET/POSTについてはHTML form向けのリクエストをマッピングする際にも使用するが、それ以外のHTTPメソッド(PUT/DELETEなど)はREST API向けのリクエストをマッピングする際に使用する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>params</td>
<td><div class="first last line-block">
<div class="line">マッピング対象にするリクエストパラメータを指定する(複数可)。</div>
<div class="line">主にHTML form向けのリクエストをマッピングする際に使用する。このマッピング方法を使用すると、HTML form上に複数のボタンが存在する場合のマッピングを簡単に実現する事ができる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>headers</td>
<td><div class="first last line-block">
<div class="line">マッピング対象とするリクエストヘッダを指定する(複数可)。</div>
<div class="line">主にREST APIやAjax向けのリクエストをマッピングする際に使用する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td>consumes</td>
<td><div class="first last line-block">
<div class="line">リクエストのContent-Typeヘッダを使ってマッピングすることが出来る。マッピング対象とするメディアタイプを指定する(複数可)。</div>
<div class="line">主にREST APIやAjax向けのリクエストをマッピングする際に使用する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td>produces</td>
<td><div class="first last line-block">
<div class="line">リクエストのAcceptヘッダを使ってマッピングすることが出来る。マッピング対象とするメディアタイプを指定する(複数可)。</div>
<div class="line">主にREST APIやAjax向けのリクエストをマッピングする際に使用する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>マッピングの組み合わせについて</strong></p>
<p class="last">複数の属性を組み合わせることで複雑なマッピングを行うことも可能だが、保守性を考慮し、可能な限りシンプルな定義になるようにマッピングの設計を行うこと。
2つの属性の組み合わせ（value属性と別の属性1つ）を目安にすることを推奨する。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>HTTPメソッドごとの&#64;RequestMappingアノテーション</strong></p>
<p>Spring Framework 4.3から、HTTPメソッドごとの <code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code>合成アノテーションが追加された。
よりシンプルにマッピングを定義することができ、意図しないHTTPメソッドのマッピング防止とソースコードの可読性向上が期待できる。</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&#64;GetMapping</span></code></li>
<li><code class="docutils literal"><span class="pre">&#64;PostMapping</span></code></li>
</ul>
<p>以下の定義は、 <code class="docutils literal"><span class="pre">&#64;RequestMapping(value</span> <span class="pre">=</span> <span class="pre">&quot;hello&quot;,</span> <span class="pre">method</span> <span class="pre">=</span> <span class="pre">RequestMethod.GET)</span></code>と定義しているのと同様である。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p class="last">詳細は、<a class="reference external" href="https://docs.spring.io/spring-framework/docs/5.3.18/reference/html/web.html#mvc-ann-requestmapping">Spring Framework Documentation -Request Mapping-</a> を参照されたい。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">以下、マッピングの具体例を6つ示す。</div>
</div>
<ul class="simple">
<li><a class="reference internal" href="#controller-mapping-path-label"><span class="std std-ref">リクエストパスでマッピング</span></a></li>
<li><a class="reference internal" href="#controller-mapping-method-label"><span class="std std-ref">HTTPメソッドでマッピング</span></a></li>
<li><a class="reference internal" href="#controller-mapping-params-label"><span class="std std-ref">リクエストパラメータでマッピング</span></a></li>
<li><a class="reference internal" href="#controller-mapping-headers-label"><span class="std std-ref">リクエストヘッダでマッピング</span></a></li>
<li><a class="reference internal" href="#controller-mapping-contenttype-label"><span class="std std-ref">Content-Typeヘッダでマッピング</span></a></li>
<li><a class="reference internal" href="#controller-mapping-accept-label"><span class="std std-ref">Acceptヘッダでマッピング</span></a></li>
</ul>
<div class="line-block">
<div class="line">以降の説明では、以下のControllerクラスにハンドラメソッドを定義する前提となっている。</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="hll"><span class="nd">@Controller</span> <span class="c1">// (1)</span>
</span><span class="hll"><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;sample&quot;</span><span class="p">)</span> <span class="c1">// (2)</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleController</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">&#64;Controller</span></code>アノテーションを付加することでAnnotation-basedなコントローラークラスとして認識され、component scanの対象となる。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p class="first">クラスレベルで<code class="docutils literal"><span class="pre">&#64;RequestMapping(&quot;sample&quot;)</span></code>アノテーションを付けることでこのクラス内のハンドラメソッドがsample配下のURLにマッピングされる。</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code>の値（value属性）を省略した場合、サーブレットルート（”<code class="docutils literal"><span class="pre">/</span></code>” ）のURLにマッピングされる。</p>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="controller-mapping-path-label">
<span id="id5"></span><h4><a class="toc-backref" href="#id86">3.4.1.2.1. リクエストパスでマッピング</a><a class="headerlink" href="#controller-mapping-path-label" title="Permalink to this headline">¶</a></h4>
<p>下記の定義の場合、<code class="docutils literal"><span class="pre">sample/hello</span></code> というURLにアクセスすると、helloメソッドが実行される。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">()</span> <span class="p">{</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">複数指定した場合は、OR条件で扱われる。</div>
<div class="line">下記の定義の場合、 <code class="docutils literal"><span class="pre">sample/hello</span></code> 又は <code class="docutils literal"><span class="pre">sample/bonjour</span></code> というURLにアクセスすると、helloメソッドが実行される。</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;hello&quot;</span><span class="p">,</span> <span class="s">&quot;bonjour&quot;</span><span class="p">})</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">()</span> <span class="p">{</span>
</pre></div>
</div>
</div></blockquote>
<p>指定するリクエストパスは、具体的な値ではなくパターンを指定することも可能である。パターン指定の詳細は、<a class="reference external" href="https://docs.spring.io/spring-framework/docs/5.3.18/reference/html/web.html#mvc-ann-requestmapping-uri-templates">Spring Framework Documentation -URI patterns-</a> を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="http">
<span id="controller-mapping-method-label"></span><h4><a class="toc-backref" href="#id87">3.4.1.2.2. HTTPメソッドでマッピング</a><a class="headerlink" href="#http" title="Permalink to this headline">¶</a></h4>
<p>下記の定義の場合、 <code class="docutils literal"><span class="pre">sample/hello</span></code> というURLにPOSTメソッドでアクセスすると、helloメソッドが実行される。
サポートしているHTTPメソッドの一覧は <a class="reference external" href="https://docs.spring.io/spring/docs/5.3.18/javadoc-api/org/springframework/web/bind/annotation/RequestMethod.html">RequestMethodのJavadoc</a> を参照されたい。
指定しない場合、サポートしている全てのHTTPメソッドがマッピング対象となる。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;hello&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">()</span> <span class="p">{</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">複数指定した場合は、OR条件で扱われる。</div>
<div class="line">下記の定義の場合、 <code class="docutils literal"><span class="pre">sample/hello</span></code> というURLにGET又はHEADメソッドでアクセスすると、helloメソッドが実行される。</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;hello&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="p">{</span><span class="n">RequestMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">HEAD</span><span class="p">})</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">()</span> <span class="p">{</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-mapping-params-label">
<span id="id6"></span><h4><a class="toc-backref" href="#id88">3.4.1.2.3. リクエストパラメータでマッピング</a><a class="headerlink" href="#controller-mapping-params-label" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">下記の定義の場合、 <code class="docutils literal"><span class="pre">sample/hello?form</span></code> というURLにアクセスすると、helloメソッドが実行される。</div>
<div class="line">POSTでリクエストする場合は、リクエストパラメータはURLになくてもリクエストBODYに存在していればよい。</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;hello&quot;</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;form&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">()</span> <span class="p">{</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">複数指定した場合は、AND条件で扱われる。</div>
<div class="line">下記の定義の場合、 <code class="docutils literal"><span class="pre">sample/hello?form&amp;formType=foo</span></code> というURLにアクセスすると、helloメソッドが実行される。</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;hello&quot;</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;form&quot;</span><span class="p">,</span> <span class="s">&quot;formType=foo&quot;</span><span class="p">})</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">(</span><span class="nd">@RequestParam</span><span class="p">(</span><span class="s">&quot;formType&quot;</span><span class="p">)</span> <span class="n">String</span> <span class="n">formType</span><span class="p">)</span> <span class="p">{</span>
</pre></div>
</div>
</div></blockquote>
<p>サポートされている指定形式は以下の通り。</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="8%" />
<col width="25%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">形式</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>paramName</td>
<td>指定したparameNameのリクエストパラメータが存在する場合にマッピングされる。</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>!paramName</td>
<td>指定したparameNameのリクエストパラメータが存在しない場合にマッピングされる。</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>paramName=paramValue</td>
<td>指定したparameNameの値がparamValueの場合にマッピングされる。</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>paramName!=paramValue</td>
<td>指定したparameNameの値がparamValueでない場合にマッピングされる。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-mapping-headers-label">
<span id="id7"></span><h4><a class="toc-backref" href="#id89">3.4.1.2.4. リクエストヘッダでマッピング</a><a class="headerlink" href="#controller-mapping-headers-label" title="Permalink to this headline">¶</a></h4>
<p>主にREST APIやAjax向けのリクエストをマッピングする際に使用するため、詳細は以下のページを参照されたい。</p>
<ul class="simple">
<li><a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Ajax.html"><span class="doc">Ajax</span></a></li>
</ul>
</div>
<div class="section" id="content-type">
<span id="controller-mapping-contenttype-label"></span><h4><a class="toc-backref" href="#id90">3.4.1.2.5. Content-Typeヘッダでマッピング</a><a class="headerlink" href="#content-type" title="Permalink to this headline">¶</a></h4>
<p>主にREST APIやAjax向けのリクエストをマッピングする際に使用するため、詳細は以下のページを参照されたい。</p>
<ul class="simple">
<li><a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Ajax.html"><span class="doc">Ajax</span></a></li>
</ul>
</div>
<div class="section" id="accept">
<span id="controller-mapping-accept-label"></span><h4><a class="toc-backref" href="#id91">3.4.1.2.6. Acceptヘッダでマッピング</a><a class="headerlink" href="#accept" title="Permalink to this headline">¶</a></h4>
<p>主にREST APIやAjax向けのリクエストをマッピングする際に使用するため、詳細は以下のページを参照されたい。</p>
<ul class="simple">
<li><a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Ajax.html"><span class="doc">Ajax</span></a></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="controller-mapping-policy-label">
<span id="id8"></span><h3><a class="toc-backref" href="#id92">3.4.1.3. リクエストとハンドラメソッドのマッピング方針</a><a class="headerlink" href="#controller-mapping-policy-label" title="Permalink to this headline">¶</a></h3>
<p>以下の方針でマッピングを行うことを推奨する。</p>
<ul>
<li><div class="first line-block">
<div class="line"><strong>業務や機能といった意味のある単位で、リクエストのURLをグループ化する。</strong></div>
<div class="line">URLのグループ化とは、 <code class="docutils literal"><span class="pre">&#64;RequestMapping(value</span> <span class="pre">=</span> <span class="pre">&quot;xxx&quot;)</span></code>をクラスレベルのアノテーションとして定義することを意味する。</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>処理内の画面フローで使用するリクエストのURLは、同じURLにする。</strong></div>
<div class="line">同じURLとは <code class="docutils literal"><span class="pre">&#64;RequestMapping(value</span> <span class="pre">=</span> <span class="pre">&quot;xxx&quot;)</span></code>のvalue属性の値を同じ値にすることを意味する。</div>
<div class="line">処理内の画面フローで使用するハンドラメソッドの切り替えは、HTTPメソッドとHTTPパラメータによって行う。</div>
</div>
</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Spring MVCでは <code class="docutils literal"><span class="pre">&#64;RequestMapping(value</span> <span class="pre">=</span> <span class="pre">&quot;xxx&quot;)</span></code>のvalue属性によってリクエストがマッピングされる際、
サーブレットパスとパス情報は区別されず、パス情報が存在する場合はパス情報、存在しない場合はサーブレットパスがマッピングに利用される。</p>
<p>そのため、サーブレットパスとパス情報に同一のパスを設定した場合、意図せぬパス（URL）がマッピングされる可能性がある。</p>
<p>具体的には、<a class="reference internal" href="#controller-mapping-path-label"><span class="std std-ref">リクエストパスでマッピング</span></a>のようにハンドラメソッドにマッピングするパスを「<code class="docutils literal"><span class="pre">/sample/hello</span></code>」と定義した場合、
web.xmlでサーブレットパスを同じ「<code class="docutils literal"><span class="pre">/sample/hello/*</span></code>」と定義すると、
本来マッピングしたい”/sample/hello/sample/hello”だけでなく、意図しない”/sample/hello”もマッピングされてしまう。</p>
<p>業務上、意図せぬパス（URL）でハンドラメソッドにアクセスできてしまう可能性があり、
また、Spring MVCのリクエストマッピング（<code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code>）ではサーブレット内のパスを指定するのに対し、
Spring Security（Servlet Filter）の認可（<code class="docutils literal"><span class="pre">&lt;sec:intercept-url&gt;</span></code>）ではWebアプリケーション内のパスを指定する。
このため、意図しないパス（上記の場合、”/sample/hello”）への認可設定が漏れ、認可をバイパスされる脆弱性を作りこんでしまう恐れがある。</p>
<p class="last">サーブレットパスとパス情報には異なる値を設定するようにされたい。</p>
</div>
<p>以下にベーシックな画面フローを行うサンプルアプリケーションを例にして、リクエストとハンドラメソッドの具体的なマッピング例を示す。</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-overview-label"><span class="std std-ref">サンプルアプリケーションの概要</span></a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-url-design-label"><span class="std std-ref">リクエストURL</span></a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-mapping-design-label"><span class="std std-ref">リクエストとハンドラメソッドのマッピング</span></a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-form-impl-label"><span class="std std-ref">フォーム表示の実装</span></a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-confirm-impl-label"><span class="std std-ref">入力内容確認表示の実装</span></a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-redo-impl-label"><span class="std std-ref">フォーム再表示の実装</span></a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-create-impl-label"><span class="std std-ref">新規作成の実装</span></a></li>
</ul>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="controller-mapping-policy-sampleapp-overview-label">
<span id="id9"></span><h4><a class="toc-backref" href="#id93">3.4.1.3.1. サンプルアプリケーションの概要</a><a class="headerlink" href="#controller-mapping-policy-sampleapp-overview-label" title="Permalink to this headline">¶</a></h4>
<p>サンプルアプリケーションの機能概要は以下の通り。</p>
<ul>
<li><div class="first line-block">
<div class="line">EntityのCRUD処理を行う機能を提供する。</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">以下の5つの処理を提供する。</div>
</div>
</li>
</ul>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="20%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">処理名</th>
<th class="head">処理概要</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Entity一覧取得</td>
<td>作成済みのEntityを全て取得し、一覧画面に表示する。</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>Entity新規作成</td>
<td>指定した内容で新たにEntityを作成する。処理内には、画面フロー（フォーム画面、確認画面、完了画面）が存在する。</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>Entity参照</td>
<td>指定されたIDのEntityを取得し、詳細画面に表示する。</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>Entity更新</td>
<td>指定されたIDのEntityを更新する。処理内には、画面フロー（フォーム画面、確認画面、完了画面）が存在する。</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td>Entity削除</td>
<td>指定されたIDのEntityを削除する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul>
<li><div class="first line-block">
<div class="line">機能全体の画面フローは以下の通り。</div>
<div class="line">画面フロー図には記載していないが、入力チェックエラーが発生した場合はフォーム画面を再描画するものとする。</div>
</div>
</li>
</ul>
<div class="figure align-center" id="id78">
<a class="reference internal image-reference" href="../_images/application_sample-screen-flow.png"><img alt="Screen flow of entity management function" src="../_images/application_sample-screen-flow.png" style="width: 90%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - Screen flow of entity management function</strong></span></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="url">
<span id="controller-mapping-policy-sampleapp-url-design-label"></span><h4><a class="toc-backref" href="#id94">3.4.1.3.2. リクエストURL</a><a class="headerlink" href="#url" title="Permalink to this headline">¶</a></h4>
<p>必要となるリクエストのURLの設計を行う。</p>
<ul>
<li><div class="first line-block">
<div class="line">機能内で必要となるリクエストのリクエストURLをグループ化する。</div>
<div class="line">ここではAbcというEntityのCRUD操作を行う機能となるので、 <code class="docutils literal"><span class="pre">/abc/</span></code> から始まるURLとする。</div>
</div>
</li>
<li><p class="first">処理毎にリクエストURLを設ける。</p>
</li>
</ul>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="30%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">処理名</th>
<th class="head">処理毎のURL(パターン)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Entity一覧取得</td>
<td>/abc/list</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>Entity新規作成</td>
<td>/abc/create</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>Entity参照</td>
<td>/abc/{id}</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>Entity更新</td>
<td>/abc/{id}/update</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td>Entity削除</td>
<td>/abc/{id}/delete</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Entity参照、Entity更新、Entity削除処理のURL内に指定している <code class="docutils literal"><span class="pre">{id}</span></code> は、<a class="reference external" href="https://docs.spring.io/spring-framework/docs/5.3.18/reference/html/web.html#mvc-ann-requestmapping-uri-templates">URI patterns</a>と呼ばれ、任意の値を指定する事ができる。
サンプルアプリケーションでは、操作するEntityのIDを指定する。</p>
</div>
<p>画面フロー図に各処理に割り振られたURLをマッピングすると以下のようになる。</p>
</div></blockquote>
<div class="figure align-center" id="id79">
<a class="reference internal image-reference" href="../_images/application_sample-screen-flow-assigned-url.png"><img alt="Screen flow of entity management function and assigned URL" src="../_images/application_sample-screen-flow-assigned-url.png" style="width: 90%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - Screen flow of entity management function and assigned URL</strong></span></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-mapping-policy-sampleapp-mapping-design-label">
<span id="id10"></span><h4><a class="toc-backref" href="#id95">3.4.1.3.3. リクエストとハンドラメソッドのマッピング</a><a class="headerlink" href="#controller-mapping-policy-sampleapp-mapping-design-label" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">リクエストとハンドラメソッドのマッピングの設計を行う。</div>
<div class="line">以下は、マッピング方針に則って設計したマッピング定義となる。</div>
</div>
<blockquote>
<div><table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="5%" />
<col width="20%" />
<col width="15%" />
<col width="22%" />
<col width="10%" />
<col width="13%" />
<col width="15%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">項番</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">処理名</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">URL</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">リクエスト名</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">HTTP</div>
<div class="line">メソッド</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">HTTP</div>
<div class="line">パラメータ</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">ハンドラメソッド</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Entity一覧取得</td>
<td>/abc/list</td>
<td>一覧表示</td>
<td>GET</td>
<td>-</td>
<td>list</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>Entity新規作成</td>
<td>/abc/create</td>
<td>フォーム表示</td>
<td>-</td>
<td>form</td>
<td>createForm</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>&#160;</td>
<td>&#160;</td>
<td>入力内容確認表示</td>
<td>POST</td>
<td>confirm</td>
<td>createConfirm</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>&#160;</td>
<td>&#160;</td>
<td>フォーム再表示</td>
<td>POST</td>
<td>redo</td>
<td>createRedo</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td>&#160;</td>
<td>&#160;</td>
<td>新規作成</td>
<td>POST</td>
<td>-</td>
<td>create</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td>&#160;</td>
<td>&#160;</td>
<td>新規作成完了表示</td>
<td>GET</td>
<td>complete</td>
<td>createComplete</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="7">
<li></li>
</ol>
</td>
<td>Entity参照</td>
<td>/abc/{id}</td>
<td>詳細表示</td>
<td>GET</td>
<td>-</td>
<td>read</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="8">
<li></li>
</ol>
</td>
<td>Entity更新</td>
<td>/abc/{id}/update</td>
<td>フォーム表示</td>
<td>-</td>
<td>form</td>
<td>updateForm</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="9">
<li></li>
</ol>
</td>
<td>&#160;</td>
<td>&#160;</td>
<td>入力内容確認表示</td>
<td>POST</td>
<td>confirm</td>
<td>updateConfirm</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="10">
<li></li>
</ol>
</td>
<td>&#160;</td>
<td>&#160;</td>
<td>フォーム再表示</td>
<td>POST</td>
<td>redo</td>
<td>updateRedo</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="11">
<li></li>
</ol>
</td>
<td>&#160;</td>
<td>&#160;</td>
<td>更新</td>
<td>POST</td>
<td>-</td>
<td>update</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="12">
<li></li>
</ol>
</td>
<td>&#160;</td>
<td>&#160;</td>
<td>更新完了表示</td>
<td>GET</td>
<td>complete</td>
<td>updateComplete</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="13">
<li></li>
</ol>
</td>
<td>Entity削除</td>
<td>/abc/{id}/delete</td>
<td>削除</td>
<td>POST</td>
<td>-</td>
<td>delete</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="14">
<li></li>
</ol>
</td>
<td>&#160;</td>
<td>&#160;</td>
<td>削除完了表示</td>
<td>GET</td>
<td>complete</td>
<td>deleteComplete</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line">Entity新規作成、Entity更新、Entity削除処理では、処理内に複数のリクエストが存在しているため、HTTPメソッドとHTTPパラメータによってハンドラメソッドを切り替えている。</div>
<div class="line">以下に、Entity新規作成処理を例に、処理内に複数のリクエストが存在する場合のリクエストフローを示す。</div>
<div class="line">URLは全て <code class="docutils literal"><span class="pre">/abc/create</span></code> で、HTTPメソッドとHTTPパラメータの組み合わせでハンドラメソッドを切り替えている点に注目すること。</div>
</div>
<div class="figure align-center" id="id80">
<a class="reference internal image-reference" href="../_images/applicationScreenflow.png"><img alt="Request flow of entity create processing" src="../_images/applicationScreenflow.png" style="width: 90%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - Request flow of entity create processing</strong></span></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">以下に、Entity新規作成処理のハンドラメソッドの実装コードを示す。</div>
<div class="line">ここではリクエストとハンドラメソッドのマッピングについて理解してもらうのが目的なので、<code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code>の書き方に注目すること。</div>
<div class="line">ハンドラメソッドの引数や返り値(View名及びView)の詳細については、次章以降で説明する。</div>
</div>
<ul class="simple">
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-form-impl-label"><span class="std std-ref">フォーム表示の実装</span></a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-confirm-impl-label"><span class="std std-ref">入力内容確認表示の実装</span></a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-redo-impl-label"><span class="std std-ref">フォーム再表示の実装</span></a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-create-impl-label"><span class="std std-ref">新規作成の実装</span></a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-complete-impl-label"><span class="std std-ref">新規作成完了表示の実装</span></a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-multi-impl-label"><span class="std std-ref">HTML form上に複数のボタンを配置する場合の実装</span></a></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-mapping-policy-sampleapp-form-impl-label">
<span id="id11"></span><h4><a class="toc-backref" href="#id96">3.4.1.3.4. フォーム表示の実装</a><a class="headerlink" href="#controller-mapping-policy-sampleapp-form-impl-label" title="Permalink to this headline">¶</a></h4>
<p>フォーム表示する場合は、HTTPパラメータとして <code class="docutils literal"><span class="pre">form</span></code> を指定させる。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="hll"><span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;form&quot;</span><span class="p">)</span> <span class="c1">// (1)</span>
</span><span class="kd">public</span> <span class="n">String</span> <span class="nf">createForm</span><span class="p">(</span><span class="n">AbcForm</span> <span class="n">form</span><span class="p">,</span> <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// omitted</span>
<span class="hll">    <span class="k">return</span> <span class="s">&quot;abc/createForm&quot;</span><span class="p">;</span> <span class="c1">// (2)</span>
</span><span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>params属性に <code class="docutils literal"><span class="pre">form</span></code> を指定する。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>フォーム画面を描画するためのJSPのView名を返却する。</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">この処理でHTTPメソッドをGETに限る必要がないのでmethod属性を指定していない。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>以下に、ハンドラメソッド以外の部分の実装例についても説明しておく。</p>
<p>フォーム表示を行う場合、ハンドラメソッドの実装以外に、</p>
<ul class="simple">
<li>フォームオブジェクトの生成処理の実装。フォームオブジェクトの詳細は、 <a class="reference internal" href="#formobject"><span class="std std-ref">フォームオブジェクトの実装</span></a> を参照されたい。</li>
<li>フォーム画面のViewの実装。Viewの詳細は、 <a class="reference internal" href="#id49"><span class="std std-ref">Viewの実装</span></a> を参照されたい。</li>
</ul>
<p>が必要になる。</p>
<p>以下のフォームオブジェクトを使用する。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AbcForm</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="p">;</span>

    <span class="nd">@NotEmpty</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">input1</span><span class="p">;</span>

    <span class="nd">@NotNull</span>
    <span class="nd">@Min</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nd">@Max</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">input2</span><span class="p">;</span>

    <span class="c1">// omitted setter&amp;getter</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>フォームオブジェクトを生成する。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@ModelAttribute</span>
<span class="kd">public</span> <span class="n">AbcForm</span> <span class="nf">setUpAbcForm</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">AbcForm</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>フォーム画面のView(JSP)を作成する。</p>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;h1&gt;</span>Abc Create Form<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;form:form</span> <span class="na">modelAttribute=</span><span class="s">&quot;abcForm&quot;</span>
    <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/abc/create&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;form:label</span> <span class="na">path=</span><span class="s">&quot;input1&quot;</span><span class="nt">&gt;</span>Input1<span class="nt">&lt;/form:label&gt;</span>
    <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;input1&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;input1&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;form:label</span> <span class="na">path=</span><span class="s">&quot;input2&quot;</span><span class="nt">&gt;</span>Input2<span class="nt">&lt;/form:label&gt;</span>
    <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;input2&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;input2&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;br&gt;</span>
<span class="hll">    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;confirm&quot;</span> <span class="na">value=</span><span class="s">&quot;Confirm&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="nt">&lt;/form:form&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>確認画面へ遷移するためのsubmitボタンには<code class="docutils literal"><span class="pre">name=&quot;confirm&quot;</span></code>というパラメータを指定しておく。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>以下に、フォーム表示の動作について説明する。</p>
<div class="line-block">
<div class="line">フォーム表示処理を呼び出す。</div>
<div class="line"><code class="docutils literal"><span class="pre">abc/create?form</span></code> というURIにアクセスする。</div>
<div class="line"><code class="docutils literal"><span class="pre">form</span></code> というHTTPパラメータの指定があるため、ControllerのcreateFormメソッドが呼び出されフォーム画面が表示される。</div>
</div>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../_images/applicationCreateFormDisplay.png"><img alt="../_images/applicationCreateFormDisplay.png" src="../_images/applicationCreateFormDisplay.png" style="width: 90%;" /></a>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-mapping-policy-sampleapp-confirm-impl-label">
<span id="id12"></span><h4><a class="toc-backref" href="#id97">3.4.1.3.5. 入力内容確認表示の実装</a><a class="headerlink" href="#controller-mapping-policy-sampleapp-confirm-impl-label" title="Permalink to this headline">¶</a></h4>
<p>フォームの入力内容を確認する場合は、POSTメソッドでデータを送信し、HTTPパラメータに <code class="docutils literal"><span class="pre">confirm</span></code> を指定させる。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="hll"><span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;confirm&quot;</span><span class="p">)</span> <span class="c1">// (1)</span>
</span><span class="kd">public</span> <span class="n">String</span> <span class="nf">createConfirm</span><span class="p">(</span><span class="nd">@Validated</span> <span class="n">AbcForm</span> <span class="n">form</span><span class="p">,</span> <span class="n">BindingResult</span> <span class="n">result</span><span class="p">,</span>
        <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
<span class="hll">        <span class="k">return</span> <span class="n">createRedo</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">model</span><span class="p">);</span> <span class="c1">// return &quot;abc/createForm&quot;; (2)</span>
</span>    <span class="p">}</span>
    <span class="c1">// omitted</span>
<span class="hll">    <span class="k">return</span> <span class="s">&quot;abc/createConfirm&quot;</span><span class="p">;</span> <span class="c1">// (3)</span>
</span><span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>method属性に <code class="docutils literal"><span class="pre">RequestMethod.POST</span></code> 、params属性に <code class="docutils literal"><span class="pre">confirm</span></code> を指定する。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>入力チェックエラーが発生した場合の処理は、フォーム再表示用のハンドラメソッドを呼び出すことを推奨する。フォーム画面を再表示するための処理の共通化を行うことができる。</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>入力内容確認画面を描画するためのJSPのView名を返却する。</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">POSTメソッドを指定させる理由は、個人情報やパスワードなどの秘密情報がブラウザのアドレスバーに現れ、他人に容易に閲覧されることを防ぐためである。
(もちろんセキュリティ対策としては十分ではなく、SSLなどのセキュアなサイトにする必要がある)。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>以下に、ハンドラメソッド以外の部分の実装例についても説明しておく。</p>
<p>入力内容確認表示を行う場合、ハンドラメソッドの実装以外に、</p>
<ul class="simple">
<li>入力内容確認画面のViewの実装。Viewの詳細は、 <a class="reference internal" href="#id49"><span class="std std-ref">Viewの実装</span></a> を参照されたい。</li>
</ul>
<p>が必要になる。</p>
<p>入力内容確認画面のView(JSP)を作成する。</p>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;h1&gt;</span>Abc Create Form<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;form:form</span> <span class="na">modelAttribute=</span><span class="s">&quot;abcForm&quot;</span>
    <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/abc/create&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;form:label</span> <span class="na">path=</span><span class="s">&quot;input1&quot;</span><span class="nt">&gt;</span>Input1<span class="nt">&lt;/form:label&gt;</span>
        ${f:h(abcForm.input1)}
<span class="hll">    <span class="nt">&lt;form:hidden</span> <span class="na">path=</span><span class="s">&quot;input1&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</span>    <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;form:label</span> <span class="na">path=</span><span class="s">&quot;input2&quot;</span><span class="nt">&gt;</span>Input2<span class="nt">&lt;/form:label&gt;</span>
        ${f:h(abcForm.input2)}
<span class="hll">    <span class="nt">&lt;form:hidden</span> <span class="na">path=</span><span class="s">&quot;input2&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</span>    <span class="nt">&lt;br&gt;</span>
<span class="hll">    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;redo&quot;</span> <span class="na">value=</span><span class="s">&quot;Back&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Create&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="nt">&lt;/form:form&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>フォーム画面で入力された値は、Createボタン及びBackボタンが押下された際に再度サーバに送る必要があるため、HTML formのhidden項目とする。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>フォーム画面に戻るためのsubmitボタンには<code class="docutils literal"><span class="pre">name=&quot;redo&quot;</span></code>というパラメータを指定しておく。</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>新規作成を行うためのsubmitボタンにはパラメータ名の指定は不要。</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">この例では確認項目を表示する際にHTMLエスケープするため、 <code class="docutils literal"><span class="pre">f:h()</span></code> 関数を使用している。
XSS対策のため、必ず行うこと。詳細については <a class="reference internal" href="../Security/XSS.html"><span class="doc">Cross Site Scripting</span></a> を参照されたい。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>以下に、入力内容確認の動作について説明する。</p>
<div class="line-block">
<div class="line">入力内容確認表示処理を呼び出す。</div>
<div class="line">フォーム画面でInput1に <code class="docutils literal"><span class="pre">aa</span></code> を、Input2に “<code class="docutils literal"><span class="pre">5</span></code>” を入力し、Confirmボタンを押下する。</div>
<div class="line">Confirmボタンを押下すると、 <code class="docutils literal"><span class="pre">abc/create?confirm</span></code> というURIにPOSTメソッドでアクセスする。</div>
<div class="line"><code class="docutils literal"><span class="pre">confirm</span></code> というHTTPパラメータがあるため、ControllerのcreateConfirmメソッドが呼び出され、入力内容確認画面が表示される。</div>
</div>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../_images/applicationCreateConfirmDisplay.png"><img alt="../_images/applicationCreateConfirmDisplay.png" src="../_images/applicationCreateConfirmDisplay.png" style="width: 90%;" /></a>
</div>
</div></blockquote>
<p>Confirmボタンを押下するとPOSTメソッドでHTTPパラメータが送信されるため、URIには現れていないが、HTTPパラメータとして <code class="docutils literal"><span class="pre">confirm</span></code> が含まれている。</p>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../_images/applicationCreateConfirmNetwork.png"><img alt="../_images/applicationCreateConfirmNetwork.png" src="../_images/applicationCreateConfirmNetwork.png" style="width: 90%;" /></a>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-mapping-policy-sampleapp-redo-impl-label">
<span id="id13"></span><h4><a class="toc-backref" href="#id98">3.4.1.3.6. フォーム再表示の実装</a><a class="headerlink" href="#controller-mapping-policy-sampleapp-redo-impl-label" title="Permalink to this headline">¶</a></h4>
<p>フォームを再表示する場合は、HTTPパラメータにredoを指定させる。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="hll"><span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;redo&quot;</span><span class="p">)</span> <span class="c1">// (1)</span>
</span><span class="kd">public</span> <span class="n">String</span> <span class="nf">createRedo</span><span class="p">(</span><span class="n">AbcForm</span> <span class="n">form</span><span class="p">,</span> <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// omitted</span>
<span class="hll">    <span class="k">return</span> <span class="s">&quot;abc/createForm&quot;</span><span class="p">;</span> <span class="c1">// (2)</span>
</span><span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>method属性に <code class="docutils literal"><span class="pre">RequestMethod.POST</span></code> 、params属性に <code class="docutils literal"><span class="pre">redo</span></code> を指定する。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>入力内容確認画面を描画するためのJSPのView名を返却する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>以下に、フォーム再表示の動作について説明する。</p>
<div class="line-block">
<div class="line">フォーム再表示リクエストを呼び出す。</div>
<div class="line">入力内容確認画面で、Backボタンを押下する。</div>
<div class="line">Backボタンを押下すると、 <code class="docutils literal"><span class="pre">abc/create?redo</span></code> というURIにPOSTメソッドでアクセスする。</div>
<div class="line"><code class="docutils literal"><span class="pre">redo</span></code> というHTTPパラメータがあるため、ControllerのcreateRedoメソッドが呼び出され、フォーム画面が再表示される。</div>
</div>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../_images/applicationCreateConfirmDisplay.png"><img alt="../_images/applicationCreateConfirmDisplay.png" src="../_images/applicationCreateConfirmDisplay.png" style="width: 90%;" /></a>
</div>
</div></blockquote>
<p>Backボタンを押下するとPOSTメソッドでHTTPパラメータが送信されるため、URIには現れていないが、HTTPパラメータとして <code class="docutils literal"><span class="pre">redo</span></code> が含まれている。
また、フォームの入力値をhidden項目として送信されるため、フォーム画面で入力値を復元することが出来る。</p>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../_images/applicationBackToCreateFormDisplay.png"><img alt="../_images/applicationBackToCreateFormDisplay.png" src="../_images/applicationBackToCreateFormDisplay.png" style="width: 90%;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/applicationBackToCreateFormNetwork.png"><img alt="../_images/applicationBackToCreateFormNetwork.png" src="../_images/applicationBackToCreateFormNetwork.png" style="width: 90%;" /></a>
</div>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>戻るボタンの実現方法には、ボタンの属性に <code class="docutils literal"><span class="pre">onclick=&quot;javascript:history.back()&quot;</span></code> を設定する方法もある。
両者では以下が異なり、要件に応じて選択する必要がある。</p>
<ul class="last simple">
<li>ブラウザの戻るボタンを押した場合の挙動</li>
<li>戻るボタンがあるページに直接アクセスして戻るボタンを押した場合の挙動</li>
<li>ブラウザの履歴</li>
</ul>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-mapping-policy-sampleapp-create-impl-label">
<span id="id14"></span><h4><a class="toc-backref" href="#id99">3.4.1.3.7. 新規作成の実装</a><a class="headerlink" href="#controller-mapping-policy-sampleapp-create-impl-label" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">フォームの入力内容を登録する場合は、POSTで登録対象のデータ(hiddenパラメータ)を送信させる。</div>
<div class="line">新規作成リクエストはこの処理のメインリクエストになるので、HTTPパラメータによる振り分けは行っていない。</div>
<div class="line">この処理ではデータベースの状態を変更するので、二重送信によって新規作成処理が複数回実行されないように制御する必要がある。</div>
<div class="line">そのため、この処理が終了した後はView(画面)を直接表示するのではなく、次の画面(新規作成完了画面)へリダイレクトしている。このパターンをPOST-Redirect-GET(PRG)パターンと呼ぶ。  <abbr title="Post-Redirect-Get">PRG</abbr> パターンの詳細については <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/DoubleSubmitProtection.html"><span class="doc">二重送信防止</span></a> を参照されたい。</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="hll"><span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span> <span class="c1">// (1)</span>
</span><span class="kd">public</span> <span class="n">String</span> <span class="nf">create</span><span class="p">(</span><span class="nd">@Validated</span> <span class="n">AbcForm</span> <span class="n">form</span><span class="p">,</span> <span class="n">BindingResult</span> <span class="n">result</span><span class="p">,</span> <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">createRedo</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">model</span><span class="p">);</span> <span class="c1">// return &quot;abc/createForm&quot;;</span>
    <span class="p">}</span>
    <span class="c1">// omitted</span>
<span class="hll">    <span class="k">return</span> <span class="s">&quot;redirect:/abc/create?complete&quot;</span><span class="p">;</span> <span class="c1">// (2)</span>
</span><span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>method属性に <code class="docutils literal"><span class="pre">RequestMethod.POST</span></code> を指定し、params属性は指定しない。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><abbr title="Post-Redirect-Get">PRG</abbr> パターンとするため、新規作成完了表示リクエストにリダイレクトするためのURLをView名として返却する。</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">“redirect:/xxx”を返却すると”/xxx”へリダイレクトさせることができる。</p>
</div>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">PRGパターンとすることで、ブラウザのF5ボタン押下時のリロードによる二重送信を防ぐ事はできるが、二重送信の対策としては十分ではない。
二重送信の対策としては、共通部品として提供しているTransactionTokenCheckを行う必要がある。
TransactionTokenCheckの詳細については <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/DoubleSubmitProtection.html"><span class="doc">二重送信防止</span></a> を参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>以下に、「新規作成」の動作について説明する。</p>
<div class="line-block">
<div class="line">新規作成処理を呼び出す。</div>
<div class="line">入力内容確認画面で、Createボタンを押下する。</div>
<div class="line">Createボタンを押下すると、 <code class="docutils literal"><span class="pre">abc/create</span></code> というURIにPOSTメソッドでアクセスする。</div>
<div class="line">ボタンを識別するためのHTTPパラメータを送信していないので、Entity新規作成処理のメインのリクエストと判断され、Controllerのcreateメソッドが呼び出される。</div>
</div>
<div class="line-block">
<div class="line">新規作成リクエストでは、直接画面を返さず、新規作成完了表示( <code class="docutils literal"><span class="pre">/abc/create?complete</span></code> )へリダイレクトしているため、HTTPステータスが302になっている。</div>
</div>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../_images/applicationCreateNetwork.png"><img alt="../_images/applicationCreateNetwork.png" src="../_images/applicationCreateNetwork.png" style="width: 90%;" /></a>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-mapping-policy-sampleapp-complete-impl-label">
<span id="id15"></span><h4><a class="toc-backref" href="#id100">3.4.1.3.8. 新規作成完了表示の実装</a><a class="headerlink" href="#controller-mapping-policy-sampleapp-complete-impl-label" title="Permalink to this headline">¶</a></h4>
<p>新規作成処理が完了した事を通知する場合は、HTTPパラメータに <code class="docutils literal"><span class="pre">complete</span></code> を指定させる。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="hll"><span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;complete&quot;</span><span class="p">)</span> <span class="c1">// (1)</span>
</span><span class="kd">public</span> <span class="n">String</span> <span class="nf">createComplete</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// omitted</span>
<span class="hll">    <span class="k">return</span> <span class="s">&quot;abc/createComplete&quot;</span><span class="p">;</span> <span class="c1">// (2)</span>
</span><span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>params属性に <code class="docutils literal"><span class="pre">complete</span></code> を指定する。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>新規作成完了画面を描画するため、JSPのView名を返却する。</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">この処理もHTTPメソッドをGETに限る必要がないのでmethod属性を指定しなくても良い。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>以下に、「新規作成完了表示」の動作について説明する。</p>
<div class="line-block">
<div class="line">新規作成完了後、リダイレクト先に指定されたURI( <code class="docutils literal"><span class="pre">/abc/create?complete</span></code> )にアクセスする。</div>
<div class="line"><code class="docutils literal"><span class="pre">complete</span></code> というHTTPパラメータがあるため、ControllerのcreateCompleteメソッドが呼び出され、新規作成完了画面が表示される。</div>
</div>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../_images/applicationCreateCompleteDisplay.png"><img alt="../_images/applicationCreateCompleteDisplay.png" src="../_images/applicationCreateCompleteDisplay.png" style="width: 90%;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/applicationCreateCompleteNetwork.png"><img alt="../_images/applicationCreateCompleteNetwork.png" src="../_images/applicationCreateCompleteNetwork.png" style="width: 90%;" /></a>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">PRGパターンを利用しているため、ブラウザをリロードしても、新規作成処理は実行されず、新規作成完了が再度表示されるだけである。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="html-form">
<span id="controller-mapping-policy-sampleapp-multi-impl-label"></span><h4><a class="toc-backref" href="#id101">3.4.1.3.9. HTML form上に複数のボタンを配置する場合の実装</a><a class="headerlink" href="#html-form" title="Permalink to this headline">¶</a></h4>
<p>1つのフォームに対して複数のボタンを設置したい場合、ボタンを識別するためのHTTPパラメータを送ることで、
実行するハンドラメソッドを切り替える。
ここではサンプルアプリケーションの入力内容確認画面のCreateボタンとBackボタンを例に説明する。</p>
<p>下図のように、入力内容確認画面のフォームには、新規作成を行うCreateボタンと新規作成フォーム画面を再表示するBackボタンが存在する。</p>
<div class="figure align-center" id="id81">
<a class="reference internal image-reference" href="../_images/applicationControllerBackToForm.png"><img alt="Multiple button in the HTML form" src="../_images/applicationControllerBackToForm.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - Multiple button in the HTML form</strong></span></p>
</div>
<p>Backボタンを押下した場合、新規作成フォーム画面を再表示するためのリクエスト( <code class="docutils literal"><span class="pre">/abc/create?redo</span></code> )を送信する必要があるため、
HTML form内に以下のコードが必要となる。</p>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="hll"><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;redo&quot;</span> <span class="na">value=</span><span class="s">&quot;Back&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Create&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>上記のように、入力内容確認画面( <code class="docutils literal"><span class="pre">abc/createConfirm.jsp</span></code> )のBackボタンに<code class="docutils literal"><span class="pre">name=&quot;redo&quot;</span></code>というパラメータを指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Backボタン押下時の動作については、 <a class="reference internal" href="#controller-mapping-policy-sampleapp-redo-impl-label"><span class="std std-ref">フォーム再表示の実装</span></a> を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-mapping-policy-sampleapp-all-impl-label">
<span id="id16"></span><h4><a class="toc-backref" href="#id102">3.4.1.3.10. サンプルアプリケーションのControllerのソースコード</a><a class="headerlink" href="#controller-mapping-policy-sampleapp-all-impl-label" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">以下に、サンプルアプリケーションの新規作成処理実装後のControllerの全ソースを示す。</div>
<div class="line">Entity一覧取得、Entity参照、Entity更新、Entity削除も同じ要領で実装することになるが、説明は割愛する。</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;abc&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AbcController</span> <span class="p">{</span>

    <span class="nd">@ModelAttribute</span>
    <span class="kd">public</span> <span class="n">AbcForm</span> <span class="nf">setUpAbcForm</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">AbcForm</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Handling request of &quot;/abc/create?form&quot;</span>
    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;form&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">createForm</span><span class="p">(</span><span class="n">AbcForm</span> <span class="n">form</span><span class="p">,</span> <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// omitted</span>
        <span class="k">return</span> <span class="s">&quot;abc/createForm&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Handling request of &quot;POST /abc/create?confirm&quot;</span>
    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;confirm&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">createConfirm</span><span class="p">(</span><span class="nd">@Validated</span> <span class="n">AbcForm</span> <span class="n">form</span><span class="p">,</span> <span class="n">BindingResult</span> <span class="n">result</span><span class="p">,</span>
            <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">createRedo</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">model</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">// omitted</span>
        <span class="k">return</span> <span class="s">&quot;abc/createConfirm&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Handling request of &quot;POST /abc/create?redo&quot;</span>
    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;redo&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">createRedo</span><span class="p">(</span><span class="n">AbcForm</span> <span class="n">form</span><span class="p">,</span> <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// omitted</span>
        <span class="k">return</span> <span class="s">&quot;abc/createForm&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Handling request of &quot;POST /abc/create&quot;</span>
    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">create</span><span class="p">(</span><span class="nd">@Validated</span> <span class="n">AbcForm</span> <span class="n">form</span><span class="p">,</span> <span class="n">BindingResult</span> <span class="n">result</span><span class="p">,</span> <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">createRedo</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">model</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">// omitted</span>
        <span class="k">return</span> <span class="s">&quot;redirect:/abc/create?complete&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Handling request of &quot;/abc/create?complete&quot;</span>
    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;complete&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">createComplete</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// omitted</span>
        <span class="k">return</span> <span class="s">&quot;abc/createComplete&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="controller-method-argument-label">
<span id="id17"></span><h3><a class="toc-backref" href="#id103">3.4.1.4. ハンドラメソッドの引数について</a><a class="headerlink" href="#controller-method-argument-label" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://docs.spring.io/spring-framework/docs/5.3.18/reference/html/web.html#mvc-ann-arguments">ハンドラメソッドの引数は様々な値をとることができる</a> が、
基本的には次に挙げるものは原則として使用しないこと。</p>
<ul class="simple">
<li>ServletRequest</li>
<li>HttpServletRequest</li>
<li>org.springframework.web.context.request.WebRequest</li>
<li>org.springframework.web.context.request.NativeWebRequest</li>
<li>java.io.InputStream</li>
<li>java.io.Reader</li>
<li>java.io.OutputStream</li>
<li>java.io.Writer</li>
<li>java.util.Map</li>
<li>org.springframework.ui.ModelMap</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><code class="docutils literal"><span class="pre">HttpServletRequest</span></code> のgetAttribute/setAttribute
や <code class="docutils literal"><span class="pre">Map</span></code> のget/putのような汎用的なメソッドの利用を許可すると自由な値の受け渡しができてしまい、
プロジェクトの規模が大きくなると保守性を著しく低下させる可能性がある。</p>
<p>同様の理由で、他で代替できる場合は <code class="docutils literal"><span class="pre">HttpSession</span></code> を極力使用しないことを推奨する。</p>
<p class="last">共通的なパラメータ(リクエストパラメータ)をJavaBeanに格納してControllerの引数に渡したい場合は
後述の <a class="reference internal" href="#methodargumentresolver"><span class="std std-ref">HandlerMethodArgumentResolverの実装</span></a> を使用することで実現できる。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>以下に、引数の使用方法について、目的別に13例示す。</p>
<ul class="simple">
<li><a class="reference internal" href="#controller-method-argument-model-label"><span class="std std-ref">画面(View)にデータを渡す</span></a></li>
<li><a class="reference internal" href="#controller-method-argument-pathvariable-label"><span class="std std-ref">URLのパスから値を取得する</span></a></li>
<li><a class="reference internal" href="#controller-method-argument-requestparam-label"><span class="std std-ref">リクエストパラメータを個別に取得する</span></a></li>
<li><a class="reference internal" href="#controller-method-argument-form-label"><span class="std std-ref">リクエストパラメータをまとめて取得する</span></a></li>
<li><a class="reference internal" href="#controller-method-argument-validation-label"><span class="std std-ref">入力チェックを行う</span></a></li>
<li><a class="reference internal" href="#controller-method-argument-redirectattributes-label"><span class="std std-ref">リダイレクト先にデータを渡す</span></a></li>
<li><a class="reference internal" href="#controller-method-argument-redirectattributes-param-label"><span class="std std-ref">リダイレクト先へリクエストパラメータを渡す</span></a></li>
<li><a class="reference internal" href="#controller-method-argument-redirectattributes-path-label"><span class="std std-ref">リダイレクト先URLのパスに値を埋め込む</span></a></li>
<li><a class="reference internal" href="#controller-method-argument-cookievalue-label"><span class="std std-ref">Cookieから値を取得する</span></a></li>
<li><a class="reference internal" href="#controller-method-argument-cookiewrite-label"><span class="std std-ref">Cookieに値を書き込む</span></a></li>
<li><a class="reference internal" href="#controller-method-argument-pagination-label"><span class="std std-ref">ページネーション情報を取得する</span></a></li>
<li><a class="reference internal" href="#controller-method-argument-upload-label"><span class="std std-ref">アップロードファイルを取得する</span></a></li>
<li><a class="reference internal" href="#controller-method-argument-message-label"><span class="std std-ref">画面に結果メッセージを表示する</span></a></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="view">
<span id="controller-method-argument-model-label"></span><h4><a class="toc-backref" href="#id104">3.4.1.4.1. 画面(View)にデータを渡す</a><a class="headerlink" href="#view" title="Permalink to this headline">¶</a></h4>
<p>画面(View)に表示するデータを渡したい場合は、<code class="docutils literal"><span class="pre">org.springframework.ui.Model</span></code>(以降 <code class="docutils literal"><span class="pre">Model</span></code> と呼ぶ) をハンドラメソッドの引数として受け取り、
<code class="docutils literal"><span class="pre">Model</span></code>オブジェクトに渡したいデータ(オブジェクト)を追加する。</p>
<ul class="simple">
<li>SampleController.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="hll"><span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// (1)</span>
</span><span class="hll">    <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">,</span> <span class="s">&quot;Hello World!&quot;</span><span class="p">);</span> <span class="c1">// (2)</span>
</span><span class="hll">    <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="k">new</span> <span class="n">HelloBean</span><span class="p">(</span><span class="s">&quot;Bean Hello World!&quot;</span><span class="p">));</span> <span class="c1">// (3)</span>
</span>    <span class="k">return</span> <span class="s">&quot;sample/hello&quot;</span><span class="p">;</span> <span class="c1">// returns view name</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>hello.jsp</li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="hll">Message : ${f:h(hello)}<span class="nt">&lt;br&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span><span class="hll">Message : ${f:h(helloBean.message)}<span class="nt">&lt;br&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span></pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>HTML of created by View(hello.jsp)</li>
</ul>
<blockquote>
<div><div class="highlight-html"><div class="highlight"><pre><span></span><span class="hll">Message : Hello World!<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span> <span class="c">&lt;!-- (6) --&gt;</span>
</span><span class="hll">Message : Bean Hello World!<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>　<span class="c">&lt;!-- (6) --&gt;</span>
</span></pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">Model</span></code>オブジェクトを引数として受け取る。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">引数で受け取った<code class="docutils literal"><span class="pre">Model</span></code>オブジェクトの<code class="docutils literal"><span class="pre">addAttribute</span></code>メソッドを呼び出し、渡したいデータを<code class="docutils literal"><span class="pre">Model</span></code>オブジェクトに追加する。</div>
<div class="line">例では、<code class="docutils literal"><span class="pre">hello</span></code> という属性名で <code class="docutils literal"><span class="pre">HelloWorld!</span></code> という文字列のデータを追加している。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">addAttribute</span></code>メソッドの第一引数を省略すると<a class="reference external" href="https://spring.pleiades.io/spring-framework/docs/current/javadoc-api/org/springframework/core/Conventions.html#getVariableName-java.lang.Object-">Conventions#getVariableName</a>の仕様に基づき、値のクラス名から属性名を決定する。</div>
<div class="line">例では、 <code class="docutils literal"><span class="pre">model.addAttribute(&quot;helloBean&quot;,</span> <span class="pre">new</span> <span class="pre">HelloBean());</span></code> を行ったのと同じ結果となる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">View(JSP)側では、「${属性名}」と記述することで<code class="docutils literal"><span class="pre">Model</span></code>オブジェクトに追加したデータを取得することができる。</div>
<div class="line">例ではHTMLエスケープを行うEL式の関数を呼び出しているため、「${f:h(属性名)}」としている。</div>
<div class="line">HTMLエスケープを行うEL式の関数の詳細については、 <a class="reference internal" href="../Security/XSS.html"><span class="doc">Cross Site Scripting</span></a> を参照されたい。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">「${属性名.JavaBeanのプロパティ名}」と記述することで<code class="docutils literal"><span class="pre">Model</span></code>に格納されているJavaBeanから値を取得することができる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">JSP実行後に出力されるHTML。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">Model</span></code>は使用しない場合でも引数に指定しておいてもよい。実装初期段階では必要なくても
後で使う場合がある(後々メソッドのシグニチャを変更する必要がなくなる)。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">Model</span></code> に <code class="docutils literal"><span class="pre">addAttribute</span></code> することで、 <code class="docutils literal"><span class="pre">HttpServletRequest</span></code> に <code class="docutils literal"><span class="pre">setAttribute</span></code> されるため、
Spring MVCの管理下にないモジュール(例えばServletFilterなど)からも値を参照することが出来る。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-method-argument-pathvariable-label">
<span id="id19"></span><h4><a class="toc-backref" href="#id105">3.4.1.4.2. URLのパスから値を取得する</a><a class="headerlink" href="#controller-method-argument-pathvariable-label" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">URLのパスから値を取得する場合は、引数に<code class="docutils literal"><span class="pre">&#64;PathVariable</span></code>アノテーションを付与する。</div>
<div class="line"><code class="docutils literal"><span class="pre">&#64;PathVariable</span></code>アノテーションを使用してパスから値を取得する場合、 <code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code>アノテーションのvalue属性に取得したい部分を変数化しておく必要がある。</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="hll"><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;hello/{id}/{version}&quot;</span><span class="p">)</span> <span class="c1">// (1)</span>
</span><span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">(</span>
<span class="hll">        <span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">String</span> <span class="n">id</span><span class="p">,</span> <span class="c1">// (2)</span>
</span><span class="hll">        <span class="nd">@PathVariable</span> <span class="n">Integer</span> <span class="n">version</span><span class="p">,</span> <span class="c1">// (3)</span>
</span>        <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something</span>
    <span class="k">return</span> <span class="s">&quot;sample/hello&quot;</span><span class="p">;</span> <span class="c1">// returns view name</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code>アノテーションのvalue属性に、抜き出したい箇所をパス変数として指定する。パス変数は、「{変数名}」の形式で指定する。</div>
<div class="line">上記例では、 <code class="docutils literal"><span class="pre">id</span></code> と <code class="docutils literal"><span class="pre">version</span></code> という二つのパス変数を指定している。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">&#64;PathVariable</span></code>アノテーションのvalue属性には、パス変数の変数名を指定する。</div>
<div class="line">上記例では、 <code class="docutils literal"><span class="pre">sample/hello/aaaa/1</span></code> というURLにアクセスした場合、引数idに文字列 <code class="docutils literal"><span class="pre">aaaa</span></code> が渡る。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line"><code class="docutils literal"><span class="pre">&#64;PathVariable</span></code>アノテーションのvalue属性は省略可能で、省略した場合は引数名がリクエストパラメータ名となる。</div>
<div class="line">上記例では、 <code class="docutils literal"><span class="pre">sample/hello/aaaa/1</span></code> というURLにアクセスした場合、引数versionに数値 “<code class="docutils literal"><span class="pre">1</span></code>” が渡る。</div>
<div class="line">ただしこの方法は、</div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">-g</span></code>オプション(デバッグ情報を出力するモード)</li>
<li>Java8から追加された<code class="docutils literal"><span class="pre">-parameters</span></code>オプション(メソッド・パラメータにリフレクション用のメタデータを生成するモード)</li>
</ul>
<p class="last">のどちらかを指定してコンパイルする必要がある。</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">バインドする引数の型はString以外でも良い。型が合わない場合は<code class="docutils literal"><span class="pre">org.springframework.beans.TypeMismatchException</span></code>がスローされ、デフォルトの動作は400(Bad Request)が応答される。
例えば、上記例で <code class="docutils literal"><span class="pre">sample/hello/aaaa/v1</span></code> というURLでアクセスした場合、<code class="docutils literal"><span class="pre">v1</span></code> をIntegerに変換できないため、例外がスローされる。</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><code class="docutils literal"><span class="pre">&#64;PathVariable</span></code>アノテーションのvalue属性を省略する場合、デプロイするアプリケーションは<code class="docutils literal"><span class="pre">-g</span></code>オプション又はJava8から追加された<code class="docutils literal"><span class="pre">-parameters</span></code>オプションを指定してコンパイルする必要がある。
これらのオプションを指定した場合、コンパイル後のクラスにはデバッグ時に必要となる情報や処理などが挿入されるため、メモリや処理性能に影響を与えることがあるので注意が必要である。
基本的には、value属性を明示的に指定する方法を推奨する。</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Spring Framework 5.3.0より、パスの最後をパス変数にする場合、バインドされる値に拡張子が含まれるように変更された。
これはSpring MVCにおいてリクエストパスの拡張子によるパターンマッチングが非推奨となったことによる影響で、従来は拡張子がパス変数と別に扱われていたが、パス変数の一部として扱われるようになったためである。</p>
<p>これを回避するには以下の２種類の方法がある。</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">mvc:annotation-driven</span></code> の設定で <code class="docutils literal"><span class="pre">suffix-pattern</span></code> を有効にする（全体）</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;mvc:annotation-driven&gt;</span>
    <span class="c">&lt;!-- ommitted --&gt;</span>
    <span class="nt">&lt;mvc:path-matching</span> <span class="na">suffix-pattern=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/mvc:annotation-driven&gt;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code> で拡張子無しと有りの両方のパスにマッピングする（個別）</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">({</span> <span class="s">&quot;hello/{id}/{version}&quot;</span><span class="p">,</span> <span class="s">&quot;hello/{id}/{version}.*&quot;</span> <span class="p">})</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">(</span>
        <span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">String</span> <span class="n">id</span><span class="p">,</span>
        <span class="nd">@PathVariable</span> <span class="n">Integer</span> <span class="n">version</span><span class="p">,</span>
        <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something</span>
    <span class="k">return</span> <span class="s">&quot;sample/hello&quot;</span><span class="p">;</span> <span class="c1">// returns view name</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p class="last">なお、リクエストパスの拡張子によるパターンマッチングはブラウザから送信されるAcceptヘッダーを一貫して解釈することが困難だった古い時代の手法であり、
拡張子ではなくAcceptヘッダーやURLのクエリパラメータでマッピングを切り分けることが、Springでは推奨されている。
詳細は <a class="reference external" href="https://docs.spring.io/spring/docs/5.3.0-M2/spring-framework-reference/web.html#mvc-ann-requestmapping-suffix-pattern-match">Spring Framework Documentation -Suffix Match-</a>を参照されたい。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-method-argument-requestparam-label">
<span id="id20"></span><h4><a class="toc-backref" href="#id106">3.4.1.4.3. リクエストパラメータを個別に取得する</a><a class="headerlink" href="#controller-method-argument-requestparam-label" title="Permalink to this headline">¶</a></h4>
<p>リクエストパラメータを1つずつ取得したい場合は、引数に<code class="docutils literal"><span class="pre">&#64;RequestParam</span></code>アノテーションを付与する。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;bindRequestParams&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">bindRequestParams</span><span class="p">(</span>
<span class="hll">        <span class="nd">@RequestParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">String</span> <span class="n">id</span><span class="p">,</span> <span class="c1">// (1)</span>
</span><span class="hll">        <span class="nd">@RequestParam</span> <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="c1">// (2)</span>
</span><span class="hll">        <span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;age&quot;</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span> <span class="n">Integer</span> <span class="n">age</span><span class="p">,</span> <span class="c1">// (3)</span>
</span><span class="hll">        <span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;genderCode&quot;</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">&quot;unknown&quot;</span><span class="p">)</span> <span class="n">String</span> <span class="n">genderCode</span><span class="p">,</span> <span class="c1">// (4)</span>
</span>        <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something</span>
    <span class="k">return</span> <span class="s">&quot;sample/hello&quot;</span><span class="p">;</span> <span class="c1">// returns view name</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">&#64;RequestParam</span></code>アノテーションのvalue属性には、リクエストパラメータ名を指定する。</div>
<div class="line">上記例では、 <code class="docutils literal"><span class="pre">sample/hello?id=aaaa</span></code> というURLにアクセスした場合、引数idに文字列 <code class="docutils literal"><span class="pre">aaaa</span></code> が渡る。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line"><code class="docutils literal"><span class="pre">&#64;RequestParam</span></code>アノテーションのvalue属性は省略可能で、省略した場合は引数名がリクエストパラメータ名となる。</div>
<div class="line">上記例では、 <code class="docutils literal"><span class="pre">sample/hello?name=bbbb&amp;....</span></code> というURLにアクセスした場合、引数nameに文字列 <code class="docutils literal"><span class="pre">bbbb</span></code> が渡る。</div>
<div class="line">ただしこの方法は、</div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">-g</span></code>オプション(デバッグ情報を出力するモード)</li>
<li>Java8から追加された<code class="docutils literal"><span class="pre">-parameters</span></code>オプション(メソッド・パラメータにリフレクション用のメタデータを生成するモード)</li>
</ul>
<p class="last">のどちらかを指定してコンパイルする必要がある。</p>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">デフォルトの動作では、指定したリクエストパラメータが存在しないとエラーとなる。リクエストパラメータが存在しないケースを許容する場合は、required属性を <code class="docutils literal"><span class="pre">false</span></code> に指定する。</div>
<div class="line">上記例では、<code class="docutils literal"><span class="pre">age</span></code> というリクエストパラメータがない状態でアクセスした場合、引数ageに<code class="docutils literal"><span class="pre">null</span></code>が渡る。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">指定したリクエストパラメータが存在しない場合にデフォルト値を使用したい場合は、defaultValue属性にデフォルト値を指定する。</div>
<div class="line">上記例では、<code class="docutils literal"><span class="pre">genderCode</span></code> というリクエストパラメータがない状態でアクセスした場合、引数genderCodeに <code class="docutils literal"><span class="pre">unknown</span></code> が渡る。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">必須パラメータを指定しないでアクセスした場合は、<code class="docutils literal"><span class="pre">org.springframework.web.bind.MissingServletRequestParameterException</span></code>がスローされ、デフォルトの動作は400(Bad Request)が応答される。
ただし、defaultValue属性を指定している場合、例外はスローされず、defaultValue属性で指定した値が渡る。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">バインドする引数の型はString以外でも良い。型が合わない場合は<code class="docutils literal"><span class="pre">org.springframework.beans.TypeMismatchException</span></code>がスローされ、デフォルトの動作は400(Bad Request)が応答される。
例えば、上記例で <code class="docutils literal"><span class="pre">sample/hello?age=aaaa&amp;...</span></code> というURLでアクセスした場合、 <code class="docutils literal"><span class="pre">aaaa</span></code> をIntegerに変換できないため、例外がスローされる。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>以下の条件に当てはまる場合は、次に説明するフォームオブジェクトにバインドすること。</strong></p>
<ul class="simple">
<li>リクエストパラメータがHTML form内の項目である。</li>
<li>リクエストパラメータはHTML form内の項目ではないが、リクエストパラメータに必須チェック以外の入力チェックを行う必要がある。</li>
<li>リクエストパラメータの入力チェックエラーのエラー詳細をパラメータ毎に出力する必要がある。</li>
<li>3つ以上のリクエストパラメータをバインドする。(保守性、可読性の観点)</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-method-argument-form-label">
<span id="id21"></span><h4><a class="toc-backref" href="#id107">3.4.1.4.4. リクエストパラメータをまとめて取得する</a><a class="headerlink" href="#controller-method-argument-form-label" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">リクエストパラメータをオブジェクトにまとめて取得する場合は、フォームオブジェクトを使用する。</div>
<div class="line">フォームオブジェクトは、HTML formを表現するJavaBeanである。フォームオブジェクトの詳細は <a class="reference internal" href="#formobject"><span class="std std-ref">フォームオブジェクトの実装</span></a> を参照されたい。</div>
</div>
<p>以下は、<code class="docutils literal"><span class="pre">&#64;RequestParam</span></code> で個別にリクエストパラメータを受け取っていたハンドラメソッドを、フォームオブジェクトで受け取るように変更した場合の実装例である。</p>
<p><code class="docutils literal"><span class="pre">&#64;RequestParam</span></code> を使って個別にリクエストパラメータを受け取っているハンドラメソッドは以下の通り。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;bindRequestParams&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">bindRequestParams</span><span class="p">(</span>
        <span class="nd">@RequestParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">String</span> <span class="n">id</span><span class="p">,</span>
        <span class="nd">@RequestParam</span> <span class="n">String</span> <span class="n">name</span><span class="p">,</span>
        <span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;age&quot;</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span> <span class="n">Integer</span> <span class="n">age</span><span class="p">,</span>
        <span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;genderCode&quot;</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">&quot;unknown&quot;</span><span class="p">)</span> <span class="n">String</span> <span class="n">genderCode</span><span class="p">,</span>
        <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something</span>
    <span class="k">return</span> <span class="s">&quot;sample/hello&quot;</span><span class="p">;</span> <span class="c1">// returns view name</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">フォームオブジェクトクラスを作成する。</div>
<div class="line">このフォームオブジェクトに対応するHTML formのjspは <a class="reference internal" href="#formobjectjsp"><span class="std std-ref">HTML formへのバインディング方法</span></a> を参照されたい。</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleForm</span> <span class="kd">implements</span> <span class="n">Serializable</span><span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1477614498217715937L</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">id</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">age</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">genderCode</span><span class="p">;</span>

    <span class="c1">// omit setters and getters</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>リクエストパラメータ名とフォームオブジェクトのプロパティ名は一致させる必要がある。</strong></p>
<p class="last">上記のフォームオブジェクトに対して <code class="docutils literal"><span class="pre">id=aaa&amp;name=bbbb&amp;age=19&amp;genderCode=men?tel=01234567</span></code> というパラメータが送信された場合、
<code class="docutils literal"><span class="pre">id</span></code> , <code class="docutils literal"><span class="pre">name</span></code> , <code class="docutils literal"><span class="pre">age</span></code> , <code class="docutils literal"><span class="pre">genderCode</span></code> は名前が一致するプロパティに値が格納されるが、 <code class="docutils literal"><span class="pre">tel</span></code> は名前が一致するプロパティがないため、フォームオブジェクトに取り込まれない。</p>
</div>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">&#64;RequestParam</span></code> を使って個別に受け取っていたリクエストパラメータをフォームオブジェクトとして受け取るようにする。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;bindRequestParams&quot;</span><span class="p">)</span>
<span class="hll"><span class="kd">public</span> <span class="n">String</span> <span class="nf">bindRequestParams</span><span class="p">(</span><span class="nd">@Validated</span> <span class="n">SampleForm</span> <span class="n">form</span><span class="p">,</span> <span class="c1">// (1)</span>
</span>        <span class="n">BindingResult</span> <span class="n">result</span><span class="p">,</span>
        <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something</span>
    <span class="k">return</span> <span class="s">&quot;sample/hello&quot;</span><span class="p">;</span> <span class="c1">// returns view name</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">SampleForm</span></code>オブジェクトを引数として受け取る。</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">フォームオブジェクトを引数に用いた場合、<code class="docutils literal"><span class="pre">&#64;RequestParam</span></code>の場合とは異なり、
必須チェックは行われない。<strong>フォームオブジェクトを使用する場合は、次に説明する</strong> <a class="reference internal" href="#controller-method-argument-validation-label"><span class="std std-ref">入力チェックを行う</span></a> <strong>を行うこと</strong>。</p>
</div>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">EntityなどDomainオブジェクトをそのままフォームオブジェクトとして使うこともできるが、
実際には、WEBの画面上にしか存在しないパラメータ（確認用パスワードや、規約確認チェックボックス等）が存在する。
Domainオブジェクトにそのような画面項目に依存する項目を入れるべきではないので、Domainオブジェクトとは別にフォームオブジェクト用のクラスを作成することを推奨する。
リクエストパラメータからDomainオブジェクトを作成する場合は、一旦フォームオブジェクトにバインドしてからプロパティ値をDomainオブジェクトにコピーすること。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-method-argument-validation-label">
<span id="id22"></span><h4><a class="toc-backref" href="#id108">3.4.1.4.5. 入力チェックを行う</a><a class="headerlink" href="#controller-method-argument-validation-label" title="Permalink to this headline">¶</a></h4>
<p>リクエストパラメータがバインドされているフォームオブジェクトに対して入力チェックを行う場合は、
フォームオブジェクト引数に<code class="docutils literal"><span class="pre">&#64;Validated</span></code>アノテーションを付け、
フォームオブジェクト引数の直後に<code class="docutils literal"><span class="pre">org.springframework.validation.BindingResult</span></code>(以降<code class="docutils literal"><span class="pre">BindingResult</span></code>と呼ぶ) を引数に指定する。</p>
<p>入力チェックの詳細については、 <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Validation.html"><span class="doc">入力チェック</span></a> を参照されたい。</p>
<p>フォームオブジェクトクラスのフィールドに入力チェックで必要となるアノテーションを付加する。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleForm</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1477614498217715937L</span><span class="p">;</span>

    <span class="nd">@NotNull</span>
    <span class="nd">@Size</span><span class="p">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">id</span><span class="p">;</span>

    <span class="nd">@NotNull</span>
    <span class="nd">@Size</span><span class="p">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>

    <span class="nd">@Min</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nd">@Max</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">age</span><span class="p">;</span>

    <span class="nd">@Size</span><span class="p">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">genderCode</span><span class="p">;</span>

    <span class="c1">// omit setters and getters</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">フォームオブジェクト引数に<code class="docutils literal"><span class="pre">&#64;Validated</span></code>アノテーションを付与する。</div>
<div class="line"><code class="docutils literal"><span class="pre">&#64;Validated</span></code>アノテーションを付けた引数は、ハンドラメソッド実行前に入力チェックが行われ、チェック結果が直後の<code class="docutils literal"><span class="pre">BindingResult</span></code>引数に格納される。</div>
<div class="line">フォームオブジェクトにString型以外を指定した場合に発生する型変換エラーも <code class="docutils literal"><span class="pre">BindingResult</span></code>に格納されている。</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;bindRequestParams&quot;</span><span class="p">)</span>
<span class="hll"><span class="kd">public</span> <span class="n">String</span> <span class="nf">bindRequestParams</span><span class="p">(</span><span class="nd">@Validated</span> <span class="n">SampleForm</span> <span class="n">form</span><span class="p">,</span> <span class="c1">// (1)</span>
</span><span class="hll">        <span class="n">BindingResult</span> <span class="n">result</span><span class="p">,</span> <span class="c1">// (2)</span>
</span>        <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">    <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span> <span class="c1">// (3)</span>
</span>        <span class="k">return</span> <span class="s">&quot;sample/input&quot;</span><span class="p">;</span> <span class="c1">// back to the input view</span>
    <span class="p">}</span>
    <span class="c1">// do something</span>
    <span class="k">return</span> <span class="s">&quot;sample/hello&quot;</span><span class="p">;</span> <span class="c1">// returns view name</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">SampleForm</span></code>オブジェクトに<code class="docutils literal"><span class="pre">&#64;Validated</span></code>アノテーションを付与し、入力チェック対象のオブジェクトにする。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>入力チェック結果が格納される<code class="docutils literal"><span class="pre">BindingResult</span></code>を引数に指定する。</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>入力チェックエラーが存在するか判定する。エラーがある場合は、<code class="docutils literal"><span class="pre">true</span></code> が返却される。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-method-argument-redirectattributes-label">
<span id="id23"></span><h4><a class="toc-backref" href="#id109">3.4.1.4.6. リダイレクト先にデータを渡す</a><a class="headerlink" href="#controller-method-argument-redirectattributes-label" title="Permalink to this headline">¶</a></h4>
<p>ハンドラメソッドを実行した後にリダイレクトする場合に、リダイレクト先で表示するデータを渡したい場合は、<code class="docutils literal"><span class="pre">org.springframework.web.servlet.mvc.support.RedirectAttributes</span></code>(以降<code class="docutils literal"><span class="pre">RedirectAttributes</span></code>と呼ぶ) をハンドラメソッドの引数として受け取り、
<code class="docutils literal"><span class="pre">RedirectAttributes</span></code>オブジェクトに渡したいデータを追加する。</p>
<ul class="simple">
<li>SampleController.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="hll"><span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">(</span><span class="n">RedirectAttributes</span> <span class="n">redirectAttrs</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// (1)</span>
</span><span class="hll">    <span class="n">redirectAttrs</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">,</span> <span class="s">&quot;Hello World!&quot;</span><span class="p">);</span> <span class="c1">// (2)</span>
</span><span class="hll">    <span class="n">redirectAttrs</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="k">new</span> <span class="n">HelloBean</span><span class="p">(</span><span class="s">&quot;Bean Hello World!&quot;</span><span class="p">));</span> <span class="c1">// (3)</span>
</span><span class="hll">    <span class="k">return</span> <span class="s">&quot;redirect:/sample/hello?complete&quot;</span><span class="p">;</span> <span class="c1">// (4)</span>
</span><span class="p">}</span>

<span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;hello&quot;</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;complete&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">helloComplete</span><span class="p">()</span> <span class="p">{</span>
<span class="hll">    <span class="k">return</span> <span class="s">&quot;sample/complete&quot;</span><span class="p">;</span> <span class="c1">// (5)</span>
</span><span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>complete.jsp</li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="hll">Message : ${f:h(hello)}<span class="nt">&lt;br&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span><span class="hll">Message : ${f:h(helloBean.message)}<span class="nt">&lt;br&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span></pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>HTML of created by View(complete.jsp)</li>
</ul>
<blockquote>
<div><div class="highlight-html"><div class="highlight"><pre><span></span><span class="hll">Message : Hello World!<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span> <span class="c">&lt;!-- (8) --&gt;</span>
</span><span class="hll">Message : Bean Hello World!<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>　<span class="c">&lt;!-- (8) --&gt;</span>
</span></pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">RedirectAttributes</span></code>オブジェクトを引数として受け取る。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">RedirectAttributes</span></code>オブジェクトの<code class="docutils literal"><span class="pre">addFlashAttribute</span></code>メソッドを呼び出し、渡したいデータを<code class="docutils literal"><span class="pre">RedirectAttributes</span></code>オブジェクトに追加する。</div>
<div class="line">例では、 <code class="docutils literal"><span class="pre">hello</span></code> という属性名で <code class="docutils literal"><span class="pre">HelloWorld!</span></code> という文字列のデータを追加している。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">addFlashAttribute</span></code>メソッドの第一引数を省略すると<a class="reference external" href="https://spring.pleiades.io/spring-framework/docs/current/javadoc-api/org/springframework/core/Conventions.html#getVariableName-java.lang.Object-">Conventions#getVariableName</a>の仕様に基づき、値のクラス名から属性名を決定する。</div>
<div class="line">例では、 <code class="docutils literal"><span class="pre">model.addFlashAttribute(&quot;helloBean&quot;,</span> <span class="pre">new</span> <span class="pre">HelloBean());</span></code> を行ったのと同じ結果となる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">画面(View)を直接表示せず、次の画面を表示するためのリクエストにリダイレクトする。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">リダイレクト後のハンドラメソッドでは、(2)(3)で追加したデータを表示する画面のView名を返却する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">View(JSP)側では、「${属性名}」と記述することで<code class="docutils literal"><span class="pre">RedirectAttributes</span></code>を通じてflash scopeに追加したデータを取得することができる。</div>
<div class="line">例ではHTMLエスケープを行うEL式の関数を呼び出しているため、「${f:h(属性名)}」としている。</div>
<div class="line">HTMLエスケープを行うEL式の関数の詳細については、 <a class="reference internal" href="../Security/XSS.html"><span class="doc">Cross Site Scripting</span></a> を参照されたい。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">「${属性名.JavaBeanのプロパティ名}」と記述することで<code class="docutils literal"><span class="pre">RedirectAttributes</span></code>に格納されているJavaBeanから値を取得することができる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">HTMLの出力例。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><code class="docutils literal"><span class="pre">Model</span></code> に追加してもリダイレクト先にデータを渡すことはできない。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">Model</span></code>の<code class="docutils literal"><span class="pre">addAttribute</span></code>メソッドに非常によく似ているが、データの生存期間が異なる。
<code class="docutils literal"><span class="pre">RedirectAttributes</span></code>の<code class="docutils literal"><span class="pre">addFlashAttribute</span></code>ではflash scopeというスコープにデータが格納され、
リダイレクト後の1リクエスト(PRGパターンのG)でのみ追加したデータを参照することができる。2回目以降のリクエストの時にはデータは消えている。</p>
</div>
<div class="figure align-center" id="id82">
<a class="reference internal image-reference" href="../_images/applicationFlashscope.png"><img alt="Survival time of flush scope" src="../_images/applicationFlashscope.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - Survival time of flush scope</strong></span></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-method-argument-redirectattributes-param-label">
<span id="id25"></span><h4><a class="toc-backref" href="#id110">3.4.1.4.7. リダイレクト先へリクエストパラメータを渡す</a><a class="headerlink" href="#controller-method-argument-redirectattributes-param-label" title="Permalink to this headline">¶</a></h4>
<p>リダイレクト先へ動的にリクエストパラメータを設定したい場合は、引数の<code class="docutils literal"><span class="pre">RedirectAttributes</span></code>オブジェクトに渡したい値を追加する。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">(</span><span class="n">RedirectAttributes</span> <span class="n">redirectAttrs</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">id</span> <span class="o">=</span> <span class="s">&quot;aaaa&quot;</span><span class="p">;</span>
<span class="hll">    <span class="n">redirectAttrs</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span> <span class="c1">// (1)</span>
</span>    <span class="c1">// must not return &quot;redirect:/sample/hello?complete&amp;id=&quot; + id;</span>
    <span class="k">return</span> <span class="s">&quot;redirect:/sample/hello?complete&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">属性名にリクエストパラメータ名、属性値にリクエストパラメータの値を指定して、<code class="docutils literal"><span class="pre">RedirectAttributes</span></code>オブジェクトの<code class="docutils literal"><span class="pre">addAttribute</span></code>メソッドを呼び出す。</div>
<div class="line">上記例では、 <code class="docutils literal"><span class="pre">/sample/hello?complete&amp;id=aaaa</span></code> にリダイレクトされる。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">上記例ではコメント化しているが、<code class="docutils literal"><span class="pre">return</span> <span class="pre">&quot;redirect:/sample/hello?complete&amp;id=&quot;</span> <span class="pre">+</span> <span class="pre">id;</span></code>と結果は同じになる。
ただし、 <code class="docutils literal"><span class="pre">RedirectAttributes</span></code>オブジェクトの<code class="docutils literal"><span class="pre">addAttribute</span></code>メソッドを用いるとURIエンコーディングも行われるので、
動的に埋め込むリクエストパラメータについては、<strong>返り値のリダイレクトURLとして組み立てるのではなく、必ずaddAttributeメソッドを使用してリクエストパラメータに設定すること。</strong>
動的に埋め込まないリクエストパラメータ(上記例だと”complete”)については、返り値のリダイレクトURLに直接指定してよい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-method-argument-redirectattributes-path-label">
<span id="id26"></span><h4><a class="toc-backref" href="#id111">3.4.1.4.8. リダイレクト先URLのパスに値を埋め込む</a><a class="headerlink" href="#controller-method-argument-redirectattributes-path-label" title="Permalink to this headline">¶</a></h4>
<p>リダイレクト先URLのパスに動的に値を埋め込みたい場合は、リクエストパラメータの設定と同様引数の<code class="docutils literal"><span class="pre">RedirectAttributes</span></code>オブジェクトに埋め込みたい値を追加する。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">(</span><span class="n">RedirectAttributes</span> <span class="n">redirectAttrs</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">id</span> <span class="o">=</span> <span class="s">&quot;aaaa&quot;</span><span class="p">;</span>
<span class="hll">    <span class="n">redirectAttrs</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span> <span class="c1">// (1)</span>
</span>    <span class="c1">// must not return &quot;redirect:/sample/hello/&quot; + id + &quot;?complete&quot;;</span>
<span class="hll">    <span class="k">return</span> <span class="s">&quot;redirect:/sample/hello/{id}?complete&quot;</span><span class="p">;</span> <span class="c1">// (2)</span>
</span><span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">属性名とパスに埋め込みたい値を指定して、<code class="docutils literal"><span class="pre">RedirectAttributes</span></code>オブジェクトの<code class="docutils literal"><span class="pre">addAttribute</span></code>メソッドを呼び出す。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">リダイレクトURLの埋め込みたい箇所に「{属性名}」のパス変数を指定する。</div>
<div class="line">上記例では、 <code class="docutils literal"><span class="pre">/sample/hello/aaaa?complete</span></code> にリダイレクトされる。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">上記例ではコメント化しているが、<code class="docutils literal"><span class="pre">&quot;redirect:/sample/hello/&quot;</span> <span class="pre">+</span> <span class="pre">id</span> <span class="pre">+</span> <span class="pre">&quot;?complete&quot;;</span></code>と結果は同じになる。
ただし、 <code class="docutils literal"><span class="pre">RedirectAttributes</span></code>オブジェクトの<code class="docutils literal"><span class="pre">addAttribute</span></code>メソッドを用いるとURLエンコーディングも行われるので、
動的に埋め込むパス値については、<strong>返り値のリダイレクトURLとして記述せずに、必ずaddAttributeメソッドを使用し、パス変数を使って埋め込むこと。</strong></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="cookie">
<span id="controller-method-argument-cookievalue-label"></span><h4><a class="toc-backref" href="#id112">3.4.1.4.9. Cookieから値を取得する</a><a class="headerlink" href="#cookie" title="Permalink to this headline">¶</a></h4>
<p>Cookieから取得したい場合は、引数に<code class="docutils literal"><span class="pre">&#64;CookieValue</span></code>アノテーションを付与する。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;readCookie&quot;</span><span class="p">)</span>
<span class="hll"><span class="kd">public</span> <span class="n">String</span> <span class="nf">readCookie</span><span class="p">(</span><span class="nd">@CookieValue</span><span class="p">(</span><span class="s">&quot;JSESSIONID&quot;</span><span class="p">)</span> <span class="n">String</span> <span class="n">sessionId</span><span class="p">,</span> <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// (1)</span>
</span>    <span class="c1">// do something</span>
    <span class="k">return</span> <span class="s">&quot;sample/readCookie&quot;</span><span class="p">;</span> <span class="c1">// returns view name</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">&#64;CookieValue</span></code>アノテーションのvalue属性には、Cookie名を指定する。</div>
<div class="line">上記例では、Cookieから”JSESSIONID”というCookie名の値が引数sessionIdに渡る。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">&#64;RequestParam</span></code>同様、required属性、defaultValue属性があり、引数の型にはString型以外の指定も可能である。
詳細は、 <a class="reference internal" href="#controller-method-argument-requestparam-label"><span class="std std-ref">リクエストパラメータを個別に取得する</span></a> を参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-method-argument-cookiewrite-label">
<span id="id27"></span><h4><a class="toc-backref" href="#id113">3.4.1.4.10. Cookieに値を書き込む</a><a class="headerlink" href="#controller-method-argument-cookiewrite-label" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Cookieに値を書き込む場合は、<code class="docutils literal"><span class="pre">HttpServletResponse</span></code>オブジェクトの<code class="docutils literal"><span class="pre">addCookie</span></code>メソッドを直接呼び出してCookieに追加する。</div>
<div class="line">Spring MVCからCookieに値を書き込む仕組みが提供されていないため(3.2.3時点)、<strong>この場合に限り HttpServletResponse を引数に取っても良い。</strong></div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;writeCookie&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">writeCookie</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="p">,</span>
<span class="hll">        <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// (1)</span>
</span>    <span class="n">Cookie</span> <span class="n">cookie</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cookie</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;HelloWorld!&quot;</span><span class="p">);</span>
<span class="hll">    <span class="n">response</span><span class="p">.</span><span class="na">addCookie</span><span class="p">(</span><span class="n">cookie</span><span class="p">);</span> <span class="c1">// (2)</span>
</span>    <span class="c1">// do something</span>
    <span class="k">return</span> <span class="s">&quot;sample/writeCookie&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Cookieを書き込むために、<code class="docutils literal"><span class="pre">HttpServletResponse</span></code>オブジェクトを引数に指定する。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Cookie</span></code>オブジェクトを生成し、<code class="docutils literal"><span class="pre">HttpServletResponse</span></code>オブジェクトに追加する。</div>
<div class="line">上記例では、 <code class="docutils literal"><span class="pre">foo</span></code> というCookie名で <code class="docutils literal"><span class="pre">HelloWorld!</span></code> という値を設定している。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last"><code class="docutils literal"><span class="pre">HttpServletResponse</span></code>を引数として受け取ることに変わりはないが、Cookieに値を書き込むためのクラスとして、
Spring Frameworkから<code class="docutils literal"><span class="pre">org.springframework.web.util.CookieGenerator</span></code>というクラスが提供されている。必要に応じて使用すること。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>HTTP Cookieの処理を規定するRFC 6265では、Cookieの名前や値に一部使用できない文字があることに注意されたい。
例えば、RFC 6265に準拠した実装のTomcat 8.5では、Cookieの値にスペースを使用することができない。</p>
<p class="last"><a class="reference external" href="https://tools.ietf.org/html/rfc6265#section-4.1">RFC 6265(HTTP State Management Mechanism)の4.1 SetCookie</a> のSyntaxを参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-method-argument-pagination-label">
<span id="id28"></span><h4><a class="toc-backref" href="#id114">3.4.1.4.11. ページネーション情報を取得する</a><a class="headerlink" href="#controller-method-argument-pagination-label" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">一覧検索を行うリクエストでは、ページネーション情報が必要となる。</div>
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.data.domain.Pageable</span></code>(以降<code class="docutils literal"><span class="pre">Pageable</span></code>と呼ぶ) オブジェクトをハンドラメソッドの引数に取ることで、ページネーション情報(ページ数、取得件数)を容易に扱うことができる。</div>
</div>
<blockquote>
<div>詳細については <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Pagination.html"><span class="doc">ページネーション</span></a> を参照すること。</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-method-argument-upload-label">
<span id="id29"></span><h4><a class="toc-backref" href="#id115">3.4.1.4.12. アップロードファイルを取得する</a><a class="headerlink" href="#controller-method-argument-upload-label" title="Permalink to this headline">¶</a></h4>
<p>アップロードされたファイルを取得する方法は大きく２つある。</p>
<ul class="simple">
<li>フォームオブジェクトに<code class="docutils literal"><span class="pre">MultipartFile</span></code>のプロパティを用意する。</li>
<li><code class="docutils literal"><span class="pre">&#64;RequestParam</span></code>アノテーションを付与して<code class="docutils literal"><span class="pre">org.springframework.web.multipart.MultipartFile</span></code>をハンドラメソッドの引数とする。</li>
</ul>
<p>詳細については <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/FileUpload.html"><span class="doc">ファイルアップロード</span></a> を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-method-argument-message-label">
<span id="id30"></span><h4><a class="toc-backref" href="#id116">3.4.1.4.13. 画面に結果メッセージを表示する</a><a class="headerlink" href="#controller-method-argument-message-label" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">Model</span></code>オブジェクト又は<code class="docutils literal"><span class="pre">RedirectAttributes</span></code>オブジェクトをハンドラメソッドの引数として受け取り、
<code class="docutils literal"><span class="pre">ResultMessages</span></code>オブジェクトを追加することで処理の結果メッセージを表示できる。</p>
<p>詳細については <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/MessageManagement.html"><span class="doc">メッセージ管理</span></a> を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="controller-method-return-label">
<span id="id31"></span><h3><a class="toc-backref" href="#id117">3.4.1.5. ハンドラメソッドの返り値について</a><a class="headerlink" href="#controller-method-return-label" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://docs.spring.io/spring-framework/docs/5.3.18/reference/html/web.html#mvc-ann-return-types">ハンドラメソッドの返り値についても様々な値をとることができる</a> が、
基本的には次に挙げるもののみを使用すること。</p>
<ul class="simple">
<li>String(View名)</li>
</ul>
<p>以下に、目的別に返り値の使用方法について説明する。</p>
<ul class="simple">
<li><a class="reference internal" href="#controller-method-return-html-label"><span class="std std-ref">HTMLを応答する</span></a></li>
<li><a class="reference internal" href="#controller-method-return-download-label"><span class="std std-ref">ダウンロードデータを応答する</span></a></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="html">
<span id="controller-method-return-html-label"></span><h4><a class="toc-backref" href="#id118">3.4.1.5.1. HTMLを応答する</a><a class="headerlink" href="#html" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">ハンドラメソッドの実行結果をHTMLとして応答する場合、ハンドラメソッドの返り値は、JSPのView名を返却する。</div>
<div class="line">JSPを使ってHTMLを生成する場合の<code class="docutils literal"><span class="pre">ViewResolver</span></code>は、基本的には<code class="docutils literal"><span class="pre">UrlBasedViewResolver</span></code>の継承クラス(<code class="docutils literal"><span class="pre">InternalResourceViewResolver</span></code>や <code class="docutils literal"><span class="pre">TilesViewResolver</span></code>等)となる。</div>
</div>
<div class="line-block">
<div class="line">以下では、JSP用の<code class="docutils literal"><span class="pre">InternalResourceViewResolver</span></code>を使用する場合の例を記載するが、画面レイアウトがテンプレート化されている場合は<code class="docutils literal"><span class="pre">TilesViewResolver</span></code>を使用することを推奨する。</div>
<div class="line"><code class="docutils literal"><span class="pre">TilesViewResolver</span></code>の使用方法については、 <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/TilesLayout.html"><span class="doc">Tilesによる画面レイアウト</span></a> を参照されたい。</div>
</div>
<ul class="simple">
<li>spring-mvc.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;mvc:view-resolvers&gt;</span>
    <span class="nt">&lt;mvc:jsp</span> <span class="na">prefix=</span><span class="s">&quot;/WEB-INF/views/&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;/mvc:view-resolvers&gt;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>SampleController.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// omitted</span>
<span class="hll">    <span class="k">return</span> <span class="s">&quot;sample/hello&quot;</span><span class="p">;</span> <span class="c1">// (2)</span>
</span><span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p class="first"><code class="docutils literal"><span class="pre">&lt;mvc:jsp&gt;</span></code>要素を使用して、JSP用の<code class="docutils literal"><span class="pre">InternalResourceViewResolver</span></code>を定義する。</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">prefix</span></code>属性には、JSPファイルが格納されているベースディレクトリ(ファイルパスのプレフィックス)を指定する。</li>
<li><code class="docutils literal"><span class="pre">suffix</span></code>属性には、デフォルト値として<code class="docutils literal"><span class="pre">.jsp</span></code>が適用されているため、明示的に指定する必要はない。</li>
</ul>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">&lt;mvc:view-resolvers&gt;</span></code>要素を使用すると、<code class="docutils literal"><span class="pre">ViewResolver</span></code>をシンプルに定義することが出来るため、
本ガイドラインでは<code class="docutils literal"><span class="pre">&lt;mvc:view-resolvers&gt;</span></code>を使用することを推奨する。</p>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>ハンドラメソッドの返り値として <code class="docutils literal"><span class="pre">sample/hello</span></code> というView名を返却した場合、 <code class="docutils literal"><span class="pre">/WEB-INF/views/sample/hello.jsp</span></code> が呼び出されてHTMLが応答される。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">上記の例ではJSPを使ってHTMLを生成しているが、FreeMarkerなど他のテンプレートエンジンを使用してHTMLを生成する場合でも、ハンドラメソッドの返り値は <code class="docutils literal"><span class="pre">sample/hello</span></code> のままでよい。
使用するテンプレートエンジンでの差分は <code class="docutils literal"><span class="pre">ViewResolver</span></code> によって解決される。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>単純にview 名を返すだけのメソッドを実装する場合は、<code class="docutils literal"><span class="pre">&lt;mvc:view-controller&gt;</span></code> を使用してControllerクラスの実装を代用することも可能である。</p>
<ul class="last">
<li><p class="first"><code class="docutils literal"><span class="pre">&lt;mvc:view-controller&gt;</span></code>を使用したControllerの定義例。</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;mvc:view-controller</span> <span class="na">path=</span><span class="s">&quot;/hello&quot;</span> <span class="na">view-name=</span><span class="s">&quot;sample/hello&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>&lt;mvc:view-controller&gt;使用に関する留意点</strong></p>
<p class="last">Spring Framework 4.3以降では、<code class="docutils literal"><span class="pre">&lt;mvc:view-controller&gt;</span></code>が許可するHTTPメソッドはGETとHEADのみに限定される様になったため(<a class="reference external" href="https://jira.spring.io/browse/SPR-13130">SPR-13130</a>)、
HTTPメソッドがGETとHEAD以外(POSTなど)でアクセスするページの場合、<code class="docutils literal"><span class="pre">&lt;mvc:view-controller&gt;</span></code>は使用できない。
GETとHEAD以外(POSTなど)からフォワードされた場合も同様となるため、エラーページへの遷移などフォワード元のHTTPメソッドが限定できない場合には<code class="docutils literal"><span class="pre">&lt;mvc:view-controller&gt;</span></code>を使用しないよう注意されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-method-return-download-label">
<span id="id33"></span><h4><a class="toc-backref" href="#id119">3.4.1.5.2. ダウンロードデータを応答する</a><a class="headerlink" href="#controller-method-return-download-label" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">データベースなどに格納されているデータをダウンロードデータ(<code class="docutils literal"><span class="pre">application/octet-stream</span></code>等 )として応答する場合、</div>
<div class="line">レスポンスデータの生成(ダウンロード処理)を行うViewを作成し、処理を委譲することを推奨する。</div>
<div class="line">ハンドラメソッドでは、ダウンロード対象となるデータを <code class="docutils literal"><span class="pre">Model</span></code>に追加し、ダウンロード処理を行うViewのView名を返却する。</div>
</div>
<div class="line-block">
<div class="line">View名からViewを解決する方法としては、個別のViewResolverを作成する方法もあるが、ここではSpring Frameworkから提供されている<code class="docutils literal"><span class="pre">BeanNameViewResolver</span></code>を使用する。</div>
<div class="line">ダウンロード処理の詳細については、 <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/FileDownload.html"><span class="doc">ファイルダウンロード</span></a> を参照されたい。</div>
</div>
<ul class="simple">
<li>spring-mvc.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;mvc:view-resolvers&gt;</span>
<span class="hll">    <span class="nt">&lt;mvc:bean-name</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</span>    <span class="nt">&lt;mvc:jsp</span> <span class="na">prefix=</span><span class="s">&quot;/WEB-INF/views/&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/mvc:view-resolvers&gt;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>SampleController.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;report&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">report</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// omitted</span>
<span class="hll">    <span class="k">return</span> <span class="s">&quot;sample/report&quot;</span><span class="p">;</span> <span class="c1">// (2)</span>
</span><span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>XxxExcelView.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="hll"><span class="nd">@Component</span><span class="p">(</span><span class="s">&quot;sample/report&quot;</span><span class="p">)</span> <span class="c1">// (3)</span>
</span><span class="hll"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">XxxExcelView</span> <span class="kd">extends</span> <span class="n">AbstractXlsxView</span> <span class="p">{</span> <span class="c1">// (4)</span>
</span>    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">buildExcelDocument</span><span class="p">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">model</span><span class="p">,</span>
            <span class="n">Workbook</span> <span class="n">workbook</span><span class="p">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="p">,</span>
            <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="n">Sheet</span> <span class="n">sheet</span><span class="p">;</span>
        <span class="n">Cell</span> <span class="n">cell</span><span class="p">;</span>

        <span class="n">sheet</span> <span class="o">=</span> <span class="n">workbook</span><span class="p">.</span><span class="na">createSheet</span><span class="p">(</span><span class="s">&quot;Spring&quot;</span><span class="p">);</span>
        <span class="n">sheet</span><span class="p">.</span><span class="na">setDefaultColumnWidth</span><span class="p">(</span><span class="mi">12</span><span class="p">);</span>

        <span class="c1">// write a text at A1</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">getCell</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">setText</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s">&quot;Spring-Excel test&quot;</span><span class="p">);</span>

        <span class="n">cell</span> <span class="o">=</span> <span class="n">getCell</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">setText</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="p">((</span><span class="n">Date</span><span class="p">)</span> <span class="n">model</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;serverTime&quot;</span><span class="p">)).</span><span class="na">toString</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p class="first"><code class="docutils literal"><span class="pre">&lt;mvc:bean-name&gt;</span></code>要素を使用して、<code class="docutils literal"><span class="pre">BeanNameViewResolver</span></code>を定義する。</p>
<p><code class="docutils literal"><span class="pre">&lt;mvc:view-resolvers&gt;</span></code>要素を使用して<code class="docutils literal"><span class="pre">ViewResolver</span></code>を定義する場合は、子要素に指定する<code class="docutils literal"><span class="pre">ViewResolver</span></code>の定義順が優先順位となる。
上記例では、JSP用の<code class="docutils literal"><span class="pre">InternalResourceViewResolver</span></code>を定義するための要素(<code class="docutils literal"><span class="pre">&lt;mvc:jsp&gt;</span></code>)より上に定義することで、JSP用の<code class="docutils literal"><span class="pre">InternalResourceViewResolver</span></code>より先に<code class="docutils literal"><span class="pre">BeanNameViewResolver</span></code>によるView解決が行われる。</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">&lt;mvc:view-resolvers&gt;</span></code>要素を使用すると、<code class="docutils literal"><span class="pre">ViewResolver</span></code>をシンプルに定義することが出来るため、
本ガイドラインでは<code class="docutils literal"><span class="pre">&lt;mvc:view-resolvers&gt;</span></code>を使用することを推奨する。</p>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>ハンドラメソッドの返り値として <code class="docutils literal"><span class="pre">sample/report</span></code> というView名を返却した場合、 (5)でBean登録されたViewインスタンスによって生成されたデータがダウンロードデータとして応答される。</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p class="first">コンポーネントの名前にView名を指定して、ViewオブジェクトをBeanとして登録する。</p>
<p class="last">上記例では、 <code class="docutils literal"><span class="pre">sample/report</span></code> というbean名(View名)で <code class="docutils literal"><span class="pre">x.y.z.app.views.XxxExcelView</span></code> のインスタンスがBean登録される。</p>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><p class="first">Viewの実装例。</p>
<p class="last">上記例では、 <code class="docutils literal"><span class="pre">org.springframework.web.servlet.view.document.AbstractXlsxView</span></code> を継承し、Excelデータを生成するViewクラスの実装となる。</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id34">
<h3><a class="toc-backref" href="#id120">3.4.1.6. 処理の実装</a><a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><strong>Controllerでは、業務処理の実装は行わない</strong> という点がポイントとなる。</div>
<div class="line">業務処理の実装はServiceで行い、Controllerでは業務処理が実装されているServiceのメソッドを呼び出す。</div>
<div class="line">業務処理の実装の詳細については <a class="reference internal" href="DomainLayer.html"><span class="doc">ドメイン層の実装</span></a> を参照されたい。</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Controllerは、基本的には画面遷移の決定などの処理のルーティングと<code class="docutils literal"><span class="pre">Model</span></code>の設定のみ実装することに徹し、可能な限りシンプルな状態に保つこと。
この方針で統一することにより、Controllerで実装すべき処理が明確になり、開発規模が大きくなった場合でもControllerのメンテナンス性を保つことができる。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Controllerで実装すべき処理を以下に4つ示す。</p>
<ul class="simple">
<li><a class="reference internal" href="#controller-logic-correlationcheck-label"><span class="std std-ref">入力値の相関チェック</span></a></li>
<li><a class="reference internal" href="#controller-logic-businesslogic-label"><span class="std std-ref">業務処理の呼び出し</span></a></li>
<li><a class="reference internal" href="#controller-logic-domainobject-label"><span class="std std-ref">ドメインオブジェクトへの値反映</span></a></li>
<li><a class="reference internal" href="#controller-logic-formobject-label"><span class="std std-ref">フォームオブジェクトへの値反映</span></a></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="controller-logic-correlationcheck-label">
<span id="id35"></span><h4><a class="toc-backref" href="#id121">3.4.1.6.1. 入力値の相関チェック</a><a class="headerlink" href="#controller-logic-correlationcheck-label" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">入力値に対する相関チェックは、<code class="docutils literal"><span class="pre">org.springframework.validation.Validator</span></code>インタフェースを実装したValidationクラス、もしくは、Bean Validationで検証を行う。</div>
<div class="line">相関チェックの実装の詳細については、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Validation.html"><span class="doc">入力チェック</span></a> を参照されたい。</div>
</div>
<div class="line-block">
<div class="line">相関チェックの実装自体はControllerのハンドラメソッドで行うことはないが、相関チェックを行う<code class="docutils literal"><span class="pre">Validator</span></code>を<code class="docutils literal"><span class="pre">org.springframework.web.bind.WebDataBinder</span></code>に追加する必要がある。</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Inject</span>
<span class="hll"><span class="n">PasswordEqualsValidator</span> <span class="n">passwordEqualsValidator</span><span class="p">;</span> <span class="c1">// (1)</span>
</span>
<span class="nd">@InitBinder</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">initBinder</span><span class="p">(</span><span class="n">WebDataBinder</span> <span class="n">binder</span><span class="p">){</span>
<span class="hll">    <span class="n">binder</span><span class="p">.</span><span class="na">addValidators</span><span class="p">(</span><span class="n">passwordEqualsValidator</span><span class="p">);</span> <span class="c1">// (2)</span>
</span><span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>相関チェックを行う<code class="docutils literal"><span class="pre">Validator</span></code>をInjectする。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Injectした<code class="docutils literal"><span class="pre">Validator</span></code>を <code class="docutils literal"><span class="pre">WebDataBinder</span></code>に追加する。</div>
<div class="line"><code class="docutils literal"><span class="pre">WebDataBinder</span></code>に追加しておくことで、ハンドラメソッド呼び出し前に行われる入力チェック処理にて、(1)で追加した<code class="docutils literal"><span class="pre">Validator</span></code>が実行され、相関チェックを行うことが出来る。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-logic-businesslogic-label">
<span id="id36"></span><h4><a class="toc-backref" href="#id122">3.4.1.6.2. 業務処理の呼び出し</a><a class="headerlink" href="#controller-logic-businesslogic-label" title="Permalink to this headline">¶</a></h4>
<p>業務処理が実装されているServiceをInjectし、InjectしたServiceのメソッドを呼び出すことで業務処理を実行する。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Inject</span>
<span class="hll"><span class="n">SampleService</span> <span class="n">sampleService</span><span class="p">;</span> <span class="c1">// (1)</span>
</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="p">){</span>
<span class="hll">    <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="n">sampleService</span><span class="p">.</span><span class="na">hello</span><span class="p">();</span> <span class="c1">// (2)</span>
</span>    <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>
    <span class="k">return</span> <span class="s">&quot;sample/hello&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">業務処理が実装されている <code class="docutils literal"><span class="pre">Service</span></code> をInjectする。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>Injectした <code class="docutils literal"><span class="pre">Service</span></code> のメソッドを呼び出し、業務処理を実行する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-logic-domainobject-label">
<span id="id37"></span><h4><a class="toc-backref" href="#id123">3.4.1.6.3. ドメインオブジェクトへの値反映</a><a class="headerlink" href="#controller-logic-domainobject-label" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">本ガイドラインでは、HTML formから送信されたデータは直接ドメインオブジェクトにバインドするのではなく、フォームオブジェクトにバインドする方法を推奨している。</div>
<div class="line">そのため、ControllerではServiceのメソッドに渡すドメインオブジェクトにフォームオブジェクトの値を反映する処理を行う必要がある。</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">(</span><span class="nd">@Validated</span> <span class="n">SampleForm</span> <span class="n">form</span><span class="p">,</span> <span class="n">BindingResult</span> <span class="n">result</span><span class="p">,</span> <span class="n">Model</span> <span class="n">model</span><span class="p">){</span>
    <span class="c1">// omitted</span>
<span class="hll">    <span class="n">Sample</span> <span class="n">sample</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sample</span><span class="p">();</span> <span class="c1">// (1)</span>
</span>    <span class="n">sample</span><span class="p">.</span><span class="na">setField1</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getField1</span><span class="p">());</span>
    <span class="n">sample</span><span class="p">.</span><span class="na">setField2</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getField2</span><span class="p">());</span>
    <span class="n">sample</span><span class="p">.</span><span class="na">setField3</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getField3</span><span class="p">());</span>
    <span class="c1">// ...</span>
    <span class="c1">// and more ...</span>
    <span class="c1">// ...</span>
<span class="hll">    <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="n">sampleService</span><span class="p">.</span><span class="na">hello</span><span class="p">(</span><span class="n">sample</span><span class="p">);</span> <span class="c1">// (2)</span>
</span><span class="hll">    <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span> <span class="c1">// (3)</span>
</span>    <span class="k">return</span> <span class="s">&quot;sample/hello&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Serviceの引数となるドメインオブジェクトを生成し、フォームオブジェクトにバインドされている値を反映する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>Serviceのメソッドを呼び出し、業務処理を実行する。</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>業務処理から返却されたデータを <code class="docutils literal"><span class="pre">Model</span></code>に追加する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line">ドメインオブジェクトへ値を反映する処理は、Controllerのハンドラメソッド内で実装してもよいが、コード量が多くなる場合はハンドラメソッドの可読性を考慮してHelperクラスのメソッドに処理を委譲することを推奨する。</div>
<div class="line">以下にHelperメソッドに処理を委譲した場合の例を示す。</div>
</div>
<ul class="simple">
<li>SampleController.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Inject</span>
<span class="hll"><span class="n">SampleHelper</span> <span class="n">sampleHelper</span><span class="p">;</span> <span class="c1">// (1)</span>
</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">(</span><span class="nd">@Validated</span> <span class="n">SampleForm</span> <span class="n">form</span><span class="p">,</span> <span class="n">BindingResult</span> <span class="n">result</span><span class="p">){</span>
    <span class="c1">// omitted</span>
<span class="hll">    <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="n">sampleHelper</span><span class="p">.</span><span class="na">hello</span><span class="p">(</span><span class="n">form</span><span class="p">);</span> <span class="c1">// (2)</span>
</span>    <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>
    <span class="k">return</span> <span class="s">&quot;sample/hello&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>SampleHelper.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleHelper</span> <span class="p">{</span>

    <span class="nd">@Inject</span>
    <span class="n">SampleService</span> <span class="n">sampleService</span><span class="p">;</span>

<span class="hll">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">(</span><span class="n">SampleForm</span> <span class="n">form</span><span class="p">){</span> <span class="c1">// (3)</span>
</span>        <span class="n">Sample</span> <span class="n">sample</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sample</span><span class="p">();</span>
        <span class="n">sample</span><span class="p">.</span><span class="na">setField1</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getField1</span><span class="p">());</span>
        <span class="n">sample</span><span class="p">.</span><span class="na">setField2</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getField2</span><span class="p">());</span>
        <span class="n">sample</span><span class="p">.</span><span class="na">setField3</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getField3</span><span class="p">());</span>
        <span class="c1">// ...</span>
        <span class="c1">// and more ...</span>
        <span class="c1">// ...</span>
        <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="n">sampleService</span><span class="p">.</span><span class="na">hello</span><span class="p">(</span><span class="n">sample</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">message</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>ControllerにHelperクラスのオブジェクトをInjectする。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>InjectしたHelperクラスのメソッドを呼び出すことで、ドメインオブジェクトへの値の反映を行っている。
Helperクラスに処理を委譲することで、Controllerの実装をシンプルな状態に保つことができる。</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>ドメインオブジェクトを生成した後にServiceクラスのメソッド呼び出し、業務処理を実行している。</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Helperクラスに処理を委譲する以外の方法として、Bean変換機能を使用する方法がある。
Bean変換機能の詳細は、<a class="reference internal" href="../ArchitectureInDetail/GeneralFuncDetail/Dozer.html"><span class="doc">Beanマッピング(Dozer)</span></a> を参照されたい。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controller-logic-formobject-label">
<span id="id38"></span><h4><a class="toc-backref" href="#id124">3.4.1.6.4. フォームオブジェクトへの値反映</a><a class="headerlink" href="#controller-logic-formobject-label" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">本ガイドラインでは、HTML formの項目にバインドするデータはドメインオブジェクトではなく、フォームオブジェクトを使用する方法を推奨している。</div>
<div class="line">そのため、ControllerではServiceのメソッドから返却されたドメインオブジェクトの値をフォームオブジェクトに反映する処理を行う必要がある。</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">(</span><span class="n">SampleForm</span> <span class="n">form</span><span class="p">,</span> <span class="n">BindingResult</span> <span class="n">result</span><span class="p">,</span> <span class="n">Model</span> <span class="n">model</span><span class="p">){</span>
    <span class="c1">// omitted</span>
<span class="hll">    <span class="n">Sample</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">sampleService</span><span class="p">.</span><span class="na">getSample</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span> <span class="c1">// (1)</span>
</span><span class="hll">    <span class="n">form</span><span class="p">.</span><span class="na">setField1</span><span class="p">(</span><span class="n">sample</span><span class="p">.</span><span class="na">getField1</span><span class="p">());</span> <span class="c1">// (2)</span>
</span>    <span class="n">form</span><span class="p">.</span><span class="na">setField2</span><span class="p">(</span><span class="n">sample</span><span class="p">.</span><span class="na">getField2</span><span class="p">());</span>
    <span class="n">form</span><span class="p">.</span><span class="na">setField3</span><span class="p">(</span><span class="n">sample</span><span class="p">.</span><span class="na">getField3</span><span class="p">());</span>
    <span class="c1">// ...</span>
    <span class="c1">// and more ...</span>
    <span class="c1">// ...</span>
<span class="hll">    <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">sample</span><span class="p">);</span> <span class="c1">// (3)</span>
</span>    <span class="k">return</span> <span class="s">&quot;sample/hello&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>業務処理が実装されているServiceのメソッドを呼び出し、ドメインオブジェクトを取得する。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>取得したドメインオブジェクトの値をフォームオブジェクトに反映する。</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>表示のみ行う項目がある場合は、データを参照できるようにするために、<code class="docutils literal"><span class="pre">Model</span></code>にドメインオブジェクトを追加する。</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">画面に表示のみ行う項目については、フォームオブジェクトに項目をもつのではなく、Entityなどのドメインオブジェクトから直接値を参照することを推奨する。</p>
</div>
</div></blockquote>
<p>フォームオブジェクトへの値反映処理は、Controllerのハンドラメソッド内で実装してもよいが、
コード量が多くなる場合はハンドラメソッドの可読性を考慮してHelperクラスのメソッドに委譲することを推奨する。</p>
<ul class="simple">
<li>SampleController.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">(</span><span class="nd">@Validated</span> <span class="n">SampleForm</span> <span class="n">form</span><span class="p">,</span> <span class="n">BindingResult</span> <span class="n">result</span><span class="p">){</span>
    <span class="c1">// omitted</span>
    <span class="n">Sample</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">sampleService</span><span class="p">.</span><span class="na">getSample</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<span class="hll">    <span class="n">sampleHelper</span><span class="p">.</span><span class="na">applyToForm</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">form</span><span class="p">);</span> <span class="c1">// (1)</span>
</span>    <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">sample</span><span class="p">);</span>
    <span class="k">return</span> <span class="s">&quot;sample/hello&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>SampleHelper.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">applyToForm</span><span class="p">(</span><span class="n">SampleForm</span> <span class="n">destForm</span><span class="p">,</span> <span class="n">Sample</span> <span class="n">srcSample</span><span class="p">){</span>
<span class="hll">    <span class="n">destForm</span><span class="p">.</span><span class="na">setField1</span><span class="p">(</span><span class="n">srcSample</span><span class="p">.</span><span class="na">getField1</span><span class="p">());</span> <span class="c1">// (2)</span>
</span>    <span class="n">destForm</span><span class="p">.</span><span class="na">setField2</span><span class="p">(</span><span class="n">srcSample</span><span class="p">.</span><span class="na">getField2</span><span class="p">());</span>
    <span class="n">destForm</span><span class="p">.</span><span class="na">setField3</span><span class="p">(</span><span class="n">srcSample</span><span class="p">.</span><span class="na">getField3</span><span class="p">());</span>
    <span class="c1">// ...</span>
    <span class="c1">// and more ...</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>ドメインオブジェクトの値をフォームオブジェクトに反映するためのメソッドを呼び出す。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>ドメインオブジェクトの値をフォームオブジェクトに反映するためのメソッドにて、ドメインオブジェクトの値をフォームオブジェクトに反映する。</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Helperクラスに処理を委譲する以外の方法として、Bean変換機能を使用する方法がある。
Bean変換機能の詳細は、<a class="reference internal" href="../ArchitectureInDetail/GeneralFuncDetail/Dozer.html"><span class="doc">Beanマッピング(Dozer)</span></a> を参照されたい。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="formobject">
<span id="id39"></span><h2><a class="toc-backref" href="#id125">3.4.2. フォームオブジェクトの実装</a><a class="headerlink" href="#formobject" title="Permalink to this headline">¶</a></h2>
<p>フォームオブジェクトはHTML上のformを表現するオブジェクト(JavaBean)であり、以下の役割を担う。</p>
<ol class="arabic simple">
<li><strong>データベース等で保持している業務データを保持し、HTML(JSP) formから参照できるようにする。</strong></li>
<li><strong>HTML formから送信されたリクエストパラメータを保持し、ハンドラメソッドで参照できるようにする。</strong></li>
</ol>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/applicationFormobject.png"><img alt="../_images/applicationFormobject.png" src="../_images/applicationFormobject.png" style="width: 80%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>フォームオブジェクトの実装について、以下4点に着目して説明する。</p>
<ul class="simple">
<li><a class="reference internal" href="#formobject-new-label"><span class="std std-ref">フォームオブジェクトの作成方法</span></a></li>
<li><a class="reference internal" href="#formobject-init-label"><span class="std std-ref">フォームオブジェクトの初期化方法</span></a></li>
<li><a class="reference internal" href="#formobject-bindhtmlform-label"><span class="std std-ref">HTML formへのバインディング方法</span></a></li>
<li><a class="reference internal" href="#formobject-bindrequestparam-label"><span class="std std-ref">リクエストパラメータのバインディング方法</span></a></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="formobject-new-label">
<span id="id40"></span><h3><a class="toc-backref" href="#id126">3.4.2.1. フォームオブジェクトの作成方法</a><a class="headerlink" href="#formobject-new-label" title="Permalink to this headline">¶</a></h3>
<p>フォームオブジェクトはJavaBeanとして作成する。
Spring Frameworkでは、HTML formから送信されたリクエストパラメータ(文字列)を、フォームオブジェクトに定義されている型に変換してからバインドする機能を提供しているため、
フォームオブジェクトに定義するフィールドの型は、<code class="docutils literal"><span class="pre">java.lang.String</span></code>だけではなく、任意の型で定義することができる。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleForm</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">id</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">age</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">genderCode</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">birthDate</span><span class="p">;</span>
    <span class="c1">// ommitted getter/setter</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>Spring Frameworkから提供されている型変換を行う仕組みについて</strong></p>
<p>Spring Frameworkは、以下の3つの仕組みを使って型変換を行っており、基本的な型への変換は標準でサポートされている。各変換機能の詳細については、リンク先のページを参照されたい。</p>
<ul class="last simple">
<li><a class="reference external" href="https://docs.spring.io/spring-framework/docs/5.3.18/reference/html/core.html#core-convert">Spring Type Conversion</a></li>
<li><a class="reference external" href="https://docs.spring.io/spring-framework/docs/5.3.18/reference/html/core.html#format">Spring Field Formatting</a></li>
<li><a class="reference external" href="https://docs.spring.io/spring-framework/docs/5.3.18/reference/html/core.html#beans-beans-conversion">java.beans.PropertyEditor implementations</a></li>
</ul>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">フォームオブジェクトには画面に表示のみ行う項目は保持せず、HTML formの項目のみ保持することを推奨する。
フォームオブジェクトに画面表示のみ行う項目の値を設定した場合、フォームオブジェクトをHTTPセッションオブジェクトに格納する際にメモリを多く消費する事になり、メモリ枯渇の原因になる可能性がある。
画面表示のみの項目は、Entityなどのドメイン層のオブジェクトをリクエストスコープに追加(<code class="docutils literal"><span class="pre">Model.addAttribute</span></code>)することでHTML(JSP)にデータを渡すことを推奨する。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="id41">
<h4><a class="toc-backref" href="#id127">3.4.2.1.1. フィールド単位の数値型変換</a><a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">&#64;NumberFormat</span></code>アノテーションを使用することでフィールド毎に数値の形式を指定することが出来る。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleForm</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>
<span class="hll">    <span class="nd">@NumberFormat</span><span class="p">(</span><span class="n">pattern</span> <span class="o">=</span> <span class="s">&quot;#,#&quot;</span><span class="p">)</span> <span class="c1">// (1)</span>
</span>    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">price</span><span class="p">;</span>
    <span class="c1">// ommitted getter/setter</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>HTML formから送信されるリクエストパラメータの数値形式を指定する。例では、patternとして <code class="docutils literal"><span class="pre">#,#</span></code> 形式を指定しているので、「,」でフォーマットされた値をバインドすることができる。
リクエストパラメータの値が <code class="docutils literal"><span class="pre">1,050</span></code> の場合、フォームオブジェクトのpriceには <code class="docutils literal"><span class="pre">1050</span></code> のIntegerオブジェクトがバインドされる。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">&#64;NumberFormat</span></code>アノテーションで指定できる属性は以下の通り。</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="10%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">属性名</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>style</td>
<td>数値のスタイルを指定する。詳細は、<a class="reference external" href="https://docs.spring.io/spring/docs/5.3.18/javadoc-api/org/springframework/format/annotation/NumberFormat.Style.html">NumberFormat.StyleのJavadoc</a>を参照されたい。</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>pattern</td>
<td>Javaの数値形式を指定する。詳細は、<a class="reference external" href="http://docs.oracle.com/javase/8/docs/api/java/text/DecimalFormat.html">DecimalFormatのJavadoc</a>を参照されたい。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="applicationlayer-datetimeformat">
<span id="id42"></span><h4><a class="toc-backref" href="#id128">3.4.2.1.2. フィールド単位の日時型変換</a><a class="headerlink" href="#applicationlayer-datetimeformat" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">&#64;DateTimeFormat</span></code>アノテーションを使用することでフィールド毎に日時の形式を指定することが出来る。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleForm</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>
<span class="hll">    <span class="nd">@DateTimeFormat</span><span class="p">(</span><span class="n">pattern</span> <span class="o">=</span> <span class="s">&quot;yyyyMMdd&quot;</span><span class="p">)</span> <span class="c1">// (1)</span>
</span>    <span class="kd">private</span> <span class="n">Date</span> <span class="n">birthDate</span><span class="p">;</span>
    <span class="c1">// ommitted getter/setter</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>HTML formから送信されるリクエストパラメータの日時形式を指定する。例では、patternとして <code class="docutils literal"><span class="pre">yyyyMMdd</span></code> 形式を指定している。
リクエストパラメータの値が <code class="docutils literal"><span class="pre">20131001</span></code> の場合、フォームオブジェクトのbirthDateには 2013年10月1日のDateオブジェクトがバインドされる。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">&#64;DateTimeFormat</span></code>アノテーションで指定できる属性は以下の通り。</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="10%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">属性名</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>iso</td>
<td>ISOの日時形式を指定する。詳細は、<a class="reference external" href="https://docs.spring.io/spring/docs/5.3.18/javadoc-api/org/springframework/format/annotation/DateTimeFormat.ISO.html">DateTimeFormat.ISOのJavadoc</a>を参照。</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>pattern</td>
<td>Javaの日時形式を指定する。詳細は、<a class="reference external" href="http://docs.oracle.com/javase/8/docs/api/java/text/SimpleDateFormat.html">SimpleDateFormatのJavadoc</a>を参照されたい。</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>style</td>
<td><div class="first last line-block">
<div class="line">日付と時刻のスタイルを2桁の文字列として指定する。</div>
<div class="line">1桁目が日付のスタイル、2桁目が時刻のスタイルとなる。</div>
<div class="line">スタイルとして指定できる値は以下の値となる。</div>
<div class="line"><br /></div>
<div class="line">S : <code class="docutils literal"><span class="pre">java.text.DateFormat.SHORT</span></code>と同じ形式となる。</div>
<div class="line">M : <code class="docutils literal"><span class="pre">java.text.DateFormat.MEDIUM</span></code>と同じ形式となる。</div>
<div class="line">L : <code class="docutils literal"><span class="pre">java.text.DateFormat.LONG</span></code>と同じ形式となる。</div>
<div class="line">F : <code class="docutils literal"><span class="pre">java.text.DateFormat.FULL</span></code>と同じ形式となる。</div>
<div class="line">- : 省略を意味するスタイル。</div>
<div class="line"><br /></div>
<div class="line">指定例及び変換例)</div>
<div class="line">MM : Dec 9, 2013 3:37:47 AM</div>
<div class="line">M- : Dec 9, 2013</div>
<div class="line">-M : 3:41:45 AM</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id43">
<h4><a class="toc-backref" href="#id129">3.4.2.1.3. Controller単位の型変換</a><a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">&#64;InitBinder</span></code>アノテーションを使用することでController毎に型変換の定義を指定する事も出来る。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="hll"><span class="nd">@InitBinder</span> <span class="c1">// (1)</span>
</span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">initWebDataBinder</span><span class="p">(</span><span class="n">WebDataBinder</span> <span class="n">binder</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">binder</span><span class="p">.</span><span class="na">registerCustomEditor</span><span class="p">(</span>
            <span class="n">Long</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
<span class="hll">            <span class="k">new</span> <span class="n">CustomNumberEditor</span><span class="p">(</span><span class="n">Long</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="k">new</span> <span class="n">DecimalFormat</span><span class="p">(</span><span class="s">&quot;#,#&quot;</span><span class="p">),</span> <span class="kc">true</span><span class="p">));</span> <span class="c1">// (2)</span>
</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="hll"><span class="nd">@InitBinder</span><span class="p">(</span><span class="s">&quot;sampleForm&quot;</span><span class="p">)</span> <span class="c1">// (3)</span>
</span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">initSampleFormWebDataBinder</span><span class="p">(</span><span class="n">WebDataBinder</span> <span class="n">binder</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">&#64;InitBinder</span></code>アノテーション を付与したメソッド用意すると、バインド処理が行われる前にこのメソッドが呼び出され、デフォルトの動作をカスタマイズすることができる。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>例では、Long型のフィールドの数値形式を <code class="docutils literal"><span class="pre">#,#</span></code> に指定しているので、「,」でフォーマットされた値をバインドすることができる。</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">&#64;InitBinder</span></code>アノテーションのvalue属性にフォームオブジェクトの属性名を指定することで、フォームオブジェクト毎にデフォルトの動作をカスタマイズすることもできる。
例では、 <code class="docutils literal"><span class="pre">sampleForm</span></code> という属性名のフォームオブジェクトに対するバインド処理が行われる前にメソッドが呼び出される。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id44">
<h4><a class="toc-backref" href="#id130">3.4.2.1.4. 入力チェック用のアノテーションの指定</a><a class="headerlink" href="#id44" title="Permalink to this headline">¶</a></h4>
<p>フォームオブジェクトのバリデーションは、Bean Validationを使用して行うため、フィールドの制約条件を示すアノテーションを指定する必要がある。
入力チェックの詳細は、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Validation.html"><span class="doc">入力チェック</span></a> を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="formobject-init-label">
<span id="id45"></span><h3><a class="toc-backref" href="#id131">3.4.2.2. フォームオブジェクトの初期化方法</a><a class="headerlink" href="#formobject-init-label" title="Permalink to this headline">¶</a></h3>
<p>HTMLのformにバインドするフォームオブジェクトの事をform-backing beanと呼び、<code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code>アノテーションを使うことで結びつけることができる。
form-backing beanの初期化は、<code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code>アノテーションを付与したメソッドで行う。
このようなメソッドのことを本ガイドラインではModelAttributeメソッドと呼び、<code class="docutils literal"><span class="pre">setUpXxxForm</span></code>というメソッド名で定義することを推奨する。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="hll"><span class="nd">@ModelAttribute</span> <span class="c1">// (1)</span>
</span><span class="kd">public</span> <span class="n">SampleForm</span> <span class="nf">setUpSampleForm</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">SampleForm</span> <span class="n">form</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SampleForm</span><span class="p">();</span>
    <span class="c1">// populate form</span>
    <span class="k">return</span> <span class="n">form</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="hll"><span class="nd">@ModelAttribute</span><span class="p">(</span><span class="s">&quot;xxx&quot;</span><span class="p">)</span> <span class="c1">// (2)</span>
</span><span class="kd">public</span> <span class="n">SampleForm</span> <span class="nf">setUpSampleForm</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">SampleForm</span> <span class="n">form</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SampleForm</span><span class="p">();</span>
    <span class="c1">// populate form</span>
    <span class="k">return</span> <span class="n">form</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@ModelAttribute</span>
<span class="kd">public</span> <span class="n">SampleForm</span> <span class="nf">setUpSampleForm</span><span class="p">(</span>
<span class="hll">        <span class="nd">@CookieValue</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span> <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="c1">// (3)</span>
</span>        <span class="nd">@CookieValue</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;age&quot;</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span> <span class="n">Integer</span> <span class="n">age</span><span class="p">,</span>
        <span class="nd">@CookieValue</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;birthDate&quot;</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span> <span class="n">Date</span> <span class="n">birthDate</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">SampleForm</span> <span class="n">form</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SampleForm</span><span class="p">();</span>
    <span class="n">form</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
    <span class="n">form</span><span class="p">.</span><span class="na">setAge</span><span class="p">(</span><span class="n">age</span><span class="p">);</span>
    <span class="n">form</span><span class="p">.</span><span class="na">setBirthDate</span><span class="p">(</span><span class="n">birthDate</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">form</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">Model</span></code>に追加するための属性名は、クラス名の先頭を小文字にした値（デフォルト値）が設定される。この例では <code class="docutils literal"><span class="pre">sampleForm</span></code> が属性名になる。
返却したオブジェクトは、<code class="docutils literal"><span class="pre">model.addAttribute(form)</span></code>相当の処理が実行され<code class="docutils literal"><span class="pre">Model</span></code>に追加される。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">Model</span></code>に追加するための属性名を指定したい場合は、<code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code>アノテーションのvalue属性に指定する。この例では <code class="docutils literal"><span class="pre">xxx</span></code> が属性名になる。
返却したオブジェクトは、<code class="docutils literal"><span class="pre">model.addAttribute(&quot;xxx&quot;,</span> <span class="pre">form)</span></code>相当の処理が実行され<code class="docutils literal"><span class="pre">Model</span></code>に追加される。
デフォルト値以外の属性名を指定した場合、ハンドラメソッドの引数としてフォームオブジェクトを受け取る時に<code class="docutils literal"><span class="pre">&#64;ModelAttribute(&quot;xxx&quot;)</span></code>の指定が必要になる。</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>ModelAttributeメソッドは、ハンドラメソッドと同様に初期化に必要なパラメータを渡すこともできる。例では、<code class="docutils literal"><span class="pre">&#64;CookieValue</span></code>アノテーションを使用してCookieの値をフォームオブジェクトに設定している。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">フォームオブジェクトにデフォルト値を設定したい場合はModelAttributeメソッドで値を設定すること。
例の(3)ではCookieから値を取得しているが、定数クラスなどに定義されている固定値を直接設定してもよい。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">ModelAttributeメソッドはController内に複数定義することができる。各メソッドはControllerのハンドラメソッドが呼び出される前に毎回実行される。</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">ModelAttributeメソッドはリクエストごとにメソッドが実行されるため、特定のリクエストの時のみに必要なオブジェクトについてModelAttributeメソッドを使って生成すると、無駄なオブジェクトの生成及び初期化処理が行われる点に注意すること。
特定のリクエストのみで必要なオブジェクトについては、ハンドラメソッド内で生成し<code class="docutils literal"><span class="pre">Model</span></code>に追加する方法にすること。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="formobject-bindhtmlform-label">
<span id="formobjectjsp"></span><span id="id46"></span><h3><a class="toc-backref" href="#id132">3.4.2.3. HTML formへのバインディング方法</a><a class="headerlink" href="#formobject-bindhtmlform-label" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">Model</span></code>に追加されたフォームオブジェクトは<code class="docutils literal"><span class="pre">&lt;form:xxx&gt;</span></code>タグを用いて、HTML(JSP)のformにバインドすることができる。</div>
<div class="line"><code class="docutils literal"><span class="pre">&lt;form:xxx&gt;</span></code>タグの詳細は、 <a class="reference external" href="https://docs.spring.io/spring-framework/docs/5.3.18/reference/html/web.html#mvc-view-jsp-formtaglib">Spring Framework Documentation -Spring’s form tag library-</a>を参照されたい。</div>
</div>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="hll"><span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;form&quot;</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/tags/form&quot;</span> <span class="k">%&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</span></pre></div>
</div>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;form:form</span> <span class="na">modelAttribute=</span><span class="s">&quot;sampleForm&quot;</span>
<span class="hll">           <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/sample/hello&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">    Id         : <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;id&quot;</span> <span class="nt">/&gt;&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;id&quot;</span> <span class="nt">/&gt;&lt;br</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
</span>    Name       : <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;name&quot;</span> <span class="nt">/&gt;&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;name&quot;</span> <span class="nt">/&gt;&lt;br</span> <span class="nt">/&gt;</span>
    Age        : <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;age&quot;</span> <span class="nt">/&gt;&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;age&quot;</span> <span class="nt">/&gt;&lt;br</span> <span class="nt">/&gt;</span>
    Gender     : <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;genderCode&quot;</span> <span class="nt">/&gt;&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;genderCode&quot;</span> <span class="nt">/&gt;&lt;br</span> <span class="nt">/&gt;</span>
    Birth Date : <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;birthDate&quot;</span> <span class="nt">/&gt;&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;birthDate&quot;</span> <span class="nt">/&gt;&lt;br</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form:form&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">&lt;form:form&gt;</span></code>タグを使用するためのtaglibの定義を行う。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">&lt;form:form&gt;</span></code>タグのmodelAttribute属性には、<code class="docutils literal"><span class="pre">Model</span></code>に格納されているフォームオブジェクトの属性名を指定する。</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">&lt;form:input&gt;</span></code>タグのpath属性には、フォームオブジェクトのプロパティ名を指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="formobject-bindrequestparam-label">
<span id="id47"></span><h3><a class="toc-backref" href="#id133">3.4.2.4. リクエストパラメータのバインディング方法</a><a class="headerlink" href="#formobject-bindrequestparam-label" title="Permalink to this headline">¶</a></h3>
<p>HTML formから送信されたリクエストパラメータは、フォームオブジェクトにバインドし、Controllerのハンドラメソッドの引数に渡すことができる。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">(</span>
<span class="hll">        <span class="nd">@Validated</span> <span class="n">SampleForm</span> <span class="n">form</span><span class="p">,</span> <span class="c1">// (1)</span>
</span>        <span class="n">BindingResult</span> <span class="n">result</span><span class="p">,</span>
        <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;sample/input&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// process form...</span>
    <span class="k">return</span> <span class="s">&quot;sample/hello&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@ModelAttribute</span><span class="p">(</span><span class="s">&quot;xxx&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">SampleForm</span> <span class="nf">setUpSampleForm</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">SampleForm</span> <span class="n">form</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SampleForm</span><span class="p">();</span>
    <span class="c1">// populate form</span>
    <span class="k">return</span> <span class="n">form</span><span class="p">;</span>
<span class="p">}</span>

<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">(</span>
<span class="hll">        <span class="nd">@ModelAttribute</span><span class="p">(</span><span class="s">&quot;xxx&quot;</span><span class="p">)</span> <span class="nd">@Validated</span> <span class="n">SampleForm</span> <span class="n">form</span><span class="p">,</span> <span class="c1">// (2)</span>
</span>        <span class="n">BindingResult</span> <span class="n">result</span><span class="p">,</span>
        <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>フォームオブジェクトにリクエストパラメータが反映された状態で、Controllerのハンドラメソッドの引数に渡される。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>ModelAttributeメソッドにて属性名を指定した場合、<code class="docutils literal"><span class="pre">&#64;ModelAttribute(&quot;xxx&quot;)</span></code>といった感じで、フォームオブジェクトの属性名を明示的に指定する必要がある。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">ModelAttributeメソッドで指定した属性名とメソッドの引数で指定した属性名が異なる場合、ModelAttributeメソッドで生成したインスタンスとは別のインスタンスが生成されるので注意が必要。
ハンドラメソッドで属性名の指定を省略した場合、クラス名の先頭を小文字にした値が属性名として扱われる。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="id48">
<h4><a class="toc-backref" href="#id134">3.4.2.4.1. バインディング結果の判定</a><a class="headerlink" href="#id48" title="Permalink to this headline">¶</a></h4>
<p>HTML formから送信されたリクエストパラメータをフォームオブジェクトにバインドする際に発生したエラー（入力チェックエラーも含む）は、 <code class="docutils literal"><span class="pre">org.springframework.validation.BindingResult</span></code>に格納される。</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">(</span>
        <span class="nd">@Validated</span> <span class="n">SampleForm</span> <span class="n">form</span><span class="p">,</span>
<span class="hll">        <span class="n">BindingResult</span> <span class="n">result</span><span class="p">,</span> <span class="c1">// (1)</span>
</span>        <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">    <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span> <span class="c1">// (2)</span>
</span>        <span class="k">return</span> <span class="s">&quot;sample/input&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>フォームオブジェクトの直後に<code class="docutils literal"><span class="pre">BindingResult</span></code>を宣言すると、フォームオブジェクトへのバインド時のエラーと入力チェックエラーを参照することができる。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">BindingResult.hasErrors()</span></code>を呼び出すことで、フォームオブジェクトの入力値のエラー有無を判定することができる。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>フィールドエラーの有無、グローバルエラー(相関チェックエラーなどのクラスレベルのエラー)の有無を個別に判定することもできるので、要件に応じて使い分けること。</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="40%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">メソッド</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">hasGlobalErrors()</span></code></td>
<td>グローバルエラーの有無を判定するメソッド</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">hasFieldErrors()</span></code></td>
<td>フィールドエラーの有無を判定するメソッド</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">hasFieldErrors(String</span> <span class="pre">field)</span></code></td>
<td>指定したフィールドのエラー有無を判定するメソッド</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="id49">
<span id="id50"></span><h2><a class="toc-backref" href="#id135">3.4.3. Viewの実装</a><a class="headerlink" href="#id49" title="Permalink to this headline">¶</a></h2>
<p>Viewは以下の役割を担う。</p>
<ol class="arabic">
<li><div class="first line-block">
<div class="line"><strong>クライアントに応答するレスポンスデータ(HTML)を生成する。</strong></div>
<div class="line">Viewはモデル（フォームオブジェクトやドメインオブジェクトなど）から必要なデータを取得し、クライアントが描画するために必要な形式でレスポンスデータを生成する。</div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="jsp">
<span id="applicationlayerimplementofjsp"></span><h3><a class="toc-backref" href="#id136">3.4.3.1. JSPの実装</a><a class="headerlink" href="#jsp" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">クライアントにHTMLを応答する場合は、JSPを使用してViewを実装する。</div>
<div class="line">JSPを呼び出すための <code class="docutils literal"><span class="pre">ViewResolver</span></code> は、Spring Frameworkより提供されているので、提供されているクラスを利用する。<code class="docutils literal"><span class="pre">ViewResolver</span></code> の設定方法は、 <a class="reference internal" href="#controller-method-return-html-label"><span class="std std-ref">HTMLを応答する</span></a> を参照されたい。</div>
</div>
<p>以下に、基本的なJSPの実装方法について説明する。</p>
<ul class="simple">
<li><a class="reference internal" href="#view-jsp-include-label"><span class="std std-ref">インクルード用の共通JSPの作成</span></a></li>
<li><a class="reference internal" href="#view-jsp-out-label"><span class="std std-ref">モデルに格納されている値を表示する</span></a></li>
<li><a class="reference internal" href="#view-jsp-outnumber-label"><span class="std std-ref">モデルに格納されている数値を表示する</span></a></li>
<li><a class="reference internal" href="#view-jsp-outdate-label"><span class="std std-ref">モデルに格納されている日時を表示する</span></a></li>
<li><a class="reference internal" href="#view-jsp-requesturl-label"><span class="std std-ref">リクエストURLを生成する</span></a></li>
<li><a class="reference internal" href="#view-jsp-form-label"><span class="std std-ref">HTML formへフォームオブジェクトをバインドする</span></a></li>
<li><a class="reference internal" href="#view-jsp-errors-label"><span class="std std-ref">入力チェックエラーを表示する</span></a></li>
<li><a class="reference internal" href="#view-jsp-resultmessages-label"><span class="std std-ref">処理結果のメッセージを表示する</span></a></li>
<li><a class="reference internal" href="#view-jsp-codelist-label"><span class="std std-ref">コードリストを表示する</span></a></li>
<li><a class="reference internal" href="#view-jsp-message-label"><span class="std std-ref">固定文言を表示する</span></a></li>
<li><a class="reference internal" href="#view-jsp-if-label"><span class="std std-ref">条件によって表示を切り替える</span></a></li>
<li><a class="reference internal" href="#view-jsp-foreach-label"><span class="std std-ref">コレクションの要素に対して表示処理を繰り返す</span></a></li>
<li><a class="reference internal" href="#view-jsp-pagination-label"><span class="std std-ref">ページネーション用のリンクを表示する</span></a></li>
<li><a class="reference internal" href="#view-jsp-authorization-label"><span class="std std-ref">権限によって表示を切り替える</span></a></li>
</ul>
<p>本章では代表的なJSPタグライブラリの使い方は説明しているが、全てのJSPタグライブラリの説明はしていないので、詳細な使い方については、それぞれのドキュメントを参照すること。</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="30%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">JSPタグライブラリ名</th>
<th class="head">ドキュメント</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Spring’s form tag library</td>
<td><ul class="first last simple">
<li><a class="reference external" href="https://docs.spring.io/spring-framework/docs/5.3.18/reference/html/web.html#mvc-view-jsp-formtaglib">https://docs.spring.io/spring-framework/docs/5.3.18/reference/html/web.html#mvc-view-jsp-formtaglib</a></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>Spring’s JSP Tag Library</td>
<td><ul class="first last simple">
<li><a class="reference external" href="https://docs.spring.io/spring-framework/docs/5.3.18/reference/html/web.html#mvc-view-jsp-tags">https://docs.spring.io/spring-framework/docs/5.3.18/reference/html/web.html#mvc-view-jsp-tags</a></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>JSTL</td>
<td><ul class="first last simple">
<li><a class="reference external" href="http://download.oracle.com/otndocs/jcp/jstl-1.2-mrel2-eval-oth-JSpec/">http://download.oracle.com/otndocs/jcp/jstl-1.2-mrel2-eval-oth-JSpec/</a></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>Common library’s tags &amp; el functions</td>
<td><ul class="first last simple">
<li>本ガイドラインの「<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/TagLibAndELFunctions.html"><span class="doc">共通ライブラリが提供するJSP Tag Library と EL Functions</span></a>」</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>terasoluna-gfw-web 1.0.0.RELEASEを使用している場合は、Spring’s form tag libraryから提供されている<code class="docutils literal"><span class="pre">&lt;form:form&gt;</span></code>タグを使う際は、必ず<code class="docutils literal"><span class="pre">action</span></code>属性を指定すること。</p>
<p>terasoluna-gfw-web 1.0.0.RELEASEが依存しているSpring MVC(3.2.4.RELEASE)では、<code class="docutils literal"><span class="pre">&lt;form:form&gt;</span></code>タグの<code class="docutils literal"><span class="pre">action</span></code>属性を省略した場合、XSS(Cross-site scripting)の脆弱性が存在する。
脆弱性に関する情報については、<a class="reference external" href="http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2014-1904">National Vulnerability Database (NVD)のCVE-2014-1904</a>を参照されたい。</p>
<p class="last">尚、terasoluna-gfw-web 1.0.1.RELEASE以上では、XSS対策が行われているSpring MVC(3.2.10.RELEASE以上)に依存しているため、本脆弱性は存在しない。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="view-jsp-include-label">
<span id="id51"></span><h4><a class="toc-backref" href="#id137">3.4.3.1.1. インクルード用の共通JSPの作成</a><a class="headerlink" href="#view-jsp-include-label" title="Permalink to this headline">¶</a></h4>
<p>全てのJSPで必要となるディレクティブの宣言などを行うためのJSPを作成する。
このJSPを <code class="docutils literal"><span class="pre">web.xml</span></code> の <code class="docutils literal"><span class="pre">&lt;jsp-config&gt;/&lt;jsp-property-group&gt;/&lt;include-prelude&gt;</span></code> 要素に指定することで、個々のJSPで宣言する必要がなくなる。
なお、このファイルはブランクプロジェクトで提供している。</p>
<ul class="simple">
<li>include.jsp</li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="hll"><span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;c&quot;</span><span class="k">%&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span><span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://java.sun.com/jsp/jstl/fmt&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;fmt&quot;</span><span class="k">%&gt;</span>

<span class="hll"><span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/tags&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;spring&quot;</span><span class="k">%&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span><span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/tags/form&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;form&quot;</span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/security/tags&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;sec&quot;</span><span class="k">%&gt;</span>

<span class="hll"><span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://terasoluna.org/functions&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;f&quot;</span><span class="k">%&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span><span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://terasoluna.org/tags&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;t&quot;</span><span class="k">%&gt;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>web.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;jsp-config&gt;</span>
    <span class="nt">&lt;jsp-property-group&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>*.jsp<span class="nt">&lt;/url-pattern&gt;</span>
        <span class="nt">&lt;el-ignored&gt;</span>false<span class="nt">&lt;/el-ignored&gt;</span>
        <span class="nt">&lt;page-encoding&gt;</span>UTF-8<span class="nt">&lt;/page-encoding&gt;</span>
        <span class="nt">&lt;scripting-invalid&gt;</span>false<span class="nt">&lt;/scripting-invalid&gt;</span>
<span class="hll">        <span class="nt">&lt;include-prelude&gt;</span>/WEB-INF/views/common/include.jsp<span class="nt">&lt;/include-prelude&gt;</span> <span class="c">&lt;!-- (4) --&gt;</span>
</span>    <span class="nt">&lt;/jsp-property-group&gt;</span>
<span class="nt">&lt;/jsp-config&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>JSTLのJSPタグライブラリを宣言している。 例では、 <code class="docutils literal"><span class="pre">core</span></code> と <code class="docutils literal"><span class="pre">fmt</span></code> を利用している。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>Spring FrameworkのJSPタグライブラリを宣言している。 例では、 <code class="docutils literal"><span class="pre">spring</span></code> と <code class="docutils literal"><span class="pre">form</span></code> と <code class="docutils literal"><span class="pre">sec</span></code> を利用している。</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>共通ライブラリから提供しているJSPタグライブラリを宣言している。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td>インクルード用のJSP(<code class="docutils literal"><span class="pre">/WEB-INF/views/common/include.jsp</span></code>)に指定した内容が、各JSP(<code class="docutils literal"><span class="pre">&lt;url-pattern&gt;</span></code>で指定されているファイル)の先頭にインクルードされる。</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">ディレクティブの詳細は、 <a class="reference external" href="https://download.oracle.com/otndocs/jcp/jsp-2_3-mrel2-eval-spec/">JavaServer Pages Specification(Version2.3)</a>の “JSP.1.10 Directives” を参照されたい。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">&lt;jsp-property-group&gt;要素の詳細は、 <a class="reference external" href="https://download.oracle.com/otndocs/jcp/jsp-2_3-mrel2-eval-spec/">JavaServer Pages Specification(Version2.3)</a>の “JSP.3.3 JSP Property Groups” を参照されたい。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="view-jsp-out-label">
<span id="id53"></span><h4><a class="toc-backref" href="#id138">3.4.3.1.2. モデルに格納されている値を表示する</a><a class="headerlink" href="#view-jsp-out-label" title="Permalink to this headline">¶</a></h4>
<p>モデル（フォームオブジェクトやドメインオブジェクトなど）に格納されている値をHTMLに表示する場合、EL式又はJSTLから提供されているJSPタグライブラリを使用する。</p>
<p>EL式を使用して表示する。</p>
<ul class="simple">
<li>SampleController.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">    <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="k">new</span> <span class="n">HelloBean</span><span class="p">(</span><span class="s">&quot;Bean Hello World!&quot;</span><span class="p">));</span> <span class="c1">// (1)</span>
</span>    <span class="k">return</span> <span class="s">&quot;sample/hello&quot;</span><span class="p">;</span> <span class="c1">// returns view name</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>hello.jsp</li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="hll">Message : ${f:h(helloBean.message)} <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span></pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Model</span></code>オブジェクトに <code class="docutils literal"><span class="pre">HelloBean</span></code>オブジェクトを追加する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">View(JSP)側では、「${属性名.JavaBeanのプロパティ名}」と記述することで<code class="docutils literal"><span class="pre">Model</span></code>オブジェクトに追加したデータを取得することができる。</div>
<div class="line">例ではHTMLエスケープを行うEL式の関数を呼び出しているため、「${f:h(属性名.JavaBeanのプロパティ名)}」としている。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">共通部品よりEL式用のHTMLエスケープ関数( <code class="docutils literal"><span class="pre">f:h</span></code> )を提供しているので、EL式を使用してHTMLに値を出力する場合は、必ず使用すること。
HTMLエスケープを行うEL式の関数の詳細については、 <a class="reference internal" href="../Security/XSS.html"><span class="doc">Cross Site Scripting</span></a> を参照されたい。</p>
</div>
</div></blockquote>
<p>JSTLのJSPタグライブラリから提供されている <code class="docutils literal"><span class="pre">&lt;c:out&gt;</span></code> タグを使用して表示する。</p>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="hll">Message : <span class="nt">&lt;c:out</span> <span class="na">value=</span><span class="s">&quot;${helloBean.message}&quot;</span> <span class="nt">/&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span></pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">EL式で取得した値を <code class="docutils literal"><span class="pre">&lt;c:out&gt;</span></code> タグのvalue属性に指定する。HTMLエスケープも行われる。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">&lt;c:out&gt;</span></code> の詳細は、<a class="reference external" href="http://download.oracle.com/otndocs/jcp/jstl-1.2-mrel2-eval-oth-JSpec/">JavaServer Pages Standard Tag Library(Version 1.2)</a>の “CHAPTER 4 General-Purpose Actions” を参照されたい。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="view-jsp-outnumber-label">
<span id="id54"></span><h4><a class="toc-backref" href="#id139">3.4.3.1.3. モデルに格納されている数値を表示する</a><a class="headerlink" href="#view-jsp-outnumber-label" title="Permalink to this headline">¶</a></h4>
<p>数値型の値をフォーマットして出力する場合、JSTLから提供されているJSPタグライブラリを使用する。</p>
<div class="line-block">
<div class="line">JSTLのJSPタグライブラリから提供されている <code class="docutils literal"><span class="pre">&lt;fmt:formatNumber&gt;</span></code> タグを使用して表示する。</div>
</div>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="hll">Number Item : <span class="nt">&lt;fmt:formatNumber</span> <span class="na">value=</span><span class="s">&quot;${helloBean.numberItem}&quot;</span> <span class="na">pattern=</span><span class="s">&quot;0.00&quot;</span> <span class="nt">/&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span></pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">EL式で取得した値を <code class="docutils literal"><span class="pre">&lt;fmt:formatNumber&gt;</span></code> タグのvalue属性に指定する。表示するフォーマットはpattern属性に指定する。例では、<code class="docutils literal"><span class="pre">0.00</span></code> を指定している。</div>
<div class="line">仮に <code class="docutils literal"><span class="pre">${helloBean.numberItem}</span></code> で取得した値が <code class="docutils literal"><span class="pre">1.2</span></code> の場合、画面には <code class="docutils literal"><span class="pre">1.20</span></code> が出力される。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">&lt;fmt:formatNumber&gt;</span></code> の詳細は、<a class="reference external" href="http://download.oracle.com/otndocs/jcp/jstl-1.2-mrel2-eval-oth-JSpec/">JavaServer Pages Standard Tag Library(Version 1.2)</a>の “CHAPTER 9 Formatting Actions” を参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="view-jsp-outdate-label">
<span id="id56"></span><h4><a class="toc-backref" href="#id140">3.4.3.1.4. モデルに格納されている日時を表示する</a><a class="headerlink" href="#view-jsp-outdate-label" title="Permalink to this headline">¶</a></h4>
<p>日時型の値をフォーマットして出力する場合、JSTLから提供されているJSPタグライブラリを使用する。</p>
<p>JSTLのJSPタグライブラリから提供されている <code class="docutils literal"><span class="pre">&lt;fmt:formatDate&gt;</span></code> タグを使用して表示する。</p>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="hll">Date Item : <span class="nt">&lt;fmt:formatDate</span> <span class="na">value=</span><span class="s">&quot;${helloBean.dateItem}&quot;</span> <span class="na">pattern=</span><span class="s">&quot;yyyy-MM-dd&quot;</span> <span class="nt">/&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span></pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">EL式で取得した値を <code class="docutils literal"><span class="pre">&lt;fmt:formatDate&gt;</span></code> タグのvalue属性に指定する。表示するフォーマットはpattern属性に指定する。例では、<code class="docutils literal"><span class="pre">yyyy-MM-dd</span></code> を指定している。</div>
<div class="line">仮に <code class="docutils literal"><span class="pre">${helloBean.dateItem}</span></code> で取得した値が2013年3月2日の場合、画面には <code class="docutils literal"><span class="pre">2013-03-02</span></code> が出力される。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">&lt;fmt:formatDate&gt;</span></code> の詳細は、<a class="reference external" href="http://download.oracle.com/otndocs/jcp/jstl-1.2-mrel2-eval-oth-JSpec/">JavaServer Pages Standard Tag Library(Version 1.2)</a>の “CHAPTER 9 Formatting Actions” を参照されたい。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">日時オブジェクトの型として、Joda Timeから提供されている <code class="docutils literal"><span class="pre">org.joda.time.DateTime</span></code> などを利用する場合は、Jada Timeから提供されているJSPタグライブラリを使用すること。
Joda Timeの詳細は、 <a class="reference internal" href="../ArchitectureInDetail/GeneralFuncDetail/JodaTime.html"><span class="doc">日付操作(Joda Time)</span></a> を参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="view-jsp-requesturl-label">
<span id="id58"></span><h4><a class="toc-backref" href="#id141">3.4.3.1.5. リクエストURLを生成する</a><a class="headerlink" href="#view-jsp-requesturl-label" title="Permalink to this headline">¶</a></h4>
<p>HTMLの<code class="docutils literal"><span class="pre">&lt;form&gt;</span></code>要素(JSPタグライブラリの<code class="docutils literal"><span class="pre">&lt;form:form&gt;</span></code>要素)の<code class="docutils literal"><span class="pre">action</span></code>属性や<code class="docutils literal"><span class="pre">&lt;a&gt;</span></code>要素の<code class="docutils literal"><span class="pre">href</span></code>属性などに対してリクエストURL(Controllerのメソッドを呼び出すためのURL)を設定する場合は、
以下のいずれかの方法を使用してURLを生成する。</p>
<ul class="simple">
<li>文字列としてリクエストURLを組み立てる</li>
<li>Spring Framework 4.1から追加されたEL関数を使用してリクエストURLを組み立てる</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">どちらの方法を使用してもよいが、一つのアプリケーションの中で混在して使用することは、
保守性を低下させる可能性があるので避けた方がよい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">以降の説明で使用するControllerのメソッドの実装サンプルを示す。</div>
<div class="line">以降の説明では、以下に示すメソッドを呼び出すためのリクエストURLを生成するための実装方法について説明する。</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.app.hello</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>

<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloController</span> <span class="p">{</span>

    <span class="c1">// (1)</span>
    <span class="nd">@RequestMapping</span><span class="p">({</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;/&quot;</span><span class="p">})</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;hello/home&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>このメソッドに割り当てられるリクエストURLは、<code class="docutils literal"><span class="pre">{コンテキストパス}/hello</span></code>となる。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>文字列としてリクエストURLを組み立てる</strong></p>
<p>まず、文字列としてリクエストURLを組み立てる方法について説明する。</p>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/hello&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">pageContext</span></code>(JSPの暗黙オブジェクト)からWebアプリケーションに割り振られているコンテキスパスを取得し(<code class="docutils literal"><span class="pre">${pageContext.request.contextPath}</span></code>)、
コンテキストパスの後ろに呼び出すControllerのメソッドに割り振られているサーブレットパス(上記例では、<code class="docutils literal"><span class="pre">/hello</span></code>)を加える。</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>URLを組み立てるJSPタグライブラリとして、</p>
<ul class="simple">
<li>JSTLから提供されている <code class="docutils literal"><span class="pre">&lt;c:url&gt;</span></code></li>
<li>Spring Frameworkから提供されている <code class="docutils literal"><span class="pre">&lt;spring:url&gt;</span></code></li>
</ul>
<p>が存在する。これらのJSPタグライブラリを使用して、リクエストURLを組み立ててもよい。</p>
<p class="last">リクエストURLを動的に組み立てる必要がある場合は、
これらのJSPタグライブラリを使用してURLを組み立てた方がよいケースがある。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Spring Framework 4.1から追加されたEL関数を使用してリクエストURLを組み立てる</strong></p>
<p>つぎに、Spring Framework 4.1から追加されたEL関数(<code class="docutils literal"><span class="pre">spring:mvcUrl</span></code>)を使用してリクエストURLを組み立てる方法について説明する。</p>
<p><code class="docutils literal"><span class="pre">spring:mvcUrl</span></code>関数を使用すると、Controllerのメソッドのメタ情報(メソッドシグネチャやアノテーションなど)と連携して、
リクエストURLを組み立てる事ができる。</p>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;${spring:mvcUrl(&#39;HC#hello&#39;).build()}&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p class="first"><code class="docutils literal"><span class="pre">spring:mvcUrl</span></code>関数の引数には、呼び出すControllerのメソッドに割り振られているリクエストマッピング名を指定する。</p>
<p><code class="docutils literal"><span class="pre">spring:mvcUrl</span></code>関数からは、リクエストURLを組み立てるクラス(<code class="docutils literal"><span class="pre">MvcUriComponentsBuilder.MethodArgumentBuilder</span></code>)のオブジェクトが返却される。
<code class="docutils literal"><span class="pre">MvcUriComponentsBuilder.MethodArgumentBuilder</span></code>クラスには、</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">arg</span></code>メソッド</li>
<li><code class="docutils literal"><span class="pre">build</span></code>メソッド</li>
<li><code class="docutils literal"><span class="pre">buildAndExpand</span></code>メソッド</li>
</ul>
<p>が用意されており、それぞれ、以下の役割を持つ。</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">arg</span></code>メソッドは、Controllerのメソッドの引数に渡す値を指定するためのメソッドである。</li>
<li><code class="docutils literal"><span class="pre">build</span></code>メソッドは、リクエストURLを生成するためのメソッドである。</li>
<li><code class="docutils literal"><span class="pre">buildAndExpand</span></code>メソッドは、Controllerのメソッドの引数として宣言されていない動的な部分(パス変数など)に埋め込む値を指定した上で、リクエストURLを生成するためのメソッドである。</li>
</ul>
<p>上記例では、リクエストURLが静的なURLであるため、<code class="docutils literal"><span class="pre">build</span></code>メソッドのみを呼び出してリクエストURLを生成している。
リクエストURLが動的なURL(パス変数やクエリ文字列が存在するURL)の場合は、
<code class="docutils literal"><span class="pre">arg</span></code>メソッドや<code class="docutils literal"><span class="pre">buildAndExpand</span></code>メソッドを呼び出す必要がある。</p>
<p class="last"><code class="docutils literal"><span class="pre">arg</span></code>メソッドと<code class="docutils literal"><span class="pre">buildAndExpand</span></code>メソッドの具体的な使用例については、
「<a class="reference external" href="https://docs.spring.io/spring-framework/docs/5.3.18/reference/html/web.html#mvc-links-to-controllers-from-views">Spring Framework Documentation -Links in Views-</a>」を参照されたい。</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>リクエストマッピング名について</strong></p>
<p>リクエストマッピング名は、デフォルト実装(<code class="docutils literal"><span class="pre">org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMethodMappingNamingStrategy</span></code>の実装)では、
「クラス名の大文字部分(クラスの短縮名) + “<code class="docutils literal"><span class="pre">#</span></code>”  + メソッド名」となる。</p>
<p class="last">リクエストマッピング名は重複しないようにする必要がある。
名前が重複してしまった場合は、<code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code>アノテーションの<code class="docutils literal"><span class="pre">name</span></code>属性に一意となる名前を指定する必要がある。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="view-jsp-form-label">
<span id="id59"></span><h4><a class="toc-backref" href="#id142">3.4.3.1.6. HTML formへフォームオブジェクトをバインドする</a><a class="headerlink" href="#view-jsp-form-label" title="Permalink to this headline">¶</a></h4>
<p>HTML formへフォームオブジェクトをバインドし、フォームオブジェクトで保持している値を表示する場合、Spring Frameworkから提供されているJSPタグライブラリを使用する。</p>
<p>Spring Frameworkから提供されている <code class="docutils literal"><span class="pre">&lt;form:form&gt;</span></code> タグを使用してバインドする。</p>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;form:form</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/sample/hello&quot;</span>
<span class="hll">           <span class="na">modelAttribute=</span><span class="s">&quot;sampleForm&quot;</span><span class="nt">&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span><span class="hll">    Id : <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;id&quot;</span> <span class="nt">/&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span><span class="nt">&lt;/form:form&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">&lt;form:form&gt;</span></code>タグのmodelAttribute属性に、<code class="docutils literal"><span class="pre">Model</span></code>に格納されているフォームオブジェクトの属性名を指定する。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">&lt;form:xxx&gt;</span></code>タグのpath属性に、バインドしたいプロパティのプロパティ名を指定する。  <code class="docutils literal"><span class="pre">xxx</span></code> の部分は、入力項目のタイプによってかわる。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">&lt;form:form&gt;</span></code>、<code class="docutils literal"><span class="pre">&lt;form:xxx&gt;</span></code>タグの詳細は、 <a class="reference external" href="https://docs.spring.io/spring-framework/docs/5.3.18/reference/html/web.html#mvc-view-jsp-formtaglib">Spring Framework Documentation -Spring’s form tag library-</a>を参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="view-jsp-errors-label">
<span id="id61"></span><h4><a class="toc-backref" href="#id143">3.4.3.1.7. 入力チェックエラーを表示する</a><a class="headerlink" href="#view-jsp-errors-label" title="Permalink to this headline">¶</a></h4>
<p>入力チェックエラーの内容を表示する場合、Spring Frameworkから提供されているJSPタグライブラリを使用する。</p>
<div class="line-block">
<div class="line">Spring Frameworkから提供されている <code class="docutils literal"><span class="pre">&lt;form:errors&gt;</span></code> タグを使用して表示する。</div>
<div class="line">詳細は、 <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Validation.html"><span class="doc">入力チェック</span></a> を参照されたい。</div>
</div>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;form:form</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/sample/hello&quot;</span>
           <span class="na">modelAttribute=</span><span class="s">&quot;sampleForm&quot;</span><span class="nt">&gt;</span>
<span class="hll">    Id : <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;id&quot;</span> <span class="nt">/&gt;&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;id&quot;</span> <span class="nt">/&gt;</span><span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span><span class="nt">&lt;/form:form&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">&lt;form:errors&gt;</span></code>タグのpath属性に、エラー表示したいプロパティのプロパティ名を指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="view-jsp-resultmessages-label">
<span id="id62"></span><h4><a class="toc-backref" href="#id144">3.4.3.1.8. 処理結果のメッセージを表示する</a><a class="headerlink" href="#view-jsp-resultmessages-label" title="Permalink to this headline">¶</a></h4>
<p>処理結果を通知するメッセージを表示する場合、共通部品から提供しているJSPタグライブラリを使用する。</p>
<div class="line-block">
<div class="line">共通部品から提供している <code class="docutils literal"><span class="pre">&lt;t:messagesPanel&gt;</span></code> タグを使用する。</div>
<div class="line">詳細は、 <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/MessageManagement.html"><span class="doc">メッセージ管理</span></a> を参照されたい。</div>
</div>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;messages&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2&gt;</span>Message pattern<span class="nt">&lt;/h2&gt;</span>
<span class="hll">    <span class="nt">&lt;t:messagesPanel</span> <span class="nt">/&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span><span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">resultMessages</span></code> という属性名で格納されているメッセージを出力する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="view-jsp-codelist-label">
<span id="id63"></span><h4><a class="toc-backref" href="#id145">3.4.3.1.9. コードリストを表示する</a><a class="headerlink" href="#view-jsp-codelist-label" title="Permalink to this headline">¶</a></h4>
<p>共通部品から提供されているコードリストを表示する場合は、Spring Frameworkから提供されているJSPタグライブラリを使用する。</p>
<div class="line-block">
<div class="line">JSPからコードリストを参照する場合は、 <code class="docutils literal"><span class="pre">java.util.Map</span></code> インタフェースと同じ方法で参照することができる。</div>
<div class="line">詳細は、 <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Codelist.html"><span class="doc">コードリスト</span></a> を参照されたい。</div>
</div>
<p>コードリストをセレクトボックスに表示する。</p>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;form:select</span> <span class="na">path=</span><span class="s">&quot;orderStatus&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;form:option</span> <span class="na">value=</span><span class="s">&quot;&quot;</span> <span class="na">label=</span><span class="s">&quot;--Select--&quot;</span> <span class="nt">/&gt;</span>
<span class="hll">    <span class="nt">&lt;form:options</span> <span class="na">items=</span><span class="s">&quot;${CL_ORDERSTATUS}&quot;</span> <span class="nt">/&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span><span class="nt">&lt;/form:select&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>コードリスト名( <code class="docutils literal"><span class="pre">CL_ORDERSTATUS</span></code> ) を属性名として、コードリスト( <code class="docutils literal"><span class="pre">java.util.Map</span></code> インタフェース)が格納されている。
そのためJSPでは、EL式を使ってコードリスト( <code class="docutils literal"><span class="pre">java.util.Map</span></code> インタフェース)にアクセスすることができる。
取得した <code class="docutils literal"><span class="pre">Map</span></code> インタフェースを <code class="docutils literal"><span class="pre">&lt;form:options&gt;</span></code> のitems属性に渡すことで、コードリストをセレクトボックスに表示することができる。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>セレクトボックスで選択した値のコード名を表示する。</p>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span>Order Status : ${f:h(CL_ORDERSTATUS[orderForm.orderStatus])}
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>セレクトボックス作成時と同様に、コードリスト名( <code class="docutils literal"><span class="pre">CL_ORDERSTATUS</span></code> ) を属性名として、コードリスト( <code class="docutils literal"><span class="pre">java.util.Map</span></code> インタフェース)を取得する。
取得した <code class="docutils literal"><span class="pre">Map</span></code> インタフェースのキー値として、セレクトボックスで選択した値を指定することで、コード名を表示することができる。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="view-jsp-message-label">
<span id="id64"></span><h4><a class="toc-backref" href="#id146">3.4.3.1.10. 固定文言を表示する</a><a class="headerlink" href="#view-jsp-message-label" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">画面名、項目名、ガイダンス用のメッセージなどについては、国際化の必要がない場合はJSPに直接記載してもよい。</div>
<div class="line">ただし、国際化の必要がある場合はSpring Frameworkから提供されているJSPタグライブラリを使用して、プロパティファイルから取得した値を表示する。</div>
</div>
<div class="line-block">
<div class="line">Spring Frameworkから提供されている <code class="docutils literal"><span class="pre">&lt;spring:message&gt;</span></code> タグを使用して表示する。</div>
<div class="line">詳細は、 <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Internationalization.html"><span class="doc">国際化</span></a> を参照されたい。</div>
</div>
<ul class="simple">
<li>properties</li>
</ul>
<blockquote>
<div><div class="highlight-properties"><div class="highlight"><pre><span></span><span class="hll"><span class="c"># (1)</span>
</span><span class="hll"><span class="na">label.orderStatus</span><span class="o">=</span><span class="s">注文ステータス</span>
</span></pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>jsp</li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="hll"><span class="nt">&lt;spring:message</span> <span class="na">code=</span><span class="s">&quot;label.orderStatus&quot;</span> <span class="na">text=</span><span class="s">&quot;Order Status&quot;</span> <span class="nt">/&gt;</span> : <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span>    ${f:h(CL_ORDERSTATUS[orderForm.orderStatus])}
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>プロパティファイルにラベルの値を定義する。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">&lt;spring:message&gt;</span></code> のcode属性にプロパティファイルのキー名を指定するとキー名に一致するプロパティ値が表示される。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">text属性に指定した値は、プロパティ値が取得できなかった場合に表示される。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="view-jsp-if-label">
<span id="id65"></span><h4><a class="toc-backref" href="#id147">3.4.3.1.11. 条件によって表示を切り替える</a><a class="headerlink" href="#view-jsp-if-label" title="Permalink to this headline">¶</a></h4>
<p>モデルが保持する値によって表示を切り替えたい場合は、JSTLから提供されているJSPタグライブラリを使用する。</p>
<p>JSTLのJSPタグライブラリから提供されている <code class="docutils literal"><span class="pre">&lt;c:if&gt;</span></code> タグ又は <code class="docutils literal"><span class="pre">&lt;c:choose&gt;</span></code> を使用して、表示の切り替えを行う。</p>
<p><code class="docutils literal"><span class="pre">&lt;c:if&gt;</span></code> を使用して表示を切り替える。</p>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="hll"><span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">&quot;${orderForm.orderStatus != &#39;complete&#39;}&quot;</span><span class="nt">&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span>        <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">...</span> <span class="o">--</span><span class="k">%&gt;</span>
<span class="nt">&lt;/c:if&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">&lt;c:if&gt;</span></code> のtest属性に分岐に入る条件を実装する。例では注文ステータスが <code class="docutils literal"><span class="pre">'complete'</span></code> ではない場合に分岐内の表示処理が実行される。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">&lt;c:choose&gt;</span></code> を使用して表示を切り替える。</p>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;c:choose&gt;</span>
<span class="hll">    <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">&quot;${customer.type == &#39;premium&#39;}&quot;</span><span class="nt">&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span>        <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">...</span> <span class="o">--</span><span class="k">%&gt;</span>
    <span class="nt">&lt;/c:when&gt;</span>
    <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">&quot;${customer.type == &#39;general&#39;}&quot;</span><span class="nt">&gt;</span>
        <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">...</span> <span class="o">--</span><span class="k">%&gt;</span>
    <span class="nt">&lt;/c:when&gt;</span>
<span class="hll">    <span class="nt">&lt;c:otherwise&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span>        <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">...</span> <span class="o">--</span><span class="k">%&gt;</span>
    <span class="nt">&lt;/c:otherwise&gt;</span>
<span class="nt">&lt;/c:choose&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">&lt;c:when&gt;</span></code> タグのtest属性に分岐に入る条件を実装する。例では顧客の種別が <code class="docutils literal"><span class="pre">'premium'</span></code> の場合に分岐内の表示処理が実行される。
test属性で指定した条件が <code class="docutils literal"><span class="pre">false</span></code> の場合は、次の <code class="docutils literal"><span class="pre">&lt;c:when&gt;</span></code> タグの処理が実行される。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>全ての <code class="docutils literal"><span class="pre">&lt;c:when&gt;</span></code> タグのtest属性の結果が <code class="docutils literal"><span class="pre">false</span></code> の場合、 <code class="docutils literal"><span class="pre">&lt;c:otherwise&gt;</span></code> タグ内の表示処理が実行される。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">詳細は、 <a class="reference external" href="http://download.oracle.com/otndocs/jcp/jstl-1.2-mrel2-eval-oth-JSpec/">JavaServer Pages Standard Tag Library(Version 1.2)</a>の “CHAPTER 5 Conditional Actions” を参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="view-jsp-foreach-label">
<span id="id67"></span><h4><a class="toc-backref" href="#id148">3.4.3.1.12. コレクションの要素に対して表示処理を繰り返す</a><a class="headerlink" href="#view-jsp-foreach-label" title="Permalink to this headline">¶</a></h4>
<p>モデルが保持するコレクションに対して表示処理を繰り返したい場合は、JSTLから提供されているJSPタグライブラリを使用する。</p>
<p>JSTLのJSPタグライブラリから提供されている <code class="docutils literal"><span class="pre">&lt;c:forEach&gt;</span></code> を使用して表示処理を繰り返す。</p>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;table&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;th&gt;</span>No<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;</span>Name<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
<span class="hll">    <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">&quot;customer&quot;</span> <span class="na">items=</span><span class="s">&quot;${customers}&quot;</span> <span class="na">varStatus=</span><span class="s">&quot;status&quot;</span><span class="nt">&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span>        <span class="nt">&lt;tr&gt;</span>
<span class="hll">            <span class="nt">&lt;td&gt;</span>${status.count}<span class="nt">&lt;/td&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span><span class="hll">            <span class="nt">&lt;td&gt;</span>${f:h(customer.name)}<span class="nt">&lt;/td&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span>        <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/c:forEach&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">&lt;c:forEach&gt;</span></code> タグのitems属性にコレクションを指定する事で、<code class="docutils literal"><span class="pre">&lt;c:forEach&gt;</span></code> タグ内の表示処理が繰り返し実行される。
処理対象となっている要素のオブジェクトを参照する場合は、var属性にオブジェクトを格納するための変数名を指定する。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">&lt;c:forEach&gt;</span></code> タグのvarStatus属性で指定した変数から現在処理を行っている要素位置(count)を取得している。
count以外の属性については、 <code class="docutils literal"><span class="pre">javax.servlet.jsp.jstl.core.LoopTagStatus</span></code> の <a class="reference external" href="http://download.oracle.com/otndocs/jcp/jstl-1.2-mrel2-eval-oth-JSpec/">JavaDoc</a>を参照されたい。</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">&lt;c:forEach&gt;</span></code> タグのvar属性で指定した変数に格納されているオブジェクトから値を取得している。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">詳細は、 <a class="reference external" href="http://download.oracle.com/otndocs/jcp/jstl-1.2-mrel2-eval-oth-JSpec/">JavaServer Pages Standard Tag Library(Version 1.2)</a>の “CHAPTER 6 Iterator Actions” を参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="view-jsp-pagination-label">
<span id="id69"></span><h4><a class="toc-backref" href="#id149">3.4.3.1.13. ページネーション用のリンクを表示する</a><a class="headerlink" href="#view-jsp-pagination-label" title="Permalink to this headline">¶</a></h4>
<p>一覧表示を行う画面にてページネーション用のリンクを表示する場合は、共通部品から提供しているJSPタグライブラリを使用する。</p>
<p>共通部品から提供している <code class="docutils literal"><span class="pre">&lt;t:pagination&gt;</span></code> を使用してページネーション用のリンクを表示する。
詳細は、 <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Pagination.html"><span class="doc">ページネーション</span></a> を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="view-jsp-authorization-label">
<span id="id70"></span><h4><a class="toc-backref" href="#id150">3.4.3.1.14. 権限によって表示を切り替える</a><a class="headerlink" href="#view-jsp-authorization-label" title="Permalink to this headline">¶</a></h4>
<p>ログインしているユーザの権限によって表示を切り替える場合は、Spring Securityから提供されているJSPタグライブラリを使用する。</p>
<p>Spring Securityから提供されている <code class="docutils literal"><span class="pre">&lt;sec:authorize&gt;</span></code> を使用して表示の切り替えを行う。
詳細は、 <a class="reference internal" href="../Security/Authorization.html"><span class="doc">認可</span></a> を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="javascript">
<h3><a class="toc-backref" href="#id151">3.4.3.2. JavaScriptの実装</a><a class="headerlink" href="#javascript" title="Permalink to this headline">¶</a></h3>
<p>画面描画後に画面項目の制御(表示/非表示、活性/非活性などの制御)を行う必要がある場合は、JavaScriptを使用して、項目の制御を行う。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id71">
<h3><a class="toc-backref" href="#id152">3.4.3.3. スタイルシートの実装</a><a class="headerlink" href="#id71" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">画面のデザインに関わる属性値の指定はJSP(HTML)に直接指定するのではなく、スタイルシート(cssファイル)に指定することを推奨する。</div>
<div class="line">JSP(HTML)では、項目を一意に特定するためのid属性の指定と項目の分類を示すclass属性の指定を行い、実際の項目の配置や見た目にかかわる属性値の指定はスタイルシート(cssファイル)で指定する。</div>
<div class="line">このような構成にすることで、JSPの実装からデザインに関わる処理を減らすことができる。</div>
<div class="line">同時にちょっとしたデザイン変更であれば、JSPを修正せずにスタイルシート(cssファイル)の修正のみで対応可能となる。</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">&lt;form:xxx&gt;</span></code> タグを使ってフォームを生成した場合、id属性は自動で設定される。class属性については、アプリケーション開発者によって指定が必要。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id72">
<h2><a class="toc-backref" href="#id153">3.4.4. 共通処理の実装</a><a class="headerlink" href="#id72" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="controller-common-process">
<span id="id73"></span><h3><a class="toc-backref" href="#id154">3.4.4.1. Controllerの呼び出し前後で行う共通処理の実装</a><a class="headerlink" href="#controller-common-process" title="Permalink to this headline">¶</a></h3>
<p>本項でいう共通処理とは、Controllerを呼び出し前後に行う必要がある共通的な処理のことを指す。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="servlet-filter">
<h4><a class="toc-backref" href="#id155">3.4.4.1.1. Servlet Filterの実装</a><a class="headerlink" href="#servlet-filter" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Spring MVCに依存しない共通処理については、Servlet Filterで実装する。</div>
<div class="line">ただし、Controllerのハンドラメソッドにマッピングされるリクエストに対してのみ共通処理を行いたい場合は、Servlet FilterではなくHandlerInterceptorで実装すること。</div>
</div>
<div class="line-block">
<div class="line">以下に、Servlet Filterのサンプルを示す。</div>
<div class="line">サンプルコードでは、クライアントのIPアドレスをログ出力するために <code class="docutils literal"><span class="pre">MDC</span></code> に値を格納している。</div>
</div>
<ul class="simple">
<li>java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="hll"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClientInfoPutFilter</span> <span class="kd">extends</span> <span class="n">OncePerRequestFilter</span> <span class="p">{</span> <span class="c1">// (1)</span>
</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">ATTRIBUTE_NAME</span> <span class="o">=</span> <span class="s">&quot;X-Forwarded-For&quot;</span><span class="p">;</span>
    <span class="kd">protected</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">doFilterInternal</span><span class="p">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="p">,</span>
            <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="p">,</span> <span class="n">FilterChain</span> <span class="n">filterChain</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="p">,</span> <span class="n">IOException</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">remoteIp</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="na">getHeader</span><span class="p">(</span><span class="n">ATTRIBUTE_NAME</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">remoteIp</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">remoteIp</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="na">getRemoteAddr</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="n">MDC</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ATTRIBUTE_NAME</span><span class="p">,</span> <span class="n">remoteIp</span><span class="p">);</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">filterChain</span><span class="p">.</span><span class="na">doFilter</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
            <span class="n">MDC</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">ATTRIBUTE_NAME</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>web.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="hll"><span class="nt">&lt;filter&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
</span>    <span class="nt">&lt;filter-name&gt;</span>clientInfoPutFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;filter-class&gt;</span>x.y.z.ClientInfoPutFilter<span class="nt">&lt;/filter-class&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
<span class="hll"><span class="nt">&lt;filter-mapping&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
</span>    <span class="nt">&lt;filter-name&gt;</span>clientInfoPutFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>サンプルではSpring Frameworkから提供されている <code class="docutils literal"><span class="pre">org.springframework.web.filter.OncePerRequestFilter</span></code> の子クラスとしてServlet Filterを作成することで、同一リクエスト内で1回だけ実行されることを保証している。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>作成したServlet Filterを <code class="docutils literal"><span class="pre">web.xml</span></code> に登録する。</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>登録したServlet Filterを適用するURLのパターンを指定する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Servlet FilterをSpring FrameworkのBeanとして定義することもできる。</p>
<ul class="simple">
<li>web.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>clientInfoPutFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="hll">    <span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="nt">&lt;/filter-class&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>clientInfoPutFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>applicationContext.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="hll"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;clientInfoPutFilter&quot;</span> <span class="na">class=</span><span class="s">&quot;x.y.z.ClientInfoPutFilter&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
</span></pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>サンプルではSpring Frameworkから提供されている <code class="docutils literal"><span class="pre">org.springframework.web.filter.DelegatingFilterProxy</span></code> をServlet Filterのクラスに指定することで、(2)で定義したServlet Filterに処理が委譲される。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>作成したServlet FilterのクラスをBean定義ファイル( <code class="docutils literal"><span class="pre">applicationContext.xml</span></code> )に追加する。
その際に、id属性には <code class="docutils literal"><span class="pre">web.xml</span></code> で指定したフィルター名( <code class="docutils literal"><span class="pre">&lt;filter-name&gt;</span></code> タグで指定した値 )にすること。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="handlerinterceptor">
<h4><a class="toc-backref" href="#id156">3.4.4.1.2. HandlerInterceptorの実装</a><a class="headerlink" href="#handlerinterceptor" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Spring MVCに依存する共通処理については、 HandlerInterceptorで実装する。</div>
<div class="line">HandlerInterceptorは、リクエストにマッピングされたハンドラメソッドが決定した後に呼び出されるので、アプリケーションが許可しているリクエストに対してのみ共通処理を行うことができる。</div>
</div>
<p>HandlerInterceptorでは以下の３つのポイントで処理を実行することが出来る。</p>
<ul>
<li><div class="first line-block">
<div class="line">Controllerのハンドラメソッドを実行する前</div>
<div class="line"><code class="docutils literal"><span class="pre">HandlerInterceptor#preHandle</span></code> メソッドとして実装する。</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Controllerのハンドラメソッドが正常終了した後</div>
<div class="line"><code class="docutils literal"><span class="pre">HandlerInterceptor#postHandle</span></code> メソッドとして実装する。</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Controllerのハンドラメソッドの処理が完了した後(正常/異常に関係なく実行される)</div>
<div class="line"><code class="docutils literal"><span class="pre">HandlerInterceptor#afterCompletion</span></code> メソッドとして実装する。</div>
</div>
</li>
</ul>
<div class="line-block">
<div class="line">以下に、HandlerInterceptorのサンプルを示す。</div>
<div class="line">サンプルコードでは、Controllerの処理が正常終了した後にinfoレベルのログを出力している。</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="hll"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SuccessLoggingInterceptor</span> <span class="kd">implements</span> <span class="n">HandlerInterceptor</span> <span class="p">{</span> <span class="c1">// (1)</span>
</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span>
            <span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">SuccessLoggingInterceptor</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postHandle</span><span class="p">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="p">,</span>
            <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="p">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="p">,</span>
            <span class="n">ModelAndView</span> <span class="n">modelAndView</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="n">HandlerMethod</span> <span class="n">handlerMethod</span> <span class="o">=</span> <span class="p">(</span><span class="n">HandlerMethod</span><span class="p">)</span> <span class="n">handler</span><span class="p">;</span>
        <span class="n">Method</span> <span class="n">m</span> <span class="o">=</span> <span class="n">handlerMethod</span><span class="p">.</span><span class="na">getMethod</span><span class="p">();</span>
        <span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;[SUCCESS CONTROLLER] {}.{}&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span> <span class="p">{</span>
                <span class="n">m</span><span class="p">.</span><span class="na">getDeclaringClass</span><span class="p">().</span><span class="na">getSimpleName</span><span class="p">(),</span> <span class="n">m</span><span class="p">.</span><span class="na">getName</span><span class="p">()});</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>spring-mvc.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;mvc:interceptors&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;mvc:interceptor&gt;</span>
<span class="hll">        <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&quot;/**&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/resources/**&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;x.y.z.SuccessLoggingInterceptor&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (4) --&gt;</span>
</span>    <span class="nt">&lt;/mvc:interceptor&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/mvc:interceptors&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>サンプルではSpring Frameworkから提供されている <code class="docutils literal"><span class="pre">org.springframework.web.servlet.HandlerInterceptor</span></code> の実装クラスとしてHandlerInterceptorを作成している。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>作成したHandlerInterceptorを適用するパスのパターンを指定する。</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>作成したHandlerInterceptorを適用しないパスのパターンを指定する。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td>作成したHandlerInterceptorを <code class="docutils literal"><span class="pre">spring-mvc.xml</span></code> の <code class="docutils literal"><span class="pre">&lt;mvc:interceptors&gt;</span></code> タグ内に追加する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">非同期リクエストを処理する <code class="docutils literal"><span class="pre">org.springframework.web.servlet.AsyncHandlerInterceptor</span></code> も提供されている。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">HandlerInterceptorのパス指定においてはワイルドカード（ <code class="docutils literal"><span class="pre">*</span></code> や <code class="docutils literal"><span class="pre">**</span></code> ）を使用することができる。
このうち <code class="docutils literal"><span class="pre">**</span></code> はSpring Framework 5.3.0よりパスの最後にしか使用できなくなった。最後以外に使用した場合は起動時やアクセス時にエラーとなる。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id74">
<h3><a class="toc-backref" href="#id157">3.4.4.2. Controllerの共通処理の実装</a><a class="headerlink" href="#id74" title="Permalink to this headline">¶</a></h3>
<p>ここでいう共通処理とは、すべてのControllerで共通的に実装する必要がある処理のことを指す。</p>
<div class="section" id="handlermethodargumentresolver">
<span id="methodargumentresolver"></span><h4><a class="toc-backref" href="#id158">3.4.4.2.1. HandlerMethodArgumentResolverの実装</a><a class="headerlink" href="#handlermethodargumentresolver" title="Permalink to this headline">¶</a></h4>
<p>Spring FrameworkのデフォルトでサポートされていないオブジェクトをControllerの引数として渡したい場合は、
HandlerMethodArgumentResolverを実装してControllerの引数として受け取れるようにする。</p>
<div class="line-block">
<div class="line">以下に、HandlerMethodArgumentResolverのサンプルを示す。</div>
<div class="line">サンプルコードでは、 共通的なリクエストパラメータをJavaBeanに変換してControllerのメソッドで受け取れるようにしている。</div>
</div>
<ul class="simple">
<li>JavaBean</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="hll"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CommonParameters</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span> <span class="c1">// (1)</span>
</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">param1</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">param2</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">param3</span><span class="p">;</span>

    <span class="c1">// ....</span>

<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>HandlerMethodArgumentResolver</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CommonParametersMethodArgumentResolver</span> <span class="kd">implements</span>
<span class="hll">                                                   <span class="n">HandlerMethodArgumentResolver</span> <span class="p">{</span> <span class="c1">// (2)</span>
</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">supportsParameter</span><span class="p">(</span><span class="n">MethodParameter</span> <span class="n">parameter</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">        <span class="k">return</span> <span class="n">CommonParameters</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">parameter</span><span class="p">.</span><span class="na">getParameterType</span><span class="p">());</span> <span class="c1">// (3)</span>
</span>    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">resolveArgument</span><span class="p">(</span><span class="n">MethodParameter</span> <span class="n">parameter</span><span class="p">,</span>
            <span class="n">ModelAndViewContainer</span> <span class="n">mavContainer</span><span class="p">,</span> <span class="n">NativeWebRequest</span> <span class="n">webRequest</span><span class="p">,</span>
            <span class="n">WebDataBinderFactory</span> <span class="n">binderFactory</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
<span class="hll">        <span class="n">CommonParameters</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CommonParameters</span><span class="p">();</span> <span class="c1">// (4)</span>
</span>        <span class="n">params</span><span class="p">.</span><span class="na">setParam1</span><span class="p">(</span><span class="n">webRequest</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;param1&quot;</span><span class="p">));</span>
        <span class="n">params</span><span class="p">.</span><span class="na">setParam2</span><span class="p">(</span><span class="n">webRequest</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;param2&quot;</span><span class="p">));</span>
        <span class="n">params</span><span class="p">.</span><span class="na">setParam3</span><span class="p">(</span><span class="n">webRequest</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;param3&quot;</span><span class="p">));</span>
        <span class="k">return</span> <span class="n">params</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Controller</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;home&quot;</span><span class="p">)</span>
<span class="hll"><span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="p">(</span><span class="n">CommonParameters</span> <span class="n">commonParams</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// (5)</span>
</span>    <span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;param1 : {}&quot;</span><span class="p">,</span><span class="n">commonParams</span><span class="p">.</span><span class="na">getParam1</span><span class="p">());</span>
    <span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;param2 : {}&quot;</span><span class="p">,</span><span class="n">commonParams</span><span class="p">.</span><span class="na">getParam2</span><span class="p">());</span>
    <span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;param3 : {}&quot;</span><span class="p">,</span><span class="n">commonParams</span><span class="p">.</span><span class="na">getParam3</span><span class="p">());</span>
    <span class="c1">// ...</span>
    <span class="k">return</span> <span class="s">&quot;sample/home&quot;</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>spring-mvc.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;mvc:annotation-driven&gt;</span>
    <span class="nt">&lt;mvc:argument-resolvers&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>
<span class="hll">        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;x.y.z.CommonParametersMethodArgumentResolver&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (6) --&gt;</span>
</span>        <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;/mvc:argument-resolvers&gt;</span>
<span class="nt">&lt;/mvc:annotation-driven&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>共通パラメータを保持するJavaBean。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">org.springframework.web.method.support.HandlerMethodArgumentResolver</span></code> インタフェースを実装する。</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>処理対象とする型を判定する。例では、共通パラメータを保持するJavaBeanの型がControllerの引数として指定されていた場合に、このクラスのresolveArgumentメソッドが呼び出される。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td>リクエストパラメータから値を取得し、共通パラメータを保持するJavaBeanに設定し返却する。</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Controllerのハンドラメソッドの引数に共通パラメータを保持するJavaBeanを指定する。</div>
<div class="line">(4)で返却されるオブジェクトが渡される。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td>作成したHandlerMethodArgumentResolverを <code class="docutils literal"><span class="pre">spring-mvc.xml</span></code> の <code class="docutils literal"><span class="pre">&lt;mvc:argument-resolvers&gt;</span></code> タグ内に追加する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">全てのControllerのハンドラメソッドで共通的に渡すパラメータがある場合は、HandlerMethodArgumentResolverを使ってJavaBeanに変換してから渡す方法が有効的である。
ここでいうパラメータとは、リクエストパラメータに限らない。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="controlleradvice">
<span id="application-layer-controller-advice"></span><h4><a class="toc-backref" href="#id159">3.4.4.2.2. <code class="docutils literal"><span class="pre">&#64;ControllerAdvice</span></code>の実装</a><a class="headerlink" href="#controlleradvice" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">&#64;ControllerAdvice</span></code>アノテーションを付与したクラスでは、
複数のControllerで実行したい共通的な処理を実装する。</p>
<p><code class="docutils literal"><span class="pre">&#64;ControllerAdvice</span></code>アノテーションを付与したクラスを作成すると、</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&#64;InitBinder</span></code> を付与したメソッド</li>
<li><code class="docutils literal"><span class="pre">&#64;ExceptionHandler</span></code> を付与したメソッド</li>
<li><code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code> を付与したメソッド</li>
</ul>
<p>で実装した処理を、複数のControllerに適用する事ができる。</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><code class="docutils literal"><span class="pre">&#64;ControllerAdvice</span></code>アノテーションは、Spring Framework 3.2 から追加された仕組みだが、
全てのControllerに処理が適用される仕組みになっていたため、アプリケーション全体の共通処理しか実装できなかった。</p>
<p class="last">Spring Framework 4.0 からは、共通処理を適用するControllerを柔軟に指定する事ができるように改善されている。
この改善により、様々な粒度で共通処理を実装する事ができるようになった。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p id="application-layer-controller-advice-attribute">以下に、共通処理を適用するControllerを指定する方法(属性の指定方法)について説明する。</p>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="15%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">属性</th>
<th class="head">説明と指定例</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">annotations</span></code></td>
<td><p class="first">アノテーションを指定する。</p>
<p>指定したアノテーションが付与されたControllerに対して共通処理が適用される。
以下に指定例を示す。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@ControllerAdvice</span><span class="p">(</span><span class="n">annotations</span> <span class="o">=</span> <span class="n">LoginFormModelAttributeSetter</span><span class="p">.</span><span class="na">LoginFormModelAttribute</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginFormModelAttributeSetter</span> <span class="p">{</span>
    <span class="nd">@Target</span><span class="p">(</span><span class="n">TYPE</span><span class="p">)</span>
    <span class="nd">@Retention</span><span class="p">(</span><span class="n">RUNTIME</span><span class="p">)</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nd">@interface</span> <span class="n">LoginFormModelAttribute</span> <span class="p">{}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@LoginFormModelAttribute</span>
<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WelcomeController</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@LoginFormModelAttribute</span>
<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginController</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p class="last">上記例では、<code class="docutils literal"><span class="pre">WelcomeController</span></code>と<code class="docutils literal"><span class="pre">LoginController</span></code>に<code class="docutils literal"><span class="pre">&#64;LoginFormModelAttribute</span></code>アノテーションを付与しているため、
<code class="docutils literal"><span class="pre">WelcomeController</span></code>と<code class="docutils literal"><span class="pre">LoginController</span></code>に共通処理が適用される。</p>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">assignableTypes</span></code></td>
<td><p class="first">クラス又はインタフェースを指定する。</p>
<p>指定したクラス又はインタフェースに割り当て可能(キャスト可能)なControllerに対して共通処理が適用される。
本属性を使用する場合は、共通処理を適用するControllerであることを示すためのマーカーインタフェースを属性値に指定するスタイルを採用することを推奨する。
このスタイルを採用した場合、Controller側では、適用したい共通処理用のマーカーインタフェースを実装するだけでよい。
以下の指定例を示す。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@ControllerAdvice</span><span class="p">(</span><span class="n">assignableTypes</span> <span class="o">=</span> <span class="n">ISODateInitBinder</span><span class="p">.</span><span class="na">ISODateApplicable</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ISODateInitBinder</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">ISODateApplicable</span> <span class="p">{}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleController</span> <span class="kd">implements</span> <span class="n">ISODateApplicable</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p class="last">上記例では、<code class="docutils literal"><span class="pre">SampleController</span></code>が<code class="docutils literal"><span class="pre">&#64;ISODateApplicable</span></code>インタフェース(マーカーインタフェース)を実装しているため、
<code class="docutils literal"><span class="pre">SampleController</span></code>に共通処理が適用される。</p>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">basePackageClasses</span></code></td>
<td><p class="first">クラス又はインタフェースを指定する。</p>
<p>指定したクラス又はインタフェースのパッケージ配下のControllerに対して共通処理が適用される。</p>
<p>本属性を使用する場合は、</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&#64;ControllerAdvice</span></code>を付与したクラス</li>
<li>パッケージを識別するためのマーカーインタフェース</li>
</ul>
<p>を属性値に指定するスタイルを採用することを推奨する。
以下に指定例を示す。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.app</span>

<span class="nd">@ControllerAdvice</span><span class="p">(</span><span class="n">basePackageClasses</span> <span class="o">=</span> <span class="n">AppGlobalExceptionHandler</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppGlobalExceptionHandler</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.app.sample</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleController</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上記例では、<code class="docutils literal"><span class="pre">SampleController</span></code>が<code class="docutils literal"><span class="pre">&#64;ControllerAdvice</span></code>を付与したクラス(<code class="docutils literal"><span class="pre">AppGlobalExceptionHandler</span></code>)が格納されているパッケージ(<code class="docutils literal"><span class="pre">com.example.app</span></code>)配下に格納されているため、
<code class="docutils literal"><span class="pre">SampleController</span></code>に共通処理が適用される。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.app.common</span>

<span class="nd">@ControllerAdvice</span><span class="p">(</span><span class="n">basePackageClasses</span> <span class="o">=</span> <span class="n">AppPackage</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppGlobalExceptionHandler</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.app</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AppPackage</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p class="last"><code class="docutils literal"><span class="pre">&#64;ControllerAdvice</span></code>が付与されているクラスとControllerが格納されているクラスのパッケージ階層が異なる場合や、複数のベースパッケージに共通処理を適用したい場合は、
パッケージを識別するためのマーカインタフェースを用意すればよい。</p>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">basePackages</span></code></td>
<td><p class="first">パッケージ名を指定する。</p>
<p>指定したパッケージ配下のControllerに対して共通処理が適用される。
以下に指定例を示す。</p>
<div class="last highlight-java"><div class="highlight"><pre><span></span><span class="nd">@ControllerAdvice</span><span class="p">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="s">&quot;com.example.app&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppGlobalExceptionHandler</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">value</span></code></td>
<td><p class="first"><code class="docutils literal"><span class="pre">basePackages</span></code>へのエイリアス。</p>
<p><code class="docutils literal"><span class="pre">basePackages</span></code>属性を指定した際と同じ動作となる。
以下に指定例を示す。</p>
<div class="last highlight-java"><div class="highlight"><pre><span></span><span class="nd">@ControllerAdvice</span><span class="p">(</span><span class="s">&quot;com.example.app&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppGlobalExceptionHandler</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><code class="docutils literal"><span class="pre">basePackageClasses</span></code>属性 / <code class="docutils literal"><span class="pre">basePackages</span></code>属性 / <code class="docutils literal"><span class="pre">value</span></code>属性は、
共通処理を適用したいControllerが格納されているベースパッケージを指定するための属性であるが、
<code class="docutils literal"><span class="pre">basePackageClasses</span></code>属性を使用した場合、</p>
<ul class="simple">
<li>存在しないパッケージを指定してしまう事を防ぐことが出来る</li>
<li>IDE上で行ったパッケージ名変更と連動することが出来る</li>
</ul>
<p class="last">ため、タイプセーフな指定方法と言える。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">以下に、<code class="docutils literal"><span class="pre">&#64;InitBinder</span></code>メソッドの実装サンプルを示す。</div>
<div class="line">サンプルコードでは、 リクエストパラメータで指定できる日付型で形式を <code class="docutils literal"><span class="pre">yyyy/MM/dd</span></code> に設定している。</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="hll"><span class="nd">@ControllerAdvice</span> <span class="c1">// (1)</span>
</span><span class="hll"><span class="nd">@Order</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">// (2)</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleControllerAdvice</span> <span class="p">{</span>

<span class="hll">    <span class="c1">// (3)</span>
</span><span class="hll">    <span class="nd">@InitBinder</span>
</span>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initBinder</span><span class="p">(</span><span class="n">WebDataBinder</span> <span class="n">binder</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SimpleDateFormat</span> <span class="n">dateFormat</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="p">(</span><span class="s">&quot;yyyy/MM/dd&quot;</span><span class="p">);</span>
        <span class="n">dateFormat</span><span class="p">.</span><span class="na">setLenient</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
        <span class="n">binder</span><span class="p">.</span><span class="na">registerCustomEditor</span><span class="p">(</span><span class="n">Date</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                <span class="k">new</span> <span class="n">CustomDateEditor</span><span class="p">(</span><span class="n">dateFormat</span><span class="p">,</span> <span class="kc">true</span><span class="p">));</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">&#64;ControllerAdvice</span></code>アノテーションを付与することで、ControllerAdviceのBeanであることを示している。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">&#64;Order</span></code>アノテーションを付与することで、共通処理が適用される優先度を指定する。複数のControllerAdviceに依存関係があるなど、ControllerAdviceに順序性を持たせたい場合は必ず指定すること。順序性を持たせる必要がなければ指定しなくてもよい。</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">&#64;InitBinder</span></code>メソッドを実装する。全てのControllerに対して<code class="docutils literal"><span class="pre">&#64;InitBinder</span></code>メソッドが適用される。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">以下に、<code class="docutils literal"><span class="pre">&#64;ExceptionHandler</span></code>メソッドの実装サンプルを示す。</div>
<div class="line">サンプルコードでは、  <code class="docutils literal"><span class="pre">org.springframework.dao.PessimisticLockingFailureException</span></code> をハンドリングしてロックエラー画面のViewを返却している。</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="hll"><span class="c1">// (1)</span>
</span><span class="hll"><span class="nd">@ExceptionHandler</span><span class="p">(</span><span class="n">PessimisticLockingFailureException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</span><span class="kd">public</span> <span class="n">String</span> <span class="nf">handlePessimisticLockingFailureException</span><span class="p">(</span>
        <span class="n">PessimisticLockingFailureException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">&quot;error/lockError&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">&#64;ExceptionHandler</span></code>メソッドを実装する。全てのControllerに対して<code class="docutils literal"><span class="pre">&#64;ExceptionHandler</span></code>メソッドが適用される。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">以下に、<code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code>メソッドの実装サンプルを示す。</div>
<div class="line">サンプルコードでは、 共通的なリクエストパラメータをJavaBeanに変換して <code class="docutils literal"><span class="pre">Model</span></code> に格納している。</div>
</div>
<ul class="simple">
<li>ControllerAdvice</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="hll"><span class="c1">// (1)</span>
</span><span class="hll"><span class="nd">@ModelAttribute</span>
</span><span class="kd">public</span> <span class="n">CommonParameters</span> <span class="nf">setUpCommonParameters</span><span class="p">(</span>
        <span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;param1&quot;</span><span class="p">,</span> <span class="n">defaultValue</span><span class="o">=</span><span class="s">&quot;def1&quot;</span><span class="p">)</span> <span class="n">String</span> <span class="n">param1</span><span class="p">,</span>
        <span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;param2&quot;</span><span class="p">,</span> <span class="n">defaultValue</span><span class="o">=</span><span class="s">&quot;def2&quot;</span><span class="p">)</span> <span class="n">String</span> <span class="n">param2</span><span class="p">,</span>
        <span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;param3&quot;</span><span class="p">,</span> <span class="n">defaultValue</span><span class="o">=</span><span class="s">&quot;def3&quot;</span><span class="p">)</span> <span class="n">String</span> <span class="n">param3</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">CommonParameters</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CommonParameters</span><span class="p">();</span>
    <span class="n">params</span><span class="p">.</span><span class="na">setParam1</span><span class="p">(</span><span class="n">param1</span><span class="p">);</span>
    <span class="n">params</span><span class="p">.</span><span class="na">setParam2</span><span class="p">(</span><span class="n">param2</span><span class="p">);</span>
    <span class="n">params</span><span class="p">.</span><span class="na">setParam3</span><span class="p">(</span><span class="n">param3</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">params</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Controller</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;home&quot;</span><span class="p">)</span>
<span class="hll"><span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="p">(</span><span class="nd">@ModelAttribute</span> <span class="n">CommonParameters</span> <span class="n">commonParams</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// (2)</span>
</span>    <span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;param1 : {}&quot;</span><span class="p">,</span><span class="n">commonParams</span><span class="p">.</span><span class="na">getParam1</span><span class="p">());</span>
    <span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;param2 : {}&quot;</span><span class="p">,</span><span class="n">commonParams</span><span class="p">.</span><span class="na">getParam2</span><span class="p">());</span>
    <span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;param3 : {}&quot;</span><span class="p">,</span><span class="n">commonParams</span><span class="p">.</span><span class="na">getParam3</span><span class="p">());</span>
    <span class="c1">// ...</span>
    <span class="k">return</span> <span class="s">&quot;sample/home&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code>メソッドを実装する。全てのControllerに対して<code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code>メソッドが適用される。</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code>メソッドで生成されたオブジェクトが渡る。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="id75">
<h2><a class="toc-backref" href="#id160">3.4.5. 二重送信防止について</a><a class="headerlink" href="#id75" title="Permalink to this headline">¶</a></h2>
<p>送信ボタンの複数回押下や完了画面の再読み込み(F5ボタンによる再読み込み)などで、 同じ処理が複数回実行されてしまう可能性があるため、二重送信を防止するための対策は必ず行うこと。</p>
<p>対策を行わない場合に発生する問題点や対策方法の詳細は、 <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/DoubleSubmitProtection.html"><span class="doc">二重送信防止</span></a> を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id76">
<h2><a class="toc-backref" href="#id161">3.4.6. セッションの使用について</a><a class="headerlink" href="#id76" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">Spring MVCのデフォルトの動作では、モデル（フォームオブジェクトやドメインオブジェクトなど）はセッションには格納されない。</div>
<div class="line">セッションに格納したい場合は、<code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code>アノテーションをControllerクラスに付与する必要がある。</div>
<div class="line">入力フォームが複数の画面にわかれている場合は、 一連の画面遷移を行うリクエストでモデル（フォームオブジェクトやドメインオブジェクトなど）を共有できるため、 <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code>アノテーションの利用を検討すること。</div>
<div class="line">ただし、セッションを使用する際の注意点があるので、そちらを確認した上で<code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code>アノテーションの利用有無を判断すること。</div>
</div>
<p>セッションの利用指針及びセッション使用時の実装方法の詳細は、 <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/SessionManagement.html"><span class="doc">セッション管理</span></a> を参照されたい。</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="CreateProject.html" title="3.5. 開発プロジェクトのビルド"
             >next</a> |</li>
        <li class="right" >
          <a href="InfrastructureLayer.html" title="3.3. インフラストラクチャ層の実装"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.7.0.SP1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >3. アプリケーション開発</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
      © Copyright 2013, NTT DATA Corporation. © Copyright 2013, NTT Corporation.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.3.Theme is <a href="http://github.com/vimalkvn/solar-theme">Solar</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>
