<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>10.2.2. Implementation of test by layer &#8212; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.4.1.RELEASE documentation</title>
    <link rel="stylesheet" href="../../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '5.4.1.RELEASE',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="10.2.3. Implementation of tests by functions" href="ImplementsOfTestByFunction.html" />
    <link rel="prev" title="10.2.1. Preparation for test" href="PreparationForTest.html" /><script src="../../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../../_static/solarized-dark.css" rel="stylesheet">
<link href="../../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ImplementsOfTestByFunction.html" title="10.2.3. Implementation of tests by functions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="PreparationForTest.html" title="10.2.1. Preparation for test"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.4.1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >10. Unit test</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">10.2. Implementation of unit test</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><br/><img src="../../_static/logo_color.png" alt="TERASOLUNA"/><br/><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>

  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">10.2.2. Implementation of test by layer</a><ul>
<li><a class="reference internal" href="#unit-test-of-infrastructure-layer">10.2.2.1. Unit test of infrastructure layer</a><ul>
<li><a class="reference internal" href="#unit-test-of-repository">10.2.2.1.1. Unit test of Repository</a><ul>
<li><a class="reference internal" href="#test-which-only-use-spring-test-standard-function">10.2.2.1.1.1. Test which only use Spring Test standard function</a></li>
<li><a class="reference internal" href="#test-which-use-spring-test-dbunit">10.2.2.1.1.2. Test which use Spring Test DBUnit</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#unit-test-of-domain-layer">10.2.2.2. Unit test of domain layer</a><ul>
<li><a class="reference internal" href="#unit-test-of-service">10.2.2.2.1. Unit test of Service</a><ul>
<li><a class="reference internal" href="#test-using-dependent-class">10.2.2.2.1.1. Test using dependent class</a></li>
<li><a class="reference internal" href="#test-using-mock">10.2.2.2.1.2. Test using mock</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#unit-test-of-application-layer">10.2.2.3. Unit test of application layer</a><ul>
<li><a class="reference internal" href="#unit-test-target-for-application-layer">10.2.2.3.1. Unit test target for application layer</a></li>
<li><a class="reference internal" href="#unit-test-of-controller">10.2.2.3.2. Unit test of Controller</a><ul>
<li><a class="reference internal" href="#test-using-standalonesetup">10.2.2.3.2.1. Test using StandaloneSetup</a></li>
<li><a class="reference internal" href="#test-by-using-webappcontextsetup">10.2.2.3.2.2. Test by using WebAppContextSetup</a></li>
<li><a class="reference internal" href="#implementsoftestbylayertestingcontrollerwithmockito">10.2.2.3.2.3. Test using mock</a></li>
</ul>
</li>
<li><a class="reference internal" href="#unit-test-of-helper">10.2.2.3.3. Unit test of Helper</a></li>
</ul>
</li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="PreparationForTest.html"
                        title="previous chapter">10.2.1. Preparation for test</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ImplementsOfTestByFunction.html"
                        title="next chapter">10.2.3. Implementation of tests by functions</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/UnitTest/ImplementsOfUnitTest/ImplementsOfTestByLayer.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="implementation-of-test-by-layer">
<span id="implementsoftestbylayer"></span><h1>10.2.2. Implementation of test by layer<a class="headerlink" href="#implementation-of-test-by-layer" title="Permalink to this headline">¶</a></h1>
<div class="admonition caution">
  <p class="first admonition-title">Caution</p>
  <p><strong>This version is already obsolete</strong>. Please check <a href="http://terasolunaorg.github.io/guideline/">the latest guideline</a>.</p>
</div>
<div class="contents local topic" id="index">
<p class="topic-title first">Index</p>
<ul class="simple">
<li><a class="reference internal" href="#unit-test-of-infrastructure-layer" id="id2">Unit test of infrastructure layer</a><ul>
<li><a class="reference internal" href="#unit-test-of-repository" id="id3">Unit test of Repository</a><ul>
<li><a class="reference internal" href="#test-which-only-use-spring-test-standard-function" id="id4">Test which only use Spring Test standard function</a></li>
<li><a class="reference internal" href="#test-which-use-spring-test-dbunit" id="id5">Test which use Spring Test DBUnit</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#unit-test-of-domain-layer" id="id6">Unit test of domain layer</a><ul>
<li><a class="reference internal" href="#unit-test-of-service" id="id7">Unit test of Service</a><ul>
<li><a class="reference internal" href="#test-using-dependent-class" id="id8">Test using dependent class</a></li>
<li><a class="reference internal" href="#test-using-mock" id="id9">Test using mock</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#unit-test-of-application-layer" id="id10">Unit test of application layer</a><ul>
<li><a class="reference internal" href="#unit-test-target-for-application-layer" id="id11">Unit test target for application layer</a></li>
<li><a class="reference internal" href="#unit-test-of-controller" id="id12">Unit test of Controller</a><ul>
<li><a class="reference internal" href="#test-using-standalonesetup" id="id13">Test using StandaloneSetup</a></li>
<li><a class="reference internal" href="#test-by-using-webappcontextsetup" id="id14">Test by using WebAppContextSetup</a></li>
<li><a class="reference internal" href="#implementsoftestbylayertestingcontrollerwithmockito" id="id15">Test using mock</a></li>
</ul>
</li>
<li><a class="reference internal" href="#unit-test-of-helper" id="id16">Unit test of Helper</a></li>
</ul>
</li>
</ul>
</div>
<p>A list of unit test target classes for each layer, a test method, and a summary thereof are shown below.</p>
<p>Note that, the test method and the implementation given in this chapter is only an example, and the actual test method and implementation is to be considered in accordance with the test policy.</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="15%" />
<col width="25%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Layer</th>
<th class="head">Test method</th>
<th class="head">Summary</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Infrastructure layer</td>
<td><a class="reference internal" href="#implementsoftestbylayertestingrepositorywithspringtest"><span class="std std-ref">Test which only use Spring Test standard function</span></a></td>
<td>Standard function of Spring Test is used and a test to access data is performed.</td>
</tr>
<tr class="row-odd"><td>Infrastructure layer</td>
<td><a class="reference internal" href="#implementsoftestbylayertestingrepositorywithspringtestdbunit"><span class="std std-ref">Test which use Spring Test DBUnit</span></a></td>
<td>DBUnit and Spring Test DBUnit functions are used and a test to access data is performed.</td>
</tr>
<tr class="row-even"><td>Domain layer</td>
<td><a class="reference internal" href="#implementsoftestbylayertestingservicewithspringtest"><span class="std std-ref">Test using dependent class</span></a></td>
<td><code class="docutils literal"><span class="pre">Service</span></code> is injected by using Spring Test DI function, is combined with infrastructure layer and <code class="docutils literal"><span class="pre">Service</span></code> test is performed.</td>
</tr>
<tr class="row-odd"><td>Domain layer</td>
<td><a class="reference internal" href="#implementsoftestbylayertestingservicewithmockito"><span class="std std-ref">Test using mock</span></a></td>
<td>Mockito is used to mock dependent classes and <code class="docutils literal"><span class="pre">Service</span></code> test is performed.</td>
</tr>
<tr class="row-even"><td>Application layer</td>
<td><a class="reference internal" href="#implementsoftestbylayertestingcontrollerwithstandalonesetup"><span class="std std-ref">Test using StandaloneSetup</span></a></td>
<td><code class="docutils literal"><span class="pre">Controller</span></code> is injected by using Spring Test DI function, is combined with domain layer and infrastructure layer and <code class="docutils literal"><span class="pre">Controller</span></code> test is performed.</td>
</tr>
<tr class="row-odd"><td>Application layer</td>
<td><a class="reference internal" href="#implementsoftestbylayertestingcontrollerwithwebappcontextsetup"><span class="std std-ref">Test by using WebAppContextSetup</span></a></td>
<td>MockMvc of Spring Test is used to apply <code class="docutils literal"><span class="pre">spring-mvc.xml</span></code> and <code class="docutils literal"><span class="pre">applicationContext.xml</span></code> created in the operation and <code class="docutils literal"><span class="pre">Controller</span></code> test is performed.</td>
</tr>
<tr class="row-even"><td>Application layer</td>
<td><a class="reference internal" href="#implementsoftestbylayertestingcontrollerwithmockito"><span class="std std-ref">Test using mock</span></a></td>
<td>Mockito is used to mock dependent classes and <code class="docutils literal"><span class="pre">Controller</span></code> test is performed.</td>
</tr>
<tr class="row-odd"><td>Application layer</td>
<td><a class="reference internal" href="#implementsoftestbylayerunittestofhelper"><span class="std std-ref">Unit test of Helper</span></a></td>
<td><code class="docutils literal"><span class="pre">Helper</span></code> test is performed. For details of test method, refer test method of <code class="docutils literal"><span class="pre">Service</span></code>.</td>
</tr>
</tbody>
</table>
<div class="section" id="unit-test-of-infrastructure-layer">
<h2><a class="toc-backref" href="#id2">10.2.2.1. Unit test of infrastructure layer</a><a class="headerlink" href="#unit-test-of-infrastructure-layer" title="Permalink to this headline">¶</a></h2>
<p>This section explains about unit test of <a class="reference internal" href="../../Overview/ApplicationLayering.html#layerofinfrastructure"><span class="std std-ref">Infrastructure layer</span></a> of development guidelines.</p>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/ImplementsOfTestByLayerLayerOfTestTargetRepository.png"><img alt="../../_images/ImplementsOfTestByLayerLayerOfTestTargetRepository.png" src="../../_images/ImplementsOfTestByLayerLayerOfTestTargetRepository.png" style="width: 95%;" /></a>
</div>
<p>In infrastructure layer, the test to access data which uses MyBatis from Repository is performed.
For details of how to use MyBatis3, refer <a class="reference internal" href="../../ImplementationAtEachLayer/InfrastructureLayer.html#repository-mybatis3-label"><span class="std std-ref">Implementing Repository using MyBatis3</span></a>.</p>
<p>Since <code class="docutils literal"><span class="pre">RepositoryImpl</span></code> which is auto-generated by MyBatis runs on Spring DI container,actualBean definition and
<code class="docutils literal"><span class="pre">SpringJUnit4ClassRunner</span></code> of Spring Test provided by Spring DI function are used in the test.
For details of Spring Test, refer <a class="reference internal" href="UsageOfLibraryForTest.html#usageoflibraryfortestspringtestoverview"><span class="std std-ref">Spring Test</span></a>.</p>
<p>Following two methods can be listed as data verification methods after test execution.
The method to be used should be determined in accordance with the business requirements given separately.</p>
<ul class="simple">
<li>Fetch database status after test execution by using SELECT statement and verify the same.</li>
<li>Validate by using DBUnit and Spring Test DBUnit.</li>
</ul>
<p>This section explains a case wherein <code class="docutils literal"><span class="pre">JdbcTemplate</span></code> is used as a verification method using SELECT statement.
<code class="docutils literal"><span class="pre">JdbcTemplate</span></code> is a core class of Spring JDBC support.In JDBC API, it is necessary to acquire connection from
data source, create <code class="docutils literal"><span class="pre">PreparedStatement</span></code>, analyze <code class="docutils literal"><span class="pre">ResultSet</span></code> and release the connection, however,when
<code class="docutils literal"><span class="pre">JdbcTemplate</span></code> is used, many of these processes are concealed and data access can be performed more easily.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In <a class="reference internal" href="../../Overview/ApplicationLayering.html#applicationlayering"><span class="std std-ref">Application Layering</span></a>, <code class="docutils literal"><span class="pre">Repository</span></code> interface is a deliverable of domain layer, however,
it is introduced here as a unit test target of infrastructure layer. It is recommended to check on the domain
layer as well that the interface with <code class="docutils literal"><span class="pre">Service</span></code> is correct.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="unit-test-of-repository">
<span id="implementsoftestbylayerunittestofrepository"></span><h3><a class="toc-backref" href="#id3">10.2.2.1.1. Unit test of Repository</a><a class="headerlink" href="#unit-test-of-repository" title="Permalink to this headline">¶</a></h3>
<p>This section explains implementation method for unit test of <code class="docutils literal"><span class="pre">Repository</span></code> given below.</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Test method</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="#implementsoftestbylayertestingrepositorywithspringtest"><span class="std std-ref">Test which only use Spring Test standard function</span></a></td>
<td>Use <code class="docutils literal"><span class="pre">JdbcTemplate</span></code> to verify test results.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#implementsoftestbylayertestingrepositorywithspringtestdbunit"><span class="std std-ref">Test which use Spring Test DBUnit</span></a></td>
<td>Use functions of DBUnit and Spring Test DBUnit to verify test results.</td>
</tr>
</tbody>
</table>
<p>Here, explanation is given using the test for following deliverables as an example.
Note that, for details of Repository implementation, refer <a class="reference internal" href="../../ImplementationAtEachLayer/InfrastructureLayer.html#repository-mybatis3-label"><span class="std std-ref">Implementing Repository using MyBatis3</span></a>.</p>
<ul class="simple">
<li>Update process (<code class="docutils literal"><span class="pre">updateMemberLogin</span></code>method) of <code class="docutils literal"><span class="pre">Repository</span></code> interface (<code class="docutils literal"><span class="pre">MemberRepository</span></code>)</li>
<li>Mapping file (<code class="docutils literal"><span class="pre">MemberRepository.xml</span></code>)</li>
</ul>
<p>Implementation example for test is shown below.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">MemberRepository.java</span></code></li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberRepository</span> <span class="o">{</span>

    <span class="kt">int</span> <span class="nf">updateMemberLogin</span><span class="o">(</span><span class="n">Member</span> <span class="n">member</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">MemberRepository.xml</span></code></li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.member.MemberRepository&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;update</span> <span class="na">id=</span><span class="s">&quot;updateMemberLogin&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;Member&quot;</span><span class="nt">&gt;</span>
    UPDATE member_login SET
        last_password = password,
        password = #{memberLogin.password}
    WHERE
        customer_no = #{membershipNumber}
  <span class="nt">&lt;/update&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="test-which-only-use-spring-test-standard-function">
<span id="implementsoftestbylayertestingrepositorywithspringtest"></span><h4><a class="toc-backref" href="#id4">10.2.2.1.1.1. Test which only use Spring Test standard function</a><a class="headerlink" href="#test-which-only-use-spring-test-standard-function" title="Permalink to this headline">¶</a></h4>
<p>Files to be created for unit test of <code class="docutils literal"><span class="pre">Repository</span></code> which use Spring Test are shown below.
Further, for setup method of database, refer <a class="reference internal" href="PreparationForTest.html#preparationfortestdatasetupwithspringtest"><span class="std std-ref">Schema and test data setup (in case of a test when only Spring Test standard function is used)</span></a> .
Also, for setup files used while carrying out unit test by using Spring Test, refer <a class="reference internal" href="PreparationForTest.html#preparationfortestmakesettingfileforspringtest"><span class="std std-ref">Setting file used in the implementation example</span></a>.</p>
<div class="figure">
<img alt="../../_images/ImplementsOfTestByLayerRepositorySpringTestItems.png" src="../../_images/ImplementsOfTestByLayerRepositorySpringTestItems.png" />
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Names of the files to be created</th>
<th class="head">Explanation</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">MemberRepositoryTest.java</span></code></td>
<td>Test class of <code class="docutils literal"><span class="pre">MemberRepository.java</span></code>.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">test-context.xml</span></code></td>
<td>Setup files supplementing setup required for carrying out unit test by using Spring Test.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">setupMemberLogin.sql</span></code></td>
<td>SQL file to set data of database used in unit test.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Creation units of SQL file to be used in unit test</strong></p>
<p class="last">Here, 1 SQL is created for 1 test method. Actual creation units must be considered appropriately
depending on test policy and details.
Note that, if SQL file path is omitted in <code class="docutils literal"><span class="pre">&#64;Sql</span></code>, SQL files are searched based on specified locations of <code class="docutils literal"><span class="pre">&#64;Sql</span></code>.
For details, refer <a class="reference internal" href="PreparationForTest.html#preparationfortestnoteomittedsqlfilepath"><span class="std std-ref">Omitting SQL file path of &#64;Sql</span></a>.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>How to create a test class of <code class="docutils literal"><span class="pre">Repository</span></code> while using Spring Test is explained.</p>
<p>Setup files used for testing by using data access are shown below.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">sample-infra.xml</span></code></li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&quot;classpath:/META-INF/spring/sample-env.xml&quot;</span> <span class="nt">/&gt;</span>

<span class="c">&lt;!-- define the SqlSessionFactory --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;sqlSessionFactory&quot;</span> <span class="na">class=</span><span class="s">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;configLocation&quot;</span> <span class="na">value=</span><span class="s">&quot;classpath:/META-INF/mybatis/mybatis-config.xml&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="c">&lt;!-- scan for Mappers --&gt;</span>
<span class="nt">&lt;mybatis:scan</span> <span class="na">base-package=</span><span class="s">&quot;com.example.domain.repository&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">sample-env.xml</span></code></li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span>  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;realDataSource&quot;</span> <span class="na">class=</span><span class="s">&quot;org.apache.commons.dbcp2.BasicDataSource&quot;</span> <span class="na">destroy-method=</span><span class="s">&quot;close&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;driverClassName&quot;</span> <span class="na">value=</span><span class="s">&quot;org.postgresql.Driver&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;url&quot;</span> <span class="na">value=</span><span class="s">&quot;jdbc:postgresql://localhost:5432/sample&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span> <span class="na">value=</span><span class="s">&quot;sample&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">value=</span><span class="s">&quot;xxxx&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultAutoCommit&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxTotal&quot;</span> <span class="na">value=</span><span class="s">&quot;96&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxIdle&quot;</span> <span class="na">value=</span><span class="s">&quot;16&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;minIdle&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxWaitMillis&quot;</span> <span class="na">value=</span><span class="s">&quot;60000&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/bean&gt;</span>

  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">class=</span><span class="s">&quot;net.sf.log4jdbc.Log4jdbcProxyDataSource&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">ref=</span><span class="s">&quot;realDataSource&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/bean&gt;</span>

  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;transactionManager&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;dateFactory&quot;</span> <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.date.jodatime.DefaultJodaTimeDateFactory&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>How to create a test of <code class="docutils literal"><span class="pre">Repository</span></code> which use Spring Test is explained.
Here, it is assumed that schema for test has already been created, <code class="docutils literal"><span class="pre">MemberLogin</span></code> table is set by using
<code class="docutils literal"><span class="pre">&#64;Sql</span></code> annotation, password of <code class="docutils literal"><span class="pre">MemberLogin</span></code> “ABCDE” is updated to new password “FGHIJ”,
<code class="docutils literal"><span class="pre">MemberLogin</span></code> table is fetched after update and verified.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">MemberRepositoryTest.java</span></code></li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import static</span> <span class="nn">org.hamcrest.CoreMatchers.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.junit.Assert.*</span><span class="o">;</span>

<span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ContextConfiguration</span><span class="o">(</span><span class="n">locations</span> <span class="o">=</span> <span class="o">{</span>
        <span class="s">&quot;classpath:META-INF/spring/sample-infra.xml&quot;</span><span class="o">,</span>   <span class="c1">//(1)</span>
        <span class="s">&quot;classpath:META-INF/spring/test-context.xml&quot;</span> <span class="o">})</span> <span class="c1">//(1)</span>
<span class="nd">@Transactional</span> <span class="c1">// (2)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberRepositoryTest</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">MemberRepository</span> <span class="n">target</span><span class="o">;</span> <span class="c1">// (3)</span>

    <span class="nd">@Inject</span>
    <span class="n">JdbcTemplate</span> <span class="n">jdbctemplate</span><span class="o">;</span> <span class="c1">// (4)</span>

    <span class="nd">@Test</span>
    <span class="nd">@Sql</span><span class="o">(</span><span class="n">scripts</span> <span class="o">=</span> <span class="s">&quot;classpath:META-INF/sql/setupMemberLogin.sql&quot;</span><span class="o">,</span> <span class="n">config</span> <span class="o">=</span> <span class="nd">@SqlConfig</span><span class="o">(</span><span class="n">encoding</span> <span class="o">=</span> <span class="s">&quot;utf-8&quot;</span><span class="o">))</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testUpdateMemberLogin</span><span class="o">()</span> <span class="o">{</span>

        <span class="c1">// (5)</span>
        <span class="c1">// setup test data</span>
        <span class="n">MemberLogin</span> <span class="n">memberLogin</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MemberLogin</span><span class="o">();</span>
        <span class="n">memberLogin</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&quot;FGHIJ&quot;</span><span class="o">);</span>
        <span class="n">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Member</span><span class="o">();</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setMembershipNumber</span><span class="o">(</span><span class="s">&quot;0000000001&quot;</span><span class="o">);</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setMemberLogin</span><span class="o">(</span><span class="n">memberLogin</span><span class="o">);</span>

        <span class="c1">// (6)</span>
        <span class="c1">// run the test</span>
        <span class="kt">int</span> <span class="n">updateCounts</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="na">updateMemberLogin</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>

        <span class="c1">// (7)</span>
        <span class="n">MemberLogin</span> <span class="n">updateMemberLogin</span> <span class="o">=</span> <span class="n">getMemberLogin</span><span class="o">(</span><span class="s">&quot;0000000001&quot;</span><span class="o">);</span>

        <span class="c1">// (8)</span>
        <span class="c1">// assertion</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">updateCounts</span><span class="o">,</span> <span class="n">is</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">updateMemberLogin</span><span class="o">.</span><span class="na">getPassword</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="s">&quot;FGHIJ&quot;</span><span class="o">));</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">updateMemberLogin</span><span class="o">.</span><span class="na">getLastPassword</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="s">&quot;ABCDE&quot;</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">Member</span> <span class="nf">getMemberLogin</span><span class="o">(</span><span class="n">String</span> <span class="n">customerNo</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">MemberLogin</span> <span class="n">memberLogin</span> <span class="o">=</span> <span class="o">(</span><span class="n">MemberLogin</span><span class="o">)</span> <span class="n">jdbctemplate</span><span class="o">.</span><span class="na">queryForObject</span><span class="o">(</span>
                <span class="s">&quot;SELECT * FROM member_login WHERE customer_no=?&quot;</span><span class="o">,</span>
                <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span> <span class="o">{</span><span class="n">customerNo</span> <span class="o">},</span>
                <span class="k">new</span> <span class="n">RowMapper</span><span class="o">&lt;</span><span class="n">MemberLogin</span><span class="o">&gt;()</span> <span class="o">{</span>

                    <span class="kd">public</span> <span class="n">MemberLogin</span> <span class="nf">mapRow</span><span class="o">(</span><span class="n">ResultSet</span> <span class="n">rs</span><span class="o">,</span>
                                <span class="kt">int</span> <span class="n">rowNum</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>

                            <span class="n">MemberLogin</span> <span class="n">mapMemberLogin</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MemberLogin</span><span class="o">();</span>

                            <span class="n">mapMemberLogin</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span>
                                    <span class="s">&quot;password&quot;</span><span class="o">));</span>
                            <span class="n">mapMemberLogin</span><span class="o">.</span><span class="na">setLastPassword</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span>
                                    <span class="s">&quot;last_password&quot;</span><span class="o">));</span>
                            <span class="n">mapMemberLogin</span><span class="o">.</span><span class="na">setLoginDateTime</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getDate</span><span class="o">(</span>
                                    <span class="s">&quot;login_date_time&quot;</span><span class="o">));</span>
                            <span class="n">mapMemberLogin</span><span class="o">.</span><span class="na">setLoginFlg</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getBoolean</span><span class="o">(</span>
                                    <span class="s">&quot;login_flg&quot;</span><span class="o">));</span>

                            <span class="k">return</span> <span class="n">mapMemberLogin</span><span class="o">;</span>
                    <span class="o">}</span>
                <span class="o">});</span>

        <span class="k">return</span> <span class="n">memberLogin</span><span class="o">;</span>
    <span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Read <code class="docutils literal"><span class="pre">sample-infra.xml</span></code> and <code class="docutils literal"><span class="pre">test-context.xml</span></code> which retain applications required for running
<code class="docutils literal"><span class="pre">MemberRepository</span></code> class.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When <code class="docutils literal"><span class="pre">&#64;Transactional</span></code> annotation is assigned, start to end of test execution is considered as one
 transaction and is rolled back by default after the completion of test. If the annotation is defined at
the class level, <code class="docutils literal"><span class="pre">&#64;Transactional</span></code> annotation is enabled for all the test methods.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Inject <code class="docutils literal"><span class="pre">MemberRepository</span></code> class considered as a test target.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Inject <code class="docutils literal"><span class="pre">JdbcTemplate</span></code> class.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create test data for executing a method for testing.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Execute the method for testing.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch information of database after update.
By using <code class="docutils literal"><span class="pre">org.springframework.jdbc.core.RowMapper&lt;T&gt;</span></code>, <code class="docutils literal"><span class="pre">ResultSet</span></code> fetched from database can be
mapped to a specific POJO class.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Verify update count and update results.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>A method wherein transaction is not rolled back at the time of testing</strong></p>
<p class="last">When <code class="docutils literal"><span class="pre">&#64;Transactional</span></code>annotation is specified in a test case, it is rolled back after execution of test
method by default.When you do not want to roll back for using the test data in subsequent tests,
<code class="docutils literal"><span class="pre">&#64;Rollback(false)</span></code> annotation or <code class="docutils literal"><span class="pre">&#64;Commit</span></code> annotation is specified besides <code class="docutils literal"><span class="pre">&#64;Transactional</span></code>annotation and transaction at the time of test can be committed.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Regarding &#64;TransactionConfiguration for Spring Framework 4.2 and subsequent versions</strong></p>
<p class="last">Since Spring Framework 4.2, you can set <code class="docutils literal"><span class="pre">&#64;Rollback</span></code> or <code class="docutils literal"><span class="pre">&#64;Commit</span></code> at the class level.
With this, <code class="docutils literal"><span class="pre">&#64;TransactionConfiguration</span></code> has been deprecated. However, in the earlier versions of Spring Framework
4.2, when the rollback is to be performed at the class level, <code class="docutils literal"><span class="pre">&#64;TransactionConfiguration(defaultRollback</span> <span class="pre">=</span> <span class="pre">true)</span></code>should be set.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="test-which-use-spring-test-dbunit">
<span id="implementsoftestbylayertestingrepositorywithspringtestdbunit"></span><h4><a class="toc-backref" href="#id5">10.2.2.1.1.2. Test which use Spring Test DBUnit</a><a class="headerlink" href="#test-which-use-spring-test-dbunit" title="Permalink to this headline">¶</a></h4>
<p>Implementation method of unit test of <code class="docutils literal"><span class="pre">Repository</span></code> while using DBUnit in data access is explained.
Note that, an example wherein an Excel format file (.xlsx) is used in data definition file of DBUnit is explained here.
For setup method of data definition file and database, refer <a class="reference internal" href="PreparationForTest.html#preparationfortestdatasetupwithdbunit"><span class="std std-ref">Test data setup (In case of a test which use Spring Test DBUnit)</span></a>.</p>
<p>Further, for using Spring Test DBUnit functions together in DBUnit, it is necessary to register
<code class="docutils literal"><span class="pre">com.github.springtestdbunit.TransactionDbUnitTestExecutionListener</span></code> by using <code class="docutils literal"><span class="pre">&#64;TestExecutionListeners</span></code> annotation.
For registration method, refer <a class="reference internal" href="UsageOfLibraryForTest.html#usageoflibraryfortestregistrationoftestexecutionlistener"><span class="std std-ref">Registration of TestExecutionListener</span></a>.</p>
<p>Files to be created in unit test of <code class="docutils literal"><span class="pre">Repository</span></code> which use DBUnit are shown below.</p>
<div class="figure">
<img alt="../../_images/ImplementsOfTestByLayerRepositoryDbunitItems.png" src="../../_images/ImplementsOfTestByLayerRepositoryDbunitItems.png" />
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Names of files to be created</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">MemberRepositoryDbunitTest.java</span></code></td>
<td>Test class of <code class="docutils literal"><span class="pre">MemberRepository.java</span></code> (while linking with DBUnit)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">XlsDataSetLoader.java</span></code></td>
<td>Implementation class of <code class="docutils literal"><span class="pre">DataSetLoader</span></code> interface supporting Excel format.
For implementation method, refer <a class="reference internal" href="PreparationForTest.html#preparationfortestdatasetupwithdbunit"><span class="std std-ref">Test data setup (In case of a test which use Spring Test DBUnit)</span></a>.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">expected_testUpdateMemberLogin.xlsx</span></code></td>
<td>File for verification of expected results of test</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">setup_MemberLogin.xlsx</span></code></td>
<td>File for test data setup</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">test-context.xml</span></code></td>
<td>Setup file used while carrying out unit test by using Spring Test. Use the same setup file created by
<a class="reference internal" href="#implementsoftestbylayertestingrepositorywithspringtest"><span class="std std-ref">Test which only use Spring Test standard function</span></a>.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Creation unit of Excel file used in unit test</strong></p>
<p class="last">Here, a file for data setup and a file for verifying expected results are respectively created in 1 test method.
Test policy and details should be appropriately reviewed for the actual creation unit.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>How to create a test class of <code class="docutils literal"><span class="pre">Repository</span></code> while using DBUnit is explained.</p>
<p>Here, it is assumed that the schema for test is already created. By using <code class="docutils literal"><span class="pre">&#64;DatabaseSetup</span></code> annotation,
<code class="docutils literal"><span class="pre">MemberLogin</span></code> table is set, <code class="docutils literal"><span class="pre">MemberLogin</span></code> password is updated from “ABCDE” to new password “FGHIJ”
and verified by using <code class="docutils literal"><span class="pre">&#64;ExpectedDatabase</span></code> annotation.</p>
<p>How to create a test method of <code class="docutils literal"><span class="pre">Repository</span></code> by using Spring Test and DBUnit is shown below.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">MemberRepositoryDbunitTest.java</span></code></li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import static</span> <span class="nn">org.hamcrest.CoreMatchers.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.junit.Assert.*</span><span class="o">;</span>

<span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ContextConfiguration</span><span class="o">(</span><span class="n">locations</span> <span class="o">=</span> <span class="o">{</span>
        <span class="s">&quot;classpath:META-INF/spring/sample-infra.xml&quot;</span><span class="o">,</span>   <span class="c1">// (1)</span>
        <span class="s">&quot;classpath:META-INF/spring/test-context.xml&quot;</span> <span class="o">})</span> <span class="c1">// (1)</span>
<span class="nd">@TestExecutionListeners</span><span class="o">({</span>
        <span class="n">DirtiesContextBeforeModesTestExecutionListener</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
        <span class="n">DependencyInjectionTestExecutionListener</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
        <span class="n">DirtiesContextTestExecutionListener</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
        <span class="n">TransactionDbUnitTestExecutionListener</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
<span class="nd">@Transactional</span>
<span class="nd">@DbUnitConfiguration</span><span class="o">(</span><span class="n">dataSetLoader</span> <span class="o">=</span> <span class="n">XlsDataSetLoader</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberRepositoryDbunitTest</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">MemberRepository</span> <span class="n">target</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="nd">@DatabaseSetup</span><span class="o">(</span><span class="s">&quot;classpath:META-INF/dbunit/setup_MemberLogin.xlsx&quot;</span><span class="o">)</span>
    <span class="nd">@ExpectedDatabase</span><span class="o">(</span> <span class="c1">// (2)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s">&quot;classpath:META-INF/dbunit/expected_testUpdateMemberLogin.xlsx&quot;</span><span class="o">,</span>
            <span class="n">assertionMode</span> <span class="o">=</span> <span class="n">DatabaseAssertionMode</span><span class="o">.</span><span class="na">NON_STRICT_UNORDERED</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testUpdate</span><span class="o">()</span> <span class="o">{</span>

        <span class="c1">// setup</span>
        <span class="n">MemberLogin</span> <span class="n">memberLogin</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MemberLogin</span><span class="o">();</span>
        <span class="n">memberLogin</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&quot;FGHIJ&quot;</span><span class="o">);</span>
        <span class="n">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Member</span><span class="o">();</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setMembershipNumber</span><span class="o">(</span><span class="s">&quot;0000000001&quot;</span><span class="o">);</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setMemberLogin</span><span class="o">(</span><span class="n">memberLogin</span><span class="o">);</span>

        <span class="c1">// run the test</span>
        <span class="kt">int</span> <span class="n">updateCounts</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="na">updateMemberLogin</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>

        <span class="c1">// assertion</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">updateCounts</span><span class="o">,</span> <span class="n">is</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Read setup file (<code class="docutils literal"><span class="pre">sample-infra.xml</span></code> retained by application and <code class="docutils literal"><span class="pre">test-context.xml</span></code> supplementing
it) required for running <code class="docutils literal"><span class="pre">MemberRepository</span></code> class.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">After test method execution, DBUnit automatically compares and verifies the table and expected result data
file, by specifying file for verifying expected test results in <code class="docutils literal"><span class="pre">&#64;ExpectedDatabase</span></code> annotation.</div>
<div class="line">Similar to <code class="docutils literal"><span class="pre">&#64;DatabaseSetup</span></code> annotation, it can be assigned at class level and method level.</div>
<div class="line">The file format is same as the test setup data file. Following values can be set in
<code class="docutils literal"><span class="pre">assertionMode</span></code> attribute.</div>
</div>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">DEFAULT</span></code>(or not specified): Compare all the tables and columns.</li>
<li><code class="docutils literal"><span class="pre">NON_STRICT</span></code>: If a table or column that does not exist in the expected result data file exists in the actual database, it is ignored.</li>
<li><code class="docutils literal"><span class="pre">NON_STRICT_UNORDERED</span></code>: Further to <code class="docutils literal"><span class="pre">NON_STRICT</span></code> mode, sequence of lines is also ignored.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Table with external key constraints</strong></p>
<p class="last">When database is initialized by using DBUnit for the table with external key constraint, it must be noted that
sequence of dataset must be specified in order to maintain data integrity since an error occurs depending on the reference conditions.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Sequence verification method</strong></p>
<p>Sequence consists of a feature wherein even if a transaction is rolled back, advanced value does not return.
Therefore, when a record consisting of columns numbered from a sequence is to be verified by DBUnit, one of the following measures must be employed.</p>
<ul class="last simple">
<li>Columns numbered from the sequence are excluded from verification</li>
<li>Execute SQL which explicitly initializes the sequence and initialize it prior to test implementation</li>
<li>Verify sequence value at the time of test execution and validate the verified value as a standard value</li>
</ul>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="unit-test-of-domain-layer">
<h2><a class="toc-backref" href="#id6">10.2.2.2. Unit test of domain layer</a><a class="headerlink" href="#unit-test-of-domain-layer" title="Permalink to this headline">¶</a></h2>
<p>This section explains about unit test of <a class="reference internal" href="../../Overview/ApplicationLayering.html#layerofdomain"><span class="std std-ref">Domain layer</span></a> of development guideline.</p>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/ImplementsOfTestByLayerLayerOfTestTargetDomain.png"><img alt="../../_images/ImplementsOfTestByLayerLayerOfTestTargetDomain.png" src="../../_images/ImplementsOfTestByLayerLayerOfTestTargetDomain.png" style="width: 95%;" /></a>
</div>
<p>Business logic of <code class="docutils literal"><span class="pre">Service</span></code>and <code class="docutils literal"><span class="pre">&#64;Transactional</span></code>test are carried out in domain layer.
When the test is to be performed by injecting  <code class="docutils literal"><span class="pre">Service</span></code>and joining infrastructure layers, similar to test implementation method of <code class="docutils literal"><span class="pre">Repository</span></code>, test is performed by using Bean definition, and <code class="docutils literal"><span class="pre">SpringJUnit4ClassRunner</span></code> of Spring Test.
For details of Spring Test, refer <a class="reference internal" href="UsageOfLibraryForTest.html#usageoflibraryfortestspringtestoverview"><span class="std std-ref">Spring Test</span></a>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="unit-test-of-service">
<span id="implementsoftestbylayerunittestofservice"></span><h3><a class="toc-backref" href="#id7">10.2.2.2.1. Unit test of Service</a><a class="headerlink" href="#unit-test-of-service" title="Permalink to this headline">¶</a></h3>
<p>This section explains how to implement a test of <code class="docutils literal"><span class="pre">Service</span></code>as below.</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Test method</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="#implementsoftestbylayertestingservicewithspringtest"><span class="std std-ref">Test using dependent class</span></a></td>
<td>Test is performed by injecting <code class="docutils literal"><span class="pre">Service</span></code>and joining infrastructure layers.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#implementsoftestbylayertestingservicewithmockito"><span class="std std-ref">Test using mock</span></a></td>
<td>Test is performed by mocking all the classes on which implementation class of <code class="docutils literal"><span class="pre">Service</span></code>depends.</td>
</tr>
</tbody>
</table>
<p>Explanation is given by using the test for following deliverables as an example.
Further, for details of Service implementation, refer <a class="reference internal" href="../../ImplementationAtEachLayer/DomainLayer.html#service-label"><span class="std std-ref">Implementation of Service</span></a>.</p>
<ul class="simple">
<li>Implementation class of Service (<code class="docutils literal"><span class="pre">TicketReserveServiceImpl</span></code>)</li>
</ul>
<p>An implementation example for test is shown below.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">TicketReserveServiceImpl.java</span></code></li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Service</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TicketReserveServiceImpl</span> <span class="kd">implements</span> <span class="n">TicketReserveService</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">ReservationRepository</span> <span class="n">reservationRepository</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">TicketReserveDto</span> <span class="nf">registerReservation</span><span class="o">(</span><span class="n">Reservation</span> <span class="n">reservation</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">BusinessException</span> <span class="o">{</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">ReserveFlight</span><span class="o">&gt;</span> <span class="n">reserveFlightList</span> <span class="o">=</span> <span class="n">reservation</span><span class="o">.</span><span class="na">getReserveFlightList</span><span class="o">();</span>

        <span class="c1">// repository access</span>
        <span class="kt">int</span> <span class="n">reservationInsertCount</span> <span class="o">=</span> <span class="n">reservationRepository</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">reservation</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">reservationInsertCount</span> <span class="o">!=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">SystemException</span><span class="o">(</span><span class="n">LogMessages</span><span class="o">.</span><span class="na">E_AR_A0_L9002</span><span class="o">.</span><span class="na">getCode</span><span class="o">(),</span>
                    <span class="n">LogMessages</span><span class="o">.</span><span class="na">E_AR_A0_L9002</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(</span><span class="n">reservationInsertCount</span><span class="o">,</span> <span class="mi">1</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="n">String</span> <span class="n">reserveNo</span> <span class="o">=</span> <span class="n">reservation</span><span class="o">.</span><span class="na">getReserveNo</span><span class="o">();</span>

        <span class="n">Date</span> <span class="n">paymentDate</span> <span class="o">=</span> <span class="n">reserveFlightList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">getFlight</span><span class="o">().</span><span class="na">getDepartureDate</span><span class="o">();</span>

        <span class="k">return</span> <span class="k">new</span> <span class="n">TicketReserveDto</span><span class="o">(</span><span class="n">reserveNo</span><span class="o">,</span> <span class="n">paymentDate</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Mapping file used for test is shown below.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">ReservationRepository.xml</span></code></li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.reservation.ReservationRepository&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&quot;insert&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;Reservation&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;selectKey</span> <span class="na">keyProperty=</span><span class="s">&quot;reserveNo&quot;</span> <span class="na">resultType=</span><span class="s">&quot;String&quot;</span> <span class="na">order=</span><span class="s">&quot;BEFORE&quot;</span><span class="nt">&gt;</span>
      SELECT TO_CHAR(NEXTVAL(&#39;sq_reservation_1&#39;), &#39;FM0999999999&#39;)
    <span class="nt">&lt;/selectKey&gt;</span>
    INSERT INTO reservation
    (
        reserve_no,
        reserve_date,
        total_fare,
        rep_family_name,
        rep_given_name,
        rep_age,
        rep_gender,
        rep_tel,
        rep_mail,
        rep_customer_no
    )
    VALUES
    (
        #{reserveNo},
        #{reserveDate},
        #{totalFare},
        #{repFamilyName},
        #{repGivenName},
        #{repAge},
        #{repGender.code},
        #{repTel},
        #{repMail},
        NULLIF(#{repMember.membershipNumber}, &#39;&#39;)
    )
  <span class="nt">&lt;/insert&gt;</span>
</pre></div>
</div>
<div class="section" id="test-using-dependent-class">
<span id="implementsoftestbylayertestingservicewithspringtest"></span><h4><a class="toc-backref" href="#id8">10.2.2.2.1.1. Test using dependent class</a><a class="headerlink" href="#test-using-dependent-class" title="Permalink to this headline">¶</a></h4>
<p>Test is performed by injecting <code class="docutils literal"><span class="pre">Service</span></code> and joining infrastructure layers. Files created for <code class="docutils literal"><span class="pre">Service</span></code> test
are shown below.</p>
<div class="figure">
<img alt="../../_images/ImplementsOfTestByLayerServiceSpringTestItems.png" src="../../_images/ImplementsOfTestByLayerServiceSpringTestItems.png" />
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Names of files to be created</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">TicketReserveServiceImplTest.java</span></code></td>
<td>Test class of <code class="docutils literal"><span class="pre">TicketReserveServiceImpl.java</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">test-context.xml</span></code></td>
<td>Use setup file defined in <a class="reference internal" href="PreparationForTest.html#preparationfortestmakesettingfileforspringtest"><span class="std std-ref">Setting file used in the implementation example</span></a>.</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>A test creation method is explained wherein the test is performed by injecting Service implementation class for test and joining infrastructure layers.</p>
<p>Setup files read at the time of testing are shown below.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">sample-domain.xml</span></code></li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&quot;com.example.domain&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;tx:annotation-driven</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&quot;classpath:META-INF/spring/sample-infra.xml&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&quot;classpath:META-INF/spring/sample-codelist.xml&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;resultMessagesLoggingInterceptor&quot;</span>
      <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.exception.ResultMessagesLoggingInterceptor&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionLogger&quot;</span> <span class="na">ref=</span><span class="s">&quot;exceptionLogger&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;aop:config&gt;</span>
  <span class="nt">&lt;aop:advisor</span> <span class="na">advice-ref=</span><span class="s">&quot;resultMessagesLoggingInterceptor&quot;</span>
    <span class="na">pointcut=</span><span class="s">&quot;@within(org.springframework.stereotype.Service)&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/aop:config&gt;</span>
</pre></div>
</div>
<p>Test implementation example is shown below.
Run <code class="docutils literal"><span class="pre">TicketReserveServiceImpl#registerReservation()</span></code>method for test and verify the return value.
Further, for how to verify database status, refer <a class="reference internal" href="#implementsoftestbylayerunittestofrepository"><span class="std std-ref">Unit test of Repository</span></a>.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">TicketReserveServiceImplTest.java</span></code></li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import static</span> <span class="nn">org.hamcrest.CoreMatchers.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.junit.Assert.*</span><span class="o">;</span>

<span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ContextConfiguration</span><span class="o">(</span><span class="n">locations</span> <span class="o">=</span> <span class="o">{</span>
        <span class="s">&quot;classpath:META-INF/spring/sample-domain.xml&quot;</span><span class="o">,</span> <span class="c1">// (1)</span>
        <span class="s">&quot;classpath:META-INF/spring/test-context.xml&quot;</span><span class="o">})</span> <span class="c1">// (1)</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TicketReserveServiceImplTest</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">TicketReserveService</span> <span class="n">target</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">JdbcTemplate</span> <span class="n">jdbcTemplate</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="nd">@Sql</span><span class="o">(</span><span class="n">statements</span> <span class="o">=</span> <span class="s">&quot;ALTER SEQUENCE sq_reservation_1 RESTART WITH 1&quot;</span><span class="o">)</span> <span class="c1">// (2)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testRegisterReservation</span><span class="o">()</span> <span class="o">{</span>

        <span class="c1">// setup</span>
        <span class="n">Reservation</span> <span class="n">inputReservation</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Reservation</span><span class="o">();</span>
        <span class="n">inputReservation</span><span class="o">.</span><span class="na">setTotalFare</span><span class="o">(</span><span class="mi">39200</span><span class="o">);</span>
        <span class="n">inputReservation</span><span class="o">.</span><span class="na">setReserveNo</span><span class="o">(</span><span class="s">&quot;0000000001&quot;</span><span class="o">);</span>
        <span class="c1">// omitted</span>

        <span class="c1">// run the test</span>
        <span class="n">TicketReserveDto</span> <span class="n">actTicketReserveDto</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="na">registerReservation</span><span class="o">(</span>
                <span class="n">reservation</span><span class="o">);</span>

        <span class="c1">// assertion</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">actTicketReserveDto</span><span class="o">.</span><span class="na">getReserveNo</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="s">&quot;0000000001&quot;</span><span class="o">));</span>
        <span class="c1">// omitted</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Read setup file (<code class="docutils literal"><span class="pre">sample-domain.xml</span></code> retained by application and <code class="docutils literal"><span class="pre">test-domain.xml</span></code> supplementing
it) required for running <code class="docutils literal"><span class="pre">TicketReserveServiceImpl</span></code>class.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">SQL statement can be directly specified by using <code class="docutils literal"><span class="pre">statements</span></code> attribute of <code class="docutils literal"><span class="pre">&#64;Sql</span></code>.
Here, the sequence is initialized prior to test method execution.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Transaction management at the time of testing</strong></p>
<p class="last">When <code class="docutils literal"><span class="pre">&#64;Transactional</span></code> annotation is assigned to a test case, steps from start of test execution till end becomes one transaction.
Hence, when <code class="docutils literal"><span class="pre">Service</span></code> class assigned with <code class="docutils literal"><span class="pre">&#64;Transactional</span></code> annotation is called from test case,
it must be noted that the transaction is inherited from the test case.
For example, when the transaction propagation method is default, (<code class="docutils literal"><span class="pre">REQUIRED</span></code>),test processes are executed
in the transactions started in test case and the timing of the commit and rollback is also considered at the end of the test.
For transaction propagation methods, refer <a class="reference internal" href="../../ImplementationAtEachLayer/DomainLayer.html#transaction-management-declare-transaction-info-label"><span class="std std-ref">Information required for “Declarative transaction management”</span></a>.</p>
</div>
</div>
<div class="section" id="test-using-mock">
<span id="implementsoftestbylayertestingservicewithmockito"></span><h4><a class="toc-backref" href="#id9">10.2.2.2.1.2. Test using mock</a><a class="headerlink" href="#test-using-mock" title="Permalink to this headline">¶</a></h4>
<p>Files to be created in unit test of <code class="docutils literal"><span class="pre">Service</span></code> which is done by mocking all the dependent classes of <code class="docutils literal"><span class="pre">Service</span></code> are shown below.</p>
<div class="figure">
<img alt="../../_images/ImplementsOfTestByLayerServiceMockItems.png" src="../../_images/ImplementsOfTestByLayerServiceMockItems.png" />
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Names of files to be created</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">TicketReserveServiceImplMockTest.java</span></code></td>
<td>Test class of <code class="docutils literal"><span class="pre">TicketReserveServiceImpl.java</span></code>(while using mock)</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>How to create a test method while mocking the class that depends on implementation class of <code class="docutils literal"><span class="pre">Service</span></code> for test.
Here, mocking is done for <code class="docutils literal"><span class="pre">ReservationRepository#insert()</span></code> method, the method for which the mocking is carried
out by <code class="docutils literal"><span class="pre">TicketReserveServiceImpl#registerReservation()</span></code> method is called and return value for testing is verified.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">TicketReserveServiceImplMockTest.java</span></code></li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import static</span> <span class="nn">org.hamcrest.CoreMatchers.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.junit.Assert.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.mockito.Mockito.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TicketReserveServiceImplMockTest</span> <span class="o">{</span>

    <span class="nd">@Rule</span> <span class="c1">// (1)</span>
    <span class="kd">public</span> <span class="n">MockitoRule</span> <span class="n">mockito</span> <span class="o">=</span> <span class="n">MockitoJUnit</span><span class="o">.</span><span class="na">rule</span><span class="o">();</span>

    <span class="nd">@Mock</span> <span class="c1">// (2)</span>
    <span class="n">ReservationRepository</span> <span class="n">reservationRepository</span><span class="o">;</span>

    <span class="nd">@InjectMocks</span> <span class="c1">// (3)</span>
    <span class="kd">private</span> <span class="n">TicketReserveServiceImpl</span> <span class="n">target</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testRegisterReservation</span><span class="o">()</span> <span class="o">{</span>

        <span class="c1">// setup</span>
        <span class="n">Reservation</span> <span class="n">inputReservation</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Reservation</span><span class="o">();</span>
        <span class="n">inputReservation</span><span class="o">.</span><span class="na">setTotalFare</span><span class="o">(</span><span class="mi">39200</span><span class="o">);</span>
        <span class="n">inputReservation</span><span class="o">.</span><span class="na">setReserveNo</span><span class="o">(</span><span class="s">&quot;0000000001&quot;</span><span class="o">);</span>
        <span class="c1">// omitted</span>

        <span class="n">when</span><span class="o">(</span><span class="n">reservationRepository</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">inputReservation</span><span class="o">)).</span><span class="na">thenReturn</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span> <span class="c1">// (4)</span>

        <span class="c1">// run the test</span>
        <span class="n">TicketReserveDto</span> <span class="n">ticketReserveDto</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="na">registerReservation</span><span class="o">(</span><span class="n">inputReservation</span><span class="o">);</span>

        <span class="c1">// assertion</span>
        <span class="n">verify</span><span class="o">(</span><span class="n">reservationRepository</span><span class="o">).</span><span class="na">insert</span><span class="o">(</span><span class="n">inputReservation</span><span class="o">);</span> <span class="c1">// (5)</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">ticketReserveDto</span><span class="o">.</span><span class="na">getReserveNo</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="s">&quot;0000000001&quot;</span><span class="o">));</span>
        <span class="c1">// omitted</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Declaration for mock initialization and injection on the basis of annotation.
For details, refer <a class="reference internal" href="UsageOfLibraryForTest.html#usageoflibraryfortestcreatemockobject"><span class="std std-ref">Generating a mock</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">MemberRepository</span></code> which depend on <code class="docutils literal"><span class="pre">TicketReserveServiceImpl</span></code> is mocked by assigning
<code class="docutils literal"><span class="pre">&#64;Mock</span></code>annotation
For details, refer <a class="reference internal" href="UsageOfLibraryForTest.html#usageoflibraryfortestcreatemockobject"><span class="std std-ref">Generating a mock</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Mock objects are automatically assigned by assiging <code class="docutils literal"><span class="pre">&#64;InjectMocks</span></code> annotation.
For details, refer <a class="reference internal" href="UsageOfLibraryForTest.html#usageoflibraryfortestcreatemockobject"><span class="std std-ref">Generating a mock</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When the argument is <code class="docutils literal"><span class="pre">inputReservation</span></code> for <code class="docutils literal"><span class="pre">insert</span></code> method of <code class="docutils literal"><span class="pre">ReservationRepository</span></code>,
set so as to return “<code class="docutils literal"><span class="pre">1</span></code>”  as return value.
For mocking of method, refer <a class="reference internal" href="UsageOfLibraryForTest.html#usageoflibraryfortestmockingmethods"><span class="std std-ref">Mocking of method</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Verify that <code class="docutils literal"><span class="pre">insert</span></code> method of <code class="docutils literal"><span class="pre">ReservationRepository</span></code> has been called once
by passing <code class="docutils literal"><span class="pre">inputReservation</span></code> in the argument.
For verification of method which is mocked, refer <a class="reference internal" href="UsageOfLibraryForTest.html#usageoflibraryfortestvalidationofmockmethod"><span class="std std-ref">Validation of mocked method</span></a>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="unit-test-of-application-layer">
<h2><a class="toc-backref" href="#id10">10.2.2.3. Unit test of application layer</a><a class="headerlink" href="#unit-test-of-application-layer" title="Permalink to this headline">¶</a></h2>
<div class="section" id="unit-test-target-for-application-layer">
<h3><a class="toc-backref" href="#id11">10.2.2.3.1. Unit test target for application layer</a><a class="headerlink" href="#unit-test-target-for-application-layer" title="Permalink to this headline">¶</a></h3>
<p>This section explains about unit test of <a class="reference internal" href="../../Overview/ApplicationLayering.html#layerofapplication"><span class="std std-ref">Application layer</span></a> of development guideline.</p>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/ImplementsOfTestByLayerLayerOfTestTargetApplication.png"><img alt="../../_images/ImplementsOfTestByLayerLayerOfTestTargetApplication.png" src="../../_images/ImplementsOfTestByLayerLayerOfTestTargetApplication.png" style="width: 95%;" /></a>
</div>
<p>A test for verifying logic of <code class="docutils literal"><span class="pre">Controller</span></code> and <code class="docutils literal"><span class="pre">Helper</span></code> is carried out in the application layer.
Following items are verified for the <code class="docutils literal"><span class="pre">Controller</span></code>.</p>
<ul class="simple">
<li>&#64;RequestMapping (request path, HTTP method and request parameter)</li>
<li>VIEW name to be returned</li>
</ul>
<p><code class="docutils literal"><span class="pre">View</span></code> is originally included in the application layer, however it is excluded from this guideline.</p>
<p>Spring Test provides a support class (<code class="docutils literal"><span class="pre">org.springframework.test.web.servlet.MockMvc</span></code>etc) for testing controller
class.
<code class="docutils literal"><span class="pre">Controller</span></code> uses <code class="docutils literal"><span class="pre">SpringJUnit4ClassRunner</span></code> of Spring Test which provides <code class="docutils literal"><span class="pre">MockMVC</span></code>, in order to
perform test by sending a pseudo request by using <code class="docutils literal"><span class="pre">MockMVC</span></code>.
<code class="docutils literal"><span class="pre">MockMvc</span></code> consists of a mechanism to send a pseudo request to the <code class="docutils literal"><span class="pre">Controller</span></code> and a test can be performed
simulating deployed application. For details of <code class="docutils literal"><span class="pre">MockMVC</span></code>, refer <a class="reference internal" href="UsageOfLibraryForTest.html#usageoflibraryfortestmockmvcoverview"><span class="std std-ref">MockMvc</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Validation test of Form</strong></p>
<p class="last"><code class="docutils literal"><span class="pre">Form</span></code> test should be carried out in a manner similar to actual operation by combining with <code class="docutils literal"><span class="pre">Controller</span></code>.
If all the patterns of <code class="docutils literal"><span class="pre">Validation</span></code> are combined with <code class="docutils literal"><span class="pre">Controller</span></code>, it will increase load on testing.
Hence, for a simple <code class="docutils literal"><span class="pre">Validation</span></code> confirmation, <code class="docutils literal"><span class="pre">Validation</span></code> can be verified by <code class="docutils literal"><span class="pre">Form</span></code>unit
by separating it from <code class="docutils literal"><span class="pre">Controller</span></code>. For test method, <a class="reference internal" href="ImplementsOfTestByFunction.html#implementsoftestbyfunctiontestingbeanvalidator"><span class="std std-ref">Unit test of Validator implemented by Bean Validation</span></a> can be implemented by using test target.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="unit-test-of-controller">
<h3><a class="toc-backref" href="#id12">10.2.2.3.2. Unit test of Controller</a><a class="headerlink" href="#unit-test-of-controller" title="Permalink to this headline">¶</a></h3>
<p>Implementation method for unit test of <code class="docutils literal"><span class="pre">Controller</span></code> is explained below.</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Test method</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="#implementsoftestbylayertestingcontrollerwithstandalonesetup"><span class="std std-ref">Test using StandaloneSetup</span></a></td>
<td>Test is performed by using default context provided by Spring Test and reading specified setup file.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#implementsoftestbylayertestingcontrollerwithwebappcontextsetup"><span class="std std-ref">Test by using WebAppContextSetup</span></a></td>
<td>Test is performed using <code class="docutils literal"><span class="pre">applicationContext.xml</span></code> and <code class="docutils literal"><span class="pre">spring-mvc.xml</span></code> which are actually used.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#implementsoftestbylayertestingcontrollerwithmockito"><span class="std std-ref">Test using mock</span></a></td>
<td>Test is performed by mocking all the classes on which <code class="docutils literal"><span class="pre">Controller</span></code> is dependent.</td>
</tr>
</tbody>
</table>
<p>A test example for following deliverables is explained. For details of <code class="docutils literal"><span class="pre">Controller</span></code> implementation, refer <a class="reference internal" href="../../ImplementationAtEachLayer/ApplicationLayer.html#controller-label"><span class="std std-ref">Implementing Controller</span></a>.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">Controller</span></code> class (TicketSearchController)</li>
<li><code class="docutils literal"><span class="pre">Controller</span></code> class (MemberRegisterController)</li>
</ul>
<p>Note that, when you want to carry out test by combining injection and mocking, implement the same by combining
following implementation methods as appropriate.</p>
<div class="section" id="test-using-standalonesetup">
<span id="implementsoftestbylayertestingcontrollerwithstandalonesetup"></span><h4><a class="toc-backref" href="#id13">10.2.2.3.2.1. Test using StandaloneSetup</a><a class="headerlink" href="#test-using-standalonesetup" title="Permalink to this headline">¶</a></h4>
<p>For the unit test of <code class="docutils literal"><span class="pre">Controller</span></code> when the dependency class of <code class="docutils literal"><span class="pre">Controller</span></code> can be used without the necessity of mocking, files to be created by <code class="docutils literal"><span class="pre">StandaloneSetup</span></code> are as below.</p>
<div class="figure">
<img alt="../../_images/ImplementsOfTestByLayerControllerStandaloneSetupItems.png" src="../../_images/ImplementsOfTestByLayerControllerStandaloneSetupItems.png" />
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Names of files to be created</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">MemberRegisterControllerStandaloneTest.java</span></code></td>
<td>Test class of <code class="docutils literal"><span class="pre">MemberRegisterController.java</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">spring-mvc-test.xml</span></code></td>
<td>Setup file which extracts <code class="docutils literal"><span class="pre">component-scan</span></code> for test, in order to read application layer dependent components.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">test-context.xml</span></code></td>
<td>Setup file to be used while testing <code class="docutils literal"><span class="pre">Controller</span></code> with domain layer and infrastructure layer.</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>It is preferable to perform test by using <code class="docutils literal"><span class="pre">spring-mvc.xml</span></code>, however context created by Spring Test
and context created by Spring MVC may conflict and test execution might not be possible.
As a countermeasure, only the settings necessary for testing are extracted and a setting file for test is provided.</p>
<p>Setup files for which only necessary settings are extracted are shown below.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">spring-mvc-test.xml</span></code></li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&quot;com.example.app&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>A method to create a test is explained when a class that is dependent on the <code class="docutils literal"><span class="pre">Controller</span></code> class for testing
such as <code class="docutils literal"><span class="pre">ServiceImpl</span></code> is to be injected.
Note that, for verification method while accessing data in the test, refer <a class="reference internal" href="#implementsoftestbylayerunittestofrepository"><span class="std std-ref">Unit test of Repository</span></a>and for the method of verifying logic of domain layer to be called, refer <a class="reference internal" href="#implementsoftestbylayerunittestofservice"><span class="std std-ref">Unit test of Service</span></a>.</p>
<p>Implementation example of <code class="docutils literal"><span class="pre">Controller</span></code> for test is shown below.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">MemberRegisterController.java</span></code></li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;member/register&quot;</span><span class="o">)</span>
<span class="nd">@TransactionTokenCheck</span><span class="o">(</span><span class="s">&quot;member/register&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberRegisterController</span> <span class="o">{</span>

    <span class="nd">@TransactionTokenCheck</span><span class="o">(</span><span class="n">type</span> <span class="o">=</span> <span class="n">TransactionTokenType</span><span class="o">.</span><span class="na">IN</span><span class="o">)</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="nd">@Validated</span> <span class="n">MemberRegisterForm</span> <span class="n">memberRegisterForm</span><span class="o">,</span>
        <span class="n">BindingResult</span> <span class="n">result</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">RedirectAttributes</span> <span class="n">redirectAttributes</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">BadRequestException</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// omitted</span>

        <span class="k">return</span> <span class="s">&quot;redirect:/member/register?complete&quot;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal"><span class="pre">register</span></code> method of <code class="docutils literal"><span class="pre">MemberRegisterController</span></code> class for testing is called,
and it is confirmed that request mapping and returned view is redirected (<code class="docutils literal"><span class="pre">testRegisterConfirm01</span></code>) and
<code class="docutils literal"><span class="pre">BadRequestException</span></code> is thrown when an invalid value is sent (<code class="docutils literal"><span class="pre">testRegisterConfirm02</span></code>).</p>
<p>A test method is explained below wherein a class for testing that depends on the <code class="docutils literal"><span class="pre">Controller</span></code> class such as <code class="docutils literal"><span class="pre">ServiceImpl</span></code> class is injected.
Further, for verification method while accessing data in the test, refer <a class="reference internal" href="#implementsoftestbylayerunittestofrepository"><span class="std std-ref">Unit test of Repository</span></a>.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">MemberRegisterControllerStandaloneTest.java</span></code></li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import static</span> <span class="nn">org.hamcrest.CoreMatchers.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.junit.Assert.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.springframework.test.web.servlet.result.MockMvcResultHandlers.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.springframework.test.web.servlet.result.MockMvcResultMatchers.*</span><span class="o">;</span>

<span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ContextConfiguration</span><span class="o">(</span><span class="n">locations</span> <span class="o">=</span> <span class="o">{</span>
        <span class="s">&quot;classpath:META-INF/spring/applicationContext.xml&quot;</span><span class="o">,</span> <span class="c1">// (1)</span>
        <span class="s">&quot;classpath:META-INF/spring/test-context.xml&quot;</span><span class="o">,</span>       <span class="c1">// (1)</span>
        <span class="s">&quot;classpath:META-INF/spring/spring-mvc-test.xml&quot;</span><span class="o">})</span>   <span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberRegisterControllerStandaloneTest</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">MemberRegisterController</span> <span class="n">target</span><span class="o">;</span>

    <span class="n">MockMvc</span> <span class="n">mockMvc</span><span class="o">;</span>

    <span class="nd">@Before</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="o">{</span>

        <span class="c1">// setup</span>
        <span class="n">mockMvc</span> <span class="o">=</span> <span class="n">MockMvcBuilders</span><span class="o">.</span><span class="na">standaloneSetup</span><span class="o">(</span><span class="n">target</span><span class="o">).</span><span class="na">alwaysDo</span><span class="o">(</span><span class="n">log</span><span class="o">()).</span><span class="na">build</span><span class="o">();</span> <span class="c1">// (2)</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testRegisterConfirm01</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

        <span class="c1">// setup and run the test</span>
        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">post</span><span class="o">(</span><span class="s">&quot;/member/register&quot;</span><span class="o">)</span>
                    <span class="c1">// omitted</span>
                    <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">&quot;password&quot;</span><span class="o">,</span> <span class="s">&quot;testpassword&quot;</span><span class="o">)</span>          <span class="c1">// (3)</span>
                    <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">&quot;reEnterPassword&quot;</span><span class="o">,</span> <span class="s">&quot;testpassword&quot;</span><span class="o">)))</span> <span class="c1">// (3)</span>
                    <span class="c1">// assert</span>
                    <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">is</span><span class="o">(</span><span class="mi">302</span><span class="o">))</span>                                  <span class="c1">// (4)</span>
                    <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">view</span><span class="o">().</span><span class="na">name</span><span class="o">(</span><span class="s">&quot;redirect:/member/register?complete&quot;</span><span class="o">))</span> <span class="c1">// (4)</span>
                    <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">model</span><span class="o">().</span><span class="na">hasNoErrors</span><span class="o">());</span>                            <span class="c1">// (4)</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testRegisterConfirm02</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="c1">// setup and run the test</span>
            <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">post</span><span class="o">(</span><span class="s">&quot;/member/register&quot;</span><span class="o">)</span>
                    <span class="c1">// omitted</span>
                    <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">&quot;password&quot;</span><span class="o">,</span> <span class="s">&quot;testpassword&quot;</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">&quot;reEnterPassword&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">))</span> <span class="c1">// (5)</span>
                    <span class="c1">// assert</span>
                    <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">is</span><span class="o">(</span><span class="mi">400</span><span class="o">))</span>
                    <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">view</span><span class="o">().</span><span class="na">name</span><span class="o">(</span><span class="s">&quot;common/error/badRequest-error&quot;</span><span class="o">))</span>
                    <span class="o">.</span><span class="na">andReturn</span><span class="o">();</span>

            <span class="n">fail</span><span class="o">(</span><span class="s">&quot;test failure!&quot;</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

            <span class="c1">// assert</span>
            <span class="n">assertThat</span><span class="o">(</span><span class="n">e</span><span class="o">,</span> <span class="n">is</span><span class="o">(</span><span class="n">instanceOf</span><span class="o">(</span><span class="n">NestedServletException</span><span class="o">.</span><span class="na">class</span><span class="o">)));</span>         <span class="c1">// (6)</span>
            <span class="n">assertThat</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getCause</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="n">instanceOf</span><span class="o">(</span><span class="n">BadRequestException</span><span class="o">.</span><span class="na">class</span><span class="o">)));</span> <span class="c1">// (6)</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Read the setup files (<code class="docutils literal"><span class="pre">applicationContext.xml</span></code> retained by the application and <code class="docutils literal"><span class="pre">test-context.xml</span></code>, <code class="docutils literal"><span class="pre">spring-mvc-test.xml</span></code> supplementing the same) required for running <code class="docutils literal"><span class="pre">Service</span></code> dependent on <code class="docutils literal"><span class="pre">MemberRegisterController</span></code> and <code class="docutils literal"><span class="pre">Repository</span></code>.
<code class="docutils literal"><span class="pre">test-context.xml</span></code>uses <a class="reference internal" href="PreparationForTest.html#preparationfortestmakesettingfileforspringtest"><span class="std std-ref">Setting file used in the implementation example</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use <code class="docutils literal"><span class="pre">Controller</span></code> generated from loaded Bean definition and setup <code class="docutils literal"><span class="pre">MockMvc</span></code>.
For setup details, refer <a class="reference internal" href="UsageOfLibraryForTest.html#usageoflibraryfortestsettingmockmvc"><span class="std std-ref">MockMvc setup</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Send a request by POST method for <code class="docutils literal"><span class="pre">member/register</span></code>, in order to call <code class="docutils literal"><span class="pre">registerConfirm</span></code> method
of <code class="docutils literal"><span class="pre">MemberRegisterController</span></code> class. Set information of <code class="docutils literal"><span class="pre">Form</span></code> in request parameter.
For setup method of request data, refer <a class="reference internal" href="UsageOfLibraryForTest.html#usageoflibraryfortestsettingofrequestdata"><span class="std std-ref">Setting request data</span></a> and for
implementation method for sending a request, refer <a class="reference internal" href="UsageOfLibraryForTest.html#usageoflibraryfortestexecutionofrequest"><span class="std std-ref">Implementation of sending a request</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use <code class="docutils literal"><span class="pre">MvcResult</span></code> fetched by <code class="docutils literal"><span class="pre">andExpect</span></code> method of <code class="docutils literal"><span class="pre">ResultActions</span></code> returned from <code class="docutils literal"><span class="pre">perform</span></code> method and verify validity of execution results.
For details of verification method, refer <a class="reference internal" href="UsageOfLibraryForTest.html#usageoflibraryfortestimplementationofexecutionresultverification"><span class="std std-ref">Implementation of execution results verification</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Send invalid input value.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Since <code class="docutils literal"><span class="pre">SystemExceptionResolver</span></code> is not enabled, <code class="docutils literal"><span class="pre">NestedServletException</span></code> is notified to servlet container without exception handling.
Verify that exception expected in <code class="docutils literal"><span class="pre">Controller</span></code> is thrown from the exception obtained by <code class="docutils literal"><span class="pre">getCause</span></code> method of <code class="docutils literal"><span class="pre">NestedServletException</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="test-by-using-webappcontextsetup">
<span id="implementsoftestbylayertestingcontrollerwithwebappcontextsetup"></span><h4><a class="toc-backref" href="#id14">10.2.2.3.2.2. Test by using WebAppContextSetup</a><a class="headerlink" href="#test-by-using-webappcontextsetup" title="Permalink to this headline">¶</a></h4>
<p>For unit test of <code class="docutils literal"><span class="pre">Controller</span></code> when the dependency class of <code class="docutils literal"><span class="pre">Controller</span></code> can be used and mocking is not required, files to be created in <code class="docutils literal"><span class="pre">WebAppContextSetup</span></code> are shown below.</p>
<div class="figure">
<img alt="../../_images/ImplementsOfTestByLayerControllerWebAppContextSetupItems.png" src="../../_images/ImplementsOfTestByLayerControllerWebAppContextSetupItems.png" />
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Names of files to be created</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">MemberRegisterControllerWebAppContextTest.java</span></code></td>
<td>Test class of <code class="docutils literal"><span class="pre">MemberRegisterController.java</span></code></td>
</tr>
</tbody>
</table>
<p>It is possible to check the request to the path and <code class="docutils literal"><span class="pre">View</span></code> name returned by the <code class="docutils literal"><span class="pre">Controller</span></code> in the example
of <a class="reference internal" href="#implementsoftestbylayertestingcontrollerwithstandalonesetup"><span class="std std-ref">Test using StandaloneSetup</span></a>,however,since functions which are used by
adding to Spring such as <code class="docutils literal"><span class="pre">TransactionTokenInterceptor</span></code>and <code class="docutils literal"><span class="pre">SystemExceptionResolver</span></code> are not applied, it is not possible to determine whether transaction token check is correctly configured or the transition to error page is correct.
In such a case, <code class="docutils literal"><span class="pre">Interceptor</span></code> and <code class="docutils literal"><span class="pre">ExceptionResolver</span></code> which are used by adding to Spring can be applied
automatically at the time of test, by setting up <code class="docutils literal"><span class="pre">MockMvc</span></code> using <code class="docutils literal"><span class="pre">webAppContextSetup</span></code>.</p>
<p>Differences after comparing the test explained in <a class="reference internal" href="#implementsoftestbylayertestingcontrollerwithstandalonesetup"><span class="std std-ref">Test using StandaloneSetup</span></a>and test when <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation and <code class="docutils literal"><span class="pre">SystemExceptionResolver</span></code> are enabled are explained here.</p>
<p>Implementation example of <code class="docutils literal"><span class="pre">Controller</span></code> for testing is shown below.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">MemberRegisterController.java</span></code></li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;member/register&quot;</span><span class="o">)</span>
<span class="nd">@TransactionTokenCheck</span><span class="o">(</span><span class="s">&quot;member/register&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberRegisterController</span> <span class="o">{</span>

    <span class="nd">@TransactionTokenCheck</span><span class="o">(</span><span class="n">type</span> <span class="o">=</span> <span class="n">TransactionTokenType</span><span class="o">.</span><span class="na">BEGIN</span><span class="o">)</span> <span class="c1">// (1)</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;confirm&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">registerConfirm</span><span class="o">(</span><span class="nd">@Validated</span> <span class="n">MemberRegisterForm</span> <span class="n">memberRegisterForm</span><span class="o">,</span>
        <span class="n">BindingResult</span> <span class="n">result</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// omitted</span>

        <span class="k">return</span> <span class="s">&quot;C1/memberRegisterConfirm&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@TransactionTokenCheck</span><span class="o">(</span><span class="n">type</span> <span class="o">=</span> <span class="n">TransactionTokenType</span><span class="o">.</span><span class="na">IN</span><span class="o">)</span> <span class="c1">// (1)</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="nd">@Validated</span> <span class="n">MemberRegisterForm</span> <span class="n">memberRegisterForm</span><span class="o">,</span>
        <span class="n">BindingResult</span> <span class="n">result</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">RedirectAttributes</span> <span class="n">redirectAttributes</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">BadRequestException</span><span class="o">(</span><span class="n">result</span><span class="o">);</span> <span class="c1">// (2)</span>
        <span class="o">}</span>

        <span class="c1">// omitted</span>

        <span class="k">return</span> <span class="s">&quot;redirect:/member/register?complete&quot;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Invalidate invalid requests by setting <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation.
For transaction token check, refer <a class="reference internal" href="../../ArchitectureInDetail/WebApplicationDetail/DoubleSubmitProtection.html#double-submit-transactiontokencheck"><span class="std std-ref">Transaction Token Check</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">If a validation error occurs at the time of request, it is considered as tampering and an error is thrown.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>At first, differences in test creation methods when <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> is enabled, are shown below.
Further, for verification methods while accessing data in the test, refer <a class="reference internal" href="#implementsoftestbylayerunittestofrepository"><span class="std std-ref">Unit test of Repository</span></a>.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">MemberRegisterControllerWebAppContextTest.java</span></code></li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import static</span> <span class="nn">org.hamcrest.CoreMatchers.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.junit.Assert.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.springframework.test.web.servlet.result.MockMvcResultHandlers.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.springframework.test.web.servlet.result.MockMvcResultMatchers.*</span><span class="o">;</span>

<span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ContextHierarchy</span><span class="o">({</span><span class="nd">@ContextConfiguration</span><span class="o">(</span>                                   <span class="c1">// (1)</span>
        <span class="s">&quot;classpath:META-INF/spring/applicationContext.xml&quot;</span><span class="o">),</span>                <span class="c1">// (1)</span>
        <span class="nd">@ContextConfiguration</span><span class="o">(</span><span class="s">&quot;classpath:META-INF/spring/spring-mvc.xml&quot;</span><span class="o">)})</span> <span class="c1">// (1)</span>
<span class="nd">@WebAppConfiguration</span>                                                        <span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberRegisterControllerWebAppContextTest</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">WebApplicationContext</span> <span class="n">webApplicationContext</span><span class="o">;</span> <span class="c1">// (2)</span>

    <span class="n">MockMvc</span> <span class="n">mockMvc</span><span class="o">;</span>

    <span class="nd">@Before</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="o">{</span>

        <span class="c1">// setup</span>
        <span class="n">mockMvc</span> <span class="o">=</span> <span class="n">MockMvcBuilders</span><span class="o">.</span><span class="na">webAppContextSetup</span><span class="o">(</span><span class="n">webApplicationContext</span><span class="o">)</span> <span class="c1">// (2)</span>
                <span class="o">.</span><span class="na">alwaysDo</span><span class="o">(</span><span class="n">log</span><span class="o">()).</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testRegisterConfirm01</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

        <span class="c1">// setup and run the test</span>
        <span class="n">MvcResult</span> <span class="n">mvcResult</span> <span class="o">=</span> <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">post</span><span class="o">(</span><span class="s">&quot;/member/register&quot;</span><span class="o">)</span> <span class="c1">// (3)</span>
                    <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">&quot;confirm&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">)</span>                              <span class="c1">// (3)</span>
                    <span class="c1">// omitted</span>
                    <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">&quot;password&quot;</span><span class="o">,</span> <span class="s">&quot;testpassword&quot;</span><span class="o">)</span>                 <span class="c1">// (3)</span>
                    <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">&quot;reEnterPassword&quot;</span><span class="o">,</span> <span class="s">&quot;testpassword&quot;</span><span class="o">))</span>         <span class="c1">// (3)</span>
                    <span class="c1">// assert</span>
                    <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">is</span><span class="o">(</span><span class="mi">200</span><span class="o">))</span>
                    <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">view</span><span class="o">().</span><span class="na">name</span><span class="o">(</span><span class="s">&quot;C1/memberRegisterConfirm&quot;</span><span class="o">))</span>
                    <span class="o">.</span><span class="na">andReturn</span><span class="o">();</span>

        <span class="n">TransactionToken</span> <span class="n">actTransactionToken</span> <span class="o">=</span> <span class="o">(</span><span class="n">TransactionToken</span><span class="o">)</span> <span class="n">mvcResult</span><span class="o">.</span><span class="na">getRequest</span><span class="o">()</span>
                <span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">TransactionTokenInterceptor</span><span class="o">.</span><span class="na">NEXT_TOKEN_REQUEST_ATTRIBUTE_NAME</span><span class="o">);</span> <span class="c1">// (4)</span>

        <span class="n">MockHttpSession</span> <span class="n">mockSession</span> <span class="o">=</span> <span class="o">(</span><span class="n">MockHttpSession</span><span class="o">)</span> <span class="n">mvcResult</span><span class="o">.</span><span class="na">getRequest</span><span class="o">().</span><span class="na">getSession</span><span class="o">();</span>  <span class="c1">// (5)</span>

        <span class="c1">// setup and run the test</span>
        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">post</span><span class="o">(</span><span class="s">&quot;/member/register&quot;</span><span class="o">)</span>              <span class="c1">// (6)</span>
                    <span class="c1">// omitted</span>
                    <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">&quot;password&quot;</span><span class="o">,</span> <span class="s">&quot;testpassword&quot;</span><span class="o">)</span>        <span class="c1">// (6)</span>
                    <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">&quot;reEnterPassword&quot;</span><span class="o">,</span> <span class="s">&quot;testpassword&quot;</span><span class="o">)</span> <span class="c1">// (6)</span>
                    <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="n">TransactionTokenInterceptor</span><span class="o">.</span><span class="na">TOKEN_REQUEST_PARAMETER</span><span class="o">,</span>
                            <span class="n">actTransactionToken</span><span class="o">.</span><span class="na">getTokenString</span><span class="o">())</span> <span class="c1">// (6)</span>
                    <span class="o">.</span><span class="na">session</span><span class="o">(</span><span class="n">mockSession</span><span class="o">))</span> <span class="c1">// (6)</span>
                    <span class="c1">// assert</span>
                    <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">is</span><span class="o">(</span><span class="mi">302</span><span class="o">))</span>                                   <span class="c1">// (7)</span>
                    <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">view</span><span class="o">().</span><span class="na">name</span><span class="o">(</span><span class="s">&quot;redirect:/member/register?complete&quot;</span><span class="o">));</span> <span class="c1">// (7)</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Read <code class="docutils literal"><span class="pre">spring-mvc.xml</span></code> to run <code class="docutils literal"><span class="pre">Interceptor</span></code> and <code class="docutils literal"><span class="pre">ExceptionResolver</span></code> customized for operation.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use Web application context generated from loaded Bean definition and set up <code class="docutils literal"><span class="pre">MockMvc</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Send a request for the method set by <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck(type</span> <span class="pre">=</span> <span class="pre">TransactionTokenType.BEGIN)</span></code> in
order to generate a method transaction token.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch transaction token from request attribute to inherit the transaction token from BEGIN request
(<code class="docutils literal"><span class="pre">registerConfirm</span></code> method) to IN request (<code class="docutils literal"><span class="pre">register</span></code>method).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">It is necessary to refer to same session in the next request as well for retaining the transaction token issued by the server side, in the session, however,
It is specified in <code class="docutils literal"><span class="pre">MockMvc</span></code> that the same session must be used explicitly as new sessions are used for each request.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Send the request again to request path (<code class="docutils literal"><span class="pre">member/register</span></code>) with the POST method.
Set information of <code class="docutils literal"><span class="pre">Form</span></code> and transaction token fetched in (4), in request parameter, and set
the session fetched in (5) in the session.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Verify that the transaction token check error has not occurred to confirm that the settings of transaction token check are correct.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Differences in test creation methods when <code class="docutils literal"><span class="pre">SystemExceptionResolver</span></code> is enabled are explained next.</p>
<p>Definition example of <code class="docutils literal"><span class="pre">SystemExceptionResolver</span></code> is shown below.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">spring-mvc.xml</span></code></li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.exception.SystemExceptionResolver&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;order&quot;</span> <span class="na">value=</span><span class="s">&quot;3&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionMappings&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;map&gt;</span>
      <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;InvalidTransactionTokenException&quot;</span> <span class="na">value=</span><span class="s">&quot;common/error/token-error&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;BadRequestException&quot;</span> <span class="na">value=</span><span class="s">&quot;common/error/badRequest-error&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;Exception&quot;</span> <span class="na">value=</span><span class="s">&quot;common/error/system-error&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/map&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;statusCodes&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;map&gt;</span>
      <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;common/error/token-error&quot;</span> <span class="na">value=</span><span class="s">&quot;409&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;common/error/badRequest-error&quot;</span> <span class="na">value=</span><span class="s">&quot;400&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/map&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;excludedExceptions&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;array&gt;</span>
          <span class="nt">&lt;value&gt;</span>org.springframework.web.util.NestedServletException<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/array&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultStatusCode&quot;</span> <span class="na">value=</span><span class="s">&quot;500&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionCodeResolver&quot;</span> <span class="na">ref=</span><span class="s">&quot;exceptionCodeResolver&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;preventResponseCaching&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<p>Differences in test creation method are explained below.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">MemberRegisterControllerWebAppContextTest.java</span></code></li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import static</span> <span class="nn">org.hamcrest.CoreMatchers.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.junit.Assert.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.springframework.test.web.servlet.result.MockMvcResultHandlers.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.springframework.test.web.servlet.result.MockMvcResultMatchers.*</span><span class="o">;</span>

<span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ContextHierarchy</span><span class="o">({</span><span class="nd">@ContextConfiguration</span><span class="o">(</span>
        <span class="s">&quot;classpath:META-INF/spring/applicationContext.xml&quot;</span><span class="o">),</span>
        <span class="nd">@ContextConfiguration</span><span class="o">(</span><span class="s">&quot;classpath:META-INF/spring/spring-mvc.xml&quot;</span><span class="o">)})</span>
<span class="nd">@WebAppConfiguration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberRegisterControllerWebAppContextTest</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">WebApplicationContext</span> <span class="n">webApplicationContext</span><span class="o">;</span>

    <span class="n">MockMvc</span> <span class="n">mockMvc</span><span class="o">;</span>

    <span class="nd">@Before</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="o">{</span>

        <span class="c1">// setup</span>
        <span class="n">mockMvc</span> <span class="o">=</span> <span class="n">MockMvcBuilders</span><span class="o">.</span><span class="na">webAppContextSetup</span><span class="o">(</span><span class="n">webApplicationContext</span><span class="o">)</span>
                <span class="o">.</span><span class="na">alwaysDo</span><span class="o">(</span><span class="n">log</span><span class="o">()).</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testRegisterConfirm02</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

        <span class="c1">// omitted</span>

        <span class="c1">// setup and run the test</span>
        <span class="n">mvcResult</span> <span class="o">=</span> <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">post</span><span class="o">(</span><span class="s">&quot;/member/register&quot;</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">&quot;password&quot;</span><span class="o">,</span> <span class="s">&quot;testpassword&quot;</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">&quot;reEnterPassword&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">)</span> <span class="c1">// (1)</span>
                    <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="n">TransactionTokenInterceptor</span><span class="o">.</span><span class="na">TOKEN_REQUEST_PARAMETER</span><span class="o">,</span>
                            <span class="n">actTransactionToken</span><span class="o">.</span><span class="na">getTokenString</span><span class="o">())</span> <span class="c1">// (2)</span>
                    <span class="o">.</span><span class="na">session</span><span class="o">(</span><span class="n">mockSession</span><span class="o">))</span> <span class="c1">// (2)</span>
                    <span class="c1">// assert</span>
                    <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">is</span><span class="o">(</span><span class="mi">400</span><span class="o">))</span>                             <span class="c1">// (3)</span>
                    <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">view</span><span class="o">().</span><span class="na">name</span><span class="o">(</span><span class="s">&quot;common/error/badRequest-error&quot;</span><span class="o">))</span> <span class="c1">// (3)</span>
                    <span class="o">.</span><span class="na">andReturn</span><span class="o">();</span>

        <span class="c1">// assert</span>
        <span class="n">Exception</span> <span class="n">exception</span> <span class="o">=</span> <span class="n">mvcResult</span><span class="o">.</span><span class="na">getResolvedException</span><span class="o">();</span>                   <span class="c1">// (4)</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">exception</span><span class="o">,</span> <span class="n">is</span><span class="o">(</span><span class="n">instanceOf</span><span class="o">(</span><span class="n">BadRequestException</span><span class="o">.</span><span class="na">class</span><span class="o">)));</span>         <span class="c1">// (4)</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">exception</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="s">&quot;不正リクエスト(パラメータ改竄)&quot;</span><span class="o">));</span> <span class="c1">// (4)</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Error is thrown in <code class="docutils literal"><span class="pre">register</span></code> method by making information of <code class="docutils literal"><span class="pre">Form</span></code> invalid value.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">As described earlier, set information of generated transaction token.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Verify that status code of defined error, transition destination of error page are correctly set since
<code class="docutils literal"><span class="pre">SystemExceptionResolver</span></code> is enabled here.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Verify that the expected error is thrown from the error that handle
exceptions in <code class="docutils literal"><span class="pre">SystemExceptionResolver</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>When Session is used</strong></p>
<p>When the <code class="docutils literal"><span class="pre">Controller</span></code>class uses a Session, test is performed by using <code class="docutils literal"><span class="pre">org.springframework.mock.web.MockHttpSession</span></code>.</p>
<ul class="simple">
<li>Example of test method which use <code class="docutils literal"><span class="pre">MockHttpSession</span></code></li>
</ul>
<blockquote class="last">
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SessionControllerTest</span> <span class="o">{</span>

    <span class="c1">// (1)</span>
    <span class="n">MockHttpSession</span> <span class="n">mockSession</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MockHttpSession</span><span class="o">();</span>

    <span class="c1">// omitted</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSession</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">formName</span> <span class="o">=</span> <span class="s">&quot;todoForm&quot;</span><span class="o">;</span>

        <span class="n">TodoForm</span> <span class="n">form</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TodoForm</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">todoId</span> <span class="o">=</span> <span class="s">&quot;1111&quot;</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">todoTitle</span> <span class="o">=</span> <span class="s">&quot;test&quot;</span><span class="o">;</span>

        <span class="n">form</span><span class="o">.</span><span class="na">setTodoId</span><span class="o">(</span><span class="n">todoId</span><span class="o">);</span>
        <span class="n">form</span><span class="o">.</span><span class="na">setTodoTitle</span><span class="o">(</span><span class="n">todoTitle</span><span class="o">);</span>

        <span class="c1">// (2)</span>
        <span class="n">mockSession</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="n">formName</span><span class="o">,</span> <span class="n">form</span><span class="o">);</span>

        <span class="c1">// (3)</span>
        <span class="n">ResultActions</span> <span class="n">results</span> <span class="o">=</span> <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">post</span><span class="o">(</span><span class="s">&quot;/todo/operation&quot;</span><span class="o">)</span>
            <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">&quot;create&quot;</span><span class="o">,</span> <span class="s">&quot;create&quot;</span><span class="o">)</span>
            <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">&quot;todoId&quot;</span><span class="o">,</span> <span class="n">todoId</span><span class="o">)</span>
            <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">&quot;todoTitle&quot;</span><span class="o">,</span> <span class="n">todoTitle</span><span class="o">)</span>
            <span class="o">.</span><span class="na">session</span><span class="o">(</span><span class="n">mockSession</span><span class="o">));</span>

        <span class="c1">// (4)</span>
        <span class="n">results</span><span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">request</span><span class="o">().</span><span class="na">sessionAttribute</span><span class="o">(</span><span class="n">formName</span><span class="o">,</span> <span class="n">isA</span><span class="o">(</span><span class="n">TodoForm</span><span class="o">.</span><span class="na">class</span><span class="o">)));</span>

        <span class="c1">// omitted</span>

        <span class="c1">// (5)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;/todo/create&quot;</span><span class="o">).</span><span class="na">param</span><span class="o">(</span><span class="s">&quot;redo&quot;</span><span class="o">,</span> <span class="s">&quot;redo&quot;</span><span class="o">));</span>
        <span class="n">results</span><span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">request</span><span class="o">().</span><span class="na">sessionAttribute</span><span class="o">(</span><span class="n">formName</span><span class="o">,</span> <span class="n">isA</span><span class="o">(</span><span class="n">TodoForm</span><span class="o">.</span><span class="na">class</span><span class="o">)));</span>

        <span class="c1">// omitted</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Generate a mock object of session. For class details, refer
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/4.3.14.RELEASE/javadoc-api/org/springframework/mock/web/MockHttpSession.html">MockHttpSession Javadoc</a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set the object to be stored in the mock object of the generated session.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Generate a mock request by <code class="docutils literal"><span class="pre">post</span></code> method of <code class="docutils literal"><span class="pre">MockMvcRequestBuilders</span></code> and register a mock
session in the generated request by <code class="docutils literal"><span class="pre">session</span></code> method.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Verify that object set in (2) is stored in the session scope.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Issue a request again and check whether the object stored in the session scope is retained.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="implementsoftestbylayertestingcontrollerwithmockito">
<span id="id1"></span><h4><a class="toc-backref" href="#id15">10.2.2.3.2.3. Test using mock</a><a class="headerlink" href="#implementsoftestbylayertestingcontrollerwithmockito" title="Permalink to this headline">¶</a></h4>
<p>Files to be created for unit test of <code class="docutils literal"><span class="pre">Controller</span></code> when it is necessary to mock dependency class of
<code class="docutils literal"><span class="pre">Controller</span></code> are as below.</p>
<div class="figure">
<img alt="../../_images/ImplementsOfTestByLayerControllerMockTest.png" src="../../_images/ImplementsOfTestByLayerControllerMockTest.png" />
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Names of files to be created</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">TicketSearchControllerMockTest.java</span></code></td>
<td>Test class of <code class="docutils literal"><span class="pre">TicketSearchController.java</span></code></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>A test creation method when mocking is done for class which is dependent on <code class="docutils literal"><span class="pre">Controller</span></code> class for testing is explained.</p>
<p>Implementation example of <code class="docutils literal"><span class="pre">Controller</span></code> for test is shown below.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">TicketSearchController.java</span></code></li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;ticket/search&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TicketSearchController</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">TicketSearchHelper</span> <span class="n">ticketSearchHelper</span><span class="o">;</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;form&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">searchForm</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">ticketSearchHelper</span><span class="o">.</span><span class="na">createDefaultTicketSearchForm</span><span class="o">());</span>

        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">ticketSearchHelper</span><span class="o">.</span><span class="na">createFlightSearchOutputDto</span><span class="o">());</span>

        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;isInitialSearchUnnecessary&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>

        <span class="k">return</span> <span class="s">&quot;B1/flightSearch&quot;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Implementation example for <code class="docutils literal"><span class="pre">Controller</span></code> test is shown below.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">TicketSearchControllerMockTest.java</span></code></li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import static</span> <span class="nn">org.hamcrest.CoreMatchers.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.junit.Assert.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.mockito.Mockito.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.springframework.test.web.servlet.result.MockMvcResultHandlers.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.springframework.test.web.servlet.result.MockMvcResultMatchers.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TicketSearchControllerMockTest</span> <span class="o">{</span>

    <span class="nd">@Rule</span> <span class="c1">// (1)</span>
    <span class="kd">public</span> <span class="n">MockitoRule</span> <span class="n">mockito</span> <span class="o">=</span> <span class="n">MockitoJUnit</span><span class="o">.</span><span class="na">rule</span><span class="o">();</span>

    <span class="nd">@InjectMocks</span> <span class="c1">// (2)</span>
    <span class="n">TicketSearchController</span> <span class="n">target</span><span class="o">;</span>

    <span class="nd">@Mock</span> <span class="c1">// (3)</span>
    <span class="n">TicketSearchHelper</span> <span class="n">ticketSearchHelper</span><span class="o">;</span>

    <span class="n">MockMvc</span> <span class="n">mockMvc</span><span class="o">;</span>

    <span class="nd">@Before</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="o">{</span>

        <span class="c1">// setup</span>
        <span class="n">TicketSearchForm</span> <span class="n">ticketSearchForm</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TicketSearchForm</span><span class="o">();</span>
        <span class="n">ticketSearchForm</span><span class="o">.</span><span class="na">setFlightType</span><span class="o">(</span><span class="n">FlightType</span><span class="o">.</span><span class="na">RT</span><span class="o">);</span>
        <span class="n">ticketSearchForm</span><span class="o">.</span><span class="na">setDepAirportCd</span><span class="o">(</span><span class="s">&quot;HND&quot;</span><span class="o">);</span>
        <span class="c1">// omitted</span>

        <span class="n">when</span><span class="o">(</span><span class="n">ticketSearchHelper</span><span class="o">.</span><span class="na">createDefaultTicketSearchForm</span><span class="o">()).</span><span class="na">thenReturn</span><span class="o">(</span><span class="n">ticketSearchForm</span><span class="o">);</span> <span class="c1">// (4)</span>

        <span class="n">mockMvc</span> <span class="o">=</span> <span class="n">MockMvcBuilders</span><span class="o">.</span><span class="na">standaloneSetup</span><span class="o">(</span><span class="n">target</span><span class="o">).</span><span class="na">alwaysDo</span><span class="o">(</span><span class="n">log</span><span class="o">()).</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSearchForm</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

        <span class="c1">// setup and run the test</span>
        <span class="n">MvcResult</span> <span class="n">mvcResult</span> <span class="o">=</span> <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;/ticket/search&quot;</span><span class="o">).</span><span class="na">param</span><span class="o">(</span><span class="s">&quot;form&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">))</span>
                    <span class="c1">// assert</span>
                    <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">is</span><span class="o">(</span><span class="mi">200</span><span class="o">))</span>
                    <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">view</span><span class="o">().</span><span class="na">name</span><span class="o">(</span><span class="s">&quot;B1/flightSearch&quot;</span><span class="o">))</span>
                    <span class="o">.</span><span class="na">andReturn</span><span class="o">();</span>

        <span class="c1">// assert</span>
        <span class="n">verify</span><span class="o">(</span><span class="n">ticketSearchHelper</span><span class="o">).</span><span class="na">createDefaultTicketSearchForm</span><span class="o">();</span> <span class="c1">// (5)</span>

        <span class="c1">// omitted</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Declaration for mock initialization and injection on the basis of annotation.
For details, refer <a class="reference internal" href="UsageOfLibraryForTest.html#usageoflibraryfortestcreatemockobject"><span class="std std-ref">Generating a mock</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">By assigning <code class="docutils literal"><span class="pre">&#64;Mock</span></code> annotation, mocking is done for <code class="docutils literal"><span class="pre">TicketSearchHelper</span></code> which is dependent
on <code class="docutils literal"><span class="pre">TicketSearchController</span></code>.
For details, <a class="reference internal" href="UsageOfLibraryForTest.html#usageoflibraryfortestcreatemockobject"><span class="std std-ref">Generating a mock</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">By assigning <code class="docutils literal"><span class="pre">&#64;InjectMocks</span></code> annotation, mock objects are automatically assigned.
For details, refer <a class="reference internal" href="UsageOfLibraryForTest.html#usageoflibraryfortestcreatemockobject"><span class="std std-ref">Generating a mock</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In all test methods, set return value of <code class="docutils literal"><span class="pre">createMockForm</span></code> method as a return value of
<code class="docutils literal"><span class="pre">createDefaultTicketSearchForm</span></code> method of <code class="docutils literal"><span class="pre">ticketSearchHelper</span></code>For mocking of method, refer <a class="reference internal" href="UsageOfLibraryForTest.html#usageoflibraryfortestmockingmethods"><span class="std std-ref">Mocking of method</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Verify that <code class="docutils literal"><span class="pre">createDefaultTicketSearchForm</span></code> method of <code class="docutils literal"><span class="pre">ticketSearchHelper</span></code> is called once.
For verification of method which has undergone mocking, refer<a class="reference internal" href="UsageOfLibraryForTest.html#usageoflibraryfortestvalidationofmockmethod"><span class="std std-ref">Validation of mocked method</span></a>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unit-test-of-helper">
<span id="implementsoftestbylayerunittestofhelper"></span><h3><a class="toc-backref" href="#id16">10.2.2.3.3. Unit test of Helper</a><a class="headerlink" href="#unit-test-of-helper" title="Permalink to this headline">¶</a></h3>
<p>Unit test of <code class="docutils literal"><span class="pre">Helper</span></code> can be performed by testing with the implementation same as <code class="docutils literal"><span class="pre">Service</span></code>.
For implementation method, refer <a class="reference internal" href="#implementsoftestbylayerunittestofservice"><span class="std std-ref">Unit test of Service</span></a>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ImplementsOfTestByFunction.html" title="10.2.3. Implementation of tests by functions"
             >next</a> |</li>
        <li class="right" >
          <a href="PreparationForTest.html" title="10.2.1. Preparation for test"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.4.1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >10. Unit test</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >10.2. Implementation of unit test</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
      © Copyright 2013-2018, NTT DATA Corporation. © Copyright 2013-2018, NTT Corporation.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.3.Theme is <a href="http://github.com/vimalkvn/solar-theme">Solar</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>
