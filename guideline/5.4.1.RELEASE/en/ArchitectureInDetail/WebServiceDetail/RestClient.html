<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>5.2. REST Client (HTTP Client) &#8212; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.4.1.RELEASE documentation</title>
    <link rel="stylesheet" href="../../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '5.4.1.RELEASE',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5.3. SOAP Web Service (Server/Client)" href="SOAP.html" />
    <link rel="prev" title="5.1. RESTful Web Service" href="REST.html" /><script src="../../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../../_static/solarized-dark.css" rel="stylesheet">
<link href="../../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="SOAP.html" title="5.3. SOAP Web Service (Server/Client)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="REST.html" title="5.1. RESTful Web Service"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.4.1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">5. Web Services</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>

  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">5.2. REST Client (HTTP Client)</a><ul>
<li><a class="reference internal" href="#overview">5.2.1. Overview</a><ul>
<li><a class="reference internal" href="#what-is-resttemplate">5.2.1.1. What is <code class="docutils literal"><span class="pre">RestTemplate</span></code></a><ul>
<li><a class="reference internal" href="#httpmessageconverter">5.2.1.1.1. <code class="docutils literal"><span class="pre">HttpMessageConverter</span></code></a></li>
<li><a class="reference internal" href="#clienthttprequestfactory">5.2.1.1.2. <code class="docutils literal"><span class="pre">ClientHttpRequestFactory</span></code></a></li>
<li><a class="reference internal" href="#responseerrorhandler">5.2.1.1.3. <code class="docutils literal"><span class="pre">ResponseErrorHandler</span></code></a></li>
<li><a class="reference internal" href="#clienthttprequestinterceptor">5.2.1.1.4. <code class="docutils literal"><span class="pre">ClientHttpRequestInterceptor</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use">5.2.2. How to use</a><ul>
<li><a class="reference internal" href="#resttemplate-setup">5.2.2.1. <code class="docutils literal"><span class="pre">RestTemplate</span></code> Setup</a><ul>
<li><a class="reference internal" href="#dependent-library-setup">5.2.2.1.1. Dependent library setup</a></li>
<li><a class="reference internal" href="#bean-definition-of-resttemplate">5.2.2.1.2. Bean definition of <code class="docutils literal"><span class="pre">RestTemplate</span></code></a></li>
<li><a class="reference internal" href="#using-resttemplate">5.2.2.1.3. Using <code class="docutils literal"><span class="pre">RestTemplate</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sending-get-request">5.2.2.2. Sending GET request</a><ul>
<li><a class="reference internal" href="#implementation-by-using-getforobject-method">5.2.2.2.1. Implementation by using <code class="docutils literal"><span class="pre">getForObject</span></code> method</a></li>
<li><a class="reference internal" href="#implementation-by-using-getforentity-method">5.2.2.2.2. Implementation by using <code class="docutils literal"><span class="pre">getForEntity</span></code> method</a></li>
<li><a class="reference internal" href="#implementation-by-using-exchange-method">5.2.2.2.3. Implementation by using <code class="docutils literal"><span class="pre">exchange</span></code> method</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sending-post-request">5.2.2.3. Sending POST request</a><ul>
<li><a class="reference internal" href="#implementation-by-using-postforobject-method">5.2.2.3.1. Implementation by using <code class="docutils literal"><span class="pre">postForObject</span></code> method</a></li>
<li><a class="reference internal" href="#implementation-using-postforentity-method">5.2.2.3.2. Implementation using <code class="docutils literal"><span class="pre">postForEntity</span></code> method</a></li>
<li><a class="reference internal" href="#implementation-using-exchange-method">5.2.2.3.3. Implementation using <code class="docutils literal"><span class="pre">exchange</span></code> method</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fetch-data-in-collection-format">5.2.2.4. Fetch data in collection format</a></li>
<li><a class="reference internal" href="#configuration-of-request-header">5.2.2.5. Configuration of request header</a><ul>
<li><a class="reference internal" href="#configuration-of-content-type-header">5.2.2.5.1. Configuration of Content-Type header</a></li>
<li><a class="reference internal" href="#configuration-of-accept-header">5.2.2.5.2. Configuration of Accept header</a></li>
<li><a class="reference internal" href="#configuration-of-an-arbitrary-request-header">5.2.2.5.3. Configuration of an  arbitrary request header</a></li>
</ul>
</li>
<li><a class="reference internal" href="#error-handling">5.2.2.6. Error Handling</a><ul>
<li><a class="reference internal" href="#exception-handling-default-behaviour">5.2.2.6.1. Exception Handling (Default Behaviour)</a></li>
<li><a class="reference internal" href="#returning-responseentity-error-handler-extension">5.2.2.6.2. Returning <code class="docutils literal"><span class="pre">ResponseEntity</span></code> (Error handler extension)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setting-communication-timeout">5.2.2.7. Setting communication timeout</a></li>
<li><a class="reference internal" href="#using-ssl-self-signed-certificate">5.2.2.8. Using SSL self-signed certificate</a></li>
<li><a class="reference internal" href="#basic-authentication">5.2.2.9. Basic authentication</a></li>
<li><a class="reference internal" href="#file-upload-multi-part-request">5.2.2.10. File upload (multi-part request)</a></li>
<li><a class="reference internal" href="#file-download">5.2.2.11. File download</a></li>
<li><a class="reference internal" href="#how-to-handle-restful-url-uri-template-and-implementation-example">5.2.2.12. How to handle RESTful URL (URI template) and implementation example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-extend">5.2.3. How to extend</a><ul>
<li><a class="reference internal" href="#how-to-register-an-arbitrary-httpmessageconverter">5.2.3.1. How to register an arbitrary <code class="docutils literal"><span class="pre">HttpMessageConverter</span></code></a></li>
<li><a class="reference internal" href="#application-of-common-process-clienthttprequestinterceptor">5.2.3.2. Application of common process (<code class="docutils literal"><span class="pre">ClientHttpRequestInterceptor</span></code>)</a><ul>
<li><a class="reference internal" href="#logging-process">5.2.3.2.1. Logging process</a></li>
<li><a class="reference internal" href="#request-header-setup-process-for-basic-authentication">5.2.3.2.2. Request header setup process for Basic authentication</a></li>
<li><a class="reference internal" href="#applying-clienthttprequestinterceptor">5.2.3.2.3. Applying <code class="docutils literal"><span class="pre">ClientHttpRequestInterceptor</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#asynchronous-request">5.2.3.3. Asynchronous request</a><ul>
<li><a class="reference internal" href="#bean-definition-for-asyncresttemplate">5.2.3.3.1. Bean definition for <code class="docutils literal"><span class="pre">AsyncRestTemplate</span></code></a></li>
<li><a class="reference internal" href="#implementation-of-asynchronous-request">5.2.3.3.2. Implementation of asynchronous request</a></li>
<li><a class="reference internal" href="#implementation-of-common-processing-for-asynchronous-request">5.2.3.3.3. Implementation of common processing for asynchronous request</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#appendix">5.2.4. Appendix</a><ul>
<li><a class="reference internal" href="#how-to-configure-http-proxy-server">5.2.4.1. How to configure HTTP Proxy server</a><ul>
<li><a class="reference internal" href="#how-to-specify-a-http-proxy-server">5.2.4.1.1. How to specify a HTTP Proxy server</a></li>
<li><a class="reference internal" href="#how-to-specify-credentials-information-of-http-proxy-server">5.2.4.1.2. How to specify credentials information of HTTP Proxy server</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuration-while-using-jsr-310-date-and-time-api-in-json">5.2.4.2. Configuration while using JSR-310 Date and Time API in JSON</a></li>
</ul>
</li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="REST.html"
                        title="previous chapter">5.1. RESTful Web Service</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="SOAP.html"
                        title="next chapter">5.3. SOAP Web Service (Server/Client)</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/ArchitectureInDetail/WebServiceDetail/RestClient.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="rest-client-http-client">
<h1>5.2. REST Client (HTTP Client)<a class="headerlink" href="#rest-client-http-client" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="index">
<p class="topic-title first">Index</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id12">Overview</a><ul>
<li><a class="reference internal" href="#what-is-resttemplate" id="id13">What is <code class="docutils literal"><span class="pre">RestTemplate</span></code></a><ul>
<li><a class="reference internal" href="#httpmessageconverter" id="id14"><code class="docutils literal"><span class="pre">HttpMessageConverter</span></code></a></li>
<li><a class="reference internal" href="#clienthttprequestfactory" id="id15"><code class="docutils literal"><span class="pre">ClientHttpRequestFactory</span></code></a></li>
<li><a class="reference internal" href="#responseerrorhandler" id="id16"><code class="docutils literal"><span class="pre">ResponseErrorHandler</span></code></a></li>
<li><a class="reference internal" href="#clienthttprequestinterceptor" id="id17"><code class="docutils literal"><span class="pre">ClientHttpRequestInterceptor</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use" id="id18">How to use</a><ul>
<li><a class="reference internal" href="#resttemplate-setup" id="id19"><code class="docutils literal"><span class="pre">RestTemplate</span></code> Setup</a><ul>
<li><a class="reference internal" href="#dependent-library-setup" id="id20">Dependent library setup</a></li>
<li><a class="reference internal" href="#bean-definition-of-resttemplate" id="id21">Bean definition of <code class="docutils literal"><span class="pre">RestTemplate</span></code></a></li>
<li><a class="reference internal" href="#using-resttemplate" id="id22">Using <code class="docutils literal"><span class="pre">RestTemplate</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sending-get-request" id="id23">Sending GET request</a><ul>
<li><a class="reference internal" href="#implementation-by-using-getforobject-method" id="id24">Implementation by using <code class="docutils literal"><span class="pre">getForObject</span></code> method</a></li>
<li><a class="reference internal" href="#implementation-by-using-getforentity-method" id="id25">Implementation by using <code class="docutils literal"><span class="pre">getForEntity</span></code> method</a></li>
<li><a class="reference internal" href="#implementation-by-using-exchange-method" id="id26">Implementation by using <code class="docutils literal"><span class="pre">exchange</span></code> method</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sending-post-request" id="id27">Sending POST request</a><ul>
<li><a class="reference internal" href="#implementation-by-using-postforobject-method" id="id28">Implementation by using <code class="docutils literal"><span class="pre">postForObject</span></code> method</a></li>
<li><a class="reference internal" href="#implementation-using-postforentity-method" id="id29">Implementation using <code class="docutils literal"><span class="pre">postForEntity</span></code> method</a></li>
<li><a class="reference internal" href="#implementation-using-exchange-method" id="id30">Implementation using <code class="docutils literal"><span class="pre">exchange</span></code> method</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fetch-data-in-collection-format" id="id31">Fetch data in collection format</a></li>
<li><a class="reference internal" href="#configuration-of-request-header" id="id32">Configuration of request header</a><ul>
<li><a class="reference internal" href="#configuration-of-content-type-header" id="id33">Configuration of Content-Type header</a></li>
<li><a class="reference internal" href="#configuration-of-accept-header" id="id34">Configuration of Accept header</a></li>
<li><a class="reference internal" href="#configuration-of-an-arbitrary-request-header" id="id35">Configuration of an  arbitrary request header</a></li>
</ul>
</li>
<li><a class="reference internal" href="#error-handling" id="id36">Error Handling</a><ul>
<li><a class="reference internal" href="#exception-handling-default-behaviour" id="id37">Exception Handling (Default Behaviour)</a></li>
<li><a class="reference internal" href="#returning-responseentity-error-handler-extension" id="id38">Returning <code class="docutils literal"><span class="pre">ResponseEntity</span></code> (Error handler extension)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setting-communication-timeout" id="id39">Setting communication timeout</a></li>
<li><a class="reference internal" href="#using-ssl-self-signed-certificate" id="id40">Using SSL self-signed certificate</a></li>
<li><a class="reference internal" href="#basic-authentication" id="id41">Basic authentication</a></li>
<li><a class="reference internal" href="#file-upload-multi-part-request" id="id42">File upload (multi-part request)</a></li>
<li><a class="reference internal" href="#file-download" id="id43">File download</a></li>
<li><a class="reference internal" href="#how-to-handle-restful-url-uri-template-and-implementation-example" id="id44">How to handle RESTful URL (URI template) and implementation example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-extend" id="id45">How to extend</a><ul>
<li><a class="reference internal" href="#how-to-register-an-arbitrary-httpmessageconverter" id="id46">How to register an arbitrary <code class="docutils literal"><span class="pre">HttpMessageConverter</span></code></a></li>
<li><a class="reference internal" href="#application-of-common-process-clienthttprequestinterceptor" id="id47">Application of common process (<code class="docutils literal"><span class="pre">ClientHttpRequestInterceptor</span></code>)</a><ul>
<li><a class="reference internal" href="#logging-process" id="id48">Logging process</a></li>
<li><a class="reference internal" href="#request-header-setup-process-for-basic-authentication" id="id49">Request header setup process for Basic authentication</a></li>
<li><a class="reference internal" href="#applying-clienthttprequestinterceptor" id="id50">Applying <code class="docutils literal"><span class="pre">ClientHttpRequestInterceptor</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#asynchronous-request" id="id51">Asynchronous request</a><ul>
<li><a class="reference internal" href="#bean-definition-for-asyncresttemplate" id="id52">Bean definition for <code class="docutils literal"><span class="pre">AsyncRestTemplate</span></code></a></li>
<li><a class="reference internal" href="#implementation-of-asynchronous-request" id="id53">Implementation of asynchronous request</a></li>
<li><a class="reference internal" href="#implementation-of-common-processing-for-asynchronous-request" id="id54">Implementation of common processing for asynchronous request</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#appendix" id="id55">Appendix</a><ul>
<li><a class="reference internal" href="#how-to-configure-http-proxy-server" id="id56">How to configure HTTP Proxy server</a><ul>
<li><a class="reference internal" href="#how-to-specify-a-http-proxy-server" id="id57">How to specify a HTTP Proxy server</a></li>
<li><a class="reference internal" href="#how-to-specify-credentials-information-of-http-proxy-server" id="id58">How to specify credentials information of HTTP Proxy server</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuration-while-using-jsr-310-date-and-time-api-in-json" id="id59">Configuration while using JSR-310 Date and Time API in JSON</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<span id="restclientoverview"></span><h2><a class="toc-backref" href="#id12">5.2.1. Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This chapter explains how to call RESTful Web Service(REST API) by using <code class="docutils literal"><span class="pre">org.springframework.web.client.RestTemplate</span></code> offered by Spring Framework.</p>
<div class="section" id="what-is-resttemplate">
<span id="restclientoverviewresttemplate"></span><h3><a class="toc-backref" href="#id13">5.2.1.1. What is <code class="docutils literal"><span class="pre">RestTemplate</span></code></a><a class="headerlink" href="#what-is-resttemplate" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">RestTemplate</span></code> is a class which offers a method for calling REST API(Web API) and
is a HTTP client offered by Spring Framework.</p>
<p>The method by which <code class="docutils literal"><span class="pre">RestTemplate</span></code> access REST API (Web API) is explained before explaining basic implementation method.</p>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/RestClientOverview.png"><img alt="Constitution of RestTemplate" src="../../_images/RestClientOverview.png" style="width: 100%;" /></a>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="11%" />
<col width="22%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Component</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Application</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Call <code class="docutils literal"><span class="pre">RestTemplate</span></code> method and request to call REST API (Web API).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">RestTemplate</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">By using <code class="docutils literal"><span class="pre">HttpMessageConverter</span></code>, convert Java object to message (JSON etc.) which is to be configured in the request body.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch <code class="docutils literal"><span class="pre">ClientHttpRequest</span></code> from <code class="docutils literal"><span class="pre">ClientHttpRequestFactory</span></code> and request to send a message (JSON etc.).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">ClientHttpRequest</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Configure message (JSON etc) in the request body and carry out request in REST API (Web API) through HTTP.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">RestTemplate</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Determine errors and perform error handling for HTTP transmission using <code class="docutils literal"><span class="pre">ResponseErrorHandler</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">ResponseErrorHandler</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch response data from <code class="docutils literal"><span class="pre">ClientHttpResponse</span></code>, determine errors and perform error handling.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">RestTemplate</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">By using <code class="docutils literal"><span class="pre">HttpMessageConverter</span></code>, convert message configured in response body (JSON etc) to Java object.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Return results (Java object) of calling REST API (Web API) to the application.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Handling asynchronous processing</strong></p>
<p class="last">When response received from REST API is to be processed in another thread (asynchronous processing),
<code class="docutils literal"><span class="pre">org.springframework.web.client.AsyncRestTemplate</span></code> should be used instead of <code class="docutils literal"><span class="pre">RestTemplate</span></code>.
Refer <a class="reference internal" href="#restclientasync"><span class="std std-ref">Asynchronous request</span></a> for implementation example of asynchronous processing.</p>
</div>
<div class="section" id="httpmessageconverter">
<span id="restclientoverviewhttpmessageconverter"></span><h4><a class="toc-backref" href="#id14">5.2.1.1.1. <code class="docutils literal"><span class="pre">HttpMessageConverter</span></code></a><a class="headerlink" href="#httpmessageconverter" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">org.springframework.http.converter.HttpMessageConverter</span></code> is an interface which mutually converts Java object handled by application and message (JSON etc) for communicating with server.</p>
<p>When <code class="docutils literal"><span class="pre">RestTemplate</span></code> is used, implementation class of <code class="docutils literal"><span class="pre">HttpMessageConverter</span></code> below is registered by default.</p>
<table border="1" class="colwidths-given longtable docutils" id="id9">
<caption><span class="caption-text"><strong>HttpMessageConverter registered by default</strong></span><a class="headerlink" href="#id9" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="5%" />
<col width="25%" />
<col width="55%" />
<col width="15%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Class name</th>
<th class="head">Description</th>
<th class="head">Support type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.http.converter.</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">ByteArrayHttpMessageConverter</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A class for conversion of “HTTP body (text or binary data) ⇔ Byte array”.</div>
<div class="line">It supports all media types (<code class="docutils literal"><span class="pre">*/*</span></code>) by default.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">byte[]</span></code></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.http.converter.</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">StringHttpMessageConverter</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A class for conversion of “HTTP body (text) ⇔ String”.</div>
<div class="line">It supports all text media types (<code class="docutils literal"><span class="pre">text/*</span></code>) by default.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">String</span></code></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.http.converter.</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">ResourceHttpMessageConverter</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A class for conversion of “HTTP body (binary data) ⇔ Resource object of Spring”.</div>
<div class="line">It supports all media types (<code class="docutils literal"><span class="pre">*/*</span></code>) by default.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Resource</span></code> <a class="footnote-reference" href="#p1" id="id1">[1]</a></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.http.converter.xml.</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">SourceHttpMessageConverter</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A class for conversion of “HTTP body (XML) ⇔ XML source object”.</div>
<div class="line">It supports media types for XML (<code class="docutils literal"><span class="pre">text/xml</span></code>,<code class="docutils literal"><span class="pre">application/xml</span></code>,<code class="docutils literal"><span class="pre">application/*-xml</span></code>) by default.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Source</span></code> <a class="footnote-reference" href="#p2" id="id2">[2]</a></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.http.converter.support.</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">AllEncompassingFormHttpMessageConverter</span></code></div>
</div>
</td>
<td><div class="first line-block">
<div class="line">A class for conversion of “HTTP body ⇔ <code class="docutils literal"><span class="pre">MultiValueMap</span></code> object”.</div>
<div class="line">It is an extension class of <code class="docutils literal"><span class="pre">FormHttpMessageConverter</span></code> and supports conversion to XML and JSON as a multipart part data.</div>
<div class="line">It supports media types for form data (<code class="docutils literal"><span class="pre">application/x-www-form-urlencoded</span></code>,<code class="docutils literal"><span class="pre">multipart/form-data</span></code>) by default.</div>
</div>
<ul class="simple">
<li>When media type is <code class="docutils literal"><span class="pre">application/x-www-form-urlencoded</span></code>, the data is read / written as <code class="docutils literal"><span class="pre">MultiValueMap&lt;String,</span> <span class="pre">String&gt;</span></code>.</li>
<li>When media type is <code class="docutils literal"><span class="pre">multipart/form-data</span></code>, data is written as <code class="docutils literal"><span class="pre">MultiValueMap&lt;String,</span> <span class="pre">Object&gt;</span></code> and <code class="docutils literal"><span class="pre">Object</span></code> is converted by <code class="docutils literal"><span class="pre">HttpMessageConveter</span></code> configured separately in <code class="docutils literal"><span class="pre">AllEncompassingFormHttpMessageConverter</span></code>.
(Caution: Refer Note)</li>
</ul>
<div class="last line-block">
<div class="line">Refer <a class="reference external" href="https://github.com/spring-projects/spring-framework/blob/v4.3.11.RELEASE/spring-web/src/main/java/org/springframework/http/converter/support/AllEncompassingFormHttpMessageConverter.java">AllEncompassingFormHttpMessageConverter</a> and
<a class="reference external" href="https://github.com/spring-projects/spring-framework/blob/v4.3.11.RELEASE/spring-web/src/main/java/org/springframework/http/converter/FormHttpMessageConverter.java">FormHttpMessageConverter</a> source for <code class="docutils literal"><span class="pre">HttpMessageConveter</span></code> used for conversion of part data which is registered by default. Note that, it is also possible to register an arbitrary <code class="docutils literal"><span class="pre">HttpMessageConverter</span></code>.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">MultiValueMap</span></code> <a class="footnote-reference" href="#p3" id="id3">[3]</a></div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>When media type of AllEncompassingFormHttpMessageConverter is multipart/form-data</strong></p>
<p class="last">When media type is <code class="docutils literal"><span class="pre">multipart/form-data</span></code>, conversion of “HTTP body from <code class="docutils literal"><span class="pre">MultiValueMap</span></code> object” can be done, however,
conversion “from HTTP body to <code class="docutils literal"><span class="pre">MultiValueMap</span></code> object” is currently not supported.
Hence, an independent implementation is required if conversion “from HTTP body to <code class="docutils literal"><span class="pre">MultiValueMap</span></code> object” is to be carried out.</p>
</div>
<p></p>
<table border="1" class="colwidths-given longtable docutils" id="id10">
<caption><span class="caption-text"><strong>HttpMessageConverter that is registered when a dependent library exists on the class path</strong></span><a class="headerlink" href="#id10" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="5%" />
<col width="25%" />
<col width="55%" />
<col width="15%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Class Name</th>
<th class="head">Description</th>
<th class="head">Support type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.http.converter.feed.</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">AtomFeedHttpMessageConverter</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A class for conversion of “HTTP body (Atom) ⇔ Atom feed object”.</div>
<div class="line">It supports media type for ATOM (<code class="docutils literal"><span class="pre">application/atom+xml</span></code>) by default.</div>
<div class="line">(It is registered when ROME exists on the class path)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Feed</span></code> <a class="footnote-reference" href="#p4" id="id4">[4]</a></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.http.converter.feed.</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">RssChannelHttpMessageConverter</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A class for conversion of “HTTP body (RSS) ⇔ Rss channel object”.</div>
<div class="line">It supports media type for RSS (<code class="docutils literal"><span class="pre">application/rss+xml</span></code>) by default.</div>
<div class="line">(It is registered when ROME exists on the class path)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Channel</span></code> <a class="footnote-reference" href="#p5" id="id5">[5]</a></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.http.converter.json.</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">MappingJackson2HttpMessageConverter</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A class for conversion of “HTTP body (JSON) ⇔ JavaBean”.</div>
<div class="line">It supports media type for JSON (<code class="docutils literal"><span class="pre">application/json</span></code>,<code class="docutils literal"><span class="pre">application/*+json</span></code>) by default.</div>
<div class="line">(It is registered when Jackson2 exists on the class path)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Object</span></code> (JavaBean)</div>
<div class="line"><code class="docutils literal"><span class="pre">Map</span></code></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.http.converter.xml.</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">MappingJackson2XmlHttpMessageConverter</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A class for conversion of “HTTP body (XML) ⇔ JavaBean”.</div>
<div class="line">It supports media type for XML (<code class="docutils literal"><span class="pre">text/xml</span></code>,<code class="docutils literal"><span class="pre">application/xml</span></code>,<code class="docutils literal"><span class="pre">application/*-xml</span></code>) by default.</div>
<div class="line">(It is registered when Jackson-dataformat-xml exists on the class path)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Object</span></code> (JavaBean)</div>
<div class="line"><code class="docutils literal"><span class="pre">Map</span></code></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.http.converter.xml.</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">Jaxb2RootElementHttpMessageConverter</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A class for conversion of “HTTP body (XML) ⇔ JavaBean”.</div>
<div class="line">It supports media type for XML (<code class="docutils literal"><span class="pre">text/xml</span></code>,<code class="docutils literal"><span class="pre">application/xml</span></code>,<code class="docutils literal"><span class="pre">application/*-xml</span></code>) by default.</div>
<div class="line">(It is registered when JAXB exists on the class path)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Object</span></code> (JavaBean)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(11)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.http.converter.json.</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">GsonHttpMessageConverter</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A class for conversion of “HTTP body (JSON) ⇔ JavaBean”.</div>
<div class="line">It supports media type for JSON (<code class="docutils literal"><span class="pre">application/json</span></code>,<code class="docutils literal"><span class="pre">application/*+json</span></code>) by default.</div>
<div class="line">(It is registered when Gson exists on the class path)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Object</span></code> (JavaBean)</div>
<div class="line"><code class="docutils literal"><span class="pre">Map</span></code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p></p>
<table class="docutils footnote" frame="void" id="p1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><code class="docutils literal"><span class="pre">org.springframework.core.io</span></code> package class</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="p2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><code class="docutils literal"><span class="pre">javax.xml.transform</span></code> package class</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="p3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><code class="docutils literal"><span class="pre">org.springframework.util</span></code> package class</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="p4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td><code class="docutils literal"><span class="pre">com.rometools.rome.feed.atom</span></code> package class</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="p5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td><code class="docutils literal"><span class="pre">com.rometools.rome.feed.rss</span></code> package class</td></tr>
</tbody>
</table>
</div>
<div class="section" id="clienthttprequestfactory">
<span id="restclientoverviewclienthttprequestfactory"></span><h4><a class="toc-backref" href="#id15">5.2.1.1.2. <code class="docutils literal"><span class="pre">ClientHttpRequestFactory</span></code></a><a class="headerlink" href="#clienthttprequestfactory" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">RestTemplate</span></code> delegates the process of communicating with the server to implementation class of three interfaces given below.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">org.springframework.http.client.ClientHttpRequestFactory</span></code></li>
<li><code class="docutils literal"><span class="pre">org.springframework.http.client.ClientHttpRequest</span></code></li>
<li><code class="docutils literal"><span class="pre">org.springframework.http.client.ClientHttpResponse</span></code></li>
</ul>
<p>Of the 3 interfaces, the developers are aware of <code class="docutils literal"><span class="pre">ClientHttpRequestFactory</span></code> interface.
<code class="docutils literal"><span class="pre">ClientHttpRequestFactory</span></code> resolves a class (implementation class of <code class="docutils literal"><span class="pre">ClientHttpRequest</span></code> and <code class="docutils literal"><span class="pre">ClientHttpResponse</span></code> interface) which communicates with the server.</p>
<p>Note that, the main implementation class of <code class="docutils literal"><span class="pre">ClientHttpRequestFactory</span></code> offered by Spring Framework is as given below.</p>
<table border="1" class="colwidths-given docutils" id="id11">
<caption><span class="caption-text"><strong>Main implementation class of ClientHttpRequestFactory offered by Spring Framework</strong></span><a class="headerlink" href="#id11" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="5%" />
<col width="25%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Class Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.http.client.</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">SimpleClientHttpRequestFactory</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">An implementation class for communication (synchronous, asynchronous) by using <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/net/HttpURLConnection.html">HttpURLConnection</a> API of Java SE standard. (Implementation class used as a default)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.http.client.</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">Netty4ClientHttpRequestFactory</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">An implementation class for communication (synchronous, asynchronous) by using <a class="reference external" href="http://netty.io/">Netty 4</a> API.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.http.client.</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">HttpComponentsClientHttpRequestFactory</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">An implementation class for synchronous communication by using <a class="reference external" href="http://hc.apache.org/httpcomponents-client-ga/">Apache HttpComponents HttpClient</a> API. (HttpClient 4.3 and above versions are required)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.http.client.</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">HttpComponentsAsyncClientHttpRequestFactory</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">An implementation class for asynchronous communication by using <a class="reference external" href="http://hc.apache.org/httpcomponents-asyncclient-dev/">Apache HttpComponents HttpAsyncClient</a> API. (HttpAsyncClient 4.0 and above version are required)</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.http.client.</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">OkHttpClientHttpRequestFactory</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">An implementation class for communication (synchronous, asynchronous) by using <a class="reference external" href="http://square.github.io/okhttp/">Square OkHttp</a> API.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Regarding implementation class of ClientHttpRequestFactory to be used</strong></p>
<p class="last">Default implementation used by <code class="docutils literal"><span class="pre">RestTemplate</span></code> is <code class="docutils literal"><span class="pre">SimpleClientHttpRequestFactory</span></code> and it can also act as an implementation example in this guideline while using <code class="docutils literal"><span class="pre">SimpleClientHttpRequestFactory</span></code>.
If it does not meet requirements in <code class="docutils literal"><span class="pre">HttpURLConnection</span></code> of Java SE, using libraries like Netty, Apache Http Components can be explored.</p>
</div>
</div>
<div class="section" id="responseerrorhandler">
<span id="restclientoverviewresponseerrorhandler"></span><h4><a class="toc-backref" href="#id16">5.2.1.1.3. <code class="docutils literal"><span class="pre">ResponseErrorHandler</span></code></a><a class="headerlink" href="#responseerrorhandler" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">RestTemplate</span></code> handles the errors during the communication with the server by delegating to <code class="docutils literal"><span class="pre">org.springframework.web.client.ResponseErrorHandler</span></code> interface.</p>
<ul class="simple">
<li>A method to determine errors (<code class="docutils literal"><span class="pre">hasError</span></code>)</li>
<li>A method to handle errors (<code class="docutils literal"><span class="pre">handleError</span></code>)</li>
</ul>
<p>are defined in <code class="docutils literal"><span class="pre">ResponseErrorHandler</span></code>. Spring Framework offers <code class="docutils literal"><span class="pre">org.springframework.web.client.DefaultResponseErrorHandler</span></code> as a default implementation.</p>
<p><code class="docutils literal"><span class="pre">DefaultResponseErrorHandler</span></code> carries out error handling as below according to values of HTTP status codes which have been sent as a response from the server.</p>
<ul class="simple">
<li>When response code is standard (2xx), error handling is not carried out.</li>
<li>When response code is from client error system (4xx), <code class="docutils literal"><span class="pre">org.springframework.web.client.HttpClientErrorException</span></code> is generated.</li>
<li>When response code is from server error system (5xx), <code class="docutils literal"><span class="pre">org.springframework.web.client.HttpServerErrorException</span></code> is generated.</li>
<li>When response code is undefined (user defined custom code), <code class="docutils literal"><span class="pre">org.springframework.web.client.UnknownHttpStatusCodeException</span></code> is generated.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>How to fetch response data at the time of error</strong></p>
<p class="last">Response data at the time of error (HTTP status code,  response header, response body etc) can be fetched by calling getter method of exception class.</p>
</div>
</div>
<div class="section" id="clienthttprequestinterceptor">
<span id="restclientoverviewclienthttprequestinterceptor"></span><h4><a class="toc-backref" href="#id17">5.2.1.1.4. <code class="docutils literal"><span class="pre">ClientHttpRequestInterceptor</span></code></a><a class="headerlink" href="#clienthttprequestinterceptor" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">org.springframework.http.client.ClientHttpRequestInterceptor</span></code> is an interface for implementing a common process before and after communicating with the server.</p>
<p>If <code class="docutils literal"><span class="pre">ClientHttpRequestInterceptor</span></code> is used, the common processes like</p>
<ul class="simple">
<li>Communication log with server</li>
<li>Configuration of authentication header</li>
</ul>
<p>can be applied in <code class="docutils literal"><span class="pre">RestTemplate</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Action specifications for ClientHttpRequestInterceptor</strong></p>
<p><code class="docutils literal"><span class="pre">ClientHttpRequestInterceptor</span></code> can be used for multiple times and is executed as a chain in a specified sequence.
This operation is similar to working of a servlet filter and the HTTP communication process by <code class="docutils literal"><span class="pre">ClientHttpRequest</span></code> is registered as a chain destination executed at the end.
For example, when you want to cancel communication with the server once it fulfils a certain condition, a chain destination need not be called.</p>
<p>When this system is used, processes like</p>
<ul class="simple">
<li>Blocking communication with server</li>
<li>Retrying communication process</li>
</ul>
<p class="last">can also be applied.</p>
</div>
</div>
</div>
</div>
<div class="section" id="how-to-use">
<span id="restclienthowtouse"></span><h2><a class="toc-backref" href="#id18">5.2.2. How to use</a><a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h2>
<p>This chapter explains how to implement a client process which uses <code class="docutils literal"><span class="pre">RestTemplate</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Regarding HTTP method supported by RestTemplate</strong></p>
<p class="last">In this guideline, only the implementation example of client process which use GET method and POST method is introduced, however,
<code class="docutils literal"><span class="pre">RestTemplate</span></code> supports other HTTP methods (PUT, PATCH, DELETE, HEAD, OPTIONS etc) as well and can be used in the similar way.
Refer Javadoc of <a class="reference external" href="http://docs.spring.io/spring/docs/4.3.11.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html">RestTemplate</a> for details.</p>
</div>
<div class="section" id="resttemplate-setup">
<span id="restclienthowtousesetup"></span><h3><a class="toc-backref" href="#id19">5.2.2.1. <code class="docutils literal"><span class="pre">RestTemplate</span></code> Setup</a><a class="headerlink" href="#resttemplate-setup" title="Permalink to this headline">¶</a></h3>
<p>When <code class="docutils literal"><span class="pre">RestTemplate</span></code> is used, <code class="docutils literal"><span class="pre">RestTemplate</span></code> is registered in DI container and injected in the component which uses <code class="docutils literal"><span class="pre">RestTemplate</span></code>.</p>
<div class="section" id="dependent-library-setup">
<h4><a class="toc-backref" href="#id20">5.2.2.1.1. Dependent library setup</a><a class="headerlink" href="#dependent-library-setup" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">spring-web library of Spring Framework is added to <code class="docutils literal"><span class="pre">pom.xml</span></code> for using <code class="docutils literal"><span class="pre">RestTemplate</span></code>.</div>
<div class="line">In case of multi-project configuration, it is added to <code class="docutils literal"><span class="pre">pom.xml</span></code> of domain project.</div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependencies&gt;</span>

    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-web<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;/dependencies&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the above setting example, since it is assumed that the dependent library version is managed by the parent project terasoluna-gfw-parent , specifying the version in pom.xml is not necessary.
The above dependent library used by terasoluna-gfw-parent is defined by <a class="reference external" href="http://platform.spring.io/platform/">Spring IO Platform</a>.</p>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add <code class="docutils literal"><span class="pre">spring-web</span></code> library of Spring Framework to dependencies.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="bean-definition-of-resttemplate">
<h4><a class="toc-backref" href="#id21">5.2.2.1.2. Bean definition of <code class="docutils literal"><span class="pre">RestTemplate</span></code></a><a class="headerlink" href="#bean-definition-of-resttemplate" title="Permalink to this headline">¶</a></h4>
<p>Define bean for <code class="docutils literal"><span class="pre">RestTemplate</span></code> and register in DI container.</p>
<p><strong>Definition example of bean definition file (applicationContext.xml)</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;restTemplate&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.web.client.RestTemplate&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When <code class="docutils literal"><span class="pre">RestTemplate</span></code> is used similar to default configuration, register a bean by using default constructor.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>How to customise RestTemplate</strong></p>
<p>When HTTP communication process is to be customised, define a bean as below.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;clientHttpRequestFactory&quot;</span>
      <span class="na">class=</span><span class="s">&quot;org.springframework.http.client.SimpleClientHttpRequestFactory&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="c">&lt;!-- Set properties for customize a http communication (omit on this sample) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;restTemplate&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.web.client.RestTemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">ref=</span><span class="s">&quot;clientHttpRequestFactory&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define a bean for <code class="docutils literal"><span class="pre">ClientHttpRequestFactory</span></code>.</div>
<div class="line">A method to customise timeout configuration is introduced in this guideline. Refer <a class="reference internal" href="#restclienthowtousetimeoutsettings"><span class="std std-ref">Setting communication timeout</span></a> for details.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Register a bean by using a constructor which specifies <code class="docutils literal"><span class="pre">ClientHttpRequestFactory</span></code> in the argument.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Also, refer</p>
<ul class="simple">
<li><a class="reference internal" href="#restclienthowtoextendhttpmessageconverter"><span class="std std-ref">How to register an arbitrary HttpMessageConverter</span></a></li>
<li><a class="reference internal" href="#restclienthowtouseerrorhandlingresponseentity"><span class="std std-ref">Returning ResponseEntity (Error handler extension)</span></a></li>
<li><a class="reference internal" href="#restclienthowtoextendclienthttprequestinterceptor"><span class="std std-ref">Application of common process (ClientHttpRequestInterceptor)</span></a></li>
</ul>
<p class="last">for how to customise <code class="docutils literal"><span class="pre">HttpMessageConverter</span></code>, <code class="docutils literal"><span class="pre">ResponseErrorHandler</span></code> and <code class="docutils literal"><span class="pre">ClientHttpRequestInterceptor</span></code>.</p>
</div>
</div>
<div class="section" id="using-resttemplate">
<h4><a class="toc-backref" href="#id22">5.2.2.1.3. Using <code class="docutils literal"><span class="pre">RestTemplate</span></code></a><a class="headerlink" href="#using-resttemplate" title="Permalink to this headline">¶</a></h4>
<p>When <code class="docutils literal"><span class="pre">RestTemplate</span></code> is used, <code class="docutils literal"><span class="pre">RestTemplate</span></code> registered in DI container is injected.</p>
<p><strong>Injection example for RestTemplate</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccountServiceImpl</span> <span class="kd">implements</span> <span class="n">AccountService</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">RestTemplate</span> <span class="n">restTemplate</span><span class="o">;</span>

    <span class="c1">// ...</span>

<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="sending-get-request">
<span id="restclienthowtouseget"></span><h3><a class="toc-backref" href="#id23">5.2.2.2. Sending GET request</a><a class="headerlink" href="#sending-get-request" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">RestTemplate</span></code> offers multiple methods to send a GET request.</p>
<ul class="simple">
<li>Usually, <code class="docutils literal"><span class="pre">getForObject</span></code> method or <code class="docutils literal"><span class="pre">getForEntity</span></code> method are used.</li>
<li>When a detailed setting such as setting a header is to be carried out, <code class="docutils literal"><span class="pre">org.springframework.http.RequestEntity</span></code> and <code class="docutils literal"><span class="pre">exchange</span></code> methods are used.</li>
</ul>
<div class="section" id="implementation-by-using-getforobject-method">
<h4><a class="toc-backref" href="#id24">5.2.2.2.1. Implementation by using <code class="docutils literal"><span class="pre">getForObject</span></code> method</a><a class="headerlink" href="#implementation-by-using-getforobject-method" title="Permalink to this headline">¶</a></h4>
<p>When only the response body is required to be fetched, <code class="docutils literal"><span class="pre">getForObject</span></code> method is used.</p>
<p><strong>How to use getForObject method</strong></p>
<p>Field declaration part</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Value</span><span class="o">(</span><span class="s">&quot;${api.url:http://localhost:8080/api}&quot;</span><span class="o">)</span>
<span class="n">URI</span> <span class="n">uri</span><span class="o">;</span>
</pre></div>
</div>
<p>Internal method</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="o">.</span><span class="na">getForObject</span><span class="o">(</span><span class="n">uri</span><span class="o">,</span> <span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> <span class="c1">// (1)</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When <code class="docutils literal"><span class="pre">getForObject</span></code> method is used, the response body value is sent as a return value.</div>
<div class="line">Response body data is returned after it has been converted to Java class specified in the second argument, by using <code class="docutils literal"><span class="pre">HttpMessageConverter</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="implementation-by-using-getforentity-method">
<h4><a class="toc-backref" href="#id25">5.2.2.2.2. Implementation by using <code class="docutils literal"><span class="pre">getForEntity</span></code> method</a><a class="headerlink" href="#implementation-by-using-getforentity-method" title="Permalink to this headline">¶</a></h4>
<p>When HTTP status code, response header and response body must be fetched, <code class="docutils literal"><span class="pre">getForEntity</span></code> method is used.</p>
<p><strong>How to use getForEntity method</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">responseEntity</span> <span class="o">=</span>
        <span class="n">restTemplate</span><span class="o">.</span><span class="na">getForEntity</span><span class="o">(</span><span class="n">uri</span><span class="o">,</span> <span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> <span class="c1">// (1)</span>
<span class="n">HttpStatus</span> <span class="n">statusCode</span> <span class="o">=</span> <span class="n">responseEntity</span><span class="o">.</span><span class="na">getStatusCode</span><span class="o">();</span> <span class="c1">// (2)</span>
<span class="n">HttpHeaders</span> <span class="n">header</span> <span class="o">=</span> <span class="n">responseEntity</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">();</span> <span class="c1">// (3)</span>
<span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">responseEntity</span><span class="o">.</span><span class="na">getBody</span><span class="o">();</span> <span class="c1">// (4)</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When <code class="docutils literal"><span class="pre">getForEntity</span></code> method is used, <code class="docutils literal"><span class="pre">org.springframework.http.ResponseEntity</span></code> is sent as a return value.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch HTTP status code by using <code class="docutils literal"><span class="pre">getStatusCode</span></code> method.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch response header by using <code class="docutils literal"><span class="pre">getHeaders</span></code> method.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch response body by using <code class="docutils literal"><span class="pre">getBody</span></code> method.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>ResponseEntity</strong></p>
<p class="last"><code class="docutils literal"><span class="pre">ResponseEntity</span></code> is a class which shows HTTP response and can fetch HTTP status code, response header and response body information.
Refer Javadoc of <a class="reference external" href="http://docs.spring.io/spring/docs/4.3.11.RELEASE/javadoc-api/org/springframework/http/ResponseEntity.html">ResponseEntity</a> for details.</p>
</div>
</div>
<div class="section" id="implementation-by-using-exchange-method">
<h4><a class="toc-backref" href="#id26">5.2.2.2.3. Implementation by using <code class="docutils literal"><span class="pre">exchange</span></code> method</a><a class="headerlink" href="#implementation-by-using-exchange-method" title="Permalink to this headline">¶</a></h4>
<p>When a request header must be specified, <code class="docutils literal"><span class="pre">org.springframework.http.RequestEntity</span></code> is generated and <code class="docutils literal"><span class="pre">exchange</span></code> method is used.</p>
<p><strong>How to use exchange method</strong></p>
<p>import part</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.springframework.http.RequestEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.ResponseEntity</span><span class="o">;</span>
</pre></div>
</div>
<p>Field declaration part</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Value</span><span class="o">(</span><span class="s">&quot;${api.url:http://localhost:8080/api}&quot;</span><span class="o">)</span>
<span class="n">URI</span> <span class="n">uri</span><span class="o">;</span>
</pre></div>
</div>
<p>Internal method</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">RequestEntity</span> <span class="n">requestEntity</span> <span class="o">=</span> <span class="n">RequestEntity</span>
        <span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">uri</span><span class="o">)</span><span class="c1">//(1)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span><span class="c1">//(2)</span>

<span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">responseEntity</span> <span class="o">=</span>
        <span class="n">restTemplate</span><span class="o">.</span><span class="na">exchange</span><span class="o">(</span><span class="n">requestEntity</span><span class="o">,</span> <span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span><span class="c1">//(3)</span>

<span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">responseEntity</span><span class="o">.</span><span class="na">getBody</span><span class="o">();</span><span class="c1">//(4)</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use <code class="docutils literal"><span class="pre">get</span></code> method of <code class="docutils literal"><span class="pre">RequestEntity</span></code> and generate request builder for GET request.</div>
<div class="line">Specify URI in the parameter.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use <code class="docutils literal"><span class="pre">build</span></code> method of <code class="docutils literal"><span class="pre">RequestEntity.HeadersBuilder</span></code> and create <code class="docutils literal"><span class="pre">RequestEntity</span></code> object.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use <code class="docutils literal"><span class="pre">exchange</span></code> method and send request. Specify response data type in the second argument.</div>
<div class="line"><code class="docutils literal"><span class="pre">ResponseEntity&lt;T&gt;</span></code> is sent as a response. Specify response data type in Type parameter.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use <code class="docutils literal"><span class="pre">getBody</span></code> method and fetch response body data.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>RequestEntity</strong></p>
<p><code class="docutils literal"><span class="pre">RequestEntity</span></code> is a class which shows HTTP request and can set connection URI, HTTP method, request header and request body.
Refer Javadoc of <a class="reference external" href="http://docs.spring.io/spring/docs/4.3.11.RELEASE/javadoc-api/org/springframework/http/RequestEntity.html">RequestEntity</a> for details.</p>
<p class="last">Also, refer <a class="reference internal" href="#restclienthowtouserequestheader"><span class="std std-ref">Configuration of request header</span></a> for how to configure a request header.</p>
</div>
</div>
</div>
<div class="section" id="sending-post-request">
<span id="restclienthowtousepost"></span><h3><a class="toc-backref" href="#id27">5.2.2.3. Sending POST request</a><a class="headerlink" href="#sending-post-request" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">RestTemplate</span></code> offers multiple methods for carrying out POST request.</p>
<ul class="simple">
<li>Usually, <code class="docutils literal"><span class="pre">postForObject</span></code> and <code class="docutils literal"><span class="pre">postForEntity</span></code> are used.</li>
<li>When a detailed setting like setting any header is to be carried out, <code class="docutils literal"><span class="pre">RequestEntity</span></code> and <code class="docutils literal"><span class="pre">exchange</span></code> methods are used.</li>
</ul>
<div class="section" id="implementation-by-using-postforobject-method">
<h4><a class="toc-backref" href="#id28">5.2.2.3.1. Implementation by using <code class="docutils literal"><span class="pre">postForObject</span></code> method</a><a class="headerlink" href="#implementation-by-using-postforobject-method" title="Permalink to this headline">¶</a></h4>
<p>When only response body is required to be fetched as POST results, <code class="docutils literal"><span class="pre">postForObject</span></code> method is used.</p>
<p><strong>How to use postForObject method</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">();</span>

<span class="c1">//...</span>

<span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="o">.</span><span class="na">postForObject</span><span class="o">(</span><span class="n">uri</span><span class="o">,</span> <span class="n">user</span><span class="o">,</span> <span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> <span class="c1">// (1)</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">postForObject</span></code> method can easily implement a POST request.</div>
<div class="line">Specify Java object in the second argument which is converted to request body by using <code class="docutils literal"><span class="pre">HttpMessageConverter</span></code>.</div>
<div class="line">When <code class="docutils literal"><span class="pre">postForObject</span></code> method is used, response body value is sent as a return value.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="implementation-using-postforentity-method">
<h4><a class="toc-backref" href="#id29">5.2.2.3.2. Implementation using <code class="docutils literal"><span class="pre">postForEntity</span></code> method</a><a class="headerlink" href="#implementation-using-postforentity-method" title="Permalink to this headline">¶</a></h4>
<p>When HTTP status code, response header and response body are to be fetched as POST results, <code class="docutils literal"><span class="pre">postForEntity</span></code> method is used.</p>
<p><strong>How to use postForEntity method</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">();</span>

<span class="c1">//...</span>

<span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">responseEntity</span> <span class="o">=</span>
        <span class="n">restTemplate</span><span class="o">.</span><span class="na">postForEntity</span><span class="o">(</span><span class="n">uri</span><span class="o">,</span> <span class="n">user</span><span class="o">,</span> <span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> <span class="c1">// (1)</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">postForEntity</span></code> method can implement a POST request easily similar to <code class="docutils literal"><span class="pre">getForObject</span></code> method.</div>
<div class="line">When <code class="docutils literal"><span class="pre">postForEntity</span></code> method is used, <code class="docutils literal"><span class="pre">ResponseEntity</span></code> is sent as a return value.</div>
<div class="line">Fetch response body value from <code class="docutils literal"><span class="pre">ResponseEntity</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="implementation-using-exchange-method">
<h4><a class="toc-backref" href="#id30">5.2.2.3.3. Implementation using <code class="docutils literal"><span class="pre">exchange</span></code> method</a><a class="headerlink" href="#implementation-using-exchange-method" title="Permalink to this headline">¶</a></h4>
<p>When a request header is to be specified, <code class="docutils literal"><span class="pre">RequestEntity</span></code> is generated and <code class="docutils literal"><span class="pre">exchange</span></code> method is used.</p>
<p><strong>How to use exchange method</strong></p>
<p>import part</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.springframework.http.RequestEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.ResponseEntity</span><span class="o">;</span>
</pre></div>
</div>
<p>Field declaration part</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Value</span><span class="o">(</span><span class="s">&quot;${api.url:http://localhost:8080/api}&quot;</span><span class="o">)</span>
<span class="n">URI</span> <span class="n">uri</span><span class="o">;</span>
</pre></div>
</div>
<p>Internal method</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">();</span>

<span class="c1">//...</span>

<span class="n">RequestEntity</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">requestEntity</span> <span class="o">=</span> <span class="n">RequestEntity</span><span class="c1">//(1)</span>
        <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">uri</span><span class="o">)</span><span class="c1">//(2)</span>
        <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">user</span><span class="o">);</span><span class="c1">//(3)</span>

<span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">responseEntity</span> <span class="o">=</span>
        <span class="n">restTemplate</span><span class="o">.</span><span class="na">exchange</span><span class="o">(</span><span class="n">requestEntity</span><span class="o">,</span> <span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span><span class="c1">//(4)</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use <code class="docutils literal"><span class="pre">RequestEntity</span></code> and generate a request. Specify type of the data specified in the request body, in Type parameter.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use <code class="docutils literal"><span class="pre">post</span></code> method and generate a request builder for POST request. Specify URI in the parameter.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use <code class="docutils literal"><span class="pre">body</span></code> method of <code class="docutils literal"><span class="pre">RequestEntity.BodyBuilder</span></code> and create <code class="docutils literal"><span class="pre">RequestEntity</span></code> object.</div>
<div class="line">Specify Java object that has been converted to request body, in the parameter.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use <code class="docutils literal"><span class="pre">exchange</span></code> method and send a request.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>How to configure a request header</strong></p>
<p class="last">Refer <a class="reference internal" href="#restclienthowtouserequestheader"><span class="std std-ref">Configuration of request header</span></a> for how to configure a request header.</p>
</div>
</div>
</div>
<div class="section" id="fetch-data-in-collection-format">
<span id="restclienthowtousegetcollection"></span><h3><a class="toc-backref" href="#id31">5.2.2.4. Fetch data in collection format</a><a class="headerlink" href="#fetch-data-in-collection-format" title="Permalink to this headline">¶</a></h3>
<p>When the message of response body received from server as a response is in collection format, the implementation is as below.</p>
<p><strong>How to fetch data in collection format</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;&gt;</span> <span class="n">responseEntity</span> <span class="o">=</span> <span class="c1">//(1)</span>
    <span class="n">restTemplate</span><span class="o">.</span><span class="na">exchange</span><span class="o">(</span><span class="n">requestEntity</span><span class="o">,</span> <span class="k">new</span> <span class="n">ParameterizedTypeReference</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;&gt;(){});</span> <span class="c1">//(2)</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">userList</span> <span class="o">=</span> <span class="n">responseEntity</span><span class="o">.</span><span class="na">getBody</span><span class="o">();</span><span class="c1">//(3)</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify <code class="docutils literal"><span class="pre">List</span></code>&lt;Response data type&gt; in <code class="docutils literal"><span class="pre">ResponseEntity</span></code> Type parameter.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify instance of <code class="docutils literal"><span class="pre">org.springframework.core.ParameterizedTypeReference</span></code> in the second argument of <code class="docutils literal"><span class="pre">exchange</span></code> method, and specify <code class="docutils literal"><span class="pre">List</span></code>&lt;Response data type&gt; in Type parameter.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch response body data by <code class="docutils literal"><span class="pre">getBody</span></code> method.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="configuration-of-request-header">
<span id="restclienthowtouserequestheader"></span><h3><a class="toc-backref" href="#id32">5.2.2.5. Configuration of request header</a><a class="headerlink" href="#configuration-of-request-header" title="Permalink to this headline">¶</a></h3>
<p>If <code class="docutils literal"><span class="pre">RequestEntity</span></code> and <code class="docutils literal"><span class="pre">exchange</span></code> methods are used, a specific header or any other header can be set by using <code class="docutils literal"><span class="pre">RequestEntity</span></code> method.
Refer Javadoc of <a class="reference external" href="http://docs.spring.io/spring/docs/4.3.11.RELEASE/javadoc-api/org/springframework/http/RequestEntity.html">RequestEntity</a> for details.</p>
<p>This guideline explains about</p>
<ul class="simple">
<li><a class="reference internal" href="#restclienthowtouserequestheadercontenttype"><span class="std std-ref">Configuration of Content-Type header</span></a></li>
<li><a class="reference internal" href="#restclienthowtouserequestheaderaccept"><span class="std std-ref">Configuration of Accept header</span></a></li>
<li><a class="reference internal" href="#restclienthowtouserequestheaderanyheader"><span class="std std-ref">Configuration of an  arbitrary request header</span></a></li>
</ul>
<div class="section" id="configuration-of-content-type-header">
<span id="restclienthowtouserequestheadercontenttype"></span><h4><a class="toc-backref" href="#id33">5.2.2.5.1. Configuration of Content-Type header</a><a class="headerlink" href="#configuration-of-content-type-header" title="Permalink to this headline">¶</a></h4>
<p>While sending data to server, a usual Content-Type header must be specified.</p>
<p><strong>How to configure Content-Type header</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">();</span>

<span class="c1">//...</span>

<span class="n">RequestEntity</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">requestEntity</span> <span class="o">=</span> <span class="n">RequestEntity</span>
        <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">uri</span><span class="o">)</span>
        <span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span> <span class="c1">// (1)</span>
        <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use <code class="docutils literal"><span class="pre">contentType</span></code> method of <code class="docutils literal"><span class="pre">RequestEntity.BodyBuilder</span></code> and specify value of Context-Type header.</div>
<div class="line">In the implementation example above, “<code class="docutils literal"><span class="pre">application/json</span></code>”  is specified which indicates that the data format is JSON.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="configuration-of-accept-header">
<span id="restclienthowtouserequestheaderaccept"></span><h4><a class="toc-backref" href="#id34">5.2.2.5.2. Configuration of Accept header</a><a class="headerlink" href="#configuration-of-accept-header" title="Permalink to this headline">¶</a></h4>
<p>When the format of data to be fetched from server is specified, Accept header must be specified.
When the server does not support multiple data format responses, Accept header may not be specified explicitly.</p>
<p><strong>Configuration example of Accept header</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">();</span>

<span class="c1">//...</span>

<span class="n">RequestEntity</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">requestEntity</span> <span class="o">=</span> <span class="n">RequestEntity</span>
        <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">uri</span><span class="o">)</span>
        <span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span> <span class="c1">// (1)</span>
        <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use <code class="docutils literal"><span class="pre">accept</span></code> method of <code class="docutils literal"><span class="pre">RequestEntity.HeadersBuilder</span></code> and specify value of Accept header.</div>
<div class="line">In the implementation example above, “<code class="docutils literal"><span class="pre">application/json</span></code>” is specified which indicates that format of the data that can be fetched is JSON format.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="configuration-of-an-arbitrary-request-header">
<span id="restclienthowtouserequestheaderanyheader"></span><h4><a class="toc-backref" href="#id35">5.2.2.5.3. Configuration of an  arbitrary request header</a><a class="headerlink" href="#configuration-of-an-arbitrary-request-header" title="Permalink to this headline">¶</a></h4>
<p>A request header must be specified to access server.</p>
<p><strong>Configuration example for an arbitrary header</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">();</span>

<span class="c1">//...</span>

<span class="n">RequestEntity</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">requestEntity</span> <span class="o">=</span> <span class="n">RequestEntity</span>
        <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">uri</span><span class="o">)</span>
        <span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">&quot;Authorization&quot;</span><span class="o">,</span> <span class="s">&quot;Basic &quot;</span> <span class="o">+</span> <span class="n">base64Credentials</span><span class="o">)</span> <span class="c1">// (1)</span>
        <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use <code class="docutils literal"><span class="pre">header</span></code> method of <code class="docutils literal"><span class="pre">RequestEntity.HeadersBuilder</span></code> and specify name and value of request header.</div>
<div class="line">In the implementation example above, credentials information necessary for Basic authentication is specified in Authorization header.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="error-handling">
<span id="restclienthowtouseerrorhandling"></span><h3><a class="toc-backref" href="#id36">5.2.2.6. Error Handling</a><a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h3>
<div class="section" id="exception-handling-default-behaviour">
<span id="restclienthowtouseerrorhandlinghandleexception"></span><h4><a class="toc-backref" href="#id37">5.2.2.6.1. Exception Handling (Default Behaviour)</a><a class="headerlink" href="#exception-handling-default-behaviour" title="Permalink to this headline">¶</a></h4>
<p>Exceptions like</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">HttpClientErrorException</span></code> when response code is of client error system (4xx)</li>
<li><code class="docutils literal"><span class="pre">HttpServerErrorException</span></code> when response code is of server error system (5xx)</li>
<li><code class="docutils literal"><span class="pre">UnknownHttpStatusCodeException</span></code> when response code is a undefined code (user defined custom code)</li>
</ul>
<p>occur in default implementation (<code class="docutils literal"><span class="pre">DefaultResponseErrorHandler</span></code>) of <code class="docutils literal"><span class="pre">RestTemplate</span></code>, these exceptions must be handled as and when necessary.</p>
<p><strong>Implementation example of exception handling</strong></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>An example of exception handling when a server error has occurred is shown below as an implementation example.</p>
<p class="last"><strong>Appropriate exception handling must be carried out</strong> as per requirements of an application.</p>
</div>
<p>Field declaration part</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Value</span><span class="o">(</span><span class="s">&quot;${api.retry.maxCount}&quot;</span><span class="o">)</span>
<span class="kt">int</span> <span class="n">retryMaxCount</span><span class="o">;</span>

<span class="nd">@Value</span><span class="o">(</span><span class="s">&quot;${api.retry.retryWaitTimeCoefficient}&quot;</span><span class="o">)</span>
<span class="kt">int</span> <span class="n">retryWaitTimeCoefficient</span><span class="o">;</span>
</pre></div>
</div>
<p>Internal method</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">retryCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>

        <span class="n">responseEntity</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="o">.</span><span class="na">exchange</span><span class="o">(</span><span class="n">requestEntity</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">log</span><span class="o">.</span><span class="na">isInfoEnabled</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Success({}) &quot;</span><span class="o">,</span> <span class="n">responseEntity</span><span class="o">.</span><span class="na">getStatusCode</span><span class="o">());</span>
        <span class="o">}</span>

        <span class="k">break</span><span class="o">;</span>

    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">HttpServerErrorException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// (1)</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">retryCount</span> <span class="o">==</span> <span class="n">retryMaxCount</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="n">e</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">retryCount</span><span class="o">++;</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">log</span><span class="o">.</span><span class="na">isWarnEnabled</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&quot;An error ({}) occurred on the server. (The number of retries：{} Times)&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getStatusCode</span><span class="o">(),</span>
                <span class="n">retryCount</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">retryWaitTimeCoefficient</span> <span class="o">*</span> <span class="n">retryCount</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">ie</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="c1">//...</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Catch exception and perform error handling. In case of a server error (500 system), catch <code class="docutils literal"><span class="pre">HttpServerErrorException</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="returning-responseentity-error-handler-extension">
<span id="restclienthowtouseerrorhandlingresponseentity"></span><h4><a class="toc-backref" href="#id38">5.2.2.6.2. Returning <code class="docutils literal"><span class="pre">ResponseEntity</span></code> (Error handler extension)</a><a class="headerlink" href="#returning-responseentity-error-handler-extension" title="Permalink to this headline">¶</a></h4>
<p>By setting implementation class of <code class="docutils literal"><span class="pre">org.springframework.web.client.ResponseErrorHandler</span></code> interface in <code class="docutils literal"><span class="pre">RestTemplate</span></code>, an independent error handling process can be carried out.</p>
<p>In the example below, the error handler is extended so as to return <code class="docutils literal"><span class="pre">ResponseEntity</span></code> even when a server error and a client error has occurred.</p>
<p><strong>How to create an implementation class of error handler</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.springframework.http.client.ClientHttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.client.DefaultResponseErrorHandler</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomErrorHandler</span> <span class="kd">extends</span> <span class="n">DefaultResponseErrorHandler</span> <span class="o">{</span> <span class="c1">// (1)</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleError</span><span class="o">(</span><span class="n">ClientHttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="c1">//Don&#39;t throw Exception.</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create implementation class of <code class="docutils literal"><span class="pre">ResponseErrorHandler</span></code> interface.</div>
<div class="line">In the implementation example above, <code class="docutils literal"><span class="pre">DefaultResponseErrorHandler</span></code> - an implementation class of default error handler is extended</div>
<div class="line">and <code class="docutils literal"><span class="pre">ResponseEntity</span></code> is returned without generating an exception when a server error and client error has occurred.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>Implementation example of bean definition file (applicationContext.xml)</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;customErrorHandler&quot;</span> <span class="na">class=</span><span class="s">&quot;com.example.restclient.CustomErrorHandler&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;restTemplate&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.web.client.RestTemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;errorHandler&quot;</span> <span class="na">ref=</span><span class="s">&quot;customErrorHandler&quot;</span> <span class="nt">/&gt;</span><span class="c">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define bean for implementation class of <code class="docutils literal"><span class="pre">ResponseErrorHandler</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Inject <code class="docutils literal"><span class="pre">ResponseErrorHandler</span></code> bean in <code class="docutils literal"><span class="pre">errorHandler</span></code> property.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>Implementation example of client process</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">retryCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">responseEntity</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="o">.</span><span class="na">exchange</span><span class="o">(</span><span class="n">requestEntity</span><span class="o">,</span> <span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">responseEntity</span><span class="o">.</span><span class="na">getStatusCode</span><span class="o">()</span> <span class="o">==</span> <span class="n">HttpStatus</span><span class="o">.</span><span class="na">OK</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// (1)</span>

        <span class="k">break</span><span class="o">;</span>

    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">responseEntity</span><span class="o">.</span><span class="na">getStatusCode</span><span class="o">()</span> <span class="o">==</span> <span class="n">HttpStatus</span><span class="o">.</span><span class="na">SERVICE_UNAVAILABLE</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// (2)</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">retryCount</span> <span class="o">==</span> <span class="n">retryMaxCount</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">retryCount</span><span class="o">++;</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">log</span><span class="o">.</span><span class="na">isWarnEnabled</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&quot;An error ({}) occurred on the server. (The number of retries：{} Times)&quot;</span><span class="o">,</span>
                <span class="n">responseEntity</span><span class="o">.</span><span class="na">getStatusCode</span><span class="o">(),</span> <span class="n">retryCount</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">retryWaitTimeCoefficient</span> <span class="o">*</span> <span class="n">retryCount</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">ie</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="c1">//...</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In the implementation example above, since error handler is extended so as to return <code class="docutils literal"><span class="pre">ResponseEntity</span></code> even at the time of error, it is necessary to check whether process results are normal after fetching HTTP status code from <code class="docutils literal"><span class="pre">ResponseEntity</span></code> thus returned.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">HTTP status code can be fetched from returned <code class="docutils literal"><span class="pre">ResponseEntity</span></code> even at the time of error and  process can be controlled corresponding to that value.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="setting-communication-timeout">
<span id="restclienthowtousetimeoutsettings"></span><h3><a class="toc-backref" href="#id39">5.2.2.7. Setting communication timeout</a><a class="headerlink" href="#setting-communication-timeout" title="Permalink to this headline">¶</a></h3>
<p>When a timeout period is to be specified for communicating with server, define a bean as given below.</p>
<p><strong>Implementation example of bean definition file (applicationContext.xml)</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;clientHttpRequestFactory&quot;</span>
      <span class="na">class=</span><span class="s">&quot;org.springframework.http.client.SimpleClientHttpRequestFactory&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;connectTimeout&quot;</span> <span class="na">value=</span><span class="s">&quot;${api.connectTimeout: 2000}&quot;</span> <span class="nt">/&gt;</span><span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;readTimeout&quot;</span> <span class="na">value=</span><span class="s">&quot;${api.readTimeout: 2000}&quot;</span> <span class="nt">/&gt;</span><span class="c">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;restTemplate&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.web.client.RestTemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">ref=</span><span class="s">&quot;clientHttpRequestFactory&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify connection timeout (milliseconds) with server in <code class="docutils literal"><span class="pre">connectTimeout</span></code> property.</div>
<div class="line">When timeout occurs, <code class="docutils literal"><span class="pre">org.springframework.web.client.ResourceAccessException</span></code> is generated.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify response data read timeout (milliseconds) in <code class="docutils literal"><span class="pre">readTimeout</span></code> property.</div>
<div class="line">When timeout occurs, <code class="docutils literal"><span class="pre">ResourceAccessException</span></code> is generated.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Cause Exception during Timeout Occurrence</strong></p>
<p><code class="docutils literal"><span class="pre">ResourceAccessException</span></code> wraps the cause exception. Cause exception during connection timeout and read timeout occurrence is <code class="docutils literal"><span class="pre">java.net.SocketTimeoutException</span></code> for both.
When default implementation (<code class="docutils literal"><span class="pre">SimpleClientHttpRequestFactory</span></code>) is used, it must be added that type of timeout occurrence cannot be distinguished by the type of exception class.</p>
<p class="last">Note that, since operation while using <code class="docutils literal"><span class="pre">HttpRequestFactory</span></code> is not verified, cause exception is likely to be different from the one described above.
When other <code class="docutils literal"><span class="pre">HttpRequestFactory</span></code> is used, appropriate exception handling must be employed after assessing the exception occurred during the timeout.</p>
</div>
</div>
<div class="section" id="using-ssl-self-signed-certificate">
<span id="restclienthowtousehttps"></span><h3><a class="toc-backref" href="#id40">5.2.2.8. Using SSL self-signed certificate</a><a class="headerlink" href="#using-ssl-self-signed-certificate" title="Permalink to this headline">¶</a></h3>
<p>Implementation is as given below when a SSL self-signed certificate is to be used in the test environment.</p>
<p><strong>Implementation example of FactoryBean</strong></p>
<p>Implement <code class="docutils literal"><span class="pre">org.springframework.beans.factory.FactoryBean</span></code> to create <code class="docutils literal"><span class="pre">org.springframework.http.client.ClientHttpRequestFactory</span></code>  to be passed in constructor argument, in Bean definition of <code class="docutils literal"><span class="pre">RestTemplate</span></code>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.security.KeyStore</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.net.ssl.KeyManagerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.net.ssl.SSLContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.net.ssl.TrustManagerFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.client.HttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClientBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.FactoryBean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.client.ClientHttpRequestFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.client.HttpComponentsClientHttpRequestFactory</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RequestFactoryBean</span> <span class="kd">implements</span>
        <span class="n">FactoryBean</span><span class="o">&lt;</span><span class="n">ClientHttpRequestFactory</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">keyStoreFileName</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kt">char</span><span class="o">[]</span> <span class="n">keyStorePassword</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">ClientHttpRequestFactory</span> <span class="nf">getObject</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

        <span class="c1">// (1)</span>
        <span class="n">SSLContext</span> <span class="n">sslContext</span> <span class="o">=</span> <span class="n">SSLContext</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">&quot;TLS&quot;</span><span class="o">);</span>

        <span class="n">KeyStore</span> <span class="n">ks</span> <span class="o">=</span> <span class="n">KeyStore</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">KeyStore</span><span class="o">.</span><span class="na">getDefaultType</span><span class="o">());</span>
        <span class="n">ks</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getClassLoader</span><span class="o">()</span>
                <span class="o">.</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">keyStoreFileName</span><span class="o">),</span>
                <span class="k">this</span><span class="o">.</span><span class="na">keyStorePassword</span><span class="o">);</span>

        <span class="n">KeyManagerFactory</span> <span class="n">kmf</span> <span class="o">=</span> <span class="n">KeyManagerFactory</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">KeyManagerFactory</span>
                <span class="o">.</span><span class="na">getDefaultAlgorithm</span><span class="o">());</span>
        <span class="n">kmf</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">ks</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">keyStorePassword</span><span class="o">);</span>

        <span class="n">TrustManagerFactory</span> <span class="n">tmf</span> <span class="o">=</span> <span class="n">TrustManagerFactory</span>
                <span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">TrustManagerFactory</span><span class="o">.</span><span class="na">getDefaultAlgorithm</span><span class="o">());</span>
        <span class="n">tmf</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">ks</span><span class="o">);</span>

        <span class="n">sslContext</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">kmf</span><span class="o">.</span><span class="na">getKeyManagers</span><span class="o">(),</span> <span class="n">tmf</span><span class="o">.</span><span class="na">getTrustManagers</span><span class="o">(),</span> <span class="kc">null</span><span class="o">);</span>

        <span class="c1">// (2)</span>
        <span class="n">HttpClient</span> <span class="n">httpClient</span> <span class="o">=</span> <span class="n">HttpClientBuilder</span><span class="o">.</span><span class="na">create</span><span class="o">()</span>
                <span class="o">.</span><span class="na">setSSLContext</span><span class="o">(</span><span class="n">sslContext</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

        <span class="c1">// (3)</span>
        <span class="n">ClientHttpRequestFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpComponentsClientHttpRequestFactory</span><span class="o">(</span>
                <span class="n">httpClient</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">factory</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">getObjectType</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ClientHttpRequestFactory</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isSingleton</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setKeyStoreFileName</span><span class="o">(</span><span class="n">String</span> <span class="n">keyStoreFileName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">keyStoreFileName</span> <span class="o">=</span> <span class="n">keyStoreFileName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setKeyStorePassword</span><span class="o">(</span><span class="kt">char</span><span class="o">[]</span> <span class="n">keyStorePassword</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">keyStorePassword</span> <span class="o">=</span> <span class="n">keyStorePassword</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create SSL context based on file name and password of keystore file which is specified in subsequent bean definition.</div>
<div class="line">Keystore file of SSL self-signed certificate to be used is placed on the class path.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create <code class="docutils literal"><span class="pre">org.apache.http.client.HttpClient</span></code> which uses SSL context thus created.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create <code class="docutils literal"><span class="pre">ClientHttpRequestFactory</span></code> which uses <code class="docutils literal"><span class="pre">HttpClient</span></code> thus created.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Apache HttpComponents HttpClient library is required in order to use of <code class="docutils literal"><span class="pre">HttpClient</span></code> and <code class="docutils literal"><span class="pre">HttpClientBuilder</span></code>.
Add below Apache HttpComponents HttpClient dependency library into <code class="file docutils literal"><span class="pre">pom.xml</span></code>.</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">pom.xml</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apache.httpcomponents<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>httpclient<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the above setting example, since it is assumed that the dependent library version is managed by the parent project terasoluna-gfw-parent , specifying the version in pom.xml is not necessary.
The above dependent library used by terasoluna-gfw-parent is defined by <a class="reference external" href="http://platform.spring.io/platform/">Spring IO Platform</a>.</p>
</div>
<p><strong>Implementation example of bean definition file (applicationContext.xml)</strong></p>
<p>Define <code class="docutils literal"><span class="pre">RestTemplate</span></code>which carries out SSL communication using SSL self-signed certificate.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;httpsRestTemplate&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.web.client.RestTemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg&gt;</span>
        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;com.example.restclient.RequestFactoryBean&quot;</span><span class="nt">&gt;</span><span class="c">&lt;!-- (1) --&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;keyStoreFileName&quot;</span> <span class="na">value=</span><span class="s">&quot;${rscl.keystore.filename}&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;keyStorePassword&quot;</span> <span class="na">value=</span><span class="s">&quot;${rscl.keystore.password}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;/constructor-arg&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify created <code class="docutils literal"><span class="pre">RequestFactoryBean</span></code> in <code class="docutils literal"><span class="pre">RestTemplate</span></code> constructor.</div>
<div class="line">Pass file name and password of keystore file in <code class="docutils literal"><span class="pre">RequestFactoryBean</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>How to use RestTemplate</strong></p>
<p>The method to use <code class="docutils literal"><span class="pre">RestTemplate</span></code> is same as the method when SSL self-signed certificate is not used.</p>
</div>
<div class="section" id="basic-authentication">
<span id="restclienthowtouseauthentication"></span><h3><a class="toc-backref" href="#id41">5.2.2.9. Basic authentication</a><a class="headerlink" href="#basic-authentication" title="Permalink to this headline">¶</a></h3>
<p>Implementation is as below when a server requests a basic authentication.</p>
<p><strong>Implementation example of Basic authentication</strong></p>
<p>Field declaration part</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Value</span><span class="o">(</span><span class="s">&quot;${api.auth.username}&quot;</span><span class="o">)</span>
<span class="n">String</span> <span class="n">username</span><span class="o">;</span>

<span class="nd">@Value</span><span class="o">(</span><span class="s">&quot;${api.auth.password}&quot;</span><span class="o">)</span>
<span class="n">String</span> <span class="n">password</span><span class="o">;</span>
</pre></div>
</div>
<p>Internal method</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">plainCredentials</span> <span class="o">=</span> <span class="n">username</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="n">password</span><span class="o">;</span> <span class="c1">// (1)</span>
<span class="n">String</span> <span class="n">base64Credentials</span> <span class="o">=</span> <span class="n">Base64</span><span class="o">.</span><span class="na">getEncoder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">encodeToString</span><span class="o">(</span><span class="n">plainCredentials</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">));</span> <span class="c1">// (2)</span>

<span class="n">RequestEntity</span> <span class="n">requestEntity</span> <span class="o">=</span> <span class="n">RequestEntity</span>
      <span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">uri</span><span class="o">)</span>
      <span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">&quot;Authorization&quot;</span><span class="o">,</span> <span class="s">&quot;Basic &quot;</span> <span class="o">+</span> <span class="n">base64Credentials</span><span class="o">)</span> <span class="c1">// (3)</span>
      <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Connect user ID and password with “<code class="docutils literal"><span class="pre">:</span></code>”.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Convert (1) to byte array and perform Base64 encoding.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Authorization header specifies credentials information of Basic authentication.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">java.util.Base64</span></code> of Java standard is used for Java SE8 and later versions. Earlier, <code class="docutils literal"><span class="pre">org.springframework.security.crypto.codec.Base64</span></code>of Spring Security is used.</p>
</div>
</div>
<div class="section" id="file-upload-multi-part-request">
<span id="restclienthowtousefileupload"></span><h3><a class="toc-backref" href="#id42">5.2.2.10. File upload (multi-part request)</a><a class="headerlink" href="#file-upload-multi-part-request" title="Permalink to this headline">¶</a></h3>
<p>Implementation is as below when file is to be uploaded (multi-part request) using <code class="docutils literal"><span class="pre">RestTemplate</span></code>.</p>
<p><strong>Implementation example for file upload</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">MultiValueMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">multiPartBody</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedMultiValueMap</span><span class="o">&lt;&gt;();</span><span class="c1">//(1)</span>
<span class="n">multiPartBody</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;file&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">ClassPathResource</span><span class="o">(</span><span class="s">&quot;/uploadFiles/User.txt&quot;</span><span class="o">));</span><span class="c1">//(2)</span>

<span class="n">RequestEntity</span><span class="o">&lt;</span><span class="n">MultiValueMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="n">requestEntity</span> <span class="o">=</span> <span class="n">RequestEntity</span>
        <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">uri</span><span class="o">)</span>
        <span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">MULTIPART_FORM_DATA</span><span class="o">)</span><span class="c1">//(3)</span>
        <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">multiPartBody</span><span class="o">);</span><span class="c1">//(4)</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Generate <code class="docutils literal"><span class="pre">MultiValueMap</span></code> for storing data sent as a multi-part request.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify parameter name in key and add file to be uploaded in <code class="docutils literal"><span class="pre">MultiValueMap</span></code>.</div>
<div class="line">In the example above, file placed on the class path is added as an uploaded file by specifying parameter name as <code class="docutils literal"><span class="pre">file</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify media type of Content-Type header in <code class="docutils literal"><span class="pre">multipart/form-data</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify <code class="docutils literal"><span class="pre">MultiValueMap</span></code> in the request body wherein the uploaded file has been stored.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Regarding Resource class offered by Spring Framework</strong></p>
<p>Spring Framework offers <code class="docutils literal"><span class="pre">org.springframework.core.io.Resource</span></code> as an interface which represents the resource and
can be used while uploading a file.</p>
<p>Main implementation classes of <code class="docutils literal"><span class="pre">Resource</span></code> interface are as below.</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">org.springframework.core.io.PathResource</span></code></li>
<li><code class="docutils literal"><span class="pre">org.springframework.core.io.FileSystemResource</span></code></li>
<li><code class="docutils literal"><span class="pre">org.springframework.core.io.ClassPathResource</span></code></li>
<li><code class="docutils literal"><span class="pre">org.springframework.core.io.UrlResource</span></code></li>
<li><code class="docutils literal"><span class="pre">org.springframework.core.io.InputStreamResource</span></code> (file name cannot be linked to server)</li>
<li><code class="docutils literal"><span class="pre">org.springframework.core.io.ByteArrayResource</span></code> (file name cannot be linked to server)</li>
</ul>
</div>
</div>
<div class="section" id="file-download">
<span id="restclienthowtousefiledownload"></span><h3><a class="toc-backref" href="#id43">5.2.2.11. File download</a><a class="headerlink" href="#file-download" title="Permalink to this headline">¶</a></h3>
<p>Implementation is as below when file is to be downloaded using <code class="docutils literal"><span class="pre">RestTeamplate</span></code>.</p>
<p><strong>Implementation example of file download (when file size is small)</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">RequestEntity</span> <span class="n">requestEntity</span> <span class="o">=</span> <span class="n">RequestEntity</span>
        <span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">uri</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">responseEntity</span> <span class="o">=</span>
        <span class="n">restTemplate</span><span class="o">.</span><span class="na">exchange</span><span class="o">(</span><span class="n">requestEntity</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[].</span><span class="na">class</span><span class="o">);</span><span class="c1">//(1)</span>

<span class="kt">byte</span><span class="o">[]</span> <span class="n">downloadContent</span> <span class="o">=</span> <span class="n">responseEntity</span><span class="o">.</span><span class="na">getBody</span><span class="o">();</span><span class="c1">//(2)</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handle downloaded file with a specified data type. Here, byte array is specified.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch data of downloaded file from response body.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Precautions to be taken while downloading a large file</strong></p>
<p class="last">If a large file is fetched in <code class="docutils literal"><span class="pre">byte</span></code> array using <code class="docutils literal"><span class="pre">HttpMessageConverter</span></code> registered as default, <code class="docutils literal"><span class="pre">java.lang.OutOfMemoryError</span></code> is likely to occur.
Hence, when a large file is to be downloaded, it is necessary to write downloaded data to the file in parts by fetching <code class="docutils literal"><span class="pre">InputStream</span></code> from response.</p>
</div>
<p id="restclienthowtousebigfiledownload"><strong>Implementation example of file download (when file size is large)</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// (1)</span>
<span class="kd">final</span> <span class="n">ResponseExtractor</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">File</span><span class="o">&gt;&gt;</span> <span class="n">responseExtractor</span> <span class="o">=</span>
        <span class="k">new</span> <span class="n">ResponseExtractor</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">File</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>

    <span class="c1">// (2)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">File</span><span class="o">&gt;</span> <span class="nf">extractData</span><span class="o">(</span><span class="n">ClientHttpResponse</span> <span class="n">response</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>

        <span class="n">File</span> <span class="n">rcvFile</span> <span class="o">=</span> <span class="n">File</span><span class="o">.</span><span class="na">createTempFile</span><span class="o">(</span><span class="s">&quot;rcvFile&quot;</span><span class="o">,</span> <span class="s">&quot;zip&quot;</span><span class="o">);</span>

        <span class="n">FileCopyUtils</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getBody</span><span class="o">(),</span> <span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="n">rcvFile</span><span class="o">));</span>

        <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getStatusCode</span><span class="o">())</span>
                <span class="o">.</span><span class="na">headers</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">()).</span><span class="na">body</span><span class="o">(</span><span class="n">rcvFile</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">};</span>

<span class="c1">// (3)</span>
<span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">File</span><span class="o">&gt;</span> <span class="n">responseEntity</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">restTemplate</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">targetUri</span><span class="o">,</span>
        <span class="n">HttpMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">responseExtractor</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">OK</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">responseEntity</span><span class="o">.</span><span class="na">getStatusCode</span><span class="o">()))</span> <span class="o">{</span>
    <span class="n">File</span> <span class="n">getFile</span> <span class="o">=</span> <span class="n">responseEntity</span><span class="o">.</span><span class="na">getBody</span><span class="o">();</span>

    <span class="o">.....</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create a process to create a return value of <code class="docutils literal"><span class="pre">RestTemplate#execute</span></code>,from the response fetched from <code class="docutils literal"><span class="pre">RestTemplate#execute</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Read data from response body (<code class="docutils literal"><span class="pre">InputStream</span></code>) and create a file.</div>
<div class="line">Created file, HTTP header and status code are stored in <code class="docutils literal"><span class="pre">ResponseEntity&lt;File&gt;</span></code> and returned.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Download file using <code class="docutils literal"><span class="pre">RestTemplate#execute</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>Implementation example of file download (when file size is large (example wherein ResponseEntity is not used))</strong></p>
<p>When status code determination and HTTP header reference are not required, <code class="docutils literal"><span class="pre">File</span></code> should be returned instead of <code class="docutils literal"><span class="pre">ResponseEntity</span></code> as given below.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">final</span> <span class="n">ResponseExtractor</span><span class="o">&lt;</span><span class="n">File</span><span class="o">&gt;</span> <span class="n">responseExtractor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseExtractor</span><span class="o">&lt;</span><span class="n">File</span><span class="o">&gt;()</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">File</span> <span class="nf">extractData</span><span class="o">(</span><span class="n">ClientHttpResponse</span> <span class="n">response</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>

        <span class="n">File</span> <span class="n">rcvFile</span> <span class="o">=</span> <span class="n">File</span><span class="o">.</span><span class="na">createTempFile</span><span class="o">(</span><span class="s">&quot;rcvFile&quot;</span><span class="o">,</span> <span class="s">&quot;zip&quot;</span><span class="o">);</span>

        <span class="n">FileCopyUtils</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getBody</span><span class="o">(),</span> <span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span>
                <span class="n">rcvFile</span><span class="o">));</span>

        <span class="k">return</span> <span class="n">rcvFile</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">};</span>

<span class="n">File</span> <span class="n">getFile</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">restTemplate</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">targetUri</span><span class="o">,</span> <span class="n">HttpMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span>
        <span class="kc">null</span><span class="o">,</span> <span class="n">responseExtractor</span><span class="o">);</span>
<span class="o">.....</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-handle-restful-url-uri-template-and-implementation-example">
<span id="restclienthowtouserestfull"></span><h3><a class="toc-backref" href="#id44">5.2.2.12. How to handle RESTful URL (URI template) and implementation example</a><a class="headerlink" href="#how-to-handle-restful-url-uri-template-and-implementation-example" title="Permalink to this headline">¶</a></h3>
<p>Implementation can be carried out by using URI template for handling RESTful URL.</p>
<p><strong>How to use getForObject method</strong></p>
<p>Field declaration part</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Value</span><span class="o">(</span><span class="s">&quot;${api.serverUrl}/api/users/{userId}&quot;</span><span class="o">)</span> <span class="c1">// (1)</span>
<span class="n">String</span> <span class="n">uriStr</span><span class="o">;</span>
</pre></div>
</div>
<p>Internal method</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="o">.</span><span class="na">getForObject</span><span class="o">(</span><span class="n">uriStr</span><span class="o">,</span> <span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">&quot;0001&quot;</span><span class="o">);</span> <span class="c1">// (2)</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Variable {userId} of URI template is changed to value specified while using <code class="docutils literal"><span class="pre">RestTeamplate</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">One variable of URI template is replaced with a value specified in third argument of <code class="docutils literal"><span class="pre">getForObject</span></code> method and processed as “<a class="reference external" href="http://localhost:8080/api/users/0001">http://localhost:8080/api/users/0001</a>”.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>How to use exchange method</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Value</span><span class="o">(</span><span class="s">&quot;${api.serverUrl}/api/users/{action}&quot;</span><span class="o">)</span> <span class="c1">// (1)</span>
<span class="n">String</span> <span class="n">uriStr</span><span class="o">;</span>
</pre></div>
</div>
<p>Internal method</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">URI</span> <span class="n">targetUri</span> <span class="o">=</span> <span class="n">UriComponentsBuilder</span><span class="o">.</span><span class="na">fromUriString</span><span class="o">(</span><span class="n">uriStr</span><span class="o">).</span>
        <span class="n">buildAndExpand</span><span class="o">(</span><span class="s">&quot;create&quot;</span><span class="o">).</span><span class="na">toUri</span><span class="o">();</span> <span class="c1">//(2)</span>

<span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">();</span>

<span class="c1">//...</span>

<span class="n">RequestEntity</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">requestEntity</span> <span class="o">=</span> <span class="n">RequestEntity</span>
        <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">targetUri</span><span class="o">)</span>
        <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>

<span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">responseEntity</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="o">.</span><span class="na">exchange</span><span class="o">(</span><span class="n">requestEntity</span><span class="o">,</span> <span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Variable {action} of URI template is changed to value specified while using <code class="docutils literal"><span class="pre">RestTeamplate</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">By using <code class="docutils literal"><span class="pre">UriComponentsBuilder</span></code>, first variable of URI template is replaced by value specified in the argument of <code class="docutils literal"><span class="pre">buildAndExpand</span></code> and “<a class="reference external" href="http://localhost:8080/api/users/create">http://localhost:8080/api/users/create</a>” URI is created.</div>
<div class="line">Refer Javadoc of <a class="reference external" href="http://docs.spring.io/spring/docs/4.3.11.RELEASE/javadoc-api/org/springframework/web/util/UriComponentsBuilder.html">UriComponentsBuilder</a> for details.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="how-to-extend">
<span id="restclienthowtoextend"></span><h2><a class="toc-backref" href="#id45">5.2.3. How to extend</a><a class="headerlink" href="#how-to-extend" title="Permalink to this headline">¶</a></h2>
<p>This chapter explains how to extend <code class="docutils literal"><span class="pre">RestTemplate</span></code>.</p>
<div class="section" id="how-to-register-an-arbitrary-httpmessageconverter">
<span id="restclienthowtoextendhttpmessageconverter"></span><h3><a class="toc-backref" href="#id46">5.2.3.1. How to register an arbitrary <code class="docutils literal"><span class="pre">HttpMessageConverter</span></code></a><a class="headerlink" href="#how-to-register-an-arbitrary-httpmessageconverter" title="Permalink to this headline">¶</a></h3>
<p>If the requirements of message conversion are not met by <code class="docutils literal"><span class="pre">HttpMessageConverter</span></code> registered as default, an arbitrary <code class="docutils literal"><span class="pre">HttpMessageConverter</span></code> can be registered.
However, since <code class="docutils literal"><span class="pre">HttpMessageConverter</span></code> registered as default is deleted, the required <code class="docutils literal"><span class="pre">HttpMessageConverter</span></code> should all be individually registered.</p>
<p><strong>How to define a bean definition file (applicationContext.xml)</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;jaxb2CollectionHttpMessageConverter&quot;</span>
      <span class="na">class=</span><span class="s">&quot;org.springframework.http.converter.xml.Jaxb2CollectionHttpMessageConverter&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;restTemplate&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.web.client.RestTemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;messageConverters&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
        <span class="nt">&lt;list&gt;</span>
            <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&quot;jaxb2CollectionHttpMessageConverter&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/list&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define a bean for implementation class of <code class="docutils literal"><span class="pre">HttpMessageConverter</span></code> to be registered.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Inject <code class="docutils literal"><span class="pre">HttpMessageConverter</span></code> bean registered in <code class="docutils literal"><span class="pre">messageConverters</span></code>property.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="application-of-common-process-clienthttprequestinterceptor">
<span id="restclienthowtoextendclienthttprequestinterceptor"></span><h3><a class="toc-backref" href="#id47">5.2.3.2. Application of common process (<code class="docutils literal"><span class="pre">ClientHttpRequestInterceptor</span></code>)</a><a class="headerlink" href="#application-of-common-process-clienthttprequestinterceptor" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">By using <code class="docutils literal"><span class="pre">ClientHttpRequestInterceptor</span></code>, an arbitrary process can be executed before and after communication with the server.</div>
<div class="line">How to apply <a class="reference internal" href="#restclienthowtoextendclienthttprequestinterceptorlogging"><span class="std std-ref">Logging process</span></a>  and <a class="reference internal" href="#restclientbasicauthorizationinterceptorbeandefinition"><span class="std std-ref">Request header setup process for Basic authentication</span></a> are introduced here.</div>
</div>
<div class="section" id="logging-process">
<span id="restclienthowtoextendclienthttprequestinterceptorlogging"></span><h4><a class="toc-backref" href="#id48">5.2.3.2.1. Logging process</a><a class="headerlink" href="#logging-process" title="Permalink to this headline">¶</a></h4>
<p>When a log for communication with server is to be output, implementation is as below.</p>
<p><strong>Implementation example of communication log output</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.restclient</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.http.HttpRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.client.ClientHttpRequestExecution</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.client.ClientHttpRequestInterceptor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.client.ClientHttpResponse</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoggingInterceptor</span> <span class="kd">implements</span> <span class="n">ClientHttpRequestInterceptor</span> <span class="o">{</span> <span class="c1">//(1)</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">LoggingInterceptor</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">ClientHttpResponse</span> <span class="nf">intercept</span><span class="o">(</span><span class="n">HttpRequest</span> <span class="n">request</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">body</span><span class="o">,</span>
            <span class="n">ClientHttpRequestExecution</span> <span class="n">execution</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">log</span><span class="o">.</span><span class="na">isInfoEnabled</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">requestBody</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">body</span><span class="o">,</span> <span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>

            <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Request Header {}&quot;</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">());</span> <span class="c1">//(2)</span>
            <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Request Body {}&quot;</span><span class="o">,</span> <span class="n">requestBody</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">ClientHttpResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">execution</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">body</span><span class="o">);</span> <span class="c1">//(3)</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">log</span><span class="o">.</span><span class="na">isInfoEnabled</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Response Header {}&quot;</span><span class="o">,</span> <span class="n">response</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">());</span> <span class="c1">// (4)</span>
            <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Response Status Code {}&quot;</span><span class="o">,</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusCode</span><span class="o">());</span> <span class="c1">// (5)</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">response</span><span class="o">;</span> <span class="c1">// (6)</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implement <code class="docutils literal"><span class="pre">ClientHttpRequestInterceptor</span></code> interface.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implement a common process to be carried out prior to sending a request.</div>
<div class="line">In the implementation example above, details of request header and request body are output in a log.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Run <code class="docutils literal"><span class="pre">execute</span></code> method of <code class="docutils literal"><span class="pre">ClientHttpRequestExecution</span></code> received as an argument for <code class="docutils literal"><span class="pre">intercept</span></code> method and send a request.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implement a common process which is to be carried out after receiving a response.</div>
<div class="line">In the implementation example above, response header details are output in a log.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Similar to (4), status code details are output in a log.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Return the response received in (3).</div>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>Definition example of bean definition file (applicationContext.xml)</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;loggingInterceptor&quot;</span> <span class="na">class=</span><span class="s">&quot;com.example.restclient.LoggingInterceptor&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define a bean for implementation class of <code class="docutils literal"><span class="pre">ClientHttpRequestInterceptor</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="request-header-setup-process-for-basic-authentication">
<span id="restclientbasicauthorizationinterceptorbeandefinition"></span><h4><a class="toc-backref" href="#id49">5.2.3.2.2. Request header setup process for Basic authentication</a><a class="headerlink" href="#request-header-setup-process-for-basic-authentication" title="Permalink to this headline">¶</a></h4>
<p>When a request header for Basic authentication is required to be set to access a server, a bean is defined as below.</p>
<p><strong>Definition example of bean definition file (applicationContext.xml)</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;basicAuthInterceptor&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.http.client.support.BasicAuthorizationInterceptor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">value=</span><span class="s">&quot;${api.auth.username}&quot;</span> <span class="nt">/&gt;</span><span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;${api.auth.password}&quot;</span> <span class="nt">/&gt;</span><span class="c">&lt;!-- (3) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define a bean for <code class="docutils literal"><span class="pre">BasicAuthorizationInterceptor</span></code>which implements <code class="docutils literal"><span class="pre">ClientHttpRequestInterceptor</span></code>interface.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set user name in the first argument of constructor.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set password in the second argument of constructor.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="applying-clienthttprequestinterceptor">
<h4><a class="toc-backref" href="#id50">5.2.3.2.3. Applying <code class="docutils literal"><span class="pre">ClientHttpRequestInterceptor</span></code></a><a class="headerlink" href="#applying-clienthttprequestinterceptor" title="Permalink to this headline">¶</a></h4>
<p>When <code class="docutils literal"><span class="pre">ClientHttpRequestInterceptor</span></code> created in <code class="docutils literal"><span class="pre">RestTemplate</span></code> is to be applied, define a bean as given below.</p>
<p><strong>How to define a bean definition file (applicationContext.xml)</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;restTemplate&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.web.client.RestTemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;interceptors&quot;</span><span class="nt">&gt;</span><span class="c">&lt;!-- (1) --&gt;</span>
        <span class="nt">&lt;list&gt;</span>
            <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&quot;basicAuthInterceptor&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&quot;loggingInterceptor&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/list&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Inject <code class="docutils literal"><span class="pre">ClientHttpRequestInterceptor</span></code> bean in <code class="docutils literal"><span class="pre">interceptors</span></code> property.</div>
<div class="line">When multiple beans are to be injected, execute the process in a chain sequence starting from top of the list.</div>
<div class="line">In the example above, processes prior to request are implemented in the sequence - <code class="docutils literal"><span class="pre">BasicAuthorizationInterceptor</span></code> -&gt; <code class="docutils literal"><span class="pre">LoggingInterceptor</span></code> -&gt; <code class="docutils literal"><span class="pre">ClientHttpRequest</span></code>. (the sequence will be reversed for the processes after receiving a response)</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="asynchronous-request">
<span id="restclientasync"></span><h3><a class="toc-backref" href="#id51">5.2.3.3. Asynchronous request</a><a class="headerlink" href="#asynchronous-request" title="Permalink to this headline">¶</a></h3>
<p>When an asynchronous request is to be carried out, <code class="docutils literal"><span class="pre">org.springframework.web.client.AsyncRestTemplate</span></code> is used.</p>
<div class="section" id="bean-definition-for-asyncresttemplate">
<span id="restclientasyncbeandefinition"></span><h4><a class="toc-backref" href="#id52">5.2.3.3.1. Bean definition for <code class="docutils literal"><span class="pre">AsyncRestTemplate</span></code></a><a class="headerlink" href="#bean-definition-for-asyncresttemplate" title="Permalink to this headline">¶</a></h4>
<p>Define a bean for <code class="docutils literal"><span class="pre">AsyncRestTemplate</span></code>.</p>
<p><strong>How to define a bean definition file (applicationContext.xml)</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;asyncRestTemplate&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.web.client.AsyncRestTemplate&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When <code class="docutils literal"><span class="pre">AsyncRestTemplate</span></code> is to be used as per default setup, register a bean by using a default constructor.</div>
<div class="line">In case of default configuration, <code class="docutils literal"><span class="pre">SimpleClientHttpRequestFactory</span></code> which has set <code class="docutils literal"><span class="pre">org.springframework.core.task.SimpleAsyncTaskExecutor</span></code> is set as <code class="docutils literal"><span class="pre">org.springframework.core.task.AsyncListenableTaskExecutor</span></code> in <code class="docutils literal"><span class="pre">org.springframework.http.client.AsyncClientHttpRequestFactory</span></code> of <code class="docutils literal"><span class="pre">AsyncRestTemplate</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>How to customise AsyncRestTemplate</strong></p>
<p><code class="docutils literal"><span class="pre">SimpleAsyncTaskExecutor</span></code> set as default generates threads without using a thread pool
and there is no restriction on number of concurrent execution of threads.
Hence, when the number of threads to be used concurrently is very large, OutOfMemoryError is likely to occur.</p>
<p>By setting a Bean of <code class="docutils literal"><span class="pre">org.springframework.core.task.AsyncListenableTaskExecutor</span></code> interface, in the constructor of <code class="docutils literal"><span class="pre">AsyncRestTemplate</span></code>, upper limit for thread pool count can be specified.
An example of setting <code class="docutils literal"><span class="pre">org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor</span></code>is given below.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;asyncTaskExecutor&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxPoolSize&quot;</span> <span class="na">value=</span><span class="s">&quot;100&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="c">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;asyncRestTemplate&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.web.client.AsyncRestTemplate&quot;</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">ref=</span><span class="s">&quot;asyncTaskExecutor&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define a bean for <code class="docutils literal"><span class="pre">AsyncTaskExecutor</span></code>.</div>
<div class="line">Thread operation using a thread pool is carried out by using <code class="docutils literal"><span class="pre">ThreadPoolTaskExecutor</span></code>.</div>
<div class="line">Further, number of threads can be controlled by setting <code class="docutils literal"><span class="pre">maxPoolSize</span></code> property.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define a bean for <code class="docutils literal"><span class="pre">AsyncRestTemplate</span></code>.</div>
<div class="line">Register a bean by using a constructor which specifies <code class="docutils literal"><span class="pre">ThreadPoolTaskExecutor</span></code>in the argument.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>This guideline introduces an implementation example to customise the task execution process only, however
HTTP communication process can also be customised for <code class="docutils literal"><span class="pre">AsyncRestTemplate</span></code>.
Refer Javadoc of <a class="reference external" href="http://docs.spring.io/spring/docs/4.3.11.RELEASE/javadoc-api/org/springframework/web/client/AsyncRestTemplate.html">AsyncRestTemplate</a> for details.</p>
<p class="last">Also, customisation for other than thread pool size is possible for <code class="docutils literal"><span class="pre">ThreadPoolTaskExecutor</span></code>as well.
Refer Javadoc of <a class="reference external" href="http://docs.spring.io/spring/docs/4.3.11.RELEASE/javadoc-api/org/springframework/scheduling/concurrent/ThreadPoolTaskExecutor.html">ThreadPoolTaskExecutor</a> for details.</p>
</div>
</div>
<div class="section" id="implementation-of-asynchronous-request">
<span id="restclientasyncimplementation"></span><h4><a class="toc-backref" href="#id53">5.2.3.3.2. Implementation of asynchronous request</a><a class="headerlink" href="#implementation-of-asynchronous-request" title="Permalink to this headline">¶</a></h4>
<p><strong>Implementation example of asynchronous request</strong></p>
<p>Field declaration part</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Inject</span>
<span class="n">AsyncRestTemplate</span> <span class="n">asyncRestTemplate</span><span class="o">;</span>
</pre></div>
</div>
<p>Internal method</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">ListenableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;&gt;</span> <span class="n">responseEntity</span> <span class="o">=</span>
        <span class="n">asyncRestTemplate</span><span class="o">.</span><span class="na">getForEntity</span><span class="o">(</span><span class="n">uri</span><span class="o">,</span> <span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> <span class="c1">// (1)</span>

<span class="n">responseEntity</span><span class="o">.</span><span class="na">addCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">ListenableFutureCallback</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;&gt;()</span> <span class="o">{</span> <span class="c1">// (2)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSuccess</span><span class="o">(</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">entity</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//...</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="n">Throwable</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">//...</span>
    <span class="o">}</span>
<span class="o">});</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Send asynchronous request by using each method of <code class="docutils literal"><span class="pre">AsyncRestTemplate</span></code>.</div>
<div class="line">In the implementation example above, <code class="docutils literal"><span class="pre">getForEntity</span></code> method is used.</div>
<div class="line"><code class="docutils literal"><span class="pre">ResponseEntity</span></code> wrapped in <code class="docutils literal"><span class="pre">org.springframework.util.concurrent.ListenableFuture</span></code>is sent as return value.</div>
<div class="line">How to use each method is similar to <code class="docutils literal"><span class="pre">RestTemplate</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Register <code class="docutils literal"><span class="pre">org.springframework.util.concurrent.ListenableFutureCallback</span></code> in <code class="docutils literal"><span class="pre">ListenableFuture</span></code> and implement a process when a response has returned.</div>
<div class="line">Implement the process in <code class="docutils literal"><span class="pre">onSuccess</span></code> method when a successful response has returned and implement a process in <code class="docutils literal"><span class="pre">onFailure</span></code>when an error has occurred.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="implementation-of-common-processing-for-asynchronous-request">
<h4><a class="toc-backref" href="#id54">5.2.3.3.3. Implementation of common processing for asynchronous request</a><a class="headerlink" href="#implementation-of-common-processing-for-asynchronous-request" title="Permalink to this headline">¶</a></h4>
<p>Any arbitrary process can be executed before and after communicating with the server by using <code class="docutils literal"><span class="pre">org.springframework.http.client.AsyncClientHttpRequestInterceptor</span></code>.</p>
<p>An example of login process is introduced here.</p>
<p><strong>Implementation example of communication log output</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.restclient</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.StandardCharsets</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.HttpRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.client.AsyncClientHttpRequestExecution</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.client.AsyncClientHttpRequestInterceptor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.client.ClientHttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.util.concurrent.ListenableFuture</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.util.concurrent.ListenableFutureCallback</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AsyncLoggingInterceptor</span> <span class="kd">implements</span>
                                     <span class="n">AsyncClientHttpRequestInterceptor</span> <span class="o">{</span> <span class="c1">// (1)</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span>
            <span class="n">AsyncLoggingInterceptor</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">ListenableFuture</span><span class="o">&lt;</span><span class="n">ClientHttpResponse</span><span class="o">&gt;</span> <span class="nf">intercept</span><span class="o">(</span><span class="n">HttpRequest</span> <span class="n">request</span><span class="o">,</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">body</span><span class="o">,</span>
            <span class="n">AsyncClientHttpRequestExecution</span> <span class="n">execution</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="c1">// (2)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">log</span><span class="o">.</span><span class="na">isInfoEnabled</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">requestBody</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">body</span><span class="o">,</span> <span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>

            <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Request Header {}&quot;</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">());</span>
            <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Request Body {}&quot;</span><span class="o">,</span> <span class="n">requestBody</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// (3)</span>
        <span class="n">ListenableFuture</span><span class="o">&lt;</span><span class="n">ClientHttpResponse</span><span class="o">&gt;</span> <span class="n">future</span> <span class="o">=</span> <span class="n">execution</span><span class="o">.</span><span class="na">executeAsync</span><span class="o">(</span>
                <span class="n">request</span><span class="o">,</span> <span class="n">body</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">log</span><span class="o">.</span><span class="na">isInfoEnabled</span><span class="o">())</span> <span class="o">{</span>
            <span class="c1">// (4)</span>
            <span class="n">future</span><span class="o">.</span><span class="na">addCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">ListenableFutureCallback</span><span class="o">&lt;</span><span class="n">ClientHttpResponse</span><span class="o">&gt;()</span> <span class="o">{</span>

                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSuccess</span><span class="o">(</span><span class="n">ClientHttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Response Header {}&quot;</span><span class="o">,</span> <span class="n">response</span>
                                <span class="o">.</span><span class="na">getHeaders</span><span class="o">());</span>
                        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Response Status Code {}&quot;</span><span class="o">,</span> <span class="n">response</span>
                                <span class="o">.</span><span class="na">getStatusCode</span><span class="o">());</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&quot;I/O Error&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span>

                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="n">Throwable</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Communication Error&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">});</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">future</span><span class="o">;</span> <span class="c1">// (5)</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implement <code class="docutils literal"><span class="pre">AsyncClientHttpRequestInterceptor</span></code> interface.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implement a process which is  executed prior to sending an asynchronous request.</div>
<div class="line">In the implementation example above, contents of request header and request body are output in the log.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Send an asynchronous request by using <code class="docutils literal"><span class="pre">executeAsync</span></code> method of <code class="docutils literal"><span class="pre">AsyncClientHttpRequestExecution</span></code> which is received as an argument of <code class="docutils literal"><span class="pre">intercept</span></code> method.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">Register <code class="docutils literal"><span class="pre">org.springframework.util.concurrent.ListenableFutureCallback</span></code> in <code class="docutils literal"><span class="pre">ListenableFuture</span></code> which is received in (3) and implement the process once the response is received.</div>
<div class="line">When the response is received, <code class="docutils literal"><span class="pre">onSuccess</span></code> method is called.</div>
<div class="line">Also, when an exception occurs at the time of asynchronous request, <code class="docutils literal"><span class="pre">onFailure</span></code> method is called. A specific example is shown below.</div>
</div>
<ul class="last simple">
<li>Unable to connect a specified host （<code class="docutils literal"><span class="pre">ConnectException</span></code>）</li>
<li>Timeout occurred for reading of response data （<code class="docutils literal"><span class="pre">SocketTimeoutException</span></code>）</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Return <code class="docutils literal"><span class="pre">ListenableFuture</span></code> returned in (3).</div>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>Definition example of a bean definition file (applicationContext.xml)</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;asyncLoggingInterceptor&quot;</span> <span class="na">class=</span><span class="s">&quot;com.example.restclient.AsyncLoggingInterceptor&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;asyncRestTemplate&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.web.client.AsyncRestTemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;interceptors&quot;</span><span class="nt">&gt;</span><span class="c">&lt;!-- (2) --&gt;</span>
        <span class="nt">&lt;list&gt;</span>
            <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&quot;asyncLoggingInterceptor&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/list&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define a bean for implementation class of <code class="docutils literal"><span class="pre">AsyncClientHttpRequestInterceptor</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Inject a bean of <code class="docutils literal"><span class="pre">AsyncClientHttpRequestInterceptor</span></code> in <code class="docutils literal"><span class="pre">interceptors</span></code> property.</div>
<div class="line">When multiple beans are injected, they are executed in the sequence starting from top of the list, similar to <code class="docutils literal"><span class="pre">RestTemplate</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="appendix">
<span id="restclientappendix"></span><h2><a class="toc-backref" href="#id55">5.2.4. Appendix</a><a class="headerlink" href="#appendix" title="Permalink to this headline">¶</a></h2>
<div class="section" id="how-to-configure-http-proxy-server">
<span id="restclientproxysettings"></span><h3><a class="toc-backref" href="#id56">5.2.4.1. How to configure HTTP Proxy server</a><a class="headerlink" href="#how-to-configure-http-proxy-server" title="Permalink to this headline">¶</a></h3>
<p>When the server is to be accessed via HTTP Proxy server, HTTP Proxy server must be configured in system  property or JVM starting argument, or Bean definition of <code class="docutils literal"><span class="pre">RestTemplate</span></code>.
When the server is configured in system property or JVM starting argument, it impacts the overall application. Hence, an example wherein HTTP Proxy server is configured for each <code class="docutils literal"><span class="pre">RestTemplate</span></code> is introduced.</p>
<p>HTTP Proxy server for each <code class="docutils literal"><span class="pre">RestTemplate</span></code> can be configured for <code class="docutils literal"><span class="pre">SimpleClientHttpRequestFactory</span></code> which is a default implementation of <code class="docutils literal"><span class="pre">ClientHttpRequestFactory</span></code> interface.
However, since credentials cannot be configured in <code class="docutils literal"><span class="pre">SimpleClientHttpRequestFactory</span></code>, <code class="docutils literal"><span class="pre">HttpComponentsClientHttpRequestFactory</span></code> is used while authenticating Proxy.
<code class="docutils literal"><span class="pre">HttpComponentsClientHttpRequestFactory</span></code> is an implementation class of <code class="docutils literal"><span class="pre">ClientHttpRequestFactory</span></code> interface which generates a request using <code class="docutils literal"><span class="pre">Apache</span> <span class="pre">HttpComponents</span> <span class="pre">HttpClient</span></code>.</p>
<div class="section" id="how-to-specify-a-http-proxy-server">
<h4><a class="toc-backref" href="#id57">5.2.4.1.1. How to specify a HTTP Proxy server</a><a class="headerlink" href="#how-to-specify-a-http-proxy-server" title="Permalink to this headline">¶</a></h4>
<p>Connection destination of HTTP Proxy server for which credentials are essential is specified for <code class="docutils literal"><span class="pre">RestTemplate</span></code> by using <code class="docutils literal"><span class="pre">HttpComponentsClientHttpRequestFactory</span></code>.</p>
<p><strong>pom.xml</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apache.httpcomponents<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>httpclient<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add <code class="docutils literal"><span class="pre">Apache</span> <span class="pre">HttpComponents</span> <span class="pre">Client</span></code> to dependent library of <code class="file docutils literal"><span class="pre">pom.xml</span></code> in order to use <code class="docutils literal"><span class="pre">Apache</span> <span class="pre">HTTP</span> <span class="pre">Client</span></code> which is used in <code class="docutils literal"><span class="pre">HttpComponentsClientHttpRequestFactory</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the above setting example, since it is assumed that the dependent library version is managed by the parent project terasoluna-gfw-parent , specifying the version in pom.xml is not necessary.
The above dependent library used by terasoluna-gfw-parent is defined by <a class="reference external" href="http://platform.spring.io/platform/">Spring IO Platform</a>.</p>
</div>
<p><strong>Bean definition file</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;proxyHttpClientBuilder&quot;</span> <span class="na">class=</span><span class="s">&quot;org.apache.http.impl.client.HttpClientBuilder&quot;</span> <span class="na">factory-method=</span><span class="s">&quot;create&quot;</span> <span class="nt">&gt;</span>
    <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;proxy&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.apache.http.HttpHost&quot;</span> <span class="nt">&gt;</span>
            <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">value=</span><span class="s">&quot;${rscl.http.proxyHost}&quot;</span> <span class="nt">/&gt;</span>    <span class="c">&lt;!-- (3) --&gt;</span>
            <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;${rscl.http.proxyPort}&quot;</span> <span class="nt">/&gt;</span>    <span class="c">&lt;!-- (4) --&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="c">&lt;!-- (5) --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;proxyRestTemplate&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.web.client.RestTemplate&quot;</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg&gt;</span>
        <span class="c">&lt;!-- (6) --&gt;</span>
        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.http.client.HttpComponentsClientHttpRequestFactory&quot;</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- (7) --&gt;</span>
            <span class="nt">&lt;constructor-arg&gt;</span>
                <span class="nt">&lt;bean</span> <span class="na">factory-bean=</span><span class="s">&quot;proxyHttpClientBuilder&quot;</span> <span class="na">factory-method=</span><span class="s">&quot;build&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/constructor-arg&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;/constructor-arg&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use <code class="docutils literal"><span class="pre">org.apache.http.impl.client.HttpClientBuilder</span></code> and  configure <code class="docutils literal"><span class="pre">org.apache.http.client.HttpClient</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Configure <code class="docutils literal"><span class="pre">org.apache.http.HttpHost</span></code> which performs HTTP Proxy server setting, in <code class="docutils literal"><span class="pre">proxy</span></code> property of <code class="docutils literal"><span class="pre">HttpClientBuilder</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set value of key <code class="docutils literal"><span class="pre">rscl.http.proxyHost</span></code> configured in property file in the first argument of <code class="docutils literal"><span class="pre">HttpHost</span></code> constructor, as a host name of HTTP Proxy server.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set value of key <code class="docutils literal"><span class="pre">rscl.http.proxyPort</span></code> configured in property file in the second argument of <code class="docutils literal"><span class="pre">HttpHost</span></code> constructor, as a port number of HTTP Proxy server.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define a Bean for <code class="docutils literal"><span class="pre">RestTemplate</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Configure <code class="docutils literal"><span class="pre">HttpComponentsClientHttpRequestFactory</span></code> in the argument of <code class="docutils literal"><span class="pre">RestTemplate</span></code> constructor.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Configure <code class="docutils literal"><span class="pre">HttpClient</span></code> generated from  <code class="docutils literal"><span class="pre">HttpClientBuilder</span></code> in the argument of <code class="docutils literal"><span class="pre">HttpComponentsClientHttpRequestFactory</span></code> constructor.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="how-to-specify-credentials-information-of-http-proxy-server">
<h4><a class="toc-backref" href="#id58">5.2.4.1.2. How to specify credentials information of HTTP Proxy server</a><a class="headerlink" href="#how-to-specify-credentials-information-of-http-proxy-server" title="Permalink to this headline">¶</a></h4>
<p>When credentials (user name and password) are required for accessing HTTP Proxy server, credentials are set by using <code class="docutils literal"><span class="pre">org.apache.http.impl.client.BasicCredentialsProvider</span></code>.</p>
<p>Since <code class="docutils literal"><span class="pre">setCredentials</span></code> method of <code class="docutils literal"><span class="pre">BasicCredentialsProvider</span></code> contains two arguments, a Bean cannot be generated by using a setter injection. Hence, a Bean is generated by using <code class="docutils literal"><span class="pre">org.springframework.beans.factory.FactoryBean</span></code>.</p>
<p><strong>FactoryBean class</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.http.auth.AuthScope</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.auth.UsernamePasswordCredentials</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.BasicCredentialsProvider</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.FactoryBean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Value</span><span class="o">;</span>

<span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BasicCredentialsProviderFactoryBean</span> <span class="kd">implements</span> <span class="n">FactoryBean</span><span class="o">&lt;</span><span class="n">BasicCredentialsProvider</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="c1">// (2)</span>
    <span class="nd">@Value</span><span class="o">(</span><span class="s">&quot;${rscl.http.proxyHost}&quot;</span><span class="o">)</span>
    <span class="n">String</span> <span class="n">host</span><span class="o">;</span>

    <span class="c1">// (3)</span>
    <span class="nd">@Value</span><span class="o">(</span><span class="s">&quot;${rscl.http.proxyPort}&quot;</span><span class="o">)</span>
    <span class="kt">int</span> <span class="n">port</span><span class="o">;</span>

    <span class="c1">// (4)</span>
    <span class="nd">@Value</span><span class="o">(</span><span class="s">&quot;${rscl.http.proxyUserName}&quot;</span><span class="o">)</span>
    <span class="n">String</span> <span class="n">userName</span><span class="o">;</span>

    <span class="c1">// (5)</span>
    <span class="nd">@Value</span><span class="o">(</span><span class="s">&quot;${rscl.http.proxyPassword}&quot;</span><span class="o">)</span>
    <span class="n">String</span> <span class="n">password</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">BasicCredentialsProvider</span> <span class="nf">getObject</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

        <span class="c1">// (6)</span>
        <span class="n">AuthScope</span> <span class="n">authScope</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AuthScope</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">host</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">port</span><span class="o">);</span>

        <span class="c1">// (7)</span>
        <span class="n">UsernamePasswordCredentials</span> <span class="n">usernamePasswordCredentials</span> <span class="o">=</span>
                <span class="k">new</span> <span class="n">UsernamePasswordCredentials</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">userName</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">password</span><span class="o">);</span>

        <span class="c1">// (8)</span>
        <span class="n">BasicCredentialsProvider</span> <span class="n">credentialsProvider</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasicCredentialsProvider</span><span class="o">();</span>
        <span class="n">credentialsProvider</span><span class="o">.</span><span class="na">setCredentials</span><span class="o">(</span><span class="n">authScope</span><span class="o">,</span> <span class="n">usernamePasswordCredentials</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">credentialsProvider</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">getObjectType</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">BasicCredentialsProvider</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isSingleton</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define a <code class="docutils literal"><span class="pre">BasicCredentialsProviderFactoryBean</span></code> class which implements <code class="docutils literal"><span class="pre">org.springframework.beans.factory.FactoryBean</span></code>.</div>
<div class="line">Configure <code class="docutils literal"><span class="pre">BasicCredentialsProvider</span></code> in the type of Bean.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set value of key <code class="docutils literal"><span class="pre">rscl.http.proxyHost</span></code> set in property file in instance variable, as a host name of HTTP Proxy server.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set value of key <code class="docutils literal"><span class="pre">rscl.http.proxyPort</span></code> set in property file in instance variable, as a port number of HTTP Proxy server.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set value of key <code class="docutils literal"><span class="pre">rscl.http.proxyUserName</span></code> set in property file in instance variable, as a user name of HTTP Proxy server.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set value of key <code class="docutils literal"><span class="pre">rscl.http.proxyPassword</span></code> set in property file in instance variable, as a password of HTTP Proxy server.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create <code class="docutils literal"><span class="pre">org.apache.http.auth.AuthScope</span></code>  and configure scope of credentials. This example specifies host name and port number of HTTP Proxy server. For other configuration methods, refer <a class="reference external" href="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/auth/AuthScope.html">AuthScope (Apache HttpClient API)</a>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create <code class="docutils literal"><span class="pre">org.apache.http.auth.UsernamePasswordCredentials</span></code> and configure credentials.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create <code class="docutils literal"><span class="pre">org.apache.http.impl.client.BasicCredentialsProvider</span></code> and configure credentials and its scope by using <code class="docutils literal"><span class="pre">setCredentials</span></code> method.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>Bean definition file</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;proxyHttpClientBuilder&quot;</span> <span class="na">class=</span><span class="s">&quot;org.apache.http.impl.client.HttpClientBuilder&quot;</span> <span class="na">factory-method=</span><span class="s">&quot;create&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultCredentialsProvider&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;com.example.restclient.BasicCredentialsProviderFactoryBean&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;proxy&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;proxyHost&quot;</span> <span class="na">class=</span><span class="s">&quot;org.apache.http.HttpHost&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">value=</span><span class="s">&quot;${rscl.http.proxyHost}&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;${rscl.http.proxyPort}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;proxyRestTemplate&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.web.client.RestTemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg&gt;</span>
        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.http.client.HttpComponentsClientHttpRequestFactory&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;constructor-arg&gt;</span>
                <span class="nt">&lt;bean</span> <span class="na">factory-bean=</span><span class="s">&quot;proxyHttpClientBuilder&quot;</span> <span class="na">factory-method=</span><span class="s">&quot;build&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/constructor-arg&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;/constructor-arg&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Configure <code class="docutils literal"><span class="pre">BasicCredentialsProvider</span></code>in <code class="docutils literal"><span class="pre">defaultCredentialsProvider</span></code>property of <code class="docutils literal"><span class="pre">HttpClientBuilder</span></code>.</div>
<div class="line"><code class="docutils literal"><span class="pre">BasicCredentialsProvider</span></code> creates a Bean by using <code class="docutils literal"><span class="pre">BasicCredentialsProviderFactoryBean</span></code>which implements <code class="docutils literal"><span class="pre">FactoryBean</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="configuration-while-using-jsr-310-date-and-time-api-in-json">
<h3><a class="toc-backref" href="#id59">5.2.4.2. Configuration while using JSR-310 Date and Time API in JSON</a><a class="headerlink" href="#configuration-while-using-jsr-310-date-and-time-api-in-json" title="Permalink to this headline">¶</a></h3>
<p>For configuration while using JSR-310 Date and Time API as a property of JavaBean which represents a resource (Resource class),
refer “<a class="reference internal" href="REST.html#restappendixusingjsr310-jodatime"><span class="std std-ref">Configuration while using JSR-310 Date and Time API / Joda Time</span></a> “.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="SOAP.html" title="5.3. SOAP Web Service (Server/Client)"
             >next</a> |</li>
        <li class="right" >
          <a href="REST.html" title="5.1. RESTful Web Service"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.4.1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >5. Web Services</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
      © Copyright 2013-2018, NTT DATA Corporation. © Copyright 2013-2018, NTT Corporation.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.3.Theme is <a href="http://github.com/vimalkvn/solar-theme">Solar</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>