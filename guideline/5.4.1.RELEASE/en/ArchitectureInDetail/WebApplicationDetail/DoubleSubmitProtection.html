<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>4.5. Double Submit Protection &#8212; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.4.1.RELEASE documentation</title>
    <link rel="stylesheet" href="../../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '5.4.1.RELEASE',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="4.6. Message Management" href="MessageManagement.html" />
    <link rel="prev" title="4.4. Pagination" href="Pagination.html" /><script async src="https://www.googletagmanager.com/gtag/js?id=G-847V2Q99G8"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date()); gtag('config', 'G-847V2Q99G8');
</script>
<script src="../../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../../_static/solarized-dark.css" rel="stylesheet">
<link href="../../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="MessageManagement.html" title="4.6. Message Management"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Pagination.html" title="4.4. Pagination"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.4.1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">4. Web Application Development Features</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>

  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4.5. Double Submit Protection</a><ul>
<li><a class="reference internal" href="#overview">4.5.1. Overview</a><ul>
<li><a class="reference internal" href="#problems">4.5.1.1. Problems</a><ul>
<li><a class="reference internal" href="#double-clicking-of-update-button">4.5.1.1.1. Double clicking of ‘Update’ button</a></li>
<li><a class="reference internal" href="#reloading-of-screen-after-completion-of-update-process">4.5.1.1.2. Reloading of screen after completion of update process</a></li>
<li><a class="reference internal" href="#invalid-screen-transition-using-back-button-of-the-browser">4.5.1.1.3. Invalid screen transition using ‘Back’ button of the browser</a></li>
</ul>
</li>
<li><a class="reference internal" href="#solutions">4.5.1.2. Solutions</a><ul>
<li><a class="reference internal" href="#preventing-double-clicking-of-a-button-using-javascript">4.5.1.2.1. Preventing double clicking of a button using JavaScript</a></li>
<li><a class="reference internal" href="#about-prg-post-redirect-get-pattern">4.5.1.2.2. About PRG (Post-Redirect-Get) pattern</a></li>
<li><a class="reference internal" href="#transaction-token-check">4.5.1.2.3. Transaction Token Check</a></li>
</ul>
</li>
<li><a class="reference internal" href="#about-namespace-of-transaction-token">4.5.1.3. About NameSpace of transaction token</a><ul>
<li><a class="reference internal" href="#problems-that-occur-when-there-is-no-namespace">4.5.1.3.1. Problems that occur when there is no NameSpace</a></li>
<li><a class="reference internal" href="#behavior-when-namespace-is-specified">4.5.1.3.2. Behavior when NameSpace is specified</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use">4.5.2. How to use</a><ul>
<li><a class="reference internal" href="#preventing-double-clicking-of-button-using-javascript">4.5.2.1. Preventing double clicking of button using JavaScript</a></li>
<li><a class="reference internal" href="#using-prg-post-redirect-get-pattern">4.5.2.2. Using PRG (Post-Redirect-Get) pattern</a></li>
<li><a class="reference internal" href="#using-transaction-token-check">4.5.2.3. Using transaction token check</a><ul>
<li><a class="reference internal" href="#transaction-token-check-provided-by-common-library">4.5.2.3.1. Transaction token check provided by common library</a></li>
<li><a class="reference internal" href="#attributes-of-transactiontokencheck-annotation">4.5.2.3.2. Attributes of <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation</a></li>
<li><a class="reference internal" href="#format-of-transaction-token">4.5.2.3.3. Format of transaction token</a></li>
<li><a class="reference internal" href="#lifecycle-of-transaction-token">4.5.2.3.4. Lifecycle of transaction token</a></li>
<li><a class="reference internal" href="#settings-for-using-a-transaction-token-check">4.5.2.3.5. Settings for using a transaction token check</a></li>
<li><a class="reference internal" href="#settings-for-handling-transaction-token-errors">4.5.2.3.6. Settings for handling transaction token errors</a></li>
<li><a class="reference internal" href="#how-to-use-transaction-token-check-in-controller">4.5.2.3.7. How to use transaction token check in Controller</a></li>
<li><a class="reference internal" href="#how-to-use-transaction-token-check-in-view-jsp">4.5.2.3.8. How to use transaction token check in View (JSP)</a></li>
<li><a class="reference internal" href="#when-multiple-usecases-are-to-be-implemented-in-one-controller">4.5.2.3.9. When multiple usecases are to be implemented in one Controller</a></li>
<li><a class="reference internal" href="#when-a-process-which-does-not-update-screen-for-file-downloading-process-is-included-in-the-use-case">4.5.2.3.10. When a process which does not update screen for file downloading process is included in the use case</a></li>
<li><a class="reference internal" href="#typical-example-of-using-transaction-token-check">4.5.2.3.11. Typical example of using transaction token check</a></li>
<li><a class="reference internal" href="#exclusion-control-of-parallel-processing-while-using-a-session">4.5.2.3.12. Exclusion control of parallel processing while using a session</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-extend">4.5.3. How to extend</a><ul>
<li><a class="reference internal" href="#how-to-change-the-maximum-limit-of-transaction-tokens">4.5.3.1. How to change the maximum limit of transaction tokens</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendix">4.5.4. Appendix</a><ul>
<li><a class="reference internal" href="#transaction-token-check-in-case-that-the-cache-of-browser-is-disabled">4.5.4.1. Transaction Token Check in case that the cache of browser is disabled</a></li>
<li><a class="reference internal" href="#global-tokens">4.5.4.2. Global Tokens</a><ul>
<li><a class="reference internal" href="#changing-the-maximum-limit-of-transaction-tokens-that-can-be-stored-for-each-namespace">4.5.4.2.1. Changing the maximum limit of transaction tokens that can be stored for each NameSpace</a></li>
<li><a class="reference internal" href="#implementation-of-controller">4.5.4.2.2. Implementation of Controller</a></li>
</ul>
</li>
<li><a class="reference internal" href="#quick-reference">4.5.4.3. Quick Reference</a></li>
</ul>
</li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="Pagination.html"
                        title="previous chapter">4.4. Pagination</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="MessageManagement.html"
                        title="next chapter">4.6. Message Management</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/ArchitectureInDetail/WebApplicationDetail/DoubleSubmitProtection.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="double-submit-protection">
<h1>4.5. Double Submit Protection<a class="headerlink" href="#double-submit-protection" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id3">Overview</a><ul>
<li><a class="reference internal" href="#problems" id="id4">Problems</a><ul>
<li><a class="reference internal" href="#double-clicking-of-update-button" id="id5">Double clicking of ‘Update’ button</a></li>
<li><a class="reference internal" href="#reloading-of-screen-after-completion-of-update-process" id="id6">Reloading of screen after completion of update process</a></li>
<li><a class="reference internal" href="#invalid-screen-transition-using-back-button-of-the-browser" id="id7">Invalid screen transition using ‘Back’ button of the browser</a></li>
</ul>
</li>
<li><a class="reference internal" href="#solutions" id="id8">Solutions</a><ul>
<li><a class="reference internal" href="#preventing-double-clicking-of-a-button-using-javascript" id="id9">Preventing double clicking of a button using JavaScript</a></li>
<li><a class="reference internal" href="#about-prg-post-redirect-get-pattern" id="id10">About PRG (Post-Redirect-Get) pattern</a></li>
<li><a class="reference internal" href="#transaction-token-check" id="id11">Transaction Token Check</a></li>
</ul>
</li>
<li><a class="reference internal" href="#about-namespace-of-transaction-token" id="id12">About NameSpace of transaction token</a><ul>
<li><a class="reference internal" href="#problems-that-occur-when-there-is-no-namespace" id="id13">Problems that occur when there is no NameSpace</a></li>
<li><a class="reference internal" href="#behavior-when-namespace-is-specified" id="id14">Behavior when NameSpace is specified</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use" id="id15">How to use</a><ul>
<li><a class="reference internal" href="#preventing-double-clicking-of-button-using-javascript" id="id16">Preventing double clicking of button using JavaScript</a></li>
<li><a class="reference internal" href="#using-prg-post-redirect-get-pattern" id="id17">Using PRG (Post-Redirect-Get) pattern</a></li>
<li><a class="reference internal" href="#using-transaction-token-check" id="id18">Using transaction token check</a><ul>
<li><a class="reference internal" href="#transaction-token-check-provided-by-common-library" id="id19">Transaction token check provided by common library</a></li>
<li><a class="reference internal" href="#attributes-of-transactiontokencheck-annotation" id="id20">Attributes of <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation</a></li>
<li><a class="reference internal" href="#format-of-transaction-token" id="id21">Format of transaction token</a></li>
<li><a class="reference internal" href="#lifecycle-of-transaction-token" id="id22">Lifecycle of transaction token</a></li>
<li><a class="reference internal" href="#settings-for-using-a-transaction-token-check" id="id23">Settings for using a transaction token check</a></li>
<li><a class="reference internal" href="#settings-for-handling-transaction-token-errors" id="id24">Settings for handling transaction token errors</a></li>
<li><a class="reference internal" href="#how-to-use-transaction-token-check-in-controller" id="id25">How to use transaction token check in Controller</a></li>
<li><a class="reference internal" href="#how-to-use-transaction-token-check-in-view-jsp" id="id26">How to use transaction token check in View (JSP)</a></li>
<li><a class="reference internal" href="#when-multiple-usecases-are-to-be-implemented-in-one-controller" id="id27">When multiple usecases are to be implemented in one Controller</a></li>
<li><a class="reference internal" href="#when-a-process-which-does-not-update-screen-for-file-downloading-process-is-included-in-the-use-case" id="id28">When a process which does not update screen for file downloading process is included in the use case</a></li>
<li><a class="reference internal" href="#typical-example-of-using-transaction-token-check" id="id29">Typical example of using transaction token check</a></li>
<li><a class="reference internal" href="#exclusion-control-of-parallel-processing-while-using-a-session" id="id30">Exclusion control of parallel processing while using a session</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-extend" id="id31">How to extend</a><ul>
<li><a class="reference internal" href="#how-to-change-the-maximum-limit-of-transaction-tokens" id="id32">How to change the maximum limit of transaction tokens</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendix" id="id33">Appendix</a><ul>
<li><a class="reference internal" href="#transaction-token-check-in-case-that-the-cache-of-browser-is-disabled" id="id34">Transaction Token Check in case that the cache of browser is disabled</a></li>
<li><a class="reference internal" href="#global-tokens" id="id35">Global Tokens</a><ul>
<li><a class="reference internal" href="#changing-the-maximum-limit-of-transaction-tokens-that-can-be-stored-for-each-namespace" id="id36">Changing the maximum limit of transaction tokens that can be stored for each NameSpace</a></li>
<li><a class="reference internal" href="#implementation-of-controller" id="id37">Implementation of Controller</a></li>
</ul>
</li>
<li><a class="reference internal" href="#quick-reference" id="id38">Quick Reference</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id3">4.5.1. Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<div class="section" id="problems">
<h3><a class="toc-backref" href="#id4">4.5.1.1. Problems</a><a class="headerlink" href="#problems" title="Permalink to this headline">¶</a></h3>
<p>If any of the operations given below is performed in a Web application with screens, it leads to same process being executed multiple times.</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="30%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Operation</th>
<th class="head">Operation Overview</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Double clicking of ‘Update’ button</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Repeatedly clicking the button to perform update process.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Reloading of screen after completing the update process</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Using the ‘Refresh’ button of the browser to reload the screen after completion of update process.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Invalid screen transition using ‘Back’ button of the browser</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Using ‘Back’ button of the browser to go back to the previous page from update process completion screen and clicking the button again to perform update process.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Each problem is described in detail below.</p>
<div class="section" id="double-clicking-of-update-button">
<h4><a class="toc-backref" href="#id5">4.5.1.1.1. Double clicking of ‘Update’ button</a><a class="headerlink" href="#double-clicking-of-update-button" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">The following problems occur when the button to perform update process is clicked repeatedly.</div>
<div class="line">The example of “Product Purchase” on a shopping site is given below to explain the problems that are likely to occur if the necessary measures are not taken.</div>
</div>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/duplicate-double-click.png"><img alt="duplicate double click" src="../../_images/duplicate-double-click.png" style="width: 100%;" /></a>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Buyer clicks ‘Order’ button on Product Purchase screen.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Buyer accidentally clicks ‘Order’ button again before receiving the response of (1).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server updates DB based on purchase of the product received through request (1).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server updates DB based on purchase of the product received through request (2).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server sends response with a “Purchase Complete” screen for the product received through request (2).</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In the above case, since buyer accidentally clicks ‘Order’ button again, <strong>it results in duplicate purchase of same product.</strong>
Although the problem can be attributed to erroneous operation by the buyer, it is desirable to have the application design such that the above problems do not occur.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="reloading-of-screen-after-completion-of-update-process">
<h4><a class="toc-backref" href="#id6">4.5.1.1.2. Reloading of screen after completion of update process</a><a class="headerlink" href="#reloading-of-screen-after-completion-of-update-process" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">The following problems occur when the screen is reloaded after completion of update process.</div>
<div class="line">The example of “Product Purchase” on a shopping site is given below to explain the problems that are likely to occur if the necessary measures are not taken.</div>
</div>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/duplicate-reload.png"><img alt="duplicate reload" src="../../_images/duplicate-reload.png" style="width: 100%;" /></a>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Buyer clicks ‘Order’ button on “Product Purchase” screen.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server updates DB based on purchase of the product received through request (1).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server sends response with a “Purchase complete” screen for the product received through request (1).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Buyer accidently executes Reload functionality of the browser.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server updates DB based on the purchase of the product received through request (4).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server sends response with a “Purchase Complete” screen for the product received through request (4).</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In the above case, since buyer accidentally executes Reload functionality of the browser, <strong>it results in duplicate purchase of same product.</strong>
Although the problem can be attributed to erroneous operation by the buyer, it is desirable to have the application design such that the above problems do not occur.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="invalid-screen-transition-using-back-button-of-the-browser">
<h4><a class="toc-backref" href="#id7">4.5.1.1.3. Invalid screen transition using ‘Back’ button of the browser</a><a class="headerlink" href="#invalid-screen-transition-using-back-button-of-the-browser" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">The following problems occur if invalid screen transition is performed using ‘Back’ button of the browser.</div>
<div class="line">The example of “Product Purchase” on a shopping site is given below to explain the problems that are likely to occur if the necessary measures are not taken.</div>
</div>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/duplicate-invalid-screenflow.png"><img alt="duplicate invalid screen flow" src="../../_images/duplicate-invalid-screenflow.png" style="width: 100%;" /></a>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Buyer clicks ‘Order’ button on “Product Purchase” screen.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server updates DB based on the purchase of the product received through request (1).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server sends response with a “Purchase complete” screen of the product received through request (1).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Buyer uses ‘Back’ button of the browser to go back to “Product Purchase” screen.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Buyer again clicks ‘Order’ button on “Product Purchase” screen which is re-displayed by clicking ‘Back’ button of the browser.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server updates DB based on the purchase of the product received through request (5).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server sends response with a “Purchase Complete” screen for the product received through request (5).</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the above case, since buyer does not perform any erroneous operation, the problem is not attributed to the buyer.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>However, if update process gets executed even after performing invalid screen operations, the following problems occur.</p>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/duplicate-allow-malicious-request.png"><img alt="duplicate allow a malicious request" src="../../_images/duplicate-allow-malicious-request.png" style="width: 100%;" /></a>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>As described above, update process getting executed even after performing invalid screen operations increases the risk of direct updates by a malicious attacker bypassing a valid route.</p>
<blockquote>
<div><table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Attacker executes request for processing a direct product purchase without going through a valid screen transition.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server cannot detect that the request is getting executed through an invalid route; hence it updates DB based on the purchase of the product received through that request.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p class="last">Execution of purchase process through an invalid request increases the load on each server resulting in inability to purchase products through a valid route.
As a result, the problem causes a ripple effect for the users who purchase the products through valid routes. Hence, it is desirable to have the application design such that the above problems do not occur.</p>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="solutions">
<h3><a class="toc-backref" href="#id8">4.5.1.2. Solutions</a><a class="headerlink" href="#solutions" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">The following measures should be taken to resolve the problems described above.</div>
<div class="line">In view of malicious operations such as tampering with requests, <strong>(3) “Applying transaction token check” is mandatory.</strong></div>
</div>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="20%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Solution</th>
<th class="head">Overview</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Preventing double clicking of a button using JavaScript</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When a button to perform update process is clicked, the button control using JavaScript prevents the submission of a request if the button is clicked again.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Applying PRG (Post-Redirect-Get) pattern</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A redirect command is returned as a response to the request for performing update process (request by POST method) and then a screen for transition is returned as a response of GET method which is automatically requested from a browser.</div>
<div class="line">When a PRG pattern is used, the request generated while reloading the page after the screen is displayed is a GET method; hence re-execution of update process can be prevented.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Applying transaction token check</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Issue a token value for each screen transition and compare the token value sent from browser with the token value stored on the Server to make sure that invalid screen operations do not occur in the transaction.</div>
<div class="line">Implementation of transaction token check can prevent re-execution of update process after the page is reloaded using ‘Back’ button of the browser.</div>
<div class="line">Deleting the token value stored on the Server after performing the token check can prevent double submission as a Server side process.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>When only transaction token check is performed, even a simple operational mistake can lead to transaction token error which in turn results in a low-usability application for the user.</p>
<p>To ensure usability as well as to prevent the problems that occur due to double submission, measures such as “Preventing double clicking of a button using JavaScript” and “Applying PRG (Post-Redirect-Get) pattern” are necessary.</p>
<p class="last">** Although this guideline recommends that you implement all the measures, the decision should be taken depending on application requirements.**</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In Ajax and Web services, since it is difficult to transfer transaction tokens which change for each request, transaction token check need not be used.
In Ajax, double submit protection should be performed using only one of the above measures i.e. “Preventing double clicking of a button using JavaScript”.</p>
</div>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p><strong>TBD</strong></p>
<p class="last">There is further scope for reviewing the check methods in Ajax and Web services.</p>
</div>
</div></blockquote>
<div class="section" id="preventing-double-clicking-of-a-button-using-javascript">
<h4><a class="toc-backref" href="#id9">4.5.1.2.1. Preventing double clicking of a button using JavaScript</a><a class="headerlink" href="#preventing-double-clicking-of-a-button-using-javascript" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Prevent double clicking of buttons like button to perform update process or button which is used to perform time-consuming search process.</div>
<div class="line">When a button is clicked, use JavaScript to disable that button or link.</div>
<div class="line">Typical examples of control used for disabling a button or link are given below</div>
</div>
<ol class="arabic simple">
<li>By disabling the button or link so that it cannot be clicked</li>
<li>By maintaining a flag for tracking process status and displaying notification “Process in progress” when the button or link is clicked in the middle of the process.</li>
</ol>
<p>The image when a button is disabled will be as follows:</p>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/prevent-double-click.png"><img alt="prevent double click" src="../../_images/prevent-double-click.png" style="width: 60%;" /></a>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If all the buttons and links on the screen are disabled, the screen operations can no longer be performed if there is no response from the Server.
Therefore, it is recommended not to disable buttons or links that execute events such as “Return to previous screen” or “Go to top screen” etc.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="about-prg-post-redirect-get-pattern">
<span id="doublesubmitprotectionaboutprg"></span><h4><a class="toc-backref" href="#id10">4.5.1.2.2. About PRG (Post-Redirect-Get) pattern</a><a class="headerlink" href="#about-prg-post-redirect-get-pattern" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">A redirect command is returned as a response to the request for performing update process (request by POST method) and then a screen for transition is returned as a response of GET method which is automatically requested from a browser.</div>
<div class="line">When a PRG pattern is used, the request generated while reloading the page after the screen is displayed is a GET method; hence re-execution of update process can be prevented.</div>
</div>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/prevent-double-submit-reload.png"><img alt="prevent double submit by reload" src="../../_images/prevent-double-submit-reload.png" style="width: 100%;" /></a>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Buyer clicks ‘Order’ button on “Product Purchase” screen.</div>
<div class="line"><strong>The request is submitted using POST method.</strong></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server updates DB based on the purchase of the product received through request (1).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><strong>Server sends a redirect response for the URL to display the “Purchase Complete” screen for the product.</strong></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Browser submits request for the URL to display the “Purchase Complete” screen for the product.</div>
<div class="line"><strong>The request is submitted using GET method.</strong></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server sends response with a “Purchase Complete” screen for the product.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Buyer accidentally executes Reload functionality of the browser.</div>
<div class="line">The request called by Reload functionality displays “Purchase Complete” screen of the product; hence <strong>update process is not re-executed.</strong></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server sends response with a “Purchase Complete” screen.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is recommended to use <abbr title="Post-Redirect-Get">PRG</abbr> pattern for the processes associated with update process and implement a control so that a request of GET method is sent when ‘Refresh’ button of the browser is clicked.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In the <abbr title="Post-Redirect-Get">PRG</abbr> pattern, the re-execution of update process cannot be prevented by clicking ‘Back’ button of the browser on Completion screen.
A transaction token check must be performed to prevent re-execution of update process after an invalid screen transition using ‘Back’ button of the browser.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="transaction-token-check">
<span id="double-submit-transactiontokencheck"></span><h4><a class="toc-backref" href="#id11">4.5.1.2.3. Transaction Token Check</a><a class="headerlink" href="#transaction-token-check" title="Permalink to this headline">¶</a></h4>
<p>Transaction token check consists of the following 3 processes.</p>
<ul class="simple">
<li>When a request is received from Client, the Server stores a value (hereafter referred to as transaction token) for uniquely identifying a transaction on the Server.</li>
<li>Server passes the transaction token to the Client. In case of a Web application with screens, it passes the transaction token to the Client using hidden tag of form.</li>
<li>When submitting the next request, Client sends the transaction token that was passed from the Server. Server compares the transaction token received from the Client and the transaction token stored on the Server.</li>
</ul>
<p>When the transaction token sent in the request does not match with the transaction token stored on the Server, it is treated as invalid request and an error is returned.</p>
<blockquote>
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Misuse of transaction token check leads to poor usability of the application; hence the scope of its usage should be defined by considering the following points.</p>
<ul class="last">
<li><div class="first line-block">
<div class="line">It is not necessary to include reference-type requests that do not involve data update and requests that perform only screen transitions in the scope of transaction token check.</div>
<div class="line">If the scope of transactions is extended unnecessarily, transaction token errors are more likely to occur which in turn reduces the usability of the application.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Transaction token check is not mandatory for the processes wherein there is no problem even if the data gets updated multiple times from business perspective (user information update etc.).</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Transaction token check is mandatory for the processes such as deposit process or product purchase process etc. wherein there is a risk of duplicate execution.</div>
</div>
</li>
</ul>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The process flow when expected operations are performed and process flow when unexpected operations are performed using transaction token check are shown below.</p>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/transaction-token-check-overview.png"><img alt="transaction token overview" src="../../_images/transaction-token-check-overview.png" style="width: 100%;" /></a>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">The process flow when expected operations are performed is as follows:</div>
</div>
<blockquote>
<div><table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Client sends the request.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server creates the transaction token (token001) and stores it on the Server.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server passes the created transaction token (token001) to the Client.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Client sends the request along with the transaction token (token001).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server checks whether the transaction token (token001) stored on the Server and the transaction token (token001) submitted by the Client are same.</div>
<div class="line"><strong>Since the values are same, the request is considered as valid.</strong></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server generates transaction token (token002) to be used in the next request and updates the value stored on the Server.</div>
<div class="line">At this point, the transaction token (token001) is discarded.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server passes the updated transaction token (token002) to the Client.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line">The process flow when unexpected operations are performed is as follows:</div>
<div class="line">Here, ‘Back’ button of the browser is taken as an example; however, this is also applicable for the direct requests from shortcuts etc.</div>
</div>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">‘Back’ button of the browser on Client side is clicked.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Request is sent from Client side along with the transaction token (token001) of the screen which is displayed after clicking ‘Back’ button.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server checks whether the transaction token (token002) stored on the Server and the transaction token (token001) submitted by the Client are same.</div>
<div class="line"><strong>Since the values are different, the request is considered as invalid and a transaction token error is thrown.</strong></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(11)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server sends response with an error screen to notify that a transaction token error has occurred.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The 3 events described below can be prevented by transaction token check.</p>
<ul class="simple">
<li>Invalid screen transition in case of a business process that requires fixed screen transition</li>
<li>Data update due to invalid requests that do not involve valid screen transitions</li>
<li>Duplicate execution of update process due to double submission</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Invalid screen transition in case of a business process that requires fixed screen transition, can be prevented by the flow shown below.</p>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/transaction-token-check-prevent-invalid-screenflow.png"><img alt="prevent invalid screen flow by transaction token check" src="../../_images/transaction-token-check-prevent-invalid-screenflow.png" style="width: 100%;" /></a>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Buyer clicks ‘Order’ button on “Product Purchase” screen.</div>
<div class="line">Since the transaction token stored on the Server and the transaction token submitted by the Client match, the process to purchase the product is executed.</div>
<div class="line"><strong>At this time, the value of the transaction token stored on the Server is discarded and updated to a new token value.</strong></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server updates DB based on the purchase of the product received through request (1).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server sends response with a “Purchase Complete” screen for the product received through request (1).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Buyer uses ‘Back’ button of the browser to go back to “Product Purchase” screen.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Buyer again clicks ‘Order’ button on “Product Purchase” screen which is displayed using ‘Back’ button of the browser.</div>
<div class="line"><strong>Since the transaction token sent by the Client is a value which has already been discarded, a transaction token error occurs.</strong></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server sends response with an error screen to notify that a transaction token error has occurred.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Data updated by an invalid request which does not involve a valid screen transition can be prevented by the flow shown below.</p>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/transaction-token-check-prevent-malicious-request.png"><img alt="prevent malicious request by transaction token check" src="../../_images/transaction-token-check-prevent-malicious-request.png" style="width: 100%;" /></a>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Attacker sends a request to purchase the product directly without performing a valid screen transition.</div>
<div class="line"><strong>Since the request for generating a transaction token is not executed, a transaction token error occurs.</strong></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server sends response with an error screen to notify that a transaction token error has occurred.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Duplicate execution of update process at the time of double submission can be prevented by the flow shown below.</p>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/transaction-token-check-prevent-double-submit.png"><img alt="prevent double submit by transaction token check" src="../../_images/transaction-token-check-prevent-double-submit.png" style="width: 100%;" /></a>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Buyer clicks ‘Order’ button on “Product Purchase” screen.</div>
<div class="line">Since the transaction token stored on the server and the transaction token submitted by the Client match, the process to purchase the product is executed.</div>
<div class="line"><strong>At this time, the value of the transaction token that is stored on the server is discarded and updated to a new token value.</strong></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Buyer accidentally clicks ‘Order’ button again before the response of (1) is returned.</div>
<div class="line"><strong>Since the transaction token sent by the Client is a value which has already been discarded, a transaction token error occurs</strong> when process of (1) is executed.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server <strong>sends response with an error screen to notify that a transaction token error has occurred</strong> for the request (2).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server updates DB based on the purchase of the product received through request (1).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server attempts to respond with a “Purchase Complete” screen for the product received  through request (1); however since the stream for responding to the request of (1) is closed due to the transmission of the request of (2), it fails to send response with a “Purchase Complete” screen.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This can prevent duplicate execution of update process at the time of double submission; however this does not resolve the problem of server not being able to respond with a screen to notify the completion of process.
Therefore, it is also recommended to deal with this problem by preventing double clicking of a button using JavaScript.</p>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="about-namespace-of-transaction-token">
<h3><a class="toc-backref" href="#id12">4.5.1.3. About NameSpace of transaction token</a><a class="headerlink" href="#about-namespace-of-transaction-token" title="Permalink to this headline">¶</a></h3>
<p>In the transaction token check functionality provided by the common library, it is possible to set a NameSpace in the container for storing transaction token.
This enables parallel execution of update process using a tab browser or multiple windows.</p>
<div class="section" id="problems-that-occur-when-there-is-no-namespace">
<h4><a class="toc-backref" href="#id13">4.5.1.3.1. Problems that occur when there is no NameSpace</a><a class="headerlink" href="#problems-that-occur-when-there-is-no-namespace" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Let us see the problems that occur when there is no NameSpace.</div>
<div class="line">The figure below illustrates an example wherein two clients are arranged side by side; basically 2 windows are launched on same machine.</div>
</div>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/token-only-one.png"><img alt="token only one" src="../../_images/token-only-one.png" style="width: 100%;" /></a>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The request is sent from Window 1, then the transaction token (token001) received as a response is stored in the browser.</div>
<div class="line">The transaction token stored on the server is considered token001.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The request is sent from Window 2, then the transaction token (token002) received as a response is stored in the browser.</div>
<div class="line"><strong>The transaction token stored on the server is considered token002. The transaction token (token001) generated by the process (1) is discarded at this point.</strong></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The request is sent from Window 1 along with the transaction token (token001) stored in the browser.</div>
<div class="line">Since the transaction token stored on the server (token002) and the transaction token sent by the request (token001) do not match, the request is considered as invalid resulting in a transaction token error.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><strong>The update process cannot be executed concurrently in absence of NameSpace; hence the application becomes a low-usability application.</strong></p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="behavior-when-namespace-is-specified">
<h4><a class="toc-backref" href="#id14">4.5.1.3.2. Behavior when NameSpace is specified</a><a class="headerlink" href="#behavior-when-namespace-is-specified" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Let us now see the behavior when NameSpace is specified.</div>
<div class="line">The problem wherein the update process could not be executed concurrently in the absence of NameSpace can now be resolved by specifying a NameSpace.</div>
<div class="line">The figure below illustrates an example wherein two clients are arranged side by side; basically 2 windows are launched on same machine.</div>
</div>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/token-namespace.png"><img alt="token namespace" src="../../_images/token-namespace.png" style="width: 100%;" /></a>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">NameSpaces are shown as 111, 222 in the figure.</div>
<div class="line">** When a NameSpace is specified, the transaction token in the NameSpace allocated to the transaction is handled independently. Hence, it does not affect the transactions of another NameSpace.**</div>
<div class="line">Here, even though the browser is explained using different Windows, the tab browser works in the same way. For generated keys and usage method, refer to <a class="reference internal" href="#doublesubmit-how-to-use-transaction-token-check"><span class="std std-ref">Using transaction token check</span></a>.</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="how-to-use">
<span id="id1"></span><h2><a class="toc-backref" href="#id15">4.5.2. How to use</a><a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h2>
<div class="section" id="preventing-double-clicking-of-button-using-javascript">
<h3><a class="toc-backref" href="#id16">4.5.2.1. Preventing double clicking of button using JavaScript</a><a class="headerlink" href="#preventing-double-clicking-of-button-using-javascript" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Double clicking of a button on Client side can be prevented using JavaScript.</div>
<div class="line">Once a button is clicked, it should not be possible to click it again till it is re-generated.</div>
</div>
<blockquote>
<div><div class="admonition-todo admonition" id="index-1">
<p class="first admonition-title">Todo</p>
<p><strong>TBD</strong></p>
<p class="last">The check method in JavaScript will be described in detail in subsequent versions.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="using-prg-post-redirect-get-pattern">
<h3><a class="toc-backref" href="#id17">4.5.2.2. Using PRG (Post-Redirect-Get) pattern</a><a class="headerlink" href="#using-prg-post-redirect-get-pattern" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">The example of implementing PRG (Post-Redirect-Get) pattern is given below.</div>
<div class="line">The application which involves a simple screen transition such as Input Screen-&gt; Confirmation Screen-&gt; Completion Screen is taken as an example.</div>
</div>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/staff-redirect-flow.png"><img alt="STAFF REDIRECT FLOW" src="../../_images/staff-redirect-flow.png" style="width: 100%;" /></a>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">The image numbers and comment number of source code are linked.</div>
<div class="line">However, since (1)-(4) is not directly related to the PRG pattern, the explanation is omitted.</div>
</div>
<ul class="simple">
<li>Controller</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;prgExample&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostRedirectGetExampleController</span> <span class="p">{</span>

    <span class="nd">@Inject</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="p">;</span>

    <span class="nd">@ModelAttribute</span>
    <span class="kd">public</span> <span class="n">PostRedirectGetForm</span> <span class="nf">setUpForm</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">PostRedirectGetForm</span> <span class="n">form</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PostRedirectGetForm</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">form</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;form&quot;</span><span class="p">)</span> <span class="c1">// (1)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">createForm</span><span class="p">(</span>
        <span class="n">PostRedirectGetForm</span> <span class="n">postRedirectGetForm</span><span class="p">,</span>
        <span class="n">BindingResult</span> <span class="n">bindingResult</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;prg/createForm&quot;</span><span class="p">;</span> <span class="c1">// (2)</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">,</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;confirm&quot;</span><span class="p">)</span> <span class="c1">// (3)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">createConfirm</span><span class="p">(</span>
        <span class="nd">@Validated</span> <span class="n">PostRedirectGetForm</span> <span class="n">postRedirectGetForm</span><span class="p">,</span>
        <span class="n">BindingResult</span> <span class="n">bindingResult</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s">&quot;prg/createForm&quot;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="s">&quot;prg/createConfirm&quot;</span><span class="p">;</span> <span class="c1">//  (4)</span>
    <span class="p">}</span>

<span class="hll">    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span>
</span><span class="hll">                    <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span> <span class="c1">// (5)</span>
</span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">create</span><span class="p">(</span>
        <span class="nd">@Validated</span> <span class="n">PostRedirectGetForm</span> <span class="n">postRedirectGetForm</span><span class="p">,</span>
        <span class="n">BindingResult</span> <span class="n">bindingResult</span><span class="p">,</span>
        <span class="n">RedirectAttributes</span> <span class="n">redirectAttributes</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s">&quot;prg/createForm&quot;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// omitted</span>

<span class="hll">        <span class="n">String</span> <span class="n">output</span> <span class="o">=</span> <span class="s">&quot;result register...&quot;</span><span class="p">;</span> <span class="c1">// (6)</span>
</span><span class="hll">        <span class="n">redirectAttributes</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="s">&quot;output&quot;</span><span class="p">,</span> <span class="n">output</span><span class="p">);</span> <span class="c1">// (6)</span>
</span><span class="hll">        <span class="k">return</span> <span class="s">&quot;redirect:/prgExample/create?complete&quot;</span><span class="p">;</span> <span class="c1">// (6)</span>
</span>    <span class="p">}</span>

<span class="hll">    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span>
</span><span class="hll">                    <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span>
</span><span class="hll">                    <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;complete&quot;</span><span class="p">)</span> <span class="c1">// (7)</span>
</span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">createComplete</span><span class="p">()</span> <span class="p">{</span>
<span class="hll">        <span class="k">return</span> <span class="s">&quot;prg/createComplete&quot;</span><span class="p">;</span> <span class="c1">// (8)</span>
</span>    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A handler method to perform a process when ‘Register’ button (Create User button) on Confirmation screen is clicked.</div>
<div class="line"><strong>The request is received by POST method.</strong></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><strong>It is redirected to URL for displaying Completion screen.</strong></div>
<div class="line">In the above example, a request is sent to URL <code class="docutils literal"><span class="pre">prgExample/create?complete</span></code>  by <code class="docutils literal"><span class="pre">GET</span></code> method.</div>
<div class="line">When data is to be delivered to redirect destination, addFlashAttribute method of <code class="docutils literal"><span class="pre">RedirectAttributes</span></code> is called and the data to be delivered is added.</div>
<div class="line">addAttribute method of <code class="docutils literal"><span class="pre">Model</span></code> cannot deliver data to the redirect destination.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A handler method to display Completion screen.</div>
<div class="line"><strong>A request is received by GET method.</strong></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">View (JSP) is called to display the Completion screen and responds with Completion screen.</div>
<div class="line">Since the extension of JSP is assigned by <code class="docutils literal"><span class="pre">ViewResolver</span></code> defined in <code class="file docutils literal"><span class="pre">spring-mvc.xml</span></code>, it is omitted from the return value of the handler method.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>At the time of redirecting, assign “redirect:” as the prefix of transition information to be returned by the handler method as the return value.</li>
<li>When the data is to be delivered to the process of redirect destination, call addFlashAttribute method of <code class="docutils literal"><span class="pre">RedirectAttributes</span></code> and add the data to be delivered.</li>
</ul>
</div>
</div></blockquote>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">createForm.jsp</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;h1&gt;</span>Create User<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;prgForm&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;form:form</span>
    <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/prgExample/create&quot;</span>
    <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">modelAttribute=</span><span class="s">&quot;postRedirectGetForm&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;form:label</span> <span class="na">path=</span><span class="s">&quot;firstName&quot;</span><span class="nt">&gt;</span>FirstName<span class="nt">&lt;/form:label&gt;</span>
    <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;firstName&quot;</span> <span class="nt">/&gt;&lt;br&gt;</span>
    <span class="nt">&lt;form:label</span> <span class="na">path=</span><span class="s">&quot;lastName&quot;</span><span class="nt">&gt;</span>LastName:<span class="nt">&lt;/form:label&gt;</span>
    <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;lastName&quot;</span> <span class="nt">/&gt;&lt;br&gt;</span>
    <span class="nt">&lt;form:button</span> <span class="na">name=</span><span class="s">&quot;confirm&quot;</span><span class="nt">&gt;</span>Confirm Create User<span class="nt">&lt;/form:button&gt;</span>
  <span class="nt">&lt;/form:form&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">createConfirm.jsp</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;h1&gt;</span>Confirm Create User<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;prgForm&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;form:form</span>
    <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/prgExample/create&quot;</span>
<span class="hll">    <span class="na">method=</span><span class="s">&quot;post&quot;</span>
</span>    <span class="na">modelAttribute=</span><span class="s">&quot;postRedirectGetForm&quot;</span><span class="nt">&gt;</span>
    FirstName:${f:h(postRedirectGetForm.firstName)}<span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;form:hidden</span> <span class="na">path=</span><span class="s">&quot;firstName&quot;</span> <span class="nt">/&gt;</span>
    LastName:${f:h(postRedirectGetForm.lastName)}<span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;form:hidden</span> <span class="na">path=</span><span class="s">&quot;lastName&quot;</span> <span class="nt">/&gt;</span>
<span class="hll">    <span class="nt">&lt;form:button&gt;</span>Create User<span class="nt">&lt;/form:button&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span>  <span class="nt">&lt;/form:form&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When the button to perform update process is clicked, <strong>a request is sent by POST method.</strong></div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">createComplete.jsp</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;h1&gt;</span>Successful Create User Completion<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;prgForm&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;form:form</span>
    <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/prgExample/create&quot;</span>
    <span class="na">method=</span><span class="s">&quot;get&quot;</span> <span class="na">modelAttribute=</span><span class="s">&quot;postRedirectGetForm&quot;</span><span class="nt">&gt;</span>
<span class="hll">    output:${f:h(output)}<span class="nt">&lt;br&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span>    <span class="nt">&lt;form:button</span> <span class="na">name=</span><span class="s">&quot;backToTop&quot;</span><span class="nt">&gt;</span>Top<span class="nt">&lt;/form:button&gt;</span>
  <span class="nt">&lt;/form:form&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When the data delivered from update process is to be referred at the redirect destination, <strong>specify the attribute name of the data added by the addFlashAttribute method</strong> of <code class="docutils literal"><span class="pre">RedirectAttributes</span></code>.</div>
<div class="line">In the above example, <code class="docutils literal"><span class="pre">output</span></code> is the attribute name to refer to the delivered data.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="using-transaction-token-check">
<span id="doublesubmit-how-to-use-transaction-token-check"></span><h3><a class="toc-backref" href="#id18">4.5.2.3. Using transaction token check</a><a class="headerlink" href="#using-transaction-token-check" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">The example of implementation using transaction token check is given below.</div>
<div class="line">Transaction token check functionality is provided by the common library and not by Spring MVC.</div>
</div>
<div class="section" id="transaction-token-check-provided-by-common-library">
<h4><a class="toc-backref" href="#id19">4.5.2.3.1. Transaction token check provided by common library</a><a class="headerlink" href="#transaction-token-check-provided-by-common-library" title="Permalink to this headline">¶</a></h4>
<p>Transaction token check functionality of common library provides <code class="docutils literal"><span class="pre">&#64;org.terasoluna.gfw.web.token.transaction.TransactionTokenCheck</span></code> annotation to perform the following tasks:</p>
<ul class="simple">
<li>Creation of NameSpace for transaction token</li>
<li>Starting the transaction</li>
<li>Token value check in the transaction</li>
<li>Ending the transaction</li>
</ul>
<p>The transaction token check can be performed declaratively by assigning <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation for the
Controller class and the handler methods of the Controller class.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="attributes-of-transactiontokencheck-annotation">
<span id="transaction-token-check-attribute"></span><h4><a class="toc-backref" href="#id20">4.5.2.3.2. Attributes of <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation</a><a class="headerlink" href="#attributes-of-transactiontokencheck-annotation" title="Permalink to this headline">¶</a></h4>
<p>The attributes that can be specified in <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation are explained below.</p>
<blockquote>
<div><table border="1" class="colwidths-given longtable docutils" id="id2">
<caption><span class="caption-text"><code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code>Annotation Parameter List</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="11%" />
<col width="11%" />
<col width="47%" />
<col width="11%" />
<col width="21%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Attribute Name</th>
<th class="head">Contents</th>
<th class="head">default</th>
<th class="head">Example</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>value</td>
<td><div class="first last line-block">
<div class="line">Any character string. Used as NameSpace.</div>
</div>
</td>
<td>None</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">value</span> <span class="pre">=</span> <span class="pre">&quot;create&quot;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">value</span> <span class="pre">=</span></code> part can be omitted if there is only one argument.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>namespace</td>
<td><div class="first last line-block">
<div class="line">Any string.Used as NameSpace.</div>
<div class="line">It is an alias of value attribute.</div>
</div>
</td>
<td>None</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">namespace</span> <span class="pre">=</span> <span class="pre">&quot;create&quot;</span></code></div>
<div class="line">Synonymous with <code class="docutils literal"><span class="pre">value</span> <span class="pre">=</span> <span class="pre">&quot;create&quot;</span></code>. It is used as an alternative to value attribute since value attribute cannot be used while using  <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> as a meta-annotation.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>type</td>
<td><div class="first last line-block">
<div class="line"><strong>BEGIN</strong></div>
<div class="line">A transaction token is created and a new transaction is started.</div>
<div class="line"><br /></div>
<div class="line"><strong>IN</strong></div>
<div class="line">Transaction token is validated.</div>
<div class="line">When the requested token value and the token value stored on the server match, the token value of transaction token is updated.</div>
<div class="line"><br /></div>
<div class="line"><strong>CHECK</strong></div>
<div class="line">Transaction token is validated.</div>
<div class="line">Even when the requested token value and the token value stored on the server match,the token value of transaction token is not updated.</div>
<div class="line">For used cases, refer “<a class="reference internal" href="#usecase-of-transaction-token-type-check"><span class="std std-ref">When a process which does not update screen for file downloading process is included in the use case</span></a>”.</div>
<div class="line"><br /></div>
</div>
</td>
<td>IN</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">type</span> <span class="pre">=</span> <span class="pre">TransactionTokenType.BEGIN</span></code></div>
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">type</span> <span class="pre">=</span> <span class="pre">TransactionTokenType.IN</span></code></div>
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">type</span> <span class="pre">=</span> <span class="pre">TransactionTokenType.CHECK</span></code></div>
<div class="line"><br /></div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is recommended that the value to be set in value attribute or namespace attribute should be same as the config value of “value” attribute for <code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code> annotation.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In “type” attribute, <strong>NONE</strong> and <strong>END</strong> can be specified; however, the description is omitted as normally they are not used.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="format-of-transaction-token">
<h4><a class="toc-backref" href="#id21">4.5.2.3.3. Format of transaction token</a><a class="headerlink" href="#format-of-transaction-token" title="Permalink to this headline">¶</a></h4>
<p>Format for the transaction token used in the transaction token check of common library is as follows:</p>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/transaction-token-name-pattern.png"><img alt="format of transaction token" src="../../_images/transaction-token-name-pattern.png" style="width: 100%;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/transaction-token-name-pattern-example.png"><img alt="example of transaction token" src="../../_images/transaction-token-name-pattern-example.png" style="width: 100%;" /></a>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="15%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Components</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>NameSpace</td>
<td><ul class="first last simple">
<li>NameSpace is an element for assigning a logical name to identify a series of screen transitions.</li>
<li>By setting a NameSpace, it is possible to prevent the requests belonging to different Namespaces from interfering with each other and it is also possible to increase the number of screen transitions that can operate in parallel.</li>
<li>The value specified in the “value” attribute of <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation is used as the value to be used for NameSpace.</li>
<li>When both “value” attribute of the “class” annotation and “value” attribute of the “method” annotation are specified, the value which concatenates both the values with “<code class="docutils literal"><span class="pre">/</span></code>”  is used as NameSpace. When the same value is specified in multiple methods, the methods belong to same NameSpace.</li>
<li>When the “value” attribute is specified only in “class” annotation, all the NameSpaces of the transaction tokens generated in that class will be the value specified in “class” annotation.</li>
<li>When the “value” attribute is specified only in “method” annotation, the NameSpace of the generated transaction tokens will be the value specified in “method” annotation. When the same value is specified in multiple methods, the methods belong to same NameSpace.</li>
<li>When both “value” attribute of “class” annotation and “value” attribute of “method” annotation are omitted, the method belong to the global token. For global token, refer to <a class="reference internal" href="#doublesubmit-appendix-global-token"><span class="std std-ref">Global Tokens</span></a>.</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>TokenKey</td>
<td><ul class="first last">
<li><p class="first">TokenKey is an element for identifying the transactions stored in the Namespace.</p>
</li>
<li><p class="first">TokenKey is generated upon execution of a method wherein <code class="docutils literal"><span class="pre">TransactionTokenType.BEGIN</span></code> is declared in the “type” attribute of <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation.</p>
</li>
<li><div class="first line-block">
<div class="line">A maximum limit exists for the number of multiple TokenKeys which can be concurrently stored and the default number is 10. The count of stored TokenKeys is managed for each NameSpace.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">When the number of TokenKeys stored for each NameSpace reaches the maximum value at the time of <code class="docutils literal"><span class="pre">TransactionTokenType.BEGIN</span></code>, a new transaction will be stored as a valid transaction by discarding the TokenKey with the oldest date and time of execution (Least Recently Used (LRU)).</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">When the access is made by using the discarded transaction token, a transaction token error is thrown.</div>
</div>
</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>TokenValue</td>
<td><ul class="first last simple">
<li>TokenValue is an element for storing the token value of the transaction.</li>
<li>TokenValue is generated upon execution of the method wherein <code class="docutils literal"><span class="pre">TransactionTokenType.BEGIN</span></code> or <code class="docutils literal"><span class="pre">TransactionTokenType.IN</span></code> is declared in the “type” attribute of <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>When the “value” attribute is specified only in “method” annotation and if the same value is specified in another Controller, it should be noted that it will be handled as a request for carrying out a series of screen transitions.
“value” attribute should be specified by this method only when the screen transitions across Controllers are to be treated as the same transaction.</p>
<p class="last">Basically, it is recommended not to use the method wherein “value” attribute is specified only in “method” annotation.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The method for specifying NameSpace is classified according to creation granularity of the Controller,</p>
<ul class="simple">
<li>when “value” attributes of both “class” annotation and “method” annotation are specified</li>
<li>when “value” attribute is specified only in “class” annotation</li>
</ul>
<ol class="last arabic">
<li><div class="first line-block">
<div class="line">When a handler method which corresponds to multiple usecases is to be implemented in Controller, “value” attributes of both “class” annotation and “method” annotation are specified.</div>
<div class="line">For example, this pattern is used when registration, change, deletion of users is to be implemented in a single Controller.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">When a handler method which corresponds to a single usecase is to be implemented in Controller, “value” attribute is specified only in “class” annotation.</div>
<div class="line">For example, this pattern is used when a Controller is implemented for every registration, modification, deletion of users.</div>
</div>
</li>
</ol>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="lifecycle-of-transaction-token">
<span id="lifecycle"></span><h4><a class="toc-backref" href="#id22">4.5.2.3.4. Lifecycle of transaction token</a><a class="headerlink" href="#lifecycle-of-transaction-token" title="Permalink to this headline">¶</a></h4>
<p>The lifecycle (Generate, Update, Discard) control of transaction token is performed in the following scenarios.</p>
<blockquote>
<div><table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="20%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Lifecycle Control</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Token Generation</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A new token is generated and transaction is started when the processing of the method wherein <code class="docutils literal"><span class="pre">TransactionTokenType.BEGIN</span></code> is specified in “type” attribute of <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation, is terminated.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Token Update</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The token (TokenValue) is updated and transaction is continued when the processing of the method wherein <code class="docutils literal"><span class="pre">TransactionTokenType.IN</span></code> is specified in “type” attribute of <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation, is terminated.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Token Discard</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The tokens are discarded in any of the following scenarios and the transaction is terminated.</div>
<div class="line"><br /></div>
<div class="line">[1]</div>
<div class="line">When the method wherein ``TransactionTokenType.BEGIN`` is specified in “type” attribute of <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation, is called, the transaction token specified in the request parameter is discarded and unnecessary transaction is terminated.</div>
<div class="line"><br /></div>
<div class="line">[2]</div>
<div class="line">If a new transaction starts when number of transaction tokens (TokenKey) that can be stored in NameSpace has reached the maximum limit, the transaction token with the oldest date and time of execution is discarded and the transaction is forcibly terminated.</div>
<div class="line"><br /></div>
<div class="line">[3]</div>
<div class="line">When exceptions such as system error occur, the transaction token specified in the request parameter is discarded and the transaction is terminated.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Token inherited</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Token on the server is inherited within the termination of the process for the method which specifies <code class="docutils literal"><span class="pre">TransactionTokenType.CHECK</span></code> in type attribute of <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation and the transaction is continued.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>A maximum limit is provided for the number of transaction tokens (TokenKey) which can be stored in a NameSpace. When the maximum limit is reached
while generating a new transaction token, a new transaction is managed as a valid transaction,
by discarding the transaction token which has the TokenKey with the oldest date and time of execution (Least Recently Used (LRU)).</p>
<p class="last">The maximum limit of transaction tokens that can be stored for each NameSpace is 10 by default.
To change the maximum limit, refer to <a class="reference internal" href="#doublesubmit-how-to-extend-change-max-count"><span class="std std-ref">How to change the maximum limit of transaction tokens</span></a> .</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">The behavior when the maximum limit is reached while generating a new transaction token is explained below.</div>
<div class="line">The pre-requisites are as given below.</div>
</div>
<ul class="simple">
<li>A default value (10) is specified as the maximum limit for the number of transaction tokens that can be stored in the NameSpace.</li>
<li><code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck(&quot;name&quot;)</span></code> is specified as the class annotation of Controller.</li>
<li>Transaction tokens of the same NameSpace have reached the maximum limit.</li>
</ul>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/transaction-token-count.png"><img alt="transaction token count" src="../../_images/transaction-token-count.png" style="width: 100%;" /></a>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A request to start a new transaction is received when the transaction tokens of the same NameSpace have reached the maximum limit.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A new transaction token is generated.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The generated transaction token is added to the location where tokens are stored.</div>
<div class="line">** At this point, the transaction tokens that exceed the maximum limit are present in the NameSpace.**</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The transaction tokens exceeding the maximum limit are deleted from the NameSpace.</div>
<div class="line"><strong>The transaction tokens are deleted in a sequence starting with the transaction token with the oldest date and time of execution.</strong></div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="settings-for-using-a-transaction-token-check">
<span id="setting"></span><h4><a class="toc-backref" href="#id23">4.5.2.3.5. Settings for using a transaction token check</a><a class="headerlink" href="#settings-for-using-a-transaction-token-check" title="Permalink to this headline">¶</a></h4>
<p>The settings for using the transaction token check provided by the common library are shown below.</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">spring-mvc.xml</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;mvc:interceptors&gt;</span>
<span class="hll">    <span class="nt">&lt;mvc:interceptor&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&quot;/**&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/resources/**&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/**/*.html&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;bean</span>
</span><span class="hll">            <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.token.transaction.TransactionTokenInterceptor&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/mvc:interceptor&gt;</span>
</span><span class="nt">&lt;/mvc:interceptors&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;requestDataValueProcessor&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.mvc.support.CompositeRequestDataValueProcessor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg&gt;</span>
        <span class="nt">&lt;util:list&gt;</span>
<span class="hll">            <span class="c">&lt;!-- (4) --&gt;</span>
</span><span class="hll">            <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.token.transaction.TransactionTokenRequestDataValueProcessor&quot;</span> <span class="nt">/&gt;</span>
</span>            <span class="c">&lt;!-- omitted --&gt;</span>
        <span class="nt">&lt;/util:list&gt;</span>
    <span class="nt">&lt;/constructor-arg&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set <code class="docutils literal"><span class="pre">HandlerInterceptor</span></code> to generate and check transaction tokens.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify a request path wherein <code class="docutils literal"><span class="pre">HandlerInterceptor</span></code> is to be applied.</div>
<div class="line">In the above example, it is applicable to all the requests except the requests under /resources and the requests to HTML.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify a class (<code class="docutils literal"><span class="pre">TransactionTokenInterceptor</span></code>) to generate and check transaction tokens using <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set a class (<code class="docutils literal"><span class="pre">TransactionTokenRequestDataValueProcessor</span></code>) for automatic embedding of the transaction token to the Hidden area using  <code class="docutils literal"><span class="pre">&lt;form:form&gt;</span></code> tag of Spring MVC.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="settings-for-handling-transaction-token-errors">
<h4><a class="toc-backref" href="#id24">4.5.2.3.6. Settings for handling transaction token errors</a><a class="headerlink" href="#settings-for-handling-transaction-token-errors" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">When a transaction token error occurs, ``org.terasoluna.gfw.web.token.transaction.InvalidTransactionTokenException`` is generated.</div>
</div>
<div class="line-block">
<div class="line">Therefore, in order to handle transaction token errors, it is necessary to add the handling definition of <code class="docutils literal"><span class="pre">InvalidTransactionTokenException</span></code> to the following settings.</div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">ExceptionCodeResolver</span></code> defined in <code class="file docutils literal"><span class="pre">applicationContext.xml</span></code></li>
<li><code class="docutils literal"><span class="pre">SystemExceptionResolver</span></code> defined in <code class="file docutils literal"><span class="pre">spring-mvc.xml</span></code></li>
</ul>
<p>For adding the settings, refer to the following:</p>
<ul class="simple">
<li><a class="reference internal" href="ExceptionHandling.html#exception-handling-how-to-use-application-configuration-common-label"><span class="std std-ref">Common Settings</span></a></li>
<li><a class="reference internal" href="ExceptionHandling.html#exception-handling-how-to-use-application-configuration-app-label"><span class="std std-ref">Application Layer Settings</span></a></li>
</ul>
</div>
<div class="section" id="how-to-use-transaction-token-check-in-controller">
<h4><a class="toc-backref" href="#id25">4.5.2.3.7. How to use transaction token check in Controller</a><a class="headerlink" href="#how-to-use-transaction-token-check-in-controller" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">In order to perform transaction token check, it is necessary to define the method to start the transaction and the method to carry out the checks in Controller.</div>
<div class="line">The explanation below is about the implementation of handler method required in a single usecase using a controller.</div>
</div>
<ul class="simple">
<li>Controller</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;transactionTokenCheckExample&quot;</span><span class="p">)</span>
<span class="hll"><span class="nd">@TransactionTokenCheck</span><span class="p">(</span><span class="s">&quot;transactionTokenCheckExample&quot;</span><span class="p">)</span> <span class="c1">// (1)</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TransactionTokenCheckExampleController</span> <span class="p">{</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="s">&quot;first&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">first</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;transactionTokenCheckExample/firstView&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="s">&quot;second&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
<span class="hll">    <span class="nd">@TransactionTokenCheck</span><span class="p">(</span><span class="n">type</span> <span class="o">=</span> <span class="n">TransactionTokenType</span><span class="p">.</span><span class="na">BEGIN</span><span class="p">)</span> <span class="c1">// (2)</span>
</span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">second</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;transactionTokenCheckExample/secondView&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="s">&quot;third&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
<span class="hll">    <span class="nd">@TransactionTokenCheck</span> <span class="c1">// (3)</span>
</span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">third</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;transactionTokenCheckExample/thirdView&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="s">&quot;fourth&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
<span class="hll">    <span class="nd">@TransactionTokenCheck</span> <span class="c1">// (3)</span>
</span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">fourth</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;transactionTokenCheckExample/fourthView&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="s">&quot;fifth&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
<span class="hll">    <span class="nd">@TransactionTokenCheck</span> <span class="c1">// (3)</span>
</span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">fifth</span><span class="p">()</span> <span class="p">{</span>
<span class="hll">        <span class="k">return</span> <span class="s">&quot;redirect:/transactionTokenCheckExample?complete&quot;</span><span class="p">;</span>
</span>    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="s">&quot;complete&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">)</span>
<span class="hll">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">complete</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// (4)</span>
</span>        <span class="k">return</span> <span class="s">&quot;transactionTokenCheckExample/fifthView&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">NameSpace is specified in “value” attribute of “class” annotation.</div>
<div class="line">In the above example, the value same as the “value” attribute of <code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code> which is the recommended pattern of this guideline is specified.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The transaction is started and a new transaction token is issued.</div>
<div class="line">Here, since the transaction tokens are managed at Controller level, “value” attribute of “method” annotation is not specified.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The transaction token is checked and transaction token value is updated.</div>
<div class="line">If the type attribute is omitted, the behavior remains the same as when <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck(type</span> <span class="pre">=</span> <span class="pre">TransactionTokenType.IN)</span></code> is specified.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Since it is not necessary to perform transaction token check in the request for displaying a screen which notifies the completion of the usecase, <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation is not specified.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>When BEGIN is specified in the “type” attribute of <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation, transaction token is not checked since a new TokenKey is generated.</li>
<li>When IN is specified in the “type” attribute of <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation, it is checked whether the token value specified in the request and the token value stored on the server are the same.</li>
</ul>
</div>
</div></blockquote>
</div>
<div class="section" id="how-to-use-transaction-token-check-in-view-jsp">
<span id="doublesubmit-how-to-use-transaction-token-check-jsp"></span><h4><a class="toc-backref" href="#id26">4.5.2.3.8. How to use transaction token check in View (JSP)</a><a class="headerlink" href="#how-to-use-transaction-token-check-in-view-jsp" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">When transaction token is to be checked, View (JSP) should be implemented in such a way that the issued transaction token is submitted as a request parameter.</div>
<div class="line">A method wherein a transaction is automatically embedded in hidden elements by using <code class="docutils literal"><span class="pre">&lt;form:form&gt;</span></code> tag is recommended as a method to submit it as a request parameter after carrying out <a class="reference internal" href="#setting"><span class="std std-ref">Settings for using a transaction token check</span></a>.</div>
</div>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">firstView.jsp</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;h1&gt;</span>First<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;form:form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">action=</span><span class="s">&quot;transactionTokenCheckExample&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;second&quot;</span> <span class="na">value=</span><span class="s">&quot;second&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form:form&gt;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">secondView.jsp</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;h1&gt;</span>Second<span class="nt">&lt;/h1&gt;</span>
<span class="hll"><span class="nt">&lt;form:form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">action=</span><span class="s">&quot;transactionTokenCheckExample&quot;</span><span class="nt">&gt;</span><span class="c">&lt;!-- (1) --&gt;</span>
</span>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;third&quot;</span> <span class="na">value=</span><span class="s">&quot;third&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form:form&gt;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">thirdView.jsp</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;h1&gt;</span>Third<span class="nt">&lt;/h1&gt;</span>
<span class="hll"><span class="nt">&lt;form:form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">action=</span><span class="s">&quot;transactionTokenCheckExample&quot;</span><span class="nt">&gt;</span><span class="c">&lt;!-- (1) --&gt;</span>
</span>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;fourth&quot;</span> <span class="na">value=</span><span class="s">&quot;fourth&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form:form&gt;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">fourthView.jsp</span></code></li>
</ul>
<blockquote>
<div><p>When  <code class="docutils literal"><span class="pre">&lt;form:form&gt;</span></code>tag is used</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;h1&gt;</span>Fourth<span class="nt">&lt;/h1&gt;</span>
<span class="hll"><span class="nt">&lt;form:form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">action=</span><span class="s">&quot;transactionTokenCheckExample&quot;</span><span class="nt">&gt;</span><span class="c">&lt;!-- (1) --&gt;</span>
</span>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;fifth&quot;</span> <span class="na">value=</span><span class="s">&quot;fifth&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form:form&gt;</span>
</pre></div>
</div>
</div></blockquote>
<blockquote id="fourthview">
<div><p>When  ``&lt;form&gt;`` tag of HTML is used</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;h1&gt;</span>Fourth<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">action=</span><span class="s">&quot;transactionTokenCheckExample&quot;</span><span class="nt">&gt;</span>
<span class="hll">  <span class="nt">&lt;t:transaction</span> <span class="nt">/&gt;</span><span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">  <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name=</span><span class="s">&quot;${f:h(_csrf.parameterName)}&quot;</span>
</span><span class="hll">                       <span class="na">value=</span><span class="s">&quot;${f:h(_csrf.token)}&quot;</span><span class="nt">/&gt;</span>
</span>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;fifth&quot;</span> <span class="na">value=</span><span class="s">&quot;fifth&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">fifthView.jsp</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;h1&gt;</span>Fifth<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;form:form</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span> <span class="na">action=</span><span class="s">&quot;transactionTokenCheckExample&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;first&quot;</span> <span class="na">value=</span><span class="s">&quot;first&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form:form&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When <code class="docutils literal"><span class="pre">&lt;form:form&gt;</span></code> tag is used in JSP and if BEGIN or IN is specified in “type” attribute of <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation, the Value of <code class="docutils literal"><span class="pre">name=&quot;_TRANSACTION_TOKEN&quot;</span></code> is automatically embedded as a hidden tag.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When <code class="docutils literal"><span class="pre">&lt;form&gt;</span></code> tag of HTML is used, a hidden tag same as (1) is embedded using <code class="docutils literal"><span class="pre">&lt;t:transaction</span> <span class="pre">/&gt;</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When <code class="docutils literal"><span class="pre">&lt;form&gt;</span></code> tag of HTML is used, CSRF token necessary for CSRF token check provided by Spring Security needs to be embedded as a hidden item.</div>
<div class="line">For CSRF token necessary for CSRF token check, refer to  <a class="reference internal" href="../../Security/CSRF.html#csrf-formtag-use"><span class="std std-ref">Coordination by using Spring MVC</span></a>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If <code class="docutils literal"><span class="pre">&lt;form:form&gt;</span></code> tag is used, the parameters necessary for CSRF token check are also automatically embedded. Refer to <a class="reference internal" href="../../Security/CSRF.html#csrf-htmlformtag-use"><span class="std std-ref">Coordination while using HTML form</span></a> for the parameters necessary for CSRF token check.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">&lt;t:transaction</span> <span class="pre">/&gt;</span></code> is a JSP tag library provided by the common library.
For the “t:” used in (2), refer to  <a class="reference internal" href="../../ImplementationAtEachLayer/ApplicationLayer.html#view-jsp-include-label"><span class="std std-ref">Creating common JSP for include</span></a>.</p>
</div>
</div></blockquote>
<ul class="simple">
<li>Example of Output HTML</li>
</ul>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/transaction-token-html.png"><img alt="transaction token html" src="../../_images/transaction-token-html.png" style="width: 100%;" /></a>
</div>
</div></blockquote>
<p>Following observations can be made upon verifying the output HTML.</p>
<ul>
<li><div class="first line-block">
<div class="line">For NameSpace, the value specified in “value” attribute of the class annotation is set.</div>
<div class="line">In the above example, <code class="docutils literal"><span class="pre">transactionTokenCheckExample</span></code> (underlined in orange) is the NameSpace.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">For TokenKey, the value that was issued at the start of the transaction is circulated and set.</div>
<div class="line">In the above example, <code class="docutils literal"><span class="pre">c0123252d531d7baf730cd49fe0422ef</span></code> (underlined in blue) is the TokenKey.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Value to be set for TokenValue varies depending on request.</div>
<div class="line">In the above example, <code class="docutils literal"><span class="pre">3f610684e1cb546a13b79b9df30a7523</span></code>, <code class="docutils literal"><span class="pre">da770ed81dbca9a694b232e84247a13b</span></code>,</div>
<div class="line"><code class="docutils literal"><span class="pre">bd5a2d88ec446b27c06f6d4f486d4428</span></code> (underlined in green) are TokenValues.</div>
</div>
</li>
</ul>
</div>
<div class="section" id="when-multiple-usecases-are-to-be-implemented-in-one-controller">
<h4><a class="toc-backref" href="#id27">4.5.2.3.9. When multiple usecases are to be implemented in one Controller</a><a class="headerlink" href="#when-multiple-usecases-are-to-be-implemented-in-one-controller" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">The implementation example of the transaction token check while carrying out processing of multiple usecases in one controller is given below.</div>
<div class="line">In the example given below, (2), (3), (4) are handled as screen transitions of different usecases.</div>
</div>
<ul class="simple">
<li>Controller</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;transactionTokenChecFlowkExample&quot;</span><span class="p">)</span>
<span class="hll"><span class="nd">@TransactionTokenCheck</span><span class="p">(</span><span class="s">&quot;transactionTokenChecFlowkExample&quot;</span><span class="p">)</span> <span class="c1">// (1)</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TransactionTokenCheckFlowExampleController</span> <span class="p">{</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;flowOne&quot;</span><span class="p">,</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;first&quot;</span><span class="p">,</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">flowOneFirst</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;transactionTokenChecFlowkExample/flowOneFirstView&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;flowOne&quot;</span><span class="p">,</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;second&quot;</span><span class="p">,</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
<span class="hll">    <span class="nd">@TransactionTokenCheck</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;flowOne&quot;</span><span class="p">,</span>
</span><span class="hll">                           <span class="n">type</span> <span class="o">=</span> <span class="n">TransactionTokenType</span><span class="p">.</span><span class="na">BEGIN</span><span class="p">)</span> <span class="c1">// (2)</span>
</span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">flowOneSecond</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;transactionTokenChecFlowkExample/flowOneSecondView&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;flowOne&quot;</span><span class="p">,</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;third&quot;</span><span class="p">,</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
<span class="hll">    <span class="nd">@TransactionTokenCheck</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;flowOne&quot;</span><span class="p">,</span>
</span><span class="hll">                           <span class="n">type</span> <span class="o">=</span> <span class="n">TransactionTokenType</span><span class="p">.</span><span class="na">IN</span><span class="p">)</span>   <span class="c1">// (2)</span>
</span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">flowOneThird</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;transactionTokenChecFlowkExample/flowOneThirdView&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;flowTwo&quot;</span><span class="p">,</span>
                   <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;first&quot;</span><span class="p">,</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">flowTwoFirst</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;transactionTokenChecFlowkExample/flowTwoFirstView&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;flowTwo&quot;</span><span class="p">,</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;second&quot;</span><span class="p">,</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
<span class="hll">    <span class="nd">@TransactionTokenCheck</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;flowTwo&quot;</span><span class="p">,</span>
</span><span class="hll">                           <span class="n">type</span> <span class="o">=</span> <span class="n">TransactionTokenType</span><span class="p">.</span><span class="na">BEGIN</span><span class="p">)</span> <span class="c1">// (3)</span>
</span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">flowTwoSecond</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;transactionTokenChecFlowkExample/flowTwoSecondView&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;flowTwo&quot;</span><span class="p">,</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;third&quot;</span><span class="p">,</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
<span class="hll">    <span class="nd">@TransactionTokenCheck</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;flowTwo&quot;</span><span class="p">,</span>
</span><span class="hll">                           <span class="n">type</span> <span class="o">=</span> <span class="n">TransactionTokenType</span><span class="p">.</span><span class="na">IN</span><span class="p">)</span> <span class="c1">// (3)</span>
</span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">flowTwoThird</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;transactionTokenChecFlowkExample/flowTwoThirdView&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;flowThree&quot;</span><span class="p">,</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;first&quot;</span><span class="p">,</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">flowThreeFirst</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;transactionTokenChecFlowkExample/flowThreeFirstView&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;flowThree&quot;</span><span class="p">,</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;second&quot;</span><span class="p">,</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
<span class="hll">    <span class="nd">@TransactionTokenCheck</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;flowThree&quot;</span><span class="p">,</span>
</span><span class="hll">                           <span class="n">type</span> <span class="o">=</span> <span class="n">TransactionTokenType</span><span class="p">.</span><span class="na">BEGIN</span><span class="p">)</span> <span class="c1">// (4)</span>
</span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">flowThreeSecond</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;transactionTokenChecFlowkExample/flowThreeSecondView&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;flowThree&quot;</span><span class="p">,</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;third&quot;</span><span class="p">,</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
<span class="hll">    <span class="nd">@TransactionTokenCheck</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;flowThree&quot;</span><span class="p">,</span>
</span><span class="hll">                           <span class="n">type</span> <span class="o">=</span> <span class="n">TransactionTokenType</span><span class="p">.</span><span class="na">IN</span><span class="p">)</span> <span class="c1">// (4)</span>
</span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">flowThreeThird</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;transactionTokenChecFlowkExample/flowThreeThirdView&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">NameSpace is specified in “value” attribute of “class” annotation.</div>
<div class="line">In the above example, the value same as the “value” attribute of <code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code> which is a recommended pattern of this guideline, is specified.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The transaction token is checked for processing of usecase with name <code class="docutils literal"><span class="pre">flowOne</span></code>.</div>
<div class="line">In the above example, the value same as the “value” attribute of <code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code> which is a recommended pattern of this guideline, is specified.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The transaction token is checked for processing of usecase with name <code class="docutils literal"><span class="pre">flowTwo</span></code>.</div>
<div class="line">In the above example, the value same as the “value” attribute of <code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code> which is a recommended pattern of this guideline, is specified.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The transaction token is checked for processing of usecase with name <code class="docutils literal"><span class="pre">flowThree</span></code>.</div>
<div class="line">In the above example, the value same as the “value” attribute of <code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code> which is a recommended pattern of this guideline, is specified.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Allocating a NameSpace for each usecase enables transaction token check for each usecase.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="when-a-process-which-does-not-update-screen-for-file-downloading-process-is-included-in-the-use-case">
<span id="usecase-of-transaction-token-type-check"></span><h4><a class="toc-backref" href="#id28">4.5.2.3.10. When a process which does not update screen for file downloading process is included in the use case</a><a class="headerlink" href="#when-a-process-which-does-not-update-screen-for-file-downloading-process-is-included-in-the-use-case" title="Permalink to this headline">¶</a></h4>
<p>For the use cases which include process wherein screen is not returned to the client during file downloading process,
when the TransactionTokenType is not configured appropriately, care must be taken since the transaction token error is likely to occur even during normal operations.</p>
<p>An example wherein the transaction token error occurs during a normal operation due to specification of inappropriate TransactionTokenType is shown below.</p>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/transaction-token-file-donwload-ng.png"><img alt="transaction token file download ng" src="../../_images/transaction-token-file-donwload-ng.png" style="width: 100%;" /></a>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The client sends a request.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server creates a token (token001) and retains it on the server.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server delivers the token thus created (token001) to the client.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Client sends a file downloading request including the token (token001).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server checks whether the token retained on the server (token001) and the token sent by the client (token001) are identical.</div>
<div class="line"><strong>Since the value is same, the request is determined as a legitimate request.</strong></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Since <code class="docutils literal"><span class="pre">IN</span></code> is configured in <code class="docutils literal"><span class="pre">TransactionTokenType</span></code>, server generates a token (token002) to be used in the next request and updates the value which is retained on the server.</div>
<div class="line">At this point, the token (token001) is discarded.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server returns the requested file.</div>
<div class="line"><strong>Since the updated token is not returned to the client, token on the screen (token001) and token of the server (token002) do not match at this point.</strong></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Client sends a request including a token (token001).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server checks whether the token retained on the server (token001) and the token sent by the client (token002) are identical.</div>
<div class="line"><strong>Since the value is not the same, the request is determined as an illegitimate request.</strong></div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>As shown above, when the transaction token is applied for the transition from screen wherein file downloading process is performed (screen2) to next screen (screen3),
token mismatch occurs during normal operation if <code class="docutils literal"><span class="pre">IN</span></code> is used in <code class="docutils literal"><span class="pre">TransactionTokenType</span></code> of file downloading process.
For these cases, <code class="docutils literal"><span class="pre">CHECK</span></code> is used in the <code class="docutils literal"><span class="pre">TransactionTokenType</span></code>.</p>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/transaction-token-file-donwload-ok.png"><img alt="transaction token file download ok" src="../../_images/transaction-token-file-donwload-ok.png" style="width: 100%;" /></a>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Client sends a file download request including a token (token001).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server checks whether the token retained on the server (token001) and the token sent by client (token001) are identical.</div>
<div class="line"><strong>Since the value is same, the request is determined as a legitimate request.</strong></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Since <code class="docutils literal"><span class="pre">CHECK</span></code>is configured in <code class="docutils literal"><span class="pre">TransactionTokenType</span></code>, the token retained on the server is not updated.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server sends the requested file.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Client sends a request including the token (token001).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server checks whether the token retained on the server (token001) and the token sent by client (token001) are identical.</div>
<div class="line"><strong>Since the value is same, the request is determined as a legitimate request.</strong></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server generates a token to be used in the next request (token002) and updates the value retained on the server.</div>
<div class="line">The token (token001) is discarded at this point.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Server delivers the updated token (token002) to the client.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>A method wherein <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> is not assigned to file downloading method of <code class="docutils literal"><span class="pre">Controller</span></code> can also be used as a method wherein the token on the server is not updated.
However, the method should be selected considering that when the <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> is not assigned, the token is not returned
to the client.</p>
<p class="last">For example, if a method wherein <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> is not assigned is selected when either the screen or file are likely to be returned during the process results
such as displaying an error message on the screen when a reexecutable error occurs during file downloading process,
the token of the screen when the error message is returned to the screen is lost and
the transaction token error occurs as a result during a normal operation.</p>
</div>
</div>
<div class="section" id="typical-example-of-using-transaction-token-check">
<h4><a class="toc-backref" href="#id29">4.5.2.3.11. Typical example of using transaction token check</a><a class="headerlink" href="#typical-example-of-using-transaction-token-check" title="Permalink to this headline">¶</a></h4>
<p>See the example below wherein transaction token check is applied for the usecase which carries out a simple screen transition such as “Input Screen-&gt; Confirmation Screen-&gt; Completion Screen”.</p>
<ul class="simple">
<li>Controller</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">)</span>
<span class="hll"><span class="nd">@TransactionTokenCheck</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">)</span> <span class="c1">// (1)</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserController</span> <span class="p">{</span>

    <span class="c1">// omitted</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;form&quot;</span><span class="p">)</span>
<span class="hll">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">createForm</span><span class="p">(</span><span class="n">UserCreateForm</span> <span class="n">form</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// (2)</span>
</span>      <span class="k">return</span> <span class="s">&quot;user/createForm&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span>
                  <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;confirm&quot;</span><span class="p">,</span>
                  <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
<span class="hll">    <span class="nd">@TransactionTokenCheck</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span>
</span><span class="hll">                         <span class="n">type</span> <span class="o">=</span> <span class="n">TransactionTokenType</span><span class="p">.</span><span class="na">BEGIN</span><span class="p">)</span> <span class="c1">// (3)</span>
</span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">createConfirm</span><span class="p">(</span><span class="nd">@Validated</span>
    <span class="n">UserCreateForm</span> <span class="n">form</span><span class="p">,</span> <span class="n">BindingResult</span> <span class="n">result</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// omitted</span>

        <span class="k">return</span> <span class="s">&quot;user/createConfirm&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
<span class="hll">    <span class="nd">@TransactionTokenCheck</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">)</span> <span class="c1">// (4)</span>
</span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">create</span><span class="p">(</span><span class="nd">@Validated</span>
    <span class="n">UserCreateForm</span> <span class="n">form</span><span class="p">,</span> <span class="n">BindingResult</span> <span class="n">result</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// omitted</span>

        <span class="k">return</span> <span class="s">&quot;redirect:/user/create?complete&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;complete&quot;</span><span class="p">)</span>
<span class="hll">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">createComplete</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// (5)</span>
</span>        <span class="k">return</span> <span class="s">&quot;user/createComplete&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// omitted</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A NameSpace called <code class="docutils literal"><span class="pre">user</span></code> is set as “class” annotation.</div>
<div class="line">In the above example, the value same as “value” attribute of <code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code> annotation which is a recommended pattern, is specified.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A handler method to display input screen.</div>
<div class="line"><strong>It is a screen to start a usecase; however since the process only displays data and does not involve data update, it is not necessary to start a transaction.</strong></div>
<div class="line">Therefore, <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation is not specified in the example given above.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A handler method to perform input validation and display the Confirmation screen.</div>
<div class="line">A transaction is started at this point since a button to perform update process is placed on the Confirmation screen.</div>
<div class="line">A View (JSP) is specified for the transition destination.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A handler method to perform update.</div>
<div class="line"><strong>Since this method performs update, a transaction token check is performed.</strong></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A handler method to display the Completion screen.</div>
<div class="line"><strong>Since the method only displays a Completion screen, the transaction token check is not required.</strong></div>
<div class="line">Therefore, <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation is not specified in the example given above.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It is necessary to specify the View (JSP) for the transition destination of handler method wherein <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation is defined.
If other than View (JSP) of the redirect destination is specified as transition destination, the value of TransactionToken changes in the next process always resulting in the TransactionToken error.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="exclusion-control-of-parallel-processing-while-using-a-session">
<h4><a class="toc-backref" href="#id30">4.5.2.3.12. Exclusion control of parallel processing while using a session</a><a class="headerlink" href="#exclusion-control-of-parallel-processing-while-using-a-session" title="Permalink to this headline">¶</a></h4>
<p>When a form object is stored in a session using <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation,
and if multiple screen transitions of the same processing are performed in parallel, screen operations may interfere with each other and the values displayed on the screen and the values stored in the session may no longer match.</p>
<p>Transaction token check function can be used to prevent requests from non-conforming screens as the invalid requests.</p>
<p>The maximum limit of transaction tokens that can be stored for each NameSpace is set to 1.</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">spring-mvc.xml</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;mvc:interceptor&gt;</span>
    <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&quot;/**&quot;</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
    <span class="nt">&lt;bean</span>
        <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.token.transaction.TransactionTokenInterceptor&quot;</span><span class="nt">&gt;</span>
<span class="hll">        <span class="nt">&lt;constructor-arg</span> <span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</span>    <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/mvc:interceptor&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The number of transaction tokens stored for each NameSpace is set to “1”.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When form objects etc. are stored in session using <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation, the requests from the screen displaying old data can be prevented as invalid requests
by setting number of transaction token stored for each NameSpace to “1”.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="how-to-extend">
<h2><a class="toc-backref" href="#id31">4.5.3. How to extend</a><a class="headerlink" href="#how-to-extend" title="Permalink to this headline">¶</a></h2>
<div class="section" id="how-to-change-the-maximum-limit-of-transaction-tokens">
<span id="doublesubmit-how-to-extend-change-max-count"></span><h3><a class="toc-backref" href="#id32">4.5.3.1. How to change the maximum limit of transaction tokens</a><a class="headerlink" href="#how-to-change-the-maximum-limit-of-transaction-tokens" title="Permalink to this headline">¶</a></h3>
<p>The maximum limit of transaction tokens that can be stored on 1 NameSpace can be changed by performing settings given below.</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">spring-mvc.xml</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;mvc:interceptors&gt;</span>
    <span class="nt">&lt;mvc:interceptor&gt;</span>
        <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&quot;/**&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/resources/**&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/**/*.html&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;bean</span>
            <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.token.transaction.TransactionTokenInterceptor&quot;</span> <span class="nt">/&gt;</span>
<span class="hll">        <span class="nt">&lt;constructor-arg</span> <span class="na">value=</span><span class="s">&quot;5&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</span>    <span class="nt">&lt;/mvc:interceptor&gt;</span>
<span class="nt">&lt;/mvc:interceptors&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The maximum limit of transaction tokens that can be stored in a NameSpace is specified as a value of constructor of <code class="docutils literal"><span class="pre">TransactionTokenInterceptor</span></code>.</div>
<div class="line">The default value (value that is set when the default constructor is used) is 10.</div>
<div class="line">In the above example, the default value (10) is changed to 5.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="appendix">
<h2><a class="toc-backref" href="#id33">4.5.4. Appendix</a><a class="headerlink" href="#appendix" title="Permalink to this headline">¶</a></h2>
<div class="section" id="transaction-token-check-in-case-that-the-cache-of-browser-is-disabled">
<span id="double-submit-disable-cache"></span><h3><a class="toc-backref" href="#id34">4.5.4.1. Transaction Token Check in case that the cache of browser is disabled</a><a class="headerlink" href="#transaction-token-check-in-case-that-the-cache-of-browser-is-disabled" title="Permalink to this headline">¶</a></h3>
<p>If the cache of web browser is disabled due to <code class="docutils literal"><span class="pre">Cache-Control</span></code> in HTTP response header,
the message will display which tells the cache has been expired before transaction token error
in case of the illegal operation flow in “<a class="reference internal" href="#double-submit-transactiontokencheck"><span class="std std-ref">Transaction Token Check</span></a>”</p>
<p>Concretely, the following screen will display when the browser back button is clicked (8).
This is an example of Internet Explorer 11.</p>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/page-expired.png"><img alt="../../_images/page-expired.png" src="../../_images/page-expired.png" style="width: 60%;" /></a>
</div>
</div></blockquote>
<p>There is no problem because the double submit itself is prevented.</p>
<p>In <a class="reference internal" href="../../ImplementationAtEachLayer/CreateWebApplicationProject.html"><span class="doc">blank projects</span></a> after 5.0.0.RELEASE,
it is configured so that the cache is disabled by <a class="reference internal" href="../../Security/LinkageWithBrowser.html#springsecuritylinkagewithbrowser"><span class="std std-ref">Spring Security</span></a>.</p>
<p>If showing the transaction error screen is preferred instead of the screen above,
excluding <code class="docutils literal"><span class="pre">&lt;sec:cache-control</span> <span class="pre">/&gt;</span></code> is required.
However, <code class="docutils literal"><span class="pre">&lt;sec:cache-control</span> <span class="pre">/&gt;</span></code> should be configured from the point of view of security.</p>
</div>
<div class="section" id="global-tokens">
<span id="doublesubmit-appendix-global-token"></span><h3><a class="toc-backref" href="#id35">4.5.4.2. Global Tokens</a><a class="headerlink" href="#global-tokens" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">If the “value” attribute of <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation is not specified, it is handled as global transaction token.</div>
<div class="line"><code class="docutils literal"><span class="pre">globalToken</span></code> (fixed value) is used for the NameSpace of global transaction tokens.</div>
</div>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When only a single screen transition is to be allowed as an overall application, it can be implemented by setting the maximum limit of transaction tokens that can be stored for each NameSpace to 1 and using the global token.</p>
</div>
</div></blockquote>
<p>The settings and implementation example when only a single screen transition is to be allowed as an overall application are shown below.</p>
<div class="section" id="changing-the-maximum-limit-of-transaction-tokens-that-can-be-stored-for-each-namespace">
<h4><a class="toc-backref" href="#id36">4.5.4.2.1. Changing the maximum limit of transaction tokens that can be stored for each NameSpace</a><a class="headerlink" href="#changing-the-maximum-limit-of-transaction-tokens-that-can-be-stored-for-each-namespace" title="Permalink to this headline">¶</a></h4>
<p>The maximum limit of transaction tokens that can be stored for each NameSpace is set to 1.</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">spring-mvc.xml</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;mvc:interceptor&gt;</span>
    <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&quot;/**&quot;</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
    <span class="nt">&lt;bean</span>
        <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.token.transaction.TransactionTokenInterceptor&quot;</span><span class="nt">&gt;</span>
<span class="hll">        <span class="nt">&lt;constructor-arg</span> <span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</span>    <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/mvc:interceptor&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The number of tokens stored for each NameSpace is set to “1”.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="implementation-of-controller">
<h4><a class="toc-backref" href="#id37">4.5.4.2.2. Implementation of Controller</a><a class="headerlink" href="#implementation-of-controller" title="Permalink to this headline">¶</a></h4>
<p>The value is not specified in “value” attribute of <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation, in order to make it the NameSpace for global tokens.</p>
<ul class="simple">
<li>Controller</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;globalTokenCheckExample&quot;</span><span class="p">)</span>
<span class="hll"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GlobalTokenCheckExampleController</span> <span class="p">{</span> <span class="c1">// (1)</span>
</span>
    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="s">&quot;first&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">first</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;globalTokenCheckExample/firstView&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="s">&quot;second&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
<span class="hll">    <span class="nd">@TransactionTokenCheck</span><span class="p">(</span><span class="n">type</span> <span class="o">=</span> <span class="n">TransactionTokenType</span><span class="p">.</span><span class="na">BEGIN</span><span class="p">)</span> <span class="c1">// (2)</span>
</span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">second</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;globalTokenCheckExample/secondView&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="s">&quot;third&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
<span class="hll">    <span class="nd">@TransactionTokenCheck</span> <span class="c1">// (2)</span>
</span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">third</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;globalTokenCheckExample/thirdView&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="s">&quot;fourth&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
<span class="hll">    <span class="nd">@TransactionTokenCheck</span> <span class="c1">// (2)</span>
</span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">fourth</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;globalTokenCheckExample/fourthView&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="s">&quot;fifth&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">fifth</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;globalTokenCheckExample/fifthView&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation is not specified as the class annotation.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The “value” attribute of <code class="docutils literal"><span class="pre">&#64;TransactionTokenCheck</span></code> annotation to be specified as “method” annotation is not specified.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>Example of Output HTML</li>
</ul>
<blockquote>
<div><div class="line-block">
<div class="line">JSP used is same as the one created in <a class="reference internal" href="#doublesubmit-how-to-use-transaction-token-check-jsp"><span class="std std-ref">How to use transaction token check in View (JSP)</span></a> .</div>
<div class="line">Other details are same except change in action from <code class="docutils literal"><span class="pre">transactionTokenCheckExample</span></code>to <code class="docutils literal"><span class="pre">globalTokenCheckExample</span></code>.</div>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../../_images/transaction-token-global-html.png"><img alt="transaction token global html" src="../../_images/transaction-token-global-html.png" style="width: 100%;" /></a>
</div>
</div></blockquote>
<p>Following observations can be made upon verifying the output HTML.</p>
<ul>
<li><div class="first line-block">
<div class="line">For NameSpace, a fixed value called <code class="docutils literal"><span class="pre">globalToken</span></code> is set.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">For TokenKey, the value that was issued while starting the transaction is circulated and set.</div>
<div class="line">In the above example, <code class="docutils literal"><span class="pre">9d937be4adc2f5dd2032292d153f1133</span></code> (underlined in blue) is the TokenKey.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Value to be set for TokenValue varies depending on request.</div>
<div class="line">In the above example, <code class="docutils literal"><span class="pre">9204d7705ce7a17f16ca6cec24cfd88b</span></code>, <code class="docutils literal"><span class="pre">69c809fefcad541dbd00bd1983af2148</span></code>,</div>
<div class="line"><code class="docutils literal"><span class="pre">6b83f33b365f1270ee1c1b263f046719</span></code> (underlined in green) are TokenValues.</div>
</div>
</li>
</ul>
<p>The behavior when the maximum limit of transaction tokens for each NameSpace is set to 1 and global token is used, is explained below.</p>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/transaction-token-globaltoken.png"><img alt="transaction token globaltoken" src="../../_images/transaction-token-globaltoken.png" style="width: 90%;" /></a>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In window 1 process, TransactionTokenType.BEGIN is performed and global token is generated.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In window 2 process, the token is updated by TransactionTokenType.BEGIN.</div>
<div class="line">Although internally the data is reshuffled rather than getting updated, it gives the impression that the token has been updated since one transaction token can be stored on the server.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Token value is checked in TransactionTokenType.IN of window 1 process.</div>
<div class="line"><strong>Transaction token generated in process 1 is submitted as request parameter; however since the specified token does not exist on the server, a transaction token error occurs.</strong></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Token value is checked in TransactionTokenType.IN of window 2 process.</div>
<div class="line">The transaction token generated in process 2 is submitted as request parameter and it is checked whether the value matches with the token value stored on the server.</div>
<div class="line">If the value matches, the process is continued.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Similar to (4) .</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Similar to (4) .</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When a screen is to be displayed using redirect, hidden tag for transaction token does not exist.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The transaction token existing on the server is automatically deleted when a new global token is generated.</p>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="quick-reference">
<h3><a class="toc-backref" href="#id38">4.5.4.3. Quick Reference</a><a class="headerlink" href="#quick-reference" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">The table below illustrates an example of a business application for managing Account and Customer. It shows the required settings for transaction tokens and business limitations.</div>
<div class="line">The usecases assumed in this business application are Create, Update, Delete relating to Account and Customer.</div>
<div class="line">By using the table below as reference, the maximum limit of tokens and NameSpace settings should be performed as per the system requirements.</div>
</div>
<blockquote>
<div><table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="20%" />
<col width="15%" />
<col width="20%" />
<col width="15%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Number</th>
<th class="head">Number of tokens stored for each NameSpace</th>
<th class="head">NameSpace value specified in class</th>
<th class="head">NameSpace value specified in method</th>
<th class="head">Example of generated token</th>
<th class="head">Business limitations</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">10 (Default)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">account</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Not specified</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">account~key~value</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Number of concurrent executions of all Account usecases (create/update/delete) is restricted to 10.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">10 (Default)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">account</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">create</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">account/create~key~value</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Number of concurrent executions of “create” operation of Account usecase is restricted to 10.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">10 (Default)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">account</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">update</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">account/update~key~value</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Number of concurrent executions of “update” operation of Account usecase is restricted to 10.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">10 (Default)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">account</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">delete</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">account/delete~key~value</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Number of concurrent executions of “delete” operation of Account usecase is restricted to 10. (By specifying  (2), (3) and (4), the number of concurrent executions of all Account usecases should be 30. Since this setting value is too high for most applications, a value smaller than default value 10 can also be specified.)</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">10 (Default)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Unspecified</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">create</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">create~key~value</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The same Namespace called “create” is created in the application and the number of concurrent executions is restricted to 10. When the Account and Customer business processes are independent, and among them when “create” is specified in the NameSpace of TransactionToken using “create” method, the total number of concurrent executions is restricted to 10.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">10 (Default)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Not specified</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">update</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">update~key~value</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Same as (5)</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">10 (Default)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Not specified</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">delete</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">delete~key~value</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Same as (5)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">10 (Default)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Not specified</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Not specified</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">globalToken~key~value</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The total number of concurrent executions of all Account and Customer usecases is restricted to 10.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1 (Custom Setting in spring-mvc.xml)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">account</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Not specified</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">account~key~value</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The number of concurrent executions of all Account usecases should be restricted to 1. Execution of only a single business process is possible for Account create/update/delete. This is valid when screen transition using only 1 screen is assumed.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1 (Custom Setting in spring-mvc.xml)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">account</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">create</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">account/create~key~value</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The number of concurrent executions of “create” operation of Account usecases should be restricted to 1. It is not possible to simultaneously execute Account “create” by opening 2 screens.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(11)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1 (Custom Setting in spring-mvc.xml)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">account</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">update</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">account/update~key~value</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Same as (10)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(12)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1 (Custom Setting in spring-mvc.xml)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">account</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">delete</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">account/delete~key~value</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Same as (10)</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(13)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1 (Custom Setting in spring-mvc.xml)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Not specified</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">create</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">create~key~value”</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A same NameSpace called “create” is created in the application and the number of concurrent executions should be restricted to 1. When the Account and Customer business processes are independent and when “create” is specified in NameSpace of TransactionToken using “create” method, “create” for Account and Customer cannot be performed concurrently.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(14)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1 (Custom Setting in spring-mvc.xml)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Not specified</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">update</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">update~key~value</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Same as (13)</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(15)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1 (Custom Setting in spring-mvc.xml)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Not specified</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">delete</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">delete~key~value</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Same as (13)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(16)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1 (Custom Setting in spring-mvc.xml)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Not specified</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Not specified</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">globalToken~key~value</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The business processes that can be concurrently executed in the application are restricted to 1. This should be used in projects where only 1 operation is performed in 1 session.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="MessageManagement.html" title="4.6. Message Management"
             >next</a> |</li>
        <li class="right" >
          <a href="Pagination.html" title="4.4. Pagination"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.4.1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >4. Web Application Development Features</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
      © Copyright 2013-2018, NTT DATA Corporation. © Copyright 2013-2018, NTT Corporation.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.3.Theme is <a href="http://github.com/vimalkvn/solar-theme">Solar</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>