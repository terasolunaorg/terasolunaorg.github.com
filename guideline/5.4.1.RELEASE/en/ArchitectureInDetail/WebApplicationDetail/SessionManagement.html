<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>4.3. Session Management &#8212; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.4.1.RELEASE documentation</title>
    <link rel="stylesheet" href="../../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '5.4.1.RELEASE',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="4.4. Pagination" href="Pagination.html" />
    <link rel="prev" title="4.2. Exception Handling" href="ExceptionHandling.html" /><script src="../../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../../_static/solarized-dark.css" rel="stylesheet">
<link href="../../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Pagination.html" title="4.4. Pagination"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ExceptionHandling.html" title="4.2. Exception Handling"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.4.1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">4. Web Application Development Features</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>

  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4.3. Session Management</a><ul>
<li><a class="reference internal" href="#overview">4.3.1. Overview</a><ul>
<li><a class="reference internal" href="#session-lifecycle">4.3.1.1. Session lifecycle</a><ul>
<li><a class="reference internal" href="#generating-a-session">4.3.1.1.1. Generating a session</a></li>
<li><a class="reference internal" href="#storing-attributes-in-a-session">4.3.1.1.2. Storing attributes in a session</a></li>
<li><a class="reference internal" href="#deleting-attributes-from-a-session">4.3.1.1.3. Deleting attributes from a session</a></li>
<li><a class="reference internal" href="#discarding-a-session">4.3.1.1.4. Discarding a session</a></li>
<li><a class="reference internal" href="#detecting-a-request-after-session-timeout">4.3.1.1.5. Detecting a request after session timeout</a></li>
</ul>
</li>
<li><a class="reference internal" href="#about-using-a-session">4.3.1.2. About using a session</a></li>
<li><a class="reference internal" href="#advantages-and-disadvantages-of-using-session">4.3.1.3. Advantages and disadvantages of using session</a><ul>
<li><a class="reference internal" href="#advantages-and-disadvantages-of-not-using-session">4.3.1.3.1. Advantages and disadvantages of not using session</a></li>
</ul>
</li>
<li><a class="reference internal" href="#about-the-data-to-be-stored-in-session">4.3.1.4. About the data to be stored in session</a><ul>
<li><a class="reference internal" href="#serializable-objects">4.3.1.4.1. Serializable objects</a></li>
<li><a class="reference internal" href="#amount-of-data-to-be-stored-in-session">4.3.1.4.2. Amount of data to be stored in session</a></li>
</ul>
</li>
<li><a class="reference internal" href="#points-to-be-considered-in-case-of-application-server-clustering">4.3.1.5. Points to be considered in case of application server clustering</a></li>
<li><a class="reference internal" href="#about-storage-location-of-session">4.3.1.6. About storage location of session</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use">4.3.2. How to use</a><ul>
<li><a class="reference internal" href="#using-sessionattributes-annotation">4.3.2.1. Using <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation</a><ul>
<li><a class="reference internal" href="#specifying-the-object-to-be-stored-in-session">4.3.2.1.1. Specifying the object to be stored in session</a></li>
<li><a class="reference internal" href="#adding-object-to-session">4.3.2.1.2. Adding object to session</a></li>
<li><a class="reference internal" href="#fetching-the-object-stored-in-session">4.3.2.1.3. Fetching the object stored in session</a></li>
<li><a class="reference internal" href="#deleting-the-object-stored-in-session">4.3.2.1.4. Deleting the object stored in session</a></li>
<li><a class="reference internal" href="#process-implementation-using-sessionattributes">4.3.2.1.5. Process implementation using &#64;SessionAttributes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-session-scoped-bean-of-spring-framework">4.3.2.2. Using session-scoped bean of Spring Framework</a><ul>
<li><a class="reference internal" href="#bean-definition-of-session-scope">4.3.2.2.1. Bean definition of session scope</a></li>
<li><a class="reference internal" href="#using-session-scoped-bean">4.3.2.2.2. Using session-scoped bean</a></li>
<li><a class="reference internal" href="#deleting-objects-stored-in-session">4.3.2.2.3. Deleting objects stored in session</a></li>
<li><a class="reference internal" href="#process-implementation-using-session-scoped-bean">4.3.2.2.4. Process implementation using session-scoped bean</a></li>
</ul>
</li>
<li><a class="reference internal" href="#debug-log-output-of-session-operations">4.3.2.3. Debug log output of session operations</a></li>
<li><a class="reference internal" href="#using-the-jsp-implicit-object-sessionscope">4.3.2.4. Using the JSP implicit object <code class="docutils literal"><span class="pre">sessionScope</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-extend">4.3.3. How to extend</a><ul>
<li><a class="reference internal" href="#synchronizing-requests-in-same-session">4.3.3.1. Synchronizing requests in same session</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendix">4.3.4. Appendix</a><ul>
<li><a class="reference internal" href="#example-of-screen-transition-implementation-using-sessionattributes-in-wizard-format">4.3.4.1. Example of screen transition implementation using <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> in wizard format</a></li>
<li><a class="reference internal" href="#example-of-screen-transition-across-multiple-controllers-using-session-scoped-bean">4.3.4.2. Example of screen transition across multiple Controllers using session-scoped bean.</a></li>
</ul>
</li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="ExceptionHandling.html"
                        title="previous chapter">4.2. Exception Handling</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Pagination.html"
                        title="next chapter">4.4. Pagination</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/ArchitectureInDetail/WebApplicationDetail/SessionManagement.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="session-management">
<h1>4.3. Session Management<a class="headerlink" href="#session-management" title="Permalink to this headline">Â¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id5">Overview</a><ul>
<li><a class="reference internal" href="#session-lifecycle" id="id6">Session lifecycle</a><ul>
<li><a class="reference internal" href="#generating-a-session" id="id7">Generating a session</a></li>
<li><a class="reference internal" href="#storing-attributes-in-a-session" id="id8">Storing attributes in a session</a></li>
<li><a class="reference internal" href="#deleting-attributes-from-a-session" id="id9">Deleting attributes from a session</a></li>
<li><a class="reference internal" href="#discarding-a-session" id="id10">Discarding a session</a></li>
<li><a class="reference internal" href="#detecting-a-request-after-session-timeout" id="id11">Detecting a request after session timeout</a></li>
</ul>
</li>
<li><a class="reference internal" href="#about-using-a-session" id="id12">About using a session</a></li>
<li><a class="reference internal" href="#advantages-and-disadvantages-of-using-session" id="id13">Advantages and disadvantages of using session</a><ul>
<li><a class="reference internal" href="#advantages-and-disadvantages-of-not-using-session" id="id14">Advantages and disadvantages of not using session</a></li>
</ul>
</li>
<li><a class="reference internal" href="#about-the-data-to-be-stored-in-session" id="id15">About the data to be stored in session</a><ul>
<li><a class="reference internal" href="#serializable-objects" id="id16">Serializable objects</a></li>
<li><a class="reference internal" href="#amount-of-data-to-be-stored-in-session" id="id17">Amount of data to be stored in session</a></li>
</ul>
</li>
<li><a class="reference internal" href="#points-to-be-considered-in-case-of-application-server-clustering" id="id18">Points to be considered in case of application server clustering</a></li>
<li><a class="reference internal" href="#about-storage-location-of-session" id="id19">About storage location of session</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use" id="id20">How to use</a><ul>
<li><a class="reference internal" href="#using-sessionattributes-annotation" id="id21">Using <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation</a><ul>
<li><a class="reference internal" href="#specifying-the-object-to-be-stored-in-session" id="id22">Specifying the object to be stored in session</a></li>
<li><a class="reference internal" href="#adding-object-to-session" id="id23">Adding object to session</a></li>
<li><a class="reference internal" href="#fetching-the-object-stored-in-session" id="id24">Fetching the object stored in session</a></li>
<li><a class="reference internal" href="#deleting-the-object-stored-in-session" id="id25">Deleting the object stored in session</a></li>
<li><a class="reference internal" href="#process-implementation-using-sessionattributes" id="id26">Process implementation using &#64;SessionAttributes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-session-scoped-bean-of-spring-framework" id="id27">Using session-scoped bean of Spring Framework</a><ul>
<li><a class="reference internal" href="#bean-definition-of-session-scope" id="id28">Bean definition of session scope</a></li>
<li><a class="reference internal" href="#using-session-scoped-bean" id="id29">Using session-scoped bean</a></li>
<li><a class="reference internal" href="#deleting-objects-stored-in-session" id="id30">Deleting objects stored in session</a></li>
<li><a class="reference internal" href="#process-implementation-using-session-scoped-bean" id="id31">Process implementation using session-scoped bean</a></li>
</ul>
</li>
<li><a class="reference internal" href="#debug-log-output-of-session-operations" id="id32">Debug log output of session operations</a></li>
<li><a class="reference internal" href="#using-the-jsp-implicit-object-sessionscope" id="id33">Using the JSP implicit object <code class="docutils literal"><span class="pre">sessionScope</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-extend" id="id34">How to extend</a><ul>
<li><a class="reference internal" href="#synchronizing-requests-in-same-session" id="id35">Synchronizing requests in same session</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendix" id="id36">Appendix</a><ul>
<li><a class="reference internal" href="#example-of-screen-transition-implementation-using-sessionattributes-in-wizard-format" id="id37">Example of screen transition implementation using <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> in wizard format</a></li>
<li><a class="reference internal" href="#example-of-screen-transition-across-multiple-controllers-using-session-scoped-bean" id="id38">Example of screen transition across multiple Controllers using session-scoped bean.</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id5">4.3.1. Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">Â¶</a></h2>
<p>This chapter explains Session Management in a Web application.</p>
<div class="line-block">
<div class="line">In Web applications, data is exchanged between the client and the server, using HTTP.</div>
<div class="line">HTTP itself does not have a feature to physically maintain a session. Instead, it provides a mechanism wherein, a logical session is maintained by linking a session identifier value (session ID), between the client and the server.</div>
<div class="line">Cookie or request parameter is used to link the session ID between client and server.</div>
<div class="line">The figure below illustrates establishment of logical session.</div>
</div>
<blockquote>
<div><div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="../../_images/session-management_overview_cooperation.png"><img alt="Establishment of logical session" src="../../_images/session-management_overview_cooperation.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - Establishment of logical session</strong></span></p>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Web browser (Client) accesses the Web application (Server) when session is not established.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Web application creates <code class="docutils literal"><span class="pre">HttpSession</span></code> object for storing the session with Web browser. Session ID is issued at the time of <code class="docutils literal"><span class="pre">HttpSession</span></code> object creation.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Web application stores the data sent by the Web browser in <code class="docutils literal"><span class="pre">HttpSession</span></code> object.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Web application sends a response to the Web browser. By setting âJSESSIONID = Issued session IDâ in the âSet-Cookieâ header of response, session ID is linked to the Web Browser.</div>
<div class="line">Linked session ID is stored in Cookie.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Web browser links the session ID to Web application by setting âJSESSIONID = Issued session IDâ in the âCookieâ header of request.</div>
<div class="line">Application server on which the Web application is deployed, fetches <code class="docutils literal"><span class="pre">HttpSession</span></code> object corresponding to the session ID linked from the Web browser and maps it with the request.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Web application fetches the data stored in the request mentioned in (1), from the <code class="docutils literal"><span class="pre">HttpSession</span></code> object associated with the request.</div>
<div class="line"><strong>Same data can be accessed across requests.</strong></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Web application returns the response to Web browser.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>About the parameter name to link session ID</strong></p>
<p class="last">In JavaEE Serlvet specifications, the default parameter name to link a session ID is JSESSIONID.</p>
</div>
</div></blockquote>
<div class="section" id="session-lifecycle">
<h3><a class="toc-backref" href="#id6">4.3.1.1. Session lifecycle</a><a class="headerlink" href="#session-lifecycle" title="Permalink to this headline">Â¶</a></h3>
<div class="line-block">
<div class="line">Instead of implementing as Controller process, session lifecycle control (create, discard, timeout detection)</div>
<div class="line">is implemented by using the processes provided by framework or common library.</div>
</div>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">Session</span></code> mentioned in the following explanation refers to <code class="docutils literal"><span class="pre">javax.servlet.http.HttpSession</span></code> object provided by Servlet API.
<code class="docutils literal"><span class="pre">HttpSession</span></code> object is the Java object representing the logical session described above.</p>
</div>
</div></blockquote>
<div class="section" id="generating-a-session">
<h4><a class="toc-backref" href="#id7">4.3.1.1.1. Generating a session</a><a class="headerlink" href="#generating-a-session" title="Permalink to this headline">Â¶</a></h4>
<p>When Web application is created by the method recommended in this guideline, session can be generated by any one of the following processes.</p>
<blockquote>
<div><table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">Authentication/authorization process provided by Spring Security.</div>
<div class="line">Timing and status of session generation can be specified by Spring Security settings.</div>
<div class="line">For details on session management in Spring Security, refer to <a class="reference internal" href="../../Security/SessionManagement.html#authentication-spring-security-how-to-use-sessionmanagement"><span class="std std-ref">How to use</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">CSRF token check process provided by Spring Security</div>
<div class="line">When a session is already established, new session is not generated.</div>
<div class="line">For details on CSRF token check, refer to <a class="reference internal" href="../../Security/CSRF.html"><span class="doc">CSRF Countermeasures</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">Transaction token check process provided by common library.</div>
<div class="line">When a session is already established, new session is not generated.</div>
<div class="line">For details on Transaction token check, refer to <a class="reference internal" href="DoubleSubmitProtection.html"><span class="doc">Double Submit Protection</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">Process for passing a model (form object, domain object etc.) to redirect destination request, by using addFlashAttribute method of <code class="docutils literal"><span class="pre">RedirectAttributes</span></code> interface.</div>
<div class="line">When a session is already established, new session is not generated.</div>
<div class="line">For details on <code class="docutils literal"><span class="pre">RedirectAttributes</span></code> and Flash scope, refer to <a class="reference internal" href="../../ImplementationAtEachLayer/ApplicationLayer.html#controller-method-argument-redirectattributes-label"><span class="std std-ref">Passing data while redirecting request</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">Process for storing a model (form object, domain object etc.) in a session, using <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation.</div>
<div class="line">The specified model (form object, domain object etc.) is stored in session. When a session is already established, new session is not generated.</div>
<div class="line">For details on how to use <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation, refer to <a class="reference internal" href="#session-management-how-to-use-sessionattributes"><span class="std std-ref">Using &#64;SessionAttributes annotation</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">Process that uses session-scoped bean in Spring Framework.</div>
<div class="line">When a session is already established, new session is not generated.</div>
<div class="line">For details on how to use session-scoped bean, refer to <a class="reference internal" href="#session-management-how-to-use-sessionscope"><span class="std std-ref">Using session-scoped bean of Spring Framework</span></a>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In Sr. Nos. 4, 5, 6 mentioned above, whether the session is used or not is specified by Controller implementation whereas, session generation timing is controlled by the framework.
In other words, <code class="docutils literal"><span class="pre">HttpSession</span></code> API need not be used directly as Controller process.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="storing-attributes-in-a-session">
<h4><a class="toc-backref" href="#id8">4.3.1.1.2. Storing attributes in a session</a><a class="headerlink" href="#storing-attributes-in-a-session" title="Permalink to this headline">Â¶</a></h4>
<p>When Web application is created by the methods recommended in this guideline, attributes (objects) are stored in session by any one of the following processes.</p>
<blockquote>
<div><table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">Authentication process provided by Spring Security.</div>
<div class="line">Authenticated user information is stored in the session.</div>
<div class="line">For details on Spring Security authentication process, refer to <a class="reference internal" href="../../Security/Authentication.html"><span class="doc">Authentication</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">CSRF token check process provided by Spring Security.</div>
<div class="line">Issued token value is stored in session.</div>
<div class="line">For details on CSRF token check, refer to <a class="reference internal" href="../../Security/CSRF.html"><span class="doc">CSRF Countermeasures</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">Transaction token check process provided by common library.</div>
<div class="line">Issued token value is stored in session.</div>
<div class="line">For details on Transaction token check, refer to <a class="reference internal" href="DoubleSubmitProtection.html"><span class="doc">Double Submit Protection</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">Process for passing a model (form object, domain object etc.) to redirect destination request, by using addFlashAttribute method of <code class="docutils literal"><span class="pre">RedirectAttributes</span></code> interface.</div>
<div class="line">Object specified in the addFlashAttribute method of <code class="docutils literal"><span class="pre">RedirectAttributes</span></code> interface, is stored in an area called Flash scope in the session.</div>
<div class="line">For details on <code class="docutils literal"><span class="pre">RedirectAttributes</span></code> and Flash scope, refer to <a class="reference internal" href="../../ImplementationAtEachLayer/ApplicationLayer.html#controller-method-argument-redirectattributes-label"><span class="std std-ref">Passing data while redirecting request</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">Process for storing a model (form object, domain object etc.) in session, using <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation.</div>
<div class="line">The specified model (form object, domain object etc.) is stored in session.</div>
<div class="line">For the details on how to use <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation, refer to, <a class="reference internal" href="#session-management-how-to-use-sessionattributes"><span class="std std-ref">Using &#64;SessionAttributes annotation</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">Process that uses session-scoped bean in Spring Framework.</div>
<div class="line">Session-scoped bean is stored in session.</div>
<div class="line">For details on how to use session-scoped bean, refer to <a class="reference internal" href="#session-management-how-to-use-sessionscope"><span class="std std-ref">Using session-scoped bean of Spring Framework</span></a>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Timing to store the object in session is controlled by the framework. Hence, setAttribute method of <code class="docutils literal"><span class="pre">HttpSession</span></code> object is not called as Controller process.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="deleting-attributes-from-a-session">
<h4><a class="toc-backref" href="#id9">4.3.1.1.3. Deleting attributes from a session</a><a class="headerlink" href="#deleting-attributes-from-a-session" title="Permalink to this headline">Â¶</a></h4>
<p>When Web application is created by the methods recommended in this guideline, attributes (objects) are deleted from a session by any one of the following processes.</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">Logout process provided by Spring Security.</div>
<div class="line">Authenticated user information is deleted from the session.</div>
<div class="line">For details on Spring Security logout process, refer to <a class="reference internal" href="../../Security/Authentication.html"><span class="doc">Authentication</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">Transaction token check process provided by common library.</div>
<div class="line">When the value of issued token exceeds the upper limit allocated to NameSpace, token value that is not in use, is deleted from the session.</div>
<div class="line">For details on Transaction token check, refer to <a class="reference internal" href="DoubleSubmitProtection.html"><span class="doc">Double Submit Protection</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">Redirect process after the object is stored in Flash scope.</div>
<div class="line">Object specified in the addFlashAttribute method of <code class="docutils literal"><span class="pre">RedirectAttributes</span></code> interface, is deleted from the Flash scope area of session.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">Framework process, after the setComplete method of <code class="docutils literal"><span class="pre">SessionStatus</span></code> object is called as Controller process.</div>
<div class="line">Object specified by <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation is deleted from the session.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Timing to delete the object is controlled by the framework. Hence, removeAttribute method of <code class="docutils literal"><span class="pre">HttpSession</span></code> object is not called as Controller process.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="discarding-a-session">
<h4><a class="toc-backref" href="#id10">4.3.1.1.4. Discarding a session</a><a class="headerlink" href="#discarding-a-session" title="Permalink to this headline">Â¶</a></h4>
<p>When Web application is created by the methods recommended in this guideline, session is discarded using any one of the following processes.</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">Logout process provided by Spring Security.</div>
<div class="line">For details on Spring Security logout process, refer to <a class="reference internal" href="../../Security/Authentication.html"><span class="doc">Authentication</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">Process for detecting session timeout of application server.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The scenario in which a session is discarded explicitly is illustrated below.</p>
<blockquote>
<div><div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="../../_images/session-management_overview_invalidate1.png"><img alt="Invalidate session by processing of Web Application" src="../../_images/session-management_overview_invalidate1.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - Invalidate session by processing of Web Application</strong></span></p>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Access the process that discards session from Web browser.</div>
<div class="line">When using Spring Security, the logout process provided by it is used to discard the session.</div>
<div class="line">For details on logout process of Spring Security, refer to <a class="reference internal" href="../../Security/Authentication.html"><span class="doc">Authentication</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Web application discards <code class="docutils literal"><span class="pre">HttpSession</span></code> object corresponding to the session ID linked from Web browser.</div>
<div class="line">At this point, <code class="docutils literal"><span class="pre">HttpSession</span></code> object with the ID, <code class="docutils literal"><span class="pre">SESSION01</span></code>, disappears from server side.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When the discarded session is accessed from Web browser using the respective session ID, a new session is generated, as <code class="docutils literal"><span class="pre">HttpSession</span></code> object corresponding to the requested session ID does not exist.</div>
<div class="line">In the above example, a session with ID  <code class="docutils literal"><span class="pre">SESSION02</span></code> is being generated.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The scenario in which a session is automatically discarded due to timeout is illustrated below.</p>
<blockquote>
<div><div class="figure align-center" id="id3">
<a class="reference internal image-reference" href="../../_images/session-management_overview_invalidate2.png"><img alt="Invalidate session by timeout Application Server" src="../../_images/session-management_overview_invalidate2.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - Invalidate session by Application Server</strong></span></p>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When an established session is not accessed for a particular period, application server detects session timeout.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Application server discards the session for which session timeout is detected.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When the session is accessed from Web browser after session timeout occurs, session timeout error is returned to Web browser since <code class="docutils literal"><span class="pre">HttpSession</span></code> object corresponding to the session ID requested from the Web browser, does not exist.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Designing session timeout</strong></p>
<p class="last">When data needs to be stored in the session, the design should include âsession timeoutâ. It is recommended to set the timeout as short as possible, especially when the data to be stored is large.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Default session timeout period</strong></p>
<p>Default session timeout period differs depending on application server.</p>
<ul class="last simple">
<li>Tomcat: 1800  seconds (30 minutes)</li>
<li>WebLogic: 3600 seconds (60 minutes)</li>
<li>WebSphere: 1800 seconds (30 minutes)</li>
<li>JBoss: 1800 seconds (30 minutes)</li>
</ul>
</div>
</div></blockquote>
</div>
<div class="section" id="detecting-a-request-after-session-timeout">
<h4><a class="toc-backref" href="#id11">4.3.1.1.5. Detecting a request after session timeout</a><a class="headerlink" href="#detecting-a-request-after-session-timeout" title="Permalink to this headline">Â¶</a></h4>
<p>When Web application is created by the method recommended in this guideline, a request subsequent to session timeout is detected by any one of the following processes.</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">Session timeout check process provided by Spring Security.</div>
<div class="line">Session timeout check is performed as per default settings in Spring Security.</div>
<div class="line">Therefore, to store data in session, settings to validate the timeout check process of a Spring Security session, are required.</div>
<div class="line">For details on timeout check process in Spring Security, refer to <a class="reference internal" href="../../Security/SessionManagement.html#authentication-spring-security-how-to-use-sessionmanagement"><span class="std std-ref">How to use</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">When not using Spring Security, timeout check process needs to be implemented in Servlet Filter or <code class="docutils literal"><span class="pre">HandlerInterceptor</span></code>of Spring MVC.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The scenario in which session timeout is detected using session check process provided by Spring Security, is illustrated below.</p>
<blockquote>
<div><div class="figure align-center" id="id4">
<a class="reference internal image-reference" href="../../_images/session-management_overview_sessiontimeout.png"><img alt="Detected a request of after session timeout by Spring Security" src="../../_images/session-management_overview_sessiontimeout.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - Detected a request after session timeout by Spring Security</strong></span></p>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When an established session is not accessed for a particular period, application server detects session timeout and discards the session.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Web browser accesses the session after the session timeout occurs.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Spring Security throws session timeout error as, the <code class="docutils literal"><span class="pre">HttpSession</span></code> object corresponding to the session ID linked from client, does not exist.</div>
<div class="line">In default Spring Security implementation, response is sent to the request for redirecting to URL to display the error screen.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Necessity of session timeout check</strong></p>
<p class="last">For the processes having precondition, âData should be stored in sessionâ, session timeout check should always be performed.
If this check is not performed, unexpected system errors and operations may occur, as data required by the process cannot be fetched.</p>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="about-using-a-session">
<h3><a class="toc-backref" href="#id12">4.3.1.2. About using a session</a><a class="headerlink" href="#about-using-a-session" title="Permalink to this headline">Â¶</a></h3>
<div class="line-block">
<div class="line">When data needs to be shared across multiple screens (multiple requests), it can be shared easily by storing this data in session.</div>
<div class="line">However, as against the advantage that the data can be easily shared, storing the data in session also results in application constraints etc. Hence, whether or not to use session should be decided by considering application and system requirements.</div>
</div>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Rather than simply storing the data in session, this guideline initially recommends to consider a policy wherein session is not used. Further, if session is used, it recommends storing only the absolutely required data in it.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Storing the data applicable to following conditions has proved better.</p>
<ul class="last">
<li><div class="first line-block">
<div class="line">Data that does not provide linkage between use cases, but for such data, the status when it is moved and returned from a different use case needs to be stored.</div>
<div class="line">For example, search condition of a List screen corresponds to this pattern.</div>
<div class="line">When the search condition of a List screen returns from another use case (example: âChange searched dataâ use case), many a times its status before moving to other use case needs to be stored as a functional requirement.</div>
<div class="line">Search conditions can also be shared in hidden state but this causes excessive dependency between use cases and implementing the application is expected to be complex.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Data for which linkage between use cases is necessary.</div>
<div class="line">For example, data stored in the shopping site cart corresponds to this pattern.</div>
<div class="line">Data stored in the shopping site cart involves use cases of â Adding the product to the cartâ, â Displaying the cartâ, âChanging the status of the cartâ and â Purchasing the products in the cartâ. It requires the data linkage of all these use cases.</div>
<div class="line">However, when scalability needs to be considered, sometimes it is better to store the data in database instead of session.</div>
</div>
</li>
</ul>
</div>
</div></blockquote>
</div>
<div class="section" id="advantages-and-disadvantages-of-using-session">
<h3><a class="toc-backref" href="#id13">4.3.1.3. Advantages and disadvantages of using session</a><a class="headerlink" href="#advantages-and-disadvantages-of-using-session" title="Permalink to this headline">Â¶</a></h3>
<p>The advantages and disadvantages of using session are as follows:</p>
<ul>
<li><p class="first"><strong>Advantages</strong></p>
<ul>
<li><div class="first line-block">
<div class="line">Data can be shared across multiple screens (multiple requests) easily when a single process is composed in multiple screens such as a Wizard Screens.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">By storing the fetched data in session, number of executions of data acquisition can be reduced.</div>
</div>
</li>
</ul>
</li>
<li><p class="first"><strong>Disadvantages</strong></p>
<ul>
<li><div class="first line-block">
<div class="line">When the screen with same process is opened in multiple browsers or various tabs, data consistency cannot be maintained, as mutual operations interfere with the data stored in session.</div>
<div class="line">In order to maintain data consistency, control is required so that screen with the same process cannot be opened in multiple browsers or tabs.</div>
<div class="line">This control can be implemented by using Transaction token check provided by common library, however it results in reduced usability.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Session data is usually stored in application server memory; hence memory usage also increases with increase in data stored in the session.</div>
<div class="line">If unnecessary data that is no longer used in a process is left as it is, it gets excluded from garbage collection process, leading to memory exhaustion. Such data needs to be deleted from session at a stage when it is rendered unnecessary.</div>
<div class="line">The timing to delete unnecessary data from session needs to be designed separately.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Storing process data in session may lower scalability of application server.</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Any one of the following methods is required to scale out the application server.</p>
<ol class="arabic">
<li><div class="first line-block">
<div class="line">Performing session replication and sharing the session information with all application servers.</div>
<div class="line">When performing session replication, the load on replication process increases in proportion to the data stored in session and number of application servers for replication.</div>
<div class="line">Therefore, issues owing to scale out such as, possible degradation in response time etc. need to be considered.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Distributing all requests of the same session to the same application server, using load balancer.</div>
<div class="line">When requests are distributed to the same application server and if the server is down, the process cannot be continued by another application server.</div>
<div class="line">Therefore, it needs to be noted that, this method may not be feasible in applications that demand high availability (service level).</div>
</div>
</li>
</ol>
<p class="last">Scale out method should be determined upon considering each of these points.</p>
</div>
</li>
</ul>
</li>
</ul>
<div class="section" id="advantages-and-disadvantages-of-not-using-session">
<h4><a class="toc-backref" href="#id14">4.3.1.3.1. Advantages and disadvantages of not using session</a><a class="headerlink" href="#advantages-and-disadvantages-of-not-using-session" title="Permalink to this headline">Â¶</a></h4>
<div class="line-block">
<div class="line">In order to avoid the disadvantages faced while using session, all the data required for server processing can be implemented by linking as request parameters.</div>
<div class="line">The advantages and disadvantages of not using session are as follows:</div>
</div>
<ul>
<li><p class="first"><strong>Advantages</strong></p>
<ul>
<li><div class="first line-block">
<div class="line">As data is not stored at server side, even if multiple browsers and tabs are used, their operations do not interfere with each other. Therefore, multiple screens of the same process can be started without impairing the usability.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">As data is not stored at server side, continuous utilization of memory can be controlled.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Number of factors that lower the scalability of application server are reduced.</div>
</div>
</li>
</ul>
</li>
<li><p class="first"><strong>Disadvantages</strong></p>
<ul>
<li><div class="first line-block">
<div class="line">Data required for server processing needs to be sent as request parameter. As a result, even the items that are not displayed on the screen need to be specified as hidden items.</div>
<div class="line">Thus, JSP implementation code increases.</div>
<div class="line">This can be minimized by creating JSP tag library.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Amount of data flowing to the network increases, as all the data required for server processing needs to be sent through requests.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Data required for screen display needs to be fetched each time. Hence, number of executions of data acquisition increases.</div>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="about-the-data-to-be-stored-in-session">
<h3><a class="toc-backref" href="#id15">4.3.1.4. About the data to be stored in session</a><a class="headerlink" href="#about-the-data-to-be-stored-in-session" title="Permalink to this headline">Â¶</a></h3>
<p>Following points need to be considered for the data to be stored in session.</p>
<ul class="simple">
<li>It should be serializable object (object implementing <code class="docutils literal"><span class="pre">java.io.Serializable</span></code>).</li>
<li>It should not be a large object that can cause memory exhaustion.</li>
</ul>
<div class="section" id="serializable-objects">
<h4><a class="toc-backref" href="#id16">4.3.1.4.1. Serializable objects</a><a class="headerlink" href="#serializable-objects" title="Permalink to this headline">Â¶</a></h4>
<div class="line-block">
<div class="line">Data to be stored in the session may be input or output to disk or network under specific conditions.</div>
<div class="line">Therefore the objects need to be serializable.</div>
</div>
<p>Cases where data is input/output to disk are as follows:</p>
<ul>
<li><div class="first line-block">
<div class="line">When application server is stopped while a session is active, the session and the data stored in it are saved to the disk.</div>
<div class="line">The saved session and data stored in it, are restored with the start of application server.</div>
<div class="line">Support status for this data restoring operation differs depending on application server.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">If session storage area is about to overflow or if the session is not accessed for a particular period of time since the last access, there is a possibility of session swap-out.</div>
<div class="line">The swapped-out session is swapped-in when the session is accessed again.</div>
<div class="line">Conditions etc. for swap-out differ depending on application server.</div>
</div>
</li>
</ul>
<p>Cases where data is input/output to network are as follows:</p>
<ul>
<li><div class="first line-block">
<div class="line">To perform replication of session in another application server, data stored in the session is sent to that application server via network.</div>
</div>
</li>
</ul>
</div>
<div class="section" id="amount-of-data-to-be-stored-in-session">
<h4><a class="toc-backref" href="#id17">4.3.1.4.2. Amount of data to be stored in session</a><a class="headerlink" href="#amount-of-data-to-be-stored-in-session" title="Permalink to this headline">Â¶</a></h4>
<p><strong>It is recommended that the data to be stored in session should be as compact as possible.</strong></p>
<p>When large amount of data is stored in session, it fatally degrades the performance. Hence, it is recommended to design such that, large amount of data will not be stored in session.</p>
<p>The main causes of performance degradation are as follows:</p>
<ul>
<li><div class="first line-block">
<div class="line">When storing large amount of data in session, application server settings need to be enabled such that session is easily swapped-out so as to prevent memory exhaustion.</div>
<div class="line">Swap-out is a âHeavyâ process. Hence, it occurring very frequently may affect the overall application performance.</div>
<div class="line">Support status for swap-out operation or setting method, differs depending on application server.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">When carrying out session replication, serialization and deserialization of an object are performed.</div>
<div class="line">Serialization and deserialization of an object with large capacity being âheavyâ processes, may affect performance, such as response time.</div>
</div>
</li>
</ul>
<p>To make the session data compact, storing the data applicable to the following conditions in request scope instead of session scope, should be considered.</p>
<ul>
<li><div class="first line-block">
<div class="line">Read-only data that cannot be edited by screen operations.</div>
<div class="line">If latest data is fetched at a time when it is required, and if the fetched data is displayed in View (JSP) by storing it in request scope, it need not be stored in session.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Data that can be edited by screen operations. It can be shared only in the screen operations of a use case.</div>
<div class="line">If data can be shared in all screen transitions as hidden HTML fields, it need not be stored in session.</div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="points-to-be-considered-in-case-of-application-server-clustering">
<h3><a class="toc-backref" href="#id18">4.3.1.5. Points to be considered in case of application server clustering</a><a class="headerlink" href="#points-to-be-considered-in-case-of-application-server-clustering" title="Permalink to this headline">Â¶</a></h3>
<div class="line-block">
<div class="line">A normal system is rarely composed of a single application server. Considering requirements such as availability, efficiency etc. it consists of multiple servers.</div>
<div class="line">Therefore, when storing the data in session, any one of the following mechanisms needs to be applied in accordance with system requirements.</div>
</div>
<ol class="arabic">
<li><div class="first line-block">
<div class="line">For systems that require high availability (service level), if one AP server is down, it should be possible to continue the processing on another AP server.</div>
<div class="line">To be able to continue processing on another AP server when one AP server is down, session information needs to be shared amongst all AP servers. Hence, session replication needs to be carried out by application servers that are configured as a cluster.</div>
<div class="line">As an alternate method, session information can be shared by setting the session storage location to cache server such as Oracle Coherence or database.</div>
<div class="line">It would be better to consider setting the session storage location to a cache server like Oracle Coherence or database if, number of AP servers, amount of data stored in session and number of sessions that can be pasted simultaneously are in large quantity.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">For systems that do not require high availability (service level), processing need not be continued on another server if the AP server is down.</div>
<div class="line">Therefore, session information need not be shared amongst all AP servers. Thus, it is alright if all the requests in a same session are distributed to the same AP server, using load balancer functionality.</div>
</div>
</li>
</ol>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>When the Web application is created by methods recommended in this guideline, either of the above mechanisms needs to be applied to store the following data in session.</p>
<blockquote class="last">
<div><ul class="simple">
<li>User information authenticated by the Spring Security authentication process.</li>
<li>Token values issued by Spring Security CSRF token check.</li>
<li>Token values issued by the transaction token check provided by common library.</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="about-storage-location-of-session">
<h3><a class="toc-backref" href="#id19">4.3.1.6. About storage location of session</a><a class="headerlink" href="#about-storage-location-of-session" title="Permalink to this headline">Â¶</a></h3>
<div class="line-block">
<div class="line">The session storage location can also be set in the In-memory data grids such as Key-Value Store or Oracle Coherence, other than AP server memory.</div>
<div class="line">There is room for consideration when scalability is required.</div>
<div class="line">The implementation method to change the storage location of session differs according to the AP server and the storage location itself. Therefore, it is omitted in this guideline.</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="how-to-use">
<h2><a class="toc-backref" href="#id20">4.3.2. How to use</a><a class="headerlink" href="#how-to-use" title="Permalink to this headline">Â¶</a></h2>
<p>This guideline recommends using any one of the following methods to store data in session.</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#session-management-how-to-use-sessionattributes"><span class="std std-ref">Using &#64;SessionAttributes annotation</span></a></li>
<li><a class="reference internal" href="#session-management-how-to-use-sessionscope"><span class="std std-ref">Using session-scoped bean of Spring Framework</span></a></li>
</ol>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><code class="docutils literal"><span class="pre">HttpSession</span></code> API can be called directly by specifying the <code class="docutils literal"><span class="pre">HttpSession</span></code> object as an argument of Controller handler method. However,
<strong>as a rule, this guideline strongly recommends not to use the HttpSession API directly.</strong></p>
<p class="last"><code class="docutils literal"><span class="pre">HttpSession</span></code> API may be used directly only for those processes that cannot be implemented otherwise. However,
in most of the business processes, it is not necessary to use the HttpSession API directly. Therefore, set such that <code class="docutils literal"><span class="pre">HttpSession</span></code> object is not specified as an argument of the Controller handler method.</p>
</div>
<div class="section" id="using-sessionattributes-annotation">
<span id="session-management-how-to-use-sessionattributes"></span><h3><a class="toc-backref" href="#id21">4.3.2.1. Using <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation</a><a class="headerlink" href="#using-sessionattributes-annotation" title="Permalink to this headline">Â¶</a></h3>
<p><code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation is used for sharing data during screen transitions in Controller.</p>
<div class="line-block">
<div class="line">However, cases where each of the screens namely, the input screen, confirmation screen and completion screen consists of one page, it is better to share the data using âhiddenâ HTML field rather than using session.</div>
<div class="line">Cases where the input screen consists of multiple pages or when complicated screen transitions are involved, adopting the method, to store form object in session using <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation, should be considered.</div>
<div class="line">Application designing and implementation can be simplified by storing the form object in session.</div>
</div>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/session-management_overview_sessionattributes.png"><img alt="" src="../../_images/session-management_overview_sessionattributes.png" style="width: 80%;" /></a>
</div>
</div></blockquote>
<div class="section" id="specifying-the-object-to-be-stored-in-session">
<h4><a class="toc-backref" href="#id22">4.3.2.1.1. Specifying the object to be stored in session</a><a class="headerlink" href="#specifying-the-object-to-be-stored-in-session" title="Permalink to this headline">Â¶</a></h4>
<p>Specify the object to be stored in session by specifying <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation in âclassâ.</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;wizard&quot;</span><span class="o">)</span>
<span class="nd">@SessionAttributes</span><span class="o">(</span><span class="n">types</span> <span class="o">=</span> <span class="o">{</span> <span class="n">WizardForm</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Entity</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span> <span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WizardController</span> <span class="o">{</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In âtypesâ attribute of <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation, specify the object type to be stored in session.</div>
<div class="line">Amongst the objects added to <code class="docutils literal"><span class="pre">Model</span></code> object using <code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code> annotation or addAttribute method of <code class="docutils literal"><span class="pre">Model</span></code>, the objects matching with the type specified in âtypesâ attribute, are stored in session.</div>
<div class="line">In the above example, objects of <code class="docutils literal"><span class="pre">WizardForm</span></code> class and <code class="docutils literal"><span class="pre">Entity</span></code> class are stored in session.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Management unit for life cycle</strong></p>
<p>Life cycles of the objects stored in session using <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation, are managed at Controller level.</p>
<p class="last">When setComplete method of <code class="docutils literal"><span class="pre">SessionStatus</span></code> object is called, all the objects specified with `` &#64;SessionAttributes `` annotation are deleted from session.
Therefore, to store the objects having different life cycles in session, it is necessary to divide the Controller.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Points to be considered when using &#64;SessionAttributes annotation</strong></p>
<p>As described above, life cycle is managed at Controller level. However, when the object with the same attribute name in multiple Controllers, is stored in session using <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation,
its life cycle is managed across Controllers.</p>
<p class="last">In case of a process wherein, screen can be operated simultaneously by opening another window or tab, it can cause an error as the same object is being accessed.
Therefore, to use the class of the same form object in multiple Controllers, first different values (attribute names) should be specified in âvalueâ attribute of <code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code>annotation. Then the same values should be specified in âvalueâ attribute of <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">The object to be stored in session can also be specified in attribute name.</div>
<div class="line">How to specify is explained below.</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;wizard&quot;</span><span class="o">)</span>
<span class="nd">@SessionAttributes</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="o">{</span> <span class="s">&quot;wizardCreateForm&quot;</span> <span class="o">})</span> <span class="c1">// (2)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WizardController</span> <span class="o">{</span>

    <span class="c1">// ...</span>

    <span class="nd">@ModelAttribute</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;wizardCreateForm&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">WizardForm</span> <span class="nf">setUpWizardForm</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">WizardForm</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the attribute name of the object to be stored in session, in âvalueâ attribute of <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation.</div>
<div class="line">Among the objects added to <code class="docutils literal"><span class="pre">Model</span></code> object using <code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code> annotation or addAttribute method of <code class="docutils literal"><span class="pre">Model</span></code>, the objects matching with the attribute name specified in <code class="docutils literal"><span class="pre">value</span></code> attribute, are stored in session.</div>
<div class="line">In the above example, objects with attribute name <code class="docutils literal"><span class="pre">wizardCreateForm</span></code> are stored in session.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="adding-object-to-session">
<h4><a class="toc-backref" href="#id23">4.3.2.1.2. Adding object to session</a><a class="headerlink" href="#adding-object-to-session" title="Permalink to this headline">Â¶</a></h4>
<p>Object can be added to session using the following two methods.</p>
<ul class="simple">
<li>Method with <code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code> annotation is used to return the object to be added to the session.</li>
<li>addAttribute method of <code class="docutils literal"><span class="pre">Model</span></code> object is used to add the object stored in session.</li>
</ul>
<p>Object added to <code class="docutils literal"><span class="pre">Model</span></code> object is stored in session as per the type of <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation and value of âvalueâ attribute.
Hence, there is no need to consider the session when implementation is carried out using handler method of Controller.</p>
<div class="line-block">
<div class="line">How to return the object to be stored in session using the method with  <code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code> annotation, is explained below.</div>
<div class="line">It is recommended to create object using this method when storing form object in session.</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@ModelAttribute</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;wizardForm&quot;</span><span class="o">)</span> <span class="c1">// (1)</span>
<span class="kd">public</span> <span class="n">WizardForm</span> <span class="nf">setUpWizardForm</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">WizardForm</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In âvalueâ attribute, specify the attribute name to be stored in <code class="docutils literal"><span class="pre">Model</span></code> object.</div>
<div class="line">In the above example, the object returned is stored in session, with attribute name <code class="docutils literal"><span class="pre">wizardForm</span></code>.</div>
<div class="line">When âvalueâ attribute is specified, method with <code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code> annotation is no longer called by the subsequent requests after the object is stored in session. Thus, it has an advantage wherein, unnecessary objects are not generated.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Operation in case âvalueâ attribute of &#64;ModelAttribute annotation is omitted</strong></p>
<p>When âvalueâ attribute is omitted, method with <code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code> annotation is called by all requests in order to generate default attribute name.
Therefore, it has a disadvantage of unnecessary objects being generated. Hence, <strong>This method should not be used when storing objects in session.</strong></p>
<blockquote class="last">
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@ModelAttribute</span> <span class="c1">// (1)</span>
<span class="kd">public</span> <span class="n">WizardForm</span> <span class="nf">setUpWizardForm</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">WizardForm</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use the method with <code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code> annotation to generate and return the object to be added in session.</div>
<div class="line">In the above example, object returned with attribute name <code class="docutils literal"><span class="pre">wizardForm</span></code> annotation, is stored in session.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">How to add object to session using addAttribute method of <code class="docutils literal"><span class="pre">Model</span></code> object is explained below.</div>
<div class="line">When storing the Domain object to session, this method is used to add the object.</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;update/{id}&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;form1&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">updateForm1</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">,</span> <span class="n">WizardForm</span> <span class="n">form</span><span class="o">,</span>
        <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Entity</span> <span class="n">loadedEntity</span> <span class="o">=</span> <span class="n">entityService</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">loadedEntity</span><span class="o">);</span> <span class="c1">// (3)</span>
    <span class="n">beanMapper</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">loadedEntity</span><span class="o">,</span> <span class="n">form</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">&quot;wizard/form1&quot;</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add the object to be stored in session using addAttribute method of <code class="docutils literal"><span class="pre">Model</span></code> object.</div>
<div class="line">In the above example, the object fetched from domain layer with the attribute name <code class="docutils literal"><span class="pre">entity</span></code> is stored in session.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="fetching-the-object-stored-in-session">
<h4><a class="toc-backref" href="#id24">4.3.2.1.3. Fetching the object stored in session</a><a class="headerlink" href="#fetching-the-object-stored-in-session" title="Permalink to this headline">Â¶</a></h4>
<div class="line-block">
<div class="line">The object stored in session can be received as an argument of Controller handler method.</div>
<div class="line">There is no need to consider the session in Controller handler method, as the object stored session gets stored in <code class="docutils literal"><span class="pre">Model</span></code> object as per the attribute value of <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation.</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;save&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">save</span><span class="o">(</span><span class="nd">@Validated</span><span class="o">({</span> <span class="n">Wizard1</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Wizard2</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
        <span class="n">Wizard3</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span> <span class="n">WizardForm</span> <span class="n">form</span><span class="o">,</span>   <span class="c1">// (1)</span>
        <span class="n">BindingResult</span> <span class="n">result</span><span class="o">,</span>
        <span class="n">Entity</span> <span class="n">entity</span><span class="o">,</span>                      <span class="c1">// (2)</span>
        <span class="n">RedirectAttributes</span> <span class="n">redirectAttributes</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
    <span class="k">return</span> <span class="s">&quot;redirect:/wizard/save?complete&quot;</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch the object stored in <code class="docutils literal"><span class="pre">Model</span></code> object.</div>
<div class="line">In the above example, object stored in session scope with attribute name <code class="docutils literal"><span class="pre">wizardForm</span></code> is passed to argument form.</div>
<div class="line">For details on <code class="docutils literal"><span class="pre">Wizard1.class</span></code> , <code class="docutils literal"><span class="pre">Wizard2.class</span></code> , <code class="docutils literal"><span class="pre">Wizard3.class</span></code> specified by <code class="docutils literal"><span class="pre">&#64;Validated</span></code> annotation, refer to <a class="reference internal" href="#session-management-appendix-sessionattribute"><span class="std std-ref">Example of screen transition implementation using &#64;SessionAttributes in wizard format</span></a> of Appendix.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In the above example, object stored in session scope with attribute name <code class="docutils literal"><span class="pre">entity</span></code>, is passed to argument âentityâ.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>How to prevent binding of request parameters when receiving object stored in session scope</strong></p>
<p>When an object stored in the session scope is received as an argument of the handler method, there is a possibility that the request parameter is bound to the argument.</p>
<p>In order to prevent the request parameter from being bound, it can be realized by getting the object stored in the session scope from the <code class="docutils literal"><span class="pre">Model</span></code>object in the handler method without receiving it from the argument of the handler method,
but it is not type-safe because it is necessary to specify the attribute name of the object to be acquired as a character string.</p>
<p>On the other hand, in Spring Framework 4.3, the <code class="docutils literal"><span class="pre">binding</span></code>attribute is added to the <code class="docutils literal"><span class="pre">ModelAttribute</span></code>annotation, so that it becomes possible to specify whether or not to bind request parameters as arguments.
By attaching the <code class="docutils literal"><span class="pre">&#64;</span> <span class="pre">ModelAttribute</span></code>annotation as an argument and specifying <code class="docutils literal"><span class="pre">false</span></code>as the <code class="docutils literal"><span class="pre">binding</span></code>attribute,
it is possible to prevent binding of request parameters and objects stored in the scope can be acquired.</p>
<p>In the example below, an object stored in the session scope with an attribute name <code class="docutils literal"><span class="pre">entity</span></code>is acquired by preventing binding of request parameters.</p>
<blockquote class="last">
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;save&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">save</span><span class="o">(</span><span class="nd">@Validated</span><span class="o">({</span> <span class="n">Wizard1</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Wizard2</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
        <span class="n">Wizard3</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span> <span class="n">WizardForm</span> <span class="n">form</span><span class="o">,</span>
        <span class="n">BindingResult</span> <span class="n">result</span><span class="o">,</span>
        <span class="nd">@ModelAttribute</span><span class="o">(</span><span class="n">binding</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span> <span class="n">Entity</span> <span class="n">entity</span><span class="o">,</span>
        <span class="n">RedirectAttributes</span> <span class="n">redirectAttributes</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
    <span class="k">return</span> <span class="s">&quot;redirect:/wizard/save?complete&quot;</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div></blockquote>
<p>When the object to be passed to the argument of Controller handler method does not exist in <code class="docutils literal"><span class="pre">Model</span></code> object, the operation changes depending on whether <code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code> annotation is specified or not.</p>
<ul class="simple">
<li>When <code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code> annotation is not specified, a new object is created and passed as argument.
The created object is stored in <code class="docutils literal"><span class="pre">Model</span></code> object and subsequently in session as well.</li>
</ul>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Redirect operations</strong></p>
<p class="last">Created object is not stored in session if it is redirected to a transition destination.
Therefore, when referring to the created object in redirect process, it is necessary to store the object in Flash scope using addFlashAttribute method of <code class="docutils literal"><span class="pre">RedirectAttributes</span></code>.</p>
</div>
</div></blockquote>
<ul class="simple">
<li>When <code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code> annotation is specified, <code class="docutils literal"><span class="pre">org.springframework.web.HttpSessionRequiredException</span></code> occurs.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;save&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">save</span><span class="o">(</span><span class="nd">@Validated</span><span class="o">({</span> <span class="n">Wizard1</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Wizard2</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
        <span class="n">Wizard3</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span> <span class="n">WizardForm</span> <span class="n">form</span><span class="o">,</span> <span class="c1">// (3)</span>
        <span class="n">BindingResult</span> <span class="n">result</span><span class="o">,</span>
        <span class="nd">@ModelAttribute</span> <span class="n">Entity</span> <span class="n">entity</span><span class="o">,</span> <span class="c1">// (4)</span>
        <span class="n">RedirectAttributes</span> <span class="n">redirectAttributes</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
    <span class="k">return</span> <span class="s">&quot;redirect:/wizard/save?complete&quot;</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Input validation is performed by setting specific verification groups (<code class="docutils literal"><span class="pre">Wizard1.class</span></code>, <code class="docutils literal"><span class="pre">Wizard2.class</span></code>, <code class="docutils literal"><span class="pre">Wizard3.class</span></code>) using  <code class="docutils literal"><span class="pre">&#64;Validated</span></code> annotation.</div>
<div class="line">For details on input validation, refer to <a class="reference internal" href="Validation.html"><span class="doc">Input Validation</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When <code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code> annotation is specified in argument and when the target object that does not exist in session is called, <code class="docutils literal"><span class="pre">HttpSessionRequiredException</span></code> occurs.</div>
<div class="line"><code class="docutils literal"><span class="pre">HttpSessionRequiredException</span></code> occurs due to client operations such as browser back, directly accessing specified URL etc. Therefore, the exception needs to be handled as client error.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Following are the settings to handle <code class="docutils literal"><span class="pre">HttpSessionRequiredException</span></code> as client error.</p>
<ul class="simple">
<li>spring-mvc.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.exception.SystemExceptionResolver&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionCodeResolver&quot;</span> <span class="na">ref=</span><span class="s">&quot;exceptionCodeResolver&quot;</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionMappings&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;map&gt;</span>
            <span class="c">&lt;!-- ... --&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;HttpSessionRequiredException &quot;</span>
                   <span class="na">value=</span><span class="s">&quot;common/error/operationError&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (5) --&gt;</span>
        <span class="nt">&lt;/map&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;statusCodes&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;map&gt;</span>
            <span class="c">&lt;!-- ... --&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;common/error/operationError&quot;</span> <span class="na">value=</span><span class="s">&quot;400&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (6) --&gt;</span>
        <span class="nt">&lt;/map&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add the exception handling definition of <code class="docutils literal"><span class="pre">HttpSessionRequiredException</span></code> to <code class="docutils literal"><span class="pre">exceptionMappings</span></code> of <code class="docutils literal"><span class="pre">SystemExceptionResolver</span></code> provided by common library.</div>
<div class="line">In the above example, <code class="docutils literal"><span class="pre">common/error/operationError</span></code> is specified as a View name of transition destination at the time of exception.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In <code class="docutils literal"><span class="pre">statusCodes</span></code> of <code class="docutils literal"><span class="pre">SystemExceptionResolver</span></code>, specify the HTTP response code that is generated when <code class="docutils literal"><span class="pre">HttpSessionRequiredException</span></code> occurs.</div>
<div class="line">In the above example, Bad Request (<code class="docutils literal"><span class="pre">400</span></code>) is specified as the HTTP response code at the time of exception.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>applicationContext.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;exceptionCodeResolver&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.exception.SimpleMappingExceptionCodeResolver&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- Setting and Customization by project. --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionMappings&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;map&gt;</span>
            <span class="c">&lt;!-- ... --&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;HttpSessionRequiredException&quot;</span> <span class="na">value=</span><span class="s">&quot;w.xx.0003&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (7) --&gt;</span>
        <span class="nt">&lt;/map&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultExceptionCode&quot;</span> <span class="na">value=</span><span class="s">&quot;e.xx.0001&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (8) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add the exception handling definition of <code class="docutils literal"><span class="pre">HttpSessionRequiredException</span></code> to <code class="docutils literal"><span class="pre">exceptionMappings</span></code> of <code class="docutils literal"><span class="pre">SimpleMappingExceptionCodeResolver</span></code> provided by common library.</div>
<div class="line">In the above example, <code class="docutils literal"><span class="pre">w.xx.0003</span></code> is specified as the exception code at the time of exception.</div>
<div class="line">When this setting is not added, default exception code is output to log.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Default exception code at the time of exception.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="deleting-the-object-stored-in-session">
<h4><a class="toc-backref" href="#id25">4.3.2.1.4. Deleting the object stored in session</a><a class="headerlink" href="#deleting-the-object-stored-in-session" title="Permalink to this headline">Â¶</a></h4>
<div class="line-block">
<div class="line">To delete the object stored in session using <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code>, call setComplete method of <code class="docutils literal"><span class="pre">org.springframework.web.bind.support.SessionStatus</span></code> from the handler method of Controller.</div>
<div class="line">On calling setComplete method of <code class="docutils literal"><span class="pre">SessionStatus</span></code> object, the object specified in attribute value of <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation, is deleted from session.</div>
</div>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Time when the object is deleted from session</strong></p>
<p>By calling setComplete method of <code class="docutils literal"><span class="pre">SessionStatus</span></code> object, the object specified in attribute value of <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation is deleted from session.
However, the actual time when the object is deleted is different than when setComplete method is called.</p>
<p class="last">setComplete method of <code class="docutils literal"><span class="pre">SessionStatus</span></code> object changes only the internal flag, whereas, the actual deletion of object is carried out by the framework, after the handler method of Controller is completed.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Referring object from View (JSP)</strong></p>
<p class="last">Object is deleted from session by calling the setComplete method of <code class="docutils literal"><span class="pre">SessionStatus</span></code> object. However, it can be referred from View (JSP) as the same object remains in <code class="docutils literal"><span class="pre">Model</span></code> object.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The objects stored in session need to be deleted from the following 3 locations.</p>
<ul>
<li><div class="first line-block">
<div class="line">Request to display completion screen. <strong>(Mandatory)</strong></div>
<div class="line">Delete unnecessary objects, since the objects stored in session are not accessed once completion screen is displayed.</div>
</div>
</li>
</ul>
<blockquote>
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Reason for deletion</strong></p>
<p class="last">The objects stored in session are outside the scope of garbage collection process. As a result, if unnecessary objects are not deleted, it leads to memory exhaustion.
Moreover, storing unnecessary objects in session results in session swap-out which is a heavy process and may affect the overall application performance.</p>
</div>
</div></blockquote>
<ul>
<li><div class="first line-block">
<div class="line">Request to stop the consecutive screen operations. <strong>(Mandatory)</strong></div>
<div class="line">Events such as âGo Back to Menuâ or âCancelâ etc. to stop the consecutive screen operations, do not access the objects stored in session. Therefore, unnecessary objects should be deleted from session.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Request for initial display of input screen. (Optional)</div>
</div>
</li>
</ul>
<blockquote>
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Reason for deletion</strong></p>
<p class="last">When the browser or tab is closed during screen operations, information entered during input, remains in the form object stored in session. As a result, this information is displayed on screen if it is not deleted at the time of initial display.
However, in cases where it is alright to display this information on screen, it is not mandatory to delete the information using request for initial display.</p>
</div>
</div></blockquote>
<p>Example given below illustrates implementation of object deletion by using a request to display completion screen.</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// (1)</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;save&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">save</span><span class="o">(</span><span class="nd">@ModelAttribute</span> <span class="nd">@Validated</span><span class="o">({</span> <span class="n">Wizard1</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
        <span class="n">Wizard2</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Wizard3</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span> <span class="n">WizardForm</span> <span class="n">form</span><span class="o">,</span>
        <span class="n">BindingResult</span> <span class="n">result</span><span class="o">,</span> <span class="n">Entity</span> <span class="n">entity</span><span class="o">,</span>
        <span class="n">RedirectAttributes</span> <span class="n">redirectAttributes</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
    <span class="k">return</span> <span class="s">&quot;redirect:/wizard/save?complete&quot;</span><span class="o">;</span> <span class="c1">// (2)</span>
<span class="o">}</span>

<span class="c1">// (3)</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;save&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;complete&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">saveComplete</span><span class="o">(</span><span class="n">SessionStatus</span> <span class="n">sessionStatus</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">sessionStatus</span><span class="o">.</span><span class="na">setComplete</span><span class="o">();</span> <span class="c1">// (4)</span>
    <span class="k">return</span> <span class="s">&quot;wizard/complete&quot;</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method to perform update process.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Redirect to request (3), in order to display completion screen.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method to display completion screen.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Call setComplete method of <code class="docutils literal"><span class="pre">SessionStatus</span></code> object and delete the object from session.</div>
<div class="line">Display process for View (JSP) is not affected directly as the same object remains in <code class="docutils literal"><span class="pre">Model</span></code> object.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Example given below illustrates implementation of object deletion by using a request to stop consecutive operations.</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// (1)</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;save&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;cancel&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">saveCancel</span><span class="o">(</span><span class="n">SessionStatus</span> <span class="n">sessionStatus</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">sessionStatus</span><span class="o">.</span><span class="na">setComplete</span><span class="o">();</span> <span class="c1">// (2)</span>
    <span class="k">return</span> <span class="s">&quot;redirect:/wizard/menu&quot;</span><span class="o">;</span> <span class="c1">// (3)</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method to stop the consecutive screen operations.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Call setComplete method of <code class="docutils literal"><span class="pre">SessionStatus</span></code> object and delete the object from session.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In the above example, user is redirected to Menu Screen.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Example given below illustrates implementation of object deletion by using a request for initial display of input screen.</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// (1)</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">initializeCreateWizardForm</span><span class="o">(</span><span class="n">SessionStatus</span> <span class="n">sessionStatus</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">sessionStatus</span><span class="o">.</span><span class="na">setComplete</span><span class="o">();</span>              <span class="c1">// (2)</span>
    <span class="k">return</span> <span class="s">&quot;redirect:/wizard/create?form1&quot;</span><span class="o">;</span>   <span class="c1">// (3)</span>
<span class="o">}</span>

<span class="c1">// (4)</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;form1&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">createForm1</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;wizard/form1&quot;</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method for initial display of input screen.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Call setComplete method of <code class="docutils literal"><span class="pre">SessionStatus</span></code> object.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Redirect to request (4), that displays input screen.</div>
<div class="line">Object is deleted from session by calling the setComplete method of <code class="docutils literal"><span class="pre">SessionStatus</span></code> object.</div>
<div class="line">However, as the same object remains in <code class="docutils literal"><span class="pre">Model</span></code> object,</div>
<div class="line">if View (JSP) is called directly, the information being entered is displayed.</div>
<div class="line">Therefore, <strong>It should be redirected to the request for displaying input screen after deleting from session.</strong> </div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method to display input screen.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="process-implementation-using-sessionattributes">
<h4><a class="toc-backref" href="#id26">4.3.2.1.5. Process implementation using &#64;SessionAttributes</a><a class="headerlink" href="#process-implementation-using-sessionattributes" title="Permalink to this headline">Â¶</a></h4>
<p>For specific implementation, refer to <a class="reference internal" href="#session-management-appendix-sessionattribute"><span class="std std-ref">Example of screen transition implementation using &#64;SessionAttributes in wizard format</span></a> of Appendix.</p>
</div>
</div>
<div class="section" id="using-session-scoped-bean-of-spring-framework">
<span id="session-management-how-to-use-sessionscope"></span><h3><a class="toc-backref" href="#id27">4.3.2.2. Using session-scoped bean of Spring Framework</a><a class="headerlink" href="#using-session-scoped-bean-of-spring-framework" title="Permalink to this headline">Â¶</a></h3>
<div class="line-block">
<div class="line">It is recommended to use the session-scoped bean of Spring Framework in order to</div>
<div class="line">share the data in screen transition across multiple Controllers.</div>
</div>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/session-management_overview_sessionscope.png"><img alt="" src="../../_images/session-management_overview_sessionscope.png" style="width: 90%;" /></a>
</div>
</div></blockquote>
<div class="section" id="bean-definition-of-session-scope">
<h4><a class="toc-backref" href="#id28">4.3.2.2.1. Bean definition of session scope</a><a class="headerlink" href="#bean-definition-of-session-scope" title="Permalink to this headline">Â¶</a></h4>
<p>Define session-scoped bean of Spring Framework.</p>
<p>There are 2 methods to define the session-scoped bean.</p>
<ul class="simple">
<li>Define bean using component-scan.</li>
<li>Define bean in Bean definition file (XML).</li>
</ul>
<p>How to use component-scan is shown below.</p>
<ul class="simple">
<li>Class</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Component</span>
<span class="nd">@Scope</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;session&quot;</span><span class="o">,</span> <span class="n">proxyMode</span> <span class="o">=</span> <span class="n">ScopedProxyMode</span><span class="o">.</span><span class="na">TARGET_CLASS</span><span class="o">)</span> <span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SessionCart</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Cart</span> <span class="n">cart</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">Cart</span> <span class="nf">getCart</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">cart</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">cart</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cart</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">cart</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCart</span><span class="o">(</span><span class="n">Cart</span> <span class="n">cart</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">cart</span> <span class="o">=</span> <span class="n">cart</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clearCart</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// (2)</span>
        <span class="n">cart</span><span class="o">.</span><span class="na">clearCart</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set Bean scope to <code class="docutils literal"><span class="pre">session</span></code>. Also, it be enabled the scoped-proxy by specifying a <code class="docutils literal"><span class="pre">ScopedProxyMode.TARGET_CLASS</span></code> in <code class="docutils literal"><span class="pre">proxyMode</span></code> attribute.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create a method to clear the cart content (delete products from the cart) while order has been finished.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>To define Entity class to be handled using JPA as session scope ban, it is recommended to provide a wrapper class instead of defining it directly as session-scoped bean.</p>
<p>If Entity class to be handled using JPA is defined as session-scoped bean, it cannot be handled directly using the API of JPA (throws error if handled directly).
Therefore, a process to convert it to Entity object that can be handled in JPA is required.</p>
<p class="last">In the above example, JPA Entity class called <code class="docutils literal"><span class="pre">Cart</span></code> is wrapped in a wrapper class called  <code class="docutils literal"><span class="pre">SessionCart</span></code> and set as session-scoped bean.
With this, the process to convert it to Entity object that can be handled in JPA is no longer required; hence the process to be performed in Controller becomes simple.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Reason for enabling scoped-proxy</strong></p>
<p class="last">scoped-proxy needs to be enabled to inject session-scoped bean in singleton scope Controller.</p>
</div>
</div></blockquote>
<ul class="simple">
<li>spring-mvc.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&quot;xxx.yyy.zzz.app&quot;</span> <span class="nt">/&gt;</span> // (2)
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Scan components using the <code class="docutils literal"><span class="pre">&lt;context:component-scan&gt;</span></code> element. Specify a base package to scan components in the <code class="docutils literal"><span class="pre">base-package</span></code> attribute.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>How to define it in Bean definition file (XML), is shown below.</p>
<ul class="simple">
<li>JavaBean</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;beans:bean</span> <span class="na">id=</span><span class="s">&quot;sessionCart&quot;</span> <span class="na">class=</span><span class="s">&quot;xxx.yyy.zzz.app.SessionCart&quot;</span>
            <span class="na">scope=</span><span class="s">&quot;session&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;aop:scoped-proxy</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (4) --&gt;</span>
<span class="nt">&lt;/beans:bean&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set Bean scope to <code class="docutils literal"><span class="pre">session</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify <code class="docutils literal"><span class="pre">&lt;aop:scoped-proxy</span> <span class="pre">/&gt;</span></code> element and enable scoped-proxy.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="using-session-scoped-bean">
<h4><a class="toc-backref" href="#id29">4.3.2.2.2. Using session-scoped bean</a><a class="headerlink" href="#using-session-scoped-bean" title="Permalink to this headline">Â¶</a></h4>
<div class="line-block">
<div class="line">To store and fetch objects in session using session-scoped bean,</div>
<div class="line">inject the session-scoped bean to Controller.</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Inject</span>
<span class="n">SessionCart</span> <span class="n">sessionCart</span><span class="o">;</span> <span class="c1">// (1)</span>

<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;add&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">addCart</span><span class="o">(</span><span class="nd">@Validated</span> <span class="n">ItemForm</span> <span class="n">form</span><span class="o">,</span> <span class="n">BindingResult</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;item/item&quot;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">CartItem</span> <span class="n">cartItem</span> <span class="o">=</span> <span class="n">beanMapper</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">form</span><span class="o">,</span> <span class="n">CartItem</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">Cart</span> <span class="n">addedCart</span> <span class="o">=</span> <span class="n">cartService</span><span class="o">.</span><span class="na">addCartItem</span><span class="o">(</span><span class="n">sessionCart</span><span class="o">.</span><span class="na">getCart</span><span class="o">(),</span> <span class="c1">// (2)</span>
            <span class="n">cartItem</span><span class="o">);</span>
    <span class="n">sessionCart</span><span class="o">.</span><span class="na">setCart</span><span class="o">(</span><span class="n">addedCart</span><span class="o">);</span> <span class="c1">// (3)</span>
    <span class="k">return</span> <span class="s">&quot;redirect:/cart&quot;</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Inject session-scoped bean to Controller.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">On calling the method of session-scoped bean, object stored in session is returned.</div>
<div class="line">When there is no object stored in session, newly created object is returned as well as stored in session.</div>
<div class="line">In the above example, Service method is called to check inventory etc. before adding to cart.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In the above example, <code class="docutils literal"><span class="pre">Cart</span></code> object passed as an argument of addCartItem method of <code class="docutils literal"><span class="pre">CartService</span></code> and</div>
<div class="line">the <code class="docutils literal"><span class="pre">Cart</span></code> object returned with value, may form a separate instance.</div>
<div class="line">Therefore, the returned <code class="docutils literal"><span class="pre">Cart</span></code> object is set to session-scoped bean.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>How to refer session-scoped Bean from View(JSP)</strong></p>
<p class="last">A session-scoped Bean can be referred from JSP even when Bean is not added to <code class="docutils literal"><span class="pre">Model</span></code> object in Controller by using SpEL(Spring Expression Language) formula.</p>
</div>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;spring:eval</span> <span class="na">var=</span><span class="s">&quot;cart&quot;</span> <span class="na">expression=</span><span class="s">&quot;@sessionCart.cart&quot;</span> <span class="nt">/&gt;</span>     <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">--</span><span class="k">%&gt;</span>

<span class="k">&lt;%-</span><span class="o">-</span> <span class="n">omitted</span> <span class="o">--</span><span class="k">%&gt;</span>

<span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">&quot;item&quot;</span> <span class="na">items=</span><span class="s">&quot;${cart.cartItems}&quot;</span><span class="nt">&gt;</span>     <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="o">--</span><span class="k">%&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;td&gt;</span>${f:h(item.id)}<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>${f:h(item.itemCode)}<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>${f:h(item.quantity)}<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;/c:forEach&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Refer session-scoped Bean.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Display session-scoped Bean.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="deleting-objects-stored-in-session">
<h4><a class="toc-backref" href="#id30">4.3.2.2.3. Deleting objects stored in session</a><a class="headerlink" href="#deleting-objects-stored-in-session" title="Permalink to this headline">Â¶</a></h4>
<div class="line-block">
<div class="line">If you want to remove object from session which is not required any more, reset the Bean field from session scope.</div>
</div>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The IoC Container destroys session-scoped beans when a session expires.</p>
<p class="last">Since the IoC Container manages the lifecycle of session-scoped beans,
avoid deleting them explicitly.</p>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;order&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderController</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">SessionCart</span> <span class="n">sessionCart</span><span class="o">;</span>  <span class="c1">// (1)</span>

    <span class="c1">// ...</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">order</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// ...</span>
        <span class="k">return</span> <span class="s">&quot;redirect:/order?complete&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">params</span> <span class="o">=</span> <span class="s">&quot;complete&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">complete</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">SessionStatus</span> <span class="n">sessionStatus</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">sessionCart</span><span class="o">.</span><span class="na">clearCart</span><span class="o">();</span> <span class="c1">// (2)</span>
        <span class="k">return</span> <span class="s">&quot;order/complete&quot;</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">An injectable session-scoped bean.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">delete all items which have already been ordered by initializing the state of the session-scoped bean.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="process-implementation-using-session-scoped-bean">
<h4><a class="toc-backref" href="#id31">4.3.2.2.4. Process implementation using session-scoped bean</a><a class="headerlink" href="#process-implementation-using-session-scoped-bean" title="Permalink to this headline">Â¶</a></h4>
<p>For a more specific implementation, refer to <a class="reference internal" href="#session-management-appendix-sessionscope"><span class="std std-ref">Example of screen transition across multiple Controllers using session-scoped bean.</span></a> of Appendix.</p>
</div>
</div>
<div class="section" id="debug-log-output-of-session-operations">
<h3><a class="toc-backref" href="#id32">4.3.2.3. Debug log output of session operations</a><a class="headerlink" href="#debug-log-output-of-session-operations" title="Permalink to this headline">Â¶</a></h3>
<div class="line-block">
<div class="line">Class that outputs the operations performed for a session to debug log, is provided by common library.</div>
<div class="line">The log output by this class is effective to check whether session operations are performed as expected.</div>
</div>
<p>For details on common library, refer to :ref:<cite>logging_appendix_httpsessioneventlogginglistener</cite>.</p>
</div>
<div class="section" id="using-the-jsp-implicit-object-sessionscope">
<h3><a class="toc-backref" href="#id33">4.3.2.4. Using the JSP implicit object <code class="docutils literal"><span class="pre">sessionScope</span></code></a><a class="headerlink" href="#using-the-jsp-implicit-object-sessionscope" title="Permalink to this headline">Â¶</a></h3>
<p>To use JSP implicit object <code class="docutils literal"><span class="pre">sessionScope</span></code> , the session attribute value of page directive needs to be set to <code class="docutils literal"><span class="pre">true</span></code>.
It is set as <code class="docutils literal"><span class="pre">false</span></code> in the <code class="file docutils literal"><span class="pre">include.jsp</span></code>, provided by blank project.</p>
<p><code class="file docutils literal"><span class="pre">include.jsp</span></code> is stored in the <code class="file docutils literal"><span class="pre">src/main/webapp/WEB-INF/views/common</span></code> directory.</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">include.jsp</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">session</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="k">%&gt;</span>     <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">--</span><span class="k">%&gt;</span>

<span class="k">&lt;%-</span><span class="o">-</span> <span class="n">omitted</span> <span class="o">--</span><span class="k">%&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set the session attribute value of page directive to <code class="docutils literal"><span class="pre">true</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="how-to-extend">
<h2><a class="toc-backref" href="#id34">4.3.3. How to extend</a><a class="headerlink" href="#how-to-extend" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="synchronizing-requests-in-same-session">
<h3><a class="toc-backref" href="#id35">4.3.3.1. Synchronizing requests in same session</a><a class="headerlink" href="#synchronizing-requests-in-same-session" title="Permalink to this headline">Â¶</a></h3>
<div class="line-block">
<div class="line">It is recommended to synchronize the requests in the same session in order to use <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation or session-scoped bean.</div>
<div class="line">If the requests are not synchronized, the object stored in session may be accessed at the same time, causing unexpected errors or operations.</div>
</div>
<div class="line-block">
<div class="line">For example, incorrect value may be set for the form object with completed input validation.</div>
<div class="line">To prevent this, it is strongly recommended to set synchronizeOnSession of <code class="docutils literal"><span class="pre">org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter</span></code> to âtrueâ and synchronize the requests in the same session.</div>
</div>
<p>It can be implemented by creating BeanPostProcessor as follows and performing bean definition.</p>
<ul class="simple">
<li>Component</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.app.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.BeansException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.config.BeanPostProcessor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EnableSynchronizeOnSessionPostProcessor</span>
   <span class="kd">implements</span> <span class="n">BeanPostProcessor</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span>
            <span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">EnableSynchronizeOnSessionPostProcessor</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">postProcessBeforeInitialization</span><span class="o">(</span><span class="n">Object</span> <span class="n">bean</span><span class="o">,</span> <span class="n">String</span> <span class="n">beanName</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="n">BeansException</span> <span class="o">{</span>
        <span class="c1">// NO-OP</span>
        <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">postProcessAfterInitialization</span><span class="o">(</span><span class="n">Object</span> <span class="n">bean</span><span class="o">,</span> <span class="n">String</span> <span class="n">beanName</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="n">BeansException</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">bean</span> <span class="n">instance</span> <span class="n">of</span> <span class="n">RequestMappingHandlerAdapter</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">RequestMappingHandlerAdapter</span> <span class="n">adapter</span> <span class="o">=</span>
                <span class="o">(</span><span class="n">RequestMappingHandlerAdapter</span><span class="o">)</span> <span class="n">bean</span><span class="o">;</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;enable synchronizeOnSession =&gt; {}&quot;</span><span class="o">,</span> <span class="n">adapter</span><span class="o">);</span>
            <span class="n">adapter</span><span class="o">.</span><span class="na">setSynchronizeOnSession</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span> <span class="c1">// (1)</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Requests in the same session can be synchronized by specifying <code class="docutils literal"><span class="pre">true</span></code> as an argument of setSynchronizeOnSession method of <code class="docutils literal"><span class="pre">org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>spring-mvc.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;com.example.app.config.EnableSynchronizeOnSessionPostProcessor&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define bean for <code class="docutils literal"><span class="pre">BeanPostProcessor</span></code> created in (1).</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="appendix">
<h2><a class="toc-backref" href="#id36">4.3.4. Appendix</a><a class="headerlink" href="#appendix" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="example-of-screen-transition-implementation-using-sessionattributes-in-wizard-format">
<span id="session-management-appendix-sessionattribute"></span><h3><a class="toc-backref" href="#id37">4.3.4.1. Example of screen transition implementation using <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> in wizard format</a><a class="headerlink" href="#example-of-screen-transition-implementation-using-sessionattributes-in-wizard-format" title="Permalink to this headline">Â¶</a></h3>
<p>Screen transition implementation using <code class="docutils literal"><span class="pre">&#64;SessionAttributes</span></code> annotation in wizard format, is explained below.</p>
<p>Process specifications are as follows:</p>
<ul class="simple">
<li>Provide screen for registering and updating entity.</li>
<li>Input screen consists of 3 sub-screens wherein one field is entered on each sub-screen.</li>
<li>Before saving (registering/updating), the entered values can be verified on confirmation screen.</li>
<li>Input validation is performed at the time of screen transition. User is returned to input screen in case of error.</li>
<li>Before saving (registering/updating), perform input validation again for all the input values and display the error screen notifying invalid operations.</li>
<li>If all the input values are appropriately validated, save the input data to the database.</li>
</ul>
<p>Basic screen transition is as follows:</p>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/session-management_appendix_screenflow1.png"><img alt="Invalidate session by processing of Web Application" src="../../_images/session-management_appendix_screenflow1.png" style="width: 100%;" /></a>
</div>
</div></blockquote>
<p>Example of implementation is as follows:</p>
<ul class="simple">
<li>Form object</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WizardForm</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

    <span class="c1">// (1)</span>
    <span class="nd">@NotEmpty</span><span class="o">(</span><span class="n">groups</span> <span class="o">=</span> <span class="o">{</span> <span class="n">Wizard1</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">field1</span><span class="o">;</span>

    <span class="c1">// (2)</span>
    <span class="nd">@NotEmpty</span><span class="o">(</span><span class="n">groups</span> <span class="o">=</span> <span class="o">{</span> <span class="n">Wizard2</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">field2</span><span class="o">;</span>

    <span class="c1">// (3)</span>
    <span class="nd">@NotEmpty</span><span class="o">(</span><span class="n">groups</span> <span class="o">=</span> <span class="o">{</span> <span class="n">Wizard3</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">field3</span><span class="o">;</span>

    <span class="c1">// ...</span>

    <span class="c1">// (4)</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">Wizard1</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="c1">// (5)</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">Wizard2</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="c1">// (6)</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">Wizard3</span> <span class="o">{</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Field to be entered on the first page of input screen.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Field to be entered on the second page of input screen.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Field to be entered on the third page of input screen.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Verification group interface to indicate that it is the field entered on the first page of input screen.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Verification group interface to indicate that it is the field entered on the second page of input screen.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Verification group interface to indicate that it is the field entered on the third page of input screen.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Verification group</strong></p>
<p class="last">When performing input validation for screen transition, only the fields on corresponding page need to be validated.
In Bean Validation, verification rules can be grouped by setting the interface or class representing the verification group.
In this implementation, input validation for each screen is performed by providing verification group for each screen.</p>
</div>
</div></blockquote>
<ul class="simple">
<li>Controller</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;wizard&quot;</span><span class="o">)</span>
<span class="nd">@SessionAttributes</span><span class="o">(</span><span class="n">types</span> <span class="o">=</span> <span class="o">{</span> <span class="n">WizardForm</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Entity</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span> <span class="c1">// (7)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WizardController</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">WizardService</span> <span class="n">wizardService</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="n">Mapper</span> <span class="n">beanMapper</span><span class="o">;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In the above example, form object (<code class="docutils literal"><span class="pre">WizardForm.class</span></code>) and entity (<code class="docutils literal"><span class="pre">Entity.class</span></code>) object are stored in session.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@ModelAttribute</span><span class="o">(</span><span class="s">&quot;wizardForm&quot;</span><span class="o">)</span> <span class="c1">// (8)</span>
<span class="kd">public</span> <span class="n">WizardForm</span> <span class="nf">setUpWizardForm</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">WizardForm</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In the above example, form object (<code class="docutils literal"><span class="pre">WizardForm</span></code>) to be stored in session is generated. To prevent creation of unnecessary objects, âvalueâ attribute of <code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code> annotation is specified.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// (9)</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">initializeCreateWizardForm</span><span class="o">(</span><span class="n">SessionStatus</span> <span class="n">sessionStatus</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">sessionStatus</span><span class="o">.</span><span class="na">setComplete</span><span class="o">();</span>
    <span class="k">return</span> <span class="s">&quot;redirect:/wizard/create?form1&quot;</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">// (10)</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;form1&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">createForm1</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;wizard/form1&quot;</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method for initial display of input screen for registration.</div>
<div class="line">Objects for which operation is in process, may be stored in session; hence such objects are deleted by this handler method.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method to display the first page of input screen for registration.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// (11)</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;{id}/update&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">initializeUpdateWizardForm</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">,</span>
        <span class="n">RedirectAttributes</span> <span class="n">redirectAttributes</span><span class="o">,</span> <span class="n">SessionStatus</span> <span class="n">sessionStatus</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">sessionStatus</span><span class="o">.</span><span class="na">setComplete</span><span class="o">();</span>
    <span class="k">return</span> <span class="s">&quot;redirect:/wizard/{id}/update?form1&quot;</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">// (12)</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;{id}/update&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;form1&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">updateForm1</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">,</span> <span class="n">WizardForm</span> <span class="n">form</span><span class="o">,</span>
        <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Entity</span> <span class="n">loadedEntity</span> <span class="o">=</span> <span class="n">wizardService</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="n">beanMapper</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">loadedEntity</span><span class="o">,</span> <span class="n">form</span><span class="o">);</span> <span class="c1">// (13)</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">loadedEntity</span><span class="o">);</span> <span class="c1">// (14)</span>
    <span class="k">return</span> <span class="s">&quot;wizard/form1&quot;</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(11)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method for initial display of input screen for update.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(12)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method to display input screen for update (first page).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(13)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set the fetched entity status in form object. In the above example, Bean mapper library called Dozer, is used.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(14)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add the fetched entity to <code class="docutils literal"><span class="pre">Model</span></code> object and store in session.</div>
<div class="line">In the above example, it is stored in session with attribute name <code class="docutils literal"><span class="pre">entity</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// (15)</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;save&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;form2&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">saveForm2</span><span class="o">(</span><span class="nd">@Validated</span><span class="o">(</span><span class="n">Wizard1</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="n">WizardForm</span> <span class="n">form</span><span class="o">,</span> <span class="c1">// (16)</span>
        <span class="n">BindingResult</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">saveRedoForm1</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="s">&quot;wizard/form2&quot;</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">// (17)</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;save&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;form3&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">saveForm3</span><span class="o">(</span><span class="nd">@Validated</span><span class="o">(</span><span class="n">Wizard2</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="n">WizardForm</span> <span class="n">form</span><span class="o">,</span> <span class="c1">// (18)</span>
        <span class="n">BindingResult</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">saveRedoForm2</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="s">&quot;wizard/form3&quot;</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">// (19)</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;save&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;confirm&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">saveConfirm</span><span class="o">(</span><span class="nd">@Validated</span><span class="o">(</span><span class="n">Wizard3</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="n">WizardForm</span> <span class="n">form</span><span class="o">,</span> <span class="c1">// (20)</span>
        <span class="n">BindingResult</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">saveRedoForm3</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="s">&quot;wizard/confirm&quot;</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(15)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method to display second page of input screen.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(16)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the verification group (<code class="docutils literal"><span class="pre">Wizard1.class</span></code>) on the first page of input screen, in âvalueâ attribute of <code class="docutils literal"><span class="pre">&#64;Validated</span></code> annotation, so as to perform input validation of only the value entered in first page of input screen.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(17)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method to display the third page of input screen.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(18)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the verification group (<code class="docutils literal"><span class="pre">Wizard2.class</span></code>) on the second page of input screen, in âvalueâ attribute of <code class="docutils literal"><span class="pre">&#64;Validated</span></code> annotation, so as to perform input validation of only the value entered in second page of input screen.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(19)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method to display confirmation screen.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(20)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the verification group (<code class="docutils literal"><span class="pre">Wizard3.class</span></code>) on the third page of input screen, in âvalueâ attribute of <code class="docutils literal"><span class="pre">&#64;Validated</span></code> annotation, so as to perform input validation of only the value entered in third page of input screen.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// (21)</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;save&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">save</span><span class="o">(</span><span class="nd">@ModelAttribute</span> <span class="nd">@Validated</span><span class="o">({</span> <span class="n">Wizard1</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
        <span class="n">Wizard2</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Wizard3</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span> <span class="n">WizardForm</span> <span class="n">form</span><span class="o">,</span> <span class="c1">// (22)</span>
        <span class="n">BindingResult</span> <span class="n">result</span><span class="o">,</span>
        <span class="n">Entity</span> <span class="n">entity</span><span class="o">,</span> <span class="c1">// (23)</span>
        <span class="n">RedirectAttributes</span> <span class="n">redirectAttributes</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">InvalidRequestException</span><span class="o">(</span><span class="n">result</span><span class="o">);</span> <span class="c1">// (24)</span>
    <span class="o">}</span>

    <span class="n">beanMapper</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">form</span><span class="o">,</span> <span class="n">entity</span><span class="o">);</span>

    <span class="n">entity</span> <span class="o">=</span> <span class="n">wizardService</span><span class="o">.</span><span class="na">saveEntity</span><span class="o">(</span><span class="n">entity</span><span class="o">);</span> <span class="c1">// (25)</span>

    <span class="n">redirectAttributes</span><span class="o">.</span><span class="na">addFlashAttribute</span><span class="o">(</span><span class="n">entity</span><span class="o">);</span> <span class="c1">// (26)</span>

    <span class="k">return</span> <span class="s">&quot;redirect:/wizard/save?complete&quot;</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">// (27)</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;save&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;complete&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">saveComplete</span><span class="o">(</span><span class="n">SessionStatus</span> <span class="n">sessionStatus</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">sessionStatus</span><span class="o">.</span><span class="na">setComplete</span><span class="o">();</span>
    <span class="k">return</span> <span class="s">&quot;wizard/complete&quot;</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(21)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method to execute save process.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(22)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the verification group interface (<code class="docutils literal"><span class="pre">Wizard1.class</span></code>,  <code class="docutils literal"><span class="pre">Wizard2.class</span></code>, <code class="docutils literal"><span class="pre">Wizard3.class</span></code>) of each input screen, in the âvalueâ attribute of <code class="docutils literal"><span class="pre">&#64;Validated</span></code> annotation, to check all the values entered on input screen.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(23)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch the <code class="docutils literal"><span class="pre">Entity.class</span></code> object to be saved.</div>
<div class="line">For registration process, newly created object is fetched and for update process, the object stored in session by process (14), is fetched.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(24)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">As error does not occur when screen transition is performed using the buttons provided by the application, <code class="docutils literal"><span class="pre">InvalidRequestException</span></code> is thrown when an invalid operation is performed.</div>
<div class="line">Further, exception class <code class="docutils literal"><span class="pre">InvalidRequestException</span></code> needs to be created separately, as it is not provided by common library.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(25)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Save the <code class="docutils literal"><span class="pre">Entity.class</span></code> object reflecting the input value.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(26)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Entity.class</span></code> object saved by handler method of redirect destination is stored in Flash scope so that it can be referred.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(27)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method to display completion screen.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="highlight-java"><div class="highlight"><pre><span></span>    <span class="c1">// (28)</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;save&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;redoForm1&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">saveRedoForm1</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;wizard/form1&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (29)</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;save&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;redoForm2&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">saveRedoForm2</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;wizard/form2&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (30)</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;save&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;redoForm3&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">saveRedoForm3</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;wizard/form3&quot;</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(28)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method to re-display first page of input screen.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(29)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method to re-display second page of input screen.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(30)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method to re-display third page of input screen.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>Complete Controller source code</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;wizard&quot;</span><span class="o">)</span>
<span class="nd">@SessionAttributes</span><span class="o">(</span><span class="n">types</span> <span class="o">=</span> <span class="o">{</span> <span class="n">WizardForm</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Entity</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
<span class="c1">// (7)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WizardController</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">EntityService</span> <span class="n">wizardService</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="n">Mapper</span> <span class="n">beanMapper</span><span class="o">;</span>

    <span class="nd">@ModelAttribute</span><span class="o">(</span><span class="s">&quot;wizardForm&quot;</span><span class="o">)</span>
    <span class="c1">// (8)</span>
    <span class="kd">public</span> <span class="n">WizardForm</span> <span class="nf">setUpWizardForm</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">WizardForm</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// (9)</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">initializeCreateWizardForm</span><span class="o">(</span><span class="n">SessionStatus</span> <span class="n">sessionStatus</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">sessionStatus</span><span class="o">.</span><span class="na">setComplete</span><span class="o">();</span>
        <span class="k">return</span> <span class="s">&quot;redirect:/wizard/create?form1&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (10)</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;form1&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">createForm1</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;wizard/form1&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (11)</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;{id}/update&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">initializeUpdateWizardForm</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">,</span>
            <span class="n">RedirectAttributes</span> <span class="n">redirectAttributes</span><span class="o">,</span> <span class="n">SessionStatus</span> <span class="n">sessionStatus</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">sessionStatus</span><span class="o">.</span><span class="na">setComplete</span><span class="o">();</span>
        <span class="k">return</span> <span class="s">&quot;redirect:/wizard/{id}/update?form1&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (12)</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;{id}/update&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;form1&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">updateForm1</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">,</span> <span class="n">WizardForm</span> <span class="n">form</span><span class="o">,</span>
            <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Entity</span> <span class="n">loadedEntity</span> <span class="o">=</span> <span class="n">wizardService</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">beanMapper</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">loadedEntity</span><span class="o">,</span> <span class="n">form</span><span class="o">);</span> <span class="c1">// (13)</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">loadedEntity</span><span class="o">);</span> <span class="c1">// (14)</span>
        <span class="k">return</span> <span class="s">&quot;wizard/form1&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (15)</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;save&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;form2&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">saveForm2</span><span class="o">(</span><span class="nd">@Validated</span><span class="o">(</span><span class="n">Wizard1</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="n">WizardForm</span> <span class="n">form</span><span class="o">,</span> <span class="c1">// (16)</span>
            <span class="n">BindingResult</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">saveRedoForm1</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&quot;wizard/form2&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (17)</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;save&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;form3&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">saveForm3</span><span class="o">(</span><span class="nd">@Validated</span><span class="o">(</span><span class="n">Wizard2</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="n">WizardForm</span> <span class="n">form</span><span class="o">,</span> <span class="c1">// (18)</span>
            <span class="n">BindingResult</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">saveRedoForm2</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&quot;wizard/form3&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (19)</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;save&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;confirm&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">saveConfirm</span><span class="o">(</span><span class="nd">@Validated</span><span class="o">(</span><span class="n">Wizard3</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="n">WizardForm</span> <span class="n">form</span><span class="o">,</span> <span class="c1">// (20)</span>
            <span class="n">BindingResult</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">saveRedoForm3</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&quot;wizard/confirm&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (21)</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;save&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">save</span><span class="o">(</span><span class="nd">@ModelAttribute</span> <span class="nd">@Validated</span><span class="o">({</span> <span class="n">Wizard1</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
            <span class="n">Wizard2</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Wizard3</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span> <span class="n">WizardForm</span> <span class="n">form</span><span class="o">,</span> <span class="c1">// (22)</span>
            <span class="n">BindingResult</span> <span class="n">result</span><span class="o">,</span> <span class="n">Entity</span> <span class="n">entity</span><span class="o">,</span> <span class="c1">// (23)</span>
            <span class="n">RedirectAttributes</span> <span class="n">redirectAttributes</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">InvalidRequestException</span><span class="o">(</span><span class="n">result</span><span class="o">);</span> <span class="c1">// (24)</span>
        <span class="o">}</span>

        <span class="n">beanMapper</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">form</span><span class="o">,</span> <span class="n">entity</span><span class="o">);</span>

        <span class="n">entity</span> <span class="o">=</span> <span class="n">wizardService</span><span class="o">.</span><span class="na">saveEntity</span><span class="o">(</span><span class="n">entity</span><span class="o">);</span> <span class="c1">// (25)</span>

        <span class="n">redirectAttributes</span><span class="o">.</span><span class="na">addFlashAttribute</span><span class="o">(</span><span class="n">entity</span><span class="o">);</span> <span class="c1">// (26)</span>

        <span class="k">return</span> <span class="s">&quot;redirect:/wizard/save?complete&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (27)</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;save&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;complete&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">saveComplete</span><span class="o">(</span><span class="n">SessionStatus</span> <span class="n">sessionStatus</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">sessionStatus</span><span class="o">.</span><span class="na">setComplete</span><span class="o">();</span>
        <span class="k">return</span> <span class="s">&quot;wizard/complete&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (28)</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;save&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;redoForm1&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">saveRedoForm1</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;wizard/form1&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (29)</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;save&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;redoForm2&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">saveRedoForm2</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;wizard/form2&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (30)</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;save&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;redoForm3&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">saveRedoForm3</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;wizard/form3&quot;</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>First page of input screen (JSP)</li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>Wizard Form(1/3)<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Wizard Form(1/3)<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;form:form</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/wizard/save&quot;</span>
        <span class="na">modelAttribute=</span><span class="s">&quot;wizardForm&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;form:label</span> <span class="na">path=</span><span class="s">&quot;field1&quot;</span><span class="nt">&gt;</span>Field1<span class="nt">&lt;/form:label&gt;</span> :
        <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;field1&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;field1&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            <span class="nt">&lt;form:button</span> <span class="na">name=</span><span class="s">&quot;form2&quot;</span><span class="nt">&gt;</span>Next<span class="nt">&lt;/form:button&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/form:form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Second page of input screen (JSP)</li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>Wizard Form(2/3)<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Wizard Form(2/3)<span class="nt">&lt;/h1&gt;</span>
    <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">(</span><span class="mi">31</span><span class="o">)</span> <span class="o">--</span><span class="k">%&gt;</span>
    <span class="nt">&lt;form:form</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/wizard/save&quot;</span>
        <span class="na">modelAttribute=</span><span class="s">&quot;wizardForm&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;form:label</span> <span class="na">path=</span><span class="s">&quot;field2&quot;</span><span class="nt">&gt;</span>Field2<span class="nt">&lt;/form:label&gt;</span> :
        <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;field2&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;field2&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            <span class="nt">&lt;form:button</span> <span class="na">name=</span><span class="s">&quot;redoForm1&quot;</span><span class="nt">&gt;</span>Back<span class="nt">&lt;/form:button&gt;</span>
            <span class="nt">&lt;form:button</span> <span class="na">name=</span><span class="s">&quot;form3&quot;</span><span class="nt">&gt;</span>Next<span class="nt">&lt;/form:button&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/form:form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(31)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">There is no need to hide the input screen fields of first page since the form object is stored in session.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>Third page of input screen (JSP)</li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>Wizard Form(3/3)<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Wizard Form(3/3)<span class="nt">&lt;/h1&gt;</span>
    <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">(</span><span class="mi">32</span><span class="o">)</span> <span class="o">--</span><span class="k">%&gt;</span>
    <span class="nt">&lt;form:form</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/wizard/save&quot;</span>
        <span class="na">modelAttribute=</span><span class="s">&quot;wizardForm&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;form:label</span> <span class="na">path=</span><span class="s">&quot;field3&quot;</span><span class="nt">&gt;</span>Field3<span class="nt">&lt;/form:label&gt;</span> :
        <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;field3&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;field3&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            <span class="nt">&lt;form:button</span> <span class="na">name=</span><span class="s">&quot;redoForm2&quot;</span><span class="nt">&gt;</span>Back<span class="nt">&lt;/form:button&gt;</span>
            <span class="nt">&lt;form:button</span> <span class="na">name=</span><span class="s">&quot;confirm&quot;</span><span class="nt">&gt;</span>Confirm<span class="nt">&lt;/form:button&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/form:form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(32)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">There is no need to hide the input screen fields of first and second page since form object is stored in session.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>Confirmation screen (JSP)</li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>Confirm<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Confirm<span class="nt">&lt;/h1&gt;</span>
    <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">(</span><span class="mi">33</span><span class="o">)</span> <span class="o">--</span><span class="k">%&gt;</span>
    <span class="nt">&lt;form:form</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/wizard/save&quot;</span>
        <span class="na">modelAttribute=</span><span class="s">&quot;wizardForm&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            Field1 : <span class="nt">&lt;c:out</span> <span class="na">value=</span><span class="s">&quot;${wizardForm.field1}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            Field2 : <span class="nt">&lt;c:out</span> <span class="na">value=</span><span class="s">&quot;${wizardForm.field2}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            Field3 : <span class="nt">&lt;c:out</span> <span class="na">value=</span><span class="s">&quot;${wizardForm.field3}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            <span class="nt">&lt;form:button</span> <span class="na">name=</span><span class="s">&quot;redoForm3&quot;</span><span class="nt">&gt;</span>Back<span class="nt">&lt;/form:button&gt;</span>
            <span class="nt">&lt;form:button&gt;</span>OK<span class="nt">&lt;/form:button&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/form:form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(33)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">There is no need to hide input screen fields since form object is stored in session.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>Completion screen (JSP)</li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>Complete<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Complete<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            ID : ${f:h(entity.id)}
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            Field1 : ${f:h(entity.field1)}
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            Field2 : ${f:h(entity.field2)}
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            Field3 : ${f:h(entity.field3)}
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/wizard/create&quot;</span><span class="nt">&gt;</span>
            Continue operation of Create
        <span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/wizard/${entity.id}/update&quot;</span><span class="nt">&gt;</span>
            Continue operation of Update
        <span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>spring-mvc.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.exception.SystemExceptionResolver&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionCodeResolver&quot;</span> <span class="na">ref=</span><span class="s">&quot;exceptionCodeResolver&quot;</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionMappings&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;map&gt;</span>
            <span class="c">&lt;!-- ... --&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;InvalidRequestException&quot;</span>
                   <span class="na">value=</span><span class="s">&quot;common/error/operationError&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (34) --&gt;</span>
        <span class="nt">&lt;/map&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;statusCodes&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;map&gt;</span>
            <span class="c">&lt;!-- ... --&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;common/error/operationError&quot;</span> <span class="na">value=</span><span class="s">&quot;400&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (35) --&gt;</span>
        <span class="nt">&lt;/map&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(34)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add exception handling definition of  <code class="docutils literal"><span class="pre">InvalidRequestException</span></code> that notifies detection of invalid request when executing save process, in <code class="docutils literal"><span class="pre">exceptionMappings</span></code> of <code class="docutils literal"><span class="pre">SystemExceptionResolver</span></code>, provided by common library.</div>
<div class="line">In the above example, <code class="docutils literal"><span class="pre">/WEB-INF/views/common/error/operationError.jsp</span></code> is specified as a View name of transition destination when exception occurs.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(35)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the HTTP response code when <code class="docutils literal"><span class="pre">HttpSessionRequiredException</span></code> occurs in <code class="docutils literal"><span class="pre">statusCodes</span></code> of <code class="docutils literal"><span class="pre">SystemExceptionResolver</span></code>.</div>
<div class="line">In the above example, Bad Request (<code class="docutils literal"><span class="pre">400</span></code>) is specified as HTTP response code when exception occurs.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>applicationContext.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;exceptionCodeResolver&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.exception.SimpleMappingExceptionCodeResolver&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- Setting and Customization by project. --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionMappings&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;map&gt;</span>
            <span class="c">&lt;!-- ... --&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;InvalidRequestException&quot;</span> <span class="na">value=</span><span class="s">&quot;w.xx.0004&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (36) --&gt;</span>
        <span class="nt">&lt;/map&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultExceptionCode&quot;</span> <span class="na">value=</span><span class="s">&quot;e.xx.0001&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (37) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(36)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add exception handling definition of  <code class="docutils literal"><span class="pre">InvalidRequestException</span></code> to <code class="docutils literal"><span class="pre">exceptionMappings</span></code> of <code class="docutils literal"><span class="pre">SimpleMappingExceptionCodeResolver</span></code> provided by common library.</div>
<div class="line">In the above example, <code class="docutils literal"><span class="pre">w.xx.0004</span></code> is specified as the exception code when an exception occurs.</div>
<div class="line">When this setting is not added, default exception code is output to log.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(37)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Default exception code in case of an exception.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="example-of-screen-transition-across-multiple-controllers-using-session-scoped-bean">
<span id="session-management-appendix-sessionscope"></span><h3><a class="toc-backref" href="#id38">4.3.4.2. Example of screen transition across multiple Controllers using session-scoped bean.</a><a class="headerlink" href="#example-of-screen-transition-across-multiple-controllers-using-session-scoped-bean" title="Permalink to this headline">Â¶</a></h3>
<p>Implementation using session-scoped bean is explained with example of process of performing screen transitions across multiple Controllers.</p>
<p>Process specifications are as follows:</p>
<ul class="simple">
<li>Provide a process to add products to cart.</li>
<li>Provide a process to change the quantity of products added to the cart.</li>
<li>Provide a process to order the products stored in cart.</li>
<li>Above 3 processes are provided as independent functions and should be set in separate Controllers (ItemController, CartController, OrderController).</li>
<li>Store the cart in session as it is shared by the above 3 processes.</li>
<li>Display the cart screen when products are added to cart.</li>
</ul>
<p>Screen transition should be as follows:</p>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/session-management_appendix_screenflow2.png"><img alt="Invalidate session by processing of Web Application" src="../../_images/session-management_appendix_screenflow2.png" style="width: 100%;" /></a>
</div>
</div></blockquote>
<p>Implementation is as follows:</p>
<ul class="simple">
<li>JavaBean to be defined as session-scoped bean.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Component</span>
<span class="nd">@Scope</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;session&quot;</span><span class="o">,</span> <span class="n">proxyMode</span> <span class="o">=</span> <span class="n">ScopedProxyMode</span><span class="o">.</span><span class="na">TARGET_CLASS</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SessionCart</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Cart</span> <span class="n">cart</span><span class="o">;</span> <span class="c1">// (1)</span>

    <span class="kd">public</span> <span class="n">Cart</span> <span class="nf">getCart</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">cart</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">cart</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cart</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">cart</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCart</span><span class="o">(</span><span class="n">Cart</span> <span class="n">cart</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">cart</span> <span class="o">=</span> <span class="n">cart</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clearCart</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// (2)</span>
        <span class="n">cart</span><span class="o">.</span><span class="na">clearCart</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Wrap the Entity (Domain object) called, <code class="docutils literal"><span class="pre">Cart</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Make cart empty by removing all product objects from <code class="docutils literal"><span class="pre">cart</span></code>which are added in the cart.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>ItemController</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;item&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemController</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">SessionCart</span> <span class="n">sessionCart</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="n">CartService</span> <span class="n">cartService</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="n">Mapper</span> <span class="n">beanMapper</span><span class="o">;</span>

    <span class="nd">@ModelAttribute</span>
    <span class="kd">public</span> <span class="n">ItemForm</span> <span class="nf">setUpItemForm</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">ItemForm</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// (3)</span>
    <span class="nd">@RequestMapping</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">view</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;item/item&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (4)</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;add&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addCart</span><span class="o">(</span><span class="nd">@Validated</span> <span class="n">ItemForm</span> <span class="n">form</span><span class="o">,</span> <span class="n">BindingResult</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="s">&quot;item/item&quot;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">CartItem</span> <span class="n">cartItem</span> <span class="o">=</span> <span class="n">beanMapper</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">form</span><span class="o">,</span> <span class="n">CartItem</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">Cart</span> <span class="n">cart</span> <span class="o">=</span> <span class="n">cartService</span><span class="o">.</span><span class="na">addCartItem</span><span class="o">(</span><span class="n">sessionCart</span><span class="o">.</span><span class="na">getCart</span><span class="o">(),</span> <span class="c1">// (5)</span>
                <span class="n">cartItem</span><span class="o">);</span>
        <span class="n">sessionCart</span><span class="o">.</span><span class="na">setCart</span><span class="o">(</span><span class="n">cart</span><span class="o">);</span> <span class="c1">// (6)</span>
        <span class="k">return</span> <span class="s">&quot;redirect:/cart&quot;</span><span class="o">;</span> <span class="c1">// (7)</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method to display product screen.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method to add specified products to cart.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Pass <code class="docutils literal"><span class="pre">Cart</span></code> object stored in the session in Service method.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Reflect <code class="docutils literal"><span class="pre">Cart</span></code> object returned by Service method to session-scoped bean.</div>
<div class="line">By reflecting in session-scoped Bean, <code class="docutils literal"><span class="pre">Cart</span></code> object is stored in the session.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Redirect to the request to display cart screen after adding products to cart.</div>
<div class="line"><strong>When transiting to a separate Controller screen, instead of calling View (JSP) directly, it is recommended to redirect to the request for displaying the screen.</strong></div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>CartController</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;cart&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CartController</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">SessionCart</span> <span class="n">sessionCart</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="n">CartService</span> <span class="n">cartService</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="n">Mapper</span> <span class="n">beanMapper</span><span class="o">;</span>

    <span class="nd">@ModelAttribute</span>
    <span class="kd">public</span> <span class="n">CartForm</span> <span class="nf">setUpCartForm</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">CartForm</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// (8)</span>
    <span class="nd">@RequestMapping</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">cart</span><span class="o">(</span><span class="n">CartForm</span> <span class="n">form</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">beanMapper</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">sessionCart</span><span class="o">.</span><span class="na">getCart</span><span class="o">(),</span> <span class="n">form</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&quot;cart/cart&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (9)</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">params</span> <span class="o">=</span> <span class="s">&quot;edit&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">edit</span><span class="o">(</span><span class="nd">@Validated</span> <span class="n">CartForm</span> <span class="n">form</span><span class="o">,</span> <span class="n">BindingResult</span> <span class="n">result</span><span class="o">,</span>
            <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="s">&quot;cart/cart&quot;</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">Cart</span> <span class="n">cart</span> <span class="o">=</span> <span class="n">sessionCart</span><span class="o">.</span><span class="na">getCart</span><span class="o">();</span>
        <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">CartItemForm</span><span class="o">&gt;</span> <span class="n">itemForm</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="na">getCartItems</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">CartItem</span> <span class="n">item</span> <span class="o">:</span> <span class="n">cart</span><span class="o">.</span><span class="na">getCartItems</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">beanMapper</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">itemForm</span><span class="o">.</span><span class="na">next</span><span class="o">(),</span> <span class="n">item</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">cart</span> <span class="o">=</span> <span class="n">cartService</span><span class="o">.</span><span class="na">saveCart</span><span class="o">(</span><span class="n">cart</span><span class="o">);</span>
        <span class="n">sessionCart</span><span class="o">.</span><span class="na">setCart</span><span class="o">(</span><span class="n">cart</span><span class="o">);</span> <span class="c1">// (10)</span>

        <span class="k">return</span> <span class="s">&quot;redirect:/cart&quot;</span><span class="o">;</span> <span class="c1">// (11)</span>
    <span class="o">}</span>


<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method to display cart screen (quantity change screen).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method to change quantity.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Reflect <code class="docutils literal"><span class="pre">Cart</span></code> object returned by Service method, to session-scoped bean.</div>
<div class="line">By reflecting in session-scoped bean, it is reflected in the session.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(11)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Redirect to the request to display cart screen (quantity change screen) after changing quantity.</div>
<div class="line"><strong>In case of Update process, instead of calling View (JSP) directly, it is recommended to redirect to the request for displaying the screen.</strong></div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>OrderController</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;order&quot;</span><span class="o">)</span>
<span class="nd">@SessionAttributes</span><span class="o">(</span><span class="s">&quot;scopedTarget.sessionCart&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderController</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">SessionCart</span> <span class="n">sessionCart</span><span class="o">;</span>

    <span class="nd">@ModelAttribute</span>
    <span class="kd">public</span> <span class="n">OrderForm</span> <span class="nf">setUpOrderForm</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">OrderForm</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// (12)</span>
    <span class="nd">@RequestMapping</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">view</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;order/order&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (13)</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">order</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// ...</span>
        <span class="k">return</span> <span class="s">&quot;redirect:/order?complete&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (14)</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">params</span> <span class="o">=</span> <span class="s">&quot;complete&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">complete</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">SessionStatus</span> <span class="n">sessionStatus</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">sessionCart</span><span class="o">.</span><span class="na">clearCart</span><span class="o">();</span>
        <span class="k">return</span> <span class="s">&quot;order/complete&quot;</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(12)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method to display Order screen.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(13)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method to place an Order.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(14)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handler method to display Order Completion screen.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>Product screen (JSP)</li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>Item<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Item<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;form:form</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/item/add&quot;</span>
        <span class="na">modelAttribute=</span><span class="s">&quot;itemForm&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;form:label</span> <span class="na">path=</span><span class="s">&quot;itemCode&quot;</span><span class="nt">&gt;</span>Item Code<span class="nt">&lt;/form:label&gt;</span> :
        <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;itemCode&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;quantity&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;br&gt;</span>
        <span class="nt">&lt;form:label</span> <span class="na">path=</span><span class="s">&quot;quantity&quot;</span><span class="nt">&gt;</span>Quantity<span class="nt">&lt;/form:label&gt;</span> :
        <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;quantity&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;quantity&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">(</span><span class="mi">15</span><span class="o">)</span> <span class="o">--</span><span class="k">%&gt;</span>
            <span class="nt">&lt;form:button&gt;</span>Add<span class="nt">&lt;/form:button&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/form:form&gt;</span>
    <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/cart&quot;</span><span class="nt">&gt;</span>Go to Cart<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(15)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Button to add a product.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>Cart screen (JSP)</li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>Cart<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">(</span><span class="mi">16</span><span class="o">)</span> <span class="o">--</span><span class="k">%&gt;</span>
    <span class="nt">&lt;spring:eval</span> <span class="na">var=</span><span class="s">&quot;cart&quot;</span> <span class="na">experssion=</span><span class="s">&quot;@sessionCart.cart&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Cart<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;c:choose&gt;</span>
        <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">&quot;${ empty cart.cartItems }&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div&gt;</span>Cart is empty.<span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/c:when&gt;</span>
        <span class="nt">&lt;c:otherwise&gt;</span>
            CART ID :
            ${f:h(cart.id)}
            <span class="nt">&lt;form:form</span> <span class="na">modelAttribute=</span><span class="s">&quot;cartForm&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;table</span> <span class="na">border=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;thead&gt;</span>
                        <span class="nt">&lt;tr&gt;</span>
                            <span class="nt">&lt;th&gt;</span>ID<span class="nt">&lt;/th&gt;</span>
                            <span class="nt">&lt;th&gt;</span>ITEM CODE<span class="nt">&lt;/th&gt;</span>
                            <span class="nt">&lt;th&gt;</span>QUANTITY<span class="nt">&lt;/th&gt;</span>
                        <span class="nt">&lt;/tr&gt;</span>
                    <span class="nt">&lt;/thead&gt;</span>
                    <span class="nt">&lt;tbody&gt;</span>
                        <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">&quot;item&quot;</span>
                            <span class="na">items=</span><span class="s">&quot;${cart.cartItems}&quot;</span>
                            <span class="na">varStatus=</span><span class="s">&quot;rowStatus&quot;</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;tr&gt;</span>
                                <span class="nt">&lt;td&gt;</span>${f:h(item.id)}<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>${f:h(item.itemCode)}<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td&gt;</span>
                                    <span class="nt">&lt;form:input</span>
                                        <span class="na">path=</span><span class="s">&quot;cartItems[${rowStatus.index}].quantity&quot;</span> <span class="nt">/&gt;</span>
                                    <span class="nt">&lt;form:errors</span>
                                        <span class="na">path=</span><span class="s">&quot;cartItems[${rowStatus.index}].quantity&quot;</span> <span class="nt">/&gt;</span>
                                <span class="nt">&lt;/td&gt;</span>
                            <span class="nt">&lt;/tr&gt;</span>
                        <span class="nt">&lt;/c:forEach&gt;</span>
                    <span class="nt">&lt;/tbody&gt;</span>
                <span class="nt">&lt;/table&gt;</span>
                <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">(</span><span class="mi">17</span><span class="o">)</span> <span class="o">--</span><span class="k">%&gt;</span>
                <span class="nt">&lt;form:button</span> <span class="na">name=</span><span class="s">&quot;edit&quot;</span><span class="nt">&gt;</span>Save<span class="nt">&lt;/form:button&gt;</span>
            <span class="nt">&lt;/form:form&gt;</span>
            <span class="nt">&lt;div&gt;</span>
                <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">(</span><span class="mi">18</span><span class="o">)</span> <span class="o">--</span><span class="k">%&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/order&quot;</span><span class="nt">&gt;</span>Go to Order<span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/c:otherwise&gt;</span>
    <span class="nt">&lt;/c:choose&gt;</span>
    <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/item&quot;</span><span class="nt">&gt;</span>Back to Item<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(16)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Refer session-scoped Bean using SpEL formula.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(17)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Button to update quantity.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(18)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Link to display Order screen.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>Order screen (JSP)</li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>Order<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;spring:eval</span> <span class="na">var=</span><span class="s">&quot;cart&quot;</span> <span class="na">experssion=</span><span class="s">&quot;@sessionCart.cart&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Order<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;table</span> <span class="na">border=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;thead&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;th&gt;</span>ID<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th&gt;</span>ITEM CODE<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th&gt;</span>QUANTITY<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/thead&gt;</span>
        <span class="nt">&lt;tbody&gt;</span>
            <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">&quot;item&quot;</span> <span class="na">items=</span><span class="s">&quot;${cart.cartItems}&quot;</span>
                <span class="na">varStatus=</span><span class="s">&quot;rowStatus&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;</span>${f:h(item.id)}<span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;</span>${f:h(item.itemCode)}<span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;</span>${f:h(item.quantity)}<span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/c:forEach&gt;</span>
        <span class="nt">&lt;/tbody&gt;</span>
    <span class="nt">&lt;/table&gt;</span>
    <span class="nt">&lt;form:form</span> <span class="na">modelAttribute=</span><span class="s">&quot;orderForm&quot;</span><span class="nt">&gt;</span>
        <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">(</span><span class="mi">19</span><span class="o">)</span> <span class="o">--</span><span class="k">%&gt;</span>
        <span class="nt">&lt;form:button&gt;</span>Order<span class="nt">&lt;/form:button&gt;</span>
    <span class="nt">&lt;/form:form&gt;</span>
    <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/cart&quot;</span><span class="nt">&gt;</span>Back to Cart<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/item&quot;</span><span class="nt">&gt;</span>Back to Item<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(19)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Button to place an order.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>Order Completion screen (JSP)</li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>Order Complete<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Order Complete<span class="nt">&lt;/h1&gt;</span>
    ORDER ID :
    ${f:h(order.id)}
    <span class="nt">&lt;table</span> <span class="na">border=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;thead&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;th&gt;</span>ID<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th&gt;</span>ITEM CODE<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th&gt;</span>QUANTITY<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/thead&gt;</span>
        <span class="nt">&lt;tbody&gt;</span>
            <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">&quot;item&quot;</span> <span class="na">items=</span><span class="s">&quot;${order.orderItems}&quot;</span>
                <span class="na">varStatus=</span><span class="s">&quot;rowStatus&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;</span>${f:h(item.id)}<span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;</span>${f:h(item.itemCode)}<span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;</span>${f:h(item.quantity)}<span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/c:forEach&gt;</span>
        <span class="nt">&lt;/tbody&gt;</span>
    <span class="nt">&lt;/table&gt;</span>
    <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/item&quot;</span><span class="nt">&gt;</span>Back to Item<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p></p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="Pagination.html" title="4.4. Pagination"
             >next</a> |</li>
        <li class="right" >
          <a href="ExceptionHandling.html" title="4.2. Exception Handling"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.4.1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >4. Web Application Development Features</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
      Â© Copyright 2013-2018, NTT DATA Corporation. Â© Copyright 2013-2018, NTT Corporation.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.3.Theme is <a href="http://github.com/vimalkvn/solar-theme">Solar</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>