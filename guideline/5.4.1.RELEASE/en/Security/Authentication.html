<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>9.2. Authentication &#8212; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.4.1.RELEASE documentation</title>
    <link rel="stylesheet" href="../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.4.1.RELEASE',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="9.3. Authorization" href="Authorization.html" />
    <link rel="prev" title="9.1. Spring Security Overview" href="SpringSecurity.html" /><script src="../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../_static/solarized-dark.css" rel="stylesheet">
<link href="../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Authorization.html" title="9.3. Authorization"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="SpringSecurity.html" title="9.1. Spring Security Overview"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.4.1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">9. Security countermeasures</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">9.2. Authentication</a><ul>
<li><a class="reference internal" href="#overview">9.2.1. Overview</a><ul>
<li><a class="reference internal" href="#authentication-process-architecture">9.2.1.1. Authentication process architecture</a><ul>
<li><a class="reference internal" href="#authentication-filter">9.2.1.1.1. Authentication Filter</a></li>
<li><a class="reference internal" href="#authenticationmanager">9.2.1.1.2. AuthenticationManager</a></li>
<li><a class="reference internal" href="#authenticationprovider">9.2.1.1.3. AuthenticationProvider</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use">9.2.2. How to use</a><ul>
<li><a class="reference internal" href="#form-authentication">9.2.2.1. Form authentication</a><ul>
<li><a class="reference internal" href="#applying-form-authentication">9.2.2.1.1. Applying form authentication</a></li>
<li><a class="reference internal" href="#default-operation">9.2.2.1.2. Default operation</a></li>
<li><a class="reference internal" href="#creating-login-form">9.2.2.1.3. Creating login form</a></li>
</ul>
</li>
<li><a class="reference internal" href="#response-when-authentication-is-successful">9.2.2.2. Response when authentication is successful</a><ul>
<li><a class="reference internal" href="#id1">9.2.2.2.1. Default operation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#response-when-authentication-fails">9.2.2.3. Response when authentication fails</a><ul>
<li><a class="reference internal" href="#id2">9.2.2.3.1. Default operation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#db-authentication">9.2.2.4. DB authentication</a><ul>
<li><a class="reference internal" href="#creating-userdetails">9.2.2.4.1. Creating UserDetails</a></li>
<li><a class="reference internal" href="#creating-userdetailsservice">9.2.2.4.2. Creating UserDetailsService</a></li>
<li><a class="reference internal" href="#applying-db-authentication">9.2.2.4.3. Applying DB authentication</a></li>
</ul>
</li>
<li><a class="reference internal" href="#password-hashing">9.2.2.5. Password hashing</a><ul>
<li><a class="reference internal" href="#bcryptpasswordencoder">9.2.2.5.1. BCryptPasswordEncoder</a></li>
</ul>
</li>
<li><a class="reference internal" href="#handling-authentication-event">9.2.2.6. Handling authentication event</a><ul>
<li><a class="reference internal" href="#authentication-successful-event">9.2.2.6.1. Authentication successful event</a></li>
<li><a class="reference internal" href="#authentication-failure-event">9.2.2.6.2. Authentication failure event</a></li>
<li><a class="reference internal" href="#creating-event-listener">9.2.2.6.3. Creating event listener</a></li>
</ul>
</li>
<li><a class="reference internal" href="#logout">9.2.2.7. Logout</a><ul>
<li><a class="reference internal" href="#applying-logout-process">9.2.2.7.1. Applying logout process</a></li>
<li><a class="reference internal" href="#id3">9.2.2.7.2. Default operation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#response-when-logout-is-successful">9.2.2.8. Response when logout is successful</a><ul>
<li><a class="reference internal" href="#id4">9.2.2.8.1. Default operation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#accessing-authentication-information">9.2.2.9. Accessing authentication information</a><ul>
<li><a class="reference internal" href="#access-from-java">9.2.2.9.1. Access from Java</a></li>
<li><a class="reference internal" href="#access-from-jsp">9.2.2.9.2. Access from JSP</a></li>
</ul>
</li>
<li><a class="reference internal" href="#coordination-between-authentication-process-and-spring-mvc">9.2.2.10. Coordination between authentication process and Spring MVC</a><ul>
<li><a class="reference internal" href="#id5">9.2.2.10.1. Accessing authentication information</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-extend">9.2.3. How to extend</a><ul>
<li><a class="reference internal" href="#customizing-form-authentication">9.2.3.1. Customizing form authentication</a><ul>
<li><a class="reference internal" href="#changing-authentication-path">9.2.3.1.1. Changing authentication path</a></li>
<li><a class="reference internal" href="#change-request-parameter-name-which-sends-credentials">9.2.3.1.2. Change request parameter name which sends credentials</a></li>
</ul>
</li>
<li><a class="reference internal" href="#customising-response-when-authentication-is-successful">9.2.3.2. Customising response when authentication is successful</a><ul>
<li><a class="reference internal" href="#changing-default-transition-destination">9.2.3.2.1. Changing default transition destination</a></li>
<li><a class="reference internal" href="#fixing-transition-destination">9.2.3.2.2. Fixing transition destination</a></li>
<li><a class="reference internal" href="#applying-authenticationsuccesshandler">9.2.3.2.3. Applying AuthenticationSuccessHandler</a></li>
</ul>
</li>
<li><a class="reference internal" href="#customising-response-at-the-time-of-authentication-failure">9.2.3.3. Customising response at the time of authentication failure</a><ul>
<li><a class="reference internal" href="#changing-transition-destination">9.2.3.3.1. Changing transition destination</a></li>
<li><a class="reference internal" href="#applying-authenticationfailurehandler">9.2.3.3.2. Applying AuthenticationFailureHandler</a></li>
</ul>
</li>
<li><a class="reference internal" href="#customising-logout-process">9.2.3.4. Customising logout process</a><ul>
<li><a class="reference internal" href="#changing-logout-path">9.2.3.4.1. Changing logout path</a></li>
</ul>
</li>
<li><a class="reference internal" href="#customising-response-when-logout-is-successful">9.2.3.5. Customising response when logout is successful</a><ul>
<li><a class="reference internal" href="#id6">9.2.3.5.1. Changing transition destination</a></li>
<li><a class="reference internal" href="#applying-logoutsuccesshandler">9.2.3.5.2. Applying LogoutSuccessHandler</a></li>
</ul>
</li>
<li><a class="reference internal" href="#customising-error-message">9.2.3.6. Customising error message</a><ul>
<li><a class="reference internal" href="#message-during-system-error">9.2.3.6.1. Message during system error</a></li>
</ul>
</li>
<li><a class="reference internal" href="#input-check-at-the-time-of-authentication">9.2.3.7. Input check at the time of authentication</a><ul>
<li><a class="reference internal" href="#input-check-using-bean-validation">9.2.3.7.1. Input check using Bean Validation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#expansion-of-authentication-process">9.2.3.8. Expansion of authentication process</a><ul>
<li><a class="reference internal" href="#creating-an-implementation-class-of-authentication-interface">9.2.3.8.1. Creating an implementation class of Authentication interface</a></li>
<li><a class="reference internal" href="#creating-an-implementation-class-of-authenticationprovider-interface">9.2.3.8.2. Creating an implementation class of AuthenticationProvider interface</a></li>
<li><a class="reference internal" href="#creating-authentication-filter">9.2.3.8.3. Creating Authentication Filter</a></li>
<li><a class="reference internal" href="#modifying-login-form">9.2.3.8.4. Modifying login form</a></li>
<li><a class="reference internal" href="#applying-expanded-authentication-process">9.2.3.8.5. Applying expanded authentication process</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-passwordencoder-of-deprecated-package">9.2.3.9. Using PasswordEncoder of deprecated package</a><ul>
<li><a class="reference internal" href="#using-shapasswordencoder">9.2.3.9.1. Using ShaPasswordEncoder</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#appendix">9.2.4. Appendix</a><ul>
<li><a class="reference internal" href="#receive-a-request-by-spring-mvc-and-display-login-form">9.2.4.1. Receive a request by Spring MVC and display login form</a></li>
<li><a class="reference internal" href="#using-remember-me-authentication">9.2.4.2. Using Remember Me authentication</a></li>
</ul>
</li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="SpringSecurity.html"
                        title="previous chapter">9.1. Spring Security Overview</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Authorization.html"
                        title="next chapter">9.3. Authorization</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/Security/Authentication.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="authentication">
<span id="springsecurityauthentication"></span><h1>9.2. Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of contents</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id22">Overview</a><ul>
<li><a class="reference internal" href="#authentication-process-architecture" id="id23">Authentication process architecture</a><ul>
<li><a class="reference internal" href="#authentication-filter" id="id24">Authentication Filter</a></li>
<li><a class="reference internal" href="#authenticationmanager" id="id25">AuthenticationManager</a></li>
<li><a class="reference internal" href="#authenticationprovider" id="id26">AuthenticationProvider</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use" id="id27">How to use</a><ul>
<li><a class="reference internal" href="#form-authentication" id="id28">Form authentication</a><ul>
<li><a class="reference internal" href="#applying-form-authentication" id="id29">Applying form authentication</a></li>
<li><a class="reference internal" href="#default-operation" id="id30">Default operation</a></li>
<li><a class="reference internal" href="#creating-login-form" id="id31">Creating login form</a></li>
</ul>
</li>
<li><a class="reference internal" href="#response-when-authentication-is-successful" id="id32">Response when authentication is successful</a><ul>
<li><a class="reference internal" href="#id1" id="id33">Default operation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#response-when-authentication-fails" id="id34">Response when authentication fails</a><ul>
<li><a class="reference internal" href="#id2" id="id35">Default operation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#db-authentication" id="id36">DB authentication</a><ul>
<li><a class="reference internal" href="#creating-userdetails" id="id37">Creating UserDetails</a></li>
<li><a class="reference internal" href="#creating-userdetailsservice" id="id38">Creating UserDetailsService</a></li>
<li><a class="reference internal" href="#applying-db-authentication" id="id39">Applying DB authentication</a></li>
</ul>
</li>
<li><a class="reference internal" href="#password-hashing" id="id40">Password hashing</a><ul>
<li><a class="reference internal" href="#bcryptpasswordencoder" id="id41">BCryptPasswordEncoder</a></li>
</ul>
</li>
<li><a class="reference internal" href="#handling-authentication-event" id="id42">Handling authentication event</a><ul>
<li><a class="reference internal" href="#authentication-successful-event" id="id43">Authentication successful event</a></li>
<li><a class="reference internal" href="#authentication-failure-event" id="id44">Authentication failure event</a></li>
<li><a class="reference internal" href="#creating-event-listener" id="id45">Creating event listener</a></li>
</ul>
</li>
<li><a class="reference internal" href="#logout" id="id46">Logout</a><ul>
<li><a class="reference internal" href="#applying-logout-process" id="id47">Applying logout process</a></li>
<li><a class="reference internal" href="#id3" id="id48">Default operation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#response-when-logout-is-successful" id="id49">Response when logout is successful</a><ul>
<li><a class="reference internal" href="#id4" id="id50">Default operation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#accessing-authentication-information" id="id51">Accessing authentication information</a><ul>
<li><a class="reference internal" href="#access-from-java" id="id52">Access from Java</a></li>
<li><a class="reference internal" href="#access-from-jsp" id="id53">Access from JSP</a></li>
</ul>
</li>
<li><a class="reference internal" href="#coordination-between-authentication-process-and-spring-mvc" id="id54">Coordination between authentication process and Spring MVC</a><ul>
<li><a class="reference internal" href="#id5" id="id55">Accessing authentication information</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-extend" id="id56">How to extend</a><ul>
<li><a class="reference internal" href="#customizing-form-authentication" id="id57">Customizing form authentication</a><ul>
<li><a class="reference internal" href="#changing-authentication-path" id="id58">Changing authentication path</a></li>
<li><a class="reference internal" href="#change-request-parameter-name-which-sends-credentials" id="id59">Change request parameter name which sends credentials</a></li>
</ul>
</li>
<li><a class="reference internal" href="#customising-response-when-authentication-is-successful" id="id60">Customising response when authentication is successful</a><ul>
<li><a class="reference internal" href="#changing-default-transition-destination" id="id61">Changing default transition destination</a></li>
<li><a class="reference internal" href="#fixing-transition-destination" id="id62">Fixing transition destination</a></li>
<li><a class="reference internal" href="#applying-authenticationsuccesshandler" id="id63">Applying AuthenticationSuccessHandler</a></li>
</ul>
</li>
<li><a class="reference internal" href="#customising-response-at-the-time-of-authentication-failure" id="id64">Customising response at the time of authentication failure</a><ul>
<li><a class="reference internal" href="#changing-transition-destination" id="id65">Changing transition destination</a></li>
<li><a class="reference internal" href="#applying-authenticationfailurehandler" id="id66">Applying AuthenticationFailureHandler</a></li>
</ul>
</li>
<li><a class="reference internal" href="#customising-logout-process" id="id67">Customising logout process</a><ul>
<li><a class="reference internal" href="#changing-logout-path" id="id68">Changing logout path</a></li>
</ul>
</li>
<li><a class="reference internal" href="#customising-response-when-logout-is-successful" id="id69">Customising response when logout is successful</a><ul>
<li><a class="reference internal" href="#id6" id="id70">Changing transition destination</a></li>
<li><a class="reference internal" href="#applying-logoutsuccesshandler" id="id71">Applying LogoutSuccessHandler</a></li>
</ul>
</li>
<li><a class="reference internal" href="#customising-error-message" id="id72">Customising error message</a><ul>
<li><a class="reference internal" href="#message-during-system-error" id="id73">Message during system error</a></li>
</ul>
</li>
<li><a class="reference internal" href="#input-check-at-the-time-of-authentication" id="id74">Input check at the time of authentication</a><ul>
<li><a class="reference internal" href="#input-check-using-bean-validation" id="id75">Input check using Bean Validation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#expansion-of-authentication-process" id="id76">Expansion of authentication process</a><ul>
<li><a class="reference internal" href="#creating-an-implementation-class-of-authentication-interface" id="id77">Creating an implementation class of Authentication interface</a></li>
<li><a class="reference internal" href="#creating-an-implementation-class-of-authenticationprovider-interface" id="id78">Creating an implementation class of AuthenticationProvider interface</a></li>
<li><a class="reference internal" href="#creating-authentication-filter" id="id79">Creating Authentication Filter</a></li>
<li><a class="reference internal" href="#modifying-login-form" id="id80">Modifying login form</a></li>
<li><a class="reference internal" href="#applying-expanded-authentication-process" id="id81">Applying expanded authentication process</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-passwordencoder-of-deprecated-package" id="id82">Using PasswordEncoder of deprecated package</a><ul>
<li><a class="reference internal" href="#using-shapasswordencoder" id="id83">Using ShaPasswordEncoder</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#appendix" id="id84">Appendix</a><ul>
<li><a class="reference internal" href="#receive-a-request-by-spring-mvc-and-display-login-form" id="id85">Receive a request by Spring MVC and display login form</a></li>
<li><a class="reference internal" href="#using-remember-me-authentication" id="id86">Using Remember Me authentication</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<span id="springsecurityauthenticationoverview"></span><h2><a class="toc-backref" href="#id22">9.2.1. Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This chapter explains about Authentication function provided by Spring Security.</p>
<p>Authentication process checks the validity of user using the application.</p>
<p>The standard method to check the validity of a user is to register the users who can use the application in a data store and
and verify the authentication information (user name, password etc) input by the user.
Although a relational database is commonly used in a data store wherein user information is registered, directory service or external system etc are also used.</p>
<p>Further, there are several methods which ask a user to input authentication information.
Although a method wherein input form of HTML or a method wherein an authentication method of HTTP standard defined in RFC (Basic authentication or Digest authentication etc) are used in general,
the methods like OpenID authentication or single sign-on authentication are also used.</p>
<p>This section introduces an implementation example wherein the authentication is done by verifying authentication information input in HTML input form and user information stored in the relational database,
and explains how to use authentication function of Spring Security.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="authentication-process-architecture">
<h3><a class="toc-backref" href="#id23">9.2.1.1. Authentication process architecture</a><a class="headerlink" href="#authentication-process-architecture" title="Permalink to this headline">¶</a></h3>
<p>Spring Security performs authentication with the following flow.</p>
<div class="figure" id="id7">
<a class="reference internal image-reference" href="../_images/AuthenticationArchitecture.png"><img alt="../_images/AuthenticationArchitecture.png" src="../_images/AuthenticationArchitecture.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Authentication process architecture</strong></span></p>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Client specifies credentials (user name and password) for the path wherein authentication is performed and sends a request.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Authentication Filter fetches credentials from the request and calls authentication process of <code class="docutils literal"><span class="pre">AuthenticationManager</span></code> class.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">ProviderManager</span></code> (Implementation class of <code class="docutils literal"><span class="pre">AuthenticationManager</span></code> used by default) delegates actual authentication process to implementation class of <code class="docutils literal"><span class="pre">AuthenticationProvider</span></code> interface.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="authentication-filter">
<span id="springsecurityauthenticationfilter"></span><h4><a class="toc-backref" href="#id24">9.2.1.1.1. Authentication Filter</a><a class="headerlink" href="#authentication-filter" title="Permalink to this headline">¶</a></h4>
<p>Authentication Filter is a servlet filter which offers implementation for the authentication method.
Primary authentication methods supported by Spring Security are as given below..</p>
<table border="1" class="colwidths-given docutils" id="id8">
<caption><span class="caption-text"><strong>Main Authentication Filter offered by Spring Security</strong></span><a class="headerlink" href="#id8" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Class Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">UsernamePasswordAuthenticationFilter</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch credentials from HTTP request parameter in servlet filter class for form authentication.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">BasicAuthenticationFilter</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch credentials from authentication header of HTTP request in servlet filter class for Basic authentication.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">DigestAuthenticationFilter</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch credentials from authentication header of HTTP request in servlet filter class for Digest authentication.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">RememberMeAuthenticationFilter</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch credentials from Cookies of HTTP request in servlet filter class for Remember Me authentication.</div>
<div class="line">If Remember Me authentication is enabled, user stays logged in even if browser is closed and a session timeout has occurred.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>These servlet filters are one of the Authentication filters introduced in <a class="reference internal" href="SpringSecurity.html#springsecurityprocess"><span class="std std-ref">Framework processing</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When an authentication process not supported by Spring Security must be adopted,
it must be incorporated in Spring Security after creating a <code class="docutils literal"><span class="pre">Authentication</span> <span class="pre">Filter</span></code> for adopting this authentication method.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="authenticationmanager">
<h4><a class="toc-backref" href="#id25">9.2.1.1.2. AuthenticationManager</a><a class="headerlink" href="#authenticationmanager" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">AuthenticationManager</span></code> is an interface for implementing the authentication process.
In default implementation (<code class="docutils literal"><span class="pre">ProviderManager</span></code>) offered by Spring Security, a system is adopted wherein
actual authentication process is delegated to <code class="docutils literal"><span class="pre">AuthenticationProvider</span></code> and process results of authentication process performed by <code class="docutils literal"><span class="pre">AuthenticationProvider</span></code> are handled.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="authenticationprovider">
<h4><a class="toc-backref" href="#id26">9.2.1.1.3. AuthenticationProvider</a><a class="headerlink" href="#authenticationprovider" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">AuthenticationProvider</span></code> is an interface which provides implementation of authentication process.
A key <code class="docutils literal"><span class="pre">AuthenticationProvider</span></code> implementation class offered by Spring Security is as given below.</p>
<table border="1" class="colwidths-given docutils" id="id9">
<caption><span class="caption-text"><strong>A key AuthenticationProvider offered by Spring Security</strong></span><a class="headerlink" href="#id9" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Class Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">DaoAuthenticationProvider</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implementation class which performs authentication process by checking user credentials and user status registered in the data store.</div>
<div class="line">Fetch credentials and user status required for checking, from the class which implements <code class="docutils literal"><span class="pre">UserDetails</span></code> interface.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When an authentication process not offered by Spring Security must be adopted,
it must be incorporated in Spring Security after creating an <code class="docutils literal"><span class="pre">AuthenticationProvider</span></code> for implementing authentication process.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="how-to-use">
<span id="howtouse-springsecurity"></span><h2><a class="toc-backref" href="#id27">9.2.2. How to use</a><a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h2>
<p>Bean definition example and implementation method required for using authentication function is explained.</p>
<p>This section, as explained in <a class="reference internal" href="#springsecurityauthenticationoverview"><span class="std std-ref">Overview</span></a>,
explains a method to carry out authentication process by verifying credentials input in HTML input form and user information stored in the relational database.</p>
<div class="section" id="form-authentication">
<span id="form-login"></span><h3><a class="toc-backref" href="#id28">9.2.2.1. Form authentication</a><a class="headerlink" href="#form-authentication" title="Permalink to this headline">¶</a></h3>
<p>Spring Security performs form authentication as per the flow given below.</p>
<div class="figure" id="id10">
<a class="reference internal image-reference" href="../_images/AuthenticationForm.png"><img alt="../_images/AuthenticationForm.png" src="../_images/AuthenticationForm.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Form authentication system</strong></span></p>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Client sends credentials (user name and password) as request parameters for the path which carries out form authentication.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">UsernamePasswordAuthenticationFilter</span></code> class fetches credentials from request parameter and calls authentication process of <code class="docutils literal"><span class="pre">AuthenticationManager</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">UsernamePasswordAuthenticationFilter</span></code> class handles the authentication results returned from <code class="docutils literal"><span class="pre">AuthenticationManager</span></code>.</div>
<div class="line">Call <code class="docutils literal"><span class="pre">AuthenticationSuccessHandler</span></code> method when the authentication is successful, call <code class="docutils literal"><span class="pre">AuthenticationFailureHandler</span></code> method when a failure occurs in the authentication and perform screen transition.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="applying-form-authentication">
<span id="form-login-usage"></span><h4><a class="toc-backref" href="#id29">9.2.2.1.1. Applying form authentication</a><a class="headerlink" href="#applying-form-authentication" title="Permalink to this headline">¶</a></h4>
<p>Bean is defined as below when form authentication is used.</p>
<ul class="simple">
<li>Definition example of spring-security.xml</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;sec:http&gt;</span>
    <span class="nt">&lt;sec:form-login</span> <span class="nt">/&gt;</span>    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/sec:http&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Form authentication is enabled when <code class="docutils literal"><span class="pre">&lt;sec:form-login&gt;</span></code> tag is defined.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>About auto-config attribute</strong></p>
<p>An <code class="docutils literal"><span class="pre">auto-config</span></code> attribute which specifies whether the settings for form authentication (<code class="docutils literal"><span class="pre">&lt;sec:form-login&gt;</span></code> tag), Basic authentication (<code class="docutils literal"><span class="pre">&lt;sec:http-basic&gt;</span></code> tag) and logout (<code class="docutils literal"><span class="pre">&lt;sec:logout&gt;</span></code> tag) are performed automatically, is provided in <code class="docutils literal"><span class="pre">&lt;sec:http&gt;</span></code>.
Default value is <code class="docutils literal"><span class="pre">false</span></code> (not set automatically) and it is recommended to use default value even in the reference document of Spring Security.</p>
<p>Even in this guideline, a style wherein a tag is specified explicitly is recommended.</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Element name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">&lt;form-login&gt;</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Security Filter(<code class="docutils literal"><span class="pre">UsernamePasswordAuthenticationFilter</span></code>) which performs form authentication process is applied.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">&lt;http-basic&gt;</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Security Filter(<code class="docutils literal"><span class="pre">BasicAuthenticationFilter</span></code>) which performs Basic authentication in conformance with RFC1945 is applied.</div>
<div class="line">For detailed usage method, refer <a class="reference external" href="http://docs.spring.io/spring-security/site/docs/4.2.4.RELEASE/apidocs/org/springframework/security/web/authentication/www/BasicAuthenticationFilter.html">JavaDoc of BasicAuthenticationFilter</a>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">&lt;logout&gt;</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Security Filter(<code class="docutils literal"><span class="pre">LogoutFilter</span></code>) which performs logout process is applied.</div>
<div class="line">For details of logout process, refer “<a class="reference internal" href="#springsecurityauthenticationlogout"><span class="std std-ref">Logout</span></a>”.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p class="last">Further note that when <code class="docutils literal"><span class="pre">auto-config</span></code> is not defined, form authentication (<code class="docutils literal"><span class="pre">&lt;sec:form-login&gt;</span></code> tag) or Basic authentication (<code class="docutils literal"><span class="pre">&lt;sec:http-basic&gt;</span></code> tag) must be defined.
This is required to meet the specification of Spring Security wherein a Bean must be defined for one or more Authentication Filters in a single <code class="docutils literal"><span class="pre">SecurityFilterChain</span></code> (<code class="docutils literal"><span class="pre">&lt;sec:http&gt;</span></code>).</p>
</div>
</div>
<div class="section" id="default-operation">
<span id="form-login-default-operation"></span><h4><a class="toc-backref" href="#id30">9.2.2.1.2. Default operation</a><a class="headerlink" href="#default-operation" title="Permalink to this headline">¶</a></h4>
<p>If user account is accessed for <code class="docutils literal"><span class="pre">/login</span></code> using GET method in the default operation of Spring Security, a default login form provided by Spring Security is displayed
and when login button is clicked, <code class="docutils literal"><span class="pre">/login</span></code> is accessed by POST method and authentication process is carried out.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="creating-login-form">
<span id="springsecurityauthenticationloginform"></span><h4><a class="toc-backref" href="#id31">9.2.2.1.3. Creating login form</a><a class="headerlink" href="#creating-login-form" title="Permalink to this headline">¶</a></h4>
<p>Although a login form for form authentication is provided in Spring Security as a default, it is rarely used as it is.
Below, a method wherein an auto-created login form is applied in Spring Security is explained.</p>
<p>At first, a JSP for displaying a login form is created.
An implementation example wherein a login form is displayed after receiving a request in Spring MVC is given below.</p>
<ul class="simple">
<li>How to create a JSP for displaying a login form (xxx-web/src/main/webapp/WEB-INF/views/login/loginForm.jsp)</li>
</ul>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html;charset=UTF-8&quot;</span> <span class="n">pageEncoding</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span> <span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;c&quot;</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> <span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;sec&quot;</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/security/tags&quot;</span> <span class="k">%&gt;</span>
<span class="k">&lt;%-</span><span class="o">-</span> <span class="n">omitted</span> <span class="o">--</span><span class="k">%&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;wrapper&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h3&gt;</span>Login Screen<span class="nt">&lt;/h3&gt;</span>
    <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">--</span><span class="k">%&gt;</span>
    <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">&quot;${param.containsKey(&#39;error&#39;)}&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t:messagesPanel</span> <span class="na">messagesType=</span><span class="s">&quot;error&quot;</span>
            <span class="na">messagesAttributeName=</span><span class="s">&quot;SPRING_SECURITY_LAST_EXCEPTION&quot;</span><span class="nt">/&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="o">--</span><span class="k">%&gt;</span>
    <span class="nt">&lt;/c:if&gt;</span>
    <span class="nt">&lt;form:form</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/login&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="o">--</span><span class="k">%&gt;</span>
        <span class="nt">&lt;table&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;</span>User Name<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;username&quot;</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;</span>Password<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">id=</span><span class="s">&quot;password&quot;</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;</span><span class="ni">&amp;nbsp;</span><span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;&lt;button&gt;</span>Login<span class="nt">&lt;/button&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/table&gt;</span>
    <span class="nt">&lt;/form:form&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="k">&lt;%-</span><span class="o">-</span> <span class="n">omitted</span> <span class="o">--</span><span class="k">%&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">An area to display authentication error.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Output an exception message which is output at the time of authentication error.</div>
<div class="line">It is recommended to output by using <code class="docutils literal"><span class="pre">&lt;t:messagesPanel&gt;</span></code> tag provided by a common library.</div>
<div class="line">For how to use <code class="docutils literal"><span class="pre">&lt;t:messagesPanel&gt;</span></code> tag, refer “<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/MessageManagement.html"><span class="doc">Message Management</span></a>”.</div>
<div class="line">Note that, when an authentication error occurs, exception object is stored in the session or request scope with the attribute name <code class="docutils literal"><span class="pre">SPRING_SECURITY_LAST_EXCEPTION</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Login form to enter user name and password.</div>
<div class="line">Send user name and password to request parameters <code class="docutils literal"><span class="pre">username</span></code> and <code class="docutils literal"><span class="pre">password</span></code> respectively.</div>
<div class="line">Also note that token value for CSRF measures is sent to request parameter by using <code class="docutils literal"><span class="pre">&lt;form:form&gt;</span></code>.</div>
<div class="line">CSRF measures are explained in “<a class="reference internal" href="CSRF.html#springsecuritycsrf"><span class="std std-ref">CSRF Countermeasures</span></a>”.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Next, login form thus created is applied to Spring Security.</p>
<ul class="simple">
<li>Definition example of spring-security.xml</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;sec:http&gt;</span>
    <span class="nt">&lt;sec:form-login</span>
        <span class="na">login-page=</span><span class="s">&quot;/login/loginForm&quot;</span>
        <span class="na">login-processing-url=</span><span class="s">&quot;/login&quot;</span>  <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1)(2) --&gt;</span>
    <span class="nt">&lt;sec:intercept-url</span> <span class="na">pattern=</span><span class="s">&quot;/login/**&quot;</span> <span class="na">access=</span><span class="s">&quot;permitAll&quot;</span><span class="nt">/&gt;</span>  <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;sec:intercept-url</span> <span class="na">pattern=</span><span class="s">&quot;/**&quot;</span> <span class="na">access=</span><span class="s">&quot;isAuthenticated()&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- (4) --&gt;</span>
<span class="nt">&lt;/sec:http&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify path to display login form in <code class="docutils literal"><span class="pre">login-page</span></code> attribute.</div>
<div class="line">When an anonymous user accesses a Web resource for which authentication is required, the user is redirected to a path specified in the attribute and a login form is displayed.</div>
<div class="line">Here, a request is received by Spring MVC and a login form is displayed.</div>
<div class="line">For details, refer “<a class="reference internal" href="#spring-security-authentication-mvc"><span class="std std-ref">Receive a request by Spring MVC and display login form</span></a>”.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify path for performing authentication process in <code class="docutils literal"><span class="pre">login-processing-url</span></code> attribute.</div>
<div class="line">Although default path is also <code class="docutils literal"><span class="pre">/login</span></code>, it should be explicitly specified.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Assign the rights enabling access to all users for the location under <code class="docutils literal"><span class="pre">/login</span></code> path where login form is stored.</div>
<div class="line">For how to specify access policy for web resource, refer “<a class="reference internal" href="Authorization.html#springsecurityauthorization"><span class="std std-ref">Authorization</span></a>”.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Assign the access rights for web resource handled by the application.</div>
<div class="line">In the example above, only authenticated users are granted the rights to access location under root path of web application.</div>
<div class="line">For how to specify access policy for web resource, refer “<a class="reference internal" href="Authorization.html#springsecurityauthorization"><span class="std std-ref">Authorization</span></a>”.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Changes in Spring Security 4.0</strong></p>
<p>Default values of following configuration are changed from Spring Security version 4.0</p>
<ul class="last simple">
<li>username-parameter</li>
<li>password-parameter</li>
<li>login-processing-url</li>
<li>authentication-failure-url</li>
</ul>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="response-when-authentication-is-successful">
<span id="springsecurityauthenticationscreenflowonsuccess"></span><h3><a class="toc-backref" href="#id32">9.2.2.2. Response when authentication is successful</a><a class="headerlink" href="#response-when-authentication-is-successful" title="Permalink to this headline">¶</a></h3>
<p>Spring Security offers <code class="docutils literal"><span class="pre">AuthenticationSuccessHandler</span></code> interface and implementation class as the components
to control the response when the authentication is successful.</p>
<table border="1" class="colwidths-given docutils" id="id11">
<caption><span class="caption-text"><strong>Implementation class of AuthenticationSuccessHandler</strong></span><a class="headerlink" href="#id11" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Implementation class</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">SavedRequestAwareAuthenticationSuccessHandler</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implementation class that redirects to a URL which the user have attempted to access prior to authentication.</div>
<div class="line"><strong>Implementation class used by default.</strong></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">SimpleUrlAuthenticationSuccessHandler</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implementation class which redirects or forwards to <code class="docutils literal"><span class="pre">defaultTargetUrl</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="section" id="id1">
<h4><a class="toc-backref" href="#id33">9.2.2.2.1. Default operation</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>In the default operation of Spring Security, the request that was denied prior to authentication is saved in HTTP session
and when the authentication is successful, the request which was denied access is restored and redirected.
Page is displayed if the authenticated user has the access rights for redirected page, authentication error occurs if the user does not have the access rights.
<code class="docutils literal"><span class="pre">SavedRequestAwareAuthenticationSuccessHandler</span></code> class is used to carry out this operation.</p>
<p>Since the transition destination after explicitly displaying login form and performing authentication is the root path of web application (“<code class="docutils literal"><span class="pre">/</span></code>” ),
as per default configuration of Spring Security, user is redirected to the root path of Web application when the authentication is successful.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="response-when-authentication-fails">
<span id="springsecurityauthenticationscreenflowonfailure"></span><h3><a class="toc-backref" href="#id34">9.2.2.3. Response when authentication fails</a><a class="headerlink" href="#response-when-authentication-fails" title="Permalink to this headline">¶</a></h3>
<p>Spring Security offers <code class="docutils literal"><span class="pre">AuthenticationFailureHandler</span></code> interface and implementation class as the components
to control the response when the authentication fails.</p>
<table border="1" class="colwidths-given docutils" id="id12">
<caption><span class="caption-text"><strong>Implementation class of AuthenticationFailureHandler</strong></span><a class="headerlink" href="#id12" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Implementation class</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">SimpleUrlAuthenticationFailureHandler</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implementation class which redirects or forwards to a specified path (<code class="docutils literal"><span class="pre">defaultFailureUrl</span></code>).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">ExceptionMappingAuthenticationFailureHandler</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implementation class which can map authentication exception and URL for transition.</div>
<div class="line">Since the exception class generated by Spring Security for each error cause vary, the transition destination can be changed for each error type if this implementation class is used.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">DelegatingAuthenticationFailureHandler</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implementation class which can map authentication exception and <code class="docutils literal"><span class="pre">AuthenticationFailureHandler</span></code>.</div>
<div class="line">Although it resembles <code class="docutils literal"><span class="pre">ExceptionMappingAuthenticationFailureHandler</span></code>, a flexible behaviour can be supported by specifying <code class="docutils literal"><span class="pre">AuthenticationFailureHandler</span></code> for each authentication exception.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="section" id="id2">
<h4><a class="toc-backref" href="#id35">9.2.2.3.1. Default operation</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>In the default operation of Spring Security, user is redirected to a URL assigned with a query parameter <code class="docutils literal"><span class="pre">error</span></code>in a path which displays login form.</p>
<p>As an example, when the path to display login form is <code class="docutils literal"><span class="pre">/login</span></code>, the user is redirected to <code class="docutils literal"><span class="pre">/login?error</span></code>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="db-authentication">
<h3><a class="toc-backref" href="#id36">9.2.2.4. DB authentication</a><a class="headerlink" href="#db-authentication" title="Permalink to this headline">¶</a></h3>
<p>Spring Security performs DB authentication in the flow given below.</p>
<div class="figure" id="id13">
<a class="reference internal image-reference" href="../_images/AuthenticationDatabase.png"><img alt="../_images/AuthenticationDatabase.png" src="../_images/AuthenticationDatabase.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>DB authentication system</strong></span></p>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Spring Security receives authentication request from the client and calls authentication process of <code class="docutils literal"><span class="pre">DaoAuthenticationProvider</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">DaoAuthenticationProvider</span></code> calls user information fetch process of <code class="docutils literal"><span class="pre">UserDetailsService</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implementation class of <code class="docutils literal"><span class="pre">UserDetailsService</span></code> fetches user information from data store.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implementation class of <code class="docutils literal"><span class="pre">UserDetailsService</span></code> generates <code class="docutils literal"><span class="pre">UserDetails</span></code> from the user information fetched from data store.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">DaoAuthenticationProvider</span></code> verifies <code class="docutils literal"><span class="pre">UserDetails</span></code> returned from <code class="docutils literal"><span class="pre">UserDetailsService</span></code> and authentication information specified by client, and checks validity of user specified by client.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>DB authentication offered by Spring Security</strong></p>
<p>Spring Security offers an implementation class to fetch user information from relational database through JDBC.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">org.springframework.security.core.userdetails.User</span></code> (Implementation class of <code class="docutils literal"><span class="pre">UserDetails</span></code>)</li>
<li><code class="docutils literal"><span class="pre">org.springframework.security.core.userdetails.jdbc.JdbcDaoImpl</span></code>  (Implementation class of <code class="docutils literal"><span class="pre">UserDetailsService</span></code>)</li>
</ul>
<p class="last">Since these implementation classes only perform authentication processes of minimum level (password verification, determination of user validity), they are used as it is very rarely.
Hence, this guideline explains how to create implementation classes of <code class="docutils literal"><span class="pre">UserDetails</span></code> and <code class="docutils literal"><span class="pre">UserDetailsService</span></code>.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="creating-userdetails">
<h4><a class="toc-backref" href="#id37">9.2.2.4.1. Creating UserDetails</a><a class="headerlink" href="#creating-userdetails" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">UserDetails</span></code> is an interface which provides credentials (user name and password) and user status necessary in the authentication process and defines following methods.
When <code class="docutils literal"><span class="pre">DaoAuthenticationProvider</span></code> is used as <code class="docutils literal"><span class="pre">AuthenticationProvider</span></code>, implementation class of <code class="docutils literal"><span class="pre">UserDetails</span></code> is created in accordance with the requirements of application.</p>
<p><em>UserDetails interface</em></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserDetails</span> <span class="kd">extends</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="n">String</span> <span class="nf">getUsername</span><span class="o">();</span> <span class="c1">// (1)</span>
    <span class="n">String</span> <span class="nf">getPassword</span><span class="o">();</span> <span class="c1">// (2)</span>
    <span class="kt">boolean</span> <span class="nf">isEnabled</span><span class="o">();</span> <span class="c1">// (3)</span>
    <span class="kt">boolean</span> <span class="nf">isAccountNonLocked</span><span class="o">();</span> <span class="c1">// (4)</span>
    <span class="kt">boolean</span> <span class="nf">isAccountNonExpired</span><span class="o">();</span> <span class="c1">// (5)</span>
    <span class="kt">boolean</span> <span class="nf">isCredentialsNonExpired</span><span class="o">();</span> <span class="c1">// (6)</span>
    <span class="n">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">GrantedAuthority</span><span class="o">&gt;</span> <span class="nf">getAuthorities</span><span class="o">();</span> <span class="c1">// (7)</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="25%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Method name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">getUsername</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Return user name.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">getPassword</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Return registered password.</div>
<div class="line">When the password returned by this method and the password specified by the client do not match, <code class="docutils literal"><span class="pre">DaoAuthenticationProvider</span></code> throws <code class="docutils literal"><span class="pre">BadCredentialsException</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">isEnabled</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Determine whether the user is valid. Return <code class="docutils literal"><span class="pre">true</span></code> in case of valid user.</div>
<div class="line">When the user is invalid, <code class="docutils literal"><span class="pre">DaoAuthenticationProvider</span></code> throws <code class="docutils literal"><span class="pre">DisabledException</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">isAccountNonLocked</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Determine locked status of the account. When the account is not locked, return <code class="docutils literal"><span class="pre">true</span></code>.</div>
<div class="line">When the account is locked, <code class="docutils literal"><span class="pre">DaoAuthenticationProvider</span></code> throws <code class="docutils literal"><span class="pre">LockedException</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">isAccountNonExpired</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Determine expiry status of the account. Return <code class="docutils literal"><span class="pre">true</span></code> when the account is not expired.</div>
<div class="line">When the account is expired, <code class="docutils literal"><span class="pre">DaoAuthenticationProvider</span></code> throws <code class="docutils literal"><span class="pre">AccountExpiredException</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">isCredentialsNonExpired</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Determine expiry status of credentials. Return <code class="docutils literal"><span class="pre">true</span></code> when the credentials are not expired.</div>
<div class="line">When the credentials are expired, <code class="docutils literal"><span class="pre">DaoAuthenticationProvider</span></code> throws <code class="docutils literal"><span class="pre">CredentialsExpiredException</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">getAuthorities</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Return list of rights assigned to the user.</div>
<div class="line">This method is used in the authorization process.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Changing transition destination based on authentication exception</strong></p>
<p>When the user wants to change the screen transition for each exception thrown by <code class="docutils literal"><span class="pre">DaoAuthenticationProvider</span></code>,
<code class="docutils literal"><span class="pre">ExceptionMappingAuthenticationFailureHandler</span></code> must be used as <code class="docutils literal"><span class="pre">AuthenticationFailureHandler</span></code>.</p>
<p>As an example, when user wants to transit to password change screen in case of password expiry for the user, screen transition can be changed
by handling <code class="docutils literal"><span class="pre">CredentialsExpiredException</span></code> by using <code class="docutils literal"><span class="pre">ExceptionMappingAuthenticationFailureHandler</span></code>.</p>
<p class="last">For details, refer <a class="reference internal" href="#springsecurityauthenticationcustomizingscreenflowonfailure"><span class="std std-ref">Customising response at the time of authentication failure</span></a>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Credentials provided by Spring Security</strong></p>
<p class="last">Although Spring Security provides an implementation class (<code class="docutils literal"><span class="pre">org.springframework.security.core.userdetails.User</span></code>) for retaining credentials (user name and password) and user status,
it can store only the information required for the authentication process.
Since the information of the user (name of the user etc) which is not used in the authentication process is frequently required in the general applications, <code class="docutils literal"><span class="pre">User</span></code> class can rarely be used as it is.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Here, an implementation class of <code class="docutils literal"><span class="pre">UserDetails</span></code> which retains account information is created.
This example can also be implemented by inheriting <code class="docutils literal"><span class="pre">User</span></code>. However, here an example wherein <code class="docutils literal"><span class="pre">UserDetails</span></code> is implemented is introduced.</p>
<ul class="simple">
<li>How to create implementation class of UserDetails</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccountUserDetails</span> <span class="kd">implements</span> <span class="n">UserDetails</span> <span class="o">{</span> <span class="c1">// (1)</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Account</span> <span class="n">account</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">GrantedAuthority</span><span class="o">&gt;</span> <span class="n">authorities</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">AccountUserDetails</span><span class="o">(</span>
        <span class="n">Account</span> <span class="n">account</span><span class="o">,</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">GrantedAuthority</span><span class="o">&gt;</span> <span class="n">authorities</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// (2)</span>
        <span class="k">this</span><span class="o">.</span><span class="na">account</span> <span class="o">=</span> <span class="n">account</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">authorities</span> <span class="o">=</span> <span class="n">authorities</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (3)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getPassword</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">account</span><span class="o">.</span><span class="na">getPassword</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getUsername</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">account</span><span class="o">.</span><span class="na">getUsername</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isEnabled</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">account</span><span class="o">.</span><span class="na">isEnabled</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">GrantedAuthority</span><span class="o">&gt;</span> <span class="nf">getAuthorities</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">authorities</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (4)</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isAccountNonExpired</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isAccountNonLocked</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isCredentialsNonExpired</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (5)</span>
    <span class="kd">public</span> <span class="n">Account</span> <span class="nf">getAccount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">account</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create a class which implements <code class="docutils literal"><span class="pre">UserDetails</span></code> interface.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Retain user information and rights information in the property.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implement method defined in <code class="docutils literal"><span class="pre">UserDetails</span></code> interface.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Although the example of this sections does not implement check for, “Account locking”, “Account expiry” and “Credentials expiry”, these must be checked in accordance with the requirements.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Provide a getter method to enable access to account information in the process after successful completion of authentication.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Spring Security provides <code class="docutils literal"><span class="pre">User</span></code> class as an implementation class of <code class="docutils literal"><span class="pre">UserDetails</span></code>.
When you inherit a <code class="docutils literal"><span class="pre">User</span></code> class, credentials and user status can be easily retained.</p>
<ul class="simple">
<li>How to create UserDetails implementation class which inherits User class</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccountUserDetails</span> <span class="kd">extends</span> <span class="n">User</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Account</span> <span class="n">account</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">AccountUserDetails</span><span class="o">(</span><span class="n">Account</span> <span class="n">account</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">accountNonExpired</span><span class="o">,</span>
            <span class="kt">boolean</span> <span class="n">credentialsNonExpired</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">accountNonLocked</span><span class="o">,</span>
            <span class="n">Collection</span><span class="o">&lt;</span><span class="n">GrantedAuthority</span><span class="o">&gt;</span> <span class="n">authorities</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">account</span><span class="o">.</span><span class="na">getUsername</span><span class="o">(),</span> <span class="n">account</span><span class="o">.</span><span class="na">getPassword</span><span class="o">(),</span>
                <span class="n">account</span><span class="o">.</span><span class="na">isEnabled</span><span class="o">(),</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="n">authorities</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">account</span> <span class="o">=</span> <span class="n">account</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Account</span> <span class="nf">getAccount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">account</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="creating-userdetailsservice">
<span id="springsecurityauthenticationuserdetailsservice"></span><h4><a class="toc-backref" href="#id38">9.2.2.4.2. Creating UserDetailsService</a><a class="headerlink" href="#creating-userdetailsservice" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">UserDetailsService</span></code> is an interface to fetch credentials and user status required for authentication process
from data store and defines following methods.
When <code class="docutils literal"><span class="pre">DaoAuthenticationProvider</span></code> is used as <code class="docutils literal"><span class="pre">AuthenticationProvider</span></code>,
implementation class of <code class="docutils literal"><span class="pre">UserDetailsService</span></code> is created in accordance with the requirements of the application.</p>
<ul class="simple">
<li>UserDetailsService interface</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserDetailsService</span> <span class="o">{</span>
    <span class="n">UserDetails</span> <span class="nf">loadUserByUsername</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">UsernameNotFoundException</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Here, a service class is created to search account information from the database and
generate an instance of <code class="docutils literal"><span class="pre">UserDetails</span></code>.
In this sample, account information is fetched by using <code class="docutils literal"><span class="pre">SharedService</span></code>.
For <code class="docutils literal"><span class="pre">SharedService</span></code>, refer <a class="reference internal" href="../ImplementationAtEachLayer/DomainLayer.html#service-label"><span class="std std-ref">Implementation of Service</span></a>.</p>
<ul class="simple">
<li>How to create AccountSharedService interface</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AccountSharedService</span> <span class="o">{</span>
    <span class="n">Account</span> <span class="nf">findOne</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<ul class="simple">
<li>How to create implementation class of AccountSharedService</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// (1)</span>
<span class="nd">@Service</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccountSharedServiceImpl</span> <span class="kd">implements</span> <span class="n">AccountSharedService</span> <span class="o">{</span>
    <span class="nd">@Inject</span>
    <span class="n">AccountRepository</span> <span class="n">accountRepository</span><span class="o">;</span>

    <span class="c1">// (2)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Account</span> <span class="nf">findOne</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="n">accountRepository</span><span class="o">.</span><span class="na">findOneByUsername</span><span class="o">(</span><span class="n">username</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">account</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">ResourceNotFoundException</span><span class="o">(</span><span class="s">&quot;The given account is not found! username=&quot;</span>
                    <span class="o">+</span> <span class="n">username</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">account</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create a class which implements <code class="docutils literal"><span class="pre">AccountSharedService</span></code> interface and assign <code class="docutils literal"><span class="pre">&#64;Service</span></code>.</div>
<div class="line">In the example above, <code class="docutils literal"><span class="pre">AccountSharedServiceImpl</span></code> is registered in DI container using component scan function.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Search account information from the database.</div>
<div class="line">When account information is not found, an exception of common library - <code class="docutils literal"><span class="pre">ResourceNotFoundException</span></code> is thrown.</div>
<div class="line">For how to create a repository, refer “<a class="reference internal" href="../Tutorial/TutorialSecurity.html"><span class="doc">Spring Security Tutorial</span></a>”.</div>
</div>
</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>How to create implementation class of UserDetailsService</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// (1)</span>
<span class="nd">@Service</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccountUserDetailsService</span> <span class="kd">implements</span> <span class="n">UserDetailsService</span> <span class="o">{</span>
    <span class="nd">@Inject</span>
    <span class="n">AccountSharedService</span> <span class="n">accountSharedService</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">UserDetails</span> <span class="nf">loadUserByUsername</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">UsernameNotFoundException</span> <span class="o">{</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="n">accountSharedService</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">username</span><span class="o">);</span>
            <span class="c1">// (2)</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">AccountUserDetails</span><span class="o">(</span><span class="n">account</span><span class="o">,</span> <span class="n">getAuthorities</span><span class="o">(</span><span class="n">account</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ResourceNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// (3)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">UsernameNotFoundException</span><span class="o">(</span><span class="s">&quot;user not found&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">// (4)</span>
    <span class="kd">private</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">GrantedAuthority</span><span class="o">&gt;</span> <span class="nf">getAuthorities</span><span class="o">(</span><span class="n">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">account</span><span class="o">.</span><span class="na">isAdmin</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">AuthorityUtils</span><span class="o">.</span><span class="na">createAuthorityList</span><span class="o">(</span><span class="s">&quot;ROLE_USER&quot;</span><span class="o">,</span> <span class="s">&quot;ROLE_ADMIN&quot;</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">AuthorityUtils</span><span class="o">.</span><span class="na">createAuthorityList</span><span class="o">(</span><span class="s">&quot;ROLE_USER&quot;</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create a class which implements <code class="docutils literal"><span class="pre">UserDetailsService</span></code> interface and assign <code class="docutils literal"><span class="pre">&#64;Service</span></code>.</div>
<div class="line">In the example above, <code class="docutils literal"><span class="pre">UserDetailsService</span></code> is registered in DI container using a component scan function.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch account information by using <code class="docutils literal"><span class="pre">AccountSharedService</span></code>.</div>
<div class="line">When the account information is found, <code class="docutils literal"><span class="pre">UserDetails</span></code> is generated.</div>
<div class="line">In the example above, user name, password and user validity status are fetched from account information.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When the account information is not found, <code class="docutils literal"><span class="pre">UsernameNotFoundException</span></code> is thrown.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Generate information about the rights (role) retained by the user. The rights (role) generated here are used in the authorization process.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Information of rights to be used in the authorization</strong></p>
<p class="last">Authorization process of Spring Security handles the rights information starting with <code class="docutils literal"><span class="pre">ROLE_</span></code>as a role.
Hence, when resource access is to be controlled by using role, <code class="docutils literal"><span class="pre">ROLE_</span></code> must be assigned as a prefix to the rights information which is being handled as a role.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Concealing authentication exception information</strong></p>
<p class="last">In the default operation of Spring Security, error handling is performed after changing <code class="docutils literal"><span class="pre">UsernameNotFoundException</span></code> to an exception called <code class="docutils literal"><span class="pre">BadCredentialsException</span></code>.
<code class="docutils literal"><span class="pre">BadCredentialsException</span></code> denotes an error in any field of the credentials specified by the client, specific error causes are not notified to the client.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="applying-db-authentication">
<span id="authenticationproviderconfiguration"></span><h4><a class="toc-backref" href="#id39">9.2.2.4.3. Applying DB authentication</a><a class="headerlink" href="#applying-db-authentication" title="Permalink to this headline">¶</a></h4>
<p>When the authentication is to be performed by using <code class="docutils literal"><span class="pre">UserDetailsService</span></code> thus created,
<code class="docutils literal"><span class="pre">UserDetailsService</span></code> thus created must be applied by enabling <code class="docutils literal"><span class="pre">DaoAuthenticationProvider</span></code>.</p>
<ul class="simple">
<li>Definition example of spring-security.xml</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;sec:authentication-manager&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;sec:authentication-provider</span> <span class="na">user-service-ref=</span><span class="s">&quot;accountUserDetailsService&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
        <span class="nt">&lt;sec:password-encoder</span> <span class="na">ref=</span><span class="s">&quot;passwordEncoder&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;/sec:authentication-provider&gt;</span>
<span class="nt">&lt;/sec:authentication-manager&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;passwordEncoder&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (4) --&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define a Bean for <code class="docutils literal"><span class="pre">AuthenticationManager</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define <code class="docutils literal"><span class="pre">&lt;sec:authentication-provider&gt;</span></code> element in the <code class="docutils literal"><span class="pre">&lt;sec:authentication-manager&gt;</span></code> element.</div>
<div class="line">Specify a Bean of <code class="docutils literal"><span class="pre">AccountUserDetailsService</span></code> created by “<a class="reference internal" href="#springsecurityauthenticationuserdetailsservice"><span class="std std-ref">Creating UserDetailsService</span></a>”, in <code class="docutils literal"><span class="pre">user-service-ref</span></code> attribute.</div>
<div class="line">Based on this definition, <code class="docutils literal"><span class="pre">DaoAuthenticationProvider</span></code> of default setup is enabled.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify a Bean of <code class="docutils literal"><span class="pre">PasswordEncoder</span></code> to be used at the time of password verification.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define a Bean for <code class="docutils literal"><span class="pre">PasswordEncoder</span></code> to be used at the time of password verification.</div>
<div class="line">In the example above, <code class="docutils literal"><span class="pre">BCryptPasswordEncoder</span></code> is defined which performs password hashing by using BCrypt algorithm.</div>
<div class="line">For password hashing, refer “<a class="reference internal" href="#springsecurityauthenticationpasswordhashing"><span class="std std-ref">Password hashing</span></a>”.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="password-hashing">
<span id="springsecurityauthenticationpasswordhashing"></span><h3><a class="toc-backref" href="#id40">9.2.2.5. Password hashing</a><a class="headerlink" href="#password-hashing" title="Permalink to this headline">¶</a></h3>
<p>When a password is stored in the database, password is not stored as it is and a hash value of the password is generally stored.</p>
<p>Spring Security provides an interface and implementation class for password hashing
and operates in coordination with the authentication function.</p>
<p>There are 2 types of interfaces provided by Spring Security.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">org.springframework.security.crypto.password.PasswordEncoder</span></code></li>
<li><code class="docutils literal"><span class="pre">org.springframework.security.authentication.encoding.PasswordEncoder</span></code></li>
</ul>
<p>Although both the interfaces include <code class="docutils literal"><span class="pre">PasswordEncoder</span></code>, <code class="docutils literal"><span class="pre">PasswordEncoder</span></code> of
<code class="docutils literal"><span class="pre">org.springframework.security.authentication.encoding</span></code> package is deprecated.</p>
<p>When there are no specific constraints in the password hashing requirements, using the implementation class of <code class="docutils literal"><span class="pre">PasswordEncoder</span></code> interface of
<code class="docutils literal"><span class="pre">org.springframework.security.crypto.password</span></code> package is recommended.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For how to use deprecated <code class="docutils literal"><span class="pre">PasswordEncoder</span></code>, refer
“<a class="reference internal" href="#authenticationhowtoextendusingdeprecatedpasswordencoder"><span class="std std-ref">Using PasswordEncoder of deprecated package</span></a>”.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><em>Definition of a method for org.springframework.security.crypto.password.PasswordEncoder</em></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PasswordEncoder</span> <span class="o">{</span>
    <span class="n">String</span> <span class="nf">encode</span><span class="o">(</span><span class="n">CharSequence</span> <span class="n">rawPassword</span><span class="o">);</span>
    <span class="kt">boolean</span> <span class="nf">matches</span><span class="o">(</span><span class="n">CharSequence</span> <span class="n">rawPassword</span><span class="o">,</span> <span class="n">String</span> <span class="n">encodedPassword</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils" id="id14">
<caption><span class="caption-text"><strong>Method defined in PasswordEncoder</strong></span><a class="headerlink" href="#id14" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">encode</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A method for password hashing.</div>
<div class="line">It can be used for hashing of passwords which are stored in the data store during account registration process and password change process.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">matches</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A method to verify plain text password and hashed password.</div>
<div class="line">This method can also be used in the authentication process of Spring Security and can also be used to verify current password and the password used earlier during password change process etc.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Spring Security offers following 5 classes as the implementation class of <code class="docutils literal"><span class="pre">PasswordEncoder</span></code> interface.</p>
<table border="1" class="colwidths-given docutils" id="id15">
<caption><span class="caption-text"><strong>Implementation class of PasswordEncoder</strong></span><a class="headerlink" href="#id15" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Implementation class</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">BCryptPasswordEncoder</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implementation class which performs password hashing and verification by using BCrypt algorithm.</div>
<div class="line"><strong>When there are no specific constraints in password hashing requirement, using this class is recommended.</strong></div>
<div class="line">For details, refer <a class="reference external" href="http://docs.spring.io/spring-security/site/docs/4.2.4.RELEASE/apidocs/org/springframework/security/crypto/bcrypt/BCryptPasswordEncoder.html">JavaDoc of BCryptPasswordEncoder</a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">StandardPasswordEncoder</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implementation class which performs password hashing and verification by using SHA-256 algorithm.</div>
<div class="line">For details, refer <a class="reference external" href="http://docs.spring.io/spring-security/site/docs/4.2.4.RELEASE/apidocs/org/springframework/security/crypto/password/StandardPasswordEncoder.html">JavaDoc of StandardPasswordEncoder</a>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">NoOpPasswordEncoder</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implementation class which does not perform hashing.</div>
<div class="line">It is a class used for testing and is not used in the actual application.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Pbkdf2PasswordEncoder</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">An implementation class which performs password hashing and collation by using PBKDF2 algorithm. <code class="docutils literal"><span class="pre">Pbkdf2PasswordEncoder</span></code> class is added from Spring Security 4.1.</div>
<div class="line">For details, refer <a class="reference external" href="https://docs.spring.io/spring-security/site/docs/4.2.4.RELEASE/apidocs/org/springframework/security/crypto/password/Pbkdf2PasswordEncoder.html">JavaDoc of Pbkdf2PasswordEncoder</a>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">SCryptPasswordEncoder</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">An implementation class which performs password hashing and collation by using SCrypt algorithm. <code class="docutils literal"><span class="pre">SCryptPasswordEncoder</span></code> class is added from Spring Security 4.1.</div>
<div class="line">For details, refer <a class="reference external" href="https://docs.spring.io/spring-security/site/docs/4.2.4.RELEASE/apidocs/org/springframework/security/crypto/scrypt/SCryptPasswordEncoder.html">JavaDoc of SCryptPasswordEncoder</a>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>This section explains how to use <code class="docutils literal"><span class="pre">BCryptPasswordEncoder</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">How to use <code class="docutils literal"><span class="pre">BCryptPasswordEncoder</span></code> is introduced in the guideline, however, <a class="reference external" href="https://www.owasp.org/index.php/Password_Storage_Cheat_Sheet">OWASP</a> recommends
PBKDF2 algorithm than BCrypt algorithm.
Also, in <a class="reference external" href="http://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-132.pdf">“5 Password-Based Key Derivation Functions” of NIST800-132</a>,
it is recommended to set iteration count used in hashing function of PBKDF to minimum 1000, and to 10,000,000 especially for the systems wherein important keys and functions do not matter significantly.
As the iteration count increases, password strength also increases but it also increases the impact on the performance.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p><strong>TBD</strong></p>
<p class="last"><code class="docutils literal"><span class="pre">Pbkdf2PasswordEncoder</span></code> described earlier should be used to correspond with PBKDF2 algorithm.
How to use <code class="docutils literal"><span class="pre">Pbkdf2PasswordEncoder</span></code> will be described in next version.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="bcryptpasswordencoder">
<h4><a class="toc-backref" href="#id41">9.2.2.5.1. BCryptPasswordEncoder</a><a class="headerlink" href="#bcryptpasswordencoder" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">BCryptPasswordEncoder</span></code> is an implementation class which performs password hashing and password verification by using BCrypt algorithm.
16 byte random numbers (<code class="docutils literal"><span class="pre">java.security.SecureRandom</span></code>) are used in <a class="reference internal" href="#springsecurityauthenticationpasswordhashsalt"><span class="std std-ref">Salt</span></a>,
<a class="reference internal" href="#springsecurityauthenticationpasswordhashstength"><span class="std std-ref">Stretching</span></a> is done for 1024 (2 to the power of 10) times by default..</p>
<ul class="simple">
<li>Definition example of applicationContext.xml</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;passwordEncoder&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder&quot;</span> <span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;strength&quot;</span> <span class="na">value=</span><span class="s">&quot;11&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify <code class="docutils literal"><span class="pre">BCryptPasswordEncoder</span></code> in passwordEncoder class.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify number of rounds for stretching count of hashing in the argument of constructor.</div>
<div class="line">This argument can be omitted and the values that can be specified are in the range from “<code class="docutils literal"><span class="pre">4</span></code>”  to <code class="docutils literal"><span class="pre">31</span></code>.</div>
<div class="line">Note that default value is <code class="docutils literal"><span class="pre">10</span></code> when the argument value is not specified.</div>
<div class="line">The explanation is omitted in the guideline, however <code class="docutils literal"><span class="pre">java.security.SecureRandom.SecureRandom</span></code> can also be specified as a constructor argument.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>How to use SecureRandom</strong></p>
<p>When <code class="docutils literal"><span class="pre">SecureRandom</span></code> is to be used in Linux environment, a delay or timeout in the processing is likely to occur.
This event depends on the random number generator to be used and description is given in the document given below.</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/security/SecureRandom.html">https://docs.oracle.com/javase/8/docs/api/java/security/SecureRandom.html</a></li>
</ul>
<p>When this event occurs, it can be avoided by adding one of the following settings.</p>
<ul class="simple">
<li>Specify <code class="docutils literal"><span class="pre">-Djava.security.egd=file:/dev/urandom</span></code> while executing Java command.</li>
<li>Change <code class="docutils literal"><span class="pre">securerandom.source=/dev/random`</span> <span class="pre">in</span> <span class="pre">``${JAVA_HOME}/jre/lib/security/java.security</span></code> to <code class="docutils literal"><span class="pre">securerandom.source=/dev/urandom</span></code>.</li>
</ul>
<p class="last">If this event occurs in the version prior to b19 of Java SE 7 (prior to official release), <code class="docutils literal"><span class="pre">/dev/./urandom</span></code> must be specified instead of <code class="docutils literal"><span class="pre">/dev/urandom</span></code>. However, algorithm used by <code class="docutils literal"><span class="pre">SecureRandom</span></code> cannot be avoided in case of <code class="docutils literal"><span class="pre">NativePRNG</span></code>.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><code class="docutils literal"><span class="pre">PasswordEncoder</span></code> is used in the class which carries out a process by using <code class="docutils literal"><span class="pre">BCryptPasswordEncoder</span></code>, by injecting from DI container.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Service</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccountServiceImpl</span> <span class="kd">implements</span> <span class="n">AccountService</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">AccountRepository</span> <span class="n">accountRepository</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="n">PasswordEncoder</span> <span class="n">passwordEncoder</span><span class="o">;</span> <span class="c1">// (1)</span>

    <span class="kd">public</span> <span class="n">Account</span> <span class="nf">register</span><span class="o">(</span><span class="n">Account</span> <span class="n">account</span><span class="o">,</span> <span class="n">String</span> <span class="n">rawPassword</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// omitted</span>
        <span class="n">String</span> <span class="n">encodedPassword</span> <span class="o">=</span> <span class="n">passwordEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">rawPassword</span><span class="o">);</span> <span class="c1">// (2)</span>
        <span class="n">account</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="n">encodedPassword</span><span class="o">);</span>
        <span class="c1">// omitted</span>
        <span class="k">return</span> <span class="n">accountRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Inject <code class="docutils literal"><span class="pre">PasswordEncoder</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Call injected <code class="docutils literal"><span class="pre">PasswordEncoder</span></code> method.</div>
<div class="line">Here, the password stored in the data store is hashed.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note" id="springsecurityauthenticationpasswordhashsalt">
<p class="first admonition-title">Note</p>
<p><strong>Salt</strong></p>
<p class="last">A salt is a string which is added to data targeted for hashing.
Since number of digits exceed the actual password length by assigning a salt to a password, password analysis using programs like rainbow crack become difficult.
Note that, <strong>it is recommended to set different values of salt (random values) for each user.</strong>
This is necessary because if identical salt value is used, the string (password) before hashing can be easily identified from the hash value.</p>
</div>
<div class="admonition note" id="springsecurityauthenticationpasswordhashstength">
<p class="first admonition-title">Note</p>
<p><strong>Stretching</strong></p>
<p>Information related to stored password is repeatedly encrypted by iterating hash function calculation in order to
extend the time required for password analysis as a countermeasure against password brute force attack.
However, stretching frequency must be determined considering the system performance since stretching is likely to impact system performance.</p>
<p class="last">In Spring Security, stretching is done for 1024 times (2 to the power of 10) by default, however this frequency can be changed by constructor argument (<code class="docutils literal"><span class="pre">strength</span></code>).
A value from 4 (16 times) to 31 (2, 147, 483, 648 times) can be specified in the <code class="docutils literal"><span class="pre">strength</span></code>.
More the frequency of stretching, stronger the password. However, it is likely to impact performance due to higher complexity.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="handling-authentication-event">
<span id="springsecurityauthenticationevent"></span><h3><a class="toc-backref" href="#id42">9.2.2.6. Handling authentication event</a><a class="headerlink" href="#handling-authentication-event" title="Permalink to this headline">¶</a></h3>
<p>Spring Security offers a system which links process results of authentication process with other components
using an event notification system offered by Spring Security.</p>
<p>If this system is used, following security requirements can be incorporated in the authentication function of Spring Security.</p>
<ul class="simple">
<li>Save authentication history of successful and failed authentication in database or log.</li>
<li>Lock account if wrong password is entered in succession.</li>
</ul>
<p>Authentication event is notified as given below.</p>
<div class="figure" id="id16">
<a class="reference internal image-reference" href="../_images/AuthenticationEventNotification.png"><img alt="../_images/AuthenticationEventNotification.png" src="../_images/AuthenticationEventNotification.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Event notification system</strong></span></p>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Spring Security authentication function passes authentication results (authentication information and authentication exception)</div>
<div class="line">in <code class="docutils literal"><span class="pre">AuthenticationEventPublisher</span></code> and requests notification of authentication event.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Default implementation class of <code class="docutils literal"><span class="pre">AuthenticationEventPublisher</span></code> interface generates an instance of</div>
<div class="line">authentication event class corresponding to authentication results, passes to <code class="docutils literal"><span class="pre">ApplicationEventPublisher</span></code> and requests event notification.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implementation class of <code class="docutils literal"><span class="pre">ApplicationEventPublisher</span></code> interface notifies the event to implementation class of <code class="docutils literal"><span class="pre">ApplicationListener</span></code> interface.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">ApplicationListenerMethodAdaptor</span></code>, one of the implementation classes of <code class="docutils literal"><span class="pre">ApplicationListener</span></code> calls a method</div>
<div class="line">assigned by <code class="docutils literal"><span class="pre">&#64;org.springframework.context.event.EventListener</span></code> and notifies an event.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Memo</strong></p>
<p class="last">Although it was necessary to receive the event by creating an implementation class of <code class="docutils literal"><span class="pre">ApplicationListener</span></code>till Spring 4.1,
an event can be created in Spring 4.2 only by implementing a method which assigns <code class="docutils literal"><span class="pre">&#64;EventListener</span></code> to POJO.
Note that, even in subsequent versions of Spring 4.2, an event can be received by creating an implementation class of <code class="docutils literal"><span class="pre">ApplicationListener</span></code> interface as earlier.</p>
</div>
<p>Events used by Spring Security can be classified into 2 types - the events which notify successful authentication and the events which notify failure in authentication.
Event class offered by Spring Security are explained below.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="authentication-successful-event">
<h4><a class="toc-backref" href="#id43">9.2.2.6.1. Authentication successful event</a><a class="headerlink" href="#authentication-successful-event" title="Permalink to this headline">¶</a></h4>
<p>There are 3 main events which are notified by Spring Security at the time of successful authentication.
These events are notified in the following order unless an error occurs in between.</p>
<table border="1" class="colwidths-given docutils" id="id17">
<caption><span class="caption-text"><strong>Event class which notifies that the authentication is successful</strong></span><a class="headerlink" href="#id17" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Event class</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AuthenticationSuccessEvent</span></code></td>
<td>An event class to notify that the authentication process by <code class="docutils literal"><span class="pre">AuthenticationProvider</span></code> is successful.
If this event is handled, it can be detected whether the client has specified correct information.
It must be noted that an error is likely to occur in the subsequent processes after handling this event.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">SessionFixationProtectionEvent</span></code></td>
<td>An event class to notify that session fixation attack countermeasure process (change process of session ID) is successful.
If this event is handled, session ID after the change can be detected.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">InteractiveAuthenticationSuccessEvent</span></code></td>
<td>An event class to notify that authentication process is entirely successful.
If this event is handled, it can be detected that the overall authentication process is successful except the screen transition.</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="authentication-failure-event">
<h4><a class="toc-backref" href="#id44">9.2.2.6.2. Authentication failure event</a><a class="headerlink" href="#authentication-failure-event" title="Permalink to this headline">¶</a></h4>
<p>Main events which are notified by Spring Security at the time of authentication failure are as below.
When authentication fails, any one of the events is notified.</p>
<table border="1" class="colwidths-given docutils" id="id18">
<caption><span class="caption-text"><strong>Event class which notifies that authentication has failed</strong></span><a class="headerlink" href="#id18" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Event class</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">AuthenticationFailureBadCredentialsEvent</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Event class which notifies that <code class="docutils literal"><span class="pre">BadCredentialsException</span></code> has occurred.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">AuthenticationFailureDisabledEvent</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Event class which notifies that <code class="docutils literal"><span class="pre">DisabledException</span></code> has occurred.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">AuthenticationFailureLockedEvent</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Event class which notifies that <code class="docutils literal"><span class="pre">LockedException</span></code> has occurred.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">AuthenticationFailureExpiredEvent</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Event class which notifies that <code class="docutils literal"><span class="pre">AccountExpiredException</span></code> has occurred.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">AuthenticationFailureCredentialsExpiredEvent</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Event class which notifies that <code class="docutils literal"><span class="pre">CredentialsExpiredException</span></code> has occurred.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">AuthenticationFailureServiceExceptionEvent</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Event class which notifies that <code class="docutils literal"><span class="pre">AuthenticationServiceException</span></code> has occurred.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="creating-event-listener">
<h4><a class="toc-backref" href="#id45">9.2.2.6.3. Creating event listener</a><a class="headerlink" href="#creating-event-listener" title="Permalink to this headline">¶</a></h4>
<p>When you want to carry out a process by receiving authentication event notification, a class implementing a method that assigns <code class="docutils literal"><span class="pre">&#64;EventListener</span></code> is created and registered in DI container.</p>
<ul class="simple">
<li>Implementation example for event listener class</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AuthenticationEventListeners</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span>
            <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">AuthenticationEventListeners</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="nd">@EventListener</span> <span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleBadCredentials</span><span class="o">(</span>
    <span class="n">AuthenticationFailureBadCredentialsEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// (2)</span>
    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Bad credentials is detected. username : {}&quot;</span><span class="o">,</span> <span class="n">event</span><span class="o">.</span><span class="na">getAuthentication</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
    <span class="c1">// omitted</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create a method which assigns <code class="docutils literal"><span class="pre">&#64;EventListener</span></code> to a method.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify an authentication event class which is to be handled in the method argument.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>The example above is an example wherein a class is created that handles <code class="docutils literal"><span class="pre">AuthenticationFailureBadCredentialsEvent</span></code> that is notified when the client specified authentication information is incorrect.
Other events can also be handled in the same manner.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="logout">
<span id="springsecurityauthenticationlogout"></span><h3><a class="toc-backref" href="#id46">9.2.2.7. Logout</a><a class="headerlink" href="#logout" title="Permalink to this headline">¶</a></h3>
<p>Spring Security performs logout process as per the flow given below.</p>
<div class="figure" id="id19">
<a class="reference internal image-reference" href="../_images/AuthenticationLogout.png"><img alt="../_images/AuthenticationLogout.png" src="../_images/AuthenticationLogout.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Logout process system</strong></span></p>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Client sends a request to a path intended for logout process.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">LogoutFilter</span></code> calls <code class="docutils literal"><span class="pre">LogoutHandler</span></code> method and performs actual logout process.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">LogoutFilter</span></code> calls <code class="docutils literal"><span class="pre">LogoutSuccessHandler</span></code> method and performs screen transition.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>A plurality of implementation classes of <code class="docutils literal"><span class="pre">LogoutHandler</span></code> play respective roles as below.</p>
<table border="1" class="colwidths-given docutils" id="id20">
<caption><span class="caption-text"><strong>Implementation class of main LogoutHandler</strong></span><a class="headerlink" href="#id20" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Implementation class</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">SecurityContextLogoutHandler</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Class which clears authentication information of login user and cancels a session.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">CookieClearingLogoutHandler</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Class which sends a response for deleting specific cookies.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">CsrfLogoutHandler</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Class which deletes a token for CSRF countermeasure.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Since <code class="docutils literal"><span class="pre">LogoutHandler</span></code>automatically sets the class which supports bean definition offered by Spring Security, in <code class="docutils literal"><span class="pre">LogoutFilter</span></code>,
there is no need for a developer to be specifically aware of the same.
Note that, if <a class="reference internal" href="#springsecurityauthenticationrememberme"><span class="std std-ref">Remember Me authentication function</span></a> is enabled, implementation class of <code class="docutils literal"><span class="pre">LogoutHandler</span></code> is also configured to delete the token for Remember Me authentication.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="applying-logout-process">
<h4><a class="toc-backref" href="#id47">9.2.2.7.1. Applying logout process</a><a class="headerlink" href="#applying-logout-process" title="Permalink to this headline">¶</a></h4>
<p>Define a bean as below for application of logout process.</p>
<ul class="simple">
<li>Definition example of spring-security.xml</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;sec:http&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
    <span class="nt">&lt;sec:logout</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/sec:http&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Logout process is enabled by defining <code class="docutils literal"><span class="pre">&lt;sec:logout&gt;</span></code> tag.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Changes in Spring Security 4.0</strong></p>
<p>Default values of following configuration changes from Spring Security 4.0 version.</p>
<ul class="last simple">
<li>logout-url</li>
</ul>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>Delete Cookie</strong></p>
<p>Although description is omitted in the guideline, note that <code class="docutils literal"><span class="pre">delete-cookies</span></code> attribute exists in <code class="docutils literal"><span class="pre">&lt;sec:logout&gt;</span></code> tag for deleting Cookie specified at the time of logout.
However, it has been reported that a cookie is sometimes not deleted even after using this attribute.</p>
<p>For details, refer following JIRA of Spring Security.</p>
<ul class="last simple">
<li><a class="reference external" href="https://jira.spring.io/browse/SEC-2091?redirect=false">https://jira.spring.io/browse/SEC-2091?redirect=false</a></li>
</ul>
</div>
</div>
<div class="section" id="id3">
<h4><a class="toc-backref" href="#id48">9.2.2.7.2. Default operation</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>In the default operation of Spring Security, if a request is sent to the path <code class="docutils literal"><span class="pre">/logout</span></code>, logout process is carried out.
Logout process consists of “clearing authentication information of logged in user” and “cancelling a session”.</p>
<p>Further,</p>
<ul class="simple">
<li>“Deleting token for CSRF measures” when CSRF measures are adopted</li>
<li>“Deleting token for Remember Me authentication” when Remember Me authentication function is used</li>
</ul>
<p>are also carried out.</p>
<ul class="simple" id="springsecurityauthenticationlogoutform">
<li>Implementation example of JSP for calling logout process</li>
</ul>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;c&quot;</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> <span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;sec&quot;</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/security/tags&quot;</span> <span class="k">%&gt;</span>
<span class="k">&lt;%-</span><span class="o">-</span> <span class="n">omitted</span> <span class="o">--</span><span class="k">%&gt;</span>
<span class="nt">&lt;form:form</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/logout&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">--</span><span class="k">%&gt;</span>
    <span class="nt">&lt;button&gt;</span>Logout<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form:form&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create a form for logout.</div>
<div class="line">Further, token value of CSRF measure is sent in request parameter by using <code class="docutils literal"><span class="pre">&lt;form:form&gt;</span></code>.</div>
<div class="line">CSRF measures are explained in “<a class="reference internal" href="CSRF.html#springsecuritycsrf"><span class="std std-ref">CSRF Countermeasures</span></a>”.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Sending CSRF tokens</strong></p>
<p class="last">If CSRF measures are enabled, tokens for CSRF measures must be sent by POST method.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="response-when-logout-is-successful">
<h3><a class="toc-backref" href="#id49">9.2.2.8. Response when logout is successful</a><a class="headerlink" href="#response-when-logout-is-successful" title="Permalink to this headline">¶</a></h3>
<p>Spring Security offers an interface <code class="docutils literal"><span class="pre">LogoutSuccessHandler</span></code>and implementation class
as the components to control response when the logout is successfully completed.</p>
<table border="1" class="colwidths-given docutils" id="id21">
<caption><span class="caption-text"><strong>Implementation class of AuthenticationFailureHandler</strong></span><a class="headerlink" href="#id21" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Implementation class</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">SimpleUrlLogoutSuccessHandler</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implementation class which redirects in the specified path (<code class="docutils literal"><span class="pre">defaultTargetUrl</span></code>).</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="section" id="id4">
<h4><a class="toc-backref" href="#id50">9.2.2.8.1. Default operation</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>In default operation of Spring Security, user is redirected to a URL wherein a query parameter called <code class="docutils literal"><span class="pre">logout</span></code>is assigned to the path for displaying login form.</p>
<p>As an example, when the path to display login form is <code class="docutils literal"><span class="pre">/login</span></code>, the user is redirected to <code class="docutils literal"><span class="pre">/login?logout</span></code>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="accessing-authentication-information">
<span id="springsecurityauthenticationaccess"></span><h3><a class="toc-backref" href="#id51">9.2.2.9. Accessing authentication information</a><a class="headerlink" href="#accessing-authentication-information" title="Permalink to this headline">¶</a></h3>
<p>Authentication information of the authenticated user is stored in the session during default implementation of Spring Security.
Authentication information stored in the session is stored in <code class="docutils literal"><span class="pre">SecurityContextHolder</span></code> class by <code class="docutils literal"><span class="pre">SecurityContextPersistenceFilter</span></code> class for each request and can be accessed from anywhere if it is in the same thread.</p>
<p>A method wherein <code class="docutils literal"><span class="pre">UserDetails</span></code> are fetched from authentication information and the information retained in the fetched <code class="docutils literal"><span class="pre">UserDetails</span></code> is accessed.</p>
<div class="section" id="access-from-java">
<h4><a class="toc-backref" href="#id52">9.2.2.9.1. Access from Java</a><a class="headerlink" href="#access-from-java" title="Permalink to this headline">¶</a></h4>
<p>An audit log which records information like “When”, “Who”, “Which data” and “Type of access” is fetched in the general business application.
“Who” for fulfilling these requirements can be fetched from authentication information.</p>
<ul class="simple">
<li>Implementation example to access authentication information from Java</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Authentication</span> <span class="n">authentication</span> <span class="o">=</span>
        <span class="n">SecurityContextHolder</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getAuthentication</span><span class="o">();</span> <span class="c1">// (1)</span>
<span class="n">String</span> <span class="n">userUuid</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">authentication</span><span class="o">.</span><span class="na">getPrincipal</span><span class="o">()</span> <span class="k">instanceof</span> <span class="n">AccountUserDetails</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">AccountUserDetails</span> <span class="n">userDetails</span> <span class="o">=</span>
            <span class="n">AccountUserDetails</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">authentication</span><span class="o">.</span><span class="na">getPrincipal</span><span class="o">());</span> <span class="c1">// (2)</span>
    <span class="n">userUuid</span> <span class="o">=</span> <span class="n">userDetails</span><span class="o">.</span><span class="na">getAccount</span><span class="o">().</span><span class="na">getUserUuid</span><span class="o">();</span> <span class="c1">// (3)</span>
<span class="o">}</span>
<span class="k">if</span> <span class="o">(</span><span class="n">log</span><span class="o">.</span><span class="na">isInfoEnabled</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;type:Audit\tuserUuid:{}\tresource:{}\tmethod:{}&quot;</span><span class="o">,</span>
            <span class="n">userUuid</span><span class="o">,</span> <span class="n">httpRequest</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">(),</span> <span class="n">httpRequest</span><span class="o">.</span><span class="na">getMethod</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch authentication information (<code class="docutils literal"><span class="pre">Authentication</span></code> object) from <code class="docutils literal"><span class="pre">SecurityContextHolder</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Call <code class="docutils literal"><span class="pre">Authentication#getPrincipal()</span></code> method and fetch <code class="docutils literal"><span class="pre">UserDetails</span></code> object.</div>
<div class="line">When there is no authentication (anonymous user), note that a string indicating an anonymous user is returned.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch information required for processing from <code class="docutils literal"><span class="pre">UserDetails</span></code>.</div>
<div class="line">Here, a value which uniquely identifies the user (UUID) is fetched.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Access and coupling of authentication information</strong></p>
<p>In the default operation of Spring Security, since authentication information is stored in ThreadLocal variable, it can be accessed from anywhere if the thread is identical to a thread which receives request.
Although this system is convenient, it results in direct dependency of the class which requires authentication information on <code class="docutils literal"><span class="pre">SecurityContextHolder</span></code> class. Hence, care must be taken since it reduces  coupling between components when not used correctly.</p>
<p class="last">Spring Security also offers a system to maintain coupling between components by coordinating with Spring MVC function.
How to coordinate with Spring MVC is explained in “<a class="reference internal" href="#springsecurityauthenticationintegrationwithspringmvc"><span class="std std-ref">Coordination between authentication process and Spring MVC</span></a>”.
<strong>This guideline recommends fetching authentication information by using coordination with Spring MVC.</strong></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>When a filter (FORM_LOGIN_FILTER) for authentication is to be customized,
it is necessary to disable the following 2 <code class="docutils literal"><span class="pre">SessionAuthenticationStrategy</span></code> classes, apart from specifying <code class="docutils literal"><span class="pre">&lt;sec:concurrency-control&gt;</span></code> element.</p>
<ul>
<li><div class="first line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.security.web.authentication.session.ConcurrentSessionControlAuthenticationStrategy</span></code></div>
<div class="line">A class to check number of sessions for each logged in user after successful authentication.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.security.web.authentication.session.RegisterSessionAuthenticationStrategy</span></code></div>
<div class="line">A class to register a session with successful authentication, in session management area.</div>
</div>
</li>
</ul>
<p>In version 1.0.x.RELEASE dependent Spring Security 3.1, <code class="docutils literal"><span class="pre">org.springframework.security.web.authentication.session.ConcurrentSessionControlStrategy</span></code> class is provided; however,
it is deprecated API from Spring Security 3.2 and it is abolished API from Spring Security 4.0.
When upgrading version from Spring Security 3.1 to Spring Security 3.2 or later versions, changes need to be made so that it can be used with combination of following classes.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">ConcurrentSessionControlAuthenticationStrategy</span></code> (added in Spring Security 3.2)</li>
<li><code class="docutils literal"><span class="pre">RegisterSessionAuthenticationStrategy</span></code> (added in Spring Security 3.2)</li>
<li><code class="docutils literal"><span class="pre">org.springframework.security.web.authentication.session.SessionFixationProtectionStrategy</span></code></li>
</ul>
<p class="last">For specific methods of definition,
refer to sample code of <a class="reference external" href="http://docs.spring.io/spring-security/site/docs/4.2.4.RELEASE/reference/htmlsingle/#concurrent-sessions">Spring Security Reference -Web Application Security (Concurrency Control)-</a>.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="access-from-jsp">
<h4><a class="toc-backref" href="#id53">9.2.2.9.2. Access from JSP</a><a class="headerlink" href="#access-from-jsp" title="Permalink to this headline">¶</a></h4>
<p>User information of login user is displayed on the screen in general Web application.
User information of login user while meeting these requirements can be fetched from authentication information.</p>
<ul class="simple">
<li>Implementation example for accessing authentication information from JSP</li>
</ul>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;sec&quot;</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/security/tags&quot;</span> <span class="k">%&gt;</span>
<span class="k">&lt;%-</span><span class="o">-</span> <span class="n">omitted</span> <span class="o">--</span><span class="k">%&gt;</span>
Welcome
<span class="nt">&lt;sec:authentication</span> <span class="na">property=</span><span class="s">&quot;principal.account.lastName&quot;</span><span class="nt">/&gt;</span> <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">--</span><span class="k">%&gt;</span>
San
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use <code class="docutils literal"><span class="pre">&lt;sec:authentication&gt;</span></code> tag offered by Spring Security and fetch authentication information (<code class="docutils literal"><span class="pre">Authentication</span></code> object).</div>
<div class="line">Specify path for the property to be accessed in <code class="docutils literal"><span class="pre">property</span></code> attribute.</div>
<div class="line">When a nested object is to be accessed, property name should be joined by “<code class="docutils literal"><span class="pre">.</span></code>” .</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>How to display authentication information</strong></p>
<p>Although the implementation example for displaying user information which contains authentication information is explained, it is possible to store value in any scope variable by combining <code class="docutils literal"><span class="pre">var</span></code> attribute and <code class="docutils literal"><span class="pre">scope</span></code> attribute.
When the display contents are to be changed according to the login user status, user information can be stored in the variable and display can be changed by using JSTL tag library etc.</p>
<p>In the example above, it can also be displayed as described below.
Since <code class="docutils literal"><span class="pre">scope</span></code> attribute is omitted in this example, <code class="docutils literal"><span class="pre">page</span></code> scope is applied.</p>
<blockquote class="last">
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;sec&quot;</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/security/tags&quot;</span> <span class="k">%&gt;</span>
<span class="k">&lt;%-</span><span class="o">-</span> <span class="n">omitted</span> <span class="o">--</span><span class="k">%&gt;</span>
<span class="nt">&lt;sec:authentication</span> <span class="na">var=</span><span class="s">&quot;principal&quot;</span> <span class="na">property=</span><span class="s">&quot;principal&quot;</span><span class="nt">/&gt;</span>
<span class="k">&lt;%-</span><span class="o">-</span> <span class="n">omitted</span> <span class="o">--</span><span class="k">%&gt;</span>
Welcome
${f:h(principal.account.lastName)}
San
</pre></div>
</div>
</div></blockquote>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="coordination-between-authentication-process-and-spring-mvc">
<span id="springsecurityauthenticationintegrationwithspringmvc"></span><h3><a class="toc-backref" href="#id54">9.2.2.10. Coordination between authentication process and Spring MVC</a><a class="headerlink" href="#coordination-between-authentication-process-and-spring-mvc" title="Permalink to this headline">¶</a></h3>
<p>Spring Security offers various components for coordinating with Spring MVC.
How to use the components for coordinating with authentication process is explained.</p>
<div class="section" id="id5">
<h4><a class="toc-backref" href="#id55">9.2.2.10.1. Accessing authentication information</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>Spring Security offers <code class="docutils literal"><span class="pre">AuthenticationPrincipalArgumentResolver</span></code> class as a component which delivers authentication information (<code class="docutils literal"><span class="pre">UserDetails</span></code>) to Spring MVC controller method.
If <code class="docutils literal"><span class="pre">AuthenticationPrincipalArgumentResolver</span></code> is used, <code class="docutils literal"><span class="pre">UserDetails</span></code> interface or instance of its implementation class can be received as a method argument of controller resulting in enhanced coupling of components.</p>
<p><code class="docutils literal"><span class="pre">AuthenticationPrincipalArgumentResolver</span></code> must be applied to Spring MVC first for receiving Authentication information (<code class="docutils literal"><span class="pre">UserDetails</span></code>) as a controller argument.
Bean for applying <code class="docutils literal"><span class="pre">AuthenticationPrincipalArgumentResolver</span></code> is as below.
Note that <code class="docutils literal"><span class="pre">AuthenticationPrincipalArgumentResolver</span></code> is already cong=figured in the <a class="reference external" href="https://github.com/terasolunaorg/terasoluna-gfw-web-multi-blank">blank project</a>.</p>
<ul class="simple">
<li>Definition example of spring-mvc.xml</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span>  <span class="nt">&lt;mvc:annotation-driven&gt;</span>
      <span class="nt">&lt;mvc:argument-resolvers&gt;</span>
          <span class="c">&lt;!-- omitted --&gt;</span>
          <span class="c">&lt;!-- (1) --&gt;</span>
          <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.method.annotation.AuthenticationPrincipalArgumentResolver&quot;</span> <span class="nt">/&gt;</span>
          <span class="c">&lt;!-- omitted --&gt;</span>
      <span class="nt">&lt;/mvc:argument-resolvers&gt;</span>
<span class="nt">&lt;/mvc:annotation-driven&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Apply <code class="docutils literal"><span class="pre">AuthenticationPrincipalArgumentResolver</span></code> in Spring MVC as an implementation class of <code class="docutils literal"><span class="pre">HandlerMethodArgumentResolver</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Following method is created while receiving authentication information (<code class="docutils literal"><span class="pre">UserDetails</span></code>) by controller method.</p>
<ul class="simple">
<li>How to create a method which receives authentication information (UserDetails)</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;account&quot;</span><span class="o">)</span>
<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccountController</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">view</span><span class="o">(</span>
            <span class="nd">@AuthenticationPrincipal</span> <span class="n">AccountUserDetails</span> <span class="n">userDetails</span><span class="o">,</span> <span class="c1">// (1)</span>
            <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">userDetails</span><span class="o">.</span><span class="na">getAccount</span><span class="o">());</span>
        <span class="k">return</span> <span class="s">&quot;profile&quot;</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Declare an argument to receive authentication information (<code class="docutils literal"><span class="pre">UserDetails</span></code>) and specify <code class="docutils literal"><span class="pre">&#64;org.springframework.security.core.annotation.AuthenticationPrincipal</span></code> as an argument annotation.</div>
<div class="line"><code class="docutils literal"><span class="pre">AuthenticationPrincipalArgumentResolver</span></code> configures authentication information (<code class="docutils literal"><span class="pre">UserDetails</span></code>) in the argument assigned by <code class="docutils literal"><span class="pre">&#64;AuthenticationPrincipal</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="how-to-extend">
<span id="springsecurityauthenticationhowtoextend"></span><h2><a class="toc-backref" href="#id56">9.2.3. How to extend</a><a class="headerlink" href="#how-to-extend" title="Permalink to this headline">¶</a></h2>
<p>The section describes customization points and extension methods offered by Spring Security.</p>
<p>Spring Security offers a lot of customization points. Since it is not possible to introduce all the customization points here, we will focus on a few typical customization points here.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="customizing-form-authentication">
<span id="springsecurityauthenticationcustomizingform"></span><h3><a class="toc-backref" href="#id57">9.2.3.1. Customizing form authentication</a><a class="headerlink" href="#customizing-form-authentication" title="Permalink to this headline">¶</a></h3>
<p>Customization points of form authentication process are explained.</p>
<div class="section" id="changing-authentication-path">
<h4><a class="toc-backref" href="#id58">9.2.3.1.1. Changing authentication path</a><a class="headerlink" href="#changing-authentication-path" title="Permalink to this headline">¶</a></h4>
<p>In Spring Security, the path for carrying out authentication process is “<code class="docutils literal"><span class="pre">/login</span></code>” by default, however
it can be changed by defining a bean as below.</p>
<ul class="simple">
<li>Definition example of spring-security.xml</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;sec:http&gt;</span>
    <span class="nt">&lt;sec:form-login</span> <span class="na">login-processing-url=</span><span class="s">&quot;/authentication&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/sec:http&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify a path for carrying out authentication process in <code class="docutils literal"><span class="pre">login-processing-url</span></code> attribute.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When path of authentication process is changed, request destination of <a class="reference internal" href="#springsecurityauthenticationloginform"><span class="std std-ref">Login form</span></a> must be changed as well.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="change-request-parameter-name-which-sends-credentials">
<h4><a class="toc-backref" href="#id59">9.2.3.1.2. Change request parameter name which sends credentials</a><a class="headerlink" href="#change-request-parameter-name-which-sends-credentials" title="Permalink to this headline">¶</a></h4>
<p>In Spring Security, request parameters for sending credentials (user name and password) are “<code class="docutils literal"><span class="pre">username</span></code>” and “<code class="docutils literal"><span class="pre">password</span></code>” by default, however,
these can be changed by defining a bean as shown below.</p>
<ul class="simple">
<li>Definition example for spring-security.xml</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;sec:http&gt;</span>
    <span class="nt">&lt;sec:form-login</span>
        <span class="na">username-parameter=</span><span class="s">&quot;uid&quot;</span>
        <span class="na">password-parameter=</span><span class="s">&quot;pwd&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) (2) --&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/sec:http&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify a request parameter name for user name in <code class="docutils literal"><span class="pre">username-parameter</span></code> attribute.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify a request parameter name for password in <code class="docutils literal"><span class="pre">password-parameter</span></code> attribute.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When request parameter name is changed, field name in <a class="reference internal" href="#springsecurityauthenticationloginform"><span class="std std-ref">Login form</span></a> must also be changed.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="customising-response-when-authentication-is-successful">
<h3><a class="toc-backref" href="#id60">9.2.3.2. Customising response when authentication is successful</a><a class="headerlink" href="#customising-response-when-authentication-is-successful" title="Permalink to this headline">¶</a></h3>
<p>Customization points of response when authentication is successful are explained.</p>
<div class="section" id="changing-default-transition-destination">
<h4><a class="toc-backref" href="#id61">9.2.3.2.1. Changing default transition destination</a><a class="headerlink" href="#changing-default-transition-destination" title="Permalink to this headline">¶</a></h4>
<p>Transition destination (default URL) after displaying login form on its own and by carrying out authentication process
is the root path of Web application (“<code class="docutils literal"><span class="pre">/</span></code>” ), however it can be changed by defining a bean as given below.</p>
<ul class="simple">
<li>Definition example of spring-security.xml</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;sec:http&gt;</span>
    <span class="nt">&lt;sec:form-login</span> <span class="na">default-target-url=</span><span class="s">&quot;/menu&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;/sec:http&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify default path for transition in <code class="docutils literal"><span class="pre">default-target-url</span></code> attribute when the authentication is successful.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="fixing-transition-destination">
<h4><a class="toc-backref" href="#id62">9.2.3.2.2. Fixing transition destination</a><a class="headerlink" href="#fixing-transition-destination" title="Permalink to this headline">¶</a></h4>
<p>In default operation of Spring Security, when a request for a page for which authentication is required is received during unauthenticated stage, the request thus received is temporarily stored in HTTP session and then transition is done to authentication page.
Although request is restored and redirected when the authentication is successful, transition to the same screen can be assured by defining a bean as below.</p>
<ul class="simple">
<li>Definition example of spring-security.xml</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;sec:http&gt;</span>
    <span class="nt">&lt;sec:form-login</span>
        <span class="na">default-target-url=</span><span class="s">&quot;/menu&quot;</span>
        <span class="na">always-use-default-target=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;/sec:http&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify <code class="docutils literal"><span class="pre">true</span></code>in <code class="docutils literal"><span class="pre">always-use-default-target</span></code> attribute.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="applying-authenticationsuccesshandler">
<h4><a class="toc-backref" href="#id63">9.2.3.2.3. Applying AuthenticationSuccessHandler</a><a class="headerlink" href="#applying-authenticationsuccesshandler" title="Permalink to this headline">¶</a></h4>
<p>When the requirements are not met only by using the system wherein default operations provided by Spring Security are customised,
implementation class of <code class="docutils literal"><span class="pre">AuthenticationSuccessHandler</span></code> interface can be applied directly by defining a bean as given below.</p>
<ul class="simple">
<li>Definition example of spring-security.xml</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;authenticationSuccessHandler&quot;</span> <span class="na">class=</span><span class="s">&quot;com.example.app.security.handler.MyAuthenticationSuccessHandler&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>

<span class="nt">&lt;sec:http&gt;</span>
    <span class="nt">&lt;sec:form-login</span> <span class="na">authentication-success-handler-ref=</span><span class="s">&quot;authenticationSuccessHandler&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;/sec:http&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define a bean for implementation class of <code class="docutils literal"><span class="pre">AuthenticationSuccessHandler</span></code> interface.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify <code class="docutils literal"><span class="pre">authenticationSuccessHandler</span></code> defined in <code class="docutils literal"><span class="pre">authentication-success-handler-ref</span></code> attribute.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Responsibility of AuthenticationSuccessHandler</strong></p>
<p><code class="docutils literal"><span class="pre">AuthenticationSuccessHandler</span></code> is an interface which performs processes for Web layer at the time of successful authentication (mainly processes related to screen transition).
Therefore, a process dependent on business rule (business logic) like clearing number of authentication failures should not be called through implementation class of this interface.</p>
<p class="last">“<a class="reference internal" href="#springsecurityauthenticationevent"><span class="std std-ref">Handling authentication event</span></a>” system introduced in earlier section should be used for calling the processes that are dependent on business rules.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="customising-response-at-the-time-of-authentication-failure">
<span id="springsecurityauthenticationcustomizingscreenflowonfailure"></span><h3><a class="toc-backref" href="#id64">9.2.3.3. Customising response at the time of authentication failure</a><a class="headerlink" href="#customising-response-at-the-time-of-authentication-failure" title="Permalink to this headline">¶</a></h3>
<p>Customization points for the response at the time of authentication failure are explained.</p>
<div class="section" id="changing-transition-destination">
<h4><a class="toc-backref" href="#id65">9.2.3.3.1. Changing transition destination</a><a class="headerlink" href="#changing-transition-destination" title="Permalink to this headline">¶</a></h4>
<p>In default operation of Spring Security, the user is redirected to a URL wherein a query parameter <code class="docutils literal"><span class="pre">error</span></code>is assigned to path for displaying login form, however
it can be changed by defining a bean as given below.</p>
<ul class="simple">
<li>Definition example of spring-security.xml</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;sec:http&gt;</span>
    <span class="nt">&lt;sec:form-login</span> <span class="na">authentication-failure-url=</span><span class="s">&quot;/loginFailure&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;/sec:http&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify a path for transition in <code class="docutils literal"><span class="pre">authentication-failure-url</span></code> attribute at the time of authentication failure.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="applying-authenticationfailurehandler">
<h4><a class="toc-backref" href="#id66">9.2.3.3.2. Applying AuthenticationFailureHandler</a><a class="headerlink" href="#applying-authenticationfailurehandler" title="Permalink to this headline">¶</a></h4>
<p>When the requirements are not met only by using the system wherein default operations provided by Spring Security are customised,
implementation class of <code class="docutils literal"><span class="pre">AuthenticationFailureHandler</span></code> interface can be applied directly by defining a bean as below.</p>
<ul class="simple">
<li>Definition example of spring-security.xml</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span> <span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;authenticationFailureHandler&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.authentication.ExceptionMappingAuthenticationFailureHandler&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultFailureUrl&quot;</span> <span class="na">value=</span><span class="s">&quot;/login/systemError&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionMappings&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
        <span class="nt">&lt;props&gt;</span>
            <span class="nt">&lt;prop</span> <span class="na">key=</span><span class="s">&quot;org.springframework.security.authentication.BadCredentialsException&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (4) --&gt;</span>
                /login/badCredentials
            <span class="nt">&lt;/prop&gt;</span>
            <span class="nt">&lt;prop</span> <span class="na">key=</span><span class="s">&quot;org.springframework.security.core.userdetails.UsernameNotFoundException&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (5) --&gt;</span>
                /login/usernameNotFound
            <span class="nt">&lt;/prop&gt;</span>
            <span class="nt">&lt;prop</span> <span class="na">key=</span><span class="s">&quot;org.springframework.security.authentication.DisabledException&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (6) --&gt;</span>
                /login/disabled
            <span class="nt">&lt;/prop&gt;</span>
            <span class="c">&lt;!-- omitted --&gt;</span>
        <span class="nt">&lt;/props&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;sec:http&gt;</span>
    <span class="nt">&lt;sec:form-login</span> <span class="na">authentication-failure-handler-ref=</span><span class="s">&quot;authenticationFailureHandler&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (7) --&gt;</span>
<span class="nt">&lt;/sec:http&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define a bean for implementation class of <code class="docutils literal"><span class="pre">AuthenticationFailureHandler</span></code> interface.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify default transition destination URL in <code class="docutils literal"><span class="pre">defaultFailureUrl</span></code> attribute.</div>
<div class="line">When the exceptions that do not match the definitions given in (4)~(6) below occur, move to transition destination of the configuration.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set implementation class of <code class="docutils literal"><span class="pre">org.springframework.security.authentication.AuthenticationServiceException</span></code> handled in the <code class="docutils literal"><span class="pre">exceptionMappings</span></code> property and transition destination at the time exception occurrence in <code class="docutils literal"><span class="pre">Map</span></code> format.</div>
<div class="line">Set implementation class of <code class="docutils literal"><span class="pre">org.springframework.security.authentication.AuthenticationServiceException</span></code> in key and set transition destination URL in value.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">BadCredentialsException</span></code></div>
<div class="line">It is thrown at the time of authentication error due to password verification failure.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">UsernameNotFoundException</span></code></div>
<div class="line">It is thrown at the time of authentication error due to invalid user ID (non-existent user ID).</div>
<div class="line">When <code class="docutils literal"><span class="pre">org.springframework.security.authentication.dao.AbstractUserDetailsAuthenticationProvider</span></code> specifies inherited class in</div>
<div class="line">the authentication provider, the exception changes to <code class="docutils literal"><span class="pre">BadCredentialsException</span></code> if <code class="docutils literal"><span class="pre">hideUserNotFoundExceptions</span></code> property is not changed to <code class="docutils literal"><span class="pre">false</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"> <code class="docutils literal"><span class="pre">DisabledException</span></code></div>
<div class="line">It is thrown at the time of authentication error due to invalid user ID.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set <code class="docutils literal"><span class="pre">authenticationFailureHandler</span></code> in <code class="docutils literal"><span class="pre">authentication-failure-handler-ref</span></code> attribute.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Control during occurrence of exception</strong></p>
<p>When an exception defined in <code class="docutils literal"><span class="pre">exceptionMappings</span></code> property occur, the user is redirected to transition destination mapped in the exception, however,
since exception object thus occurred is not stored in the session scope, error message generated by Spring Security cannot be displayed on the screen.</p>
<p>Therefore, error message displayed in the transition destination screen must be generated by the process for redirect (Controller or View process).</p>
<p>Further, it must be added that since the processes referring properties below are not called, operation does not undergo any change even after changing the setup value.</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">useForward</span></code></li>
<li><code class="docutils literal"><span class="pre">allowSessionCreation</span></code></li>
</ul>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="customising-logout-process">
<h3><a class="toc-backref" href="#id67">9.2.3.4. Customising logout process</a><a class="headerlink" href="#customising-logout-process" title="Permalink to this headline">¶</a></h3>
<p>Customization points for logout process are explained.</p>
<div class="section" id="changing-logout-path">
<h4><a class="toc-backref" href="#id68">9.2.3.4.1. Changing logout path</a><a class="headerlink" href="#changing-logout-path" title="Permalink to this headline">¶</a></h4>
<p>In Spring Security, default path which carries out logout process is “<code class="docutils literal"><span class="pre">/logout</span></code>”, however
it can be changed by defining a bean as given below.</p>
<ul class="simple">
<li>Definition example of spring-security.xml</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;sec:http&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
    <span class="nt">&lt;sec:logout</span> <span class="na">logout-url=</span><span class="s">&quot;/auth/logout&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/sec:http&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set <code class="docutils literal"><span class="pre">logout-url</span></code> attribute and specify path to carry out logout process.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When logout path is changed, request destination of <a class="reference internal" href="#springsecurityauthenticationlogoutform"><span class="std std-ref">logout form</span></a> must be changed as well.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>Behaviour during occurrence of system error</strong>
When system error occurs, discontinuation of operations is likely.
If the operation is not to be continued after occurrence of system error, adopting following measures is recommended.</p>
<blockquote>
<div><ul class="simple">
<li>Clear session information when the system error occurs.</li>
<li>Clear authentication information when the system error occurs</li>
</ul>
</div></blockquote>
<p>An example wherein authentication information at the time of system exception occurrence is cleared using an exception handling function of common library is explained.
For details of exception handling function, refer “<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/ExceptionHandling.html"><span class="doc">Exception Handling</span></a>”.</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LogoutSystemExceptionResolver</span> <span class="kd">extends</span> <span class="n">SystemExceptionResolver</span> <span class="o">{</span>
    <span class="c1">// (2)</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">ModelAndView</span> <span class="nf">doResolveException</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
            <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Object</span> <span class="n">handler</span><span class="o">,</span>
            <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// Carry out SystemExceptionResolver</span>
        <span class="n">ModelAndView</span> <span class="n">resulut</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">doResolveException</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span>
                <span class="n">handler</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>

        <span class="c1">// Clear authentication information (2)</span>
        <span class="n">SecurityContextHolder</span><span class="o">.</span><span class="na">clearContext</span><span class="o">();</span>

        <span class="k">return</span> <span class="n">resulut</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Extend <code class="docutils literal"><span class="pre">org.terasoluna.gfw.web.exception.SystemExceptionResolver.SystemExceptionResolver</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Clear authentication information.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p class="last">Further, the same requirement can also be met by clearing the session, besides using the method that clears authentication information.
Implement according to the project requirement.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="customising-response-when-logout-is-successful">
<span id="springsecuritylogoutcustomizingscreenflowonsuccess"></span><h3><a class="toc-backref" href="#id69">9.2.3.5. Customising response when logout is successful</a><a class="headerlink" href="#customising-response-when-logout-is-successful" title="Permalink to this headline">¶</a></h3>
<p>Customization points for the response when logout process is successful is explained.</p>
<div class="section" id="id6">
<h4><a class="toc-backref" href="#id70">9.2.3.5.1. Changing transition destination</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Definition example of spring-security.xml</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;sec:http&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
    <span class="nt">&lt;sec:logout</span> <span class="na">logout-success-url=</span><span class="s">&quot;/logoutSuccess&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/sec:http&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set <code class="docutils literal"><span class="pre">logout-success-url</span></code> attribute and specify path for the transition when the logout is successful.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="applying-logoutsuccesshandler">
<h4><a class="toc-backref" href="#id71">9.2.3.5.2. Applying LogoutSuccessHandler</a><a class="headerlink" href="#applying-logoutsuccesshandler" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Definition example of spring-security.xml</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;logoutSuccessHandler&quot;</span> <span class="na">class=</span><span class="s">&quot;com.example.app.security.handler.MyLogoutSuccessHandler&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;sec:http&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
    <span class="nt">&lt;sec:logout</span> <span class="na">success-handler-ref=</span><span class="s">&quot;logoutSuccessHandler&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/sec:http&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define a bean for implementation class of <code class="docutils literal"><span class="pre">LogoutSuccessHandler</span></code> interface.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set <code class="docutils literal"><span class="pre">LogoutSuccessHandler</span></code>in <code class="docutils literal"><span class="pre">success-handler-ref</span></code> attribute.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="customising-error-message">
<span id="springsecurityauthenticationcustomizingmessage"></span><h3><a class="toc-backref" href="#id72">9.2.3.6. Customising error message</a><a class="headerlink" href="#customising-error-message" title="Permalink to this headline">¶</a></h3>
<p>When authentication fails, error message provided by Spring Security is displayed, however,
the error message can be changed.</p>
<p>For details of how to change the message, refer <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/MessageManagement.html"><span class="doc">Message Management</span></a>.</p>
<div class="section" id="message-during-system-error">
<h4><a class="toc-backref" href="#id73">9.2.3.6.1. Message during system error</a><a class="headerlink" href="#message-during-system-error" title="Permalink to this headline">¶</a></h4>
<p>When an unexpected error occurs (system error etc) during authentication process, <code class="docutils literal"><span class="pre">InternalAuthenticationServiceException</span></code> exception is thrown.
Since cause exception message is set in the message retained by <code class="docutils literal"><span class="pre">InternalAuthenticationServiceException</span></code>, it should not be displayed as it is on the screen.</p>
<p>For example, when a DB access error occurs while fetching user information from database, an exception message retained by <code class="docutils literal"><span class="pre">SQLException</span></code> is displayed on the screen.
The measures like handling <code class="docutils literal"><span class="pre">InternalAuthenticationServiceException</span></code> by using <code class="docutils literal"><span class="pre">ExceptionMappingAuthenticationFailureHandler</span></code> and
transiting to the path for notifying occurrence of system error are necessary for not displaying exception message of system error on the screen.</p>
<ul class="simple">
<li>Definition example of spring-security.xml</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span>  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;authenticationFailureHandler&quot;</span>
      <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.authentication.ExceptionMappingAuthenticationFailureHandler&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultFailureUrl&quot;</span> <span class="na">value=</span><span class="s">&quot;/login?error&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionMappings&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;props&gt;</span>
              <span class="nt">&lt;prop</span> <span class="na">key=</span><span class="s">&quot;org.springframework.security.authentication.InternalAuthenticationServiceException&quot;</span><span class="nt">&gt;</span>
                  /login?systemError
              <span class="nt">&lt;/prop&gt;</span>
              <span class="c">&lt;!-- omitted --&gt;</span>
          <span class="nt">&lt;/props&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
  <span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;sec:http&gt;</span>
    <span class="nt">&lt;sec:form-login</span> <span class="na">authentication-failure-handler-ref=</span><span class="s">&quot;authenticationFailureHandler&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/sec:http&gt;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Query parameter (<code class="docutils literal"><span class="pre">systemError</span></code>) is used for identifying occurrence of system error and transition is made to login form.
When <code class="docutils literal"><span class="pre">systemError</span></code> is specified in the query parameter, in the login form specified in the transition destination, a fixed error message is displayed instead of an authentication exception message.</p>
<ul class="simple">
<li>Implementation example of login form</li>
</ul>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;c:choose&gt;</span>
    <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">&quot;${param.containsKey(&#39;error&#39;)}&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">&quot;color: red;&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;c:out</span> <span class="na">value=</span><span class="s">&quot;${SPRING_SECURITY_LAST_EXCEPTION.message}&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/c:when&gt;</span>
    <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">&quot;${param.containsKey(&#39;systemError&#39;)}&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">&quot;color: red;&quot;</span><span class="nt">&gt;</span>
            System Error occurred.
        <span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/c:when&gt;</span>
<span class="nt">&lt;/c:choose&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">An implementation example for transiting to login form is introduced, however it is also possible to move to system error screen.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="input-check-at-the-time-of-authentication">
<span id="springsecurityauthenticationbeanvalidation"></span><h3><a class="toc-backref" href="#id74">9.2.3.7. Input check at the time of authentication</a><a class="headerlink" href="#input-check-at-the-time-of-authentication" title="Permalink to this headline">¶</a></h3>
<p>A check is carried out in advance for obvious input error on the authentication page during reduction of load on DB server etc.
In such a case, input check using Bean validation can also be carried out.</p>
<div class="section" id="input-check-using-bean-validation">
<h4><a class="toc-backref" href="#id75">9.2.3.7.1. Input check using Bean Validation</a><a class="headerlink" href="#input-check-using-bean-validation" title="Permalink to this headline">¶</a></h4>
<p>An example of input check using Bean Validation is explained below.
For details of Bean Validation, refer <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Validation.html"><span class="doc">Input Validation</span></a>.</p>
<ul class="simple">
<li>Implementation example of form class</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginForm</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="c1">// omitted</span>
    <span class="nd">@NotEmpty</span> <span class="c1">// (1)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>

    <span class="nd">@NotEmpty</span> <span class="c1">// (1)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>
    <span class="c1">// omitted</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In this example, <code class="docutils literal"><span class="pre">username</span></code>and <code class="docutils literal"><span class="pre">password</span></code> are mandatory respectively.</div>
</div>
</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Implementation example of controller class</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@ModelAttribute</span>
<span class="kd">public</span> <span class="n">LoginForm</span> <span class="nf">setupForm</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// (1)</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">LoginForm</span><span class="o">();</span>
<span class="o">}</span>

<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;login&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@Validated</span> <span class="n">LoginForm</span> <span class="n">form</span><span class="o">,</span> <span class="n">BindingResult</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// omitted</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
        <span class="c1">// omitted</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="s">&quot;forward:/authenticate&quot;</span><span class="o">;</span> <span class="c1">// (2)</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Initialise <code class="docutils literal"><span class="pre">LoginForm</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><strong>Forward</strong> to path specified in <code class="docutils literal"><span class="pre">login-processing-url</span></code> attribute of <code class="docutils literal"><span class="pre">&lt;sec:form-login&gt;</span></code>element using “forward”.</div>
<div class="line">For setup related to authentication, refer <a class="reference internal" href="#springsecurityauthenticationcustomizingform"><span class="std std-ref">Customizing form authentication</span></a>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>In addition, authentication path is added to Spring Security servlet filter for Spring Security processing even during the transition using Forward.</p>
<ul class="simple">
<li>Setup example of web.xml</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;filter-class&gt;</span>
        org.springframework.web.filter.DelegatingFilterProxy
    <span class="nt">&lt;/filter-class&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span>
<span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/authenticate<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;dispatcher&gt;</span>FORWARD<span class="nt">&lt;/dispatcher&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify pattern for authentication by using Forward.</div>
<div class="line">Here <code class="docutils literal"><span class="pre">/authenticate</span></code> is specified as an authentication path.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="expansion-of-authentication-process">
<h3><a class="toc-backref" href="#id76">9.2.3.8. Expansion of authentication process</a><a class="headerlink" href="#expansion-of-authentication-process" title="Permalink to this headline">¶</a></h3>
<p>In case of authentication requirements which cannot be handled by <a class="reference external" href="http://docs.spring.io/spring-security/site/docs/4.2.4.RELEASE/apidocs/org/springframework/security/authentication/AuthenticationProvider.html">authentication provider</a> offered by Spring Security,
a class which implements <code class="docutils literal"><span class="pre">org.springframework.security.authentication.AuthenticationProvider</span></code> interface must be created.</p>
<p>Here, an expansion example for performing DB authentication by using 3 parameters - user name, password and <strong>Company identifier (unique authentication parameter)</strong>is shown below.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/Authentication_HowToExtends_LoginForm.png"><img alt="Authentication_HowToExtends_LoginForm" src="../_images/Authentication_HowToExtends_LoginForm.png" style="width: 50%;" /></a>
</div>
<p>A class shown below must be created for implementing above requirements.</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">An implementation class of <code class="docutils literal"><span class="pre">org.springframework.security.core.Authentication</span></code> interface which retains user name, password and company identifier.</div>
<div class="line">It is created by inheriting <code class="docutils literal"><span class="pre">org.springframework.security.authentication.UsernamePasswordAuthenticationToken</span></code> class.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">An implementation class of <code class="docutils literal"><span class="pre">org.springframework.security.authentication.AuthenticationProvider</span></code> which performs DB authentication by using user name, password and company identifier.</div>
<div class="line">It is created by inheriting <code class="docutils literal"><span class="pre">org.springframework.security.authentication.dao.DaoAuthenticationProvider</span></code> class.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">An Authentication Filter class for generating <code class="docutils literal"><span class="pre">Authentication</span></code> which is passed to <code class="docutils literal"><span class="pre">AuthenticationManager</span></code>(<code class="docutils literal"><span class="pre">AuthenticationProvider</span></code>) by fetching user name, password and company identifier from request parameters.</div>
<div class="line">It is created by inheriting <code class="docutils literal"><span class="pre">org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter</span></code> class.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Since a unique parameter is added as an parameter for authentication in this example,
implementation class of <code class="docutils literal"><span class="pre">Authentication</span></code>interface and Authentication Filter class for generating <code class="docutils literal"><span class="pre">Authentication</span></code> must be expanded.</p>
<p class="last">When the authentication is to be performed only by user name and password, authentication process can be expanded only by creating implementation class of <code class="docutils literal"><span class="pre">AuthenticationProvider</span></code> interface</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="creating-an-implementation-class-of-authentication-interface">
<h4><a class="toc-backref" href="#id77">9.2.3.8.1. Creating an implementation class of Authentication interface</a><a class="headerlink" href="#creating-an-implementation-class-of-authentication-interface" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">UsernamePasswordAuthenticationToken</span></code> class is inherited and a class that retains a company identifier (unique authentication parameter) besides user name and password is created.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// import omitted</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CompanyIdUsernamePasswordAuthenticationToken</span> <span class="kd">extends</span>
    <span class="n">UsernamePasswordAuthenticationToken</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="n">SpringSecurityCoreVersion</span><span class="o">.</span><span class="na">SERIAL_VERSION_UID</span><span class="o">;</span>

    <span class="c1">// (1)</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">companyId</span><span class="o">;</span>

    <span class="c1">// (2)</span>
    <span class="kd">public</span> <span class="nf">CompanyIdUsernamePasswordAuthenticationToken</span><span class="o">(</span>
            <span class="n">Object</span> <span class="n">principal</span><span class="o">,</span> <span class="n">Object</span> <span class="n">credentials</span><span class="o">,</span> <span class="n">String</span> <span class="n">companyId</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">principal</span><span class="o">,</span> <span class="n">credentials</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">companyId</span> <span class="o">=</span> <span class="n">companyId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (3)</span>
    <span class="kd">public</span> <span class="nf">CompanyIdUsernamePasswordAuthenticationToken</span><span class="o">(</span>
            <span class="n">Object</span> <span class="n">principal</span><span class="o">,</span> <span class="n">Object</span> <span class="n">credentials</span><span class="o">,</span> <span class="n">String</span> <span class="n">companyId</span><span class="o">,</span>
            <span class="n">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">GrantedAuthority</span><span class="o">&gt;</span> <span class="n">authorities</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">principal</span><span class="o">,</span> <span class="n">credentials</span><span class="o">,</span> <span class="n">authorities</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">companyId</span> <span class="o">=</span> <span class="n">companyId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getCompanyId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">companyId</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create a field that retains a company identifier.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create a constructor to be used while creating an instance which retains information prior to authentication (information specified by request parameter).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create a constructor to be used while creating an instance which retains authenticated information.</div>
<div class="line">Authenticated state is reached by passing authorization information to the argument of parent class constructor.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="creating-an-implementation-class-of-authenticationprovider-interface">
<h4><a class="toc-backref" href="#id78">9.2.3.8.2. Creating an implementation class of AuthenticationProvider interface</a><a class="headerlink" href="#creating-an-implementation-class-of-authenticationprovider-interface" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">DaoAuthenticationProvider</span></code> class is inherited and a class which performs DB authentication by using user name, password and company identifier is created.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// import omitted</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CompanyIdUsernamePasswordAuthenticationProvider</span> <span class="kd">extends</span>
    <span class="n">DaoAuthenticationProvider</span> <span class="o">{</span>

    <span class="c1">// omitted</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">additionalAuthenticationChecks</span><span class="o">(</span><span class="n">UserDetails</span> <span class="n">userDetails</span><span class="o">,</span>
            <span class="n">UsernamePasswordAuthenticationToken</span> <span class="n">authentication</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">AuthenticationException</span> <span class="o">{</span>

        <span class="c1">// (1)</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">additionalAuthenticationChecks</span><span class="o">(</span><span class="n">userDetails</span><span class="o">,</span> <span class="n">authentication</span><span class="o">);</span>

        <span class="c1">// (2)</span>
        <span class="n">CompanyIdUsernamePasswordAuthenticationToken</span> <span class="n">companyIdUsernamePasswordAuthentication</span> <span class="o">=</span>
                <span class="o">(</span><span class="n">CompanyIdUsernamePasswordAuthenticationToken</span><span class="o">)</span> <span class="n">authentication</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">requestedCompanyId</span> <span class="o">=</span> <span class="n">companyIdUsernamePasswordAuthentication</span><span class="o">.</span><span class="na">getCompanyId</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">companyId</span> <span class="o">=</span> <span class="o">((</span><span class="n">SampleUserDetails</span><span class="o">)</span> <span class="n">userDetails</span><span class="o">).</span><span class="na">getAccount</span><span class="o">().</span><span class="na">getCompanyId</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">companyId</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">requestedCompanyId</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">BadCredentialsException</span><span class="o">(</span><span class="n">messages</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(</span>
                    <span class="s">&quot;AbstractUserDetailsAuthenticationProvider.badCredentials&quot;</span><span class="o">,</span>
                    <span class="s">&quot;Bad credentials&quot;</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">Authentication</span> <span class="nf">createSuccessAuthentication</span><span class="o">(</span><span class="n">Object</span> <span class="n">principal</span><span class="o">,</span>
            <span class="n">Authentication</span> <span class="n">authentication</span><span class="o">,</span> <span class="n">UserDetails</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">companyId</span> <span class="o">=</span> <span class="o">((</span><span class="n">SampleUserDetails</span><span class="o">)</span> <span class="n">user</span><span class="o">).</span><span class="na">getAccount</span><span class="o">()</span>
                <span class="o">.</span><span class="na">getCompanyId</span><span class="o">();</span>
        <span class="c1">// (3)</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">CompanyIdUsernamePasswordAuthenticationToken</span><span class="o">(</span><span class="n">user</span><span class="o">,</span>
                <span class="n">authentication</span><span class="o">.</span><span class="na">getCredentials</span><span class="o">(),</span> <span class="n">companyId</span><span class="o">,</span>
                <span class="n">user</span><span class="o">.</span><span class="na">getAuthorities</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">supports</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">authentication</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// (4)</span>
        <span class="k">return</span> <span class="n">CompanyIdUsernamePasswordAuthenticationToken</span><span class="o">.</span><span class="na">class</span>
                <span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">authentication</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Call parent class method and implement check process provided by Spring Security.</div>
<div class="line">This process also includes password authentication process.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When password authentication is successful, check validity of company identifier (unique authentication parameter).</div>
<div class="line">In the example above, it is checked whether the requested company identifier and the company identifier retained in the table are identical.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When password authentication and unique authentication process are successful, <code class="docutils literal"><span class="pre">CompanyIdUsernamePasswordAuthenticationToken</span></code>is created in an authenticated state and then returned.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When castable <code class="docutils literal"><span class="pre">Authentication</span></code> is specified in <code class="docutils literal"><span class="pre">CompanyIdUsernamePasswordAuthenticationToken</span></code>, perform authentication process by using this class.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">User existence check, user status check (checks for invalid user, locked user, expired user etc) are carried out as
processes of parent class before calling <code class="docutils literal"><span class="pre">additionalAuthenticationChecks</span></code> method.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="creating-authentication-filter">
<span id="authentication-custom-usernamepasswordauthenticationfilter"></span><h4><a class="toc-backref" href="#id79">9.2.3.8.3. Creating Authentication Filter</a><a class="headerlink" href="#creating-authentication-filter" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">UsernamePasswordAuthenticationFilter</span></code> class is inherited and
an Authentication Filter class is created for passing authentication information (user name, password and company identifier) to <code class="docutils literal"><span class="pre">AuthenticationProvider</span></code>.</p>
<p><code class="docutils literal"><span class="pre">attemptAuthentication</span></code> method implementation is customised by copying method of <code class="docutils literal"><span class="pre">UsernamePasswordAuthenticationFilter</span></code> class.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// import omitted</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CompanyIdUsernamePasswordAuthenticationFilter</span> <span class="kd">extends</span>
    <span class="n">UsernamePasswordAuthenticationFilter</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Authentication</span> <span class="nf">attemptAuthentication</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
            <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">AuthenticationException</span> <span class="o">{</span>

        <span class="k">if</span> <span class="o">(!</span><span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;POST&quot;</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">AuthenticationServiceException</span><span class="o">(</span><span class="s">&quot;Authentication method not supported: &quot;</span>
                    <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">());</span>
        <span class="o">}</span>

        <span class="c1">// (1)</span>
        <span class="c1">// Obtain UserName, Password, CompanyId</span>
        <span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">obtainUsername</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">obtainPassword</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">companyId</span> <span class="o">=</span> <span class="n">obtainCompanyId</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">username</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">username</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">password</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">password</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">CompanyIdUsernamePasswordAuthenticationToken</span> <span class="n">authRequest</span> <span class="o">=</span>
            <span class="k">new</span> <span class="n">CompanyIdUsernamePasswordAuthenticationToken</span><span class="o">(</span><span class="n">username</span><span class="o">,</span> <span class="n">password</span><span class="o">,</span> <span class="n">companyId</span><span class="o">);</span>

        <span class="c1">// Allow subclasses to set the &quot;details&quot; property</span>
        <span class="n">setDetails</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">authRequest</span><span class="o">);</span>

        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">getAuthenticationManager</span><span class="o">().</span><span class="na">authenticate</span><span class="o">(</span><span class="n">authRequest</span><span class="o">);</span> <span class="c1">// (2)</span>
    <span class="o">}</span>

    <span class="c1">// (3)</span>
    <span class="kd">protected</span> <span class="n">String</span> <span class="nf">obtainCompanyId</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;companyId&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Generate an instance of <code class="docutils literal"><span class="pre">CompanyIdUsernamePasswordAuthenticationToken</span></code> from the authentication information fetched from request parameter (user name, password, company identifier).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify authentication information specified by request parameter (<code class="docutils literal"><span class="pre">CompanyIdUsernamePasswordAuthenticationToken</span></code> instance) and call <code class="docutils literal"><span class="pre">authenticate</span></code> method of <code class="docutils literal"><span class="pre">org.springframework.security.authentication.AuthenticationManager</span></code>.</div>
<div class="line"><br /></div>
<div class="line">If <code class="docutils literal"><span class="pre">AuthenticationManager</span></code> method is called, <code class="docutils literal"><span class="pre">AuthenticationProvider</span></code> authentication process gets called.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Company identifier is fetched by using request parameter <code class="docutils literal"><span class="pre">companyId</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="modifying-login-form">
<h4><a class="toc-backref" href="#id80">9.2.3.8.4. Modifying login form</a><a class="headerlink" href="#modifying-login-form" title="Permalink to this headline">¶</a></h4>
<p>Company identifier is added for login form (JSP) created by <a class="reference internal" href="#springsecurityauthenticationloginform"><span class="std std-ref">Creating login form</span></a>.</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;form:form</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/login&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;</span>User Name<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;username&quot;</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;companyId&quot;</span><span class="nt">&gt;</span>Company Id<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;companyId&quot;</span> <span class="na">name=</span><span class="s">&quot;companyId&quot;</span><span class="nt">&gt;&lt;/td&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;</span>Password<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">id=</span><span class="s">&quot;password&quot;</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/form:form&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify <code class="docutils literal"><span class="pre">companyId</span></code> in input field name of company identifier.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="applying-expanded-authentication-process">
<h4><a class="toc-backref" href="#id81">9.2.3.8.5. Applying expanded authentication process</a><a class="headerlink" href="#applying-expanded-authentication-process" title="Permalink to this headline">¶</a></h4>
<p>DB authentication process which use user name, password and company identifier (unique authentication parameter) are applied in Spring Security.</p>
<ul class="simple">
<li>Definition example of spring-security.xml</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- omitted --&gt;</span>

<span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;sec:http</span>
    <span class="na">entry-point-ref=</span><span class="s">&quot;loginUrlAuthenticationEntryPoint&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- omitted --&gt;</span>

    <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;sec:custom-filter</span>
        <span class="na">position=</span><span class="s">&quot;FORM_LOGIN_FILTER&quot;</span> <span class="na">ref=</span><span class="s">&quot;companyIdUsernamePasswordAuthenticationFilter&quot;</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- omitted --&gt;</span>

    <span class="nt">&lt;sec:csrf</span> <span class="na">token-repository-ref=</span><span class="s">&quot;csrfTokenRepository&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;sec:logout</span>
        <span class="na">logout-url=</span><span class="s">&quot;/logout&quot;</span>
        <span class="na">logout-success-url=</span><span class="s">&quot;/login&quot;</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- omitted --&gt;</span>

    <span class="nt">&lt;sec:intercept-url</span> <span class="na">pattern=</span><span class="s">&quot;/login&quot;</span> <span class="na">access=</span><span class="s">&quot;permitAll&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;sec:intercept-url</span> <span class="na">pattern=</span><span class="s">&quot;/**&quot;</span> <span class="na">access=</span><span class="s">&quot;isAuthenticated()&quot;</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- omitted --&gt;</span>

<span class="nt">&lt;/sec:http&gt;</span>

<span class="c">&lt;!-- (3) --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;loginUrlAuthenticationEntryPoint&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.authentication.LoginUrlAuthenticationEntryPoint&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">value=</span><span class="s">&quot;/login&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="c">&lt;!-- (4) --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;companyIdUsernamePasswordAuthenticationFilter&quot;</span>
    <span class="na">class=</span><span class="s">&quot;com.example.app.common.security.CompanyIdUsernamePasswordAuthenticationFilter&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- (5) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;requiresAuthenticationRequestMatcher&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.util.matcher.AntPathRequestMatcher&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">value=</span><span class="s">&quot;/authentication&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;POST&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="c">&lt;!-- (6) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;authenticationManager&quot;</span> <span class="na">ref=</span><span class="s">&quot;authenticationManager&quot;</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!-- (7) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;sessionAuthenticationStrategy&quot;</span> <span class="na">ref=</span><span class="s">&quot;sessionAuthenticationStrategy&quot;</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!-- (8) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;authenticationFailureHandler&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.authentication.SimpleUrlAuthenticationFailureHandler&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;constructor-arg</span> <span class="na">value=</span><span class="s">&quot;/login?error=true&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="c">&lt;!-- (9) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;authenticationSuccessHandler&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.authentication.SimpleUrlAuthenticationSuccessHandler&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="c">&lt;!-- (6&#39;) --&gt;</span>
<span class="nt">&lt;sec:authentication-manager</span> <span class="na">alias=</span><span class="s">&quot;authenticationManager&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;sec:authentication-provider</span> <span class="na">ref=</span><span class="s">&quot;companyIdUsernamePasswordAuthenticationProvider&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/sec:authentication-manager&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;companyIdUsernamePasswordAuthenticationProvider&quot;</span>
    <span class="na">class=</span><span class="s">&quot;com.example.app.common.security.CompanyIdUsernamePasswordAuthenticationProvider&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;userDetailsService&quot;</span> <span class="na">ref=</span><span class="s">&quot;sampleUserDetailsService&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;passwordEncoder&quot;</span> <span class="na">ref=</span><span class="s">&quot;passwordEncoder&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="c">&lt;!-- (7&#39;) --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;sessionAuthenticationStrategy&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.authentication.session.CompositeSessionAuthenticationStrategy&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg&gt;</span>
        <span class="nt">&lt;util:list&gt;</span>
            <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.csrf.CsrfAuthenticationStrategy&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;constructor-arg</span> <span class="na">ref=</span><span class="s">&quot;csrfTokenRepository&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/bean&gt;</span>
            <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.authentication.session.SessionFixationProtectionStrategy&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/util:list&gt;</span>
    <span class="nt">&lt;/constructor-arg&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;csrfTokenRepository&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.csrf.HttpSessionCsrfTokenRepository&quot;</span> <span class="nt">/&gt;</span>


<span class="c">&lt;!-- omitted --&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">When <code class="docutils literal"><span class="pre">FORM_LOGIN_FILTER</span></code> is to be changed by using <code class="docutils literal"><span class="pre">&lt;sec:custom-filter&gt;</span></code> tag of (2), following settings must be applied to <code class="docutils literal"><span class="pre">&lt;sec:http&gt;</span></code> tag attribute.</div>
</div>
<ul class="last simple">
<li>Since auto-configuration cannot be used, <code class="docutils literal"><span class="pre">auto-config=&quot;false&quot;</span></code> is specified or <code class="docutils literal"><span class="pre">auto-config</span></code> attribute is deleted.</li>
<li>Since <code class="docutils literal"><span class="pre">&lt;sec:form-login&gt;</span></code> tag cannot be used, <code class="docutils literal"><span class="pre">AuthenticationEntryPoint</span></code> is specified explicitly by using <code class="docutils literal"><span class="pre">entry-point-ref</span></code> attribute.</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use <code class="docutils literal"><span class="pre">&lt;sec:custom-filter&gt;</span></code> tag and change <code class="docutils literal"><span class="pre">FORM_LOGIN_FILTER</span></code>.</div>
<div class="line"><br /></div>
<div class="line">Specify <code class="docutils literal"><span class="pre">FORM_LOGIN_FILTER</span></code> in <code class="docutils literal"><span class="pre">position</span></code> attribute of <code class="docutils literal"><span class="pre">&lt;sec:custom-filter&gt;</span></code> tag and specify a bean for Authentication Filter expanded in <code class="docutils literal"><span class="pre">ref</span></code> attribute.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify a bean of <code class="docutils literal"><span class="pre">AuthenticationEntryPoint</span></code>used in <code class="docutils literal"><span class="pre">entry-point-ref</span></code> attribute of <code class="docutils literal"><span class="pre">&lt;sec:http&gt;</span></code> tag.</div>
<div class="line"><br /></div>
<div class="line">Here, a bean of <code class="docutils literal"><span class="pre">org.springframework.security.web.authentication.LoginUrlAuthenticationEntryPoint</span></code> class used while specifying <code class="docutils literal"><span class="pre">&lt;sec:form-login&gt;</span></code> tag is specified.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define a bean of Authentication Filter class used as <code class="docutils literal"><span class="pre">FORM_LOGIN_FILTER</span></code>.</div>
<div class="line"><br /></div>
<div class="line">Here, a bean of expanded Authentication Filter class (<code class="docutils literal"><span class="pre">CompanyIdUsernamePasswordAuthenticationFilter</span></code>) is defined.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify <code class="docutils literal"><span class="pre">RequestMatcher</span></code> instance for detecting a request performing authentication process, in <code class="docutils literal"><span class="pre">requiresAuthenticationRequestMatcher</span></code> property.</div>
<div class="line"><br /></div>
<div class="line">It is configured to perform authentication process when a request is raised in the <code class="docutils literal"><span class="pre">/authentication</span></code> path.</div>
<div class="line">This is similar to specifying <code class="docutils literal"><span class="pre">/authentication</span></code> in <code class="docutils literal"><span class="pre">login-processing-url</span></code> attribute of <code class="docutils literal"><span class="pre">&lt;sec:form-login&gt;</span></code> tag.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify a value set in <code class="docutils literal"><span class="pre">alias</span></code> attribute of <code class="docutils literal"><span class="pre">&lt;sec:authentication-manager&gt;</span></code> tag, in <code class="docutils literal"><span class="pre">authenticationManager</span></code> property.</div>
<div class="line"><br /></div>
<div class="line">If <code class="docutils literal"><span class="pre">alias</span></code> attribute of <code class="docutils literal"><span class="pre">&lt;sec:authentication-manager&gt;</span></code> tag is specified,</div>
<div class="line">a bean of <code class="docutils literal"><span class="pre">AuthenticationManager</span></code> generated by Spring Security can be used for DI of another bean.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(6’)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set expanded <code class="docutils literal"><span class="pre">AuthenticationProvider</span></code>(<code class="docutils literal"><span class="pre">CompanyIdUsernamePasswordAuthenticationProvider</span></code>) for <code class="docutils literal"><span class="pre">AuthenticationManager</span></code> generated by Spring Security.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify a bean of component (<code class="docutils literal"><span class="pre">SessionAuthenticationStrategy</span></code>) that controls handling of a session during successful authentication in <code class="docutils literal"><span class="pre">sessionAuthenticationStrategy</span></code> property.</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7’)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">Define a bean of component (<code class="docutils literal"><span class="pre">SessionAuthenticationStrategy</span></code>) that controls handling of a session during successful authentication.</div>
<div class="line"><br /></div>
<div class="line">Here,</div>
</div>
<ul class="simple">
<li>A component to recreate CSRF token (<code class="docutils literal"><span class="pre">CsrfAuthenticationStrategy</span></code>)</li>
<li>A component to generate a new session for preventing session fixation attack (<code class="docutils literal"><span class="pre">SessionFixationProtectionStrategy</span></code>)</li>
</ul>
<div class="last line-block">
<div class="line">offered by Spring Security are enabled.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify a handler class in <code class="docutils literal"><span class="pre">authenticationFailureHandler</span></code> property which is called at the time of authentication failure.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify a handler class in <code class="docutils literal"><span class="pre">authenticationSuccessHandler</span></code> property which is called at the time of successful authentication.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Regarding auto-config</strong></p>
<p class="last">When Basic authentication process and logout process are to be enabled by specifying <code class="docutils literal"><span class="pre">auto-config=&quot;false&quot;</span></code> or by omitting specification, <code class="docutils literal"><span class="pre">&lt;sec:http-basic&gt;</span></code> tag and <code class="docutils literal"><span class="pre">&lt;sec:logout&gt;</span></code> tag must be defined explicitly.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="using-passwordencoder-of-deprecated-package">
<span id="authenticationhowtoextendusingdeprecatedpasswordencoder"></span><h3><a class="toc-backref" href="#id82">9.2.3.9. Using PasswordEncoder of deprecated package</a><a class="headerlink" href="#using-passwordencoder-of-deprecated-package" title="Permalink to this headline">¶</a></h3>
<p>Based on security requirements, it is likely that the implementation is not possible using the class which implements <code class="docutils literal"><span class="pre">PasswordEncoder</span></code> described earlier.
In particular, when it is necessary to follow hashing requirements used in the existing account information, it may not meet the requirements of <code class="docutils literal"><span class="pre">PasswordEncoder</span></code> described earlier.</p>
<p>Basically, existing hashing requirements are as given below.</p>
<ul class="simple">
<li>Algorithm is SHA-512.</li>
<li>Stretching frequency is 1000.</li>
<li>Salt is stored in the account table column and it must be passed from outside of <code class="docutils literal"><span class="pre">PasswordEncoder</span></code>.</li>
</ul>
<p>In such a case, implementation class of <code class="docutils literal"><span class="pre">org.springframework.security.authentication.encoding.PasswordEncoder</span></code> interface must be used to meet requirements
instead of implementation class of <code class="docutils literal"><span class="pre">org.springframework.security.crypto.password.PasswordEncoder</span></code> interface.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In Spring Security 3.1.4 and earlier versions, a class that implements <code class="docutils literal"><span class="pre">org.springframework.security.authentication.encoding.PasswordEncoder</span></code>was used in the hashing, however, it is deprecated in the 3.1.4 and subsequent versions.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="using-shapasswordencoder">
<h4><a class="toc-backref" href="#id83">9.2.3.9.1. Using ShaPasswordEncoder</a><a class="headerlink" href="#using-shapasswordencoder" title="Permalink to this headline">¶</a></h4>
<p>This guideline explains the use of <code class="docutils literal"><span class="pre">PasswordEncoder</span></code>of deprecated package using an example of <code class="docutils literal"><span class="pre">ShaPasswordEncoder</span></code>.</p>
<p>When the hashing requirements are as below, requirements can be met by using <code class="docutils literal"><span class="pre">ShaPasswordEncoder</span></code>.</p>
<ul class="simple">
<li>Algorithm is SHA-512</li>
<li>Stretching frequency is 1000</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>First, define a bean for <code class="docutils literal"><span class="pre">ShaPasswordEncoder</span></code>.</p>
<ul class="simple">
<li>Definition example of applicationContext.xml</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id =</span><span class="s">&quot;passwordEncoder&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.springframework.security.authentication.encoding.ShaPasswordEncoder&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">value=</span><span class="s">&quot;512&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;iterations&quot;</span> <span class="na">value=</span><span class="s">&quot;1000&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define a bean for <code class="docutils literal"><span class="pre">org.springframework.security.authentication.encoding.ShaPasswordEncoder</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify type of SHA algorithm.</div>
<div class="line">The values that can be specified are “<code class="docutils literal"><span class="pre">1</span></code>” , <code class="docutils literal"><span class="pre">256</span></code>, <code class="docutils literal"><span class="pre">384</span></code>, <code class="docutils literal"><span class="pre">512</span></code>”.</div>
<div class="line">Value is “<code class="docutils literal"><span class="pre">1</span></code>” when it is not specified.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify stretching frequency at the time of hashing.</div>
<div class="line">Value is 1 when it is not specified.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Next, <code class="docutils literal"><span class="pre">ShaPasswordEncoder</span></code> is applied to authentication process (<code class="docutils literal"><span class="pre">DaoAuthenticationProvider</span></code>) of Spring Security.</p>
<ul class="simple">
<li>Definition example of spring-security.xml</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;authenticationProvider&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.springframework.security.authentication.dao.DaoAuthenticationProvider&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;saltSource&quot;</span> <span class="na">ref=</span><span class="s">&quot;saltSource&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;userDetailsService&quot;</span> <span class="na">ref=</span><span class="s">&quot;userDetailsService&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;passwordEncoder&quot;</span> <span class="na">ref=</span><span class="s">&quot;passwordEncoder&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;saltSource&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.springframework.security.authentication.dao.ReflectionSaltSource&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;userPropertyToUse&quot;</span> <span class="na">value=</span><span class="s">&quot;username&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (4) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify a bean for implementation class of <code class="docutils literal"><span class="pre">org.springframework.security.authentication.dao.SaltSource</span></code> in <code class="docutils literal"><span class="pre">saltSource</span></code> property.</div>
<div class="line"><code class="docutils literal"><span class="pre">SaltSource</span></code> is an interface that fetches salt from <code class="docutils literal"><span class="pre">UserDetails</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify a bean for implementation class of <code class="docutils literal"><span class="pre">org.springframework.security.authentication.encoding.PasswordEncoder</span></code> interface in <code class="docutils literal"><span class="pre">passwordEncoder</span></code> property.</div>
<div class="line">In the example above, a bean for <code class="docutils literal"><span class="pre">ShaPasswordEncoder</span></code> is specified.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define a bean for <code class="docutils literal"><span class="pre">SaltSource</span></code>.</div>
<div class="line">In the example above, a class (<code class="docutils literal"><span class="pre">ReflectionSaltSource</span></code>) that fetches salt from <code class="docutils literal"><span class="pre">UserDetails</span></code> property using reflection, is used.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify <code class="docutils literal"><span class="pre">UserDetails</span></code> property where salt is stored.</div>
<div class="line">In the example above, a value of <code class="docutils literal"><span class="pre">username</span></code> property of <code class="docutils literal"><span class="pre">UserDetails</span></code> is used as a salt.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>When deprecated <code class="docutils literal"><span class="pre">PasswordEncoder</span></code> is to be used in the process of application, <code class="docutils literal"><span class="pre">PasswordEncoder</span></code> is used after injection.</p>
<ul class="simple">
<li>Implementation example of Java class</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Inject</span>
<span class="n">PasswordEncoder</span> <span class="n">passwordEncoder</span><span class="o">;</span>

<span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Customer</span> <span class="n">customer</span><span class="o">,</span> <span class="n">String</span> <span class="n">rawPassword</span><span class="o">,</span> <span class="n">String</span> <span class="n">userSalt</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// omitted</span>
    <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="n">passwordEncoder</span><span class="o">.</span><span class="na">encodePassword</span><span class="o">(</span><span class="n">rawPassword</span><span class="o">,</span> <span class="n">userSalt</span><span class="o">);</span> <span class="c1">// (1)</span>
    <span class="n">customer</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="n">password</span><span class="o">);</span>
    <span class="c1">// omitted</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">matches</span><span class="o">(</span><span class="n">Customer</span> <span class="n">customer</span><span class="o">,</span> <span class="n">String</span> <span class="n">rawPassword</span><span class="o">,</span> <span class="n">String</span> <span class="n">userSalt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">passwordEncoder</span><span class="o">.</span><span class="na">isPasswordValid</span><span class="o">(</span><span class="n">customer</span><span class="o">.</span><span class="na">getPassword</span><span class="o">(),</span> <span class="n">rawPassword</span><span class="o">,</span> <span class="n">userSalt</span><span class="o">);</span> <span class="c1">// (2)</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When password is to be hashed, use <code class="docutils literal"><span class="pre">encodePassword</span></code> method.</div>
<div class="line">Specify password, salt string in the method argument, in a sequence.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When the password is to be verified, use <code class="docutils literal"><span class="pre">isPasswordValid</span></code> method.</div>
<div class="line">Specify hashed password, plain text password and salt string in the method argument, in a sequence.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="appendix">
<h2><a class="toc-backref" href="#id84">9.2.4. Appendix</a><a class="headerlink" href="#appendix" title="Permalink to this headline">¶</a></h2>
<div class="section" id="receive-a-request-by-spring-mvc-and-display-login-form">
<span id="spring-security-authentication-mvc"></span><h3><a class="toc-backref" href="#id85">9.2.4.1. Receive a request by Spring MVC and display login form</a><a class="headerlink" href="#receive-a-request-by-spring-mvc-and-display-login-form" title="Permalink to this headline">¶</a></h3>
<p>A method wherein a request is received by Spring MVC and login form is displayed is explained.</p>
<ul class="simple">
<li>Definition example of spring-mvc.xml</li>
</ul>
<p>Definition example of Controller which displays login form.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;/login&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginController</span> <span class="o">{</span> <span class="c1">// (1)</span>

    <span class="nd">@RequestMapping</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">index</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;login&quot;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Return “login” as view name. src/main/webapp/WEB-INF/views/login.jsp is output by <code class="docutils literal"><span class="pre">InternalResourceViewResolver</span></code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>As per this example, it is also possible to substitute by using <code class="docutils literal"><span class="pre">&lt;mvc:view-controller&gt;</span></code> in case of a controller with only one method which simply returns only the view name.</p>
<p>For details, refer <a class="reference internal" href="../ImplementationAtEachLayer/ApplicationLayer.html#controller-method-return-html-label"><span class="std std-ref">HTML response</span></a>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="using-remember-me-authentication">
<span id="springsecurityauthenticationrememberme"></span><h3><a class="toc-backref" href="#id86">9.2.4.2. Using Remember Me authentication</a><a class="headerlink" href="#using-remember-me-authentication" title="Permalink to this headline">¶</a></h3>
<p>“<a class="reference external" href="http://docs.spring.io/spring-security/site/docs/4.2.4.RELEASE/reference/htmlsingle/#remember-me">Remember Me authentication</a>” is one of the functions to enhance
the user experience who frequently access Websites, and retains logged in state of a user for a little longer than normal lifecycle.
If this function is used, the user can login again without entering user name and password by using a Token for Remember Me authentication retained by a Cookie,
even when the browser is closed or session has timed-out.
Note that, this function is enabled only when the user has authorised retaining the logged in state.</p>
<p>Spring Security supports “Remember Me authentication of <a class="reference external" href="http://docs.spring.io/spring-security/site/docs/4.2.4.RELEASE/reference/htmlsingle/#remember-me-hash-token">Hash-Based Token</a> method and <a class="reference external" href="http://docs.spring.io/spring-security/site/docs/4.2.4.RELEASE/reference/htmlsingle/#remember-me-persistent-token">Persistent Token</a> method.
Hash-Based Token method is used as a default.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>When Remember Me authentication is to be used, <code class="docutils literal"><span class="pre">&lt;sec:remember-me&gt;</span></code> tag is added.</p>
<ul class="simple">
<li>Definition example of spring-security.xml</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;sec:http&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
    <span class="nt">&lt;sec:remember-me</span> <span class="na">key=</span><span class="s">&quot;terasoluna-tourreservation-km/ylnHv&quot;</span>
        <span class="na">token-validity-seconds=</span><span class="s">&quot;#{30 * 24 * 60 * 60}&quot;</span> <span class="nt">/&gt;</span>  <span class="c">&lt;!-- (1) (2) --&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/sec:http&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify a key value in <code class="docutils literal"><span class="pre">key</span></code> attribute for identifying an application that generates a Token for Remember Me authentication.</div>
<div class="line">When key value is not specified, a unique value is generated every time an application starts.</div>
<div class="line">Note that, when a key value retained by Hash-Based Token and a key value retained by server vary, it is handled as an invalid Token.</div>
<div class="line">In other words, when a Hash-Based Token generated before restarting an application is to be handled as a valid Token, <code class="docutils literal"><span class="pre">key</span></code> attribute must be specified.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify validity period of Token for Remember Me authentication in seconds, in the <code class="docutils literal"><span class="pre">token-validity-seconds</span></code> attribute.</div>
<div class="line">When it is not specified, the validity period is 14 days by default.</div>
<div class="line">In the example above, 30 days has been set as a validity period.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>For attributes other than above, refer <a class="reference external" href="http://docs.spring.io/spring-security/site/docs/4.2.4.RELEASE/reference/htmlsingle/#nsa-remember-me">Spring Security Reference -The Security Namespace (&lt;remember-me&gt;) -</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Changes in Spring Security 4.0</strong></p>
<p>Default value of following settings is changed from Spring Security 4.0 version</p>
<ul class="last simple">
<li>remember-me-parameter</li>
<li>remember-me-cookie</li>
</ul>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>A flag (checkbox field) to specify use of “Remember Me authentication” function  is provided in the login form.</p>
<ul class="simple">
<li>Implementation example of JSP of login form</li>
</ul>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;form:form</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/login&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- omitted --&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;remember-me&quot;</span><span class="nt">&gt;</span>Remember Me : <span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">name=</span><span class="s">&quot;remember-me&quot;</span> <span class="na">id=</span><span class="s">&quot;remember-me&quot;</span> <span class="na">type=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">checked=</span><span class="s">&quot;checked&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;&lt;/td&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
        <span class="c">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/form:form&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add a flag (checkbox item) to specify whether “Remember Me authentication” function is used, and specify <code class="docutils literal"><span class="pre">remember-me</span></code> - a default value of <code class="docutils literal"><span class="pre">remember-me-parameter</span></code> in field name (request parameter name).</div>
<div class="line">Set <code class="docutils literal"><span class="pre">true</span></code> in <code class="docutils literal"><span class="pre">value</span></code> attribute of checkbox.</div>
<div class="line">If authentication process is carried out after ticking the checkbox, “Remember Me authentication” function is applied for subsequent requests.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>About setup value of value attribute</strong></p>
<p class="last">Description of setting <code class="docutils literal"><span class="pre">true</span></code> in <code class="docutils literal"><span class="pre">value</span></code> attribute is given in <a class="reference external" href="http://docs.spring.io/autorepo/docs/spring-security/4.2.4.RELEASE/apidocs/org/springframework/security/web/authentication/rememberme/AbstractRememberMeServices.html#rememberMeRequested-javax.servlet.http.HttpServletRequest-java.lang.String-">rememberMeRequested - JavaDoc</a>,
however <code class="docutils literal"><span class="pre">on</span></code>, <code class="docutils literal"><span class="pre">yes</span></code> and “<code class="docutils literal"><span class="pre">1</span></code>” can also be set in the implementation.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="Authorization.html" title="9.3. Authorization"
             >next</a> |</li>
        <li class="right" >
          <a href="SpringSecurity.html" title="9.1. Spring Security Overview"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.4.1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >9. Security countermeasures</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
      © Copyright 2013-2018, NTT DATA Corporation. © Copyright 2013-2018, NTT Corporation.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.3.Theme is <a href="http://github.com/vimalkvn/solar-theme">Solar</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>