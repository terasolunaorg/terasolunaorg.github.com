<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>11.3. Session tutorial &#8212; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.4.1.RELEASE documentation</title>
    <link rel="stylesheet" href="../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.4.1.RELEASE',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="11.4. Spring Security Tutorial" href="TutorialSecurity.html" />
    <link rel="prev" title="11.2. Tutorial (Todo Application REST)" href="TutorialREST.html" /><script src="../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../_static/solarized-dark.css" rel="stylesheet">
<link href="../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="TutorialSecurity.html" title="11.4. Spring Security Tutorial"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="TutorialREST.html" title="11.2. Tutorial (Todo Application REST)"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.4.1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">11. Tutorials</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">11.3. Session tutorial</a><ul>
<li><a class="reference internal" href="#introduction">11.3.1. Introduction</a><ul>
<li><a class="reference internal" href="#flow-of-learning">11.3.1.1. Flow of learning</a></li>
<li><a class="reference internal" href="#lessons-to-be-learnt-in-the-tutorial">11.3.1.2. Lessons to be learnt in the tutorial</a></li>
<li><a class="reference internal" href="#target-readers">11.3.1.3. Target Readers</a></li>
<li><a class="reference internal" href="#test-environment">11.3.1.4. Test environment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#application-overview-and-requirements">11.3.2. Application overview and requirements</a><ul>
<li><a class="reference internal" href="#overview">11.3.2.1. Overview</a></li>
<li><a class="reference internal" href="#requirements">11.3.2.2. Requirements</a><ul>
<li><a class="reference internal" href="#functional-requirements">11.3.2.2.1. Functional requirements</a></li>
<li><a class="reference internal" href="#non-functional-requirements">11.3.2.2.2. Non-functional requirements</a></li>
<li><a class="reference internal" href="#configuration-of-platform">11.3.2.2.3. Configuration of platform</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#application-design">11.3.3. Application design</a><ul>
<li><a class="reference internal" href="#screen-definition">11.3.3.1. Screen definition</a></li>
<li><a class="reference internal" href="#extracting-url">11.3.3.2. Extracting URL</a></li>
<li><a class="reference internal" href="#designing-input-output-data">11.3.3.3. Designing input/output data</a><ul>
<li><a class="reference internal" href="#extracting-data">11.3.3.3.1. Extracting data</a></li>
<li><a class="reference internal" href="#defining-lifecycle">11.3.3.3.2. Defining lifecycle</a></li>
</ul>
</li>
<li><a class="reference internal" href="#determining-the-status-of-using-a-session">11.3.3.4. Determining the status of using a session</a></li>
<li><a class="reference internal" href="#method-of-implementation-to-use-data-during-the-session">11.3.3.5. Method of implementation to use data during the session</a></li>
<li><a class="reference internal" href="#considerations-while-using-session">11.3.3.6. Considerations while using session</a><ul>
<li><a class="reference internal" href="#session-synchronization">11.3.3.6.1. Session synchronization</a></li>
<li><a class="reference internal" href="#session-time-out">11.3.3.6.2. Session time out</a></li>
</ul>
</li>
<li><a class="reference internal" href="#overall-application-design">11.3.3.7. Overall application design</a></li>
</ul>
</li>
<li><a class="reference internal" href="#project-configuration">11.3.4. Project configuration</a><ul>
<li><a class="reference internal" href="#project-creation">11.3.4.1. Project creation</a></li>
<li><a class="reference internal" href="#id1">11.3.4.2. Project configuration</a></li>
<li><a class="reference internal" href="#operation-verification">11.3.4.3. Operation verification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-simple-ec-site-application">11.3.5. Creating simple EC site application</a><ul>
<li><a class="reference internal" href="#create-account-information-change-function">11.3.5.1. Create account information change function</a><ul>
<li><a class="reference internal" href="#creating-form-object">11.3.5.1.1. Creating form object</a></li>
<li><a class="reference internal" href="#creating-controller">11.3.5.1.2. Creating Controller</a></li>
<li><a class="reference internal" href="#creating-jsp">11.3.5.1.3. Creating JSP</a></li>
<li><a class="reference internal" href="#checking-operation">11.3.5.1.4. Checking operation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-cart-item-registration-function">11.3.5.2. Create cart item registration function</a><ul>
<li><a class="reference internal" href="#defining-the-bean-for-session-scope">11.3.5.2.1. Defining the Bean for session scope</a></li>
<li><a class="reference internal" href="#creating-the-form-object">11.3.5.2.2. Creating the form object</a></li>
<li><a class="reference internal" href="#id2">11.3.5.2.3. Creating Controller</a></li>
<li><a class="reference internal" href="#id3">11.3.5.2.4. Creating JSP</a></li>
<li><a class="reference internal" href="#id4">11.3.5.2.5. Checking operation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-a-mechanism-to-retain-the-product-search-information">11.3.5.3. Create a mechanism to retain the product search information</a><ul>
<li><a class="reference internal" href="#create-session-scope-bean">11.3.5.3.1. Create session scope Bean</a></li>
<li><a class="reference internal" href="#modifying-controller">11.3.5.3.2. Modifying Controller</a></li>
<li><a class="reference internal" href="#id5">11.3.5.3.3. Checking operation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-cart-item-deletion-function">11.3.5.4. Create cart item deletion function</a><ul>
<li><a class="reference internal" href="#id6">11.3.5.4.1. Creating form object</a></li>
<li><a class="reference internal" href="#id7">11.3.5.4.2. Creating Controller</a></li>
<li><a class="reference internal" href="#id8">11.3.5.4.3. Creating JSP</a></li>
<li><a class="reference internal" href="#id9">11.3.5.4.4. Checking operation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-the-product-order-function">11.3.5.5. Create the product order function</a><ul>
<li><a class="reference internal" href="#id10">11.3.5.5.1. Creating Controller</a></li>
<li><a class="reference internal" href="#id11">11.3.5.5.2. Creating JSP</a></li>
<li><a class="reference internal" href="#id12">11.3.5.5.3. Checking operation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#settings-for-session-synchronization-and-timeout">11.3.5.6. Settings for session synchronization and timeout</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion">11.3.6. Conclusion</a></li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="TutorialREST.html"
                        title="previous chapter">11.2. Tutorial (Todo Application REST)</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="TutorialSecurity.html"
                        title="next chapter">11.4. Spring Security Tutorial</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/Tutorial/TutorialSession.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="session-tutorial">
<h1>11.3. Session tutorial<a class="headerlink" href="#session-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id13">Introduction</a><ul>
<li><a class="reference internal" href="#flow-of-learning" id="id14">Flow of learning</a></li>
<li><a class="reference internal" href="#lessons-to-be-learnt-in-the-tutorial" id="id15">Lessons to be learnt in the tutorial</a></li>
<li><a class="reference internal" href="#target-readers" id="id16">Target Readers</a></li>
<li><a class="reference internal" href="#test-environment" id="id17">Test environment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#application-overview-and-requirements" id="id18">Application overview and requirements</a><ul>
<li><a class="reference internal" href="#overview" id="id19">Overview</a></li>
<li><a class="reference internal" href="#requirements" id="id20">Requirements</a><ul>
<li><a class="reference internal" href="#functional-requirements" id="id21">Functional requirements</a></li>
<li><a class="reference internal" href="#non-functional-requirements" id="id22">Non-functional requirements</a></li>
<li><a class="reference internal" href="#configuration-of-platform" id="id23">Configuration of platform</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#application-design" id="id24">Application design</a><ul>
<li><a class="reference internal" href="#screen-definition" id="id25">Screen definition</a></li>
<li><a class="reference internal" href="#extracting-url" id="id26">Extracting URL</a></li>
<li><a class="reference internal" href="#designing-input-output-data" id="id27">Designing input/output data</a><ul>
<li><a class="reference internal" href="#extracting-data" id="id28">Extracting data</a></li>
<li><a class="reference internal" href="#defining-lifecycle" id="id29">Defining lifecycle</a></li>
</ul>
</li>
<li><a class="reference internal" href="#determining-the-status-of-using-a-session" id="id30">Determining the status of using a session</a></li>
<li><a class="reference internal" href="#method-of-implementation-to-use-data-during-the-session" id="id31">Method of implementation to use data during the session</a></li>
<li><a class="reference internal" href="#considerations-while-using-session" id="id32">Considerations while using session</a><ul>
<li><a class="reference internal" href="#session-synchronization" id="id33">Session synchronization</a></li>
<li><a class="reference internal" href="#session-time-out" id="id34">Session time out</a></li>
</ul>
</li>
<li><a class="reference internal" href="#overall-application-design" id="id35">Overall application design</a></li>
</ul>
</li>
<li><a class="reference internal" href="#project-configuration" id="id36">Project configuration</a><ul>
<li><a class="reference internal" href="#project-creation" id="id37">Project creation</a></li>
<li><a class="reference internal" href="#id1" id="id38">Project configuration</a></li>
<li><a class="reference internal" href="#operation-verification" id="id39">Operation verification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-simple-ec-site-application" id="id40">Creating simple EC site application</a><ul>
<li><a class="reference internal" href="#create-account-information-change-function" id="id41">Create account information change function</a><ul>
<li><a class="reference internal" href="#creating-form-object" id="id42">Creating form object</a></li>
<li><a class="reference internal" href="#creating-controller" id="id43">Creating Controller</a></li>
<li><a class="reference internal" href="#creating-jsp" id="id44">Creating JSP</a></li>
<li><a class="reference internal" href="#checking-operation" id="id45">Checking operation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-cart-item-registration-function" id="id46">Create cart item registration function</a><ul>
<li><a class="reference internal" href="#defining-the-bean-for-session-scope" id="id47">Defining the Bean for session scope</a></li>
<li><a class="reference internal" href="#creating-the-form-object" id="id48">Creating the form object</a></li>
<li><a class="reference internal" href="#id2" id="id49">Creating Controller</a></li>
<li><a class="reference internal" href="#id3" id="id50">Creating JSP</a></li>
<li><a class="reference internal" href="#id4" id="id51">Checking operation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-a-mechanism-to-retain-the-product-search-information" id="id52">Create a mechanism to retain the product search information</a><ul>
<li><a class="reference internal" href="#create-session-scope-bean" id="id53">Create session scope Bean</a></li>
<li><a class="reference internal" href="#modifying-controller" id="id54">Modifying Controller</a></li>
<li><a class="reference internal" href="#id5" id="id55">Checking operation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-cart-item-deletion-function" id="id56">Create cart item deletion function</a><ul>
<li><a class="reference internal" href="#id6" id="id57">Creating form object</a></li>
<li><a class="reference internal" href="#id7" id="id58">Creating Controller</a></li>
<li><a class="reference internal" href="#id8" id="id59">Creating JSP</a></li>
<li><a class="reference internal" href="#id9" id="id60">Checking operation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-the-product-order-function" id="id61">Create the product order function</a><ul>
<li><a class="reference internal" href="#id10" id="id62">Creating Controller</a></li>
<li><a class="reference internal" href="#id11" id="id63">Creating JSP</a></li>
<li><a class="reference internal" href="#id12" id="id64">Checking operation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#settings-for-session-synchronization-and-timeout" id="id65">Settings for session synchronization and timeout</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion" id="id66">Conclusion</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id13">11.3.1. Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<div class="section" id="flow-of-learning">
<h3><a class="toc-backref" href="#id14">11.3.1.1. Flow of learning</a><a class="headerlink" href="#flow-of-learning" title="Permalink to this headline">¶</a></h3>
<p>In this tutorial, users will learn the how to design data for the session management and the specific method of implementation to use the session by creating a simple web application.
This tutorial will be implemented with the following flow.</p>
<ol class="arabic simple">
<li>To check the requirements of web application to be created</li>
<li>To check the method of implementation for the Controller and the procedure for designing data to meet the requirements</li>
<li>To implement on the basis of the design information</li>
</ol>
</div>
<div class="section" id="lessons-to-be-learnt-in-the-tutorial">
<h3><a class="toc-backref" href="#id15">11.3.1.2. Lessons to be learnt in the tutorial</a><a class="headerlink" href="#lessons-to-be-learnt-in-the-tutorial" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="first docutils">
<dt>How to design data for the session management</dt>
<dd><ul class="first last">
<li>Selecting data to be stored in the session</li>
<li>Discarding data in the session</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Specific method of using the session in this FW</dt>
<dd><ul class="first last">
<li>How to use &#64;SessionAttributes</li>
<li>How to use the Bean for session scope</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="target-readers">
<h3><a class="toc-backref" href="#id16">11.3.1.3. Target Readers</a><a class="headerlink" href="#target-readers" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Tutorial: Implements Todo application</li>
<li>Tutorial: Implements Spring Security</li>
</ul>
</div>
<div class="section" id="test-environment">
<h3><a class="toc-backref" href="#id17">11.3.1.4. Test environment</a><a class="headerlink" href="#test-environment" title="Permalink to this headline">¶</a></h3>
<p>This tutorial verifies the operation in the following environments.</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type</th>
<th class="head">Product</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>OS</td>
<td>Windows 7</td>
</tr>
<tr class="row-odd"><td>JVM</td>
<td><a class="reference external" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java</a> 1.8</td>
</tr>
<tr class="row-even"><td>IDE</td>
<td><a class="reference external" href="http://spring.io/tools/sts/all">Spring Tool Suite</a> 3.6.4.RELEASE (hereafter called as ‘STS’)</td>
</tr>
<tr class="row-odd"><td>Build Tool</td>
<td><a class="reference external" href="http://maven.apache.org/download.cgi">Apache Maven</a> 3.3.3 (hereafter called as ‘Maven’)</td>
</tr>
<tr class="row-even"><td>Application Server</td>
<td><a class="reference external" href="https://network.pivotal.io/products/pivotal-tcserver">Pivotal tc Server</a> Developer Edition v3.1 (Included in STS)</td>
</tr>
<tr class="row-odd"><td>Web Browser</td>
<td><a class="reference external" href="https://www.google.co.jp/chrome/browser/desktop/index.html">Google Chrome</a> 42.0.2311.90 m</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="application-overview-and-requirements">
<h2><a class="toc-backref" href="#id18">11.3.2. Application overview and requirements</a><a class="headerlink" href="#application-overview-and-requirements" title="Permalink to this headline">¶</a></h2>
<div class="section" id="overview">
<h3><a class="toc-backref" href="#id19">11.3.2.1. Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>Create a simple EC site.
User can perform the following operations on the EC site.</p>
<ul class="simple">
<li>Login to the account</li>
<li>Create an account</li>
<li>Change the information of the account created</li>
<li>View the list of products handled on the EC site</li>
<li>View the product details</li>
<li>Register the products to be purchased in a cart</li>
<li>Remove the products registered in the cart from the cart</li>
<li>Place order for the products in the cart</li>
</ul>
<p>Application overview is shown in the following diagram. XxxPages in the diagram indicate a set of screens.
In this tutorial, the interaction between the system and the user performed on 1 screen set is handled as 1 use case.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/materialSessionTutorialOverview.png"><img alt="overview" src="../_images/materialSessionTutorialOverview.png" style="width: 95%;" /></a>
</div>
</div>
<div class="section" id="requirements">
<h3><a class="toc-backref" href="#id20">11.3.2.2. Requirements</a><a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h3>
<div class="section" id="functional-requirements">
<h4><a class="toc-backref" href="#id21">11.3.2.2.1. Functional requirements</a><a class="headerlink" href="#functional-requirements" title="Permalink to this headline">¶</a></h4>
<p>Implement the following function for each screen (use case) described earlier in this application.</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Screen (use case)</th>
<th class="head">Function</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Login Pages</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Login function <strong>(created)</strong></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Account Create Pages</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Account creation function <strong>(created)</strong></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Account Update Pages</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Account information change function</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Item View Pages</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Product list view function <strong>(created)</strong></div>
<div class="line">Product details view function <strong>(created)</strong></div>
<div class="line">Cart item registration function</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Cart View Pages</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Cart item deletion function</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Order Pages</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Product order function</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Some functions have been created in advance in the project which are offered as the initial material for this tutorial.
This is done to reduce the cost to create the part that is not directly related to the session management.</p>
<p>Create unfinished function in this tutorial.
Further, implementation of domain layer/infrastructure layer has been created in unfinished function as well.
Therefore, create screens for unfinished function and application layer in this tutorial.</p>
</div>
<div class="section" id="non-functional-requirements">
<h4><a class="toc-backref" href="#id22">11.3.2.2.2. Non-functional requirements</a><a class="headerlink" href="#non-functional-requirements" title="Permalink to this headline">¶</a></h4>
<p>It is necessary to design and implement the application by considering the non-functional requirements required of that system while creating the real application.
Design/create the application in this tutorial with the assumption of non-functional requirements in this tutorial.
The specific numerical values for each requirement shown below are the hypothetical values used for learning.
It should be noted that it cannot be guaranteed that the application created in this tutorial will actually meet the requirements.</p>
<p>Availability</p>
<ul class="simple">
<li>Operation period: 24 hours</li>
<li>A planned downtime of few days in a year</li>
<li>Allow a downtime for about 1 hour</li>
<li>Target the fault recovery within 1 business day</li>
<li>Utilization: 99%</li>
</ul>
<p>Usability</p>
<ul class="simple">
<li>Operation is not guaranteed on multiple browsers and tabs</li>
</ul>
<p>Performance</p>
<ul class="simple">
<li>Number of users: 10,000</li>
<li>Number of concurrent access users: 200</li>
<li>Number of online process records: 10,000/month</li>
<li>The number of users/number of concurrent access users/number of online process records together are expected to increase 1.2 times in 1 year</li>
</ul>
<p>It is necessary to consider the above requirements while reviewing the following items to design the session management.</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Requirement</th>
<th class="head">Items to be reviewed</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Availability</div>
</div>
</td>
<td><ul class="first last simple">
<li>Status of replication in multiple-server operation</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Usability</div>
</div>
</td>
<td><ul class="first last simple">
<li>Retention of data integrity</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Performance</div>
</div>
</td>
<td><ul class="first last simple">
<li>Status of replication in multiple-server operation</li>
<li>Memory utilization</li>
</ul>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Further, passing of important information including personal information/credit card information also should be considered in the design of the session management other than the items mentioned above.</p>
</div>
<div class="section" id="configuration-of-platform">
<h4><a class="toc-backref" href="#id23">11.3.2.2.3. Configuration of platform</a><a class="headerlink" href="#configuration-of-platform" title="Permalink to this headline">¶</a></h4>
<p>Application created in this tutorial is to be operated on the following platforms.
The specific numerical values for the configuration shown below are the hypothetical values used for learning.</p>
<ul class="simple">
<li>Consider 2 configurations for each server of Web/AP/DB.</li>
<li>Memory load of AP server is 8GB and 2 slots are free</li>
</ul>
<p>It is necessary to consider the above configuration while reviewing the memory utilization and replication status to design the session management.</p>
</div>
</div>
</div>
<div class="section" id="application-design">
<span id="development-policy"></span><h2><a class="toc-backref" href="#id24">11.3.3. Application design</a><a class="headerlink" href="#application-design" title="Permalink to this headline">¶</a></h2>
<p>Determine the policy to create the application based on the requirements described earlier.
Since the domain layer/infrastructure layer have been created in this tutorial,
consider only the items related to the application layer as the target.
Further, since this tutorial aims at learning the method to use the session,
description for the items those are not directly related to the session management is omitted.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Note that an example of the process that uses the session is shown in this chapter.
It is required to follow the work instructions/operating procedures for each project in the real development.</p>
</div>
<div class="section" id="screen-definition">
<h3><a class="toc-backref" href="#id25">11.3.3.1. Screen definition</a><a class="headerlink" href="#screen-definition" title="Permalink to this headline">¶</a></h3>
<p>Define the screen on which the application is displayed, based on the requirements.
Details for the screen definition process are omitted.</p>
<p>Image for the screen to be created in this tutorial defined in the end, is as follows.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/materialSessionTutorialSpecificationOfUpdateAccountPages.png"><img alt="specification of Account Update Pages" src="../_images/materialSessionTutorialSpecificationOfUpdateAccountPages.png" style="width: 95%;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/materialSessionTutorialSpecificationsOfMainFlowPages.png"><img alt="specification of Main Flow Pages" src="../_images/materialSessionTutorialSpecificationsOfMainFlowPages.png" style="width: 95%;" /></a>
</div>
<p>Some of the transitions are given below which are omitted in the above diagram.</p>
<ul class="simple">
<li>When the user logins from the Login screen, the transition takes place to screen (5)</li>
<li>When ‘Home’ button is clicked on each screen of Account Update Pages, the transition takes place to screen (5)</li>
<li>When ‘Update Account’ button is clicked on each screen of Item View Pages, Cart View Pages and Order Pages, the transition takes place to screen (1)</li>
<li>When ‘Logout’ button is clicked on each screen of Item View Pages, Cart View Pages and Order Pages, the transition takes place to Login screen</li>
</ul>
</div>
<div class="section" id="extracting-url">
<h3><a class="toc-backref" href="#id26">11.3.3.2. Extracting URL</a><a class="headerlink" href="#extracting-url" title="Permalink to this headline">¶</a></h3>
<p>The application determines the URL that does processing, based on the screen image.</p>
<p>Set the URL and parameters for each event occurred from screen.
Assign the respective names as per the following standards.</p>
<ul class="simple">
<li>URL:/&lt;Use case name&gt;</li>
<li>Parameter:?&lt;Process name&gt;</li>
</ul>
<p>Since the use cases are divided into account creation and update in this application,
set the URLs as /account/create and /account/update respectively.</p>
<p>Further, also determine the Controller to process each URL.
Basically process 1 use case in 1 Controller.</p>
<p>Finally the extracted URL can be arranged as follows.
The Controller that is mentioned as “Created”, exists in the project provided as the initial material.
Further, the process wherein the path mentioned as “Created” is accessed, is already described within the created Controller mentioned earlier.</p>
<blockquote>
<div><table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="5%" />
<col width="20%" />
<col width="10%" />
<col width="20%" />
<col width="25%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Process name</th>
<th class="head">HTTP method</th>
<th class="head">Path</th>
<th class="head">Controller name</th>
<th class="head">Screen</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Account information change screen 1 display process</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/update?form1</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">AccountUpdateController</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/updateForm1</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Account information change screen 2 display process</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">POST</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/update?form2</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">AccountUpdateController</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/updateForm2</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Account information change confirmation screen display process</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">POST</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/update?confirm</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">AccountUpdateController</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/updateConfirm</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Account information change process</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">POST</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/update</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">AccountUpdateController</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Redirect to Account information change completion screen display process</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Account information change completion screen display process</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/update?finish</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">AccountUpdateController</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/updateFinish</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Process to return to Account information change screen 1</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">POST</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/update?redoform1</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">AccountUpdateController</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/updateForm1</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Process to return to Account information change screen 2</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">POST</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/update?redoform2</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">AccountUpdateController</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/updateForm2</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Process to return to Home</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/update?home</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">AccountUpdateController</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Redirect to Product list screen display process</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Product list screen display process (default)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/goods <strong>(created)</strong></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GoodsController <strong>(created)</strong></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/goods/showGoods</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Product list screen display process (while selecting category)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/goods?categoryId <strong>(created)</strong></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GoodsController <strong>(created)</strong></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/goods/showGoods</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(11)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Product list screen display process (while selecting page)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/goods?page <strong>(created)</strong></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GoodsController <strong>(created)</strong></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/goods/showGoods</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(12)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Product details screen display process</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/goods?{goodsId} <strong>(created)</strong></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GoodsController <strong>(created)</strong></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/goods/showGoodsDetail</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(13)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Process to add a product in the cart</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/addToCart</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GoodsController <strong>(created)</strong></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Redirect to Product list screen display process</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(14)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Cart screen view process</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/cart</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">CartController</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">cart/viewCart</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(15)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Process to delete a product from the cart</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">POST</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/cart</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">CartController</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Redirect to cart screen display process</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(16)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Order confirmation screen display process</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/order?confirm</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">OrderController</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">order/confirm</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(17)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Order processing</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">POST</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/order</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">OrderController</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Redirect to order completion screen display process</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(18)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Order completion screen display process</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/order?finish</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">OrderController</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">order/finish</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="designing-input-output-data">
<h3><a class="toc-backref" href="#id27">11.3.3.3. Designing input/output data</a><a class="headerlink" href="#designing-input-output-data" title="Permalink to this headline">¶</a></h3>
<p>Design the input/output data handled by the application based on the screen image.</p>
<div class="section" id="extracting-data">
<h4><a class="toc-backref" href="#id28">11.3.3.3.1. Extracting data</a><a class="headerlink" href="#extracting-data" title="Permalink to this headline">¶</a></h4>
<p>Extract the input/output data handled by the application screen.
The following data can be extracted based on the screen image mentioned earlier.</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="5%" />
<col width="25%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Data item name</th>
<th class="head">Data element</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Update account information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Account name, mail address, birthdate, postal code, address, card number, validity, security code</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Account information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Account name, mail address, password, birthdate, postal code, address, card number, validity, security code</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Product search information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Selection category, page number</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Product information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Product name, unit price, description, (product ID)</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Register cart information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Quantity, (product ID)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Cart information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Product name, unit price, quantity, (product ID)</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Delete cart information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Product ID list</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Order information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Order ID, order date-time, (account ID), product name, unit price, quantity</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="defining-lifecycle">
<h4><a class="toc-backref" href="#id29">11.3.3.3.2. Defining lifecycle</a><a class="headerlink" href="#defining-lifecycle" title="Permalink to this headline">¶</a></h4>
<p>Define the lifecycle of the data extracted in the previous paragraph.
Determine when the data will be generated and when it will be discarded in the definition of the lifecycle.</p>
<p>Also note that the data which is to be retained in multiple screens will have multiple discard timings as below.</p>
<ul class="simple">
<li>The task is terminated with the usual flow</li>
<li>Task is cancelled during the process</li>
</ul>
<p>If the above precautions are considered, the lifecycle of the data extracted in the previous paragraph can be defined as follows.</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="5%" />
<col width="25%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Data item name</th>
<th class="head">Lifecycle</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Update account information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Generate the data with the input from screen (1) and retain it during the transition from (1) to (3). Discard it when there is a transition except from screen (1) to (3).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Account information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Generate the data at the time of login and discard at the time of logout.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Product search information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Generate the data when there is a transition to screen (5) and retain during the transition from (1) to (8). Discard when there is a transition to screen (9).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Product information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Generate the data when there is a transition to screen (5) or (6) and retain only during that request.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Register cart information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Generate the data by the input from screen (5) or (6) and retain only during that request.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Cart information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Generate an empty object when there is a transition to screen (5) and retain during the transition from (1) to (8). Discard when there is a transition to screen (9).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Delete cart information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Generate the data by the input from screen (7) and retain only during that request.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Order information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Generate the data when there is a transition to screen (9) and retain only during that request.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="determining-the-status-of-using-a-session">
<h3><a class="toc-backref" href="#id30">11.3.3.4. Determining the status of using a session</a><a class="headerlink" href="#determining-the-status-of-using-a-session" title="Permalink to this headline">¶</a></h3>
<p>When the information needs to be retained on multiple screens, implementation is easy by using a session. At the same time, when the session is used, its demerits also need to be considered.
Refer to the guideline :doc:’../ArchitectureInDetail/WebApplicationDetail/SessionManagement’ and
determine whether to use the session in this tutorial.</p>
<p>It is described in the guideline that it is recommended to use the session first and to store only the data that is necessary, in the session.
This tutorial also considers not using the session.</p>
<blockquote>
<div><table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Data item</th>
<th class="head">Review contents</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Update account information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The data needs to be passed using hidden since the Update account information is to be retained across 3 screens. However, the Update account information contains the important information like the card number. It is a security issue since the important information is written in the HTML source without masking the important information while passing data using hidden. Therefore, consider using the session in this tutorial.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Account information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Since it is retained on all screens after login, the data needs to be passed using hidden. The process of passing data must be described on almost all screens created in this case. Therefore, consider using the session in this tutorial to reduce the implementation cost for screens as well.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Product search information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The data needs to be passed using hidden since the Product search information is to be retained across 8 screens. The process of passing data must be described on almost all screens created in this case. Therefore, consider using the session in this tutorial to reduce the implementation cost for screens as well.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Product information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Since the Delete cart information is used only in 1 screen, the data should be handled in the request scope.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Register cart information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Since the Delete cart information is used only in 1 screen, the data should be handled in the request scope.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Cart information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The data needs to be passed using hidden since the Cart information is to be retained across 8 screens. The process of passing data must be described on almost all screens created in this case. Therefore, consider using the session in this tutorial to reduce the implementation cost for screens as well.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Delete cart information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Since the Delete cart information is used only in 1 screen, the data should be handled in the request scope.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Order information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Since the Order information is used only in 1 screen, the data should be handled in the request scope.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>From the above-mentioned, consider using the session for these 4 i.e. the Update account information, Account information, Cart information and Product search information.</p>
<p>Next, verify the demerits of using the session.
According to this verification, if it is determined that the impact of demerits cannot be ignored, do not use the session.</p>
<p>The following 3 major points can be mentioned as the demerits of using the session.</p>
<ul class="simple">
<li>When it is used on multiple tabs and multiple browsers, (it needs to be considered that) the integrity of data may be lost because of mutual operations.</li>
<li>Since it is managed on the memory, the memory is likely to be exhausted because of the size of the data to be managed.</li>
<li>The session replication needs to be considered when AP server multiplexing is done with the aim to implement scale-out or to achieve high availability. At that time, if large data is handled in the session, it may affect the performance etc.</li>
</ul>
<p>Consider how to handle the respective risks or whether to allow the risks regarding the above-mentioned point of view.</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Point of view</th>
<th class="head">Review contents</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Data integrity</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The operation on multiple browsers and tabs is not guaranteed in this application. Therefore, a countermeasure to secure the data integrity is not required.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Memory utilization</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">Estimate the data size for which usage of session is considered. Assume maximum 100 characters 240 bytes (4 characters 8 bytes + initial 40 bytes) for the character string element, 24 bytes for data element and 16 bytes for the numerical value element. Further, the size of authentication information “UserDetails” stored in the session at the time of login authentication is also included. “UserDetails” broadly contains ID, password and user rights. Multiple user rights can be specified, but assume here as 1. The result estimated for each item is as follows.</div>
</div>
<ul class="simple">
<li>Account information (Character string: 7, Date: 2): maximum 1.7K bytes</li>
<li>Change account information (Character string: 8, Date: 2): maximum 2.0K bytes</li>
<li>Cart information (maximum 19 products x (Character string: 3, numerical value: 3)): maximum 14.6K bytes</li>
<li>Product search information (numerical value: 2): 32 bytes</li>
<li>“UserDetails”: (Character string: 3): 0.7K byte</li>
</ul>
<div class="last line-block">
<div class="line">1 user uses maximum 19KB in total. 1 user uses approximately 21KB if safety factor of 10% is considered. Since the usage is about 210MB even if it is considered that 10000 people are simultaneously connected and the memory load is considerably below 8GB even if other memory utilization is considered, it is less likely that the memory exhaustion will happen.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">AP server multiplexing</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Since high availability is not required in this application, use case continuation when failure happens is not required and redoing of use case because of re-login is allowed. Therefore, only take the countermeasure to set the load balancer so that all the requests occurred within the same session are distributed to the same AP server and do not implement the replication among the AP servers of the session.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Tool (for example, like SizeOf) needs to be used to measure the object size for estimation of the object size. The calculation formula in this tutorial refers the trend in actually measured values in SizeOf, but note that ultimately it is a temporary value. It should be separately considered how to calculate it at the time of sizing in the real system development.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The data to be stored in the session is basically restricted to the input data to avoid memory exhaustion. Since the size of the output data for search results tends to increase and on the other hand, often it is read-only that cannot be edited using screen operations, it is not suitable for storing in the session.</p>
</div>
<p>Increase in the management cost of session key is also 1 of the points to be considered other than the above-mentioned.
However, since the data quantity to be stored in the session is not large in the application created this time, it can be said that the management cost of the session key is limited.</p>
<p>It can be said from this result that the impact of demerits happening because of using session is not large.
Data to be stored in the session finally is as follows.</p>
<ul class="simple">
<li>Change account information</li>
<li>Account information</li>
<li>Product search information</li>
<li>Cart information</li>
</ul>
<p>This tutorial concludes that passing of data is implemented using the session.
However, it is also considered as a result of the investigation that it concludes that session should not be used.
Implement passing the data using hidden as an example when the session is not used.</p>
<p>Further, when the session is used, sometimes method to maintain the data integrity and replication settings are required.</p>
<p>The guideline mentions a method to avoid it using transaction token check. However, note that it becomes a low-usability application in this case. <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/DoubleSubmitProtection.html"><span class="doc">Double Submit Protection</span></a> should be referred for the specific implementation method.</p>
<p>Since replication settings depend on AP server, when replication needs to be considered, configuration of AP server needs to be checked.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Sometimes there exists a data to be stored in the session other than the data determined here.
Session is used when the following items among the items in the guideline are used.</p>
<ul class="last simple">
<li>It uses authentication/authorization/CSRF countermeasures using Spring Security</li>
<li>It uses transaction token check for prevention of double transmission</li>
</ul>
</div>
</div>
<div class="section" id="method-of-implementation-to-use-data-during-the-session">
<h3><a class="toc-backref" href="#id31">11.3.3.5. Method of implementation to use data during the session</a><a class="headerlink" href="#method-of-implementation-to-use-data-during-the-session" title="Permalink to this headline">¶</a></h3>
<p>Method of implementation to use the data during the session for each data is determined in this section.</p>
<p>The guideline provides 2 implementation methods corresponding to the locations of using data.
<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/SessionManagement.html"><span class="doc">Session Management</span></a> classifies the methods to be used depending on whether the data is contained within 1 Controller.
Therefore, the implementation method needs to be decided considering the lifecycle of data to be stored in the session and URL mapping.
Further, when the data is associated with the authentication information, session management should be implemented by the Spring Security function.</p>
<p>Considering these, the final result for which the data handled in the session is organized is as follows.</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="30%" />
<col width="30%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Data</th>
<th class="head">Characteristics</th>
<th class="head">Method of using data during session</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Change account information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Used only within 1 Controller</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Method wherein &#64;SessionAttributes annotation is used</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Account information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Used among multiple Controllers</div>
<div class="line">Used in authentication process</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Method wherein Spring Security function is used</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Product search information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Used among multiple Controllers</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Method wherein Bean for session scope of Spring is used</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Cart information</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Used among multiple Controllers</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Method wherein Bean for session scope of Spring is used</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Account information is already created in the project provided as initial material and
is managed using the Spring Security function.
Therefore, this tutorial does not describe any specific method of using.
:doc:’../Security/Authentication’ should be referred for the specific method of using.</p>
</div>
<div class="section" id="considerations-while-using-session">
<h3><a class="toc-backref" href="#id32">11.3.3.6. Considerations while using session</a><a class="headerlink" href="#considerations-while-using-session" title="Permalink to this headline">¶</a></h3>
<p>Items mentioned hereafter need to be considered when it is decided to use the session.
Review the respective items.</p>
<div class="section" id="session-synchronization">
<h4><a class="toc-backref" href="#id33">11.3.3.6.1. Session synchronization</a><a class="headerlink" href="#session-synchronization" title="Permalink to this headline">¶</a></h4>
<p>Object stored in the session can be simultaneously accessed by means of multiple requests of the same user.
Therefore, when session synchronization is not performed, it can cause unexpected error or operation.</p>
<p>Since the guideline mentions a method of implementing synchronization where BeanProcessor is used in <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/SessionManagement.html"><span class="doc">Session Management</span></a>, use this in this tutorial.</p>
</div>
<div class="section" id="session-time-out">
<h4><a class="toc-backref" href="#id34">11.3.3.6.2. Session time out</a><a class="headerlink" href="#session-time-out" title="Permalink to this headline">¶</a></h4>
<p>Session time out needs to be set when session is used.
If timeout duration is too long, unnecessary resources are retained in the memory and
if timeout duration is too small, user friendliness is lowered.
Therefore, appropriate time needs to be set as per the requirement.</p>
<p>This tutorial is also well-equipped with memory resources, set the default value of AP server to 30 minutes.</p>
<p>Further, handling the requests after session timeout also needs to be reviewed.
The guideline mentions a method to handle the requests after session timeout in <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/SessionManagement.html"><span class="doc">Session Management</span></a>.</p>
<p>Settings are done so as to transit to the login screen after timeout in this tutorial.</p>
</div>
</div>
<div class="section" id="overall-application-design">
<h3><a class="toc-backref" href="#id35">11.3.3.7. Overall application design</a><a class="headerlink" href="#overall-application-design" title="Permalink to this headline">¶</a></h3>
<p>Overall image diagram of the final application design is shown below.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/materialSessionTutorialDesignOverview.png"><img alt="overview of design" src="../_images/materialSessionTutorialDesignOverview.png" style="width: 95%;" /></a>
</div>
</div>
</div>
<div class="section" id="project-configuration">
<h2><a class="toc-backref" href="#id36">11.3.4. Project configuration</a><a class="headerlink" href="#project-configuration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="project-creation">
<h3><a class="toc-backref" href="#id37">11.3.4.1. Project creation</a><a class="headerlink" href="#project-creation" title="Permalink to this headline">¶</a></h3>
<p>As stated already, this tutorial starts with the status that some functions are created.
Therefore, proceed with development using already created project.</p>
<p>Created project can be fetched with the following procedure.</p>
<ol class="arabic simple">
<li>Access to <a class="reference external" href="https://github.com/terasolunaorg/tutorial-apps">tutorial-apps</a>.</li>
<li>Click ‘Branch’ button to select Branch of the required version and click ‘Download ZIP’ button to download zip file</li>
<li>Extract zip file and import the project in it.</li>
</ol>
<p>Note that since the method to import the project is described in <a class="reference internal" href="TutorialTodo.html"><span class="doc">Tutorial (Todo Application)</span></a>,
the description is omitted in this tutorial.</p>
</div>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id38">11.3.4.2. Project configuration</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>It states about the configuration of the initial project fetched using git.
Only the differences between the project fetched and the blank project are shown below.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">session-tutorial-init-domain</span>
<span class="go">    └── src</span>
<span class="go">        └── main</span>
<span class="go">             ├── java</span>
<span class="go">             │   └── com</span>
<span class="go">             │       └── example</span>
<span class="go">             │           └── session</span>
<span class="go">             │               └── domain</span>
<span class="go">             │                   ├──model  ... (1)</span>
<span class="go">             │                   │  ├── Account.java  ... (2)</span>
<span class="go">             │                   │  ├── Cart.java  ... (3)</span>
<span class="go">             │                   │  ├── CartItem.java  ... (3)</span>
<span class="go">             │                   │  ├── Goods.java</span>
<span class="go">             │                   │  ├── Order.java  ... (4)</span>
<span class="go">             │                   │  └── OrderLine.java  ... (4)</span>
<span class="go">             │                   ├── repository  ... (5)</span>
<span class="go">             │                   │  ├── account</span>
<span class="go">             │                   │  │  └── AccountRepository.java</span>
<span class="go">             │                   │  ├── goods</span>
<span class="go">             │                   │  │  └── GoodsRepository.java</span>
<span class="go">             │                   │  └── order</span>
<span class="go">             │                   │      └── OrderRepository.java</span>
<span class="go">             │                   └── service  ... (6)</span>
<span class="go">             │                       ├── account</span>
<span class="go">             │                       │  └── AccountService.java</span>
<span class="go">             │                       ├── goods</span>
<span class="go">             │                       │  └── GoodsService.java</span>
<span class="go">             │                       ├── order</span>
<span class="go">             │                       │  ├── EmptyCartOrderException.java</span>
<span class="go">             │                       │  ├── InvalidCartOrderException.java</span>
<span class="go">             │                       │  └── OrderService.java</span>
<span class="go">             │                       └── userdetails</span>
<span class="go">             │                           ├── AccountDetails.java</span>
<span class="go">             │                           └── AccountDetailsService.java</span>
<span class="go">             └── resources</span>
<span class="go">                  ├── com</span>
<span class="go">                  │  └── example</span>
<span class="go">                  │      └── session</span>
<span class="go">                  │          └── domain</span>
<span class="go">                  │              └── repository  ... (7)</span>
<span class="go">                  │                  ├── account</span>
<span class="go">                  │                  │  └── AccountRepository.xml</span>
<span class="go">                  │                  ├── goods</span>
<span class="go">                  │                  │  └── GoodsRepository.xml</span>
<span class="go">                  │                  └── order</span>
<span class="go">                  │                      └── OrderRepository.xml</span>
<span class="go">                  └── META-INF</span>
<span class="go">                       ├── dozer</span>
<span class="go">                       │  └── order-mapping.xml  ... (8)</span>
<span class="go">                       └── spring</span>
<span class="go">                           └── session-tutorial-init-codelist.xml  ... (9)</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Package to handle model used in this application.</div>
<div class="line">It describes the model required to be understood for proceeding with the tutorial below in detail.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Class to save user account information.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Class to save information of product registered in cart by user.</div>
<div class="line">‘Cart’ manages the whole thing and ‘CartItem’ manages the individual products.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Class to save information of product ordered by user.</div>
<div class="line">‘Order’ manages the whole thing and ‘OrderLine’ manages the individual products.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Package to handle repository used in this application.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Package to handle service used in this application.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Directory to store mapping file used in repository.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Mapping definition file of Dozer (Bean Mapper).</div>
<div class="line">Conversion from ‘Cart’ to ‘Order’ is defined.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Bean definition file in which code list used in this application is defined.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">session-tutorial-init-env</span>
<span class="go">    └── src</span>
<span class="go">        └── main</span>
<span class="go">             └── resources</span>
<span class="go">                 └── database  ... (1)</span>
<span class="go">                     ├── H2-dataload.sql</span>
<span class="go">                     └── H2-schema.sql</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">File name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Directory to store SQL in order to setup in-memory database (H2 Database) in this application.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">session-tutorial-init-web</span>
<span class="go">    └── src</span>
<span class="go">        └── main</span>
<span class="go">             ├── java</span>
<span class="go">             │   └── com</span>
<span class="go">             │       └── example</span>
<span class="go">             │           └── session</span>
<span class="go">             │               └── app  ... (1)</span>
<span class="go">             │                   ├── account</span>
<span class="go">             │                   │  ├── AccountCreateController.java</span>
<span class="go">             │                   │  ├── AccountCreateForm.java</span>
<span class="go">             │                   │  ├── IlleagalOperationException.java</span>
<span class="go">             │                   │  └── IlleagalOperationExceptionHandler.java</span>
<span class="go">             │                   ├── goods</span>
<span class="go">             │                   │  ├── GoodsController.java</span>
<span class="go">             │                   │  └── GoodsViewForm.java</span>
<span class="go">             │                   ├── login</span>
<span class="go">             │                   │  └── LoginController.java</span>
<span class="go">             │                   └── validation</span>
<span class="go">             │                       ├── Confirm.java</span>
<span class="go">             │                       └── ConfirmValidator.java</span>
<span class="go">             ├── resources</span>
<span class="go">             │   ├── i18n</span>
<span class="go">             │   │  └── application-messages.properties  ... (2)</span>
<span class="go">             │   ├── META-INF</span>
<span class="go">             │   │   └── spring  ... (3)</span>
<span class="go">             │   │       ├── spring-mvc.xml</span>
<span class="go">             │   │       └── spring-security.xml</span>
<span class="go">             │   └── ValidationMessages.properties  ... (2)</span>
<span class="go">             └── webapp</span>
<span class="go">                  ├── resources  ... (4)</span>
<span class="go">                  │  ├── app</span>
<span class="go">                  │  │  └── css</span>
<span class="go">                  │  │      └── styles.css</span>
<span class="go">                  │  └── vendor</span>
<span class="go">                  │      └── bootstrap-3.0.0</span>
<span class="go">                  │          └── css</span>
<span class="go">                  │              └── bootstrap.css</span>
<span class="go">                  └── WEB-INF</span>
<span class="go">                      └── views  ... (5)</span>
<span class="go">                          ├── account</span>
<span class="go">                          │  ├── createConfirm.jsp</span>
<span class="go">                          │  ├── createFinish.jsp</span>
<span class="go">                          │  └── createForm.jsp</span>
<span class="go">                          ├── common</span>
<span class="go">                          │  ├── error</span>
<span class="go">                          │  │  └── illegalOperationError.jsp</span>
<span class="go">                          │  └── include.jsp</span>
<span class="go">                          ├── goods</span>
<span class="go">                          │  ├── showGoods.jsp</span>
<span class="go">                          │  └── showGoodsDetails.jsp</span>
<span class="go">                          └── login</span>
<span class="go">                              └── loginForm.jsp</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Package to store the class in application layer used in this application.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Property file in which message used in this application is defined</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Bean definition file in which component used in this application is defined</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Static resource file used in this application</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Directory in which jsp used in this application is stored</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="operation-verification">
<h3><a class="toc-backref" href="#id39">11.3.4.3. Operation verification</a><a class="headerlink" href="#operation-verification" title="Permalink to this headline">¶</a></h3>
<p>Check the operation of project fetched before the application development.
Start the application server with the project imported in STS as the target
The method to start the application server is omitted in this tutorial
since it is described in <a class="reference internal" href="TutorialTodo.html"><span class="doc">Tutorial (Todo Application)</span></a>.</p>
<p>The following screen is displayed when <a class="reference external" href="http://localhost:8080/session-tutorial-init-web/loginForm">http://localhost:8080/session-tutorial-init-web/loginForm</a> is accessed after the application server is started.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/materialSessionTutorialLoginPage.png"><img alt="Login Page" src="../_images/materialSessionTutorialLoginPage.png" style="width: 40%;" /></a>
</div>
<p>Account can be created when “here” link on the login screen is selected.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/materialSessionTutorialCreateAccountPages.png"><img alt="Account Create Pages" src="../_images/materialSessionTutorialCreateAccountPages.png" style="width: 95%;" /></a>
</div>
<p>When (E-mail=”<a class="reference external" href="mailto:a&#37;&#52;&#48;b&#46;com">a<span>&#64;</span>b<span>&#46;</span>com</a>”, Password=”demo”) is input in the form on the login screen, login can be done.
Product list is displayed after the login.
The product details can be displayed when the product name is selected.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/materialSessionTutorialViewItemPages.png"><img alt="Item View Pages" src="../_images/materialSessionTutorialViewItemPages.png" style="width: 65%;" /></a>
</div>
</div>
</div>
<div class="section" id="creating-simple-ec-site-application">
<h2><a class="toc-backref" href="#id40">11.3.5. Creating simple EC site application</a><a class="headerlink" href="#creating-simple-ec-site-application" title="Permalink to this headline">¶</a></h2>
<div class="section" id="create-account-information-change-function">
<h3><a class="toc-backref" href="#id41">11.3.5.1. Create account information change function</a><a class="headerlink" href="#create-account-information-change-function" title="Permalink to this headline">¶</a></h3>
<p>Create a function that allows the user to input the information and updates the account information.</p>
<p>Manage the Change account information using “&#64;SessionAttributes annotation” as described in <a class="reference internal" href="#development-policy"><span class="std std-ref">Application design</span></a>.</p>
<p>The information of the screen implemented in the Change account information function is shown below.</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="30%" />
<col width="15%" />
<col width="25%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Process name</th>
<th class="head">HTTP method</th>
<th class="head">Path</th>
<th class="head">Screen</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Account information change screen 1 display process</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/update?form1</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/updateForm1</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Account information change screen 2 display process</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/update?form2</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/updateForm2</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Account information change confirmation screen display process</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/update?confirm</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/updateConfirm</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Account information change process</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">POST</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/update</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Redirect to Account information change completion screen display process</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Account information change completion screen display process</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/update?finish</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/updateFinish</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Process to return to Account information change screen 1</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/update?redoform1</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/updateForm1</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Process to return to Account information change screen 2</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/update?redoform2</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/updateForm2</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Process to return to Home</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/account/update?home</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Redirect to Home screen display process</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="section" id="creating-form-object">
<h4><a class="toc-backref" href="#id42">11.3.5.1.1. Creating form object</a><a class="headerlink" href="#creating-form-object" title="Permalink to this headline">¶</a></h4>
<p>Create a class to retain the account change information.</p>
<p>“/session-tutorial-init-web/src/main/java/com/example/session/app/account/AccountUpdateForm.java”</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.session.app.account</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.constraints.Size</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.validator.constraints.Email</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.format.annotation.DateTimeFormat</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccountUpdateForm</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>  <span class="c1">// (1)</span>

    <span class="cm">/**</span>
<span class="cm">     *</span>
<span class="cm">     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">id</span><span class="o">;</span>

    <span class="c1">// (2)</span>
    <span class="nd">@NotNull</span><span class="o">(</span><span class="n">groups</span> <span class="o">=</span> <span class="o">{</span> <span class="n">Wizard1</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
    <span class="nd">@Size</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">255</span><span class="o">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="o">{</span> <span class="n">Wizard1</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@NotNull</span><span class="o">(</span><span class="n">groups</span> <span class="o">=</span> <span class="o">{</span> <span class="n">Wizard1</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
    <span class="nd">@Size</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">255</span><span class="o">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="o">{</span> <span class="n">Wizard1</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
    <span class="nd">@Email</span><span class="o">(</span><span class="n">groups</span> <span class="o">=</span> <span class="o">{</span> <span class="n">Wizard1</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>

    <span class="nd">@NotNull</span><span class="o">(</span><span class="n">groups</span> <span class="o">=</span> <span class="o">{</span> <span class="n">Wizard1</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
    <span class="nd">@DateTimeFormat</span><span class="o">(</span><span class="n">iso</span> <span class="o">=</span> <span class="n">DateTimeFormat</span><span class="o">.</span><span class="na">ISO</span><span class="o">.</span><span class="na">DATE</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">birthday</span><span class="o">;</span>

    <span class="nd">@NotNull</span><span class="o">(</span><span class="n">groups</span> <span class="o">=</span> <span class="o">{</span> <span class="n">Wizard1</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
    <span class="nd">@Size</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">7</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">7</span><span class="o">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="o">{</span> <span class="n">Wizard1</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">zip</span><span class="o">;</span>

    <span class="nd">@NotNull</span><span class="o">(</span><span class="n">groups</span> <span class="o">=</span> <span class="o">{</span> <span class="n">Wizard1</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
    <span class="nd">@Size</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">255</span><span class="o">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="o">{</span> <span class="n">Wizard1</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">address</span><span class="o">;</span>

    <span class="nd">@Size</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">16</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">16</span><span class="o">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="o">{</span> <span class="n">Wizard2</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">cardNumber</span><span class="o">;</span>

    <span class="nd">@DateTimeFormat</span><span class="o">(</span><span class="n">pattern</span> <span class="o">=</span> <span class="s">&quot;yyyy-MM&quot;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">cardExpirationDate</span><span class="o">;</span>

    <span class="nd">@Size</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">255</span><span class="o">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="o">{</span> <span class="n">Wizard2</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">cardSecurityCode</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getEmail</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">email</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEmail</span><span class="o">(</span><span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getBirthday</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">birthday</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setBirthday</span><span class="o">(</span><span class="n">Date</span> <span class="n">birthday</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">birthday</span> <span class="o">=</span> <span class="n">birthday</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getZip</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">zip</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setZip</span><span class="o">(</span><span class="n">String</span> <span class="n">zip</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">zip</span> <span class="o">=</span> <span class="n">zip</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getAddress</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">address</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAddress</span><span class="o">(</span><span class="n">String</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">address</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getCardNumber</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">cardNumber</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCardNumber</span><span class="o">(</span><span class="n">String</span> <span class="n">cardNumber</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">cardNumber</span> <span class="o">=</span> <span class="n">cardNumber</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getCardExpirationDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">cardExpirationDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCardExpirationDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">cardExpirationDate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">cardExpirationDate</span> <span class="o">=</span> <span class="n">cardExpirationDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getCardSecurityCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">cardSecurityCode</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCardSecurityCode</span><span class="o">(</span><span class="n">String</span> <span class="n">cardSecurityCode</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">cardSecurityCode</span> <span class="o">=</span> <span class="n">cardSecurityCode</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getLastFourOfCardNumber</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">cardNumber</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">cardNumber</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">cardNumber</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="mi">4</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">Wizard1</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">Wizard2</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implement Serializable in advance to store the instance of this class in the session.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Make validation groups to specify the target of the input check for each screen transition.</div>
<div class="line">In the example above, 2 groups are created implement the input check corresponding to the input item on the 1st page and the input item on the 2nd page respectively.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="creating-controller">
<h4><a class="toc-backref" href="#id43">11.3.5.1.2. Creating Controller</a><a class="headerlink" href="#creating-controller" title="Permalink to this headline">¶</a></h4>
<p>Create the Controller.
The description in which the form that receives the input information is managed using “&#64;SessionAttributes” annotation is required in the Controller.</p>
<p>“/session-tutorial-init-web/src/main/java/com/example/session/app/account/AccountUpdateController.java”</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.session.app.account</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.dozer.Mapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.propertyeditors.StringTrimmerEditor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.core.annotation.AuthenticationPrincipal</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.annotation.Validated</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.WebDataBinder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.InitBinder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.SessionAttributes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.support.SessionStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.mvc.support.RedirectAttributes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessages</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.session.app.account.AccountUpdateForm.Wizard1</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.session.app.account.AccountUpdateForm.Wizard2</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.session.domain.model.Account</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.session.domain.service.account.AccountService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.session.domain.service.userdetails.AccountDetails</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@SessionAttributes</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="o">{</span> <span class="s">&quot;accountUpdateForm&quot;</span> <span class="o">})</span> <span class="c1">// (1)</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;account&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccountUpdateController</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">AccountService</span> <span class="n">accountService</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="n">Mapper</span> <span class="n">beanMapper</span><span class="o">;</span>

    <span class="nd">@InitBinder</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initBinder</span><span class="o">(</span><span class="n">WebDataBinder</span> <span class="n">binder</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">binder</span><span class="o">.</span><span class="na">registerCustomEditor</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="k">new</span> <span class="n">StringTrimmerEditor</span><span class="o">(</span><span class="kc">true</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nd">@ModelAttribute</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;accountUpdateForm&quot;</span><span class="o">)</span> <span class="c1">// (2)</span>
    <span class="kd">public</span> <span class="n">AccountUpdateForm</span> <span class="nf">setUpAccountForm</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">AccountUpdateForm</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;update&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;form1&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">showUpdateForm1</span><span class="o">(</span>
            <span class="nd">@AuthenticationPrincipal</span> <span class="n">AccountDetails</span> <span class="n">userDetails</span><span class="o">,</span>
            <span class="n">AccountUpdateForm</span> <span class="n">form</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// (3)</span>

        <span class="n">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="n">accountService</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">userDetails</span><span class="o">.</span><span class="na">getAccount</span><span class="o">()</span>
                <span class="o">.</span><span class="na">getEmail</span><span class="o">());</span>
        <span class="n">beanMapper</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">account</span><span class="o">,</span> <span class="n">form</span><span class="o">);</span>

        <span class="k">return</span> <span class="s">&quot;account/updateForm1&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;update&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;form2&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">showUpdateForm2</span><span class="o">(</span>
            <span class="nd">@Validated</span><span class="o">((</span><span class="n">Wizard1</span><span class="o">.</span><span class="na">class</span><span class="o">))</span> <span class="n">AccountUpdateForm</span> <span class="n">form</span><span class="o">,</span>
            <span class="n">BindingResult</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="s">&quot;account/updateForm1&quot;</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="s">&quot;account/updateForm2&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;update&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;redoForm1&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">redoUpdateForm1</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;account/updateForm1&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;update&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;confirm&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">confirmUpdate</span><span class="o">(</span>
            <span class="nd">@Validated</span><span class="o">(</span><span class="n">Wizard2</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="n">AccountUpdateForm</span> <span class="n">form</span><span class="o">,</span>
            <span class="n">BindingResult</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="s">&quot;account/updateForm2&quot;</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="s">&quot;account/updateConfirm&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;update&quot;</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;redoForm2&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">redoUpdateForm2</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;account/updateForm2&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;update&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">update</span><span class="o">(</span>
            <span class="nd">@AuthenticationPrincipal</span> <span class="n">AccountDetails</span> <span class="n">userDetails</span><span class="o">,</span>
            <span class="nd">@Validated</span><span class="o">({</span> <span class="n">Wizard1</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Wizard2</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span> <span class="n">AccountUpdateForm</span> <span class="n">form</span><span class="o">,</span>
            <span class="n">BindingResult</span> <span class="n">result</span><span class="o">,</span> <span class="n">RedirectAttributes</span> <span class="n">attributes</span><span class="o">,</span> <span class="n">SessionStatus</span> <span class="n">sessionStatus</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">ResultMessages</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">ResultMessages</span><span class="o">.</span><span class="na">error</span><span class="o">();</span>
            <span class="n">messages</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;e.st.ac.5001&quot;</span><span class="o">);</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalOperationException</span><span class="o">(</span><span class="n">messages</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="n">beanMapper</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">form</span><span class="o">,</span> <span class="n">Account</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">accountService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
        <span class="n">userDetails</span><span class="o">.</span><span class="na">setAccount</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
        <span class="n">attributes</span><span class="o">.</span><span class="na">addFlashAttribute</span><span class="o">(</span><span class="s">&quot;account&quot;</span><span class="o">,</span> <span class="n">account</span><span class="o">);</span>
        <span class="n">sessionStatus</span><span class="o">.</span><span class="na">setComplete</span><span class="o">();</span>  <span class="c1">// (4)</span>

        <span class="k">return</span> <span class="s">&quot;redirect:/account/update?finish&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;update&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;finish&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">finishUpdate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;account/updateFinish&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;update&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;home&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">SessionStatus</span> <span class="n">sessionStatus</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">sessionStatus</span><span class="o">.</span><span class="na">setComplete</span><span class="o">();</span>
        <span class="k">return</span> <span class="s">&quot;redirect:/goods&quot;</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the attribute name of the object to be stored in the session, in the value attribute of “&#64;SessionAttributes” annotation.</div>
<div class="line">The object having the attribute name <code class="docutils literal"><span class="pre">accountUpdateForm</span></code> is stored in the session in the above example.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the attribute name to be stored in the Model object in the value attribute.</div>
<div class="line">The returned object is stored in the session by the attribute name as <code class="docutils literal"><span class="pre">accountUpdateForm</span></code> in the above example.</div>
<div class="line">Since the “&#64;ModelAttribute” annotated method can no longer be called by the request after the object is stored in the session when the value attribute is specified, it has a merit that unnecessary object is not generated.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In order to use the object managed by “&#64;SessionAttributes” annotation, add argument in the method so that the object can be received.</div>
<div class="line">Use “&#64;Validated” annotation when the input check is required.</div>
<div class="line">The object that contains <code class="docutils literal"><span class="pre">accountUpdateForm</span></code> that is the default attribute name of “AccountUpdateForm”, in the attribute name is passed as an argument in the above example.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Call “setComplete” method of “SessionStatus” object and delete the object from the session.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The object managed using “&#64;SessionAttributes” annotation continues to remain in the session unless it is explicitly deleted.
Therefore, the data retained even when the transition has taken place outside the screen handled by the Controller and returned again, can be browsed.
The data that is no longer required, should always be deleted to avoid the memory exhaustion.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">When the user goes back using the browser button, inputs the URL directly and moves from one screen to another, it is required to note the point that “setComplete” method is not called and the session remains active without being cleared.</p>
</div>
</div>
<div class="section" id="creating-jsp">
<h4><a class="toc-backref" href="#id44">11.3.5.1.3. Creating JSP</a><a class="headerlink" href="#creating-jsp" title="Permalink to this headline">¶</a></h4>
<p>Create a screen to pass data to the form object managed by “&#64;SessionAttributes” annotation.</p>
<p>Input screen on the 1st page</p>
<p>“/session-tutorial-init-web/src/main/webapp/WEB-INF/views/account/updateForm1.jsp”</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;title&gt;</span>Account Update Page<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/resources/app/css/styles.css&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
        <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">--</span><span class="k">%&gt;</span>
        <span class="nt">&lt;form:form</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/account/update&quot;</span>
            <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">modelAttribute=</span><span class="s">&quot;accountUpdateForm&quot;</span><span class="nt">&gt;</span>

            <span class="nt">&lt;h2&gt;</span>Account Update Page 1/2<span class="nt">&lt;/h2&gt;</span>
            <span class="nt">&lt;table&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;form:label</span> <span class="na">path=</span><span class="s">&quot;name&quot;</span> <span class="na">cssErrorClass=</span><span class="s">&quot;error-label&quot;</span><span class="nt">&gt;</span>name<span class="nt">&lt;/form:label&gt;&lt;/td&gt;</span>
                    <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="o">--</span><span class="k">%&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;name&quot;</span> <span class="na">cssErrorClass=</span><span class="s">&quot;error-input&quot;</span> <span class="nt">/&gt;</span> <span class="nt">&lt;form:errors</span>
                            <span class="na">path=</span><span class="s">&quot;name&quot;</span> <span class="na">cssClass=</span><span class="s">&quot;error-messages&quot;</span> <span class="nt">/&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;form:label</span> <span class="na">path=</span><span class="s">&quot;email&quot;</span> <span class="na">cssErrorClass=</span><span class="s">&quot;error-label&quot;</span><span class="nt">&gt;</span>e-mail<span class="nt">&lt;/form:label&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;email&quot;</span> <span class="na">cssErrorClass=</span><span class="s">&quot;error-input&quot;</span> <span class="nt">/&gt;</span> <span class="nt">&lt;form:errors</span>
                            <span class="na">path=</span><span class="s">&quot;email&quot;</span> <span class="na">cssClass=</span><span class="s">&quot;error-messages&quot;</span> <span class="nt">/&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;form:label</span> <span class="na">path=</span><span class="s">&quot;birthday&quot;</span> <span class="na">cssErrorClass=</span><span class="s">&quot;error-label&quot;</span><span class="nt">&gt;</span>birthday<span class="nt">&lt;/form:label&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;fmt:formatDate</span> <span class="na">value=</span><span class="s">&quot;${accountUpdateForm.birthday}&quot;</span>
                            <span class="na">pattern=</span><span class="s">&quot;yyyy-MM-dd&quot;</span> <span class="na">var=</span><span class="s">&quot;formattedBirthday&quot;</span> <span class="nt">/&gt;</span> <span class="nt">&lt;input</span>
                        <span class="na">type=</span><span class="s">&quot;date&quot;</span> <span class="na">id=</span><span class="s">&quot;birthday&quot;</span> <span class="na">name=</span><span class="s">&quot;birthday&quot;</span>
                        <span class="na">value=</span><span class="s">&quot;${formattedBirthday}&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;birthday&quot;</span>
                            <span class="na">cssClass=</span><span class="s">&quot;error-messages&quot;</span> <span class="nt">/&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;form:label</span> <span class="na">path=</span><span class="s">&quot;zip&quot;</span> <span class="na">cssErrorClass=</span><span class="s">&quot;error-label&quot;</span><span class="nt">&gt;</span>zip<span class="nt">&lt;/form:label&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;zip&quot;</span> <span class="na">cssErrorClass=</span><span class="s">&quot;error-input&quot;</span> <span class="nt">/&gt;</span> <span class="nt">&lt;form:errors</span>
                            <span class="na">path=</span><span class="s">&quot;zip&quot;</span> <span class="na">cssClass=</span><span class="s">&quot;error-messages&quot;</span> <span class="nt">/&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;form:label</span> <span class="na">path=</span><span class="s">&quot;address&quot;</span> <span class="na">cssErrorClass=</span><span class="s">&quot;error-label&quot;</span><span class="nt">&gt;</span>address<span class="nt">&lt;/form:label&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;address&quot;</span> <span class="na">cssErrorClass=</span><span class="s">&quot;error-input&quot;</span> <span class="nt">/&gt;</span>
                        <span class="nt">&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;address&quot;</span> <span class="na">cssClass=</span><span class="s">&quot;error-messages&quot;</span> <span class="nt">/&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;</span><span class="ni">&amp;nbsp;</span><span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;form2&quot;</span> <span class="na">id=</span><span class="s">&quot;next&quot;</span> <span class="na">value=</span><span class="s">&quot;next&quot;</span> <span class="nt">/&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/table&gt;</span>
        <span class="nt">&lt;/form:form&gt;</span>

        <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span>
            <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/account/update&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;home&quot;</span> <span class="na">id=</span><span class="s">&quot;home&quot;</span> <span class="na">value=</span><span class="s">&quot;home&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the attribute name of the form object that receives the input data, in modelAttribute.</div>
<div class="line">The object with the attribute name <code class="docutils literal"><span class="pre">accountUpdateForm</span></code> receives the input data in the above example.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the element name of the object that stores the input data in path attribute of form:input tag.</div>
<div class="line">If this method is used, when data already exists in the element name of the specified object, that value becomes as the default value of the input form.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Input screen on 2nd page</p>
<p>“/session-tutorial-init-web/src/main/webapp/WEB-INF/views/account/updateForm2.jsp”</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;title&gt;</span>Account Update Page<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/resources/app/css/styles.css&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>

        <span class="nt">&lt;form:form</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/account/update&quot;</span>
            <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">modelAttribute=</span><span class="s">&quot;accountUpdateForm&quot;</span><span class="nt">&gt;</span>

            <span class="nt">&lt;h2&gt;</span>Account Update Page 2/2<span class="nt">&lt;/h2&gt;</span>
            <span class="nt">&lt;table&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;form:label</span> <span class="na">path=</span><span class="s">&quot;cardNumber&quot;</span> <span class="na">cssErrorClass=</span><span class="s">&quot;error-label&quot;</span><span class="nt">&gt;</span>your card number<span class="nt">&lt;/form:label&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;cardNumber&quot;</span> <span class="na">cssErrorClass=</span><span class="s">&quot;error-input&quot;</span> <span class="nt">/&gt;</span>
                        <span class="nt">&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;cardNumber&quot;</span> <span class="na">cssClass=</span><span class="s">&quot;error-messages&quot;</span> <span class="nt">/&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;form:label</span> <span class="na">path=</span><span class="s">&quot;cardExpirationDate&quot;</span>
                            <span class="na">cssErrorClass=</span><span class="s">&quot;error-label&quot;</span><span class="nt">&gt;</span>expiration date of
                            your card<span class="nt">&lt;/form:label&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;fmt:formatDate</span>
                            <span class="na">value=</span><span class="s">&quot;${accountUpdateForm.cardExpirationDate}&quot;</span> <span class="na">pattern=</span><span class="s">&quot;yyyy-MM&quot;</span>
                            <span class="na">var=</span><span class="s">&quot;formattedCardExpirationDate&quot;</span> <span class="nt">/&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;month&quot;</span>
                        <span class="na">name=</span><span class="s">&quot;cardExpirationDate&quot;</span> <span class="na">id=</span><span class="s">&quot;cardExpirationDate&quot;</span>
                        <span class="na">value=</span><span class="s">&quot;${formattedCardExpirationDate}&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;form:errors</span>
                            <span class="na">path=</span><span class="s">&quot;cardExpirationDate&quot;</span> <span class="na">cssClass=</span><span class="s">&quot;error-messages&quot;</span> <span class="nt">/&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;form:label</span> <span class="na">path=</span><span class="s">&quot;cardSecurityCode&quot;</span>
                            <span class="na">cssErrorClass=</span><span class="s">&quot;error-label&quot;</span><span class="nt">&gt;</span>security code of
                            your card<span class="nt">&lt;/form:label&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;cardSecurityCode&quot;</span>
                            <span class="na">cssErrorClass=</span><span class="s">&quot;error-input&quot;</span> <span class="nt">/&gt;</span> <span class="nt">&lt;form:errors</span>
                            <span class="na">path=</span><span class="s">&quot;cardSecurityCode&quot;</span> <span class="na">cssClass=</span><span class="s">&quot;error-messages&quot;</span> <span class="nt">/&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;</span><span class="ni">&amp;nbsp;</span><span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;redoForm1&quot;</span> <span class="na">id=</span><span class="s">&quot;back&quot;</span>
                        <span class="na">value=</span><span class="s">&quot;back&quot;</span> <span class="nt">/&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;confirm&quot;</span> <span class="na">id=</span><span class="s">&quot;confirm&quot;</span>
                        <span class="na">value=</span><span class="s">&quot;confirm&quot;</span> <span class="nt">/&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/table&gt;</span>
        <span class="nt">&lt;/form:form&gt;</span>

        <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span>
            <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/account/update&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;home&quot;</span> <span class="na">id=</span><span class="s">&quot;home&quot;</span> <span class="na">value=</span><span class="s">&quot;home&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>Confirmation screen</p>
<p>“/session-tutorial-init-web/src/main/webapp/WEB-INF/views/account/updateConfirm.jsp”</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;title&gt;</span>Account Update Page<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/resources/app/css/styles.css&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>

        <span class="nt">&lt;form:form</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/account/update&quot;</span>
            <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>

            <span class="nt">&lt;h3&gt;</span>Your account will be updated with below information. Please
                push &quot;update&quot; button if it&#39;s OK.<span class="nt">&lt;/h3&gt;</span>
            <span class="nt">&lt;table&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>name<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>${f:h(accountUpdateForm.name)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;email&quot;</span><span class="nt">&gt;</span>e-mail<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;email&quot;</span><span class="nt">&gt;</span>${f:h(accountUpdateForm.email)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;birthday&quot;</span><span class="nt">&gt;</span>birthday<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;birthday&quot;</span><span class="nt">&gt;&lt;fmt:formatDate</span>
                                <span class="na">value=</span><span class="s">&quot;${accountUpdateForm.birthday}&quot;</span> <span class="na">pattern=</span><span class="s">&quot;yyyy-MM-dd&quot;</span> <span class="nt">/&gt;&lt;/span&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;zip&quot;</span><span class="nt">&gt;</span>zip<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;zip&quot;</span><span class="nt">&gt;</span>${f:h(accountUpdateForm.zip)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;address&quot;</span><span class="nt">&gt;</span>address<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;address&quot;</span><span class="nt">&gt;</span>${f:h(accountUpdateForm.address)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;cardNumber&quot;</span><span class="nt">&gt;</span>your card number<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;cardNumber&quot;</span><span class="nt">&gt;</span>****-****-****-${f:h(accountUpdateForm.lastFourOfCardNumber)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;cardExpirationDate&quot;</span><span class="nt">&gt;</span>expiration date of
                            your card<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;cardExpirationDate&quot;</span><span class="nt">&gt;&lt;fmt:formatDate</span>
                                <span class="na">value=</span><span class="s">&quot;${accountUpdateForm.cardExpirationDate}&quot;</span>
                                <span class="na">pattern=</span><span class="s">&quot;yyyy-MM&quot;</span> <span class="nt">/&gt;&lt;/span&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;cardSecurityCode&quot;</span><span class="nt">&gt;</span>security code of
                            your card<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;cardSecurityCode&quot;</span><span class="nt">&gt;</span>${f:h(accountUpdateForm.cardSecurityCode)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;</span><span class="ni">&amp;nbsp;</span><span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;redoForm2&quot;</span> <span class="na">id=</span><span class="s">&quot;back&quot;</span>
                        <span class="na">value=</span><span class="s">&quot;back&quot;</span> <span class="nt">/&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">id=</span><span class="s">&quot;update&quot;</span> <span class="na">value=</span><span class="s">&quot;update&quot;</span> <span class="nt">/&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/table&gt;</span>
        <span class="nt">&lt;/form:form&gt;</span>


        <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span>
            <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/account/update&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;home&quot;</span> <span class="na">id=</span><span class="s">&quot;home&quot;</span> <span class="na">value=</span><span class="s">&quot;home&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>Completion screen</p>
<p>“/session-tutorial-init-web/src/main/webapp/WEB-INF/views/account/updateFinish.jsp”</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;title&gt;</span>Account Update Page<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/resources/app/css/styles.css&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>

        <span class="nt">&lt;h3&gt;</span>Your account has updated.<span class="nt">&lt;/h3&gt;</span>
        <span class="nt">&lt;table&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>name<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>${f:h(account.name)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;email&quot;</span><span class="nt">&gt;</span>e-mail<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;email&quot;</span><span class="nt">&gt;</span>${f:h(account.email)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;birthday&quot;</span><span class="nt">&gt;</span>birthday<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;birthday&quot;</span><span class="nt">&gt;&lt;fmt:formatDate</span>
                            <span class="na">value=</span><span class="s">&quot;${account.birthday}&quot;</span> <span class="na">pattern=</span><span class="s">&quot;yyyy-MM-dd&quot;</span> <span class="nt">/&gt;&lt;/span&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;zip&quot;</span><span class="nt">&gt;</span>zip<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;zip&quot;</span><span class="nt">&gt;</span>${f:h(account.zip)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;address&quot;</span><span class="nt">&gt;</span>address<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;address&quot;</span><span class="nt">&gt;</span>${f:h(account.address)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;cardNumber&quot;</span><span class="nt">&gt;</span>your card number<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;cardNumber&quot;</span><span class="nt">&gt;</span>****-****-****-${f:h(account.lastFourOfCardNumber)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;cardExpirationDate&quot;</span><span class="nt">&gt;</span>expiration date of
                        your card<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;cardExpirationDate&quot;</span><span class="nt">&gt;&lt;fmt:formatDate</span>
                            <span class="na">value=</span><span class="s">&quot;${account.cardExpirationDate}&quot;</span> <span class="na">pattern=</span><span class="s">&quot;yyyy-MM&quot;</span> <span class="nt">/&gt;&lt;/span&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;cardSecurityCode&quot;</span><span class="nt">&gt;</span>security code of your
                        card<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;cardSecurityCode&quot;</span><span class="nt">&gt;</span>${f:h(account.cardSecurityCode)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/table&gt;</span>

        <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span>
            <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/account/update&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;home&quot;</span> <span class="na">id=</span><span class="s">&quot;home&quot;</span> <span class="na">value=</span><span class="s">&quot;home&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form&gt;</span>

    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="checking-operation">
<h4><a class="toc-backref" href="#id45">11.3.5.1.4. Checking operation</a><a class="headerlink" href="#checking-operation" title="Permalink to this headline">¶</a></h4>
<p>The account information can be updated using the implementation so far.
The transition takes place to the “Update account information” screen by clicking ‘Account Update’ button in the upper part of the product list display screen.
At present, the information of account to which the user is logged in, is displayed in the form as the initial value.
Finally the account information is updated when the user changes the form value and proceeds to the next screen.</p>
<p>Since the form that receives the input value is stored in the session with the implementation so far,
passing of data can be easily implemented.
Further, the changed information is reset if the transition takes place to the Update account information screen after clicking ‘home’ button
since the session is discarded when ‘home’ button is clicked.</p>
</div>
</div>
<div class="section" id="create-cart-item-registration-function">
<h3><a class="toc-backref" href="#id46">11.3.5.2. Create cart item registration function</a><a class="headerlink" href="#create-cart-item-registration-function" title="Permalink to this headline">¶</a></h3>
<p>Create a function to register the products for a spe cified quantity in the cart.</p>
<p>Manage the cart information as a Bean for session scope as explained in <a class="reference internal" href="#development-policy"><span class="std std-ref">Application design</span></a>.</p>
<p>The information of screen implemented in cart item registration function is shown below.</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="30%" />
<col width="15%" />
<col width="25%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Process name</th>
<th class="head">HTTP method</th>
<th class="head">Path</th>
<th class="head">Screen</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Process to add a product to the cart</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">POST</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/addToCart</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Redirect to Product list screen display process</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="section" id="defining-the-bean-for-session-scope">
<h4><a class="toc-backref" href="#id47">11.3.5.2.1. Defining the Bean for session scope</a><a class="headerlink" href="#defining-the-bean-for-session-scope" title="Permalink to this headline">¶</a></h4>
<p>Object to retain the cart information is already created as “Cart.java”.
Therefore, add the settings so as to enable handling this object as the Bean for session scope.</p>
<p>There are 2 types of configuration methods mentioned in <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/SessionManagement.html"><span class="doc">Session Management</span></a> as the methods to use the Bean for session scope.
Define the Bean using component-scan in this tutorial.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The target object needs to be ‘Serializable’ to register as the Bean for session scope</p>
</div>
<p>To define the Bean for session scope using component-scan,
the following annotation should be added to the class to be registered as Bean.</p>
<p>“/session-tutorial-init-domain/src/main/java/com/example/session/domain/model/Cart.java”</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.session.domain.model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.security.MessageDigest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.security.NoSuchAlgorithmException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.LinkedHashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Scope</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ScopedProxyMode</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.crypto.codec.Base64</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.util.SerializationUtils</span><span class="o">;</span>

<span class="hll"><span class="nd">@Component</span> <span class="c1">// (1)</span>
</span><span class="hll"><span class="nd">@Scope</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;session&quot;</span><span class="o">,</span> <span class="n">proxyMode</span> <span class="o">=</span> <span class="n">ScopedProxyMode</span><span class="o">.</span><span class="na">TARGET_CLASS</span><span class="o">)</span> <span class="c1">// (2)</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Cart</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="c1">// omitted</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify “&#64;Component” annotation so that it becomes the target for component-scan.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set Bean scope to <code class="docutils literal"><span class="pre">session</span></code>. Further, specify <code class="docutils literal"><span class="pre">ScopedProxyMode.TARGET_CLASS</span></code> using proxyMode attribute and enable scoped-proxy.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Further, the base-package that is a target for component-scan, needs to be specified in the Bean definition file.
However, since the following is already mentioned in the Bean definition file created in this tutorial, it is not required to add a new description.</p>
<p>“/session-tutorial-init-domain/src/main/resources/META-INF/spring/session-tutorial-init-domain.xml”</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&quot;com.example.session.domain&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the package used as a target for component-scan.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="creating-the-form-object">
<h4><a class="toc-backref" href="#id48">11.3.5.2.2. Creating the form object</a><a class="headerlink" href="#creating-the-form-object" title="Permalink to this headline">¶</a></h4>
<p>Create a class to retain the information of ordered products.</p>
<p>“/session-tutorial-init-web/src/main/java/com/example/session/app/goods/GoodAddForm.java”</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.session.app.goods</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.constraints.Min</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GoodAddForm</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="cm">/**</span>
<span class="cm">     *</span>
<span class="cm">     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

    <span class="nd">@NotNull</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">goodsId</span><span class="o">;</span>

    <span class="nd">@NotNull</span>
    <span class="nd">@Min</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">quantity</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getGoodsId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">goodsId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setGoodsId</span><span class="o">(</span><span class="n">String</span> <span class="n">goodsId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">goodsId</span> <span class="o">=</span> <span class="n">goodsId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getQuantity</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">quantity</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setQuantity</span><span class="o">(</span><span class="kt">int</span> <span class="n">quantity</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">quantity</span> <span class="o">=</span> <span class="n">quantity</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h4><a class="toc-backref" href="#id49">11.3.5.2.3. Creating Controller</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>Create the Controller.</p>
<p>Since it is already created to process the partial request, the following code is added.</p>
<p>“/session-tutorial-init-web/src/main/java/com/example/session/app/goods/GoodsController.java”</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.session.app.goods</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Page</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Pageable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="hll"><span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>
</span><span class="hll"><span class="kn">import</span> <span class="nn">org.springframework.validation.annotation.Validated</span><span class="o">;</span>
</span><span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PathVariable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="hll"><span class="kn">import</span> <span class="nn">org.springframework.web.servlet.mvc.support.RedirectAttributes</span><span class="o">;</span>
</span><span class="hll"><span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessages</span><span class="o">;</span>
</span>
<span class="hll"><span class="kn">import</span> <span class="nn">com.example.session.domain.model.Cart</span><span class="o">;</span>
</span><span class="hll"><span class="kn">import</span> <span class="nn">com.example.session.domain.model.CartItem</span><span class="o">;</span>
</span><span class="kn">import</span> <span class="nn">com.example.session.domain.model.Goods</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.session.domain.service.goods.GoodsService</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;goods&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GoodsController</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">GoodsService</span> <span class="n">goodsService</span><span class="o">;</span>

<span class="hll">    <span class="c1">// (1)</span>
</span><span class="hll">    <span class="nd">@Inject</span>
</span><span class="hll">    <span class="n">Cart</span> <span class="n">cart</span><span class="o">;</span>
</span>
    <span class="nd">@ModelAttribute</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;goodViewForm&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">GoodViewForm</span> <span class="nf">setUpCategoryId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">GoodViewForm</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="n">String</span> <span class="nf">showGoods</span><span class="o">(</span><span class="n">GoodViewForm</span> <span class="n">form</span><span class="o">,</span> <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">Page</span><span class="o">&lt;</span><span class="n">Goods</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">goodsService</span><span class="o">.</span><span class="na">findByCategoryId</span><span class="o">(</span><span class="n">form</span><span class="o">.</span><span class="na">getCategoryId</span><span class="o">(),</span>
                <span class="n">pageable</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;page&quot;</span><span class="o">,</span> <span class="n">page</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&quot;goods/showGoods&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;/{goodsId}&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">showGoodsDetail</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="n">String</span> <span class="n">goodsId</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">Goods</span> <span class="n">goods</span> <span class="o">=</span> <span class="n">goodsService</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">goodsId</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">goods</span><span class="o">);</span>

        <span class="k">return</span> <span class="s">&quot;/goods/showGoodsDetail&quot;</span><span class="o">;</span>
    <span class="o">}</span>

<span class="hll">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;/addToCart&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
</span><span class="hll">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addToCart</span><span class="o">(</span><span class="nd">@Validated</span> <span class="n">GoodAddForm</span> <span class="n">form</span><span class="o">,</span> <span class="n">BindingResult</span> <span class="n">result</span><span class="o">,</span>
</span><span class="hll">            <span class="n">RedirectAttributes</span> <span class="n">attributes</span><span class="o">)</span> <span class="o">{</span>
</span><span class="hll">
</span><span class="hll">        <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
</span><span class="hll">            <span class="n">ResultMessages</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">ResultMessages</span><span class="o">.</span><span class="na">error</span><span class="o">()</span>
</span><span class="hll">                    <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;e.st.go.5001&quot;</span><span class="o">);</span>
</span><span class="hll">            <span class="n">attributes</span><span class="o">.</span><span class="na">addFlashAttribute</span><span class="o">(</span><span class="n">messages</span><span class="o">);</span>
</span><span class="hll">            <span class="k">return</span> <span class="s">&quot;redirect:/goods&quot;</span><span class="o">;</span>
</span><span class="hll">        <span class="o">}</span>
</span><span class="hll">
</span><span class="hll">        <span class="n">Goods</span> <span class="n">goods</span> <span class="o">=</span> <span class="n">goodsService</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">form</span><span class="o">.</span><span class="na">getGoodsId</span><span class="o">());</span>
</span><span class="hll">        <span class="n">CartItem</span> <span class="n">cartItem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CartItem</span><span class="o">();</span>
</span><span class="hll">        <span class="n">cartItem</span><span class="o">.</span><span class="na">setGoods</span><span class="o">(</span><span class="n">goods</span><span class="o">);</span>
</span><span class="hll">        <span class="n">cartItem</span><span class="o">.</span><span class="na">setQuantity</span><span class="o">(</span><span class="n">form</span><span class="o">.</span><span class="na">getQuantity</span><span class="o">());</span>
</span><span class="hll">        <span class="n">cart</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">cartItem</span><span class="o">);</span> <span class="c1">// (2)</span>
</span><span class="hll">
</span><span class="hll">        <span class="k">return</span> <span class="s">&quot;redirect:/goods&quot;</span><span class="o">;</span>
</span><span class="hll">    <span class="o">}</span>
</span><span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch the Bean for session scope from DI container.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add the data in the Bean for session scope.</div>
<div class="line">It is not necessary to add a object to Model to display the information in the screen.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id3">
<h4><a class="toc-backref" href="#id50">11.3.5.2.4. Creating JSP</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>Create JSP to display the contents of the cart.</p>
<p>Since JSP is also already created, the code shown below is added at the end of body tag.</p>
<p>“/session-tutorial-init-web/src/main/webapp/WEB-INF/views/goods/showGoods.jsp”</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;title&gt;</span>Item List Page<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/resources/app/css/styles.css&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/resources/vendor/bootstrap-3.0.0/css/bootstrap.css&quot;</span>
    <span class="na">media=</span><span class="s">&quot;screen, projection&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

    <span class="nt">&lt;sec:authentication</span> <span class="na">property=</span><span class="s">&quot;principal&quot;</span> <span class="na">var=</span><span class="s">&quot;userDetails&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;display: inline-flex&quot;</span><span class="nt">&gt;</span>
        welcome<span class="ni">&amp;nbsp;&amp;nbsp;</span> <span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">&quot;userName&quot;</span><span class="nt">&gt;</span>${f:h(userDetails.account.name)}<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/logout&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">id=</span><span class="s">&quot;logout&quot;</span> <span class="na">value=</span><span class="s">&quot;logout&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;sec:csrfInput</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span>
            <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/account/update&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;form1&quot;</span> <span class="na">id=</span><span class="s">&quot;updateAccount&quot;</span>
                <span class="na">value=</span><span class="s">&quot;Account Update&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;br&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;p&gt;</span>select a category<span class="nt">&lt;/p&gt;</span>

        <span class="nt">&lt;form:form</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span>
            <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/goods/&quot;</span>
            <span class="na">modelAttribute=</span><span class="s">&quot;goodViewForm&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;form:select</span> <span class="na">path=</span><span class="s">&quot;categoryId&quot;</span> <span class="na">items=</span><span class="s">&quot;${CL_CATEGORIES}&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">id=</span><span class="s">&quot;update&quot;</span> <span class="na">value=</span><span class="s">&quot;update&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form:form&gt;</span>
        <span class="nt">&lt;br</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;t:messagesPanel</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;table&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;th&gt;</span>Name<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th&gt;</span>Price<span class="nt">&lt;/th&gt;</span>
<span class="hll">                <span class="nt">&lt;th&gt;</span>Quantity<span class="nt">&lt;/th&gt;</span>
</span>            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;c:forEach</span> <span class="na">items=</span><span class="s">&quot;${page.content}&quot;</span> <span class="na">var=</span><span class="s">&quot;goods&quot;</span> <span class="na">varStatus=</span><span class="s">&quot;status&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;a</span> <span class="na">id=</span><span class="s">&quot;${f:h(goods.name)}&quot;</span>
                        <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/goods/${f:h(goods.id)}&quot;</span><span class="nt">&gt;</span>${f:h(goods.name)}<span class="nt">&lt;/a&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;fmt:formatNumber</span> <span class="na">value=</span><span class="s">&quot;${f:h(goods.price)}&quot;</span>
                            <span class="na">type=</span><span class="s">&quot;CURRENCY&quot;</span> <span class="na">currencySymbol=</span><span class="s">&quot;&amp;yen;&quot;</span> <span class="na">maxFractionDigits=</span><span class="s">&quot;0&quot;</span> <span class="nt">/&gt;&lt;/td&gt;</span>
<span class="hll">                    <span class="nt">&lt;td&gt;&lt;form:form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span>
</span><span class="hll">                            <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/goods/addToCart&quot;</span>
</span><span class="hll">                            <span class="na">modelAttribute=</span><span class="s">&quot;goodAddForm&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;quantity&quot;</span> <span class="na">id=</span><span class="s">&quot;quantity${status.index}&quot;</span> <span class="na">value=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name=</span><span class="s">&quot;goodsId&quot;</span> <span class="na">value=</span><span class="s">&quot;${f:h(goods.id)}&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">id=</span><span class="s">&quot;add${status.index}&quot;</span> <span class="na">value=</span><span class="s">&quot;add&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;/form:form&gt;&lt;/td&gt;</span>
</span>                <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/c:forEach&gt;</span>
        <span class="nt">&lt;/table&gt;</span>
        <span class="nt">&lt;t:pagination</span> <span class="na">page=</span><span class="s">&quot;${page}&quot;</span> <span class="na">outerElementClass=</span><span class="s">&quot;pagination&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;p&gt;</span>
            <span class="nt">&lt;fmt:formatNumber</span> <span class="na">value=</span><span class="s">&quot;${page.totalElements}&quot;</span> <span class="nt">/&gt;</span>
            results <span class="nt">&lt;br&gt;</span> ${f:h(page.number + 1) } / ${f:h(page.totalPages)}
            Pages
        <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="hll">    <span class="nt">&lt;div&gt;</span>
</span><span class="hll">        <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span><span class="hll">        <span class="nt">&lt;spring:eval</span> <span class="na">var=</span><span class="s">&quot;cart&quot;</span> <span class="na">expression=</span><span class="s">&quot;@cart&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">        <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/cart&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">id=</span><span class="s">&quot;viewCart&quot;</span> <span class="na">value=</span><span class="s">&quot;view cart&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/form&gt;</span>
</span><span class="hll">        <span class="nt">&lt;table&gt;</span>
</span><span class="hll">            <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="o">--</span><span class="k">%&gt;</span>
</span><span class="hll">            <span class="nt">&lt;c:forEach</span> <span class="na">items=</span><span class="s">&quot;${cart.cartItems}&quot;</span> <span class="na">var=</span><span class="s">&quot;cartItem&quot;</span> <span class="na">varStatus=</span><span class="s">&quot;status&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;tr&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;itemName${status.index}&quot;</span><span class="nt">&gt;</span>${f:h(cartItem.goods.name)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;itemPrice${status.index}&quot;</span><span class="nt">&gt;&lt;fmt:formatNumber</span>
</span><span class="hll">                                <span class="na">value=</span><span class="s">&quot;${cartItem.goods.price}&quot;</span> <span class="na">type=</span><span class="s">&quot;CURRENCY&quot;</span>
</span><span class="hll">                                <span class="na">currencySymbol=</span><span class="s">&quot;&amp;yen;&quot;</span> <span class="na">maxFractionDigits=</span><span class="s">&quot;0&quot;</span> <span class="nt">/&gt;&lt;/span&gt;&lt;/td&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;itemQuantity${status.index}&quot;</span><span class="nt">&gt;</span>${f:h(cartItem.quantity)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/tr&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/c:forEach&gt;</span>
</span><span class="hll">            <span class="nt">&lt;tr&gt;</span>
</span><span class="hll">                <span class="nt">&lt;td&gt;</span>Total<span class="nt">&lt;/td&gt;</span>
</span><span class="hll">                <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;totalPrice&quot;</span><span class="nt">&gt;&lt;fmt:formatNumber</span>
</span><span class="hll">                            <span class="na">value=</span><span class="s">&quot;${f:h(cart.totalAmount)}&quot;</span> <span class="na">type=</span><span class="s">&quot;CURRENCY&quot;</span>
</span><span class="hll">                            <span class="na">currencySymbol=</span><span class="s">&quot;&amp;yen;&quot;</span> <span class="na">maxFractionDigits=</span><span class="s">&quot;0&quot;</span> <span class="nt">/&gt;&lt;/span&gt;&lt;/td&gt;</span>
</span><span class="hll">                <span class="nt">&lt;td&gt;&lt;/td&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/tr&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/table&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/div&gt;</span>
</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Store the Bean in a variable in order to display the contents of the Bean for session scope in a screen.</div>
<div class="line">Cart object in session scope is stored in variable “cart” in the above example.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Browse the contents of the Bean for session scope through the variable created in (1).</div>
<div class="line">The contents of the Bean for session scope are browsed through variable “var” in the above example.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">var attribute is not required if simply the contents of Bean are to be displayed alone without storing them in a variable.
It can be displayed using “&lt;spring:eval expression=”&#64;cart” /&gt;” in the above example.</p>
</div>
<p>“/session-tutorial-init-web/src/main/webapp/WEB-INF/views/goods/showGoodsDetail.jsp”</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;title&gt;</span>Item List Page<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/resources/app/css/styles.css&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

    <span class="nt">&lt;sec:authentication</span> <span class="na">property=</span><span class="s">&quot;principal&quot;</span> <span class="na">var=</span><span class="s">&quot;userDetails&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;display: inline-flex&quot;</span><span class="nt">&gt;</span>
        welcome<span class="ni">&amp;nbsp;&amp;nbsp;</span> <span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">&quot;userName&quot;</span><span class="nt">&gt;</span>${f:h(userDetails.account.name)}<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;form:form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span>
            <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/logout&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">id=</span><span class="s">&quot;logout&quot;</span> <span class="na">value=</span><span class="s">&quot;logout&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form:form&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span>
            <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/account/update&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;form1&quot;</span> <span class="na">id=</span><span class="s">&quot;updateAccount&quot;</span>
                <span class="na">value=</span><span class="s">&quot;Account Update&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;br&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>

        <span class="nt">&lt;table&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;th&gt;</span>Name<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;td&gt;</span>${f:h(goods.name)}<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;th&gt;</span>Price<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;td&gt;&lt;fmt:formatNumber</span> <span class="na">value=</span><span class="s">&quot;${f:h(goods.price)}&quot;</span>
                        <span class="na">type=</span><span class="s">&quot;CURRENCY&quot;</span> <span class="na">currencySymbol=</span><span class="s">&quot;&amp;yen;&quot;</span> <span class="na">maxFractionDigits=</span><span class="s">&quot;0&quot;</span> <span class="nt">/&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;th&gt;</span>Description<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;td&gt;</span>${f:h(goods.description)}<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/table&gt;</span>
<span class="hll">        <span class="nt">&lt;form:form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span>
</span><span class="hll">            <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/goods/addToCart&quot;</span>
</span><span class="hll">            <span class="na">modelAttribute=</span><span class="s">&quot;AddToCartForm&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            Quantity<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;quantity&quot;</span> <span class="na">name=</span><span class="s">&quot;quantity&quot;</span>
</span><span class="hll">                <span class="na">value=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name=</span><span class="s">&quot;goodsId&quot;</span> <span class="na">value=</span><span class="s">&quot;${f:h(goods.id)}&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">id=</span><span class="s">&quot;add&quot;</span> <span class="na">value=</span><span class="s">&quot;add&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/form:form&gt;</span>
</span>
        <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/goods&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">id=</span><span class="s">&quot;home&quot;</span> <span class="na">value=</span><span class="s">&quot;home&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="hll">    <span class="nt">&lt;div&gt;</span>
</span><span class="hll">        <span class="nt">&lt;spring:eval</span> <span class="na">var=</span><span class="s">&quot;cart&quot;</span> <span class="na">expression=</span><span class="s">&quot;@cart&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">        <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/cart&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;view cart&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/form&gt;</span>
</span><span class="hll">        <span class="nt">&lt;table&gt;</span>
</span><span class="hll">            <span class="nt">&lt;c:forEach</span> <span class="na">items=</span><span class="s">&quot;${cart.cartItems}&quot;</span> <span class="na">var=</span><span class="s">&quot;cartItem&quot;</span>
</span><span class="hll">                <span class="na">varStatus=</span><span class="s">&quot;status&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;tr&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;itemName${status.index}&quot;</span><span class="nt">&gt;</span>${f:h(cartItem.goods.name)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;itemPrice${status.index}&quot;</span><span class="nt">&gt;&lt;fmt:formatNumber</span>
</span><span class="hll">                                <span class="na">value=</span><span class="s">&quot;${cartItem.goods.price}&quot;</span> <span class="na">type=</span><span class="s">&quot;CURRENCY&quot;</span>
</span><span class="hll">                                <span class="na">currencySymbol=</span><span class="s">&quot;&amp;yen;&quot;</span> <span class="na">maxFractionDigits=</span><span class="s">&quot;0&quot;</span> <span class="nt">/&gt;&lt;/span&gt;&lt;/td&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;itemQuantity${status.index}&quot;</span><span class="nt">&gt;</span>${f:h(cartItem.quantity)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/tr&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/c:forEach&gt;</span>
</span><span class="hll">            <span class="nt">&lt;tr&gt;</span>
</span><span class="hll">                <span class="nt">&lt;td&gt;</span>Total<span class="nt">&lt;/td&gt;</span>
</span><span class="hll">                <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;totalPrice&quot;</span><span class="nt">&gt;&lt;fmt:formatNumber</span>
</span><span class="hll">                            <span class="na">value=</span><span class="s">&quot;${f:h(cart.totalAmount)}&quot;</span> <span class="na">type=</span><span class="s">&quot;CURRENCY&quot;</span>
</span><span class="hll">                            <span class="na">currencySymbol=</span><span class="s">&quot;&amp;yen;&quot;</span> <span class="na">maxFractionDigits=</span><span class="s">&quot;0&quot;</span> <span class="nt">/&gt;&lt;/span&gt;&lt;/td&gt;</span>
</span><span class="hll">                <span class="nt">&lt;td&gt;&lt;/td&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/tr&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/table&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/div&gt;</span>
</span><span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h4><a class="toc-backref" href="#id51">11.3.5.2.5. Checking operation</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>Products can be registered to the cart with the implementation so far.
Contents of the cart on the same page are displayed by clicking ‘add’ button for a product on the product list display screen.</p>
<p>Since the cart object is stored in the session with the implementation so far,
cart information is saved even though moved to the account information update screen and returned.</p>
</div>
</div>
<div class="section" id="create-a-mechanism-to-retain-the-product-search-information">
<h3><a class="toc-backref" href="#id52">11.3.5.3. Create a mechanism to retain the product search information</a><a class="headerlink" href="#create-a-mechanism-to-retain-the-product-search-information" title="Permalink to this headline">¶</a></h3>
<p>Products can be added to the cart with the implementation so far.
However, screen where the transition after adding products takes place, is usually the 1st page of ‘book’ category.</p>
<p>This tutorial has a specification to retain the product search information including the selection category and page number till the order is completed.
Therefore, modify the implementation so as to transit to the previous status after adding products or when returned from the account update screen.</p>
<p>Manage the product search information as the Bean for session scope as explained in <a class="reference internal" href="#development-policy"><span class="std std-ref">Application design</span></a>.</p>
<p>Information of screen to be modified is shown below.</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="30%" />
<col width="15%" />
<col width="25%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Process name</th>
<th class="head">HTTP method</th>
<th class="head">Path</th>
<th class="head">Screen</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Product list screen display process (default)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/goods <strong>(created)</strong></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/goods/showGoods</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Product list screen display process (while selecting category)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/goods?categoryId <strong>(created)</strong></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/goods/showGoods</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Product list screen display process (while selecting page)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/goods?page <strong>(created)</strong></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/goods/showGoods</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="section" id="create-session-scope-bean">
<h4><a class="toc-backref" href="#id53">11.3.5.3.1. Create session scope Bean</a><a class="headerlink" href="#create-session-scope-bean" title="Permalink to this headline">¶</a></h4>
<p>Create the session scope Bean to retain the product search information.
Define a bean using component-scan similar to the cart information.</p>
<p>“/session-tutorial-init-web/src/main/java/com/example/session/app/goods/GoodsSearchCriteria.java”</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.session.app.goods</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Scope</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ScopedProxyMode</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="nd">@Component</span> <span class="c1">// (1)</span>
<span class="nd">@Scope</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;session&quot;</span><span class="o">,</span> <span class="n">proxyMode</span> <span class="o">=</span> <span class="n">ScopedProxyMode</span><span class="o">.</span><span class="na">TARGET_CLASS</span><span class="o">)</span> <span class="c1">// (2)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GoodsSearchCriteria</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="cm">/**</span>
<span class="cm">     *</span>
<span class="cm">     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">categoryId</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">page</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCategoryId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">categoryId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCategoryId</span><span class="o">(</span><span class="kt">int</span> <span class="n">categoryId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">categoryId</span> <span class="o">=</span> <span class="n">categoryId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getPage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">page</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPage</span><span class="o">(</span><span class="kt">int</span> <span class="n">page</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">page</span> <span class="o">=</span> <span class="n">page</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clear</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">categoryId</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
        <span class="n">page</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify “&#64;Component” annotation so that it becomes the target for component-scan</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set scope of Bean as <code class="docutils literal"><span class="pre">session</span></code>. Further, specify <code class="docutils literal"><span class="pre">ScopedProxyMode.TARGET_CLASS</span></code> in proxyMode attribute and enable scoped-proxy.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Further, it is required to specify base-package that is a target for component-scan in Bean definition file. However, since the following is already mentioned in the Bean definition file created in this tutorial, it is not required to add a new description.</p>
<p>“/session-tutorial-init-web/src/main/resources/META-INF/spring/spring-mvc.xml”</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&quot;com.example.session.app&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the package that is a target for component-scan.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="modifying-controller">
<h4><a class="toc-backref" href="#id54">11.3.5.3.2. Modifying Controller</a><a class="headerlink" href="#modifying-controller" title="Permalink to this headline">¶</a></h4>
<p>Modify the Controller so as to retain the product search information in the session and to use the product search information retained in the session.</p>
<p>“/session-tutorial-init-web/src/main/java/com/example/session/app/goods/GoodsController.java”</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.session.app.goods</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Page</span><span class="o">;</span>
<span class="hll"><span class="kn">import</span> <span class="nn">org.springframework.data.domain.PageRequest</span><span class="o">;</span>
</span><span class="kn">import</span> <span class="nn">org.springframework.data.domain.Pageable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.annotation.Validated</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PathVariable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.mvc.support.RedirectAttributes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessages</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.session.domain.model.Cart</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.session.domain.model.CartItem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.session.domain.model.Goods</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.session.domain.service.goods.GoodsService</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;goods&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GoodsController</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">GoodsService</span> <span class="n">goodsService</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="n">Cart</span> <span class="n">cart</span><span class="o">;</span>

<span class="hll">    <span class="c1">// (1)</span>
</span><span class="hll">    <span class="nd">@Inject</span>
</span><span class="hll">    <span class="n">GoodsSearchCriteria</span> <span class="n">criteria</span><span class="o">;</span>
</span>
    <span class="nd">@ModelAttribute</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;goodViewForm&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">GoodViewForm</span> <span class="nf">setUpCategoryId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">GoodViewForm</span><span class="o">();</span>
    <span class="o">}</span>

<span class="hll">    <span class="c1">// (2)</span>
</span><span class="hll">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
</span><span class="hll">    <span class="n">String</span> <span class="nf">showGoods</span><span class="o">(</span><span class="n">GoodViewForm</span> <span class="n">form</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
</span><span class="hll">        <span class="n">Pageable</span> <span class="n">pageable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PageRequest</span><span class="o">(</span><span class="n">criteria</span><span class="o">.</span><span class="na">getPage</span><span class="o">(),</span> <span class="mi">3</span><span class="o">);</span>
</span><span class="hll">        <span class="n">form</span><span class="o">.</span><span class="na">setCategoryId</span><span class="o">(</span><span class="n">criteria</span><span class="o">.</span><span class="na">getCategoryId</span><span class="o">());</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">showGoods</span><span class="o">(</span><span class="n">pageable</span><span class="o">,</span> <span class="n">model</span><span class="o">);</span>
</span><span class="hll">    <span class="o">}</span>
</span><span class="hll">
</span><span class="hll">    <span class="c1">// (3)</span>
</span><span class="hll">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;categoryId&quot;</span><span class="o">)</span>
</span><span class="hll">    <span class="n">String</span> <span class="nf">changeCategoryId</span><span class="o">(</span><span class="n">GoodViewForm</span> <span class="n">form</span><span class="o">,</span> <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
</span><span class="hll">        <span class="n">criteria</span><span class="o">.</span><span class="na">setPage</span><span class="o">(</span><span class="n">pageable</span><span class="o">.</span><span class="na">getPageNumber</span><span class="o">());</span>
</span><span class="hll">        <span class="n">criteria</span><span class="o">.</span><span class="na">setCategoryId</span><span class="o">(</span><span class="n">form</span><span class="o">.</span><span class="na">getCategoryId</span><span class="o">());</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">showGoods</span><span class="o">(</span><span class="n">pageable</span><span class="o">,</span> <span class="n">model</span><span class="o">);</span>
</span><span class="hll">    <span class="o">}</span>
</span><span class="hll">
</span><span class="hll">    <span class="c1">// (4)</span>
</span><span class="hll">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;page&quot;</span><span class="o">)</span>
</span><span class="hll">    <span class="n">String</span> <span class="nf">changePage</span><span class="o">(</span><span class="n">GoodViewForm</span> <span class="n">form</span><span class="o">,</span> <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
</span><span class="hll">        <span class="n">criteria</span><span class="o">.</span><span class="na">setPage</span><span class="o">(</span><span class="n">pageable</span><span class="o">.</span><span class="na">getPageNumber</span><span class="o">());</span>
</span><span class="hll">        <span class="n">form</span><span class="o">.</span><span class="na">setCategoryId</span><span class="o">(</span><span class="n">criteria</span><span class="o">.</span><span class="na">getCategoryId</span><span class="o">());</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">showGoods</span><span class="o">(</span><span class="n">pageable</span><span class="o">,</span> <span class="n">model</span><span class="o">);</span>
</span><span class="hll">    <span class="o">}</span>
</span><span class="hll">
</span><span class="hll">    <span class="c1">// (5)</span>
</span><span class="hll">    <span class="n">String</span> <span class="nf">showGoods</span><span class="o">(</span><span class="n">Pageable</span> <span class="n">pageable</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
</span><span class="hll">        <span class="n">Page</span><span class="o">&lt;</span><span class="n">Goods</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">goodsService</span><span class="o">.</span><span class="na">findByCategoryId</span><span class="o">(</span>
</span><span class="hll">                <span class="n">criteria</span><span class="o">.</span><span class="na">getCategoryId</span><span class="o">(),</span> <span class="n">pageable</span><span class="o">);</span>
</span><span class="hll">        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;page&quot;</span><span class="o">,</span> <span class="n">page</span><span class="o">);</span>
</span><span class="hll">        <span class="k">return</span> <span class="s">&quot;goods/showGoods&quot;</span><span class="o">;</span>
</span><span class="hll">    <span class="o">}</span>
</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;/{goodsId}&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">showGoodsDetail</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="n">String</span> <span class="n">goodsId</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">Goods</span> <span class="n">goods</span> <span class="o">=</span> <span class="n">goodsService</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">goodsId</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">goods</span><span class="o">);</span>

        <span class="k">return</span> <span class="s">&quot;/goods/showGoodsDetail&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;/addToCart&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addToCart</span><span class="o">(</span><span class="nd">@Validated</span> <span class="n">GoodAddForm</span> <span class="n">form</span><span class="o">,</span> <span class="n">BindingResult</span> <span class="n">result</span><span class="o">,</span>
            <span class="n">RedirectAttributes</span> <span class="n">attributes</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">ResultMessages</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">ResultMessages</span><span class="o">.</span><span class="na">error</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;e.st.go.5001&quot;</span><span class="o">);</span>
            <span class="n">attributes</span><span class="o">.</span><span class="na">addFlashAttribute</span><span class="o">(</span><span class="n">messages</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&quot;redirect:/goods&quot;</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">Goods</span> <span class="n">goods</span> <span class="o">=</span> <span class="n">goodsService</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">form</span><span class="o">.</span><span class="na">getGoodsId</span><span class="o">());</span>
        <span class="n">CartItem</span> <span class="n">cartItem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CartItem</span><span class="o">();</span>
        <span class="n">cartItem</span><span class="o">.</span><span class="na">setGoods</span><span class="o">(</span><span class="n">goods</span><span class="o">);</span>
        <span class="n">cartItem</span><span class="o">.</span><span class="na">setQuantity</span><span class="o">(</span><span class="n">form</span><span class="o">.</span><span class="na">getQuantity</span><span class="o">());</span>
        <span class="n">cart</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">cartItem</span><span class="o">);</span>

        <span class="k">return</span> <span class="s">&quot;redirect:/goods&quot;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch the Bean for session scope from DI container.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Perform the pre-processing of the usual product list screen display process. Set the product category stored in the session to the form and the page number to “pageable”. The product category is set to the form in order to specify the product category displayed using the select box.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Perform the pre-processing of the product list screen display process when the category is changed. Store the product category entered in the session. Specify the default 1st page of the page numbers in “pageable”.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Perform the pre-processing of the product list screen display process when the page is changed. Store the page number entered in the session. Set the product category stored in the session in the form.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Handle the common portion. Search a product based on product category managed in session and “pageable” fetched in the preprocessing.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id5">
<h4><a class="toc-backref" href="#id55">11.3.5.3.3. Checking operation</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>Product search information can be retained with the implementation so far.
For example, when a product is added to the cart on the 2nd page of ‘music’ category, the destination for transition remains the original 2nd page of ‘music’ category.
Further, when ‘Account Update’ button is clicked on the same screen, moved to the account update screen, ‘home’ button on the account update screen is clicked and returned, the destination for transition is just the original 2nd page of ‘music’ category.</p>
</div>
</div>
<div class="section" id="create-cart-item-deletion-function">
<h3><a class="toc-backref" href="#id56">11.3.5.4. Create cart item deletion function</a><a class="headerlink" href="#create-cart-item-deletion-function" title="Permalink to this headline">¶</a></h3>
<p>Create a function to delete the specified product from the cart.</p>
<p>Use checkbox to specify the product to be deleted.</p>
<p>The information of screen implemented using the cart item deletion function is shown below.</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="30%" />
<col width="15%" />
<col width="25%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Process name</th>
<th class="head">HTTP method</th>
<th class="head">Path</th>
<th class="head">Screen</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Cart screen display process</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/cart</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">cart/viewCart</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Process to delete a product from the cart</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">POST</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/cart</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Redirect to cart screen display process</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="section" id="id6">
<h4><a class="toc-backref" href="#id57">11.3.5.4.1. Creating form object</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>Create a class to retain ID of the product to be deleted.</p>
<p>“/session-tutorial-init-web/src/main/java/com/example/session/app/cart/CartForm.java”</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.session.app.cart</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.validator.constraints.NotEmpty</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CartForm</span> <span class="o">{</span>

    <span class="nd">@NotEmpty</span>
    <span class="kd">private</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">removedItemsIds</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getRemovedItemsIds</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">removedItemsIds</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRemovedItemsIds</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">removedItemsIds</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">removedItemsIds</span> <span class="o">=</span> <span class="n">removedItemsIds</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h4><a class="toc-backref" href="#id58">11.3.5.4.2. Creating Controller</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<p>Create Controller.</p>
<p>“/session-tutorial-init-web/src/main/java/com/example/session/app/cart/CartController.java”</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.session.app.cart</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.annotation.Validated</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessages</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.session.domain.model.Cart</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;cart&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CartController</span> <span class="o">{</span>

    <span class="c1">// (1)</span>
    <span class="nd">@Inject</span>
    <span class="n">Cart</span> <span class="n">cart</span><span class="o">;</span>

    <span class="nd">@ModelAttribute</span>
    <span class="n">CartForm</span> <span class="nf">setUpForm</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">CartForm</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="n">String</span> <span class="nf">viewCart</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;cart/viewCart&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="n">String</span> <span class="nf">removeFromCart</span><span class="o">(</span><span class="nd">@Validated</span> <span class="n">CartForm</span> <span class="n">cartForm</span><span class="o">,</span>
            <span class="n">BindingResult</span> <span class="n">bindingResult</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">bindingResult</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">ResultMessages</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">ResultMessages</span><span class="o">.</span><span class="na">error</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;e.st.ca.5001&quot;</span><span class="o">);</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">messages</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">viewCart</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">cart</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">cartForm</span><span class="o">.</span><span class="na">getRemovedItemsIds</span><span class="o">());</span> <span class="c1">// (2)</span>
        <span class="k">return</span> <span class="s">&quot;redirect:/cart&quot;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch the Bean for session scope from DI container.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Delete the data in the Bean for session scope.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id8">
<h4><a class="toc-backref" href="#id59">11.3.5.4.3. Creating JSP</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>Display the cart list and create JSP to select the product to be deleted.
Products can be ordered from this screen.</p>
<p>“/session-tutorial-init-web/src/main/webapp/WEB-INF/views/cart/viewCart.jsp”</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;title&gt;</span>View Cart Page<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/resources/app/css/styles.css&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

    <span class="nt">&lt;sec:authentication</span> <span class="na">property=</span><span class="s">&quot;principal&quot;</span> <span class="na">var=</span><span class="s">&quot;userDetails&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;display: inline-flex&quot;</span><span class="nt">&gt;</span>
        welcome ${f:h(userDetails.account.name)}
        <span class="nt">&lt;form:form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span>
            <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/logout&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">id=</span><span class="s">&quot;logout&quot;</span> <span class="na">value=</span><span class="s">&quot;logout&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form:form&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span>
            <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/account/update&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;form1&quot;</span> <span class="na">id=</span><span class="s">&quot;updateAccount&quot;</span>
                <span class="na">value=</span><span class="s">&quot;Account Update&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;br&gt;</span>

    <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;spring:eval</span> <span class="na">var=</span><span class="s">&quot;cart&quot;</span> <span class="na">expression=</span><span class="s">&quot;@cart&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;form:form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span>
            <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/cart&quot;</span>
            <span class="na">modelAttribute=</span><span class="s">&quot;cartForm&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;removedItemsIds&quot;</span> <span class="na">cssClass=</span><span class="s">&quot;error-messages&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;t:messagesPanel</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;table&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;th&gt;</span>Name<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;th&gt;</span>Price<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;th&gt;</span>Quantity<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;th&gt;</span>Remove<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;c:forEach</span> <span class="na">items=</span><span class="s">&quot;${cart.cartItems}&quot;</span> <span class="na">var=</span><span class="s">&quot;cartItem&quot;</span>
                    <span class="na">varStatus=</span><span class="s">&quot;status&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;tr&gt;</span>
                        <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;itemName${status.index}&quot;</span><span class="nt">&gt;</span>${f:h(cartItem.goods.name)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;itemPrice${status.index}&quot;</span><span class="nt">&gt;&lt;fmt:formatNumber</span>
                                    <span class="na">value=</span><span class="s">&quot;${cartItem.goods.price}&quot;</span> <span class="na">type=</span><span class="s">&quot;CURRENCY&quot;</span>
                                    <span class="na">currencySymbol=</span><span class="s">&quot;&amp;yen;&quot;</span> <span class="na">maxFractionDigits=</span><span class="s">&quot;0&quot;</span> <span class="nt">/&gt;&lt;/span&gt;&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;itemQuantity${status.index}&quot;</span><span class="nt">&gt;</span>${f:h(cartItem.quantity)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
                        <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">--</span><span class="k">%&gt;</span>
                        <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">name=</span><span class="s">&quot;removedItemsIds&quot;</span>
                            <span class="na">id=</span><span class="s">&quot;removedItemsIds${status.index}&quot;</span>
                            <span class="na">value=</span><span class="s">&quot;${f:h(cartItem.goods.id)}&quot;</span> <span class="nt">/&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;/c:forEach&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;</span>Total<span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;totalPrice&quot;</span><span class="nt">&gt;&lt;fmt:formatNumber</span>
                                <span class="na">value=</span><span class="s">&quot;${f:h(cart.totalAmount)}&quot;</span> <span class="na">type=</span><span class="s">&quot;CURRENCY&quot;</span>
                                <span class="na">currencySymbol=</span><span class="s">&quot;&amp;yen;&quot;</span> <span class="na">maxFractionDigits=</span><span class="s">&quot;0&quot;</span> <span class="nt">/&gt;&lt;/span&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/table&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">id=</span><span class="s">&quot;remove&quot;</span> <span class="na">value=</span><span class="s">&quot;remove&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form:form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;display: inline-flex&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/order&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">id=</span><span class="s">&quot;confirm&quot;</span> <span class="na">name=</span><span class="s">&quot;confirm&quot;</span>
                <span class="na">value=</span><span class="s">&quot;confirm your order&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/goods&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">id=</span><span class="s">&quot;home&quot;</span> <span class="na">value=</span><span class="s">&quot;home&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the product to be deleted using a checkbox.</div>
<div class="line">When Delete button is clicked with the checkbox selected, ID of the corresponding product is sent to the server.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id9">
<h4><a class="toc-backref" href="#id60">11.3.5.4.4. Checking operation</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<p>Products registered in the cart can be deleted with the implementation so far.
Transition to the cart display screen takes place by clicking ‘viewCart’ button on the product list display screen.
Product can be deleted from the cart by checking the product to be deleted on the cart display screen and clicking ‘remove’ button.</p>
</div>
</div>
<div class="section" id="create-the-product-order-function">
<h3><a class="toc-backref" href="#id61">11.3.5.5. Create the product order function</a><a class="headerlink" href="#create-the-product-order-function" title="Permalink to this headline">¶</a></h3>
<p>Create a function to order the products registered in the cart.</p>
<p>Contents of the cart become blank after the order completion.</p>
<p>Information of the screen implemented in the product order function is shown below.</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="30%" />
<col width="15%" />
<col width="25%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Process name</th>
<th class="head">HTTP method</th>
<th class="head">Path</th>
<th class="head">Screen</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Order confirmation screen display process</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/order?confirm</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">order/confirm</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Order processing</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">POST</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/order</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Redirect to order completion screen display process</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Order completion screen display process</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">GET</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">/order?finish</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">order/finish</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="section" id="id10">
<h4><a class="toc-backref" href="#id62">11.3.5.5.1. Creating Controller</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<p>Create the Controller.</p>
<p>“/session-tutorial-init-web/src/main/java/com/example/session/app/order/OrderController.java”</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.session.app.order</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.http.HttpStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.core.annotation.AuthenticationPrincipal</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ExceptionHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.ModelAndView</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.mvc.support.RedirectAttributes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.exception.BusinessException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessages</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.session.app.goods.GoodsSearchCriteria</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.session.domain.model.Cart</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.session.domain.model.Order</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.session.domain.service.order.EmptyCartOrderException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.session.domain.service.order.InvalidCartOrderException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.session.domain.service.order.OrderService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.session.domain.service.userdetails.AccountDetails</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;order&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderController</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>

    <span class="c1">// (1)</span>
    <span class="nd">@Inject</span>
    <span class="n">Cart</span> <span class="n">cart</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="n">GoodsSearchCriteria</span> <span class="n">criteria</span><span class="o">;</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;confirm&quot;</span><span class="o">)</span>
    <span class="n">String</span> <span class="nf">confirm</span><span class="o">(</span><span class="nd">@AuthenticationPrincipal</span> <span class="n">AccountDetails</span> <span class="n">userDetails</span><span class="o">,</span>
            <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">cart</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">ResultMessages</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">ResultMessages</span><span class="o">.</span><span class="na">error</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;e.st.od.5001&quot;</span><span class="o">);</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">messages</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&quot;cart/viewCart&quot;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;account&quot;</span><span class="o">,</span> <span class="n">userDetails</span><span class="o">.</span><span class="na">getAccount</span><span class="o">());</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;signature&quot;</span><span class="o">,</span> <span class="n">cart</span><span class="o">.</span><span class="na">calcSignature</span><span class="o">());</span>
        <span class="k">return</span> <span class="s">&quot;order/confirm&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="n">String</span> <span class="nf">order</span><span class="o">(</span><span class="nd">@AuthenticationPrincipal</span> <span class="n">AccountDetails</span> <span class="n">userDetails</span><span class="o">,</span>
            <span class="nd">@RequestParam</span> <span class="n">String</span> <span class="n">signature</span><span class="o">,</span> <span class="n">RedirectAttributes</span> <span class="n">attributes</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">purchase</span><span class="o">(</span><span class="n">userDetails</span><span class="o">.</span><span class="na">getAccount</span><span class="o">(),</span> <span class="n">cart</span><span class="o">,</span>
                <span class="n">signature</span><span class="o">);</span> <span class="c1">// (2)</span>
        <span class="n">attributes</span><span class="o">.</span><span class="na">addFlashAttribute</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        <span class="n">criteria</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span> <span class="c1">// (3)</span>
        <span class="k">return</span> <span class="s">&quot;redirect:/order?finish&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&quot;finish&quot;</span><span class="o">)</span>
    <span class="n">String</span> <span class="nf">finish</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;order/finish&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (4)</span>
    <span class="nd">@ExceptionHandler</span><span class="o">({</span> <span class="n">EmptyCartOrderException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
            <span class="n">InvalidCartOrderException</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
    <span class="nd">@ResponseStatus</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">CONFLICT</span><span class="o">)</span>
    <span class="n">ModelAndView</span> <span class="nf">handleOrderException</span><span class="o">(</span><span class="n">BusinessException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">ModelAndView</span><span class="o">(</span><span class="s">&quot;common/error/businessError&quot;</span><span class="o">).</span><span class="na">addObject</span><span class="o">(</span><span class="n">e</span>
                <span class="o">.</span><span class="na">getResultMessages</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch the Bean for session scope from DI container.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The contents of the Bean for session scope are made empty using the method of Service in the domain layer.</div>
<div class="line">Accordingly, Bean for session scope is discarded.</div>
<div class="line">Further, information in the Bean for session scope is used by the screen where the user transits after discarding Bean in this application.</div>
<div class="line">Therefore, information that existed in the Bean for session scope is re-entered in a different object and added to the Flash scope.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Product search information is returned to the default status.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Since a Business exception may occur in the Service method, error handling is performed in this method.</div>
<div class="line">Because of this, user transits to the specified error screen when a Business exception occurs.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Method to discard the Bean for session scope is different from the method to discard the object managed by &#64;SessionAttributes.
Discarding the Bean for session scope should be assigned to DI container and should not be discarded by the application.
Therefore, fields in the Bean for session scope just need to be reset to discard the Bean for session scope.
Bean itself is discarded at the time of session timeout or logout.</p>
</div>
</div>
<div class="section" id="id11">
<h4><a class="toc-backref" href="#id63">11.3.5.5.2. Creating JSP</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p>Create JSP to display order details and payment information.</p>
<p>“/session-tutorial-init-web/src/main/webapp/WEB-INF/views/order/confirm.jsp”</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;title&gt;</span>Order Page<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/resources/app/css/styles.css&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

    <span class="nt">&lt;sec:authentication</span> <span class="na">property=</span><span class="s">&quot;principal&quot;</span> <span class="na">var=</span><span class="s">&quot;userDetails&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;display: inline-flex&quot;</span><span class="nt">&gt;</span>
        welcome ${f:h(userDetails.account.name)}
        <span class="nt">&lt;form:form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span>
            <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/logout&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">id=</span><span class="s">&quot;logout&quot;</span> <span class="na">value=</span><span class="s">&quot;logout&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form:form&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span>
            <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/account/update&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;form1&quot;</span> <span class="na">id=</span><span class="s">&quot;updateAccount&quot;</span>
                <span class="na">value=</span><span class="s">&quot;Account Update&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;br&gt;</span>

    <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;spring:eval</span> <span class="na">var=</span><span class="s">&quot;cart&quot;</span> <span class="na">expression=</span><span class="s">&quot;@cart&quot;</span> <span class="nt">/&gt;</span>

        <span class="nt">&lt;h3&gt;</span>Below items will be ordered. Please push &quot;order&quot; button if
            it&#39;s OK.<span class="nt">&lt;/h3&gt;</span>
        <span class="nt">&lt;table&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;th&gt;</span>Name<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th&gt;</span>Price<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th&gt;</span>Quantity<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;c:forEach</span> <span class="na">items=</span><span class="s">&quot;${cart.cartItems}&quot;</span> <span class="na">var=</span><span class="s">&quot;cartItem&quot;</span>
                <span class="na">varStatus=</span><span class="s">&quot;status&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;itemName${status.index}&quot;</span><span class="nt">&gt;</span>${f:h(cartItem.goods.name)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;itemPrice${status.index}&quot;</span><span class="nt">&gt;&lt;fmt:formatNumber</span>
                                <span class="na">value=</span><span class="s">&quot;${cartItem.goods.price}&quot;</span> <span class="na">type=</span><span class="s">&quot;CURRENCY&quot;</span>
                                <span class="na">currencySymbol=</span><span class="s">&quot;&amp;yen;&quot;</span> <span class="na">maxFractionDigits=</span><span class="s">&quot;0&quot;</span> <span class="nt">/&gt;&lt;/span&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;itemQuantity${status.index}&quot;</span><span class="nt">&gt;</span>${f:h(cartItem.quantity)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/c:forEach&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;</span>Total<span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;totalPrice&quot;</span><span class="nt">&gt;&lt;fmt:formatNumber</span>
                            <span class="na">value=</span><span class="s">&quot;${f:h(cart.totalAmount)}&quot;</span> <span class="na">type=</span><span class="s">&quot;CURRENCY&quot;</span>
                            <span class="na">currencySymbol=</span><span class="s">&quot;&amp;yen;&quot;</span> <span class="na">maxFractionDigits=</span><span class="s">&quot;0&quot;</span> <span class="nt">/&gt;&lt;/span&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/table&gt;</span>

        <span class="nt">&lt;table&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>name<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>${f:h(account.name)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;email&quot;</span><span class="nt">&gt;</span>e-mail<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;email&quot;</span><span class="nt">&gt;</span>${f:h(account.email)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;zip&quot;</span><span class="nt">&gt;</span>zip<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;zip&quot;</span><span class="nt">&gt;</span>${f:h(account.zip)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;address&quot;</span><span class="nt">&gt;</span>address<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;address&quot;</span><span class="nt">&gt;</span>${f:h(account.address)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">--</span><span class="k">%&gt;</span>
                <span class="nt">&lt;td&gt;</span>payment<span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;payment&quot;</span><span class="nt">&gt;&lt;c:choose&gt;</span>
                            <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">&quot;${empty account.cardNumber}&quot;</span><span class="nt">&gt;</span>
                            cash
                        <span class="nt">&lt;/c:when&gt;</span>
                            <span class="nt">&lt;c:otherwise&gt;</span>
                            card (card number : ****-****-****-${f:h(account.lastFourOfCardNumber)})
                        <span class="nt">&lt;/c:otherwise&gt;</span>
                        <span class="nt">&lt;/c:choose&gt;&lt;/span&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/table&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;display: inline-flex&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;form:form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span>
            <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/order&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name=</span><span class="s">&quot;signature&quot;</span> <span class="na">value=</span><span class="s">&quot;${f:h(signature)}&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">id=</span><span class="s">&quot;order&quot;</span> <span class="na">value=</span><span class="s">&quot;order&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form:form&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/cart&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">id=</span><span class="s">&quot;back&quot;</span> <span class="na">value=</span><span class="s">&quot;back&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/goods&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">id=</span><span class="s">&quot;home&quot;</span> <span class="na">value=</span><span class="s">&quot;home&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Method of payment is card payment when card number is registered as the account information.</div>
<div class="line">It is considered as cash payment when card number is not registered.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Create JSP to display the information after the confirmation of order.</p>
<p>“/session-tutorial-init-web/src/main/webapp/WEB-INF/views/order/finish.jsp”</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;title&gt;</span>Order Page<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/resources/app/css/styles.css&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

    <span class="nt">&lt;sec:authentication</span> <span class="na">property=</span><span class="s">&quot;principal&quot;</span> <span class="na">var=</span><span class="s">&quot;userDetails&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;display: inline-flex&quot;</span><span class="nt">&gt;</span>
        welcome ${f:h(userDetails.account.name)}
        <span class="nt">&lt;form:form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span>
            <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/logout&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">id=</span><span class="s">&quot;logout&quot;</span> <span class="na">value=</span><span class="s">&quot;logout&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form:form&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span>
            <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/account/update&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;form1&quot;</span> <span class="na">id=</span><span class="s">&quot;updateAccount&quot;</span>
                <span class="na">value=</span><span class="s">&quot;Account Update&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;br&gt;</span>

    <span class="nt">&lt;div&gt;</span>

        <span class="nt">&lt;h3&gt;</span>Your order has been accepted<span class="nt">&lt;/h3&gt;</span>
        <span class="nt">&lt;table&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;orderNumber&quot;</span><span class="nt">&gt;</span>order number<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;orderNumber&quot;</span><span class="nt">&gt;</span>${f:h(order.id)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;orderDate&quot;</span><span class="nt">&gt;</span>order date<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;orderDate&quot;</span><span class="nt">&gt;&lt;fmt:formatDate</span>
                            <span class="na">value=</span><span class="s">&quot;${order.orderDate}&quot;</span> <span class="na">pattern=</span><span class="s">&quot;yyyy-MM-dd　hh:mm:ss&quot;</span> <span class="nt">/&gt;&lt;/span&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/table&gt;</span>
        <span class="nt">&lt;table&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;th&gt;</span>Name<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th&gt;</span>Price<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th&gt;</span>Quantity<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;c:forEach</span> <span class="na">items=</span><span class="s">&quot;${order.orderLines}&quot;</span> <span class="na">var=</span><span class="s">&quot;orderLine&quot;</span> <span class="na">varStatus=</span><span class="s">&quot;status&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;itemName${status.index}&quot;</span><span class="nt">&gt;</span>${f:h(orderLine.goods.name)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;itemPrice${status.index}&quot;</span><span class="nt">&gt;&lt;fmt:formatNumber</span>
                                <span class="na">value=</span><span class="s">&quot;${orderLine.goods.price}&quot;</span> <span class="na">type=</span><span class="s">&quot;CURRENCY&quot;</span>
                                <span class="na">currencySymbol=</span><span class="s">&quot;&amp;yen;&quot;</span> <span class="na">maxFractionDigits=</span><span class="s">&quot;0&quot;</span> <span class="nt">/&gt;&lt;/span&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;itemQuantity${status.index}&quot;</span><span class="nt">&gt;</span>${f:h(orderLine.quantity)}<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/c:forEach&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;</span>Total<span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;totalPrice&quot;</span><span class="nt">&gt;&lt;fmt:formatNumber</span>
                            <span class="na">value=</span><span class="s">&quot;${f:h(order.totalAmount)}&quot;</span> <span class="na">type=</span><span class="s">&quot;CURRENCY&quot;</span>
                            <span class="na">currencySymbol=</span><span class="s">&quot;&amp;yen;&quot;</span> <span class="na">maxFractionDigits=</span><span class="s">&quot;0&quot;</span> <span class="nt">/&gt;&lt;/span&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/table&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/goods&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">id=</span><span class="s">&quot;home&quot;</span> <span class="na">value=</span><span class="s">&quot;home&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h4><a class="toc-backref" href="#id64">11.3.5.5.3. Checking operation</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<p>Products registered in the cart can be ordered with the implementation so far.
Transition to the order confirmation screen takes place by clicking ‘confirm your order’ button on the cart display screen.
Order is completed by clicking ‘order’ button on the order confirmation screen.</p>
<p>Cart object in the session when the order is completed, is deleted with the implementation so far.
Therefore, contents of the cart are cleared when the user returns to the product list screen after the order completion.</p>
</div>
</div>
<div class="section" id="settings-for-session-synchronization-and-timeout">
<h3><a class="toc-backref" href="#id65">11.3.5.6. Settings for session synchronization and timeout</a><a class="headerlink" href="#settings-for-session-synchronization-and-timeout" title="Permalink to this headline">¶</a></h3>
<p>Finally perform the settings for session synchronization and timeout.</p>
<p>Session synchronization is implemented using BeanProcessor.</p>
<p>“/session-tutorial-init-web/src/main/java/com/example/session/app/config/EnableSynchronizeOnSessionPostProcessor.java”</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.session.app.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.BeansException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.config.BeanPostProcessor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EnableSynchronizeOnSessionPostProcessor</span> <span class="kd">implements</span>
        <span class="n">BeanPostProcessor</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">postProcessBeforeInitialization</span><span class="o">(</span><span class="n">Object</span> <span class="n">bean</span><span class="o">,</span> <span class="n">String</span> <span class="n">beanName</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">BeansException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">postProcessAfterInitialization</span><span class="o">(</span><span class="n">Object</span> <span class="n">bean</span><span class="o">,</span> <span class="n">String</span> <span class="n">beanName</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">BeansException</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">bean</span> <span class="k">instanceof</span> <span class="n">RequestMappingHandlerAdapter</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">RequestMappingHandlerAdapter</span> <span class="n">adapter</span> <span class="o">=</span> <span class="o">(</span><span class="n">RequestMappingHandlerAdapter</span><span class="o">)</span> <span class="n">bean</span><span class="o">;</span>
            <span class="n">adapter</span><span class="o">.</span><span class="na">setSynchronizeOnSession</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span> <span class="c1">// (1)</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Requests within the same session are synchronized by specifying true in the argument of setSynchronizeOnSession method.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>“/session-tutorial-init-web/src/main/resources/META-INF/spring/spring-mvc.xml”</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Bean Processor --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;com.example.session.app.config.EnableSynchronizeOnSessionPostProcessor&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Set the timeout time in web.xml.
Set the default value as 30 minutes.</p>
<p>“/session-tutorial-init-web/src/main/webapp/WEB-INF/web.xml” (set by default)</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;session-config&gt;</span>
    <span class="c">&lt;!-- 30min --&gt;</span>
    <span class="nt">&lt;session-timeout&gt;</span>30<span class="nt">&lt;/session-timeout&gt;</span>
    <span class="nt">&lt;cookie-config&gt;</span>
        <span class="nt">&lt;http-only&gt;</span>true<span class="nt">&lt;/http-only&gt;</span>
        <span class="c">&lt;!-- &lt;secure&gt;true&lt;/secure&gt; --&gt;</span>
    <span class="nt">&lt;/cookie-config&gt;</span>
    <span class="nt">&lt;tracking-mode&gt;</span>COOKIE<span class="nt">&lt;/tracking-mode&gt;</span>
<span class="nt">&lt;/session-config&gt;</span>
</pre></div>
</div>
<p>Use the Spring Security function for request detection after timeout.</p>
<p>“/session-tutorial-init-web/src/main/resources/META-INF/spring/spring-security.xml”</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;sec:session-management</span> <span class="na">invalid-session-url=</span><span class="s">&quot;/loginForm&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Mention the destination for transition when request after the timeout is detected in invalid-session-url attribute of sec:session-management tag.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#id66">11.3.6. Conclusion</a><a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>We have learnt the following contents in this tutorial.</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>How to design the data for session management</dt>
<dd><ul class="first last">
<li>Selecting data stored in the session</li>
<li>Example of the flow to determine whether to use the session</li>
<li>Discarding data during the session</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Specific method of using session in this FW</dt>
<dd><ul class="first last">
<li>Method of using &#64;SessionAttributes</li>
<li>Method of using the Bean for session scope</li>
<li>How to refer the data in the session in each method of usage</li>
<li>How to discard session in each method of usage</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="TutorialSecurity.html" title="11.4. Spring Security Tutorial"
             >next</a> |</li>
        <li class="right" >
          <a href="TutorialREST.html" title="11.2. Tutorial (Todo Application REST)"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.4.1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >11. Tutorials</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
      © Copyright 2013-2018, NTT DATA Corporation. © Copyright 2013-2018, NTT Corporation.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.3.Theme is <a href="http://github.com/vimalkvn/solar-theme">Solar</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>