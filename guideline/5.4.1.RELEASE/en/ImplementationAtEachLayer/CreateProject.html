<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>3.5. Build development project &#8212; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.4.1.RELEASE documentation</title>
    <link rel="stylesheet" href="../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.4.1.RELEASE',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4. Web Application Development Features" href="../ArchitectureInDetail/WebApplicationDetail/index.html" />
    <link rel="prev" title="3.4. Implementation of Application Layer" href="ApplicationLayer.html" /><script src="../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../_static/solarized-dark.css" rel="stylesheet">
<link href="../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../ArchitectureInDetail/WebApplicationDetail/index.html" title="4. Web Application Development Features"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ApplicationLayer.html" title="3.4. Implementation of Application Layer"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.4.1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">3. Application Development</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3.5. Build development project</a><ul>
<li><a class="reference internal" href="#id1">3.5.1. Build development project</a><ul>
<li><a class="reference internal" href="#build-method-wherein-jar-file-of-env-module-is-not-included-in-war-file">3.5.1.1. Build method wherein jar file of env module is not included in war file</a><ul>
<li><a class="reference internal" href="#create-war-file">3.5.1.1.1. Create war file</a></li>
<li><a class="reference internal" href="#create-jar-file-of-env-module">3.5.1.1.2. Create jar file of env module</a></li>
</ul>
</li>
<li><a class="reference internal" href="#build-method-wherein-jar-file-of-env-module-is-included-in-war-file">3.5.1.2. Build method wherein jar file of env module is included in war file</a><ul>
<li><a class="reference internal" href="#createwebapplicationprojectbuildwarincludeenvjarwar">3.5.1.2.1. Create war file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#deploy">3.5.1.3. Deploy</a><ul>
<li><a class="reference internal" href="#deploy-on-tomcat">3.5.1.3.1. Deploy on Tomcat</a></li>
<li><a class="reference internal" href="#deployment-to-other-application-server">3.5.1.3.2. Deployment to other application server</a></li>
<li><a class="reference internal" href="#continuous-deployment">3.5.1.3.3. Continuous deployment</a><ul>
<li><a class="reference internal" href="#operations-of-snapshot-version">3.5.1.3.3.1. Operations of SNAPSHOT version</a></li>
<li><a class="reference internal" href="#operations-of-release-version">3.5.1.3.3.2. Operations of RELEASE version</a></li>
<li><a class="reference internal" href="#release-on-application-server">3.5.1.3.3.3. Release on Application Server</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="ApplicationLayer.html"
                        title="previous chapter">3.4. Implementation of Application Layer</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../ArchitectureInDetail/WebApplicationDetail/index.html"
                        title="next chapter">4. Web Application Development Features</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/ImplementationAtEachLayer/CreateProject.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="build-development-project">
<h1>3.5. Build development project<a class="headerlink" href="#build-development-project" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="index">
<p class="topic-title first">Index</p>
<ul class="simple">
<li><a class="reference internal" href="#id1" id="id4">Build development project</a><ul>
<li><a class="reference internal" href="#build-method-wherein-jar-file-of-env-module-is-not-included-in-war-file" id="id5">Build method wherein jar file of env module is not included in war file</a><ul>
<li><a class="reference internal" href="#create-war-file" id="id6">Create war file</a></li>
<li><a class="reference internal" href="#create-jar-file-of-env-module" id="id7">Create jar file of env module</a></li>
</ul>
</li>
<li><a class="reference internal" href="#build-method-wherein-jar-file-of-env-module-is-included-in-war-file" id="id8">Build method wherein jar file of env module is included in war file</a><ul>
<li><a class="reference internal" href="#createwebapplicationprojectbuildwarincludeenvjarwar" id="id9">Create war file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#deploy" id="id10">Deploy</a><ul>
<li><a class="reference internal" href="#deploy-on-tomcat" id="id11">Deploy on Tomcat</a></li>
<li><a class="reference internal" href="#deployment-to-other-application-server" id="id12">Deployment to other application server</a></li>
<li><a class="reference internal" href="#continuous-deployment" id="id13">Continuous deployment</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id4">3.5.1. Build development project</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>The method to create a war file to be deployed on application server and a jar file of env module (module to store the file environment dependent file) is described below.</p>
<p>In case of a project created using Maven Archetype, the following 2 methods are provided as methods to create a war file.</p>
<ul class="simple">
<li><a class="reference internal" href="#createwebapplicationprojectbuildwarexcludeenvjar"><span class="std std-ref">Build method wherein jar file of env module is not included in war file</span></a> (<strong>recommended</strong>)</li>
<li><a class="reference internal" href="#createwebapplicationprojectbuildwarincludeenvjar"><span class="std std-ref">Build method wherein jar file of env module is included in war file</span></a></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>About the recommended build method</strong></p>
<p>This guideline recommends <a class="reference internal" href="#createwebapplicationprojectbuildwarexcludeenvjar"><span class="std std-ref">Build method wherein jar file of env module is not included in war file</span></a>.
Other build method apart from those mentioned here can also be used.</p>
<p class="last">However, <strong>the war file and jar file to be released in test environment and production environment should not be created using the functionality provided by IDE such as Eclipse.</strong>
In some of the IDE functionalities like Eclipse, class files are created using an independent compiler which has been optimized for development,
hence there could be a risk of unexpected error during the application execution due to difference in the compiler.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Rule for the project structure</strong></p>
<p>Consider the following project structure.</p>
<p>1. Make sure to have a multi-project structure.
2.As far as possible, consolidate the configuration files (ex. logback.xml, jdbc.properties) having environment dependency in one project.  <strong>Hereafter, this project is expressed as *-env.</strong></p>
<blockquote>
<div><ul class="simple">
<li>ex. terasoluna-tourreservation-env</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="3">
<li>Projects other than *-env never have a setting for environment dependency.</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>However, it is allowed to store the environment dependency configuration files for test under src/test/resources.</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="4">
<li>Manage all software packaged binaries by storing them in package repository.</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>Deploy not only *.jar files but also *.war files as work products in package repository. Consequently, these jar/war files should not include environment dependencies.</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="5">
<li>Configure *-env project as follows:</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>Store the configuration values required for operations on the developer’s PC in the file under src/main/resources, as default values.</li>
<li>Store the configuration files that differ with each environment such as test server, production server, in the folder other than src/main/resources (ex. configs/test-server). Then, use “profile” function of Maven that automatically replaces the configuration values depending on environment in order to build *-env-x.y.z.jar file.</li>
</ul>
</div></blockquote>
<p>The above structure facilitates proper development in all the scenarios of software development lifecycle.</p>
<ol class="arabic simple">
<li>In local development environment, check out both main project and *-env project and include env project in build path of the main project so as to do coding and testing in the local development environment.</li>
<li>On CI server, execute the test and perform packaging using a build tool (Maven) and deploy the artifact in package repository whenever required.</li>
<li>Application can work on test server and production server by adding *-env project built as per the application release environment, to the main project which is stored in package repository.</li>
</ol>
<p class="last">For details, refer to <a class="reference external" href="https://github.com/terasolunaorg/terasoluna-tourreservation">Sample application</a>.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>About build environment</strong></p>
<p class="last">In the example below, Windows environment is used for the build. However, you can use your own environment for doing the build.
This guideline <strong>recommends that you should do the build using the same OS and JDK version as that of the application execution environment.</strong></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">When build is done using Maven, confirm whether home directory of JDK which is used during compilation in the environment variable JAVA_HOME, has been specified.</div>
<div class="line">If the environment variable is not set or the home directory of JDK having different version has been specified, an appropriate home directory should be specified in environment variable.</div>
</div>
<p><strong>[In case of Windows]</strong></p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">echo %JAVA_HOME%</span>
<span class="go">set JAVA_HOME={Please set home directory of JDK}</span>
</pre></div>
</div>
<p><strong>[In case of Linux]</strong></p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">echo $JAVA_HOME</span>
<span class="go">JAVA_HOME={Please set home directory of JDK}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is advisable to set the environment variable JAVA_HOME in the user environment variable of OS user wherein build is to be done.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="build-method-wherein-jar-file-of-env-module-is-not-included-in-war-file">
<span id="createwebapplicationprojectbuildwarexcludeenvjar"></span><h3><a class="toc-backref" href="#id5">3.5.1.1. Build method wherein jar file of env module is not included in war file</a><a class="headerlink" href="#build-method-wherein-jar-file-of-env-module-is-not-included-in-war-file" title="Permalink to this headline">¶</a></h3>
<div class="section" id="create-war-file">
<span id="createwebapplicationprojectbuildwarexcludeenvjarstepwar"></span><h4><a class="toc-backref" href="#id6">3.5.1.1.1. Create war file</a><a class="headerlink" href="#create-war-file" title="Permalink to this headline">¶</a></h4>
<p>Open the root directory of development project.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">cd C:\work\todo</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">Specify <code class="docutils literal"><span class="pre">warpack</span></code> in Maven profile (<code class="docutils literal"><span class="pre">-P</span></code> parameter) and run Maven install.</div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">mvn -P warpack clean install</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">If the Maven package is run successfully, a war file that does not include jar file of env module is created in the target directory of web module.</div>
<div class="line">(Example: <code class="docutils literal"><span class="pre">C:\work\todo\todo-web\target\todo-web.war</span></code>)</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>About the goal to be specified</strong></p>
<p>In the above example, <code class="docutils literal"><span class="pre">install</span></code> is specified in goal and war file is installed in local repository, however it is advisable to specify</p>
<blockquote class="last">
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">package</span></code> in goal when only creating a war file</li>
<li><code class="docutils literal"><span class="pre">deploy</span></code> in goal when deploying in remote repository like Nexus</li>
</ul>
</div></blockquote>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="create-jar-file-of-env-module">
<span id="createwebapplicationprojectbuildwarexcludeenvjarstepenvjar"></span><h4><a class="toc-backref" href="#id7">3.5.1.1.2. Create jar file of env module</a><a class="headerlink" href="#create-jar-file-of-env-module" title="Permalink to this headline">¶</a></h4>
<p>Open env module directory.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">cd C:\work\todo\todo-env</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Specify <strong>Profile ID to identify environment</strong> in Maven profile (<code class="docutils literal"><span class="pre">-P</span></code> parameter) and run Maven package.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">mvn -P test-server clean package</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">If Maven package is run successfully, jar file for the specified environment is created in target directory of env module.</div>
<div class="line">(Example: <code class="docutils literal"><span class="pre">C:\work\todo\todo-env\target\todo-env-1.0.0-SNAPSHOT-test-server.jar</span></code>)</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>About profile ID to identify environment</strong></p>
<p>In case of a project created using Maven Archetype, following profile IDs are defined by default.</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">local</span></code>: Profile for local environment of the developer (for IDE development environment) (default profile)</li>
<li><code class="docutils literal"><span class="pre">test-server</span></code>: Profile for test environment</li>
<li><code class="docutils literal"><span class="pre">production-server</span></code>: Profile for production environment</li>
</ul>
</div></blockquote>
<p class="last">The above 3 profiles are provided by default; however you can add or modify them as per the environment configuration of the system to be developed.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="build-method-wherein-jar-file-of-env-module-is-included-in-war-file">
<span id="createwebapplicationprojectbuildwarincludeenvjar"></span><h3><a class="toc-backref" href="#id8">3.5.1.2. Build method wherein jar file of env module is included in war file</a><a class="headerlink" href="#build-method-wherein-jar-file-of-env-module-is-included-in-war-file" title="Permalink to this headline">¶</a></h3>
<div class="section" id="createwebapplicationprojectbuildwarincludeenvjarwar">
<span id="id2"></span><h4><a class="toc-backref" href="#id9">3.5.1.2.1. Create war file</a><a class="headerlink" href="#createwebapplicationprojectbuildwarincludeenvjarwar" title="Permalink to this headline">¶</a></h4>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Points to be noted when including a jar file of env module in war file</strong></p>
<p>When jar file of env module is included in war file, the war file cannot be deployed in other environment;
hence war file should be managed so that it is not deployed to other environment (especially in production environment) by mistake.</p>
<p class="last">Moreover, when using a method in which war file is created for each environment and released in each environment,
it should be noted that war file released in production environment can never be the war file for which testing is complete.
This is for the re-compilation at the time of creating war file for the production environment.
When creating the war file and releasing the same for each environment, it is especially important to use the
VCS (Version Control System) functionality (Tag functionality etc.) like Git or Subversion and to establish a mechanism to create a war file
which is to be released in production environment and various test environments, through the use of tested source files.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Open the root directory of development project.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">cd C:\work\todo</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">In Maven profile (<code class="docutils literal"><span class="pre">-P</span></code> parameter), specify <strong>Profile ID to identify environment</strong>defined in env module and <code class="docutils literal"><span class="pre">warpack-with-env</span></code>, and then run the Maven package.</div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">mvn -P warpack-with-env,test-server clean package</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">If Maven package is run successfully, war file which includes jar file of env module is created in target directory of web module.</div>
<div class="line">(Example: <code class="docutils literal"><span class="pre">C:\work\todo\todo-web\target\todo-web.war</span></code>)</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="deploy">
<span id="createwebapplicationprojectbuilddeploy"></span><h3><a class="toc-backref" href="#id10">3.5.1.3. Deploy</a><a class="headerlink" href="#deploy" title="Permalink to this headline">¶</a></h3>
<div class="section" id="deploy-on-tomcat">
<span id="createwebapplicationprojectbuilddeploytotomcat"></span><h4><a class="toc-backref" href="#id11">3.5.1.3.1. Deploy on Tomcat</a><a class="headerlink" href="#deploy-on-tomcat" title="Permalink to this headline">¶</a></h4>
<p>Deployment method (procedure) when Tomcat is used as an application server is given below.</p>
<ol class="arabic simple">
<li>Specify the profile of Maven as per the AP server environment in which the application is to be released and build *-env project.</li>
<li>Place *-env-x.y.z.jar file built above in the folder of AP server decided in advance. ex. /etc/foo/bar/abcd-env-x.y.z.jar</li>
<li>Unjar the *.war file deployed in package repository under [CATALINA_HOME]/webapps.</li>
<li>If Tomcat 7 is used, add /etc/foo/bar/*.jar into class path using VirtualWebappLoader function of the Tomcat.</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>The following definition should be added in [CATALINA_HOME]/conf/[contextPath].xml file.</li>
<li>For details, refer to <a class="reference external" href="http://tomcat.apache.org/tomcat-7.0-doc/api/org/apache/catalina/loader/VirtualWebappLoader.html">http://tomcat.apache.org/tomcat-7.0-doc/api/org/apache/catalina/loader/VirtualWebappLoader.html</a> and <a class="reference external" href="https://github.com/terasolunaorg/terasoluna-tourreservation/tree/5.4.1.RELEASE/terasoluna-tourreservation-env/configs">configs folder of terasoluna-tourreservation-env</a>.</li>
<li>Example of VirtualWebappLoader function usages :</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;Loader</span> <span class="na">className=</span><span class="s">&quot;org.apache.catalina.loader.VirtualWebappLoader&quot;</span>
        <span class="na">virtualClasspath=</span><span class="s">&quot;/etc/foo/bar/*.jar&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>In addition, VirtualWebappLoader can also be used in the Tomcat 6.</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="5">
<li>If Tomcat 8.x is used, add /etc/foo/bar/*.jar into class path using Resource function of the Tomcat.</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>The following definition should be added in [CATALINA_HOME]/conf/[contextPath].xml file.</li>
<li>For details, refer to <a class="reference external" href="https://tomcat.apache.org/migration-8.html#Web_application_resources">https://tomcat.apache.org/migration-8.html#Web_application_resources</a> and <a class="reference external" href="https://github.com/terasolunaorg/terasoluna-tourreservation/tree/5.4.1.RELEASE/terasoluna-tourreservation-env/configs">configs folder of terasoluna-tourreservation-env</a>.</li>
<li>Example of Resource function usages :</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;Resources</span> <span class="na">className=</span><span class="s">&quot;org.apache.catalina.webresources.StandardRoot&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;PreResources</span> <span class="na">className=</span><span class="s">&quot;org.apache.catalina.webresources.DirResourceSet&quot;</span>
                <span class="na">base=</span><span class="s">&quot;/etc/foo/bar/&quot;</span>
                <span class="na">internalPath=</span><span class="s">&quot;/&quot;</span>
                <span class="na">webAppMount=</span><span class="s">&quot;/WEB-INF/lib&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/Resources&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>autoDeploy attribute of Host tag of [CATALINA_HOME]/conf/server.xml should be set to false. Otherwise [CATALINA_HOME]/conf/[contextPath].xml gets deleted each time web application is restarted.</li>
<li>When autoDeploy is disabled, Web application does not start by just placing the war file in [CATALINA_HOME]/webapps. war file should always be unjarred (unzipped).</li>
</ul>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="deployment-to-other-application-server">
<span id="createwebapplicationprojectbuilddeploytootherserver"></span><h4><a class="toc-backref" href="#id12">3.5.1.3.2. Deployment to other application server</a><a class="headerlink" href="#deployment-to-other-application-server" title="Permalink to this headline">¶</a></h4>
<p>Pprocedure to deployment on other (not tomcat) application server is explained.</p>
<p>When releasing the Web application on application servers (Example: WebSphere, WebLogic, JBoss) where a mechanism for
adding a class path for each web application (which is provided in VirtualWebappLoader of Tomcat) is not provided,
the method to release it after adding *-env-x.y.z.jar file under WEB-INF/lib of war file is the easiest.</p>
<ol class="arabic simple">
<li>Specify profile of Maven as per the AP server environment in which application is to be released and build *-env project.</li>
<li>Copy *.war file deployed in the package repository to the working directory.</li>
<li>Add it under WEB-INF/lib of war file using add option of jar command as follows.</li>
<li>Release foo-x.y.z.war on AP server.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For a method to deploy a war file on application server, refer to the manual of application server to be used.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Here, a method to embed the jar file of env module in war file using jar command is given.</p>
<div class="line-block">
<div class="line">Open the working directory.</div>
<div class="line">Here the in the example below, work is performed in env project.</div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">cd C:\work\todo\todo-env</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">Copy the created war file to the working directory.</div>
<div class="line">Here in the example below, war file is fetched from Maven repository. (war file is required to be <code class="docutils literal"><span class="pre">installed</span></code> or <code class="docutils literal"><span class="pre">deployed</span></code>.)</div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">mvn org.apache.maven.plugins:maven-dependency-plugin:2.5:get^</span>
<span class="go"> -DgroupId=com.example.todo^</span>
<span class="go"> -DartifactId=todo-web^</span>
<span class="go"> -Dversion=1.0.0-SNAPSHOT^</span>
<span class="go"> -Dpackaging=war^</span>
<span class="go"> -Ddest=target/todo-web.war</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">If the command is run successfully, the specified war file is copied to the target directory of env module.</div>
<div class="line">(Example: <code class="docutils literal"><span class="pre">C:\work\todo\todo-env\target\todo-web.war</span></code>)</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>An appropriate value should be specified in <code class="docutils literal"><span class="pre">-DgroupId</span></code>, <code class="docutils literal"><span class="pre">-DartifactId</span></code>, <code class="docutils literal"><span class="pre">-Dversion</span></code>, <code class="docutils literal"><span class="pre">-Ddest</span></code>.</li>
<li>When run on Linux, “<code class="docutils literal"><span class="pre">^</span></code>”  at the end of the line should be read as “<code class="docutils literal"><span class="pre">\</span></code>”  .</li>
</ul>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Copy the created jar file to working directory (<code class="docutils literal"><span class="pre">target\WEB-INF\lib</span></code>) once and add it to the war file.</p>
<p><strong>[In case of Windows]</strong></p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">mkdir target\WEB-INF\lib</span>
<span class="go">copy target\todo-env-1.0.0-SNAPSHOT-test-server.jar target\WEB-INF\lib\.</span>
<span class="go">cd target</span>
<span class="go">jar -uvf todo-web.war WEB-INF\lib</span>
</pre></div>
</div>
<p><strong>[In case of Linux]</strong></p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">mkdir -p target/WEB-INF/lib</span>
<span class="go">cp target/todo-env-1.0.0-SNAPSHOT-test-server.jar target/WEB-INF/lib/.</span>
<span class="go">cd target</span>
<span class="go">jar -uvf todo-web.war WEB-INF/lib</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Measures to be taken when jar command is not found</strong></p>
<p>The problem when jar command is not found can be resolved using either of the following measures.</p>
<ul class="last simple">
<li>Add <code class="docutils literal"><span class="pre">JAVA_HOME/bin</span></code> to environment variable “PATH”.</li>
<li>Specify the jar command with full path. In case of Windows, <code class="docutils literal"><span class="pre">%JAVA_HOME%\bin\jar</span></code> and in case of Linux, <code class="docutils literal"><span class="pre">${JAVA_HOME}/bin/jar</span></code> can be specified.</li>
</ul>
</div>
</div>
<div class="section" id="continuous-deployment">
<span id="createwebapplicationprojectbuilddeploycontinueddeployment"></span><h4><a class="toc-backref" href="#id13">3.5.1.3.3. Continuous deployment</a><a class="headerlink" href="#continuous-deployment" title="Permalink to this headline">¶</a></h4>
<p>Continuous deployment is constantly releasing the target software through continuous looping of project (source code tree) structure, version control, inspection, build operations and lifecycle management.</p>
<p>During development, release the software of SNAPSHOT version in the package repository and development AP server and execute the test.
To release the software officially, tagging to source code tree of VCS needs be performed after assigning a version number.
In this way, the flow of build and deployment slightly differs in the snapshot release and official release.</p>
<p>To deploy the application on AP server that provides Web service, irrespective of snapshot version or official release version, a group of
environment dependency configuration files and *.war file should be deployed in a set as per the target release AP server environment.</p>
<p>Separating the operation of registering libraries (jar, war) without environment dependency settings, in Maven repository and
the operation of actually deploying them on AP server facilitates deployment.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In Maven, it is automatically distinguished whether it is a SNAPSHOT version or RELEASE version according to the contents of &lt;version&gt; tag of pom.xml.</p>
<ul class="simple">
<li>It is considered as SNAPSHOT if it ends with -SNAPSHOT. Example: &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</li>
<li>It is considered as RELEASE if it does not end with -SNAPSHOT. Example: &lt;version&gt;1.0&lt;/version&gt;</li>
</ul>
<p>Please note that there are 2 types of repositories in Maven package repository i.e. snapshot repository and release repository with a few limitations.</p>
<ul class="last simple">
<li>Software of SNAPSHOT version cannot be registered in release repository. release repository also cannot be registered in snapshot repository.</li>
<li>In release repository, artifact having the same GAV information can be registered only once. (GAV=groupId, artifactId, version)</li>
<li>In snapshot repository, artifact having the same GAV information can be re-registered many times.</li>
</ul>
</div>
<div class="section" id="operations-of-snapshot-version">
<h5>3.5.1.3.3.1. Operations of SNAPSHOT version<a class="headerlink" href="#operations-of-snapshot-version" title="Permalink to this headline">¶</a></h5>
<p>A simple delivery flow of SNAPSHOT version software is as shown in the following figure.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/ContinuousDelivery-snapshot.png"><img alt="Continuous delivery for SNAPSHOT version." src="../_images/ContinuousDelivery-snapshot.png" style="width: 600px;" /></a>
</div>
<ol class="arabic simple">
<li>Check out the source code from development trunk.</li>
<li>Compile, measure the code metrics and execute test.</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>In case of compilation error, certain violations of code metrics or in case the test fails, the subsequent operations should be stopped.</li>
</ul>
</div></blockquote>
<p>3. Upload (mvn deploy) the artifact (jar, war file) on Maven package repository server.
|</p>
</div>
<div class="section" id="operations-of-release-version">
<h5>3.5.1.3.3.2. Operations of RELEASE version<a class="headerlink" href="#operations-of-release-version" title="Permalink to this headline">¶</a></h5>
<p>In case of official release, since it is necessary to assign the version number, the flow becomes slightly more complex than the SNAPSHOT release.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/ContinuousDelivery-release.png"><img alt="Continuous delivery for RELEASE version." src="../_images/ContinuousDelivery-release.png" style="width: 600px;" /></a>
</div>
<ol class="arabic simple">
<li>Decide the version number to be assigned for release. (Example: 1.0.1)</li>
<li>Check out the source code from development trunk (or release branch).</li>
<li>Change &lt;version&gt; tag of pom.xml. (Example:&lt;version&gt;1.0.1&lt;/version&gt;)</li>
<li>Assign tag to VCS. (Example:tags/1.0.1)</li>
<li>Compile, measure the code metrics and execute test.</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>In case of compilation error, certain violations of code metrics or in case the test fails, the subsequent operations should be stopped.</li>
<li>If the test fails, delete the tag of VCS.</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="6">
<li>Upload (mvn deploy) the artifact (jar, war file) on Maven package repository server.</li>
</ol>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Here, should the version tag of pom.xml of trunk source tree be written at the end till it is
replaced by the next SNAPSHOT version and committed?</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>&lt;version&gt; tag of pom.xml file can be changed in <a class="reference external" href="http://www.mojohaus.org/versions-maven-plugin/">versions-maven-plugin</a> .</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mvn versions:set -DnewVersion<span class="o">=</span><span class="m">1</span>.0.0
</pre></div>
</div>
<p class="last">Version tag in pom.xml can be edited as &lt;version&gt;1.0.0&lt;/version&gt; by the above commands.</p>
</div>
</div>
<div class="section" id="release-on-application-server">
<h5>3.5.1.3.3.3. Release on Application Server<a class="headerlink" href="#release-on-application-server" title="Permalink to this headline">¶</a></h5>
<p>To release the application on AP server that provides Web service,
release the *.war file registered in Maven package repository and the group of environment dependency
configuration files in a set according to the target release AP server environment.
This has same flow irrespective of snapshot release or official release.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/ContinuousDelivery-apserver.png"><img alt="Continuous delivery for webapp to application server." src="../_images/ContinuousDelivery-apserver.png" style="width: 600px;" /></a>
</div>
<ol class="arabic simple">
<li>Download war file of the version to be released from Maven package repository.</li>
<li>Check out *-resources project (that consolidates environment dependency configuration files) from VCS.</li>
<li>Using “profile” function of Maven, replace the contents with group of configuration files according to the target release environment, package the resources project and create *-resources-x.y.z.jar.</li>
<li>Add the created *-resources-x.y.z.jar file under WEB-INF/lib folder of war file.</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>In case of Tomcat, instead of adding *-resources-x.y.z.jar to war file, copy it to any path of Tomcat server and specify that path in the extended class path of VirtualWebappLoader.</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="5">
<li>Deploy the war file on application server.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>War file can be downloaded from Maven package repository with “get goal” of maven-dependency-plugin.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mvn org.apache.maven.plugins:maven-dependency-plugin:2.5:get^
 -DgroupId<span class="o">=</span>com.example^
 -DartifactId<span class="o">=</span>mywebapp^
 -Dversion<span class="o">=</span><span class="m">0</span>.0.1-SNAPSHOT^
 -Dpackaging<span class="o">=</span>war^
 -Ddest<span class="o">=</span><span class="si">${</span><span class="nv">WORKSPACE</span><span class="si">}</span>/target/mywebapp.war
</pre></div>
</div>
<p>With this, mywebapp.war file is downloaded under the target directory.</p>
<p>Package of environment dependency configuration files can be added to mywebapp.war file using the following commands.</p>
<div class="last highlight-bash"><div class="highlight"><pre><span></span>mkdir -p <span class="nv">$WORKSPACE</span>/target/WEB-INF/lib
<span class="nb">cd</span> <span class="nv">$WORKSPACE</span>/target
cp ./mywebapp-resources*.jar WEB-INF/lib
jar -ufv mywebapp.war WEB-INF/lib
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../ArchitectureInDetail/WebApplicationDetail/index.html" title="4. Web Application Development Features"
             >next</a> |</li>
        <li class="right" >
          <a href="ApplicationLayer.html" title="3.4. Implementation of Application Layer"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.4.1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >3. Application Development</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
      © Copyright 2013-2018, NTT DATA Corporation. © Copyright 2013-2018, NTT Corporation.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.3.Theme is <a href="http://github.com/vimalkvn/solar-theme">Solar</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>