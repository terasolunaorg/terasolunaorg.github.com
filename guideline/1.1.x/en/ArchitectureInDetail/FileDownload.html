<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>5.18. File Download &mdash; TERASOLUNA Global Framework Development Guideline 1.1.0-SNAPSHOT documentation</title>
    
    <link rel="stylesheet" href="../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.1.0-SNAPSHOT',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="TERASOLUNA Global Framework Development Guideline 1.1.0-SNAPSHOT documentation" href="../index.html" />
    <link rel="up" title="5. Architecture in Detail - TERASOLUNA Global Framework" href="index.html" />
    <link rel="next" title="5.19. [coming soon] Screen Layout using Tiles" href="TilesLayout.html" />
    <link rel="prev" title="5.17. [coming soon] File Upload" href="FileUpload.html" /><script src="../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../_static/solarized-dark.css" rel="stylesheet">
<link href="../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="TilesLayout.html" title="5.19. [coming soon] Screen Layout using Tiles"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="FileUpload.html" title="5.17. [coming soon] File Upload"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">TERASOLUNA Global Framework Development Guideline 1.1.0-SNAPSHOT documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">5. Architecture in Detail - TERASOLUNA Global Framework</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">5.18. File Download</a><ul>
<li><a class="reference internal" href="#overview">5.18.1. Overview</a></li>
<li><a class="reference internal" href="#how-to-use">5.18.2. How to use</a><ul>
<li><a class="reference internal" href="#downloading-pdf-files">5.18.2.1. Downloading PDF files</a><ul>
<li><a class="reference internal" href="#implementation-of-custom-view">5.18.2.1.1. Implementation of Custom View</a></li>
<li><a class="reference internal" href="#definition-of-viewresolver">5.18.2.1.2. Definition of ViewResolver</a></li>
<li><a class="reference internal" href="#specifying-view-in-controller">5.18.2.1.3. Specifying View in controller</a></li>
</ul>
</li>
<li><a class="reference internal" href="#downloading-excel-files">5.18.2.2. Downloading Excel files</a><ul>
<li><a class="reference internal" href="#id1">5.18.2.2.1. Implementation of Custom View</a></li>
<li><a class="reference internal" href="#id2">5.18.2.2.2. Definition of ViewResolver</a></li>
<li><a class="reference internal" href="#id3">5.18.2.2.3. Specifying View in controller</a></li>
</ul>
</li>
<li><a class="reference internal" href="#downloading-arbitrary-files">5.18.2.3. Downloading arbitrary files</a><ul>
<li><a class="reference internal" href="#id4">5.18.2.3.1. Implementation of Custom View</a></li>
<li><a class="reference internal" href="#id5">5.18.2.3.2. Definition of ViewResolver</a></li>
<li><a class="reference internal" href="#id6">5.18.2.3.3. Specifying View in controller</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="FileUpload.html"
                        title="previous chapter">5.17. [coming soon] File Upload</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="TilesLayout.html"
                        title="next chapter">5.19. [coming soon] Screen Layout using Tiles</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/ArchitectureInDetail/FileDownload.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="file-download">
<h1>5.18. File Download<a class="headerlink" href="#file-download" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id7">Overview</a></li>
<li><a class="reference internal" href="#how-to-use" id="id8">How to use</a><ul>
<li><a class="reference internal" href="#downloading-pdf-files" id="id9">Downloading PDF files</a><ul>
<li><a class="reference internal" href="#implementation-of-custom-view" id="id10">Implementation of Custom View</a></li>
<li><a class="reference internal" href="#definition-of-viewresolver" id="id11">Definition of ViewResolver</a></li>
<li><a class="reference internal" href="#specifying-view-in-controller" id="id12">Specifying View in controller</a></li>
</ul>
</li>
<li><a class="reference internal" href="#downloading-excel-files" id="id13">Downloading Excel files</a><ul>
<li><a class="reference internal" href="#id1" id="id14">Implementation of Custom View</a></li>
<li><a class="reference internal" href="#id2" id="id15">Definition of ViewResolver</a></li>
<li><a class="reference internal" href="#id3" id="id16">Specifying View in controller</a></li>
</ul>
</li>
<li><a class="reference internal" href="#downloading-arbitrary-files" id="id17">Downloading arbitrary files</a><ul>
<li><a class="reference internal" href="#id4" id="id18">Implementation of Custom View</a></li>
<li><a class="reference internal" href="#id5" id="id19">Definition of ViewResolver</a></li>
<li><a class="reference internal" href="#id6" id="id20">Specifying View in controller</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id7">5.18.1. Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">This chapter explains the functionality to download a file from server to client, using Spring.</div>
<div class="line">It is recommended to use Spring MVC View for rendering the files.</div>
</div>
<dl class="docutils">
<dt></dt>
<dd><div class="first last admonition note">
<p class="first admonition-title">Note</p>
<p>It is not recommended to include file rendering logic in controller class.</p>
<p class="last">This is because, it deviates from the role of a controller.
Moreover, a View can be easily changed when it is isolated from the controller.</p>
</div>
</dd>
</dl>
<p>Overview of File Download process is given below.</p>
<ol class="arabic simple">
<li>DispatchServlet sends file download request to the controller.</li>
<li>Controller fetches file display information.</li>
<li>Controller selects View.</li>
<li>File rendering is performed in View.</li>
</ol>
<div class="line-block">
<div class="line">In order to perform file rendering in a Spring based Web application;</div>
<div class="line">this guideline recommends implementation of custom view.</div>
<div class="line">To implement custom view, <tt class="docutils literal"><span class="pre">org.springframework.web.servlet.View</span></tt> interface</div>
<div class="line">is provided in Spring framework.</div>
<div class="line"><br /></div>
<div class="line"><strong>For PDF files</strong></div>
<div class="line"><tt class="docutils literal"><span class="pre">org.springframework.web.servlet.view.document.AbstractPdfView</span></tt> class of Spring is used as a subclass</div>
<div class="line">when rendering PDF files using model information.</div>
<div class="line"><br /></div>
<div class="line"><strong>For Excel files</strong></div>
<div class="line"><tt class="docutils literal"><span class="pre">org.springframework.web.servlet.view.document.AbstractExcelView</span></tt> class of Spring is used as a subclass</div>
<div class="line">when rendering Excel files using model information.</div>
<div class="line"><br /></div>
<div class="line">For file formats other than those specified above, various types of View implementations are provided in Spring.</div>
<div class="line">For technical details on View, refer to <a class="reference external" href="http://static.springsource.org/spring/docs/3.2.x/spring-framework-reference/html/view.html">Spring Reference View technologies</a>.</div>
</div>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">org.terasoluna.gfw.web.download.AbstractFileDownloadView</span></tt> provided by common library is the</div>
<div class="line">abstract class to download arbitrary files.</div>
<div class="line">Define this class as a subclass to render files in formats other than PDF or Excel.</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="how-to-use">
<h2><a class="toc-backref" href="#id8">5.18.2. How to use</a><a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h2>
<div class="section" id="downloading-pdf-files">
<h3><a class="toc-backref" href="#id9">5.18.2.1. Downloading PDF files</a><a class="headerlink" href="#downloading-pdf-files" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">For rendering PDF files, it is necessary to create a class that</div>
<div class="line">inherits <tt class="docutils literal"><span class="pre">org.springframework.web.servlet.view.document.AbstractPdfView</span></tt> provided by Spring.</div>
<div class="line">The procedure to download a PDF file using controller is explained below.</div>
</div>
<div class="section" id="implementation-of-custom-view">
<h4><a class="toc-backref" href="#id10">5.18.2.1.1. Implementation of Custom View</a><a class="headerlink" href="#implementation-of-custom-view" title="Permalink to this headline">¶</a></h4>
<p><strong>Implementation of class that inherits AbstractPdfView</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span class="nd">@Component</span>  <span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SamplePdfView</span> <span class="kd">extends</span> <span class="n">AbstractPdfView</span> <span class="o">{</span>  <span class="c1">// (2)</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">buildPdfDocument</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">model</span><span class="o">,</span>
          <span class="n">Document</span> <span class="n">document</span><span class="o">,</span> <span class="n">PdfWriter</span> <span class="n">writer</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
          <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>  <span class="c1">// (3)</span>

      <span class="n">document</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Paragraph</span><span class="o">((</span><span class="n">Date</span><span class="o">)</span> <span class="n">model</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;serverTime&quot;</span><span class="o">)).</span><span class="na">toString</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In this example, this class comes under the scope of component scanning by using <tt class="docutils literal"><span class="pre">&#64;Component</span></tt> annotation.</div>
<div class="line">It will also come under the scope of <tt class="docutils literal"><span class="pre">org.springframework.web.servlet.view.BeanNameViewResolver</span></tt> which is described later.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Inherit AbstractPdfView.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Execute buildPdfDocument method.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">AbstractPdfView uses <a class="reference external" href="http://itextpdf.com/">iText</a> for PDF rendering.</div>
<div class="line">Therefore, it is necessary to add itext definition to pom.xml of Maven.</div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;dependencies&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.lowagie<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>itext<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${com.lowagie.itext.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;exclusions&gt;</span>
            <span class="nt">&lt;exclusion&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>xml-apis<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>xml-apis<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;/exclusion&gt;</span>
            <span class="nt">&lt;exclusion&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>bctsp-jdk14<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.bouncycastle<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;/exclusion&gt;</span>
            <span class="nt">&lt;exclusion&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>jfreechart<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>jfree<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;/exclusion&gt;</span>
            <span class="nt">&lt;exclusion&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>dom4j<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>dom4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;/exclusion&gt;</span>
            <span class="nt">&lt;exclusion&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.swinglabs<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>pdf-renderer<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;/exclusion&gt;</span>
        <span class="nt">&lt;/exclusions&gt;</span>
   <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>

<span class="nt">&lt;properties&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
    <span class="nt">&lt;com.lowagie.itext.version&gt;</span>4.2.1<span class="nt">&lt;/com.lowagie.itext.version&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
</pre></div>
</div>
<dl class="docutils">
<dt></dt>
<dd><div class="first last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Spring 3.2 does not support itext version 5.</p>
</div>
</dd>
</dl>
</div>
<div class="section" id="definition-of-viewresolver">
<span id="viewresolver-label"></span><h4><a class="toc-backref" href="#id11">5.18.2.1.2. Definition of ViewResolver</a><a class="headerlink" href="#definition-of-viewresolver" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">org.springframework.web.servlet.view.BeanNameViewResolver</span></tt> is the class stored in Spring context. It selects the View to be executed on the basis of bean name.</div>
<div class="line">Normally <tt class="docutils literal"><span class="pre">InternalResourceViewResolver</span></tt> is used; however while using BeanNameViewResolver, it should be called before <tt class="docutils literal"><span class="pre">InternalResourceViewResolver</span></tt> by setting <tt class="docutils literal"><span class="pre">order</span></tt> property.</div>
</div>
<dl class="docutils">
<dt></dt>
<dd><div class="first last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Spring provides various types of View Resolvers and it allows chaining of multiple Resolvers; hence some unintended View may get selected under certain conditions.
To avoid such a situation, priority can be set by specifying order property.
Lower the specified value of order property, earlier it is executed.</p>
</div>
</dd>
</dl>
<p><strong>bean definition file</strong></p>
<div class="highlight-xml"><div class="highlight"><pre> <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;prefix&quot;</span> <span class="na">value=</span><span class="s">&quot;/WEB-INF/views/&quot;</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;suffix&quot;</span> <span class="na">value=</span><span class="s">&quot;.jsp&quot;</span> <span class="nt">/&gt;</span>
 <span class="nt">&lt;/bean&gt;</span>

<span class="hll"> <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.web.servlet.view.BeanNameViewResolver&quot;</span><span class="nt">&gt;</span>  <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">     <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;order&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>  <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll"> <span class="nt">&lt;/bean&gt;</span>
</span></pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define BeanNameViewResolver.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set 0 in order property. Priority should be higher than that of InternalResourceViewResolver.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="specifying-view-in-controller">
<h4><a class="toc-backref" href="#id12">5.18.2.1.3. Specifying View in controller</a><a class="headerlink" href="#specifying-view-in-controller" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">With the help of BeanNameViewResolver, by returning &#8220;samplePDFView&#8221; in Controller,</div>
<div class="line">a view named &#8220;samplePDFView&#8221; gets used from the BeanIDs stored in Spring Context.</div>
</div>
<p><strong>Java source code</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;home&quot;</span><span class="o">,</span> <span class="n">params</span><span class="o">=</span> <span class="s">&quot;pdf&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">homePdf</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;serverTime&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="k">return</span> <span class="s">&quot;samplePdfView&quot;</span><span class="o">;</span>   <span class="c1">// (1)</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">With &#8220;samplePdfView&#8221; as the return value of method,</div>
<div class="line">SamplePdfView class stored in Spring context is executed.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">Following PDF file can be opened after executing the above procedure.</div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/file-download-pdf.png"><img alt="FILEDOWNLOAD PDF" src="../_images/file-download-pdf.png" style="width: 60%;" /></a>
<p class="caption"><strong>Picture - FileDownload PDF</strong></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="downloading-excel-files">
<h3><a class="toc-backref" href="#id13">5.18.2.2. Downloading Excel files</a><a class="headerlink" href="#downloading-excel-files" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">For rendering EXCEL files, it is necessary to create a class that</div>
<div class="line">inherits <tt class="docutils literal"><span class="pre">org.springframework.web.servlet.view.document.AbstractExcelView</span></tt> provided by Spring.</div>
<div class="line">The procedure to download an EXCEL file using controller is explained below.</div>
</div>
<div class="section" id="id1">
<h4><a class="toc-backref" href="#id14">5.18.2.2.1. Implementation of Custom View</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p><strong>Implementation of class that inherits AbstractExcelView</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span class="nd">@Component</span>  <span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleExcelView</span> <span class="kd">extends</span> <span class="n">AbstractExcelView</span> <span class="o">{</span>  <span class="c1">// (2)</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">buildExcelDocument</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">model</span><span class="o">,</span>
            <span class="n">HSSFWorkbook</span> <span class="n">workbook</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
            <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>  <span class="c1">// (3)</span>
        <span class="n">HSSFSheet</span> <span class="n">sheet</span><span class="o">;</span>
        <span class="n">HSSFCell</span> <span class="n">cell</span><span class="o">;</span>

        <span class="n">sheet</span> <span class="o">=</span> <span class="n">workbook</span><span class="o">.</span><span class="na">createSheet</span><span class="o">(</span><span class="s">&quot;Spring&quot;</span><span class="o">);</span>
        <span class="n">sheet</span><span class="o">.</span><span class="na">setDefaultColumnWidth</span><span class="o">(</span><span class="mi">12</span><span class="o">);</span>

        <span class="c1">// write a text at A1</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">getCell</span><span class="o">(</span><span class="n">sheet</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
        <span class="n">setText</span><span class="o">(</span><span class="n">cell</span><span class="o">,</span> <span class="s">&quot;Spring-Excel test&quot;</span><span class="o">);</span>

        <span class="n">cell</span> <span class="o">=</span> <span class="n">getCell</span><span class="o">(</span><span class="n">sheet</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
        <span class="n">setText</span><span class="o">(</span><span class="n">cell</span><span class="o">,</span> <span class="o">(</span><span class="n">Date</span><span class="o">)</span> <span class="n">model</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;serverTime&quot;</span><span class="o">)).</span><span class="na">toString</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In this example, this class comes under the scope of component scanning by using <tt class="docutils literal"><span class="pre">&#64;Component</span></tt> annotation.</div>
<div class="line">It will also come under the scope of <tt class="docutils literal"><span class="pre">org.springframework.web.servlet.view.BeanNameViewResolver</span></tt> which is described earlier.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Inherit AbstractExcelView.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Execute buildExcelDocument method.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">AbstractExcelView uses <a class="reference external" href="http://poi.apache.org/">Apache POI</a> to render EXCEL file.</div>
<div class="line">Therefore, it is necessary to add POI definition to the pom.xml file of Maven.</div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;dependencies&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apache.poi<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>poi<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${org.apache.poi.poi.version}<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>

<span class="nt">&lt;properties&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
    <span class="nt">&lt;org.apache.poi.poi.version&gt;</span>3.9<span class="nt">&lt;/org.apache.poi.poi.version&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h4><a class="toc-backref" href="#id15">5.18.2.2.2. Definition of ViewResolver</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>Settings are same as that for PDF file rendering. For details, refer to <a class="reference internal" href="#viewresolver-label"><em>Definition of ViewResolver</em></a>.</p>
</div>
<div class="section" id="id3">
<h4><a class="toc-backref" href="#id16">5.18.2.2.3. Specifying View in controller</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">With the help of BeanNameViewResolver, by returning &#8220;sampleExcelView&#8221; in Controller,</div>
<div class="line">a view named &#8220;sampleExcelView&#8221; gets used from the BeanIDs stored in Spring Context.</div>
</div>
<p><strong>Java source</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;home&quot;</span><span class="o">,</span> <span class="n">params</span><span class="o">=</span> <span class="s">&quot;excel&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">homeExcel</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;serverTime&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="k">return</span> <span class="s">&quot;sampleExcelView&quot;</span><span class="o">;</span>  <span class="c1">// (1)</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">With &#8220;sampleExcelView&#8221;as the return value of method,</div>
<div class="line">SampleExcelView class stored in Spring context is executed.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">EXCEL file can be opened as shown below after executing the above procedures.</div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/file-download-excel.png"><img alt="FILEDOWNLOAD EXCEL" src="../_images/file-download-excel.png" style="width: 60%;" /></a>
<p class="caption"><strong>Picture - FileDownload EXCEL</strong></p>
</div>
</div>
</div>
<div class="section" id="downloading-arbitrary-files">
<h3><a class="toc-backref" href="#id17">5.18.2.3. Downloading arbitrary files</a><a class="headerlink" href="#downloading-arbitrary-files" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">To download files in formats other than PDF or EXCEL,</div>
<div class="line">class that inherits <tt class="docutils literal"><span class="pre">org.terasoluna.gfw.web.download.AbstractFileDownloadView</span></tt> provided by common library can be implemented.</div>
<div class="line">Following steps should be implemented in AbstractFileDownloadView to render files in other format.</div>
</div>
<ol class="arabic simple">
<li>Fetch InputStream in order to write to the response body.</li>
<li>Set information in HTTP header.</li>
</ol>
<div class="line-block">
<div class="line">How to implement file download using controller is explained below.</div>
</div>
<div class="section" id="id4">
<h4><a class="toc-backref" href="#id18">5.18.2.3.1. Implementation of Custom View</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">The example of text file download is given below.</div>
</div>
<p><strong>Implementation of class that inherits AbstractFileDownloadView</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span class="nd">@Component</span>  <span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TextFileDownloadView</span> <span class="kd">extends</span> <span class="n">AbstractFileDownloadView</span> <span class="o">{</span>  <span class="c1">// (2)</span>

   <span class="nd">@Override</span>
   <span class="kd">protected</span> <span class="n">InputStream</span> <span class="nf">getInputStream</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">model</span><span class="o">,</span>
           <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>  <span class="c1">// (3)</span>
       <span class="n">Resource</span> <span class="n">resource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathResource</span><span class="o">(</span><span class="s">&quot;abc.txt&quot;</span><span class="o">);</span>
       <span class="k">return</span> <span class="n">resource</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">addResponseHeader</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">model</span><span class="o">,</span>
           <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>  <span class="c1">// (4)</span>
       <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">&quot;Content-Disposition&quot;</span><span class="o">,</span>
               <span class="s">&quot;attachment; filename=abc.txt&quot;</span><span class="o">);</span>
       <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">&quot;text/plain&quot;</span><span class="o">);</span>

   <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In this example, this class comes under the scope of component scanning by using <tt class="docutils literal"><span class="pre">&#64;Component</span></tt> annotation.</div>
<div class="line">It will also come under the scope of <tt class="docutils literal"><span class="pre">org.springframework.web.servlet.view.BeanNameViewResolver</span></tt> which is described earlier.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Inherit AbstractFileDownloadView.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Execute getInputStream method.</div>
<div class="line">InputStream to be downloaded should be returned.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Execute addResponseHeader method.</div>
<div class="line">Set Content-Disposition or ContentType as per the file to be downloaded.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id5">
<h4><a class="toc-backref" href="#id19">5.18.2.3.2. Definition of ViewResolver</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>Setting is same as that of PDF file rendering. For details, refer to <a class="reference internal" href="#viewresolver-label"><em>Definition of ViewResolver</em></a>.</p>
</div>
<div class="section" id="id6">
<h4><a class="toc-backref" href="#id20">5.18.2.3.3. Specifying View in controller</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">With the help of BeanNameViewResolver, by returning &#8220;textFileDownloadView&#8221; in Controller,</div>
<div class="line">a view named &#8220;textFileDownloadView&#8221; gets used from the BeanIDs stored in Spring Context.</div>
</div>
<p><strong>Java source</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;download&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">download</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;textFileDownloadView&quot;</span><span class="o">;</span> <span class="c1">// (1)</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">With &#8220;textFileDownloadView&#8221;as the return value of method,</div>
<div class="line">TextFileDownloadView class stored in Spring context is executed.</div>
</div>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt></dt>
<dd><div class="first last admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">As described above, Model information can be rendered in various types of Views using Spring.
Spring supports rendering engine such as Jasper Reports and returns various types of views.
For details, refer to the official Spring website  <a class="reference external" href="http://static.springsource.org/spring/docs/3.2.x/spring-framework-reference/html/view.html#view-jasper-reports">Spring reference</a>.</p>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="TilesLayout.html" title="5.19. [coming soon] Screen Layout using Tiles"
             >next</a> |</li>
        <li class="right" >
          <a href="FileUpload.html" title="5.17. [coming soon] File Upload"
             >previous</a> |</li>
        <li><a href="../index.html">TERASOLUNA Global Framework Development Guideline 1.1.0-SNAPSHOT documentation</a> &raquo;</li>
          <li><a href="index.html" >5. Architecture in Detail - TERASOLUNA Global Framework</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013-2014, NTT DATA.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.Theme by <a href="http://github.com/vkvn">vkvn</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>