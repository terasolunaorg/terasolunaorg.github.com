<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>10.1. Tutorial (Todo Application) &#8212; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.2.0.RELEASE documentation</title>
    <link rel="stylesheet" href="../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.2.0.RELEASE',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="10.2. Tutorial (Todo Application REST)" href="TutorialREST.html" />
    <link rel="prev" title="10. Tutorials" href="index.html" /><script async src="https://www.googletagmanager.com/gtag/js?id=G-847V2Q99G8"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date()); gtag('config', 'G-847V2Q99G8');
</script>
<script src="../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../_static/solarized-dark.css" rel="stylesheet">
<link href="../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="TutorialREST.html" title="10.2. Tutorial (Todo Application REST)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="10. Tutorials"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.2.0.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">10. Tutorials</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">10.1. Tutorial (Todo Application)</a><ul>
<li><a class="reference internal" href="#introduction">10.1.1. Introduction</a><ul>
<li><a class="reference internal" href="#points-to-study-in-this-tutorial">10.1.1.1. Points to study in this tutorial</a></li>
<li><a class="reference internal" href="#target-readers">10.1.1.2. Target readers</a></li>
<li><a class="reference internal" href="#verification-environment">10.1.1.3. Verification environment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#description-of-application-to-be-created">10.1.2. Description of application to be created</a><ul>
<li><a class="reference internal" href="#overview-of-the-application">10.1.2.1. Overview of the application</a></li>
<li><a class="reference internal" href="#business-requirements-of-application">10.1.2.2. Business requirements of application</a></li>
<li><a class="reference internal" href="#screen-transition-of-application">10.1.2.3. Screen transition of application</a><ul>
<li><a class="reference internal" href="#show-all-todo">10.1.2.3.1. Show all TODO</a></li>
<li><a class="reference internal" href="#create-todo">10.1.2.3.2. Create TODO</a></li>
<li><a class="reference internal" href="#finish-todo">10.1.2.3.3. Finish TODO</a></li>
<li><a class="reference internal" href="#delete-todo">10.1.2.3.4. Delete TODO</a></li>
</ul>
</li>
<li><a class="reference internal" href="#error-message-list">10.1.2.4. Error message list</a></li>
</ul>
</li>
<li><a class="reference internal" href="#environment-creation">10.1.3. Environment creation</a><ul>
<li><a class="reference internal" href="#project-creation">10.1.3.1. Project creation</a><ul>
<li><a class="reference internal" href="#creating-o-r-mapper-independent-blank-project">10.1.3.1.1. Creating O/R Mapper independent blank project</a></li>
<li><a class="reference internal" href="#creating-blank-project-for-mybatis3">10.1.3.1.2. Creating blank project for MyBatis3</a></li>
<li><a class="reference internal" href="#creating-blank-project-for-jpa">10.1.3.1.3. Creating blank project for JPA</a></li>
</ul>
</li>
<li><a class="reference internal" href="#project-import">10.1.3.2. Project import</a></li>
<li><a class="reference internal" href="#project-configuration">10.1.3.3. Project configuration</a></li>
<li><a class="reference internal" href="#confirmation-of-configuration-file">10.1.3.4. Confirmation of configuration file</a></li>
<li><a class="reference internal" href="#operation-verification-of-the-project">10.1.3.5. Operation verification of the project</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creation-of-todo-application">10.1.4. Creation of Todo application</a><ul>
<li><a class="reference internal" href="#creation-of-domain-layer">10.1.4.1. Creation of Domain layer</a><ul>
<li><a class="reference internal" href="#creation-of-domain-object">10.1.4.1.1. Creation of Domain Object</a></li>
<li><a class="reference internal" href="#repository-creation">10.1.4.1.2. Repository creation</a></li>
<li><a class="reference internal" href="#creation-of-repositoryimpl-infrastructure-layer">10.1.4.1.3. Creation of RepositoryImpl (Infrastructure layer)</a></li>
<li><a class="reference internal" href="#service-creation">10.1.4.1.4. Service creation</a></li>
<li><a class="reference internal" href="#creation-of-junit-for-service">10.1.4.1.5. Creation of JUnit for Service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creation-of-application-layer">10.1.4.2. Creation of application layer</a><ul>
<li><a class="reference internal" href="#creation-of-controller">10.1.4.2.1. Creation of Controller</a></li>
<li><a class="reference internal" href="#show-all-todo-implementation">10.1.4.2.2. Show all TODO implementation</a><ul>
<li><a class="reference internal" href="#form-creation">10.1.4.2.2.1. Form creation</a></li>
<li><a class="reference internal" href="#implementation-of-controller">10.1.4.2.2.2. Implementation of Controller</a></li>
<li><a class="reference internal" href="#jsp-creation">10.1.4.2.2.3. JSP creation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id1">10.1.4.2.3. Create TODO</a><ul>
<li><a class="reference internal" href="#modifications-in-controller">10.1.4.2.3.1. Modifications in Controller</a></li>
<li><a class="reference internal" href="#modifications-in-form">10.1.4.2.3.2. Modifications in Form</a></li>
<li><a class="reference internal" href="#modifications-in-jsp">10.1.4.2.3.3. Modifications in JSP</a></li>
<li><a class="reference internal" href="#customize-message-display">10.1.4.2.3.4. Customize message display</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id2">10.1.4.2.4. Finish TODO</a><ul>
<li><a class="reference internal" href="#id3">10.1.4.2.4.1. Modifications in Form</a></li>
<li><a class="reference internal" href="#id4">10.1.4.2.4.2. Modifications in Controller</a></li>
<li><a class="reference internal" href="#id5">10.1.4.2.4.3. Modifications in JSP</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id6">10.1.4.2.5. Delete TODO</a><ul>
<li><a class="reference internal" href="#modification-in-form">10.1.4.2.5.1. Modification in Form</a></li>
<li><a class="reference internal" href="#id7">10.1.4.2.5.2. Modifications in Controller</a></li>
<li><a class="reference internal" href="#id8">10.1.4.2.5.3. Modifications in JSP</a></li>
</ul>
</li>
<li><a class="reference internal" href="#use-of-css-file">10.1.4.2.6. Use of CSS file</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#creating-infrastructure-layer-with-a-database-access">10.1.5. Creating infrastructure layer with a Database access</a><ul>
<li><a class="reference internal" href="#creating-a-blank-project-dependent-on-o-r-mapper">10.1.5.1. Creating a blank project dependent on O/R Mapper</a></li>
<li><a class="reference internal" href="#database-set-up">10.1.5.2. Database set-up</a><ul>
<li><a class="reference internal" href="#modification-in-todo-infra-properties">10.1.5.2.1. Modification in todo-infra.properties</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-infrastructure-layer-with-mybatis3">10.1.5.3. Creating infrastructure layer with MyBatis3</a><ul>
<li><a class="reference internal" href="#create-todorepository">10.1.5.3.1. Create TodoRepository</a></li>
<li><a class="reference internal" href="#create-todorepositoryimpl">10.1.5.3.2. Create TodoRepositoryImpl</a></li>
<li><a class="reference internal" href="#create-mapper-file">10.1.5.3.3. Create Mapper file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-infrastructure-layer-with-spring-data-jpa">10.1.5.4. Creating infrastructure layer with Spring Data JPA</a><ul>
<li><a class="reference internal" href="#modification-in-entity">10.1.5.4.1. Modification in Entity</a></li>
<li><a class="reference internal" href="#creat-todorepository">10.1.5.4.2. Creat TodoRepository</a></li>
<li><a class="reference internal" href="#id9">10.1.5.4.3. Create TodoRepositoryImpl</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#in-the-end">10.1.6. In the end…</a></li>
<li><a class="reference internal" href="#appendix">10.1.7. Appendix</a><ul>
<li><a class="reference internal" href="#description-of-the-configuration-file">10.1.7.1. Description of the configuration file</a><ul>
<li><a class="reference internal" href="#web-xml">10.1.7.1.1. web.xml</a></li>
<li><a class="reference internal" href="#common-jsp">10.1.7.1.2. Common JSP</a></li>
<li><a class="reference internal" href="#bean-definition-file">10.1.7.1.3. Bean definition file</a><ul>
<li><a class="reference internal" href="#applicationcontext-xml">10.1.7.1.3.1. applicationContext.xml</a></li>
<li><a class="reference internal" href="#todo-domain-xml">10.1.7.1.3.2. todo-domain.xml</a></li>
<li><a class="reference internal" href="#todo-infra-xml">10.1.7.1.3.3. todo-infra.xml</a><ul>
<li><a class="reference internal" href="#todo-infra-xml-if-creating-blank-project-that-does-not-dependent-on-the-o-r-mapper">10.1.7.1.3.3.1. todo-infra.xml if creating blank project that does not dependent on the O/R Mapper</a></li>
<li><a class="reference internal" href="#todo-infra-xml-of-blank-project-created-for-mybatis3">10.1.7.1.3.3.2. todo-infra.xml of blank project created for MyBatis3</a></li>
<li><a class="reference internal" href="#todo-infra-xml-of-blank-project-created-for-jpa">10.1.7.1.3.3.3. todo-infra.xml of blank project created for JPA</a></li>
</ul>
</li>
<li><a class="reference internal" href="#todo-infra-properties">10.1.7.1.3.4. todo-infra.properties</a></li>
<li><a class="reference internal" href="#todo-env-xml">10.1.7.1.3.5. todo-env.xml</a></li>
<li><a class="reference internal" href="#spring-mvc-xml">10.1.7.1.3.6. spring-mvc.xml</a></li>
<li><a class="reference internal" href="#spring-security-xml">10.1.7.1.3.7. spring-security.xml</a></li>
</ul>
</li>
<li><a class="reference internal" href="#logback-xml">10.1.7.1.4. logback.xml</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">10. Tutorials</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="TutorialREST.html"
                        title="next chapter">10.2. Tutorial (Todo Application REST)</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/Tutorial/TutorialTodo.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tutorial-todo-application">
<h1>10.1. Tutorial (Todo Application)<a class="headerlink" href="#tutorial-todo-application" title="Permalink to this headline">¶</a></h1>
<div class="admonition caution">
  <p class="first admonition-title">Caution</p>
  <p><strong>This version is already obsolete</strong>. Please check <a href="http://terasolunaorg.github.io/guideline/">the latest guideline</a>.</p>
</div>
<div class="contents local topic" id="index">
<p class="topic-title">Index</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id10">Introduction</a><ul>
<li><a class="reference internal" href="#points-to-study-in-this-tutorial" id="id11">Points to study in this tutorial</a></li>
<li><a class="reference internal" href="#target-readers" id="id12">Target readers</a></li>
<li><a class="reference internal" href="#verification-environment" id="id13">Verification environment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#description-of-application-to-be-created" id="id14">Description of application to be created</a><ul>
<li><a class="reference internal" href="#overview-of-the-application" id="id15">Overview of the application</a></li>
<li><a class="reference internal" href="#business-requirements-of-application" id="id16">Business requirements of application</a></li>
<li><a class="reference internal" href="#screen-transition-of-application" id="id17">Screen transition of application</a><ul>
<li><a class="reference internal" href="#show-all-todo" id="id18">Show all TODO</a></li>
<li><a class="reference internal" href="#create-todo" id="id19">Create TODO</a></li>
<li><a class="reference internal" href="#finish-todo" id="id20">Finish TODO</a></li>
<li><a class="reference internal" href="#delete-todo" id="id21">Delete TODO</a></li>
</ul>
</li>
<li><a class="reference internal" href="#error-message-list" id="id22">Error message list</a></li>
</ul>
</li>
<li><a class="reference internal" href="#environment-creation" id="id23">Environment creation</a><ul>
<li><a class="reference internal" href="#project-creation" id="id24">Project creation</a><ul>
<li><a class="reference internal" href="#creating-o-r-mapper-independent-blank-project" id="id25">Creating O/R Mapper independent blank project</a></li>
<li><a class="reference internal" href="#creating-blank-project-for-mybatis3" id="id26">Creating blank project for MyBatis3</a></li>
<li><a class="reference internal" href="#creating-blank-project-for-jpa" id="id27">Creating blank project for JPA</a></li>
</ul>
</li>
<li><a class="reference internal" href="#project-import" id="id28">Project import</a></li>
<li><a class="reference internal" href="#project-configuration" id="id29">Project configuration</a></li>
<li><a class="reference internal" href="#confirmation-of-configuration-file" id="id30">Confirmation of configuration file</a></li>
<li><a class="reference internal" href="#operation-verification-of-the-project" id="id31">Operation verification of the project</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creation-of-todo-application" id="id32">Creation of Todo application</a><ul>
<li><a class="reference internal" href="#creation-of-domain-layer" id="id33">Creation of Domain layer</a><ul>
<li><a class="reference internal" href="#creation-of-domain-object" id="id34">Creation of Domain Object</a></li>
<li><a class="reference internal" href="#repository-creation" id="id35">Repository creation</a></li>
<li><a class="reference internal" href="#creation-of-repositoryimpl-infrastructure-layer" id="id36">Creation of RepositoryImpl (Infrastructure layer)</a></li>
<li><a class="reference internal" href="#service-creation" id="id37">Service creation</a></li>
<li><a class="reference internal" href="#creation-of-junit-for-service" id="id38">Creation of JUnit for Service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creation-of-application-layer" id="id39">Creation of application layer</a><ul>
<li><a class="reference internal" href="#creation-of-controller" id="id40">Creation of Controller</a></li>
<li><a class="reference internal" href="#show-all-todo-implementation" id="id41">Show all TODO implementation</a></li>
<li><a class="reference internal" href="#id1" id="id42">Create TODO</a></li>
<li><a class="reference internal" href="#id2" id="id43">Finish TODO</a></li>
<li><a class="reference internal" href="#id6" id="id44">Delete TODO</a></li>
<li><a class="reference internal" href="#use-of-css-file" id="id45">Use of CSS file</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#creating-infrastructure-layer-with-a-database-access" id="id46">Creating infrastructure layer with a Database access</a><ul>
<li><a class="reference internal" href="#creating-a-blank-project-dependent-on-o-r-mapper" id="id47">Creating a blank project dependent on O/R Mapper</a></li>
<li><a class="reference internal" href="#database-set-up" id="id48">Database set-up</a><ul>
<li><a class="reference internal" href="#modification-in-todo-infra-properties" id="id49">Modification in todo-infra.properties</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-infrastructure-layer-with-mybatis3" id="id50">Creating infrastructure layer with MyBatis3</a><ul>
<li><a class="reference internal" href="#create-todorepository" id="id51">Create TodoRepository</a></li>
<li><a class="reference internal" href="#create-todorepositoryimpl" id="id52">Create TodoRepositoryImpl</a></li>
<li><a class="reference internal" href="#create-mapper-file" id="id53">Create Mapper file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-infrastructure-layer-with-spring-data-jpa" id="id54">Creating infrastructure layer with Spring Data JPA</a><ul>
<li><a class="reference internal" href="#modification-in-entity" id="id55">Modification in Entity</a></li>
<li><a class="reference internal" href="#creat-todorepository" id="id56">Creat TodoRepository</a></li>
<li><a class="reference internal" href="#id9" id="id57">Create TodoRepositoryImpl</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#in-the-end" id="id58">In the end…</a></li>
<li><a class="reference internal" href="#appendix" id="id59">Appendix</a><ul>
<li><a class="reference internal" href="#description-of-the-configuration-file" id="id60">Description of the configuration file</a><ul>
<li><a class="reference internal" href="#web-xml" id="id61">web.xml</a></li>
<li><a class="reference internal" href="#common-jsp" id="id62">Common JSP</a></li>
<li><a class="reference internal" href="#bean-definition-file" id="id63">Bean definition file</a></li>
<li><a class="reference internal" href="#logback-xml" id="id64">logback.xml</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id10">10.1.1. Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<div class="section" id="points-to-study-in-this-tutorial">
<h3><a class="toc-backref" href="#id11">10.1.1.1. Points to study in this tutorial</a><a class="headerlink" href="#points-to-study-in-this-tutorial" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Basic application development using TERASOLUNA Server Framework for Java (5.x)</li>
<li>Configuration of Maven and STS(Eclipse) project</li>
<li>Way of development using application layering of TERASOLUNA Server Framework for Java (5.x).</li>
</ul>
</div>
<div class="section" id="target-readers">
<h3><a class="toc-backref" href="#id12">10.1.1.2. Target readers</a><a class="headerlink" href="#target-readers" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Basic knowledge of Spring DI and AOP required</li>
<li>Web application development using Servlet/JSP</li>
<li>SQL knowledge</li>
</ul>
</div>
<div class="section" id="verification-environment">
<h3><a class="toc-backref" href="#id13">10.1.1.3. Verification environment</a><a class="headerlink" href="#verification-environment" title="Permalink to this headline">¶</a></h3>
<p>In this tutorial, operations are verified on following environment. In case of implementation on other environment, perform appropriate setting based on this guideline.</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type</th>
<th class="head">Name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>OS</td>
<td>Windows 7</td>
</tr>
<tr class="row-odd"><td>JVM</td>
<td><a class="reference external" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java</a> 1.8</td>
</tr>
<tr class="row-even"><td>IDE</td>
<td><a class="reference external" href="http://spring.io/tools/sts/all">Spring Tool Suite</a> 3.6.4.RELEASE (Onwards referred as [STS])</td>
</tr>
<tr class="row-odd"><td>Build Tool</td>
<td><a class="reference external" href="http://maven.apache.org/download.cgi">Apache Maven</a> 3.3.9 (Onwards referred as [Maven])</td>
</tr>
<tr class="row-even"><td>Application Server</td>
<td><a class="reference external" href="https://network.pivotal.io/products/pivotal-tcserver">Pivotal tc Server</a> Developer Edition v3.1 (Enclosed in STS)</td>
</tr>
<tr class="row-odd"><td>Web Browser</td>
<td><a class="reference external" href="https://www.google.co.jp/chrome/browser/desktop/index.html">Google Chrome</a> 46.0.2490.80 m</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="description-of-application-to-be-created">
<h2><a class="toc-backref" href="#id14">10.1.2. Description of application to be created</a><a class="headerlink" href="#description-of-application-to-be-created" title="Permalink to this headline">¶</a></h2>
<div class="section" id="overview-of-the-application">
<h3><a class="toc-backref" href="#id15">10.1.2.1. Overview of the application</a><a class="headerlink" href="#overview-of-the-application" title="Permalink to this headline">¶</a></h3>
<p>Application to manage TODO list is to be developed. TODO list display, TODO registration, TODO completion and TODO deletion can be performed.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image001.png"><img alt="../_images/image001.png" src="../_images/image001.png" style="width: 50%;" /></a>
</div>
</div>
<div class="section" id="business-requirements-of-application">
<span id="app-requirement"></span><h3><a class="toc-backref" href="#id16">10.1.2.2. Business requirements of application</a><a class="headerlink" href="#business-requirements-of-application" title="Permalink to this headline">¶</a></h3>
<p>Business requirement of the application is as follows.</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">RuleID</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>B01</td>
<td>Only up to 5 incomplete TODO records can be registered</td>
</tr>
<tr class="row-odd"><td>B02</td>
<td>For TODOs which are already completed, “TODO Complete” processing cannot be done.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This application is for learning purpose only. It is not suitable as a real todo management application.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="screen-transition-of-application">
<h3><a class="toc-backref" href="#id17">10.1.2.3. Screen transition of application</a><a class="headerlink" href="#screen-transition-of-application" title="Permalink to this headline">¶</a></h3>
<p>Processing specification and screen transition of an application is as follows.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image002.png"><img alt="../_images/image002.png" src="../_images/image002.png" style="width: 60%;" /></a>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="20%" />
<col width="10%" />
<col width="15%" />
<col width="45%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Process name</th>
<th class="head">HTTP method</th>
<th class="head">URL</th>
<th class="head">Remark</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Show all TODO</td>
<td>-</td>
<td>/todo/list</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Create TODO</td>
<td>POST</td>
<td>/todo/create</td>
<td>Redirect to Show all TODO after creation is completed</td>
</tr>
<tr class="row-even"><td>3</td>
<td>Finish TODO</td>
<td>POST</td>
<td>/todo/finish</td>
<td>Redirect to Show all TODO after completion process</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>Delete TODO</td>
<td>POST</td>
<td>/todo/delete</td>
<td>Redirect to Show all TODO after deletion is completed</td>
</tr>
</tbody>
</table>
<div class="section" id="show-all-todo">
<h4><a class="toc-backref" href="#id18">10.1.2.3.1. Show all TODO</a><a class="headerlink" href="#show-all-todo" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Display all records of TODO</li>
<li>Provide <code class="docutils literal"><span class="pre">Finish</span></code> and  <code class="docutils literal"><span class="pre">Delete</span></code> buttons for incomplete TODO</li>
<li>Strike-through the completed records of TODO</li>
<li>Display only record name of TODO</li>
</ul>
</div>
<div class="section" id="create-todo">
<h4><a class="toc-backref" href="#id19">10.1.2.3.2. Create TODO</a><a class="headerlink" href="#create-todo" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Save TODO sent from the form</li>
<li>Record name of TODO should be between 1 - 30 characters</li>
<li>When <a class="reference internal" href="#app-requirement"><span class="std std-ref">Business requirements of application</span></a> B01 is not fulfilled, business exception with error code E001 is thrown</li>
<li>Display “Created successfully!” at the transited screen when the creation process is successful.</li>
</ul>
</div>
<div class="section" id="finish-todo">
<h4><a class="toc-backref" href="#id20">10.1.2.3.3. Finish TODO</a><a class="headerlink" href="#finish-todo" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>For the TODOs corresponding to <code class="docutils literal"><span class="pre">todoId</span></code> which is received from the form object, change the status to <code class="docutils literal"><span class="pre">completed</span></code>.</li>
<li>When the corresponding TODO does not exist, resource not found exception with error code E404 is thrown</li>
<li>When <a class="reference internal" href="#app-requirement"><span class="std std-ref">Business requirements of application</span></a> B02 is not fulfilled, business exception with error code E002 is thrown</li>
<li>Display “Finished successfully!” at the transited screen when the finishing process is successful.</li>
</ul>
</div>
<div class="section" id="delete-todo">
<h4><a class="toc-backref" href="#id21">10.1.2.3.4. Delete TODO</a><a class="headerlink" href="#delete-todo" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Delete TODO corresponding to <code class="docutils literal"><span class="pre">todoId</span></code> sent from the form</li>
<li>When the corresponding TODO does not exist, resources undetected exception with error code E404 is thrown</li>
<li>Display “Deleted successfully!” at the transited screen when the deletion process is successful.</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="error-message-list">
<h3><a class="toc-backref" href="#id22">10.1.2.4. Error message list</a><a class="headerlink" href="#error-message-list" title="Permalink to this headline">¶</a></h3>
<p>Define below 3 error messages.</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="15%" />
<col width="50%" />
<col width="35%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Error code</th>
<th class="head">Message</th>
<th class="head">Parameter to be replaced</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>E001</td>
<td>[E001] The count of un-finished Todo must not be over {0}.</td>
<td>{0}… max unfinished count</td>
</tr>
<tr class="row-odd"><td>E002</td>
<td>[E002] The requested Todo is already finished. (id={0})</td>
<td>{0}… todoId</td>
</tr>
<tr class="row-even"><td>E404</td>
<td>[E404] The requested Todo is not found. (id={0})</td>
<td>{0}… todoId</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="environment-creation">
<h2><a class="toc-backref" href="#id23">10.1.3. Environment creation</a><a class="headerlink" href="#environment-creation" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial, as RepositoryImpl implementation of the infrastructure layer,</p>
<ul class="simple">
<li>In-memory implementation of RepositoryImpl using <code class="docutils literal"><span class="pre">java.util.Map</span></code> without using the database</li>
<li>RepositoryImpl access the database using MyBatis3</li>
<li>RepositoryImpl access the database using Spring Data JPA</li>
</ul>
<p>3 types are prepared. Select anyone depending upon the use.</p>
<p>Under this tutorial, First, try the in-memory implementation followed by select myBatis3 or Spring Data JPA.</p>
<div class="section" id="project-creation">
<h3><a class="toc-backref" href="#id24">10.1.3.1. Project creation</a><a class="headerlink" href="#project-creation" title="Permalink to this headline">¶</a></h3>
<p>First, create a blank project for implementation of infrastructure layer using <code class="docutils literal"><span class="pre">mvn</span> <span class="pre">archetype:generate</span></code>.
This is a procedure to create a blank project using the Windows command prompt.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If internet connection is accessed through proxy server,
In order to perform the following tasks, necessary STS proxy settings and <a class="reference external" href="http://maven.apache.org/guides/mini/guide-proxies.html">Maven proxy setting</a> needs to be done.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>If <code class="docutils literal"><span class="pre">mvn</span> <span class="pre">archetype:generate</span></code> executes on Bash, it can be executed by replacing the <code class="docutils literal"><span class="pre">^</span></code> with <code class="docutils literal"><span class="pre">\</span></code>.</p>
<blockquote class="last">
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>mvn archetype:generate -B<span class="se">\</span>
 -DarchetypeCatalog<span class="o">=</span>http://repo.terasoluna.org/nexus/content/repositories/terasoluna-gfw-releases<span class="se">\</span>
 -DarchetypeGroupId<span class="o">=</span>org.terasoluna.gfw.blank<span class="se">\</span>
 -DarchetypeArtifactId<span class="o">=</span>terasoluna-gfw-web-blank-archetype<span class="se">\</span>
 -DarchetypeVersion<span class="o">=</span><span class="m">5</span>.2.0.RELEASE<span class="se">\</span>
 -DgroupId<span class="o">=</span>todo<span class="se">\</span>
 -DartifactId<span class="o">=</span>todo<span class="se">\</span>
 -Dversion<span class="o">=</span><span class="m">1</span>.0.0-SNAPSHOT
</pre></div>
</div>
</div></blockquote>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="creating-o-r-mapper-independent-blank-project">
<span id="tutorialcreateplainblankproject"></span><h4><a class="toc-backref" href="#id25">10.1.3.1.1. Creating O/R Mapper independent blank project</a><a class="headerlink" href="#creating-o-r-mapper-independent-blank-project" title="Permalink to this headline">¶</a></h4>
<p>If you want to create a project for RepositoryImpl using <code class="docutils literal"><span class="pre">java.util.Map</span></code>(without accessing the database),
run the following command to create O/R Mapper independent blank project in command prompt.  <strong>If you read through this tutorial in consecutive order, first of all, create a project in this way</strong>.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">mvn archetype:generate -B^</span>
<span class="go"> -DarchetypeCatalog=http://repo.terasoluna.org/nexus/content/repositories/terasoluna-gfw-releases^</span>
<span class="go"> -DarchetypeGroupId=org.terasoluna.gfw.blank^</span>
<span class="go"> -DarchetypeArtifactId=terasoluna-gfw-web-blank-archetype^</span>
<span class="go"> -DarchetypeVersion=5.2.0.RELEASE^</span>
<span class="go"> -DgroupId=todo^</span>
<span class="go"> -DartifactId=todo^</span>
<span class="go"> -Dversion=1.0.0-SNAPSHOT</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-blank-project-for-mybatis3">
<span id="tutorialcreatemybatis3blankproject"></span><h4><a class="toc-backref" href="#id26">10.1.3.1.2. Creating blank project for MyBatis3</a><a class="headerlink" href="#creating-blank-project-for-mybatis3" title="Permalink to this headline">¶</a></h4>
<p>If you want to create a project for RepositoryImpl to access the database using MyBatis3,
run the following command to create a blank project for the MyBatis3. This way to create a project is to be done in <a class="reference internal" href="#using-mybatis3"><span class="std std-ref">Creating infrastructure layer with MyBatis3</span></a>.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">mvn archetype:generate -B^</span>
<span class="go"> -DarchetypeCatalog=http://repo.terasoluna.org/nexus/content/repositories/terasoluna-gfw-releases^</span>
<span class="go"> -DarchetypeGroupId=org.terasoluna.gfw.blank^</span>
<span class="go"> -DarchetypeArtifactId=terasoluna-gfw-web-blank-mybatis3-archetype^</span>
<span class="go"> -DarchetypeVersion=5.2.0.RELEASE^</span>
<span class="go"> -DgroupId=todo^</span>
<span class="go"> -DartifactId=todo^</span>
<span class="go"> -Dversion=1.0.0-SNAPSHOT</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-blank-project-for-jpa">
<span id="tutorialcreatejpablankproject"></span><h4><a class="toc-backref" href="#id27">10.1.3.1.3. Creating blank project for JPA</a><a class="headerlink" href="#creating-blank-project-for-jpa" title="Permalink to this headline">¶</a></h4>
<p>If you want to create a project for RepositoryImpl to access the database using Spring Data JPA,
run the following command to create a blank project for the JPA. This way to create a project is to be done in <a class="reference internal" href="#using-springdatajpa"><span class="std std-ref">Creating infrastructure layer with Spring Data JPA</span></a>.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">mvn archetype:generate -B^</span>
<span class="go"> -DarchetypeCatalog=http://repo.terasoluna.org/nexus/content/repositories/terasoluna-gfw-releases^</span>
<span class="go"> -DarchetypeGroupId=org.terasoluna.gfw.blank^</span>
<span class="go"> -DarchetypeArtifactId=terasoluna-gfw-web-blank-jpa-archetype^</span>
<span class="go"> -DarchetypeVersion=5.2.0.RELEASE^</span>
<span class="go"> -DgroupId=todo^</span>
<span class="go"> -DartifactId=todo^</span>
<span class="go"> -Dversion=1.0.0-SNAPSHOT</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="project-import">
<h3><a class="toc-backref" href="#id28">10.1.3.2. Project import</a><a class="headerlink" href="#project-import" title="Permalink to this headline">¶</a></h3>
<p>Import created blank project into STS.</p>
<p>Select the archetype created project from STS menu [File] -&gt; [Import] -&gt; [Maven] -&gt; [Existing Maven Projects] -&gt; [Next].</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/NewMVCProjectImport1.png"><img alt="New MVC Project Import" src="../_images/NewMVCProjectImport1.png" style="width: 60%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Click on [Finish] by selecting <code class="docutils literal"><span class="pre">C:\work\todo</span></code> in Root Directory and selecting pom.xml of todo in Projects.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/NewMVCProjectCreate1.png"><img alt="New MVC Project Import" src="../_images/NewMVCProjectCreate1.png" style="width: 60%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>When the import is completed, project is displayed in the Package Explorer as follows.</p>
<div class="figure">
<img alt="workspace" src="../_images/image004.png" />
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If the build error occurs after the import, it can be removed by
Right click on the project name in Package Explorer and select [Maven] -&gt; [Update Project…] -&gt; [OK] .</p>
<blockquote class="last">
<div><div class="figure">
<a class="reference internal image-reference" href="../_images/update-project.png"><img alt="../_images/update-project.png" src="../_images/update-project.png" style="width: 70%;" /></a>
</div>
</div></blockquote>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>For better visibility, Package Presentation must be changed to [Hierarchical] from default [Flat].</p>
<p>Click [View Menu] (The right edge of the down arrow) of the Package Explorer and select [Package Presentation] -&gt; [Hierarchical].</p>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../_images/presentation-hierarchical.png"><img alt="../_images/presentation-hierarchical.png" src="../_images/presentation-hierarchical.png" style="width: 80%;" /></a>
</div>
</div></blockquote>
<p>It can be displayed as follows if Package Presentation changed into [Hierarchical].</p>
<blockquote class="last">
<div><div class="figure">
<img alt="../_images/presentation-hierarchical-view.png" src="../_images/presentation-hierarchical-view.png" />
</div>
</div></blockquote>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>H2 Database has been defined as a dependency in O/R Mapper type blank project but,
this setting is done to create a simple application easily therefore it is not intended to use in the actual application development.</p>
<p>The following definitions shall be removed while performing the actual application development.</p>
<blockquote class="last">
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.h2database<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>h2<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="project-configuration">
<h3><a class="toc-backref" href="#id29">10.1.3.3. Project configuration</a><a class="headerlink" href="#project-configuration" title="Permalink to this headline">¶</a></h3>
<p>Below is the structure of the project to be created in this tutorial.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>It had been recommended to use a multi-project structure in <a class="reference internal" href="../Overview/ApplicationLayering.html#application-layering-project-structure"><span class="std std-ref">[Project Structure] section of previous chapter</span></a> but,
in this tutorial, a single project configuration is used because it focuses on ease of learning.
However, when in a real project, multi project configuration is strongly recommended.</p>
<p><strong>However, when in a real project, multi project configuration is strongly recommended.</strong></p>
<p class="last">For creating multi-project, Refer [<a class="reference internal" href="../ImplementationAtEachLayer/CreateWebApplicationProject.html"><span class="doc">Create Web application development project</span></a>].</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>[Configuration of blank project created for MyBatis3]</strong></p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">src</span>
<span class="go">  └main</span>
<span class="go">      ├java</span>
<span class="go">      │  └todo</span>
<span class="go">      │    ├ app</span>
<span class="go">      │    │   └todo</span>
<span class="go">      │    └domain</span>
<span class="go">      │        ├model</span>
<span class="go">      │        ├repository</span>
<span class="go">      │        │   └todo</span>
<span class="go">      │        └service</span>
<span class="go">      │            └todo</span>
<span class="go">      ├resources</span>
<span class="go">      │  ├META-INF</span>
<span class="go">      │  │  ├mybatis ... (8)</span>
<span class="go">      │  │  └spring</span>
<span class="go">      │  └todo</span>
<span class="go">      │    └domain</span>
<span class="go">      │        └repository ... (9)</span>
<span class="go">      │             └todo</span>
<span class="go">      └wepapp</span>
<span class="go">          └WEB-INF</span>
<span class="go">              └views</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td>Directory that contains the MyBatis configuration files.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><p class="first">Directory that contains the Mapper of MyBatis describing the SQL.</p>
<p class="last">In this tutorial, create a directory for storing the Mapper file of Repository for Todo object.</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>[Configuration of blank project created for JPA, O/R Mapper independent blank project]</strong></p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">src</span>
<span class="go">  └main</span>
<span class="go">      ├java</span>
<span class="go">      │  └todo</span>
<span class="go">      │    ├ app ... (1)</span>
<span class="go">      │    │   └todo</span>
<span class="go">      │    └domain ... (2)</span>
<span class="go">      │        ├model ... (3)</span>
<span class="go">      │        ├repository ... (4)</span>
<span class="go">      │        │   └todo</span>
<span class="go">      │        └service ... (5)</span>
<span class="go">      │            └todo</span>
<span class="go">      ├resources</span>
<span class="go">      │  └META-INF</span>
<span class="go">      │      └spring ... (6)</span>
<span class="go">      └wepapp</span>
<span class="go">          └WEB-INF</span>
<span class="go">              └views ... (7)</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p class="first">Packages for storing application layer classes.</p>
<p class="last">In this tutorial, creating package for storing the Todo business classes.</p>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>Packages for storing domain layer class.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>Packages for storing Domain Object.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><p class="first">Packages for storing Repository</p>
<p class="last">In this tutorial, creating package for storing the Todo object (Domain Object) Repository.</p>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><p class="first">Packages for storing Service.</p>
<p class="last">In this tutorial, creating package for storing the Todo business services.</p>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td>Directory that contains the Spring configuration files.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td>Directory for storing jsp.</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="confirmation-of-configuration-file">
<h3><a class="toc-backref" href="#id30">10.1.3.4. Confirmation of configuration file</a><a class="headerlink" href="#confirmation-of-configuration-file" title="Permalink to this headline">¶</a></h3>
<p>Many settings those are required in advanced tutorial already done in the created blank project.</p>
<p>If only the implementation of the tutorial is concern, understanding of these settings are not required but
it is recommended that you understand what settings are necessary to run an application.</p>
<p>For description of the required configuration (settings file) to run an application, Refer [<a class="reference internal" href="#tutorialtodoappendixexpoundconfigurations"><span class="std std-ref">Description of the configuration file</span></a>].</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you are creating a Todo application for familiarizing with the system, you may skip the confirmation of configuration file but
suggest to read this after creating the Todo application.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="operation-verification-of-the-project">
<h3><a class="toc-backref" href="#id31">10.1.3.5. Operation verification of the project</a><a class="headerlink" href="#operation-verification-of-the-project" title="Permalink to this headline">¶</a></h3>
<p>Before starting the development of Todo application, verify the project operation.</p>
<p>Since the implementation of the Controller and JSP for displaying the top page are provided in the blank project,
it is possible to check the operation by displaying the top page.</p>
<p>The following implementation has been done in the Controller(<code class="file docutils literal"><span class="pre">src/main/java/todo/app/welcome/HomeController.java</span></code>),
provided in the blank project.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.app.welcome</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.text.DateFormat</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Handles requests for the application home page.</span>
<span class="cm"> */</span>
<span class="hll"><span class="c1">// (1)</span>
</span><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HomeController</span> <span class="p">{</span>

<span class="hll">    <span class="c1">// (2)</span>
</span>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span>
            <span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">HomeController</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

    <span class="cm">/**</span>
<span class="cm">     * Simply selects the home view to render by returning its name.</span>
<span class="cm">     */</span>
<span class="hll">    <span class="c1">// (3)</span>
</span>    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="p">{</span><span class="n">RequestMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">})</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="p">(</span><span class="n">Locale</span> <span class="n">locale</span><span class="p">,</span> <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">        <span class="c1">// (4)</span>
</span>        <span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Welcome home! The client locale is {}.&quot;</span><span class="p">,</span> <span class="n">locale</span><span class="p">);</span>

        <span class="n">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="p">();</span>
        <span class="n">DateFormat</span> <span class="n">dateFormat</span> <span class="o">=</span> <span class="n">DateFormat</span><span class="p">.</span><span class="na">getDateTimeInstance</span><span class="p">(</span><span class="n">DateFormat</span><span class="p">.</span><span class="na">LONG</span><span class="p">,</span>
                <span class="n">DateFormat</span><span class="p">.</span><span class="na">LONG</span><span class="p">,</span> <span class="n">locale</span><span class="p">);</span>

        <span class="n">String</span> <span class="n">formattedDate</span> <span class="o">=</span> <span class="n">dateFormat</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">date</span><span class="p">);</span>

<span class="hll">        <span class="c1">// (5)</span>
</span>        <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;serverTime&quot;</span><span class="p">,</span> <span class="n">formattedDate</span><span class="p">);</span>

<span class="hll">        <span class="c1">// (6)</span>
</span>        <span class="k">return</span> <span class="s">&quot;welcome/home&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In order to make the Controller as component-scan target, attach <code class="docutils literal"><span class="pre">&#64;Controller</span></code> annotation to class level.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Generating logger for outputting the log at (4).</div>
<div class="line">Logger impmements the logback but, the API <code class="docutils literal"><span class="pre">org.slf4j.Logger</span></code> of SLF4J is used.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set mapping methods for accessing the <code class="docutils literal"><span class="pre">&quot;/&quot;</span></code> (root) using <code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code> annotation.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Outputting info level log for notifying that the method is called.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">For displaying date on screen set date as <code class="docutils literal"><span class="pre">&quot;serverTime&quot;</span></code> attribute name to the Model.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Return <code class="docutils literal"><span class="pre">&quot;welcome/home&quot;</span></code> as view name. Using <code class="docutils literal"><span class="pre">ViewResolver</span></code> settings, <code class="docutils literal"><span class="pre">WEB-INF/views/welcome/home.jsp</span></code> is called.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The following implementation has been done in the JSP(<code class="file docutils literal"><span class="pre">src/main/webapp/WEB-INF/views/welcome/home.jsp</span></code>),
provided in the blank project.</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>Home<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span>
    <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/resources/app/css/styles.css&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;wrapper&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h1&gt;</span>Hello world!<span class="nt">&lt;/h1&gt;</span>
<span class="hll">        <span class="c">&lt;!-- (7) --&gt;</span>
</span>        <span class="nt">&lt;p&gt;</span>The time on the server is ${serverTime}.<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Display <code class="docutils literal"><span class="pre">&quot;serverTime&quot;</span></code> passed from Controller in Model.</div>
<div class="line">Here, XSS measures are done but always performs the XSS measures for displaying the user input values by <code class="docutils literal"><span class="pre">f:h()</span></code> function.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Right click on project and select [Run As] -&gt; [Run on Server].</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image031.jpg"><img alt="../_images/image031.jpg" src="../_images/image031.jpg" style="width: 70%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Select [Next] after selecting AP server (Pivotal tc Server Developer Edition v3.1).</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image032.jpg"><img alt="../_images/image032.jpg" src="../_images/image032.jpg" style="width: 70%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Verify that todo is included in [Configured] and click [Finish] to start the server.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image033.jpg"><img alt="../_images/image033.jpg" src="../_images/image033.jpg" style="width: 70%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>When started, log shown as below will be output.
For <code class="docutils literal"><span class="pre">&quot;/&quot;</span></code> path, it is understood that hello method of <code class="docutils literal"><span class="pre">todo.app.welcome.HomeController</span></code> is mapped.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go"> date:2016-02-17 11:25:30    thread:localhost-startStop-1    X-Track:        level:INFO      logger:o.springframework.web.servlet.DispatcherServlet  message:FrameworkServlet &#39;appServlet&#39;: initialization started</span>
<span class="go"> date:2016-02-17 11:25:31    thread:localhost-startStop-1    X-Track:        level:DEBUG     logger:o.t.gfw.web.codelist.CodeListInterceptor         message:registered codeList : []</span>
<span class="hll"><span class="go"> date:2016-02-17 11:25:31    thread:localhost-startStop-1    X-Track:        level:INFO      logger:o.s.w.s.m.m.a.RequestMappingHandlerMapping       message:Mapped &quot;{[/],methods=[GET || POST],params=[],headers=[],consumes=[],produces=[],custom=[]}&quot; onto public java.lang.String todo.app.welcome.HomeController.home(java.util.Locale,org.springframework.ui.Model)</span>
</span><span class="go"> date:2016-02-17 11:25:31    thread:localhost-startStop-1    X-Track:        level:INFO      logger:o.s.w.s.m.m.a.RequestMappingHandlerAdapter       message:Looking for @ControllerAdvice: WebApplicationContext for namespace &#39;appServlet-servlet&#39;: startup date [Wed Feb 17 11:25:30 JST 2016]; parent: Root WebApplicationContext</span>
<span class="go"> date:2016-02-17 11:25:32    thread:localhost-startStop-1    X-Track:        level:INFO      logger:o.s.w.s.m.m.a.RequestMappingHandlerAdapter       message:Looking for @ControllerAdvice: WebApplicationContext for namespace &#39;appServlet-servlet&#39;: startup date [Wed Feb 17 11:25:30 JST 2016]; parent: Root WebApplicationContext</span>
<span class="go"> date:2016-02-17 11:25:32    thread:localhost-startStop-1    X-Track:        level:INFO      logger:o.s.web.servlet.handler.SimpleUrlHandlerMapping  message:Mapped URL path [/**] onto handler &#39;org.springframework.web.servlet.resource.DefaultServletHttpRequestHandler#0&#39;</span>
<span class="go"> date:2016-02-17 11:25:32    thread:localhost-startStop-1    X-Track:        level:INFO      logger:o.s.web.servlet.handler.SimpleUrlHandlerMapping  message:Mapped URL path [/resources/**] onto handler &#39;org.springframework.web.servlet.resource.ResourceHttpRequestHandler#0&#39;</span>
<span class="go"> date:2016-02-17 11:25:33    thread:localhost-startStop-1    X-Track:        level:INFO      logger:o.springframework.web.servlet.DispatcherServlet  message:FrameworkServlet &#39;appServlet&#39;: initialization completed in 2826 ms</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>If <a class="reference external" href="http://localhost:8080/todo">http://localhost:8080/todo</a> is accessed in browser, following is displayed.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image034.png"><img alt="../_images/image034.png" src="../_images/image034.png" style="width: 60%;" /></a>
</div>
<p>If you confirm the console,</p>
<ul class="simple">
<li>TRACE log of <code class="docutils literal"><span class="pre">TraceLoggingInterceptor</span></code> provided by the common library</li>
<li>INFO log implemented in the Controller</li>
</ul>
<p>are the log output.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="go"> date:2016-02-17 11:25:35    thread:tomcat-http--11  X-Track:b49b630274974bffbcd9e8d13261f6a7        level:TRACE     logger:o.t.gfw.web.logging.TraceLoggingInterceptor      message:[START CONTROLLER] HomeController.home(Locale,Model)</span>
</span><span class="hll"><span class="go"> date:2016-02-17 11:25:35    thread:tomcat-http--11  X-Track:b49b630274974bffbcd9e8d13261f6a7        level:INFO      logger:todo.app.welcome.HomeController                  message:Welcome home! The client locale is ja_JP.</span>
</span><span class="hll"><span class="go"> date:2016-02-17 11:25:35    thread:tomcat-http--11  X-Track:b49b630274974bffbcd9e8d13261f6a7        level:TRACE     logger:o.t.gfw.web.logging.TraceLoggingInterceptor      message:[END CONTROLLER  ] HomeController.home(Locale,Model)-&gt; view=welcome/home, model={serverTime=2016/02/17 11:25:35 JST}</span>
</span><span class="hll"><span class="go"> date:2016-02-17 11:25:35    thread:tomcat-http--11  X-Track:b49b630274974bffbcd9e8d13261f6a7        level:TRACE     logger:o.t.gfw.web.logging.TraceLoggingInterceptor      message:[HANDLING TIME   ] HomeController.home(Locale,Model)-&gt; 97,346,576 ns</span>
</span></pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">TraceLoggingInterceptor</span></code> outputs start and end log of the Controller. While ending, the information of <code class="docutils literal"><span class="pre">View</span></code> and <code class="docutils literal"><span class="pre">Model</span></code> as well as processing time are output.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="creation-of-todo-application">
<h2><a class="toc-backref" href="#id32">10.1.4. Creation of Todo application</a><a class="headerlink" href="#creation-of-todo-application" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">Create Todo application. Order in which it must be created is as follows</div>
</div>
<ul class="simple">
<li>Domain layer (+ Infrastructure layer)</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Domain Object creation</li>
<li>Repository creation</li>
<li>RepositoryImpl creation</li>
<li>Service creation</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Application layer</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Controller creation</li>
<li>Form creation</li>
<li>View creation</li>
</ul>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>About the creation of RepositoryImpl, implementation is differ depending on the type of the selected infrastructure layer.</p>
<p>Here, In-memory implemented RepositoryImpl is created using <code class="docutils literal"><span class="pre">java.util.Map</span></code> without using the database is explained.
If you want to use database, create Todo application by referring the [<a class="reference internal" href="#tutorial-todo-infra"><span class="std std-ref">Creating infrastructure layer with a Database access</span></a>] content.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="creation-of-domain-layer">
<h3><a class="toc-backref" href="#id33">10.1.4.1. Creation of Domain layer</a><a class="headerlink" href="#creation-of-domain-layer" title="Permalink to this headline">¶</a></h3>
<div class="section" id="creation-of-domain-object">
<h4><a class="toc-backref" href="#id34">10.1.4.1.1. Creation of Domain Object</a><a class="headerlink" href="#creation-of-domain-object" title="Permalink to this headline">¶</a></h4>
<p>Create Domain object.</p>
<p>Right click on the Package Explorer, select -&gt; [New] -&gt; [Class] -&gt; [New Java Class] dialog box appears,</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="11%" />
<col width="33%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Item</th>
<th class="head">Input value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Package</td>
<td><code class="docutils literal"><span class="pre">todo.domain.model</span></code></td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Name</td>
<td><code class="docutils literal"><span class="pre">Todo</span></code></td>
</tr>
<tr class="row-even"><td>3</td>
<td>Interfaces</td>
<td><code class="docutils literal"><span class="pre">java.io.Serializable</span></code></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and click [Finish] after entering above information.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image057.png"><img alt="../_images/image057.png" src="../_images/image057.png" style="width: 70%;" /></a>
</div>
<p>Created class stored in the following directory.</p>
<div class="figure">
<img alt="../_images/image058.png" src="../_images/image058.png" />
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Add following properties in created class.</p>
<ul class="simple">
<li>ID = todoId</li>
<li>Title = todoTitle</li>
<li>Completion flag = finished</li>
<li>Created on = createdAt</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.domain.model</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Todo</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">todoId</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">todoTitle</span><span class="p">;</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">finished</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">Date</span> <span class="n">createdAt</span><span class="p">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTodoId</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">todoId</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTodoId</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">todoId</span> <span class="o">=</span> <span class="n">todoId</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTodoTitle</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">todoTitle</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTodoTitle</span><span class="p">(</span><span class="n">String</span> <span class="n">todoTitle</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">todoTitle</span> <span class="o">=</span> <span class="n">todoTitle</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isFinished</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">finished</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFinished</span><span class="p">(</span><span class="kt">boolean</span> <span class="n">finished</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">finished</span> <span class="o">=</span> <span class="n">finished</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getCreatedAt</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">createdAt</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCreatedAt</span><span class="p">(</span><span class="n">Date</span> <span class="n">createdAt</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">createdAt</span> <span class="o">=</span> <span class="n">createdAt</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Getter/Setter methods can be generated automatically by using STS feature.
After defining fields, right click on editor and select [Source] -&gt; [Generate Getter and Setters…]</p>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../_images/image059.png"><img alt="../_images/image059.png" src="../_images/image059.png" style="width: 90%;" /></a>
</div>
</div></blockquote>
<p>Click [OK] after selecting all other than serialVersionUID.</p>
<blockquote class="last">
<div><div class="figure">
<a class="reference internal image-reference" href="../_images/image060.png"><img alt="../_images/image060.png" src="../_images/image060.png" style="width: 60%;" /></a>
</div>
</div></blockquote>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="repository-creation">
<span id="tutorialtodocreaterepository"></span><h4><a class="toc-backref" href="#id35">10.1.4.1.2. Repository creation</a><a class="headerlink" href="#repository-creation" title="Permalink to this headline">¶</a></h4>
<p>Create <code class="docutils literal"><span class="pre">TodoRepository</span></code> interface.
If you want use database, create Repository by referring the [<a class="reference internal" href="#tutorial-todo-infra"><span class="std std-ref">Creating infrastructure layer with a Database access</span></a>] content.</p>
<p>Right click on the Package Explorer, select -&gt; [New] -&gt; [Interface] -&gt; [New Java Interface] dialog box appears,</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="11%" />
<col width="33%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Item</th>
<th class="head">Input value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Package</td>
<td><code class="docutils literal"><span class="pre">todo.domain.repository.todo</span></code></td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Name</td>
<td><code class="docutils literal"><span class="pre">TodoRepository</span></code></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and click [Finish] after entering above information.</p>
<p>Created Interface stored in the following directory.</p>
<div class="figure">
<img alt="../_images/image061.png" src="../_images/image061.png" />
</div>
<p>Define following CRUD operation methods pertaining to this application in created interface.</p>
<ul class="simple">
<li>Fetch 1 record of TODO = findOne</li>
<li>Fetch all records of TODO = findAll</li>
<li>Create 1 record of TODO = create</li>
<li>Update 1 record of TODO = update</li>
<li>Delete 1 record of TODO = delete</li>
<li>Fetch record count of completed TODO = countByFinished</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.domain.repository.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">todo.domain.model.Todo</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoRepository</span> <span class="p">{</span>
    <span class="n">Todo</span> <span class="nf">findOne</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">);</span>

    <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="p">();</span>

    <span class="kt">void</span> <span class="nf">create</span><span class="p">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="p">);</span>

    <span class="kt">boolean</span> <span class="nf">update</span><span class="p">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="p">);</span>

    <span class="kt">void</span> <span class="nf">delete</span><span class="p">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="p">);</span>

    <span class="kt">long</span> <span class="nf">countByFinished</span><span class="p">(</span><span class="kt">boolean</span> <span class="n">finished</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Here, to improve versatility of <code class="docutils literal"><span class="pre">TodoRepository</span></code>, instead of (<code class="docutils literal"><span class="pre">long</span> <span class="pre">countFinished()</span></code>) method for [Fetch completed record count],
(<code class="docutils literal"><span class="pre">long</span> <span class="pre">countByFinished(boolean)</span></code>) method for [record count having xx completion status ] is defined.</p>
<p class="last">If pass <code class="docutils literal"><span class="pre">true</span></code> as an argument to <code class="docutils literal"><span class="pre">long</span> <span class="pre">countByFinished(boolean)</span></code>, [completed record count] and
if pass <code class="docutils literal"><span class="pre">false</span></code> as an argument, [not completed record count] can be fetched by specification.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="creation-of-repositoryimpl-infrastructure-layer">
<h4><a class="toc-backref" href="#id36">10.1.4.1.3. Creation of RepositoryImpl (Infrastructure layer)</a><a class="headerlink" href="#creation-of-repositoryimpl-infrastructure-layer" title="Permalink to this headline">¶</a></h4>
<p>Here, In-memory implemented RepositoryImpl is created using <code class="docutils literal"><span class="pre">java.util.Map</span></code> for simplification.
If you want use database, create RepositoryImpl by referring the [<a class="reference internal" href="#tutorial-todo-infra"><span class="std std-ref">Creating infrastructure layer with a Database access</span></a>] content.</p>
<p>Right click on the Package Explorer, select -&gt; [New] -&gt; [Class] -&gt; [New Java Class] dialog box appears,</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="11%" />
<col width="33%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Item</th>
<th class="head">Input value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Package</td>
<td><code class="docutils literal"><span class="pre">todo.domain.repository.todo</span></code></td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Name</td>
<td><code class="docutils literal"><span class="pre">TodoRepositoryImpl</span></code></td>
</tr>
<tr class="row-even"><td>3</td>
<td>Interfaces</td>
<td><code class="docutils literal"><span class="pre">todo.domain.repository.todo.TodoRepository</span></code></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and click [Finish] after entering above information.</p>
<p>Created class stored in the following directory.</p>
<div class="figure">
<img alt="../_images/image062.png" src="../_images/image062.png" />
</div>
<p>Implement the CRUD operations in created class.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Business logic must not be included in RepositoryImpl,  it should focus only on inserting and removing (CRUD operation) from the persistence store.</p>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.domain.repository.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ConcurrentHashMap</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">todo.domain.model.Todo</span><span class="p">;</span>

<span class="hll"><span class="nd">@Repository</span> <span class="c1">// (1)</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoRepositoryImpl</span> <span class="kd">implements</span> <span class="n">TodoRepository</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Todo</span><span class="o">&gt;</span> <span class="n">TODO_MAP</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Todo</span><span class="o">&gt;</span><span class="p">();</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Todo</span> <span class="nf">findOne</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">TODO_MAP</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">todoId</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">TODO_MAP</span><span class="p">.</span><span class="na">values</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">create</span><span class="p">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">TODO_MAP</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">todo</span><span class="p">.</span><span class="na">getTodoId</span><span class="p">(),</span> <span class="n">todo</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">update</span><span class="p">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">TODO_MAP</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">todo</span><span class="p">.</span><span class="na">getTodoId</span><span class="p">(),</span> <span class="n">todo</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="p">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">TODO_MAP</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">todo</span><span class="p">.</span><span class="na">getTodoId</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">countByFinished</span><span class="p">(</span><span class="kt">boolean</span> <span class="n">finished</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">long</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">Todo</span> <span class="n">todo</span> <span class="p">:</span> <span class="n">TODO_MAP</span><span class="p">.</span><span class="na">values</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">finished</span> <span class="o">==</span> <span class="n">todo</span><span class="p">.</span><span class="na">isFinished</span><span class="p">())</span> <span class="p">{</span>
                <span class="n">count</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">count</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">To consider Repository as component scan target, add <code class="docutils literal"><span class="pre">&#64;Repository</span></code> annotation at class level.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In this tutorial, although infrastructure layer belonging classes (RepositoryImpl) are stored under domain layer package (<code class="docutils literal"><span class="pre">todo.domain</span></code>),
if package is divided completed on the basis of layers, it is better to create classes of infrastructure layer under <code class="docutils literal"><span class="pre">todo.infra</span></code>.</p>
<p class="last">However, in a normal project, infrastructure layer rarely changes (such projects are less).
Hence, in order to improve the work efficiency, RepositoryImpl can be created in the layer same as the repository of domain layer.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="service-creation">
<h4><a class="toc-backref" href="#id37">10.1.4.1.4. Service creation</a><a class="headerlink" href="#service-creation" title="Permalink to this headline">¶</a></h4>
<p>First create <code class="docutils literal"><span class="pre">TodoService</span></code> interface.</p>
<p>Right click on the Package Explorer, select -&gt; [New] -&gt; [Interface] -&gt; [New Java Interface] dialog box appears,</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="11%" />
<col width="33%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Item</th>
<th class="head">Input value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Package</td>
<td><code class="docutils literal"><span class="pre">todo.domain.service.todo</span></code></td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Name</td>
<td><code class="docutils literal"><span class="pre">TodoService</span></code></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and click [Finish] after entering above information.</p>
<p>Created Interface stored in the following directory.</p>
<div class="figure">
<img alt="../_images/image063.png" src="../_images/image063.png" />
</div>
<p>Define method to perform the following business processing in created class.</p>
<ul class="simple">
<li>Fetch all records of Todo = findAll</li>
<li>New creation of Todo = create</li>
<li>Completed of Todo = finish</li>
<li>Delete of Todo = delete</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.domain.service.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">todo.domain.model.Todo</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoService</span> <span class="p">{</span>
    <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="p">();</span>

    <span class="n">Todo</span> <span class="nf">create</span><span class="p">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="p">);</span>

    <span class="n">Todo</span> <span class="nf">finish</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">);</span>

    <span class="kt">void</span> <span class="nf">delete</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Next, create <code class="docutils literal"><span class="pre">TodoServiceImpl</span></code> class that implements the methods defined in <code class="docutils literal"><span class="pre">TodoService</span></code> interface.</p>
<p>Right click on the Package Explorer, select -&gt; [New] -&gt; [Class] -&gt; [New Java Class] dialog box appears,</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="11%" />
<col width="33%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Item</th>
<th class="head">Input value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Package</td>
<td><code class="docutils literal"><span class="pre">todo.domain.service.todo</span></code></td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Name</td>
<td><code class="docutils literal"><span class="pre">TodoServiceImpl</span></code></td>
</tr>
<tr class="row-even"><td>3</td>
<td>Interfaces</td>
<td><code class="docutils literal"><span class="pre">todo.domain.service.todo.TodoService</span></code></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and click [Finish] after entering above information.</p>
<p>Created class stored in the following directory.</p>
<div class="figure">
<img alt="../_images/image064.png" src="../_images/image064.png" />
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.domain.service.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.UUID</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.exception.BusinessException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.exception.ResourceNotFoundException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessage</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessages</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">todo.domain.model.Todo</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">todo.domain.repository.todo.TodoRepository</span><span class="p">;</span>

<span class="hll"><span class="nd">@Service</span><span class="c1">// (1)</span>
</span><span class="hll"><span class="nd">@Transactional</span> <span class="c1">// (2)</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoServiceImpl</span> <span class="kd">implements</span> <span class="n">TodoService</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">MAX_UNFINISHED_COUNT</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

<span class="hll">    <span class="nd">@Inject</span><span class="c1">// (3)</span>
</span><span class="hll">    <span class="n">TodoRepository</span> <span class="n">todoRepository</span><span class="p">;</span>
</span>
<span class="hll">    <span class="c1">// (4)</span>
</span><span class="hll">    <span class="kd">public</span> <span class="n">Todo</span> <span class="nf">findOne</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="p">{</span>
</span>        <span class="n">Todo</span> <span class="n">todo</span> <span class="o">=</span> <span class="n">todoRepository</span><span class="p">.</span><span class="na">findOne</span><span class="p">(</span><span class="n">todoId</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">todo</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">            <span class="c1">// (5)</span>
</span><span class="hll">            <span class="n">ResultMessages</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">ResultMessages</span><span class="p">.</span><span class="na">error</span><span class="p">();</span>
</span>            <span class="n">messages</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">ResultMessage</span>
                    <span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;[E404] The requested Todo is not found. (id=&quot;</span>
                            <span class="o">+</span> <span class="n">todoId</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">));</span>
<span class="hll">            <span class="c1">// (6)</span>
</span><span class="hll">            <span class="k">throw</span> <span class="k">new</span> <span class="n">ResourceNotFoundException</span><span class="p">(</span><span class="n">messages</span><span class="p">);</span>
</span>        <span class="p">}</span>
        <span class="k">return</span> <span class="n">todo</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
<span class="hll">    <span class="nd">@Transactional</span><span class="p">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="p">)</span> <span class="c1">// (7)</span>
</span>    <span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">todoRepository</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Todo</span> <span class="nf">create</span><span class="p">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">long</span> <span class="n">unfinishedCount</span> <span class="o">=</span> <span class="n">todoRepository</span><span class="p">.</span><span class="na">countByFinished</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">unfinishedCount</span> <span class="o">&gt;=</span> <span class="n">MAX_UNFINISHED_COUNT</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">ResultMessages</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">ResultMessages</span><span class="p">.</span><span class="na">error</span><span class="p">();</span>
            <span class="n">messages</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">ResultMessage</span>
                    <span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;[E001] The count of un-finished Todo must not be over &quot;</span>
                            <span class="o">+</span> <span class="n">MAX_UNFINISHED_COUNT</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span><span class="p">));</span>
<span class="hll">            <span class="c1">// (8)</span>
</span><span class="hll">            <span class="k">throw</span> <span class="k">new</span> <span class="n">BusinessException</span><span class="p">(</span><span class="n">messages</span><span class="p">);</span>
</span>        <span class="p">}</span>

<span class="hll">        <span class="c1">// (9)</span>
</span><span class="hll">        <span class="n">String</span> <span class="n">todoId</span> <span class="o">=</span> <span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span>
</span>        <span class="n">Date</span> <span class="n">createdAt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="p">();</span>

        <span class="n">todo</span><span class="p">.</span><span class="na">setTodoId</span><span class="p">(</span><span class="n">todoId</span><span class="p">);</span>
        <span class="n">todo</span><span class="p">.</span><span class="na">setCreatedAt</span><span class="p">(</span><span class="n">createdAt</span><span class="p">);</span>
        <span class="n">todo</span><span class="p">.</span><span class="na">setFinished</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

        <span class="n">todoRepository</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
        <span class="cm">/* REMOVE THIS LINE IF YOU USE JPA</span>
<span class="hll"><span class="cm">            todoRepository.save(todo); // 10</span>
</span><span class="cm">           REMOVE THIS LINE IF YOU USE JPA */</span>

        <span class="k">return</span> <span class="n">todo</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Todo</span> <span class="nf">finish</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Todo</span> <span class="n">todo</span> <span class="o">=</span> <span class="n">findOne</span><span class="p">(</span><span class="n">todoId</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">todo</span><span class="p">.</span><span class="na">isFinished</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">ResultMessages</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">ResultMessages</span><span class="p">.</span><span class="na">error</span><span class="p">();</span>
            <span class="n">messages</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">ResultMessage</span>
                    <span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;[E002] The requested Todo is already finished. (id=&quot;</span>
                            <span class="o">+</span> <span class="n">todoId</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">));</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">BusinessException</span><span class="p">(</span><span class="n">messages</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">todo</span><span class="p">.</span><span class="na">setFinished</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="n">todoRepository</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
        <span class="cm">/* REMOVE THIS LINE IF YOU USE JPA</span>
<span class="hll"><span class="cm">            todoRepository.save(todo); // (11)</span>
</span><span class="cm">           REMOVE THIS LINE IF YOU USE JPA */</span>
        <span class="k">return</span> <span class="n">todo</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Todo</span> <span class="n">todo</span> <span class="o">=</span> <span class="n">findOne</span><span class="p">(</span><span class="n">todoId</span><span class="p">);</span>
        <span class="n">todoRepository</span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">To consider Service as component-scan target, add <code class="docutils literal"><span class="pre">&#64;Service</span></code> annotation at class level.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">All public methods will be treated as transaction management by attaching the <code class="docutils literal"><span class="pre">&#64;Transactional</span></code> annotation at class level.</div>
<div class="line">By applying annotation, the transaction starts at the timing of method execution starts and transaction commits at the time of method execution successful completion.</div>
<div class="line">However, if unexpected exception occurs in between, the transaction roll-backs.</div>
<div class="line"><br /></div>
<div class="line">If database is not used, <code class="docutils literal"><span class="pre">&#64;Transactional</span></code> annotation is not required.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Inject <code class="docutils literal"><span class="pre">TodoRepository</span></code> implementation using <code class="docutils literal"><span class="pre">&#64;Inject</span></code> annotation.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Logic of fetching single record is used in both delete and finish methods. Hence it should be implemented in a method (OK to make it public by declaring in the interface).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use <code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.message.ResultMessage</span></code> provided in common library, as a class that stores result messages.</div>
<div class="line">Currently, for throwing error message, <code class="docutils literal"><span class="pre">ResultMessage</span></code> is added by specifying message type using <code class="docutils literal"><span class="pre">ResultMessages.error()</span></code> .</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When targeted data not found, <code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.exception.ResourceNotFoundException</span></code> provided in common library is thrown.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Regarding the reading process only, put <code class="docutils literal"><span class="pre">readOnly=true</span></code> .</div>
<div class="line">By this settings, the optimization of transaction control is done while reading process depending upon the O/R Mapper (Not effective in case of JPA used).</div>
<div class="line"><br /></div>
<div class="line">If database is not used, <code class="docutils literal"><span class="pre">&#64;Transactional</span></code> annotation is not required.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When business error occurs, <code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.exception.BusinessException</span></code> provided in common library is thrown.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">UUID is used to generate a unique value. DB sequence may be used.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">If database is accessed using Spring Data JPA, instead of <code class="docutils literal"><span class="pre">create</span></code> method, call <code class="docutils literal"><span class="pre">save</span></code> method.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(11)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">If database is accessed using Spring Data JPA, instead of <code class="docutils literal"><span class="pre">update</span></code> method, call <code class="docutils literal"><span class="pre">save</span></code> method.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In this chapter, error messages are hard coded for simplification, but in reality it is not preferred from maintenance viewpoint.
Usually, it is recommended to create message externally in property file.
The method for creating the external property file is described in <a class="reference internal" href="../ArchitectureInDetail/GeneralFuncDetail/PropertyManagement.html"><span class="doc">Properties Management</span></a>.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="creation-of-junit-for-service">
<h4><a class="toc-backref" href="#id38">10.1.4.1.5. Creation of JUnit for Service</a><a class="headerlink" href="#creation-of-junit-for-service" title="Permalink to this headline">¶</a></h4>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p><strong>TBD</strong></p>
<p class="last">For information about how to Unit test the service, planned to be described in next version later.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="creation-of-application-layer">
<h3><a class="toc-backref" href="#id39">10.1.4.2. Creation of application layer</a><a class="headerlink" href="#creation-of-application-layer" title="Permalink to this headline">¶</a></h3>
<p>Since domain layer implementation is completed, use the domain layer to create application layer.</p>
<div class="section" id="creation-of-controller">
<h4><a class="toc-backref" href="#id40">10.1.4.2.1. Creation of Controller</a><a class="headerlink" href="#creation-of-controller" title="Permalink to this headline">¶</a></h4>
<p>First create Controller that controls screen transition of todo business application.</p>
<p>Right click on the Package Explorer, select -&gt; [New] -&gt; [Class] -&gt; [New Java Class] dialog box appears,</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="11%" />
<col width="33%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Item</th>
<th class="head">Input value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Package</td>
<td><code class="docutils literal"><span class="pre">todo.app.todo</span></code></td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Name</td>
<td><code class="docutils literal"><span class="pre">TodoController</span></code></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and click [Finish] after entering above information.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>It should be noted that the higher level package is different from the domain layer.</strong></p>
</div>
<p>Created class stored in the following directory.</p>
<div class="figure">
<img alt="../_images/image065.png" src="../_images/image065.png" />
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.app.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>

<span class="hll"><span class="nd">@Controller</span> <span class="c1">// (1)</span>
</span><span class="hll"><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;todo&quot;</span><span class="p">)</span> <span class="c1">// (2)</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoController</span> <span class="p">{</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In order to make Controller as component-scan target, add <code class="docutils literal"><span class="pre">&#64;Controller</span></code> annotation at class level.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In order to bring all screen transitions handled by <code class="docutils literal"><span class="pre">TodoController</span></code>, under <code class="docutils literal"><span class="pre">&lt;contextPath&gt;/todo</span></code>, set <code class="docutils literal"><span class="pre">&#64;RequestMapping(“todo”)</span></code> at class level.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="show-all-todo-implementation">
<h4><a class="toc-backref" href="#id41">10.1.4.2.2. Show all TODO implementation</a><a class="headerlink" href="#show-all-todo-implementation" title="Permalink to this headline">¶</a></h4>
<p>Perform below in screen that are created in this tutorial.</p>
<ul class="simple">
<li>Display new form</li>
<li>Display all records of TODO</li>
</ul>
<div class="section" id="form-creation">
<h5>10.1.4.2.2.1. Form creation<a class="headerlink" href="#form-creation" title="Permalink to this headline">¶</a></h5>
<p>Create Form class (JavaBean).</p>
<p>Right click on the Package Explorer, select -&gt; [New] -&gt; [Class] -&gt; [New Java Class] dialog box appears,</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="11%" />
<col width="33%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Item</th>
<th class="head">Input value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Package</td>
<td><code class="docutils literal"><span class="pre">todo.app.todo</span></code></td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Name</td>
<td><code class="docutils literal"><span class="pre">TodoForm</span></code></td>
</tr>
<tr class="row-even"><td>3</td>
<td>Interfaces</td>
<td><code class="docutils literal"><span class="pre">java.io.Serializable</span></code></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and click [Finish] after entering above information.</p>
<p>Created class stored in the following directory.</p>
<div class="figure">
<img alt="../_images/image066.png" src="../_images/image066.png" />
</div>
<p>Add following property in the created class.</p>
<ul class="simple">
<li>Title = todoTitle</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.app.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoForm</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">todoTitle</span><span class="p">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTodoTitle</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">todoTitle</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTodoTitle</span><span class="p">(</span><span class="n">String</span> <span class="n">todoTitle</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">todoTitle</span> <span class="o">=</span> <span class="n">todoTitle</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="implementation-of-controller">
<h5>10.1.4.2.2.2. Implementation of Controller<a class="headerlink" href="#implementation-of-controller" title="Permalink to this headline">¶</a></h5>
<p>Add list screen display into <code class="docutils literal"><span class="pre">TodoController</span></code>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.app.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">todo.domain.model.Todo</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">todo.domain.service.todo.TodoService</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;todo&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoController</span> <span class="p">{</span>
<span class="hll">    <span class="nd">@Inject</span> <span class="c1">// (1)</span>
</span><span class="hll">    <span class="n">TodoService</span> <span class="n">todoService</span><span class="p">;</span>
</span>
<span class="hll">    <span class="nd">@ModelAttribute</span> <span class="c1">// (2)</span>
</span><span class="hll">    <span class="kd">public</span> <span class="n">TodoForm</span> <span class="nf">setUpForm</span><span class="p">()</span> <span class="p">{</span>
</span>        <span class="n">TodoForm</span> <span class="n">form</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TodoForm</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">form</span><span class="p">;</span>
    <span class="p">}</span>

<span class="hll">    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;list&quot;</span><span class="p">)</span> <span class="c1">// (3)</span>
</span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">list</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">todos</span> <span class="o">=</span> <span class="n">todoService</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
<span class="hll">        <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;todos&quot;</span><span class="p">,</span> <span class="n">todos</span><span class="p">);</span> <span class="c1">// (4)</span>
</span><span class="hll">        <span class="k">return</span> <span class="s">&quot;todo/list&quot;</span><span class="p">;</span> <span class="c1">// (5)</span>
</span>    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add <code class="docutils literal"><span class="pre">&#64;Inject</span></code> annotation for injecting <code class="docutils literal"><span class="pre">TodoService</span></code> using DI container.</div>
<div class="line"><br /></div>
<div class="line">Instance of type <code class="docutils literal"><span class="pre">TodoService</span></code> (instance  of <code class="docutils literal"><span class="pre">TodoServiceImpl</span></code>) managed by DI container is injected.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Initialize Form</div>
<div class="line"><br /></div>
<div class="line">By adding <code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code> annotation, form object of the return value of this method is added to <code class="docutils literal"><span class="pre">Model</span></code> with name <code class="docutils literal"><span class="pre">&quot;todoForm&quot;</span></code>.</div>
<div class="line">It is same as executing <code class="docutils literal"><span class="pre">model.addAttribute(&quot;todoForm&quot;,</span> <span class="pre">form)</span></code> in each method of <code class="docutils literal"><span class="pre">TodoController</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">set <code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code> annotation such a way that method of list screen display (<code class="docutils literal"><span class="pre">list</span></code> method) gets executed when it is requested to <code class="docutils literal"><span class="pre">/todo/list</span></code> path.</div>
<div class="line"><br /></div>
<div class="line">Since <code class="docutils literal"><span class="pre">&#64;RequestMapping(“todo”)</span></code> is being set at class level, only <code class="docutils literal"><span class="pre">&#64;RequestMapping(&quot;list&quot;)</span></code> is fine here.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add Todo list to <code class="docutils literal"><span class="pre">Model</span></code> and pass to View.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">If <code class="docutils literal"><span class="pre">&quot;todo/list&quot;</span></code> is returned as View name, <code class="file docutils literal"><span class="pre">WEB-INF/views/todo/list.jsp</span></code> will be rendered using <code class="docutils literal"><span class="pre">ViewResolver</span></code> defined in spring-mvc.xml.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="jsp-creation">
<h5>10.1.4.2.2.3. JSP creation<a class="headerlink" href="#jsp-creation" title="Permalink to this headline">¶</a></h5>
<p>Display Model passed from Controller by creating JSP.</p>
<p>Right click on the Package Explorer, select -&gt; [New] -&gt; [File] -&gt; [New File] dialog box appears,</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="11%" />
<col width="33%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Item</th>
<th class="head">Input value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Enter or select the parent folder</td>
<td><code class="docutils literal"><span class="pre">todo/src/main/webapp/WEB-INF/views/todo</span></code></td>
</tr>
<tr class="row-odd"><td>2</td>
<td>File name</td>
<td><code class="docutils literal"><span class="pre">list.jsp</span></code></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and click [Finish] after entering above information.</p>
<p>Created file stored in the following directory.</p>
<div class="figure">
<img alt="../_images/create-list-jsp.png" src="../_images/create-list-jsp.png" />
</div>
<p>First, implement necessary JSP for following display.</p>
<ul class="simple">
<li>Input form of TODO</li>
<li>[Create Todo] button</li>
<li>List display area of TODO</li>
</ul>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>Todo List<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;style</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
.strike {
    text-decoration: line-through;
}
<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Todo List<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;todoForm&quot;</span><span class="nt">&gt;</span>
<span class="hll">        <span class="c">&lt;!-- (1) --&gt;</span>
</span>        <span class="nt">&lt;form:form</span>
           <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/todo/create&quot;</span>
            <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">modelAttribute=</span><span class="s">&quot;todoForm&quot;</span><span class="nt">&gt;</span>
<span class="hll">            <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">            <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;todoTitle&quot;</span> <span class="nt">/&gt;</span>
</span>            <span class="nt">&lt;form:button&gt;</span>Create Todo<span class="nt">&lt;/form:button&gt;</span>
        <span class="nt">&lt;/form:form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;hr</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;todoList&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ul&gt;</span>
<span class="hll">            <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">            <span class="nt">&lt;c:forEach</span> <span class="na">items=</span><span class="s">&quot;${todos}&quot;</span> <span class="na">var=</span><span class="s">&quot;todo&quot;</span><span class="nt">&gt;</span>
</span>                <span class="nt">&lt;li&gt;&lt;c:choose&gt;</span>
<span class="hll">                        <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">&quot;${todo.finished}&quot;</span><span class="nt">&gt;</span><span class="c">&lt;!-- (4) --&gt;</span>
</span>                            <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;strike&quot;</span><span class="nt">&gt;</span>
<span class="hll">                            <span class="c">&lt;!-- (5) --&gt;</span>
</span><span class="hll">                            ${f:h(todo.todoTitle)}
</span>                            <span class="nt">&lt;/span&gt;</span>
                        <span class="nt">&lt;/c:when&gt;</span>
                        <span class="nt">&lt;c:otherwise&gt;</span>
                            ${f:h(todo.todoTitle)}
                         <span class="nt">&lt;/c:otherwise&gt;</span>
                    <span class="nt">&lt;/c:choose&gt;&lt;/li&gt;</span>
            <span class="nt">&lt;/c:forEach&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Display the form of new creation process.</div>
<div class="line">The <code class="docutils literal"><span class="pre">&lt;form:form&gt;</span></code> tag is used for displaying form.</div>
<div class="line">Specify name of the form object added to <code class="docutils literal"><span class="pre">Model</span></code> by Controller in <code class="docutils literal"><span class="pre">modelAttribute</span></code> attribute.</div>
<div class="line">Specify URL(<code class="docutils literal"><span class="pre">&lt;contextPath&gt;/todo/create</span></code>) into <code class="docutils literal"><span class="pre">action</span></code> attribute for running the new creation process.</div>
<div class="line">Since the new creation process is a process of updation, specify the <code class="docutils literal"><span class="pre">POST</span></code> method into the <code class="docutils literal"><span class="pre">method</span></code> attribute.</div>
<div class="line"><br /></div>
<div class="line">&lt;contextPath&gt; to be specified in <code class="docutils literal"><span class="pre">action</span></code> attribute can be fetched by <code class="docutils literal"><span class="pre">${pageContext.request.contextPath}</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Bind form property using <code class="docutils literal"><span class="pre">&lt;form:input&gt;</span></code> tag.</div>
<div class="line">Property name of form which is specified in <code class="docutils literal"><span class="pre">modelAttribute</span></code> attribute should match with the value of <code class="docutils literal"><span class="pre">path</span></code> attribute.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Display entire list of Todo using <code class="docutils literal"><span class="pre">&lt;c:forEach&gt;</span></code> tag.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Determine whether to decorate text using strike through(<code class="docutils literal"><span class="pre">text-decoration:</span> <span class="pre">line-through;</span></code>) to display, if it is completed (<code class="docutils literal"><span class="pre">finished</span></code>).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><strong>To take XSS countermeasures at the time of output of character string, HTML escape should be performed using f:h() function.</strong></div>
<div class="line">Regarding XSS measures, refer to <a class="reference internal" href="../Security/XSS.html"><span class="doc">XSS Countermeasures</span></a>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Right click [todo] project in STS and start Web application by [Run As] -&gt; [Run on Server].
If <a class="reference external" href="http://localhost:8080/todo/todo/list">http://localhost:8080/todo/todo/list</a> is accessed in browser, the following screen gets displayed.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image067.png"><img alt="../_images/image067.png" src="../_images/image067.png" style="width: 50%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h4><a class="toc-backref" href="#id42">10.1.4.2.3. Create TODO</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>Next, implement a new creation logic after clicking  [Create TODO] button on List display screen.</p>
<div class="section" id="modifications-in-controller">
<h5>10.1.4.2.3.1. Modifications in Controller<a class="headerlink" href="#modifications-in-controller" title="Permalink to this headline">¶</a></h5>
<p>Add new creation process into <code class="docutils literal"><span class="pre">TodoController</span></code>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.app.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.Valid</span><span class="p">;</span>

<span class="hll"><span class="kn">import</span> <span class="nn">org.dozer.Mapper</span><span class="p">;</span>
</span><span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.mvc.support.RedirectAttributes</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.exception.BusinessException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessage</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessages</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">todo.domain.model.Todo</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">todo.domain.service.todo.TodoService</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;todo&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoController</span> <span class="p">{</span>
    <span class="nd">@Inject</span>
    <span class="n">TodoService</span> <span class="n">todoService</span><span class="p">;</span>

<span class="hll">    <span class="c1">// (1)</span>
</span><span class="hll">    <span class="nd">@Inject</span>
</span><span class="hll">    <span class="n">Mapper</span> <span class="n">beanMapper</span><span class="p">;</span>
</span>
    <span class="nd">@ModelAttribute</span>
    <span class="kd">public</span> <span class="n">TodoForm</span> <span class="nf">setUpForm</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">TodoForm</span> <span class="n">form</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TodoForm</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">form</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;list&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">list</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">todos</span> <span class="o">=</span> <span class="n">todoService</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
        <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;todos&quot;</span><span class="p">,</span> <span class="n">todos</span><span class="p">);</span>
        <span class="k">return</span> <span class="s">&quot;todo/list&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="hll">    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span> <span class="c1">// (2)</span>
</span><span class="hll">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">create</span><span class="p">(</span><span class="nd">@Valid</span> <span class="n">TodoForm</span> <span class="n">todoForm</span><span class="p">,</span> <span class="n">BindingResult</span> <span class="n">bindingResult</span><span class="p">,</span> <span class="c1">// (3)</span>
</span><span class="hll">            <span class="n">Model</span> <span class="n">model</span><span class="p">,</span> <span class="n">RedirectAttributes</span> <span class="n">attributes</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// (4)</span>
</span><span class="hll">
</span><span class="hll">        <span class="c1">// (5)</span>
</span><span class="hll">        <span class="k">if</span> <span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
</span><span class="hll">            <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
</span><span class="hll">        <span class="p">}</span>
</span><span class="hll">
</span><span class="hll">        <span class="c1">// (6)</span>
</span><span class="hll">        <span class="n">Todo</span> <span class="n">todo</span> <span class="o">=</span> <span class="n">beanMapper</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">todoForm</span><span class="p">,</span> <span class="n">Todo</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span class="hll">
</span><span class="hll">        <span class="k">try</span> <span class="p">{</span>
</span><span class="hll">            <span class="n">todoService</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
</span><span class="hll">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">BusinessException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">            <span class="c1">// (7)</span>
</span><span class="hll">            <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getResultMessages</span><span class="p">());</span>
</span><span class="hll">            <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
</span><span class="hll">        <span class="p">}</span>
</span><span class="hll">
</span><span class="hll">        <span class="c1">// (8)</span>
</span><span class="hll">        <span class="n">attributes</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="n">ResultMessages</span><span class="p">.</span><span class="na">success</span><span class="p">().</span><span class="na">add</span><span class="p">(</span>
</span><span class="hll">                <span class="n">ResultMessage</span><span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;Created successfully!&quot;</span><span class="p">)));</span>
</span><span class="hll">        <span class="k">return</span> <span class="s">&quot;redirect:/todo/list&quot;</span><span class="p">;</span>
</span><span class="hll">    <span class="p">}</span>
</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">At the time of converting form object into domain object. Inject the <code class="docutils literal"><span class="pre">Mapper</span></code> interface of Dozer.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set <code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code> annotation such a way that method of new creation process (<code class="docutils literal"><span class="pre">create</span></code> method) gets executed when it is requested to <code class="docutils literal"><span class="pre">/todo/create</span></code> path using <code class="docutils literal"><span class="pre">POST</span></code> method.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">For performing input validation of form, add <code class="docutils literal"><span class="pre">&#64;Valid</span></code> annotation to form argument. Input validation result is stored in the immediate next argument <code class="docutils literal"><span class="pre">BindingResult</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Display the list screen by redirecting after successful completion.</div>
<div class="line">Add <code class="docutils literal"><span class="pre">RedirectAttributes</span></code> into argument for storing the information to be redirected.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Return to list screen in case of input error.</div>
<div class="line">Re-execute <code class="docutils literal"><span class="pre">list</span></code> method as it is necessary to fetch all records of Todo again.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create <code class="docutils literal"><span class="pre">Todo</span></code> object from <code class="docutils literal"><span class="pre">TodoForm</span></code> object using <code class="docutils literal"><span class="pre">Mapper</span></code> interface of Dozer.</div>
<div class="line">No need to set if the property name of conversion source and destination is the same.</div>
<div class="line">There is no merit in using <code class="docutils literal"><span class="pre">Mapper</span></code> interface of Dozer to convert only <code class="docutils literal"><span class="pre">todoTitle</span></code> property, but it is very convenient in case of multiple properties.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In case of <code class="docutils literal"><span class="pre">BusinessException</span></code>  while executing business logic, add the result message to <code class="docutils literal"><span class="pre">Model</span></code> and return to list screen.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Since it is created successfully, add the result message to flash scope and redirect to list screen.</div>
<div class="line">Since redirect is used, there is no case of browser being read again and a new registration process being <code class="docutils literal"><span class="pre">POST</span></code>. (For details, refer to “<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/DoubleSubmitProtection.html#doublesubmitprotectionaboutprg"><span class="std std-ref">About PRG (Post-Redirect-Get) pattern</span></a>”)</div>
<div class="line">Since this time Created successfully message is displayed, <code class="docutils literal"><span class="pre">ResultMessages.success()</span></code> is used.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="modifications-in-form">
<h5>10.1.4.2.3.2. Modifications in Form<a class="headerlink" href="#modifications-in-form" title="Permalink to this headline">¶</a></h5>
<p>To define input validation rules, add annotation to the form object.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.app.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="p">;</span>

<span class="hll"><span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="p">;</span>
</span><span class="hll"><span class="kn">import</span> <span class="nn">javax.validation.constraints.Size</span><span class="p">;</span>
</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoForm</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="p">;</span>

<span class="hll">    <span class="nd">@NotNull</span> <span class="c1">// (1)</span>
</span><span class="hll">    <span class="nd">@Size</span><span class="p">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span> <span class="c1">// (2)</span>
</span>    <span class="kd">private</span> <span class="n">String</span> <span class="n">todoTitle</span><span class="p">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTodoTitle</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">todoTitle</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTodoTitle</span><span class="p">(</span><span class="n">String</span> <span class="n">todoTitle</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">todoTitle</span> <span class="o">=</span> <span class="n">todoTitle</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Enable mandatory check using <code class="docutils literal"><span class="pre">&#64;NotNull</span></code> annotation.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Enable string length check using <code class="docutils literal"><span class="pre">&#64;Size</span></code> annotation.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="modifications-in-jsp">
<h5>10.1.4.2.3.3. Modifications in JSP<a class="headerlink" href="#modifications-in-jsp" title="Permalink to this headline">¶</a></h5>
<p>Add the tag for displaying the result message and input check error.</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>Todo List<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;style</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
.strike {
    text-decoration: line-through;
}
<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Todo List<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;todoForm&quot;</span><span class="nt">&gt;</span>
<span class="hll">        <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;t:messagesPanel</span> <span class="nt">/&gt;</span>
</span>
        <span class="nt">&lt;form:form</span>
           <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/todo/create&quot;</span>
            <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">modelAttribute=</span><span class="s">&quot;todoForm&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;todoTitle&quot;</span> <span class="nt">/&gt;</span>
<span class="hll">            <span class="nt">&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;todoTitle&quot;</span> <span class="nt">/&gt;</span><span class="c">&lt;!-- (2) --&gt;</span>
</span>            <span class="nt">&lt;form:button&gt;</span>Create Todo<span class="nt">&lt;/form:button&gt;</span>
        <span class="nt">&lt;/form:form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;hr</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;todoList&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ul&gt;</span>
            <span class="nt">&lt;c:forEach</span> <span class="na">items=</span><span class="s">&quot;${todos}&quot;</span> <span class="na">var=</span><span class="s">&quot;todo&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;li&gt;&lt;c:choose&gt;</span>
                        <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">&quot;${todo.finished}&quot;</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">&quot;text-decoration: line-through;&quot;</span><span class="nt">&gt;</span>
                            ${f:h(todo.todoTitle)}
                            <span class="nt">&lt;/span&gt;</span>
                        <span class="nt">&lt;/c:when&gt;</span>
                        <span class="nt">&lt;c:otherwise&gt;</span>
                            ${f:h(todo.todoTitle)}
                         <span class="nt">&lt;/c:otherwise&gt;</span>
                    <span class="nt">&lt;/c:choose&gt;&lt;/li&gt;</span>
            <span class="nt">&lt;/c:forEach&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Display result message using <code class="docutils literal"><span class="pre">&lt;t:messagesPanel&gt;</span></code> tag.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Display errors in case of input error using <code class="docutils literal"><span class="pre">&lt;form:errors&gt;</span></code> tag. Match the value of <code class="docutils literal"><span class="pre">path</span></code> attribute with <code class="docutils literal"><span class="pre">&lt;form:input&gt;</span></code> tag.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>If form is submitted by entering appropriate value in the form, success message is displayed as given below.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image068.png"><img alt="../_images/image068.png" src="../_images/image068.png" style="width: 40%;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image069.png"><img alt="../_images/image069.png" src="../_images/image069.png" style="width: 40%;" /></a>
</div>
<p>When 6 or more records are registered and business error occurs, error message is displayed.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image070.png"><img alt="../_images/image070.png" src="../_images/image070.png" style="width: 60%;" /></a>
</div>
<p>If form is submitted by entering null character, the following error message is displayed.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image071.png"><img alt="../_images/image071.png" src="../_images/image071.png" style="width: 65%;" /></a>
</div>
</div>
<div class="section" id="customize-message-display">
<h5>10.1.4.2.3.4. Customize message display<a class="headerlink" href="#customize-message-display" title="Permalink to this headline">¶</a></h5>
<p>If <code class="docutils literal"><span class="pre">&lt;t:messagesPanel&gt;</span></code> is used, following is the HTML output.</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-success&quot;</span><span class="p">&gt;&lt;</span><span class="nt">ul</span><span class="p">&gt;&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Created successfully!<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;&lt;/</span><span class="nt">ul</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>With the following modifications in style sheet (in <code class="docutils literal"><span class="pre">&lt;style&gt;</span></code> tag of <code class="docutils literal"><span class="pre">list.jsp</span></code>), customize appearance of the result message.</p>
<div class="highlight-css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">alert</span> <span class="p">{</span>
    <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">alert-error</span> <span class="p">{</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="mh">#c60f13</span><span class="p">;</span>
    <span class="k">border-color</span><span class="p">:</span> <span class="mh">#970b0e</span><span class="p">;</span>
    <span class="k">color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">alert-success</span> <span class="p">{</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="mh">#5da423</span><span class="p">;</span>
    <span class="k">border-color</span><span class="p">:</span> <span class="mh">#457a1a</span><span class="p">;</span>
    <span class="k">color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The message is as follows.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image072.png"><img alt="../_images/image072.png" src="../_images/image072.png" style="width: 40%;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image073.png"><img alt="../_images/image073.png" src="../_images/image073.png" style="width: 60%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Moreover, input error message class can be specified to <code class="docutils literal"><span class="pre">cssClass</span></code> attribute of <code class="docutils literal"><span class="pre">&lt;form:errors&gt;</span></code> tag.</p>
<p>Modify JSP as follows,</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="nt">&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;todoTitle&quot;</span> <span class="na">cssClass=</span><span class="s">&quot;text-error&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>and add the following to style sheet.</p>
<div class="highlight-css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">text-error</span> <span class="p">{</span>
    <span class="k">color</span><span class="p">:</span> <span class="mh">#c60f13</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Input error message is as follows.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image074.png"><img alt="../_images/image074.png" src="../_images/image074.png" style="width: 65%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id2">
<h4><a class="toc-backref" href="#id43">10.1.4.2.4. Finish TODO</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>Add [Finish] button to List display screen and add completion process of TODO.</p>
<div class="section" id="id3">
<h5>10.1.4.2.4.1. Modifications in Form<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
<p>About the completion Form, same <code class="docutils literal"><span class="pre">TodoForm</span></code> is used.</p>
<p>The <code class="docutils literal"><span class="pre">todoId</span></code> property needs to be added to <code class="docutils literal"><span class="pre">TodoForm</span></code> but if simply added, <code class="docutils literal"><span class="pre">todoId</span></code> property check rules for new creation are applied as it is.
For specifying separate rules for new creation and completion in a single Form, set <code class="docutils literal"><span class="pre">groups</span></code> attribute and perform input check rule group.</p>
<p>Add below property in Form class.</p>
<ul class="simple">
<li>ID → todoId</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.app.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.constraints.Size</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoForm</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>
<span class="hll">    <span class="c1">// (1)</span>
</span><span class="hll">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">TodoCreate</span> <span class="p">{</span>
</span><span class="hll">    <span class="p">};</span>
</span>
<span class="hll">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">TodoFinish</span> <span class="p">{</span>
</span><span class="hll">    <span class="p">};</span>
</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="p">;</span>

<span class="hll">    <span class="c1">// (2)</span>
</span><span class="hll">    <span class="nd">@NotNull</span><span class="p">(</span><span class="n">groups</span> <span class="o">=</span> <span class="p">{</span> <span class="n">TodoFinish</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span>
</span><span class="hll">    <span class="kd">private</span> <span class="n">String</span> <span class="n">todoId</span><span class="p">;</span>
</span>
<span class="hll">    <span class="c1">// (3)</span>
</span><span class="hll">    <span class="nd">@NotNull</span><span class="p">(</span><span class="n">groups</span> <span class="o">=</span> <span class="p">{</span> <span class="n">TodoCreate</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span>
</span><span class="hll">    <span class="nd">@Size</span><span class="p">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="p">{</span> <span class="n">TodoCreate</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span>
</span>    <span class="kd">private</span> <span class="n">String</span> <span class="n">todoTitle</span><span class="p">;</span>

<span class="hll">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTodoId</span><span class="p">()</span> <span class="p">{</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">todoId</span><span class="p">;</span>
</span><span class="hll">    <span class="p">}</span>
</span>
<span class="hll">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTodoId</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">        <span class="k">this</span><span class="p">.</span><span class="na">todoId</span> <span class="o">=</span> <span class="n">todoId</span><span class="p">;</span>
</span><span class="hll">    <span class="p">}</span>
</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTodoTitle</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">todoTitle</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTodoTitle</span><span class="p">(</span><span class="n">String</span> <span class="n">todoTitle</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">todoTitle</span> <span class="o">=</span> <span class="n">todoTitle</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create an interface for grouping the input check rules.</div>
<div class="line">For grouping the input check rules, Refer <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Validation.html"><span class="doc">Input Validation</span></a>.</div>
<div class="line"><br /></div>
<div class="line">However as a new creation prcess <code class="docutils literal"><span class="pre">TodoCreate</span></code> interface and as a completion process <code class="docutils literal"><span class="pre">TodoFinish</span></code> interface is created.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">todoId</span></code> is a property for completion process.</div>
<div class="line">Therefore in <code class="docutils literal"><span class="pre">groups</span></code> attribute of <code class="docutils literal"><span class="pre">&#64;NotNull</span></code> annotation, the <code class="docutils literal"><span class="pre">TodoFinish</span></code> interface is specified for indicating input check rule of completion process.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">todoTitle</span></code> is a property for new creation process.</div>
<div class="line">Therefore in <code class="docutils literal"><span class="pre">groups</span></code> attribute of <code class="docutils literal"><span class="pre">&#64;NotNull</span></code> annotation and <code class="docutils literal"><span class="pre">&#64;Size</span></code> annotation, the <code class="docutils literal"><span class="pre">TodoCreate</span></code> interface is specified for indicating input check rule of new creation process.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id4">
<h5>10.1.4.2.4.2. Modifications in Controller<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
<p>Add completion process logic to <code class="docutils literal"><span class="pre">TodoController</span></code>.</p>
<p>Take precaution of <strong>using &#64;Validated instead of &#64;Valid</strong> for executing the group validation.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.app.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="p">;</span>
<span class="hll"><span class="kn">import</span> <span class="nn">javax.validation.groups.Default</span><span class="p">;</span>
</span>
<span class="kn">import</span> <span class="nn">org.dozer.Mapper</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="p">;</span>
<span class="hll"><span class="kn">import</span> <span class="nn">org.springframework.validation.annotation.Validated</span><span class="p">;</span>
</span><span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.mvc.support.RedirectAttributes</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.exception.BusinessException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessage</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessages</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">todo.app.todo.TodoForm.TodoCreate</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">todo.app.todo.TodoForm.TodoFinish</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">todo.domain.model.Todo</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">todo.domain.service.todo.TodoService</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;todo&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoController</span> <span class="p">{</span>
    <span class="nd">@Inject</span>
    <span class="n">TodoService</span> <span class="n">todoService</span><span class="p">;</span>

    <span class="nd">@Inject</span>
    <span class="n">Mapper</span> <span class="n">beanMapper</span><span class="p">;</span>

    <span class="nd">@ModelAttribute</span>
    <span class="kd">public</span> <span class="n">TodoForm</span> <span class="nf">setUpForm</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">TodoForm</span> <span class="n">form</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TodoForm</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">form</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;list&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">list</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">todos</span> <span class="o">=</span> <span class="n">todoService</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
        <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;todos&quot;</span><span class="p">,</span> <span class="n">todos</span><span class="p">);</span>
        <span class="k">return</span> <span class="s">&quot;todo/list&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">create</span><span class="p">(</span>
<span class="hll">            <span class="nd">@Validated</span><span class="p">({</span> <span class="n">Default</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">TodoCreate</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span> <span class="n">TodoForm</span> <span class="n">todoForm</span><span class="p">,</span> <span class="c1">// (1)</span>
</span>            <span class="n">BindingResult</span> <span class="n">bindingResult</span><span class="p">,</span> <span class="n">Model</span> <span class="n">model</span><span class="p">,</span>
            <span class="n">RedirectAttributes</span> <span class="n">attributes</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">Todo</span> <span class="n">todo</span> <span class="o">=</span> <span class="n">beanMapper</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">todoForm</span><span class="p">,</span> <span class="n">Todo</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

        <span class="k">try</span> <span class="p">{</span>
            <span class="n">todoService</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">BusinessException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getResultMessages</span><span class="p">());</span>
            <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">attributes</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="n">ResultMessages</span><span class="p">.</span><span class="na">success</span><span class="p">().</span><span class="na">add</span><span class="p">(</span>
                <span class="n">ResultMessage</span><span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;Created successfully!&quot;</span><span class="p">)));</span>
        <span class="k">return</span> <span class="s">&quot;redirect:/todo/list&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="hll">    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;finish&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span> <span class="c1">// (2)</span>
</span><span class="hll">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">finish</span><span class="p">(</span>
</span><span class="hll">            <span class="nd">@Validated</span><span class="p">({</span> <span class="n">Default</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">TodoFinish</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span> <span class="n">TodoForm</span> <span class="n">form</span><span class="p">,</span> <span class="c1">// (3)</span>
</span><span class="hll">            <span class="n">BindingResult</span> <span class="n">bindingResult</span><span class="p">,</span> <span class="n">Model</span> <span class="n">model</span><span class="p">,</span>
</span><span class="hll">            <span class="n">RedirectAttributes</span> <span class="n">attributes</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">        <span class="c1">// (4)</span>
</span><span class="hll">        <span class="k">if</span> <span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
</span><span class="hll">            <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
</span><span class="hll">        <span class="p">}</span>
</span><span class="hll">
</span><span class="hll">        <span class="k">try</span> <span class="p">{</span>
</span><span class="hll">            <span class="n">todoService</span><span class="p">.</span><span class="na">finish</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getTodoId</span><span class="p">());</span>
</span><span class="hll">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">BusinessException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">            <span class="c1">// (5)</span>
</span><span class="hll">            <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getResultMessages</span><span class="p">());</span>
</span><span class="hll">            <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
</span><span class="hll">        <span class="p">}</span>
</span><span class="hll">
</span><span class="hll">        <span class="c1">// (6)</span>
</span><span class="hll">        <span class="n">attributes</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="n">ResultMessages</span><span class="p">.</span><span class="na">success</span><span class="p">().</span><span class="na">add</span><span class="p">(</span>
</span><span class="hll">                <span class="n">ResultMessage</span><span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;Finished successfully!&quot;</span><span class="p">)));</span>
</span><span class="hll">        <span class="k">return</span> <span class="s">&quot;redirect:/todo/list&quot;</span><span class="p">;</span>
</span><span class="hll">    <span class="p">}</span>
</span><span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">Change <code class="docutils literal"><span class="pre">&#64;Valid</span></code> to <code class="docutils literal"><span class="pre">&#64;Validated</span></code> for executing group validation.</div>
</div>
<div class="last line-block">
<div class="line">Group of input check rules (group interface) can be specified in <code class="docutils literal"><span class="pre">value</span></code> attribute.</div>
<div class="line"><code class="docutils literal"><span class="pre">Default.class</span></code> is a group interface provided to apply an input validation rules when group is not specified.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set <code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code> annotation such a way that method of completion process (<code class="docutils literal"><span class="pre">finish</span></code> method) gets executed when it is requested to <code class="docutils literal"><span class="pre">/todo/finish</span></code> path using <code class="docutils literal"><span class="pre">POST</span></code> method.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the group interface (<code class="docutils literal"><span class="pre">TodoFinish</span></code> interface) for Finish processing as group of input check.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In case of input error, return to list screen.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In case of <code class="docutils literal"><span class="pre">BusinessException</span></code>  while executing business logic, add the result message to <code class="docutils literal"><span class="pre">Model</span></code> and return to list screen.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Since it is created successfully, add the result message to flash scope and redirect to list screen.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Separate Form can also be created for Create and Finish.
In case of separate Form class, there is no need to group the input check rules therefore definition of input check rules will be simple.</p>
<p>However, as the number of Form class increase,</p>
<ul class="simple">
<li>The number of classes increases</li>
<li>Not possible to centrally manage the input check rules due to duplicate properties increases</li>
</ul>
<p>Therefore, please note that when the specifications changes, the modification cost will also be more.</p>
<p class="last">Moreover, if multiple Form objects are initialized by <code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code> method,
unnecessary instance gets generated because every time all Forms are being initialized.</p>
</div>
</div>
<div class="section" id="id5">
<h5>10.1.4.2.4.3. Modifications in JSP<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<p>Add completion process form.</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>Todo List<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;style</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
.strike {
    text-decoration: line-through;
}

.alert {
    border: 1px solid;
}

.alert-error {
    background-color: #c60f13;
    border-color: #970b0e;
    color: white;
}

.alert-success {
    background-color: #5da423;
    border-color: #457a1a;
    color: white;
}

.text-error {
    color: #c60f13;
}
<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Todo List<span class="nt">&lt;/h1&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;todoForm&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t:messagesPanel</span> <span class="nt">/&gt;</span>

        <span class="nt">&lt;form:form</span>
            <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/todo/create&quot;</span>
            <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">modelAttribute=</span><span class="s">&quot;todoForm&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;todoTitle&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;todoTitle&quot;</span> <span class="na">cssClass=</span><span class="s">&quot;text-error&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;form:button&gt;</span>Create Todo<span class="nt">&lt;/form:button&gt;</span>
        <span class="nt">&lt;/form:form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;hr</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;todoList&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ul&gt;</span>
            <span class="nt">&lt;c:forEach</span> <span class="na">items=</span><span class="s">&quot;${todos}&quot;</span> <span class="na">var=</span><span class="s">&quot;todo&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;li&gt;&lt;c:choose&gt;</span>
                        <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">&quot;${todo.finished}&quot;</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;strike&quot;</span><span class="nt">&gt;</span>${f:h(todo.todoTitle)}<span class="nt">&lt;/span&gt;</span>
                        <span class="nt">&lt;/c:when&gt;</span>
                        <span class="nt">&lt;c:otherwise&gt;</span>
                            ${f:h(todo.todoTitle)}
<span class="hll">                            <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;form:form</span>
</span><span class="hll">                                <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/todo/finish&quot;</span>
</span><span class="hll">                                <span class="na">method=</span><span class="s">&quot;post&quot;</span>
</span><span class="hll">                                <span class="na">modelAttribute=</span><span class="s">&quot;todoForm&quot;</span>
</span><span class="hll">                                <span class="na">cssStyle=</span><span class="s">&quot;display: inline-block;&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                                <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">                                <span class="nt">&lt;form:hidden</span> <span class="na">path=</span><span class="s">&quot;todoId&quot;</span>
</span><span class="hll">                                    <span class="na">value=</span><span class="s">&quot;${f:h(todo.todoId)}&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">                                <span class="nt">&lt;form:button&gt;</span>Finish<span class="nt">&lt;/form:button&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;/form:form&gt;</span>
</span>                        <span class="nt">&lt;/c:otherwise&gt;</span>
                    <span class="nt">&lt;/c:choose&gt;&lt;/li&gt;</span>
            <span class="nt">&lt;/c:forEach&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Display the form for sending the request to complete the TODO if there are incomplete Todo.</div>
<div class="line">Specify URL(<code class="docutils literal"><span class="pre">&lt;contextPath&gt;/todo/finish</span></code>) into <code class="docutils literal"><span class="pre">action</span></code> attribute for running the completion process.</div>
<div class="line">Since the completion process is a process of updating, specify the <code class="docutils literal"><span class="pre">POST</span></code> method into the <code class="docutils literal"><span class="pre">method</span></code> attribute.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Pass <code class="docutils literal"><span class="pre">todoId</span></code> as request parameter using <code class="docutils literal"><span class="pre">&lt;form:hidden&gt;</span></code> tag.</div>
<div class="line">Also while setting the value in <code class="docutils literal"><span class="pre">value</span></code> attribute, <strong>HTML escaping should always be performed using f:h() function.</strong></div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>When pressing the [Finish] button after newly creating Todo, strike-through is shown as below and it can be understood that the operation is completed.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image075.png"><img alt="../_images/image075.png" src="../_images/image075.png" style="width: 40%;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image076.png"><img alt="../_images/image076.png" src="../_images/image076.png" style="width: 40%;" /></a>
</div>
</div>
</div>
<div class="section" id="id6">
<h4><a class="toc-backref" href="#id44">10.1.4.2.5. Delete TODO</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>Add [Delete] button on the list display screen and add the deletion process for TODO removal.</p>
<div class="section" id="modification-in-form">
<h5>10.1.4.2.5.1. Modification in Form<a class="headerlink" href="#modification-in-form" title="Permalink to this headline">¶</a></h5>
<p>Create <code class="docutils literal"><span class="pre">TodoForm</span></code> for deletion form.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.app.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.constraints.Size</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoForm</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">TodoCreate</span> <span class="p">{</span>
    <span class="p">};</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">TodoFinish</span> <span class="p">{</span>
    <span class="p">};</span>

<span class="hll">    <span class="c1">// (1)</span>
</span><span class="hll">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">TodoDelete</span> <span class="p">{</span>
</span><span class="hll">    <span class="p">}</span>
</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="p">;</span>

<span class="hll">    <span class="c1">// (2)</span>
</span><span class="hll">    <span class="nd">@NotNull</span><span class="p">(</span><span class="n">groups</span> <span class="o">=</span> <span class="p">{</span> <span class="n">TodoFinish</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">TodoDelete</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span>
</span>    <span class="kd">private</span> <span class="n">String</span> <span class="n">todoId</span><span class="p">;</span>

    <span class="nd">@NotNull</span><span class="p">(</span><span class="n">groups</span> <span class="o">=</span> <span class="p">{</span> <span class="n">TodoCreate</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span>
    <span class="nd">@Size</span><span class="p">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="p">{</span> <span class="n">TodoCreate</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">todoTitle</span><span class="p">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTodoId</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">todoId</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTodoId</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">todoId</span> <span class="o">=</span> <span class="n">todoId</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTodoTitle</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">todoTitle</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTodoTitle</span><span class="p">(</span><span class="n">String</span> <span class="n">todoTitle</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">todoTitle</span> <span class="o">=</span> <span class="n">todoTitle</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create the <code class="docutils literal"><span class="pre">TodoDelete</span></code> interface for deletion processing as group of input check rule.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">todoId</span></code> property is used in deletion process.</div>
<div class="line">Therefore, in the <code class="docutils literal"><span class="pre">groups</span></code> attribute of <code class="docutils literal"><span class="pre">&#64;NotNull</span></code> annotation of <code class="docutils literal"><span class="pre">todoId</span></code>, specify the <code class="docutils literal"><span class="pre">TodoDelete</span></code> interface indicating that it is an input validation rules for the deletion process.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id7">
<h5>10.1.4.2.5.2. Modifications in Controller<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h5>
<p>Add the logic for delete processing to <code class="docutils literal"><span class="pre">TodoController</span></code>. It is almost same as the completion process.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.app.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.groups.Default</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.dozer.Mapper</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.annotation.Validated</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.mvc.support.RedirectAttributes</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.exception.BusinessException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessage</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessages</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">todo.app.todo.TodoForm.TodoDelete</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">todo.app.todo.TodoForm.TodoCreate</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">todo.app.todo.TodoForm.TodoFinish</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">todo.domain.model.Todo</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">todo.domain.service.todo.TodoService</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;todo&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoController</span> <span class="p">{</span>
    <span class="nd">@Inject</span>
    <span class="n">TodoService</span> <span class="n">todoService</span><span class="p">;</span>

    <span class="nd">@Inject</span>
    <span class="n">Mapper</span> <span class="n">beanMapper</span><span class="p">;</span>

    <span class="nd">@ModelAttribute</span>
    <span class="kd">public</span> <span class="n">TodoForm</span> <span class="nf">setUpForm</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">TodoForm</span> <span class="n">form</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TodoForm</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">form</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;list&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">list</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">todos</span> <span class="o">=</span> <span class="n">todoService</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
        <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;todos&quot;</span><span class="p">,</span> <span class="n">todos</span><span class="p">);</span>
        <span class="k">return</span> <span class="s">&quot;todo/list&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">create</span><span class="p">(</span>
            <span class="nd">@Validated</span><span class="p">({</span> <span class="n">Default</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">TodoCreate</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span> <span class="n">TodoForm</span> <span class="n">todoForm</span><span class="p">,</span>
            <span class="n">BindingResult</span> <span class="n">bindingResult</span><span class="p">,</span> <span class="n">Model</span> <span class="n">model</span><span class="p">,</span>
            <span class="n">RedirectAttributes</span> <span class="n">attributes</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">Todo</span> <span class="n">todo</span> <span class="o">=</span> <span class="n">beanMapper</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">todoForm</span><span class="p">,</span> <span class="n">Todo</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

        <span class="k">try</span> <span class="p">{</span>
            <span class="n">todoService</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">BusinessException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getResultMessages</span><span class="p">());</span>
            <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">attributes</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="n">ResultMessages</span><span class="p">.</span><span class="na">success</span><span class="p">().</span><span class="na">add</span><span class="p">(</span>
                <span class="n">ResultMessage</span><span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;Created successfully!&quot;</span><span class="p">)));</span>
        <span class="k">return</span> <span class="s">&quot;redirect:/todo/list&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;finish&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">finish</span><span class="p">(</span>
            <span class="nd">@Validated</span><span class="p">({</span> <span class="n">Default</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">TodoFinish</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span> <span class="n">TodoForm</span> <span class="n">form</span><span class="p">,</span>
            <span class="n">BindingResult</span> <span class="n">bindingResult</span><span class="p">,</span> <span class="n">Model</span> <span class="n">model</span><span class="p">,</span>
            <span class="n">RedirectAttributes</span> <span class="n">attributes</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">try</span> <span class="p">{</span>
            <span class="n">todoService</span><span class="p">.</span><span class="na">finish</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getTodoId</span><span class="p">());</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">BusinessException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getResultMessages</span><span class="p">());</span>
            <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">attributes</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="n">ResultMessages</span><span class="p">.</span><span class="na">success</span><span class="p">().</span><span class="na">add</span><span class="p">(</span>
                <span class="n">ResultMessage</span><span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;Finished successfully!&quot;</span><span class="p">)));</span>
        <span class="k">return</span> <span class="s">&quot;redirect:/todo/list&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="hll">    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;delete&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span> <span class="c1">// (1)</span>
</span><span class="hll">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">delete</span><span class="p">(</span>
</span><span class="hll">            <span class="nd">@Validated</span><span class="p">({</span> <span class="n">Default</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">TodoDelete</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span> <span class="n">TodoForm</span> <span class="n">form</span><span class="p">,</span>
</span><span class="hll">            <span class="n">BindingResult</span> <span class="n">bindingResult</span><span class="p">,</span> <span class="n">Model</span> <span class="n">model</span><span class="p">,</span>
</span><span class="hll">            <span class="n">RedirectAttributes</span> <span class="n">attributes</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">
</span><span class="hll">        <span class="k">if</span> <span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
</span><span class="hll">            <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
</span><span class="hll">        <span class="p">}</span>
</span><span class="hll">
</span><span class="hll">        <span class="k">try</span> <span class="p">{</span>
</span><span class="hll">            <span class="n">todoService</span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getTodoId</span><span class="p">());</span>
</span><span class="hll">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">BusinessException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">            <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getResultMessages</span><span class="p">());</span>
</span><span class="hll">            <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
</span><span class="hll">        <span class="p">}</span>
</span><span class="hll">
</span><span class="hll">        <span class="n">attributes</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="n">ResultMessages</span><span class="p">.</span><span class="na">success</span><span class="p">().</span><span class="na">add</span><span class="p">(</span>
</span><span class="hll">                <span class="n">ResultMessage</span><span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;Deleted successfully!&quot;</span><span class="p">)));</span>
</span><span class="hll">        <span class="k">return</span> <span class="s">&quot;redirect:/todo/list&quot;</span><span class="p">;</span>
</span><span class="hll">    <span class="p">}</span>
</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Set <code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code> annotation such a way that method of deletion process (<code class="docutils literal"><span class="pre">delete</span></code> method) gets executed
when it is requested to <code class="docutils literal"><span class="pre">/todo/delete</span></code> path using <code class="docutils literal"><span class="pre">POST</span></code> method.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id8">
<h5>10.1.4.2.5.3. Modifications in JSP<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h5>
<p>Add deletion process form.</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>Todo List<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;style</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
.strike {
    text-decoration: line-through;
}

.alert {
    border: 1px solid;
}

.alert-error {
    background-color: #c60f13;
    border-color: #970b0e;
    color: white;
}

.alert-success {
    background-color: #5da423;
    border-color: #457a1a;
    color: white;
}

.text-error {
    color: #c60f13;
}
<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Todo List<span class="nt">&lt;/h1&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;todoForm&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t:messagesPanel</span> <span class="nt">/&gt;</span>

        <span class="nt">&lt;form:form</span>
            <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/todo/create&quot;</span>
            <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">modelAttribute=</span><span class="s">&quot;todoForm&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;todoTitle&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;todoTitle&quot;</span> <span class="na">cssClass=</span><span class="s">&quot;text-error&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;form:button&gt;</span>Create Todo<span class="nt">&lt;/form:button&gt;</span>
        <span class="nt">&lt;/form:form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;hr</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;todoList&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ul&gt;</span>
            <span class="nt">&lt;c:forEach</span> <span class="na">items=</span><span class="s">&quot;${todos}&quot;</span> <span class="na">var=</span><span class="s">&quot;todo&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;li&gt;&lt;c:choose&gt;</span>
                        <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">&quot;${todo.finished}&quot;</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;strike&quot;</span><span class="nt">&gt;</span>${f:h(todo.todoTitle)}<span class="nt">&lt;/span&gt;</span>
                        <span class="nt">&lt;/c:when&gt;</span>
                        <span class="nt">&lt;c:otherwise&gt;</span>
                            ${f:h(todo.todoTitle)}
                            <span class="nt">&lt;form:form</span>
                                <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/todo/finish&quot;</span>
                                <span class="na">method=</span><span class="s">&quot;post&quot;</span>
                                <span class="na">modelAttribute=</span><span class="s">&quot;todoForm&quot;</span>
                                <span class="na">cssStyle=</span><span class="s">&quot;display: inline-block;&quot;</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;form:hidden</span> <span class="na">path=</span><span class="s">&quot;todoId&quot;</span>
                                    <span class="na">value=</span><span class="s">&quot;${f:h(todo.todoId)}&quot;</span> <span class="nt">/&gt;</span>
                                <span class="nt">&lt;form:button&gt;</span>Finish<span class="nt">&lt;/form:button&gt;</span>
                            <span class="nt">&lt;/form:form&gt;</span>
                        <span class="nt">&lt;/c:otherwise&gt;</span>
                    <span class="nt">&lt;/c:choose&gt;</span>
<span class="hll">                    <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;form:form</span>
</span><span class="hll">                        <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/todo/delete&quot;</span>
</span><span class="hll">                        <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">modelAttribute=</span><span class="s">&quot;todoForm&quot;</span>
</span><span class="hll">                        <span class="na">cssStyle=</span><span class="s">&quot;display: inline-block;&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                        <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;form:hidden</span> <span class="na">path=</span><span class="s">&quot;todoId&quot;</span>
</span><span class="hll">                            <span class="na">value=</span><span class="s">&quot;${f:h(todo.todoId)}&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;form:button&gt;</span>Delete<span class="nt">&lt;/form:button&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;/form:form&gt;</span>
</span>                <span class="nt">&lt;/li&gt;</span>
            <span class="nt">&lt;/c:forEach&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Display deletion process form.</div>
<div class="line">Specify URL(<code class="docutils literal"><span class="pre">&lt;contextPath&gt;/todo/delete</span></code>) into <code class="docutils literal"><span class="pre">action</span></code> attribute for running the deletion process.</div>
<div class="line">Since the deletion process is a process of updating, specify the <code class="docutils literal"><span class="pre">POST</span></code> method into the <code class="docutils literal"><span class="pre">method</span></code> attribute.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Pass <code class="docutils literal"><span class="pre">todoId</span></code> as request parameter using <code class="docutils literal"><span class="pre">&lt;form:hidden&gt;</span></code> tag.</div>
<div class="line">Also while setting the value in <code class="docutils literal"><span class="pre">value</span></code> attribute, <strong>HTML escaping should always be performed using f:h() function.</strong></div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>When pressing the [Delete] button in an uncompleted TODO state, TODO is deleted as follows.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image077.png"><img alt="../_images/image077.png" src="../_images/image077.png" style="width: 40%;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image078.png"><img alt="../_images/image078.png" src="../_images/image078.png" style="width: 40%;" /></a>
</div>
</div>
</div>
<div class="section" id="use-of-css-file">
<h4><a class="toc-backref" href="#id45">10.1.4.2.6. Use of CSS file</a><a class="headerlink" href="#use-of-css-file" title="Permalink to this headline">¶</a></h4>
<p>Although style sheets are directly defined in a JSP file,
generally it is defined in the CSS file while developing the actual application.</p>
<p>Here, how to define style sheet into the CSS file are described.</p>
<p>Add the style sheet definitions in the CSS file (<code class="docutils literal"><span class="pre">src/main/webapp/resources/app/css/styles.css</span></code>) that is provided in the blank project.</p>
<div class="highlight-css"><div class="highlight"><pre><span></span><span class="c">/* ... */</span>

<span class="p">.</span><span class="nc">strike</span> <span class="p">{</span>
    <span class="k">text-decoration</span><span class="p">:</span> <span class="kc">line-through</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">alert</span> <span class="p">{</span>
    <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span><span class="p">;</span>
    <span class="k">margin-bottom</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">alert-error</span> <span class="p">{</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="mh">#c60f13</span><span class="p">;</span>
    <span class="k">border-color</span><span class="p">:</span> <span class="mh">#970b0e</span><span class="p">;</span>
    <span class="k">color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">alert-success</span> <span class="p">{</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="mh">#5da423</span><span class="p">;</span>
    <span class="k">border-color</span><span class="p">:</span> <span class="mh">#457a1a</span><span class="p">;</span>
    <span class="k">color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">text-error</span> <span class="p">{</span>
    <span class="k">color</span><span class="p">:</span> <span class="mh">#c60f13</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">alert</span> <span class="nt">ul</span> <span class="p">{</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">15</span><span class="kt">px</span> <span class="mi">0</span><span class="kt">px</span> <span class="mi">15</span><span class="kt">px</span> <span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">#</span><span class="nn">todoList</span> <span class="nt">li</span> <span class="p">{</span>
    <span class="k">margin-top</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Loading CSS file within JSP.</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>Todo List<span class="nt">&lt;/title&gt;</span>
<span class="hll"><span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll"><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/resources/app/css/styles.css&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
</span><span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Todo List<span class="nt">&lt;/h1&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;todoForm&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t:messagesPanel</span> <span class="nt">/&gt;</span>

        <span class="nt">&lt;form:form</span>
            <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/todo/create&quot;</span>
            <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">modelAttribute=</span><span class="s">&quot;todoForm&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;todoTitle&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;todoTitle&quot;</span> <span class="na">cssClass=</span><span class="s">&quot;text-error&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;form:button&gt;</span>Create Todo<span class="nt">&lt;/form:button&gt;</span>
        <span class="nt">&lt;/form:form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;hr</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;todoList&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ul&gt;</span>
            <span class="nt">&lt;c:forEach</span> <span class="na">items=</span><span class="s">&quot;${todos}&quot;</span> <span class="na">var=</span><span class="s">&quot;todo&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;li&gt;&lt;c:choose&gt;</span>
                        <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">&quot;${todo.finished}&quot;</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;strike&quot;</span><span class="nt">&gt;</span>${f:h(todo.todoTitle)}<span class="nt">&lt;/span&gt;</span>
                        <span class="nt">&lt;/c:when&gt;</span>
                        <span class="nt">&lt;c:otherwise&gt;</span>
                            ${f:h(todo.todoTitle)}
                            <span class="nt">&lt;form:form</span>
                                <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/todo/finish&quot;</span>
                                <span class="na">method=</span><span class="s">&quot;post&quot;</span>
                                <span class="na">modelAttribute=</span><span class="s">&quot;todoForm&quot;</span>
                                <span class="na">cssStyle=</span><span class="s">&quot;display: inline-block;&quot;</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;form:hidden</span> <span class="na">path=</span><span class="s">&quot;todoId&quot;</span>
                                    <span class="na">value=</span><span class="s">&quot;${f:h(todo.todoId)}&quot;</span> <span class="nt">/&gt;</span>
                                <span class="nt">&lt;form:button&gt;</span>Finish<span class="nt">&lt;/form:button&gt;</span>
                            <span class="nt">&lt;/form:form&gt;</span>
                        <span class="nt">&lt;/c:otherwise&gt;</span>
                    <span class="nt">&lt;/c:choose&gt;</span>
                    <span class="nt">&lt;form:form</span>
                        <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/todo/delete&quot;</span>
                        <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">modelAttribute=</span><span class="s">&quot;todoForm&quot;</span>
                        <span class="na">cssStyle=</span><span class="s">&quot;display: inline-block;&quot;</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;form:hidden</span> <span class="na">path=</span><span class="s">&quot;todoId&quot;</span>
                            <span class="na">value=</span><span class="s">&quot;${f:h(todo.todoId)}&quot;</span> <span class="nt">/&gt;</span>
                        <span class="nt">&lt;form:button&gt;</span>Delete<span class="nt">&lt;/form:button&gt;</span>
                    <span class="nt">&lt;/form:form&gt;</span>
                <span class="nt">&lt;/li&gt;</span>
            <span class="nt">&lt;/c:forEach&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Delete the style sheet definitions from the JSP file and load the CSS file in which the style sheets are defined.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Following would be the layout if CSS file is applied.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/list-screen-css.png"><img alt="../_images/list-screen-css.png" src="../_images/list-screen-css.png" style="width: 40%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="creating-infrastructure-layer-with-a-database-access">
<span id="tutorial-todo-infra"></span><h2><a class="toc-backref" href="#id46">10.1.5. Creating infrastructure layer with a Database access</a><a class="headerlink" href="#creating-infrastructure-layer-with-a-database-access" title="Permalink to this headline">¶</a></h2>
<p>In this section, infrastructure layer for persisting Domain objects in the database is explained.</p>
<p>In this tutorial, it explains how to implement the infrastructure layer using following two O/R Mapper.</p>
<ul class="simple">
<li>MyBatis3</li>
<li>Spring Data JPA</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="creating-a-blank-project-dependent-on-o-r-mapper">
<span id="tutorialcreateormapperblankproject"></span><h3><a class="toc-backref" href="#id47">10.1.5.1. Creating a blank project dependent on O/R Mapper</a><a class="headerlink" href="#creating-a-blank-project-dependent-on-o-r-mapper" title="Permalink to this headline">¶</a></h3>
<p>Here, a blank project dependent on O/R Mapper is created.</p>
<p>At first, recreate the project corresponding to O/R Mapper being used.</p>
<ul class="simple">
<li><a class="reference internal" href="#tutorialcreatemybatis3blankproject"><span class="std std-ref">Creating blank project for MyBatis3</span></a></li>
<li><a class="reference internal" href="#tutorialcreatejpablankproject"><span class="std std-ref">Creating blank project for JPA</span></a></li>
</ul>
<p>Next, <strong>copy a file other than **TodoRepositoryImpl class to a newly created project</strong>under <code class="file docutils literal"><span class="pre">src</span></code>folder created upto <a class="reference internal" href="#tutorial-todo-infra"><span class="std std-ref">Creating infrastructure layer with a Database access</span></a>.</p>
<p><strong>However, file to be copied must be a newly created file or file with added changes. A file without modifications must not be copied</strong>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="database-set-up">
<span id="tutorial-setup-database"></span><h3><a class="toc-backref" href="#id48">10.1.5.2. Database set-up</a><a class="headerlink" href="#database-set-up" title="Permalink to this headline">¶</a></h3>
<p>Here, perform the Database set-up.</p>
<p>In this tutorial, the H2 Database is used to save the database setup time.</p>
<div class="section" id="modification-in-todo-infra-properties">
<h4><a class="toc-backref" href="#id49">10.1.5.2.1. Modification in todo-infra.properties</a><a class="headerlink" href="#modification-in-todo-infra-properties" title="Permalink to this headline">¶</a></h4>
<p>Modify the <code class="file docutils literal"><span class="pre">src/main/resources/META-INF/spring/todo-infra.properties</span></code> settings
for creating tables into H2 Database while booting the AP server.</p>
<div class="highlight-properties"><div class="highlight"><pre><span></span><span class="na">database</span><span class="o">=</span><span class="s">H2</span>
<span class="hll"><span class="c"># (1)</span>
</span><span class="hll"><span class="na">database.url</span><span class="o">=</span><span class="s">jdbc:h2:mem:todo;DB_CLOSE_DELAY=-1;INIT=create table if not exists todo(todo_id varchar(36) primary key, todo_title varchar(30), finished boolean, created_at timestamp)</span>
</span><span class="na">database.username</span><span class="o">=</span><span class="s">sa</span>
<span class="na">database.password</span><span class="o">=</span>
<span class="na">database.driverClassName</span><span class="o">=</span><span class="s">org.h2.Driver</span>
<span class="c"># connection pool</span>
<span class="na">cp.maxActive</span><span class="o">=</span><span class="s">96</span>
<span class="na">cp.maxIdle</span><span class="o">=</span><span class="s">16</span>
<span class="na">cp.minIdle</span><span class="o">=</span><span class="s">0</span>
<span class="na">cp.maxWait</span><span class="o">=</span><span class="s">60000</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the DDL statements to create tables into INIT parameter of the URL connection.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you format the DDL statement that is set to INIT parameter, it will looks like follows.</p>
<blockquote class="last">
<div><div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">create</span> <span class="k">table</span> <span class="k">if</span> <span class="k">not</span> <span class="k">exists</span> <span class="n">todo</span> <span class="p">(</span>
    <span class="n">todo_id</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
    <span class="n">todo_title</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
    <span class="n">finished</span> <span class="nb">boolean</span><span class="p">,</span>
    <span class="n">created_at</span> <span class="k">timestamp</span>
<span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="creating-infrastructure-layer-with-mybatis3">
<span id="using-mybatis3"></span><h3><a class="toc-backref" href="#id50">10.1.5.3. Creating infrastructure layer with MyBatis3</a><a class="headerlink" href="#creating-infrastructure-layer-with-mybatis3" title="Permalink to this headline">¶</a></h3>
<p>Here, How to create RepositoryImpl of infrastructure layer using MyBatis3 is explained.</p>
<p>If you want to use the Spring Data JPA, you can skip this section and may proceed to the <a class="reference internal" href="#using-springdatajpa"><span class="std std-ref">Creating infrastructure layer with Spring Data JPA</span></a>.</p>
<div class="section" id="create-todorepository">
<h4><a class="toc-backref" href="#id51">10.1.5.3.1. Create TodoRepository</a><a class="headerlink" href="#create-todorepository" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">TodoRepository</span></code> is created by the same way as it is created for without O/R Mapper.
For creation method, refer [<a class="reference internal" href="#tutorialtodocreaterepository"><span class="std std-ref">Repository creation</span></a>].</p>
</div>
<div class="section" id="create-todorepositoryimpl">
<h4><a class="toc-backref" href="#id52">10.1.5.3.2. Create TodoRepositoryImpl</a><a class="headerlink" href="#create-todorepositoryimpl" title="Permalink to this headline">¶</a></h4>
<p>If MyBatis3 is used, RepositoryImpl is automatically generated from the Repository interface (Mapper interface).
Therefore, the creation of <code class="docutils literal"><span class="pre">TodoRepositoryImpl</span></code> is not required. Remove if it is created.</p>
</div>
<div class="section" id="create-mapper-file">
<h4><a class="toc-backref" href="#id53">10.1.5.3.3. Create Mapper file</a><a class="headerlink" href="#create-mapper-file" title="Permalink to this headline">¶</a></h4>
<p>Create a Mapper file for defining SQL to be executed when the <code class="docutils literal"><span class="pre">TodoRepository</span></code> interface methods are called.</p>
<p>Right click on the Package Explorer, select -&gt; [New] -&gt; [File] -&gt; [New File] dialog box appears,</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="11%" />
<col width="33%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Item</th>
<th class="head">Input value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Enter or select the parent folder</td>
<td><code class="docutils literal"><span class="pre">todo/src/main/resources/todo/domain/repository/todo</span></code></td>
</tr>
<tr class="row-odd"><td>2</td>
<td>File name</td>
<td><code class="docutils literal"><span class="pre">TodoRepository.xml</span></code></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and click [Finish] after entering above information.</p>
<p>Created file stored in the following directory.</p>
<div class="figure">
<img alt="../_images/create-mapper-for-mybatis3.png" src="../_images/create-mapper-for-mybatis3.png" />
</div>
<p>Describe the SQL to be executed when the <code class="docutils literal"><span class="pre">TodoRepository</span></code> methods defined in the interfaces are called.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>

<span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;todo.domain.repository.todo.TodoRepository&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;todoResultMap&quot;</span> <span class="na">type=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;todoId&quot;</span> <span class="na">column=</span><span class="s">&quot;todo_id&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;todoTitle&quot;</span> <span class="na">column=</span><span class="s">&quot;todo_title&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;finished&quot;</span> <span class="na">column=</span><span class="s">&quot;finished&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;createdAt&quot;</span> <span class="na">column=</span><span class="s">&quot;created_at&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/resultMap&gt;</span>

    <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;String&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;todoResultMap&quot;</span><span class="nt">&gt;</span>
    <span class="cp">&lt;![CDATA[</span>
<span class="cp">        SELECT</span>
<span class="cp">            todo_id,</span>
<span class="cp">            todo_title,</span>
<span class="cp">            finished,</span>
<span class="cp">            created_at</span>
<span class="cp">        FROM</span>
<span class="cp">            todo</span>
<span class="cp">        WHERE</span>
<span class="cp">            todo_id = #{todoId}</span>
<span class="cp">    ]]&gt;</span>
    <span class="nt">&lt;/select&gt;</span>

    <span class="c">&lt;!-- (4) --&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findAll&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;todoResultMap&quot;</span><span class="nt">&gt;</span>
    <span class="cp">&lt;![CDATA[</span>
<span class="cp">        SELECT</span>
<span class="cp">            todo_id,</span>
<span class="cp">            todo_title,</span>
<span class="cp">            finished,</span>
<span class="cp">            created_at</span>
<span class="cp">        FROM</span>
<span class="cp">            todo</span>
<span class="cp">    ]]&gt;</span>
    <span class="nt">&lt;/select&gt;</span>

    <span class="c">&lt;!-- (5) --&gt;</span>
    <span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&quot;create&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
    <span class="cp">&lt;![CDATA[</span>
<span class="cp">        INSERT INTO todo</span>
<span class="cp">        (</span>
<span class="cp">            todo_id,</span>
<span class="cp">            todo_title,</span>
<span class="cp">            finished,</span>
<span class="cp">            created_at</span>
<span class="cp">        )</span>
<span class="cp">        VALUES</span>
<span class="cp">        (</span>
<span class="cp">            #{todoId},</span>
<span class="cp">            #{todoTitle},</span>
<span class="cp">            #{finished},</span>
<span class="cp">            #{createdAt}</span>
<span class="cp">        )</span>
<span class="cp">    ]]&gt;</span>
    <span class="nt">&lt;/insert&gt;</span>

    <span class="c">&lt;!-- (6) --&gt;</span>
    <span class="nt">&lt;update</span> <span class="na">id=</span><span class="s">&quot;update&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
    <span class="cp">&lt;![CDATA[</span>
<span class="cp">        UPDATE todo</span>
<span class="cp">        SET</span>
<span class="cp">            todo_title = #{todoTitle},</span>
<span class="cp">            finished = #{finished},</span>
<span class="cp">            created_at = #{createdAt}</span>
<span class="cp">        WHERE</span>
<span class="cp">            todo_id = #{todoId}</span>
<span class="cp">    ]]&gt;</span>
    <span class="nt">&lt;/update&gt;</span>

    <span class="c">&lt;!-- (7) --&gt;</span>
    <span class="nt">&lt;delete</span> <span class="na">id=</span><span class="s">&quot;delete&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
    <span class="cp">&lt;![CDATA[</span>
<span class="cp">        DELETE FROM</span>
<span class="cp">            todo</span>
<span class="cp">        WHERE</span>
<span class="cp">            todo_id = #{todoId}</span>
<span class="cp">    ]]&gt;</span>
    <span class="nt">&lt;/delete&gt;</span>

    <span class="c">&lt;!-- (8) --&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;countByFinished&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;Boolean&quot;</span>
        <span class="na">resultType=</span><span class="s">&quot;Long&quot;</span><span class="nt">&gt;</span>
    <span class="cp">&lt;![CDATA[</span>
<span class="cp">        SELECT</span>
<span class="cp">            COUNT(*)</span>
<span class="cp">        FROM</span>
<span class="cp">            todo</span>
<span class="cp">        WHERE</span>
<span class="cp">            finished = #{finished}</span>
<span class="cp">    ]]&gt;</span>
    <span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the fully qualified class name of the Repository interfaces (FQCN) in the <code class="docutils literal"><span class="pre">namespace</span></code> attribute of <code class="docutils literal"><span class="pre">mapper</span></code> element.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define JavaBean mapping with search result (<code class="docutils literal"><span class="pre">ResultSet</span></code>) in the <code class="docutils literal"><span class="pre">&lt;resultMap&gt;</span></code> element.</div>
<div class="line">For the mapping file details, Refer <a class="reference internal" href="../ArchitectureInDetail/DataAccessDetail/DataAccessMyBatis3.html"><span class="doc">Database Access (MyBatis3)</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implement the SQL to get one record which matches with the <code class="docutils literal"><span class="pre">todoId</span></code> (PK).</div>
<div class="line">Specify the ID of applicable mapping definition in the <code class="docutils literal"><span class="pre">resultMap</span></code> attribute of <code class="docutils literal"><span class="pre">&lt;select&gt;</span></code> element.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implement the SQL to retrieve all records.</div>
<div class="line">Specify the ID of applicable mapping definition in the <code class="docutils literal"><span class="pre">resultMap</span></code> attribute of <code class="docutils literal"><span class="pre">&lt;select&gt;</span></code> element.</div>
<div class="line">Although it is not described in the application requirement, records are rearranged as the most recent TODO is displayed at the top.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implement the SQL to insert the Todo object specified in the argument.</div>
<div class="line">Specify the parameter of the class name (FQCN or alias name) in the <code class="docutils literal"><span class="pre">parameterType</span></code> attribute of <code class="docutils literal"><span class="pre">&lt;insert&gt;</span></code> element.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implement the SQL to update the Todo object specified in the argument.</div>
<div class="line">Specify the parameter of the class name (FQCN or alias name) in the <code class="docutils literal"><span class="pre">parameterType</span></code> attribute of <code class="docutils literal"><span class="pre">&lt;update&gt;</span></code> element.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implement the SQL to delete the Todo object specified in the argument.</div>
<div class="line">Specify the parameter of the class name (FQCN or alias name) in the <code class="docutils literal"><span class="pre">parameterType</span></code> attribute of <code class="docutils literal"><span class="pre">&lt;delete&gt;</span></code> element.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implement the SQL to get all records matches with the <code class="docutils literal"><span class="pre">finished</span></code> status specified in the argument.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Since the creation of infrastructure layer using MyBatis3 has been completed, create the application layer components and services.</p>
<p>Once creation of the Services and application layer are completed, execute the Todo application after starting the AP server, SQL and transaction log output is as following.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go"> date:2016-02-17 13:18:54    thread:tomcat-http--5   X-Track:390066c43aa94b6588e5bac6a54812b2        level:TRACE     logger:o.t.gfw.web.logging.TraceLoggingInterceptor      message:[START CONTROLLER] TodoController.list(Model)</span>
<span class="hll"><span class="go"> date:2016-02-17 13:18:54    thread:tomcat-http--5   X-Track:390066c43aa94b6588e5bac6a54812b2        level:DEBUG     logger:o.s.jdbc.datasource.DataSourceTransactionManager message:Creating new transaction with name [todo.domain.service.todo.TodoServiceImpl.findAll]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly; &#39;&#39;</span>
</span><span class="hll"><span class="go"> date:2016-02-17 13:18:55    thread:tomcat-http--5   X-Track:390066c43aa94b6588e5bac6a54812b2        level:DEBUG     logger:o.s.jdbc.datasource.DataSourceTransactionManager message:Acquired Connection [net.sf.log4jdbc.ConnectionSpy@4e53de7c] for JDBC transaction</span>
</span><span class="go"> date:2016-02-17 13:18:55    thread:tomcat-http--5   X-Track:390066c43aa94b6588e5bac6a54812b2        level:DEBUG     logger:t.domain.repository.todo.TodoRepository.findAll  message:==&gt;  Preparing: SELECT todo_id, todo_title, finished, created_at FROM todo</span>
<span class="go"> date:2016-02-17 13:18:55    thread:tomcat-http--5   X-Track:390066c43aa94b6588e5bac6a54812b2        level:DEBUG     logger:t.domain.repository.todo.TodoRepository.findAll  message:==&gt; Parameters:</span>
<span class="hll"><span class="go"> date:2016-02-17 13:18:55    thread:tomcat-http--5   X-Track:390066c43aa94b6588e5bac6a54812b2        level:DEBUG     logger:jdbc.sqltiming                                   message: sun.reflect.NativeMethodAccessorImpl.invoke0(NativeMethodAccessorImpl.java:-2)</span>
</span><span class="hll"><span class="go"> 1. SELECT</span>
</span><span class="hll"><span class="go">             todo_id,</span>
</span><span class="hll"><span class="go">             todo_title,</span>
</span><span class="hll"><span class="go">             finished,</span>
</span><span class="hll"><span class="go">             created_at</span>
</span><span class="hll"><span class="go">         FROM</span>
</span><span class="hll"><span class="go">             todo {executed in 0 msec}</span>
</span><span class="hll"><span class="go"> date:2016-02-17 13:18:55    thread:tomcat-http--5   X-Track:390066c43aa94b6588e5bac6a54812b2        level:INFO      logger:jdbc.resultsettable                              message:|--------|-----------|---------|-----------|</span>
</span><span class="hll"><span class="go"> date:2016-02-17 13:18:55    thread:tomcat-http--5   X-Track:390066c43aa94b6588e5bac6a54812b2        level:INFO      logger:jdbc.resultsettable                              message:|TODO_ID |TODO_TITLE |FINISHED |CREATED_AT |</span>
</span><span class="hll"><span class="go"> date:2016-02-17 13:18:55    thread:tomcat-http--5   X-Track:390066c43aa94b6588e5bac6a54812b2        level:INFO      logger:jdbc.resultsettable                              message:|--------|-----------|---------|-----------|</span>
</span><span class="hll"><span class="go"> date:2016-02-17 13:18:55    thread:tomcat-http--5   X-Track:390066c43aa94b6588e5bac6a54812b2        level:INFO      logger:jdbc.resultsettable                              message:|--------|-----------|---------|-----------|</span>
</span><span class="hll"><span class="go"> date:2016-02-17 13:18:55    thread:tomcat-http--5   X-Track:390066c43aa94b6588e5bac6a54812b2        level:DEBUG     logger:t.domain.repository.todo.TodoRepository.findAll  message:&lt;==      Total: 0</span>
</span><span class="go"> date:2016-02-17 13:18:55    thread:tomcat-http--5   X-Track:390066c43aa94b6588e5bac6a54812b2        level:DEBUG     logger:o.s.jdbc.datasource.DataSourceTransactionManager message:Initiating transaction commit</span>
<span class="hll"><span class="go"> date:2016-02-17 13:18:55    thread:tomcat-http--5   X-Track:390066c43aa94b6588e5bac6a54812b2        level:DEBUG     logger:o.s.jdbc.datasource.DataSourceTransactionManager message:Committing JDBC transaction on Connection [net.sf.log4jdbc.ConnectionSpy@4e53de7c]</span>
</span><span class="hll"><span class="go"> date:2016-02-17 13:18:55    thread:tomcat-http--5   X-Track:390066c43aa94b6588e5bac6a54812b2        level:DEBUG     logger:o.s.jdbc.datasource.DataSourceTransactionManager message:Releasing JDBC Connection [net.sf.log4jdbc.ConnectionSpy@4e53de7c] after transaction</span>
</span><span class="hll"><span class="go"> date:2016-02-17 13:18:55    thread:tomcat-http--5   X-Track:390066c43aa94b6588e5bac6a54812b2        level:TRACE     logger:o.t.gfw.web.logging.TraceLoggingInterceptor      message:[END CONTROLLER  ] TodoController.list(Model)-&gt; view=todo/list, model={todoForm=todo.app.todo.TodoForm@2a075f1d, todos=[], org.springframework.validation.BindingResult.todoForm=org.springframework.validation.BeanPropertyBindingResult: 0 errors}</span>
</span><span class="go"> date:2016-02-17 13:18:55    thread:tomcat-http--5   X-Track:390066c43aa94b6588e5bac6a54812b2        level:TRACE     logger:o.t.gfw.web.logging.TraceLoggingInterceptor      message:[HANDLING TIME   ] TodoController.list(Model)-&gt; 756,709,153 ns</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="creating-infrastructure-layer-with-spring-data-jpa">
<span id="using-springdatajpa"></span><h3><a class="toc-backref" href="#id54">10.1.5.4. Creating infrastructure layer with Spring Data JPA</a><a class="headerlink" href="#creating-infrastructure-layer-with-spring-data-jpa" title="Permalink to this headline">¶</a></h3>
<p>Here, How to create RepositoryImpl of infrastructure layer using <a class="reference external" href="http://www.springsource.org/spring-data/jpa">Spring Data JPA</a> is explained.</p>
<div class="section" id="modification-in-entity">
<h4><a class="toc-backref" href="#id55">10.1.5.4.1. Modification in Entity</a><a class="headerlink" href="#modification-in-entity" title="Permalink to this headline">¶</a></h4>
<p>Configure the JPA annotation for mapping the Todo class with TODO table of Database.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.domain.model</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="p">;</span>

<span class="hll"><span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
</span><span class="hll"><span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="p">;</span>
</span><span class="hll"><span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="p">;</span>
</span><span class="hll"><span class="kn">import</span> <span class="nn">javax.persistence.Temporal</span><span class="p">;</span>
</span><span class="hll"><span class="kn">import</span> <span class="nn">javax.persistence.TemporalType</span><span class="p">;</span>
</span>
<span class="hll"><span class="c1">// (1)</span>
</span><span class="hll"><span class="nd">@Entity</span>
</span><span class="hll"><span class="nd">@Table</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;todo&quot;</span><span class="p">)</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Todo</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="p">;</span>

<span class="hll">    <span class="c1">// (2)</span>
</span><span class="hll">    <span class="nd">@Id</span>
</span>    <span class="kd">private</span> <span class="n">String</span> <span class="n">todoId</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">todoTitle</span><span class="p">;</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">finished</span><span class="p">;</span>

<span class="hll">    <span class="c1">// (3)</span>
</span><span class="hll">    <span class="nd">@Temporal</span><span class="p">(</span><span class="n">TemporalType</span><span class="p">.</span><span class="na">TIMESTAMP</span><span class="p">)</span>
</span>    <span class="kd">private</span> <span class="n">Date</span> <span class="n">createdAt</span><span class="p">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTodoId</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">todoId</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTodoId</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">todoId</span> <span class="o">=</span> <span class="n">todoId</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTodoTitle</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">todoTitle</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTodoTitle</span><span class="p">(</span><span class="n">String</span> <span class="n">todoTitle</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">todoTitle</span> <span class="o">=</span> <span class="n">todoTitle</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isFinished</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">finished</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFinished</span><span class="p">(</span><span class="kt">boolean</span> <span class="n">finished</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">finished</span> <span class="o">=</span> <span class="n">finished</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getCreatedAt</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">createdAt</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCreatedAt</span><span class="p">(</span><span class="n">Date</span> <span class="n">createdAt</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">createdAt</span> <span class="o">=</span> <span class="n">createdAt</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add <code class="docutils literal"><span class="pre">&#64;Entity</span></code> showing that it is JPA entity and set the corresponding table name using <code class="docutils literal"><span class="pre">&#64;Table</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add <code class="docutils literal"><span class="pre">&#64;Id</span></code> to the field corresponding to primary key column.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">It should be clearly specified that <code class="docutils literal"><span class="pre">java.util.Date</span></code> type corresponds to which of <code class="docutils literal"><span class="pre">java.sql.Date</span></code>, <code class="docutils literal"><span class="pre">java.sql.Time</span></code>, <code class="docutils literal"><span class="pre">java.sql.Timestamp</span></code>.</div>
<div class="line">Here <code class="docutils literal"><span class="pre">Timestamp</span></code> is specified to <code class="docutils literal"><span class="pre">createdAt</span></code> property.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="creat-todorepository">
<h4><a class="toc-backref" href="#id56">10.1.5.4.2. Creat TodoRepository</a><a class="headerlink" href="#creat-todorepository" title="Permalink to this headline">¶</a></h4>
<p>Create <code class="docutils literal"><span class="pre">TodoRepository</span></code> using Repository feature of Spring Data JPA.</p>
<p>Right click on the Package Explorer, select -&gt; [New] -&gt; [Interface] -&gt; [New Java Interface] dialog box appears,</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="11%" />
<col width="33%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Item</th>
<th class="head">Input value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Package</td>
<td><code class="docutils literal"><span class="pre">todo.domain.repository.todo</span></code></td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Name</td>
<td><code class="docutils literal"><span class="pre">TodoRepository</span></code></td>
</tr>
<tr class="row-even"><td>3</td>
<td>Extended interfaces</td>
<td><code class="docutils literal"><span class="pre">org.springframework.data.jpa.repository.JpaRepository&lt;T,</span> <span class="pre">ID&gt;</span></code></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and click [Finish] after entering above information.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.domain.repository.todo</span><span class="p">;</span>

<span class="hll"><span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="p">;</span>
</span><span class="hll"><span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.Query</span><span class="p">;</span>
</span><span class="hll"><span class="kn">import</span> <span class="nn">org.springframework.data.repository.query.Param</span><span class="p">;</span>
</span>
<span class="kn">import</span> <span class="nn">todo.domain.model.Todo</span><span class="p">;</span>

<span class="hll"><span class="c1">// (1)</span>
</span><span class="hll"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoRepository</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Todo</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="p">{</span>
</span>
<span class="hll">    <span class="nd">@Query</span><span class="p">(</span><span class="s">&quot;SELECT COUNT(t) FROM Todo t WHERE t.finished = :finished&quot;</span><span class="p">)</span> <span class="c1">// (2)</span>
</span><span class="hll">    <span class="kt">long</span> <span class="nf">countByFinished</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;finished&quot;</span><span class="p">)</span> <span class="kt">boolean</span> <span class="n">finished</span><span class="p">);</span> <span class="c1">// (3)</span>
</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify generics parameter of <code class="docutils literal"><span class="pre">JpaRepository</span></code>.</div>
<div class="line">From left to right, Entity Classes (<code class="docutils literal"><span class="pre">Todo</span></code>), primary key class (<code class="docutils literal"><span class="pre">String</span></code>) is specified.</div>
<div class="line">Since basic CRUD operations (<code class="docutils literal"><span class="pre">findOne</span></code>, <code class="docutils literal"><span class="pre">findAll</span></code>, <code class="docutils literal"><span class="pre">save</span></code>, <code class="docutils literal"><span class="pre">delete</span></code> etc.) are defined in <code class="docutils literal"><span class="pre">JpaRepository</span></code> interface,</div>
<div class="line">only <code class="docutils literal"><span class="pre">countByFinished</span></code> can be defined in <code class="docutils literal"><span class="pre">TodoRepository</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify <code class="docutils literal"><span class="pre">&#64;Query</span></code> annotation to the JPQL executed at the time of calling <code class="docutils literal"><span class="pre">countByFinished</span></code> method</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set bind variable of JPQL specified in (2) by <code class="docutils literal"><span class="pre">&#64;Param</span></code> annotation.</div>
<div class="line">Here, <code class="docutils literal"><span class="pre">&#64;Param(“finished”)</span></code> is added before the method argument <code class="docutils literal"><span class="pre">finished</span></code> to embed the value with <code class="docutils literal"><span class="pre">”:finished”</span></code> of JPQL.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id9">
<h4><a class="toc-backref" href="#id57">10.1.5.4.3. Create TodoRepositoryImpl</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<p>If Spring Data JPA is used, RepositoryImpl is automatically generated from the Repository interface.
Therefore, the creation of <code class="docutils literal"><span class="pre">TodoRepositoryImpl</span></code> is not required. Remove if it is created.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Since the creation of infrastructure layer using Spring Data JPA has been completed, create the application layer components and services.</p>
<p>Once creation of the Services and application layer are completed, execute the Todo application after starting the AP server, SQL and transaction log output is as following.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go"> date:2016-02-17 13:32:44    thread:tomcat-http--5   X-Track:7c34263e0a2143639f3ffd191b35c135        level:TRACE     logger:o.t.gfw.web.logging.TraceLoggingInterceptor      message:[START CONTROLLER] TodoController.list(Model)</span>
<span class="hll"><span class="go"> date:2016-02-17 13:32:44    thread:tomcat-http--5   X-Track:7c34263e0a2143639f3ffd191b35c135        level:DEBUG     logger:o.h.e.transaction.spi.AbstractTransactionImpl    message:begin</span>
</span><span class="hll"><span class="go"> date:2016-02-17 13:32:44    thread:tomcat-http--5   X-Track:7c34263e0a2143639f3ffd191b35c135        level:DEBUG     logger:o.h.e.transaction.internal.jdbc.JdbcTransaction  message:initial autocommit status: false</span>
</span><span class="hll"><span class="go"> date:2016-02-17 13:32:45    thread:tomcat-http--5   X-Track:7c34263e0a2143639f3ffd191b35c135        level:DEBUG     logger:jdbc.sqltiming                                   message: org.hibernate.engine.jdbc.internal.ResultSetReturnImpl.extract(ResultSetReturnImpl.java:82)</span>
</span><span class="hll"><span class="go"> 5. /* select generatedAlias0 from Todo as generatedAlias0 */ select todo0_.todo_id as todo_id1_0_, todo0_.created_at as created_2_0_, todo0_.finished as finished3_0_, todo0_.todo_title as todo_tit4_0_ from todo todo0_ {executed in 1 msec}</span>
</span><span class="hll"><span class="go"> date:2016-02-17 13:32:45    thread:tomcat-http--5   X-Track:7c34263e0a2143639f3ffd191b35c135        level:INFO      logger:jdbc.resultsettable                              message:|--------|-----------|---------|-----------|</span>
</span><span class="hll"><span class="go"> date:2016-02-17 13:32:45    thread:tomcat-http--5   X-Track:7c34263e0a2143639f3ffd191b35c135        level:INFO      logger:jdbc.resultsettable                              message:|TODO_ID |CREATED_AT |FINISHED |TODO_TITLE |</span>
</span><span class="hll"><span class="go"> date:2016-02-17 13:32:45    thread:tomcat-http--5   X-Track:7c34263e0a2143639f3ffd191b35c135        level:INFO      logger:jdbc.resultsettable                              message:|--------|-----------|---------|-----------|</span>
</span><span class="hll"><span class="go"> date:2016-02-17 13:32:45    thread:tomcat-http--5   X-Track:7c34263e0a2143639f3ffd191b35c135        level:INFO      logger:jdbc.resultsettable                              message:|--------|-----------|---------|-----------|</span>
</span><span class="hll"><span class="go"> date:2016-02-17 13:32:45    thread:tomcat-http--5   X-Track:7c34263e0a2143639f3ffd191b35c135        level:DEBUG     logger:o.h.e.transaction.spi.AbstractTransactionImpl    message:committing</span>
</span><span class="hll"><span class="go"> date:2016-02-17 13:32:45    thread:tomcat-http--5   X-Track:7c34263e0a2143639f3ffd191b35c135        level:DEBUG     logger:o.h.e.transaction.internal.jdbc.JdbcTransaction  message:committed JDBC Connection</span>
</span><span class="go"> date:2016-02-17 13:32:45    thread:tomcat-http--5   X-Track:7c34263e0a2143639f3ffd191b35c135        level:TRACE     logger:o.t.gfw.web.logging.TraceLoggingInterceptor      message:[END CONTROLLER  ] TodoController.list(Model)-&gt; view=todo/list, model={todoForm=todo.app.todo.TodoForm@5dac2c75, todos=[], org.springframework.validation.BindingResult.todoForm=org.springframework.validation.BeanPropertyBindingResult: 0 errors}</span>
<span class="go"> date:2016-02-17 13:32:45    thread:tomcat-http--5   X-Track:7c34263e0a2143639f3ffd191b35c135        level:TRACE     logger:o.t.gfw.web.logging.TraceLoggingInterceptor      message:[HANDLING TIME   ] TodoController.list(Model)-&gt; 320,129,237 ns</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="in-the-end">
<h2><a class="toc-backref" href="#id58">10.1.6. In the end…</a><a class="headerlink" href="#in-the-end" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial, following contents have been learnt.</p>
<ul class="simple">
<li>How to develop basic applications by TERASOLUNA Server Framework for Java (5.x)</li>
<li>How to build Maven as well as STS (Eclipse) project</li>
<li>Way of development using application layering of TERASOLUNA Server Framework for Java (5.x).</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Implementation of domain layer with POJO(+ Spring)</li>
<li>Implementation of application layer with the use of JSP tag libraries and POJO(+ Spring MVC)</li>
<li>Development of Infrastructure layer with the use of MyBatis3</li>
<li>Development of Infrastructure layer with the use of Spring Data JPA</li>
<li>Development of Infrastructure layer without use of O/R Mapper</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>The following improvement can be done in the TODO management application.</dt>
<dd>As a learning challenge of the application improvement refer the appropriate description of the guidelines.</dd>
</dl>
<ul class="simple">
<li>To externalize the property (Maximum number of uncompleted TODO) -&gt; <a class="reference internal" href="../ArchitectureInDetail/GeneralFuncDetail/PropertyManagement.html"><span class="doc">Properties Management</span></a></li>
<li>To externalize the messages -&gt; <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/MessageManagement.html"><span class="doc">Message Management</span></a></li>
<li>To add pagination function -&gt; <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Pagination.html"><span class="doc">Pagination</span></a></li>
<li>To add exception handling -&gt; <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/ExceptionHandling.html"><span class="doc">Exception Handling</span></a></li>
<li>To add double submit protection (Support the transaction token check) -&gt; <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/DoubleSubmitProtection.html"><span class="doc">Double Submit Protection</span></a></li>
<li>To change how to get the system date time -&gt; <a class="reference internal" href="../ArchitectureInDetail/GeneralFuncDetail/SystemDate.html"><span class="doc">System Date</span></a></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="appendix">
<h2><a class="toc-backref" href="#id59">10.1.7. Appendix</a><a class="headerlink" href="#appendix" title="Permalink to this headline">¶</a></h2>
<div class="section" id="description-of-the-configuration-file">
<span id="tutorialtodoappendixexpoundconfigurations"></span><h3><a class="toc-backref" href="#id60">10.1.7.1. Description of the configuration file</a><a class="headerlink" href="#description-of-the-configuration-file" title="Permalink to this headline">¶</a></h3>
<p>Description of the configuration files are done for giving an understanding of what type of settings are required to run an application.
Settings that are not used in created Todo tutorial application are ignored here.</p>
<div class="section" id="web-xml">
<h4><a class="toc-backref" href="#id61">10.1.7.1.1. web.xml</a><a class="headerlink" href="#web-xml" title="Permalink to this headline">¶</a></h4>
<p>In <code class="file docutils literal"><span class="pre">web.xml</span></code>, the settings are done for deploying the Todo application as a Web application.</p>
<p>Following settings are done in created blank project <code class="file docutils literal"><span class="pre">src/main/webapp/WEB-INF/web.xml</span></code>.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hll"><span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="nt">&lt;web-app</span> <span class="na">xmlns=</span><span class="s">&quot;http://java.sun.com/xml/ns/javaee&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span>
    <span class="na">version=</span><span class="s">&quot;3.0&quot;</span><span class="nt">&gt;</span>
<span class="hll">    <span class="c">&lt;!-- (2) --&gt;</span>
</span>    <span class="nt">&lt;listener&gt;</span>
        <span class="nt">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="nt">&lt;/listener-class&gt;</span>
    <span class="nt">&lt;/listener&gt;</span>
    <span class="nt">&lt;listener&gt;</span>
        <span class="nt">&lt;listener-class&gt;</span>org.terasoluna.gfw.web.logging.HttpSessionEventLoggingListener<span class="nt">&lt;/listener-class&gt;</span>
    <span class="nt">&lt;/listener&gt;</span>
    <span class="nt">&lt;context-param&gt;</span>
        <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
        <span class="c">&lt;!-- Root ApplicationContext --&gt;</span>
        <span class="nt">&lt;param-value&gt;</span>
            classpath*:META-INF/spring/applicationContext.xml
            classpath*:META-INF/spring/spring-security.xml
        <span class="nt">&lt;/param-value&gt;</span>
    <span class="nt">&lt;/context-param&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (3) --&gt;</span>
</span>    <span class="nt">&lt;filter&gt;</span>
        <span class="nt">&lt;filter-name&gt;</span>MDCClearFilter<span class="nt">&lt;/filter-name&gt;</span>
        <span class="nt">&lt;filter-class&gt;</span>org.terasoluna.gfw.web.logging.mdc.MDCClearFilter<span class="nt">&lt;/filter-class&gt;</span>
    <span class="nt">&lt;/filter&gt;</span>
    <span class="nt">&lt;filter-mapping&gt;</span>
        <span class="nt">&lt;filter-name&gt;</span>MDCClearFilter<span class="nt">&lt;/filter-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/filter-mapping&gt;</span>

    <span class="nt">&lt;filter&gt;</span>
        <span class="nt">&lt;filter-name&gt;</span>exceptionLoggingFilter<span class="nt">&lt;/filter-name&gt;</span>
        <span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="nt">&lt;/filter-class&gt;</span>
    <span class="nt">&lt;/filter&gt;</span>
    <span class="nt">&lt;filter-mapping&gt;</span>
        <span class="nt">&lt;filter-name&gt;</span>exceptionLoggingFilter<span class="nt">&lt;/filter-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/filter-mapping&gt;</span>

    <span class="nt">&lt;filter&gt;</span>
        <span class="nt">&lt;filter-name&gt;</span>XTrackMDCPutFilter<span class="nt">&lt;/filter-name&gt;</span>
        <span class="nt">&lt;filter-class&gt;</span>org.terasoluna.gfw.web.logging.mdc.XTrackMDCPutFilter<span class="nt">&lt;/filter-class&gt;</span>
    <span class="nt">&lt;/filter&gt;</span>
    <span class="nt">&lt;filter-mapping&gt;</span>
        <span class="nt">&lt;filter-name&gt;</span>XTrackMDCPutFilter<span class="nt">&lt;/filter-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/filter-mapping&gt;</span>

    <span class="nt">&lt;filter&gt;</span>
        <span class="nt">&lt;filter-name&gt;</span>CharacterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
        <span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="nt">&lt;/filter-class&gt;</span>
        <span class="nt">&lt;init-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>encoding<span class="nt">&lt;/param-name&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>UTF-8<span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/init-param&gt;</span>
        <span class="nt">&lt;init-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>forceEncoding<span class="nt">&lt;/param-name&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>true<span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/init-param&gt;</span>
    <span class="nt">&lt;/filter&gt;</span>
    <span class="nt">&lt;filter-mapping&gt;</span>
        <span class="nt">&lt;filter-name&gt;</span>CharacterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/filter-mapping&gt;</span>

    <span class="nt">&lt;filter&gt;</span>
        <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
        <span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="nt">&lt;/filter-class&gt;</span>
    <span class="nt">&lt;/filter&gt;</span>

    <span class="nt">&lt;filter-mapping&gt;</span>
        <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/filter-mapping&gt;</span>


<span class="hll">    <span class="c">&lt;!-- (4) --&gt;</span>
</span>    <span class="nt">&lt;servlet&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>appServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
        <span class="nt">&lt;init-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
            <span class="c">&lt;!-- ApplicationContext for Spring MVC --&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>classpath*:META-INF/spring/spring-mvc.xml<span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/init-param&gt;</span>
        <span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
    <span class="nt">&lt;/servlet&gt;</span>

    <span class="nt">&lt;servlet-mapping&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>appServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/servlet-mapping&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (5) --&gt;</span>
</span>    <span class="nt">&lt;jsp-config&gt;</span>
        <span class="nt">&lt;jsp-property-group&gt;</span>
            <span class="nt">&lt;url-pattern&gt;</span>*.jsp<span class="nt">&lt;/url-pattern&gt;</span>
            <span class="nt">&lt;el-ignored&gt;</span>false<span class="nt">&lt;/el-ignored&gt;</span>
            <span class="nt">&lt;page-encoding&gt;</span>UTF-8<span class="nt">&lt;/page-encoding&gt;</span>
            <span class="nt">&lt;scripting-invalid&gt;</span>false<span class="nt">&lt;/scripting-invalid&gt;</span>
            <span class="nt">&lt;include-prelude&gt;</span>/WEB-INF/views/common/include.jsp<span class="nt">&lt;/include-prelude&gt;</span>
        <span class="nt">&lt;/jsp-property-group&gt;</span>
    <span class="nt">&lt;/jsp-config&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (6) --&gt;</span>
</span>    <span class="nt">&lt;error-page&gt;</span>
        <span class="nt">&lt;error-code&gt;</span>500<span class="nt">&lt;/error-code&gt;</span>
        <span class="nt">&lt;location&gt;</span>/WEB-INF/views/common/error/systemError.jsp<span class="nt">&lt;/location&gt;</span>
    <span class="nt">&lt;/error-page&gt;</span>
    <span class="nt">&lt;error-page&gt;</span>
        <span class="nt">&lt;error-code&gt;</span>404<span class="nt">&lt;/error-code&gt;</span>
        <span class="nt">&lt;location&gt;</span>/WEB-INF/views/common/error/resourceNotFoundError.jsp<span class="nt">&lt;/location&gt;</span>
    <span class="nt">&lt;/error-page&gt;</span>
    <span class="nt">&lt;error-page&gt;</span>
        <span class="nt">&lt;exception-type&gt;</span>java.lang.Exception<span class="nt">&lt;/exception-type&gt;</span>
        <span class="nt">&lt;location&gt;</span>/WEB-INF/views/common/error/unhandledSystemError.html<span class="nt">&lt;/location&gt;</span>
    <span class="nt">&lt;/error-page&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (7) --&gt;</span>
</span>    <span class="nt">&lt;session-config&gt;</span>
        <span class="c">&lt;!-- 30min --&gt;</span>
        <span class="nt">&lt;session-timeout&gt;</span>30<span class="nt">&lt;/session-timeout&gt;</span>
    <span class="nt">&lt;/session-config&gt;</span>

<span class="nt">&lt;/web-app&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Declaration to use Servlet3.0.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">Definition of servlet context listener.</div>
</div>
<p>In the blank project,</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">ContextLoaderListener</span></code> is used to create an <code class="docutils literal"><span class="pre">ApplicationContext</span></code>  for entire application</li>
<li><code class="docutils literal"><span class="pre">HttpSessionEventLoggingListener</span></code> is used to log output the HTTPSession operations</li>
</ul>
<p class="last">are configured.</p>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">Definition of servlet filter.</div>
</div>
<p>In the blank project,</p>
<ul class="simple">
<li>Servlet filter provided by the common library</li>
<li><code class="docutils literal"><span class="pre">CharacterEncodingFilter</span></code> for specifing the character encoding provided by the Spring Framework</li>
<li>Servlet filter for authentication and authorization provided by the Spring Security</li>
</ul>
<p class="last">are configured.</p>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Definition of DispatcherServlet that is the entry point of Spring MVC.</div>
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">ApplicationContext</span></code> used in the DispatcherServlet is the child of <code class="docutils literal"><span class="pre">ApplicationContext</span></code> created in step (2).</div>
<div class="line">It is also possible to use components loaded in (2) by setting <code class="docutils literal"><span class="pre">ApplicationContext</span></code> created at step (2) as a parent.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">Common definition of JSP.</div>
</div>
<p>In the blank project,</p>
<ul class="simple">
<li>EL expression can be used in JSP</li>
<li>UTF-8 as the JSP page encoding</li>
<li>Scripting can be used in JSP</li>
<li>Included <code class="file docutils literal"><span class="pre">/WEB-INF/views/common/include.jsp</span></code> at the beginning of each JSP</li>
</ul>
<p class="last">are configured.</p>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">Definition of error page.</div>
</div>
<p>In the blank project,</p>
<ul class="simple">
<li>Respond HTTP status code <code class="docutils literal"><span class="pre">404</span></code> or <code class="docutils literal"><span class="pre">500</span></code> to the servlet container</li>
<li>Exception notification to the servlet container</li>
</ul>
<p class="last">related transition destination are defined.</p>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">Definition of session management.</div>
</div>
<p>In the blank project,</p>
<ul class="simple">
<li>30 minutes as a session time-out</li>
</ul>
<p class="last">are defined.</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="common-jsp">
<h4><a class="toc-backref" href="#id62">10.1.7.1.2. Common JSP</a><a class="headerlink" href="#common-jsp" title="Permalink to this headline">¶</a></h4>
<p>Tag library settings applied to all JSP are done in Include JSP.</p>
<p>Following settings are done in created blank project <code class="file docutils literal"><span class="pre">src/main/webapp/WEB-INF/views/common/include.jsp</span></code>.</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="hll"><span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">session</span><span class="o">=</span><span class="s">&quot;false&quot;</span><span class="k">%&gt;</span>
<span class="hll"><span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;c&quot;</span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://java.sun.com/jsp/jstl/fmt&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;fmt&quot;</span><span class="k">%&gt;</span>
<span class="hll"><span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/tags&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;spring&quot;</span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/tags/form&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;form&quot;</span><span class="k">%&gt;</span>
<span class="hll"><span class="c">&lt;!-- (4) --&gt;</span>
</span><span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/security/tags&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;sec&quot;</span><span class="k">%&gt;</span>
<span class="hll"><span class="c">&lt;!-- (5) --&gt;</span>
</span><span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://terasoluna.org/functions&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;f&quot;</span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://terasoluna.org/tags&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;t&quot;</span><span class="k">%&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Definition to avoid session creation while JSP execution.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Definition standard tag library.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Definition tag library for Spring MVC.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Definition tag library for Spring Security.(However, it is not used in this tutorial)</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Definition EL function and tag library provided in common library.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="bean-definition-file">
<h4><a class="toc-backref" href="#id63">10.1.7.1.3. Bean definition file</a><a class="headerlink" href="#bean-definition-file" title="Permalink to this headline">¶</a></h4>
<p>Following Bean definition files and property files are generated in created blank project.</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">src/main/resources/META-INF/spring/applicationContext.xml</span></code></li>
<li><code class="file docutils literal"><span class="pre">src/main/resources/META-INF/spring/todo-domain.xml</span></code></li>
<li><code class="file docutils literal"><span class="pre">src/main/resources/META-INF/spring/todo-infra.xml</span></code></li>
<li><code class="file docutils literal"><span class="pre">src/main/resources/META-INF/spring/todo-infra.properties</span></code></li>
<li><code class="file docutils literal"><span class="pre">src/main/resources/META-INF/spring/todo-env.xml</span></code></li>
<li><code class="file docutils literal"><span class="pre">src/main/resources/META-INF/spring/spring-mvc.xml</span></code></li>
<li><code class="file docutils literal"><span class="pre">src/main/resources/META-INF/spring/spring-security.xml</span></code></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">todo-infra.properties</span></code> and <code class="docutils literal"><span class="pre">todo-env.xml</span></code> are not created while creating blank project that does not dependent on the O/R Mapper.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In this guideline, it is recommended to split Bean definition file for each role (layer).</p>
<p class="last">By this way, what is defined in which file can be easily understood and improves the ease of maintenance.
It is not effective in case of small application like tutorial but  more effective in case of large scale application.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="applicationcontext-xml">
<h5>10.1.7.1.3.1. applicationContext.xml<a class="headerlink" href="#applicationcontext-xml" title="Permalink to this headline">¶</a></h5>
<p>Perform entire Todo application related settings in the <code class="file docutils literal"><span class="pre">applicationContext.xml</span></code>.</p>
<div class="line-block">
<div class="line">Following settings are done in created blank project <code class="file docutils literal"><span class="pre">src/main/resources/META-INF/spring/applicationContext.xml</span></code>.</div>
<div class="line">In addition, a description of the components that are not used in the tutorial are omitted.</div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
    <span class="na">xmlns:aop=</span><span class="s">&quot;http://www.springframework.org/schema/aop&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span>
<span class="s">        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span><span class="nt">&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&quot;classpath:/META-INF/spring/todo-domain.xml&quot;</span> <span class="nt">/&gt;</span>
</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;passwordEncoder&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder&quot;</span> <span class="nt">/&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;context:property-placeholder</span>
</span><span class="hll">        <span class="na">location=</span><span class="s">&quot;classpath*:/META-INF/spring/*.properties&quot;</span> <span class="nt">/&gt;</span>
</span>
<span class="hll">    <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.dozer.spring.DozerBeanMapperFactoryBean&quot;</span><span class="nt">&gt;</span>
</span>        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;mappingFiles&quot;</span>
            <span class="na">value=</span><span class="s">&quot;classpath*:/META-INF/dozer/**/*-mapping.xml&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!-- Message --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;messageSource&quot;</span>
        <span class="na">class=</span><span class="s">&quot;org.springframework.context.support.ResourceBundleMessageSource&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;basenames&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;list&gt;</span>
                <span class="nt">&lt;value&gt;</span>i18n/application-messages<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;/list&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!-- Exception Code Resolver. --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;exceptionCodeResolver&quot;</span>
        <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.exception.SimpleMappingExceptionCodeResolver&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- Setting and Customization by project. --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionMappings&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;map&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;ResourceNotFoundException&quot;</span> <span class="na">value=</span><span class="s">&quot;e.xx.fw.5001&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;InvalidTransactionTokenException&quot;</span> <span class="na">value=</span><span class="s">&quot;e.xx.fw.7001&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;BusinessException&quot;</span> <span class="na">value=</span><span class="s">&quot;e.xx.fw.8001&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;.DataAccessException&quot;</span> <span class="na">value=</span><span class="s">&quot;e.xx.fw.9002&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/map&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultExceptionCode&quot;</span> <span class="na">value=</span><span class="s">&quot;e.xx.fw.9001&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!-- Exception Logger. --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;exceptionLogger&quot;</span>
        <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.exception.ExceptionLogger&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionCodeResolver&quot;</span> <span class="na">ref=</span><span class="s">&quot;exceptionCodeResolver&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!-- Filter. --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;exceptionLoggingFilter&quot;</span>
        <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.exception.ExceptionLoggingFilter&quot;</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionLogger&quot;</span> <span class="na">ref=</span><span class="s">&quot;exceptionLogger&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Import Bean definition file related to domain layer.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Loading configuration of the property file.</div>
<div class="line">Load all property files stored under the <code class="docutils literal"><span class="pre">src/main/resources/META-INF/spring</span></code>.</div>
<div class="line">Using this setting, it is possible to insert property file value in  <code class="docutils literal"><span class="pre">${propertyName}</span></code> format in Bean definition file and to inject using <code class="docutils literal"><span class="pre">&#64;Value(&quot;${propertyName}&quot;)</span></code> in Java class.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define Dozer Mapper of Bean conversion library.</div>
<div class="line">For the mapping file, refer to <a class="reference external" href="http://dozer.sourceforge.net/documentation/mappings.html">Dozer manual</a>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>By inserting following type of check-mark in [Configure Namespace] tab of the editor,
selected XML schema gets enabled and possible to supplement the input using Ctrl+Space at the time of XML editing.</p>
<p>It is recommended to select xsd file without version in [Namespace Versions].
By selecting the xsd file without version, always the latest xsd is used included in the jar
therefore no need to concern about the Spring version up.</p>
<blockquote class="last">
<div><div class="figure">
<a class="reference internal image-reference" href="../_images/image021.jpg"><img alt="../_images/image021.jpg" src="../_images/image021.jpg" style="width: 90%;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image023.png"><img alt="../_images/image023.png" src="../_images/image023.png" style="width: 60%;" /></a>
</div>
</div></blockquote>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="todo-domain-xml">
<h5>10.1.7.1.3.2. todo-domain.xml<a class="headerlink" href="#todo-domain-xml" title="Permalink to this headline">¶</a></h5>
<p>Perform the domain layer related settings of the Todo application in <code class="file docutils literal"><span class="pre">todo-domain.xml</span></code>.</p>
<div class="line-block">
<div class="line">Following settings are done in created blank project <code class="file docutils literal"><span class="pre">src/main/resources/META-INF/spring/todo-domain.xml</span></code>.</div>
<div class="line">In addition, a description of the components that are not used in the tutorial are omitted.</div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
    <span class="na">xmlns:aop=</span><span class="s">&quot;http://www.springframework.org/schema/aop&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span>
<span class="s">        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span><span class="nt">&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&quot;classpath:META-INF/spring/todo-infra.xml&quot;</span> <span class="nt">/&gt;</span>
</span>    <span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&quot;classpath*:META-INF/spring/**/*-codelist.xml&quot;</span> <span class="nt">/&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&quot;todo.domain&quot;</span> <span class="nt">/&gt;</span>
</span>
    <span class="c">&lt;!-- AOP. --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;resultMessagesLoggingInterceptor&quot;</span>
        <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.exception.ResultMessagesLoggingInterceptor&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionLogger&quot;</span> <span class="na">ref=</span><span class="s">&quot;exceptionLogger&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;aop:config&gt;</span>
        <span class="nt">&lt;aop:advisor</span> <span class="na">advice-ref=</span><span class="s">&quot;resultMessagesLoggingInterceptor&quot;</span>
            <span class="na">pointcut=</span><span class="s">&quot;@within(org.springframework.stereotype.Service)&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/aop:config&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Import Bean definition file related to infrastructure layer.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Components under todo.domain package are target of component scan.</div>
<div class="line">Thus, by attaching annotations like <code class="docutils literal"><span class="pre">&#64;Repository</span></code> , <code class="docutils literal"><span class="pre">&#64;Service</span></code> etc to the class under todo.domain package, it get registered as Bean of Spring Framework.</div>
<div class="line">It is possible to use registered classes (Bean) by doing DI in Controller and Service class.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The <code class="docutils literal"><span class="pre">&lt;tx:annotation-driven&gt;</span></code> tag is set in order to enable the transaction management by <code class="docutils literal"><span class="pre">&#64;Transactional</span></code> annotation
while creating O/R Mapper dependent blank project.</p>
<blockquote class="last">
<div><div class="highlight-xml"><div class="highlight"><pre><span></span> <span class="nt">&lt;tx:annotation-driven</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="todo-infra-xml">
<h5>10.1.7.1.3.3. todo-infra.xml<a class="headerlink" href="#todo-infra-xml" title="Permalink to this headline">¶</a></h5>
<p>Perform infrastructure layer related settings of the TODO application in <code class="file docutils literal"><span class="pre">todo-infra.xml</span></code>.</p>
<p>Following settings are done
in created blank project <code class="file docutils literal"><span class="pre">src/main/resources/META-INF/spring/todo-infra.xml</span></code>.</p>
<p>Since configuration of <code class="file docutils literal"><span class="pre">todo-infra.xml</span></code> is significantly different by the infrastructure layer,
description of each blank project done.
You may skip the explanation other than the created blank project.</p>
<div class="section" id="todo-infra-xml-if-creating-blank-project-that-does-not-dependent-on-the-o-r-mapper">
<h6>10.1.7.1.3.3.1. todo-infra.xml if creating blank project that does not dependent on the O/R Mapper<a class="headerlink" href="#todo-infra-xml-if-creating-blank-project-that-does-not-dependent-on-the-o-r-mapper" title="Permalink to this headline">¶</a></h6>
<p>Empty definition file is created as follows while creating blank project that does not dependent on the O/R Mapper.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="nt">&gt;</span>


<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="todo-infra-xml-of-blank-project-created-for-mybatis3">
<h6>10.1.7.1.3.3.2. todo-infra.xml of blank project created for MyBatis3<a class="headerlink" href="#todo-infra-xml-of-blank-project-created-for-mybatis3" title="Permalink to this headline">¶</a></h6>
<p>The following settings are done in created MyBatis3 project.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span> <span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
 <span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
        <span class="na">xmlns:mybatis=</span><span class="s">&quot;http://mybatis.org/schema/mybatis-spring&quot;</span>
        <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
     <span class="na">xsi:schemaLocation=</span><span class="s">&quot;</span>
<span class="s">         http://www.springframework.org/schema/beans</span>
<span class="s">         http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">         http://mybatis.org/schema/mybatis-spring</span>
<span class="s">         http://mybatis.org/schema/mybatis-spring.xsd&quot;</span><span class="nt">&gt;</span>

<span class="hll">      <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">     <span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&quot;classpath:/META-INF/spring/todo-env.xml&quot;</span> <span class="nt">/&gt;</span>
</span>
<span class="hll">      <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">     <span class="c">&lt;!-- define the SqlSessionFactory --&gt;</span>
</span><span class="hll">     <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;sqlSessionFactory&quot;</span> <span class="na">class=</span><span class="s">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">          <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">          <span class="c">&lt;!-- (4) --&gt;</span>
</span><span class="hll">         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;configLocation&quot;</span> <span class="na">value=</span><span class="s">&quot;classpath:/META-INF/mybatis/mybatis-config.xml&quot;</span> <span class="nt">/&gt;</span>
</span>     <span class="nt">&lt;/bean&gt;</span>

<span class="hll">      <span class="c">&lt;!-- (5) --&gt;</span>
</span><span class="hll">     <span class="c">&lt;!-- scan for Mappers --&gt;</span>
</span><span class="hll">     <span class="nt">&lt;mybatis:scan</span> <span class="na">base-package=</span><span class="s">&quot;todo.domain.repository&quot;</span> <span class="nt">/&gt;</span>
</span>
 <span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Import the Bean definition file that defines the environment dependent components(Such as DataSource and transaction manager).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The bean definition of <code class="docutils literal"><span class="pre">SqlSessionFactoryBean</span></code> as a component for generating a <code class="docutils literal"><span class="pre">SqlSessionFactory</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the bean configured DataSource in the <code class="docutils literal"><span class="pre">dataSource</span></code> property.</div>
<div class="line"><br /></div>
<div class="line">The connection is retrieved from the DataSource specified here by executing the SQL in MyBatis3 process.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the path of MyBatis configuration file in the <code class="docutils literal"><span class="pre">configLocation</span></code> property.</div>
<div class="line"><br /></div>
<div class="line">The specified file loaded while generating a <code class="docutils literal"><span class="pre">SqlSessionFactory</span></code></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define <code class="docutils literal"><span class="pre">&lt;mybatis:scan&gt;</span></code> for scanning the Mapper interface,</div>
<div class="line">Specify the base package in the <code class="docutils literal"><span class="pre">base-package</span></code> attribute that contains the Mapper interface.</div>
<div class="line"><br /></div>
<div class="line">Scanned the Mapper interface that stored under the specified package and</div>
<div class="line">automatically generated the thread-safe Mapper object (Proxy object of Mapper interface).</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><code class="file docutils literal"><span class="pre">mybatis-config.xml</span></code> is a configuration file that performs operational setting of MyBatis3.</p>
<p>The following settings are done by default in the blank project.</p>
<blockquote class="last">
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE configuration</span>
<span class="cp">  PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span>
<span class="cp">  &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span>
<span class="nt">&lt;configuration&gt;</span>

    <span class="c">&lt;!-- See http://mybatis.github.io/mybatis-3/configuration.html#settings --&gt;</span>
    <span class="nt">&lt;settings&gt;</span>
        <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;lazyLoadingEnabled&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;aggressiveLazyLoading&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
<span class="c">&lt;!--</span>
<span class="c">        &lt;setting name=&quot;defaultExecutorType&quot; value=&quot;REUSE&quot; /&gt;</span>
<span class="c">        &lt;setting name=&quot;jdbcTypeForNull&quot; value=&quot;NULL&quot; /&gt;</span>
<span class="c">        &lt;setting name=&quot;proxyFactory&quot; value=&quot;JAVASSIST&quot; /&gt;</span>
<span class="c">        &lt;setting name=&quot;localCacheScope&quot; value=&quot;STATEMENT&quot; /&gt;</span>
<span class="c">--&gt;</span>
    <span class="nt">&lt;/settings&gt;</span>

    <span class="nt">&lt;typeAliases&gt;</span>
        <span class="nt">&lt;package</span> <span class="na">name=</span><span class="s">&quot;todo.domain.model&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;package</span> <span class="na">name=</span><span class="s">&quot;todo.domain.repository&quot;</span> <span class="nt">/&gt;</span>
<span class="c">&lt;!--</span>
<span class="c">        &lt;package name=&quot;todo.infra.mybatis.typehandler&quot; /&gt;</span>
<span class="c">--&gt;</span>
    <span class="nt">&lt;/typeAliases&gt;</span>

    <span class="nt">&lt;typeHandlers&gt;</span>
<span class="c">&lt;!--</span>
<span class="c">        &lt;package name=&quot;todo.infra.mybatis.typehandler&quot; /&gt;</span>
<span class="c">--&gt;</span>
    <span class="nt">&lt;/typeHandlers&gt;</span>

<span class="nt">&lt;/configuration&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="todo-infra-xml-of-blank-project-created-for-jpa">
<h6>10.1.7.1.3.3.3. todo-infra.xml of blank project created for JPA<a class="headerlink" href="#todo-infra-xml-of-blank-project-created-for-jpa" title="Permalink to this headline">¶</a></h6>
<p>The following settings are done in created JPA blank project.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">xmlns:jpa=</span><span class="s">&quot;http://www.springframework.org/schema/data/jpa&quot;</span>
    <span class="na">xmlns:util=</span><span class="s">&quot;http://www.springframework.org/schema/util&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd</span>
<span class="s">        http://www.springframework.org/schema/data/jpa http://www.springframework.org/schema/data/jpa/spring-jpa.xsd&quot;</span><span class="nt">&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&quot;classpath:/META-INF/spring/todo-env.xml&quot;</span> <span class="nt">/&gt;</span>
</span>
<span class="hll">    <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;jpa:repositories</span> <span class="na">base-package=</span><span class="s">&quot;todo.domain.repository&quot;</span><span class="nt">&gt;&lt;/jpa:repositories&gt;</span>
</span>
<span class="hll">    <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;jpaVendorAdapter&quot;</span>
</span><span class="hll">        <span class="na">class=</span><span class="s">&quot;org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter&quot;</span><span class="nt">&gt;</span>
</span>        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;showSql&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;database&quot;</span> <span class="na">value=</span><span class="s">&quot;${database}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (4) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;bean</span>
</span><span class="hll">        <span class="na">class=</span><span class="s">&quot;org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean&quot;</span>
</span>        <span class="na">id=</span><span class="s">&quot;entityManagerFactory&quot;</span><span class="nt">&gt;</span>
<span class="hll">        <span class="c">&lt;!-- (5) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;packagesToScan&quot;</span> <span class="na">value=</span><span class="s">&quot;todo.domain.model&quot;</span> <span class="nt">/&gt;</span>
</span>        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;jpaVendorAdapter&quot;</span> <span class="na">ref=</span><span class="s">&quot;jpaVendorAdapter&quot;</span> <span class="nt">/&gt;</span>
<span class="hll">        <span class="c">&lt;!-- (6) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;jpaPropertyMap&quot;</span><span class="nt">&gt;</span>
</span>            <span class="nt">&lt;util:map&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;hibernate.hbm2ddl.auto&quot;</span> <span class="na">value=</span><span class="s">&quot;&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;hibernate.ejb.naming_strategy&quot;</span>
                    <span class="na">value=</span><span class="s">&quot;org.hibernate.cfg.ImprovedNamingStrategy&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;hibernate.connection.charSet&quot;</span> <span class="na">value=</span><span class="s">&quot;UTF-8&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;hibernate.show_sql&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;hibernate.format_sql&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;hibernate.use_sql_comments&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;hibernate.jdbc.batch_size&quot;</span> <span class="na">value=</span><span class="s">&quot;30&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;hibernate.jdbc.fetch_size&quot;</span> <span class="na">value=</span><span class="s">&quot;100&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/util:map&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Import the Bean definition file that defines the environment dependent components(Such as DataSource and transaction manager).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Automatically generate the implementation class from Repository interface using the Spring Data JPA.</div>
<div class="line">Specify the package in <code class="docutils literal"><span class="pre">base-package</span></code> attribute of <code class="docutils literal"><span class="pre">&lt;jpa:repository&gt;</span></code> tag that contains the Repository.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Configure JPA implementation vendor.</div>
<div class="line">In order to use Hibernate, <code class="docutils literal"><span class="pre">HibernateJpaVendorAdapter</span></code> is defined as a JPA implementation.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define the <code class="docutils literal"><span class="pre">EntityManager</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the package name that treated as a JPA entity classes.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Perform the Hibernate related detail settings.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="todo-infra-properties">
<h5>10.1.7.1.3.4. todo-infra.properties<a class="headerlink" href="#todo-infra-properties" title="Permalink to this headline">¶</a></h5>
<p>Perform environment dependent infrastructure layer configuration of Todo application in the <code class="file docutils literal"><span class="pre">todo-infra.properties</span></code>.</p>
<p>The <code class="file docutils literal"><span class="pre">todo-infra.properties</span></code> is not created while creating blank project that does not dependent on the O/R Mapper.</p>
<p>Following settings are done in created blank project <code class="file docutils literal"><span class="pre">src/main/resources/META-INF/spring/todo-infra.properties</span></code>.</p>
<div class="highlight-properties"><div class="highlight"><pre><span></span><span class="hll"><span class="c"># (1)</span>
</span><span class="na">database</span><span class="o">=</span><span class="s">H2</span>
<span class="na">database.url</span><span class="o">=</span><span class="s">jdbc:h2:mem:todo;DB_CLOSE_DELAY=-1;</span>
<span class="na">database.username</span><span class="o">=</span><span class="s">sa</span>
<span class="na">database.password</span><span class="o">=</span>
<span class="na">database.driverClassName</span><span class="o">=</span><span class="s">org.h2.Driver</span>
<span class="hll"><span class="c"># (2)</span>
</span><span class="c"># connection pool</span>
<span class="na">cp.maxActive</span><span class="o">=</span><span class="s">96</span>
<span class="na">cp.maxIdle</span><span class="o">=</span><span class="s">16</span>
<span class="na">cp.minIdle</span><span class="o">=</span><span class="s">0</span>
<span class="na">cp.maxWait</span><span class="o">=</span><span class="s">60000</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Database related settings.</div>
<div class="line">In this tutorial, H2 Database is used to save the setup time of the database.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Connection pool related settings.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The configuration value of this is referred from <code class="file docutils literal"><span class="pre">todo-env.xml</span></code>.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="todo-env-xml">
<h5>10.1.7.1.3.5. todo-env.xml<a class="headerlink" href="#todo-env-xml" title="Permalink to this headline">¶</a></h5>
<p>In the <code class="file docutils literal"><span class="pre">todo-env.xml</span></code> file, define such components which are differing depending upon the environment.</p>
<p>Following settings are done in created blank project <code class="docutils literal"><span class="pre">src/main/resources/META-INF/spring/todo-env.xml</span></code>.</p>
<p>Here, the file stored in the blank project for MyBatis3 is described as an example.
Furthermore, the <code class="file docutils literal"><span class="pre">todo-env.xml</span></code> is not created while creating blank project that does not access the database.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;dateFactory&quot;</span> <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.date.jodatime.DefaultJodaTimeDateFactory&quot;</span> <span class="nt">/&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (1) --&gt;</span>
</span>    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;realDataSource&quot;</span> <span class="na">class=</span><span class="s">&quot;org.apache.commons.dbcp2.BasicDataSource&quot;</span>
        <span class="na">destroy-method=</span><span class="s">&quot;close&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;driverClassName&quot;</span> <span class="na">value=</span><span class="s">&quot;${database.driverClassName}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;url&quot;</span> <span class="na">value=</span><span class="s">&quot;${database.url}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span> <span class="na">value=</span><span class="s">&quot;${database.username}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">value=</span><span class="s">&quot;${database.password}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultAutoCommit&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxTotal&quot;</span> <span class="na">value=</span><span class="s">&quot;${cp.maxActive}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxIdle&quot;</span> <span class="na">value=</span><span class="s">&quot;${cp.maxIdle}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;minIdle&quot;</span> <span class="na">value=</span><span class="s">&quot;${cp.minIdle}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxWaitMillis&quot;</span> <span class="na">value=</span><span class="s">&quot;${cp.maxWait}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (2) --&gt;</span>
</span>    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">class=</span><span class="s">&quot;net.sf.log4jdbc.Log4jdbcProxyDataSource&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">ref=</span><span class="s">&quot;realDataSource&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!--  REMOVE THIS LINE IF YOU USE JPA</span>
<span class="c">    &lt;bean id=&quot;transactionManager&quot;</span>
<span class="c">        class=&quot;org.springframework.orm.jpa.JpaTransactionManager&quot;&gt;</span>
<span class="c">        &lt;property name=&quot;entityManagerFactory&quot; ref=&quot;entityManagerFactory&quot; /&gt;</span>
<span class="c">    &lt;/bean&gt;</span>
<span class="c">          REMOVE THIS LINE IF YOU USE JPA  --&gt;</span>
    <span class="c">&lt;!--  REMOVE THIS LINE IF YOU USE MyBatis2</span>
<span class="c">    &lt;bean id=&quot;transactionManager&quot;</span>
<span class="c">        class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span>
<span class="c">        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;</span>
<span class="c">    &lt;/bean&gt;</span>
<span class="c">          REMOVE THIS LINE IF YOU USE MyBatis2  --&gt;</span>
<span class="hll">    <span class="c">&lt;!-- (3) --&gt;</span>
</span>    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;transactionManager&quot;</span>
        <span class="na">class=</span><span class="s">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Setting of the actual DataSource.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Setting of the DataSource.</div>
<div class="line">Specify the DataSource that having JDBC-related logging feature.</div>
<div class="line">By use of <code class="docutils literal"><span class="pre">net.sf.log4jdbc.Log4jdbcProxyDataSource</span></code> , you can output JDBC related log such as SQL log which could be very useful for debugging.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Setting of the Transaction Manager.</div>
<div class="line">Specify the <code class="docutils literal"><span class="pre">transactionManager</span></code> in id attribute.</div>
<div class="line">In case of specifing different name, it is necessary to specify the transaction manager name in <code class="docutils literal"><span class="pre">&lt;tx:annotation-driven&gt;</span></code> tag also.</div>
<div class="line"><br /></div>
<div class="line">In the blank project, transaction controlling class (<code class="docutils literal"><span class="pre">org.springframework.jdbc.datasource.DataSourceTransactionManager</span></code>) is configured using JDBC API.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If blank project created for JPA, Transaction Manager,
transaction controlling class (<code class="docutils literal"><span class="pre">org.springframework.orm.jpa.JpaTransactionManager</span></code>) is configured using JPA API.</p>
<blockquote class="last">
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;transactionManager&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.springframework.orm.jpa.JpaTransactionManager&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;entityManagerFactory&quot;</span> <span class="na">ref=</span><span class="s">&quot;entityManagerFactory&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="spring-mvc-xml">
<h5>10.1.7.1.3.6. spring-mvc.xml<a class="headerlink" href="#spring-mvc-xml" title="Permalink to this headline">¶</a></h5>
<p>The Spring MVC related definitions are done in <code class="file docutils literal"><span class="pre">spring-mvc.xml</span></code>.</p>
<div class="line-block">
<div class="line">Following settings are done in created blank project <code class="file docutils literal"><span class="pre">src/main/resources/META-INF/spring/spring-mvc.xml</span></code>.</div>
<div class="line">In addition, a description of the components that are not used in the tutorial are omitted.</div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
    <span class="na">xmlns:mvc=</span><span class="s">&quot;http://www.springframework.org/schema/mvc&quot;</span> <span class="na">xmlns:util=</span><span class="s">&quot;http://www.springframework.org/schema/util&quot;</span>
    <span class="na">xmlns:aop=</span><span class="s">&quot;http://www.springframework.org/schema/aop&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd</span>
<span class="s">        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd</span>
<span class="s">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span>
<span class="s">        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span><span class="nt">&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (1) --&gt;</span>
</span>    <span class="nt">&lt;context:property-placeholder</span>
        <span class="na">location=</span><span class="s">&quot;classpath*:/META-INF/spring/*.properties&quot;</span> <span class="nt">/&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (2) --&gt;</span>
</span>    <span class="nt">&lt;mvc:annotation-driven&gt;</span>
        <span class="nt">&lt;mvc:argument-resolvers&gt;</span>
            <span class="nt">&lt;bean</span>
                <span class="na">class=</span><span class="s">&quot;org.springframework.data.web.PageableHandlerMethodArgumentResolver&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;bean</span>
                <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.method.annotation.AuthenticationPrincipalArgumentResolver&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/mvc:argument-resolvers&gt;</span>
    <span class="nt">&lt;/mvc:annotation-driven&gt;</span>

    <span class="nt">&lt;mvc:default-servlet-handler</span> <span class="nt">/&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (3) --&gt;</span>
</span>    <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&quot;todo.app&quot;</span> <span class="nt">/&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (4) --&gt;</span>
</span>    <span class="nt">&lt;mvc:resources</span> <span class="na">mapping=</span><span class="s">&quot;/resources/**&quot;</span>
        <span class="na">location=</span><span class="s">&quot;/resources/,classpath:META-INF/resources/&quot;</span>
        <span class="na">cache-period=</span><span class="s">&quot;#{60 * 60}&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;mvc:interceptors&gt;</span>
<span class="hll">        <span class="c">&lt;!-- (5) --&gt;</span>
</span>        <span class="nt">&lt;mvc:interceptor&gt;</span>
            <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&quot;/**&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/resources/**&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/**/*.html&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;bean</span>
                <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.logging.TraceLoggingInterceptor&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/mvc:interceptor&gt;</span>
        <span class="nt">&lt;mvc:interceptor&gt;</span>
            <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&quot;/**&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/resources/**&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/**/*.html&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;bean</span>
                <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.token.transaction.TransactionTokenInterceptor&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/mvc:interceptor&gt;</span>
        <span class="nt">&lt;mvc:interceptor&gt;</span>
            <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&quot;/**&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/resources/**&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/**/*.html&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.codelist.CodeListInterceptor&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;codeListIdPattern&quot;</span> <span class="na">value=</span><span class="s">&quot;CL_.+&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/bean&gt;</span>
        <span class="nt">&lt;/mvc:interceptor&gt;</span>
        <span class="c">&lt;!--  REMOVE THIS LINE IF YOU USE JPA</span>
<span class="c">        &lt;mvc:interceptor&gt;</span>
<span class="c">            &lt;mvc:mapping path=&quot;/**&quot; /&gt;</span>
<span class="c">            &lt;mvc:exclude-mapping path=&quot;/resources/**&quot; /&gt;</span>
<span class="c">            &lt;mvc:exclude-mapping path=&quot;/**/*.html&quot; /&gt;</span>
<span class="c">            &lt;bean</span>
<span class="c">                class=&quot;org.springframework.orm.jpa.support.OpenEntityManagerInViewInterceptor&quot; /&gt;</span>
<span class="c">        &lt;/mvc:interceptor&gt;</span>
<span class="c">            REMOVE THIS LINE IF YOU USE JPA  --&gt;</span>
    <span class="nt">&lt;/mvc:interceptors&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (6) --&gt;</span>
</span>    <span class="c">&lt;!-- Settings View Resolver. --&gt;</span>
    <span class="nt">&lt;mvc:view-resolvers&gt;</span>
        <span class="nt">&lt;mvc:jsp</span> <span class="na">prefix=</span><span class="s">&quot;/WEB-INF/views/&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/mvc:view-resolvers&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;requestDataValueProcessor&quot;</span>
        <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.mvc.support.CompositeRequestDataValueProcessor&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;constructor-arg&gt;</span>
            <span class="nt">&lt;util:list&gt;</span>
                <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.servlet.support.csrf.CsrfRequestDataValueProcessor&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;bean</span>
                    <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.token.transaction.TransactionTokenRequestDataValueProcessor&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/util:list&gt;</span>
        <span class="nt">&lt;/constructor-arg&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!-- Setting Exception Handling. --&gt;</span>
    <span class="c">&lt;!-- Exception Resolver. --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.exception.SystemExceptionResolver&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionCodeResolver&quot;</span> <span class="na">ref=</span><span class="s">&quot;exceptionCodeResolver&quot;</span> <span class="nt">/&gt;</span>
        <span class="c">&lt;!-- Setting and Customization by project. --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;order&quot;</span> <span class="na">value=</span><span class="s">&quot;3&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionMappings&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;map&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;ResourceNotFoundException&quot;</span> <span class="na">value=</span><span class="s">&quot;common/error/resourceNotFoundError&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;BusinessException&quot;</span> <span class="na">value=</span><span class="s">&quot;common/error/businessError&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;InvalidTransactionTokenException&quot;</span> <span class="na">value=</span><span class="s">&quot;common/error/transactionTokenError&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;.DataAccessException&quot;</span> <span class="na">value=</span><span class="s">&quot;common/error/dataAccessError&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/map&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;statusCodes&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;map&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;common/error/resourceNotFoundError&quot;</span> <span class="na">value=</span><span class="s">&quot;404&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;common/error/businessError&quot;</span> <span class="na">value=</span><span class="s">&quot;409&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;common/error/transactionTokenError&quot;</span> <span class="na">value=</span><span class="s">&quot;409&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;common/error/dataAccessError&quot;</span> <span class="na">value=</span><span class="s">&quot;500&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/map&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultErrorView&quot;</span> <span class="na">value=</span><span class="s">&quot;common/error/systemError&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultStatusCode&quot;</span> <span class="na">value=</span><span class="s">&quot;500&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
    <span class="c">&lt;!-- Setting AOP. --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;handlerExceptionResolverLoggingInterceptor&quot;</span>
        <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.exception.HandlerExceptionResolverLoggingInterceptor&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionLogger&quot;</span> <span class="na">ref=</span><span class="s">&quot;exceptionLogger&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;aop:config&gt;</span>
        <span class="nt">&lt;aop:advisor</span> <span class="na">advice-ref=</span><span class="s">&quot;handlerExceptionResolverLoggingInterceptor&quot;</span>
            <span class="na">pointcut=</span><span class="s">&quot;execution(* org.springframework.web.servlet.HandlerExceptionResolver.resolveException(..))&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/aop:config&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">Configuration of reading property file done</div>
</div>
<div class="last line-block">
<div class="line">Load all property files stored under the src/main/resources/META-INF/spring.</div>
<div class="line">Using this setting, it is possible to insert property file value in  <code class="docutils literal"><span class="pre">${propertyName}</span></code> format in Bean definition file and to inject using <code class="docutils literal"><span class="pre">&#64;Value(&quot;${propertyName}&quot;)</span></code> in Java class.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Carry out annotation based default settings of Spring MVC.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Components under todo.app package that holds classes of application layer are made target of component-scan.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">Carry out the settings for accessing the static resource (css, images, js etc.).</div>
</div>
<div class="line-block">
<div class="line">Set URL path to <code class="docutils literal"><span class="pre">mapping</span></code> attribute and physical path to <code class="docutils literal"><span class="pre">location</span></code> attribute.</div>
<div class="line">In case of this setting, when there is a request for <code class="docutils literal"><span class="pre">&lt;contextPath&gt;/rerources/app/css/styles.css</span></code>, the <code class="docutils literal"><span class="pre">WEB-INF/resources/app/css/styles.css</span></code> is searched. If not found, <code class="docutils literal"><span class="pre">META-INF/resources/app/css/styles.css</span></code> is searched in classpath (<code class="docutils literal"><span class="pre">src/main/resources</span></code> and jar).</div>
<div class="line">If <code class="docutils literal"><span class="pre">styles.css</span></code> is not stored anywhere, 404 error is returned.</div>
</div>
<div class="last line-block">
<div class="line">Here, cache period (3600 seconds = 60 minutes) of static resources is set in <code class="docutils literal"><span class="pre">cache-period</span></code> attribute.</div>
<div class="line"><code class="docutils literal"><span class="pre">cache-period=&quot;3600&quot;</span></code> is also correct, however, in order to demonstrate that it is 60 minutes, it is better to write as <code class="docutils literal"><span class="pre">cache-period=&quot;#{60</span> <span class="pre">*</span> <span class="pre">60}&quot;</span></code> which uses <a class="reference external" href="http://docs.spring.io/spring/docs/4.2.7.RELEASE/spring-framework-reference/html/expressions.html#expressions-beandef-xml-based">SpEL</a>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set interceptor that outputs trace log of controller processing.</div>
<div class="line">Set so that it excludes the path under<code class="docutils literal"><span class="pre">/resources</span></code> from mapping.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">Carry out the settings of <code class="docutils literal"><span class="pre">ViewResolver</span></code>.</div>
<div class="line">Using these settings, for example, when view name <code class="docutils literal"><span class="pre">&quot;hello&quot;</span></code> is returned from controller, <code class="docutils literal"><span class="pre">/WEB-INF/views/hello.jsp</span></code> is executed.</div>
</div>
<div class="last admonition tip">
<p class="first admonition-title">Tip</p>
<p><code class="docutils literal"><span class="pre">&lt;mvc:view-resolvers&gt;</span></code> element is a XML element that added from Spring Framework 4.1
By using <code class="docutils literal"><span class="pre">&lt;mvc:view-resolvers&gt;</span></code> element, it is possible to define <code class="docutils literal"><span class="pre">ViewResolver</span></code> simply.</p>
<p>The definition example of using the conventional <code class="docutils literal"><span class="pre">&lt;bean&gt;</span></code> element is shown below.</p>
<blockquote class="last">
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;viewResolver&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;prefix&quot;</span> <span class="na">value=</span><span class="s">&quot;/WEB-INF/views/&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;suffix&quot;</span> <span class="na">value=</span><span class="s">&quot;.jsp&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In blank project created for JPA, as a <code class="docutils literal"><span class="pre">&lt;mvc:interceptors&gt;</span></code> definition,
<code class="docutils literal"><span class="pre">OpenEntityManagerInViewInterceptor</span></code> definition is in enable state.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;mvc:interceptor&gt;</span>
    <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&quot;/**&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/resources/**&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/**/*.html&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;bean</span>
        <span class="na">class=</span><span class="s">&quot;org.springframework.orm.jpa.support.OpenEntityManagerInViewInterceptor&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/mvc:interceptor&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p class="last"><code class="docutils literal"><span class="pre">OpenEntityManagerInViewInterceptor</span></code> is a Interceptor that performs start and end of the life cycle of the <code class="docutils literal"><span class="pre">EntityManager</span></code>.
By adding this setting, the application layer (Controller or View class) Lazy Load is supported.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="spring-security-xml">
<h5>10.1.7.1.3.7. spring-security.xml<a class="headerlink" href="#spring-security-xml" title="Permalink to this headline">¶</a></h5>
<p>The Spring Security related definitions are done in <code class="file docutils literal"><span class="pre">spring-security.xml</span></code>.</p>
<div class="line-block">
<div class="line">Following settings are done in created blank project <code class="file docutils literal"><span class="pre">src/main/resources/META-INF/spring/spring-security.xml</span></code>.</div>
<div class="line">In addition, a description of the Spring Security configuration file is omitted in the tutorial. For the Spring Security configuration file, Refer [<a class="reference internal" href="TutorialSecurity.html"><span class="doc">Spring Security Tutorial</span></a>].</div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">xmlns:sec=</span><span class="s">&quot;http://www.springframework.org/schema/security&quot;</span>
    <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd</span>
<span class="s">        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;sec:http</span> <span class="na">pattern=</span><span class="s">&quot;/resources/**&quot;</span> <span class="na">security=</span><span class="s">&quot;none&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;sec:http&gt;</span>
        <span class="nt">&lt;sec:form-login</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;sec:logout</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;sec:access-denied-handler</span> <span class="na">ref=</span><span class="s">&quot;accessDeniedHandler&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;sec:custom-filter</span> <span class="na">ref=</span><span class="s">&quot;userIdMDCPutFilter&quot;</span> <span class="na">after=</span><span class="s">&quot;ANONYMOUS_FILTER&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;sec:session-management</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/sec:http&gt;</span>

    <span class="nt">&lt;sec:authentication-manager&gt;&lt;/sec:authentication-manager&gt;</span>

    <span class="c">&lt;!-- Change View for CSRF or AccessDenied --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;accessDeniedHandler&quot;</span>
        <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.access.DelegatingAccessDeniedHandler&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;map&gt;</span>
                <span class="nt">&lt;entry</span>
                    <span class="na">key=</span><span class="s">&quot;org.springframework.security.web.csrf.InvalidCsrfTokenException&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;bean</span>
                        <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.access.AccessDeniedHandlerImpl&quot;</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;errorPage&quot;</span>
                            <span class="na">value=</span><span class="s">&quot;/WEB-INF/views/common/error/invalidCsrfTokenError.jsp&quot;</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;/bean&gt;</span>
                <span class="nt">&lt;/entry&gt;</span>
                <span class="nt">&lt;entry</span>
                    <span class="na">key=</span><span class="s">&quot;org.springframework.security.web.csrf.MissingCsrfTokenException&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;bean</span>
                        <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.access.AccessDeniedHandlerImpl&quot;</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;errorPage&quot;</span>
                            <span class="na">value=</span><span class="s">&quot;/WEB-INF/views/common/error/missingCsrfTokenError.jsp&quot;</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;/bean&gt;</span>
                <span class="nt">&lt;/entry&gt;</span>
            <span class="nt">&lt;/map&gt;</span>
        <span class="nt">&lt;/constructor-arg&gt;</span>
        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;bean</span>
                <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.access.AccessDeniedHandlerImpl&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;errorPage&quot;</span>
                    <span class="na">value=</span><span class="s">&quot;/WEB-INF/views/common/error/accessDeniedError.jsp&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/bean&gt;</span>
        <span class="nt">&lt;/constructor-arg&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!-- Put UserID into MDC --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;userIdMDCPutFilter&quot;</span> <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.security.web.logging.UserIdMDCPutFilter&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="logback-xml">
<h4><a class="toc-backref" href="#id64">10.1.7.1.4. logback.xml</a><a class="headerlink" href="#logback-xml" title="Permalink to this headline">¶</a></h4>
<p>The log output related definitions are done in <code class="file docutils literal"><span class="pre">logback.xml</span></code>.</p>
<div class="line-block">
<div class="line">Following settings are done in created blank project <code class="file docutils literal"><span class="pre">src/main/resources/logback.xml</span></code>.</div>
<div class="line">In addition, a description of the log settings that are not used in the tutorial are omitted.</div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;configuration&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (1) --&gt;</span>
</span>    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;STDOUT&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;encoder&gt;</span>
            <span class="nt">&lt;pattern&gt;</span><span class="cp">&lt;![CDATA[date:%d{yyyy-MM-dd HH:mm:ss}\tthread:%thread\tX-Track:%X{X-Track}\tlevel:%-5level\tlogger:%-48logger{48}\tmessage:%msg%n]]&gt;</span><span class="nt">&lt;/pattern&gt;</span>
        <span class="nt">&lt;/encoder&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;APPLICATION_LOG_FILE&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;file&gt;</span>${app.log.dir:-log}/todo-application.log<span class="nt">&lt;/file&gt;</span>
        <span class="nt">&lt;rollingPolicy</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;fileNamePattern&gt;</span>${app.log.dir:-log}/todo-application-%d{yyyyMMdd}.log<span class="nt">&lt;/fileNamePattern&gt;</span>
            <span class="nt">&lt;maxHistory&gt;</span>7<span class="nt">&lt;/maxHistory&gt;</span>
        <span class="nt">&lt;/rollingPolicy&gt;</span>
        <span class="nt">&lt;encoder&gt;</span>
            <span class="nt">&lt;charset&gt;</span>UTF-8<span class="nt">&lt;/charset&gt;</span>
            <span class="nt">&lt;pattern&gt;</span><span class="cp">&lt;![CDATA[date:%d{yyyy-MM-dd HH:mm:ss}\tthread:%thread\tX-Track:%X{X-Track}\tlevel:%-5level\tlogger:%-48logger{48}\tmessage:%msg%n]]&gt;</span><span class="nt">&lt;/pattern&gt;</span>
        <span class="nt">&lt;/encoder&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;MONITORING_LOG_FILE&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;file&gt;</span>${app.log.dir:-log}/todo-monitoring.log<span class="nt">&lt;/file&gt;</span>
        <span class="nt">&lt;rollingPolicy</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;fileNamePattern&gt;</span>${app.log.dir:-log}/todo-monitoring-%d{yyyyMMdd}.log<span class="nt">&lt;/fileNamePattern&gt;</span>
            <span class="nt">&lt;maxHistory&gt;</span>7<span class="nt">&lt;/maxHistory&gt;</span>
        <span class="nt">&lt;/rollingPolicy&gt;</span>
        <span class="nt">&lt;encoder&gt;</span>
            <span class="nt">&lt;charset&gt;</span>UTF-8<span class="nt">&lt;/charset&gt;</span>
            <span class="nt">&lt;pattern&gt;</span><span class="cp">&lt;![CDATA[date:%d{yyyy-MM-dd HH:mm:ss}\tX-Track:%X{X-Track}\tlevel:%-5level\tmessage:%msg%n]]&gt;</span><span class="nt">&lt;/pattern&gt;</span>
        <span class="nt">&lt;/encoder&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="c">&lt;!-- Application Loggers --&gt;</span>
<span class="hll">    <span class="c">&lt;!-- (2) --&gt;</span>
</span>    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;todo&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;debug&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>

    <span class="c">&lt;!-- TERASOLUNA --&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.terasoluna.gfw&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;info&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>
<span class="hll">    <span class="c">&lt;!-- (3) --&gt;</span>
</span>    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.terasoluna.gfw.web.logging.TraceLoggingInterceptor&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;trace&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.terasoluna.gfw.common.exception.ExceptionLogger&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;info&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.terasoluna.gfw.common.exception.ExceptionLogger.Monitoring&quot;</span> <span class="na">additivity=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;error&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;MONITORING_LOG_FILE&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>

    <span class="c">&lt;!-- 3rdparty Loggers --&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.springframework&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;warn&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>

    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.springframework.web.servlet&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;info&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>

    <span class="c">&lt;!--  REMOVE THIS LINE IF YOU USE JPA</span>
<span class="c">    &lt;logger name=&quot;org.hibernate.engine.transaction&quot;&gt;</span>
<span class="c">        &lt;level value=&quot;debug&quot; /&gt;</span>
<span class="c">    &lt;/logger&gt;</span>
<span class="c">          REMOVE THIS LINE IF YOU USE JPA  --&gt;</span>
    <span class="c">&lt;!--  REMOVE THIS LINE IF YOU USE MyBatis3</span>
<span class="c">    &lt;logger name=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span>
<span class="c">        &lt;level value=&quot;debug&quot; /&gt;</span>
<span class="c">    &lt;/logger&gt;</span>
<span class="c">          REMOVE THIS LINE IF YOU USE MyBatis3  --&gt;</span>

    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;jdbc.sqltiming&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;debug&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>

    <span class="c">&lt;!-- only for development --&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;jdbc.resultsettable&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;debug&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>

    <span class="nt">&lt;root</span> <span class="na">level=</span><span class="s">&quot;warn&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;STDOUT&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;APPLICATION_LOG_FILE&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/root&gt;</span>

<span class="nt">&lt;/configuration&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set appender that outputs the log in standard output.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set so that log of debug level and above is output under todo package.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set log level to ‘trace’ for TraceLoggingInterceptor which is defined in spring-mvc.xml.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you create a blank project that uses the O/R Mapper, the logger to output transaction control-related log has been in enable state.</p>
<ul class="simple">
<li>Blank project for the JPA</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.hibernate.engine.transaction&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;debug&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/logger&gt;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Blank project for the MyBatis3</li>
</ul>
<blockquote class="last">
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;debug&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/logger&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="TutorialREST.html" title="10.2. Tutorial (Todo Application REST)"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="10. Tutorials"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.2.0.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >10. Tutorials</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013-2016, NTT DATA.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.3.Theme by <a href="http://github.com/vkvn">vkvn</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>
