<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4.13. Ajax &#8212; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.3.0.RELEASE documentation</title>
    
    <link rel="stylesheet" href="../../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '5.3.0.RELEASE',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.3.0.RELEASE documentation" href="../../index.html" />
    <link rel="up" title="4. Web Application Development Features" href="index.html" />
    <link rel="next" title="4.14. Health Check" href="HealthCheck.html" />
    <link rel="prev" title="4.12. JSP Tag Libraries and EL Functions offered by common library" href="TagLibAndELFunctions.html" /><script src="../../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../../_static/solarized-dark.css" rel="stylesheet">
<link href="../../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="HealthCheck.html" title="4.14. Health Check"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="TagLibAndELFunctions.html" title="4.12. JSP Tag Libraries and EL Functions offered by common library"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.3.0.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">4. Web Application Development Features</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>

  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4.13. Ajax</a><ul>
<li><a class="reference internal" href="#overview">4.13.1. Overview</a></li>
<li><a class="reference internal" href="#how-to-use">4.13.2. How to use</a><ul>
<li><a class="reference internal" href="#application-settings">4.13.2.1. Application settings</a><ul>
<li><a class="reference internal" href="#settings-to-enable-the-ajax-functionality-in-spring-mvc">4.13.2.1.1. Settings to enable the Ajax functionality in Spring MVC</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementing-controller">4.13.2.2. Implementing Controller</a><ul>
<li><a class="reference internal" href="#fetching-data">4.13.2.2.1. Fetching data</a></li>
<li><a class="reference internal" href="#posting-form-data">4.13.2.2.2. Posting form data</a></li>
<li><a class="reference internal" href="#posting-form-data-in-json-format">4.13.2.2.3. Posting form data in JSON format</a></li>
</ul>
</li>
<li><a class="reference internal" href="#input-error-handling">4.13.2.3. Input error handling</a><ul>
<li><a class="reference internal" href="#handling-bindexception">4.13.2.3.1. Handling BindException</a></li>
<li><a class="reference internal" href="#handling-methodargumentnotvalidexception">4.13.2.3.2. Handling MethodArgumentNotValidException</a></li>
<li><a class="reference internal" href="#handling-httpmessagenotreadableexception">4.13.2.3.3. Handling HttpMessageNotReadableException</a></li>
<li><a class="reference internal" href="#handling-by-using-bindingresult">4.13.2.3.4. Handling by using BindingResult</a></li>
</ul>
</li>
<li><a class="reference internal" href="#business-error-handling">4.13.2.4. Business error handling</a><ul>
<li><a class="reference internal" href="#handling-business-exception-by-exception-handling-method">4.13.2.4.1. Handling business exception by exception handling method</a></li>
<li><a class="reference internal" href="#handling-business-exception-in-handler-method">4.13.2.4.2. Handling business exception in handler method</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="TagLibAndELFunctions.html"
                        title="previous chapter">4.12. JSP Tag Libraries and EL Functions offered by common library</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="HealthCheck.html"
                        title="next chapter">4.14. Health Check</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/ArchitectureInDetail/WebApplicationDetail/Ajax.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="ajax">
<h1>4.13. Ajax<a class="headerlink" href="#ajax" title="Permalink to this headline">¶</a></h1>
<div class="admonition caution">
  <p class="first admonition-title">Caution</p>
  <p><strong>This version is already obsolete</strong>. Please check <a href="http://terasolunaorg.github.io/guideline/">the latest guideline</a>.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of contents</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id1">Overview</a></li>
<li><a class="reference internal" href="#how-to-use" id="id2">How to use</a><ul>
<li><a class="reference internal" href="#application-settings" id="id3">Application settings</a><ul>
<li><a class="reference internal" href="#settings-to-enable-the-ajax-functionality-in-spring-mvc" id="id4">Settings to enable the Ajax functionality in Spring MVC</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementing-controller" id="id5">Implementing Controller</a><ul>
<li><a class="reference internal" href="#fetching-data" id="id6">Fetching data</a></li>
<li><a class="reference internal" href="#posting-form-data" id="id7">Posting form data</a></li>
<li><a class="reference internal" href="#posting-form-data-in-json-format" id="id8">Posting form data in JSON format</a></li>
</ul>
</li>
<li><a class="reference internal" href="#input-error-handling" id="id9">Input error handling</a><ul>
<li><a class="reference internal" href="#handling-bindexception" id="id10">Handling BindException</a></li>
<li><a class="reference internal" href="#handling-methodargumentnotvalidexception" id="id11">Handling MethodArgumentNotValidException</a></li>
<li><a class="reference internal" href="#handling-httpmessagenotreadableexception" id="id12">Handling HttpMessageNotReadableException</a></li>
<li><a class="reference internal" href="#handling-by-using-bindingresult" id="id13">Handling by using BindingResult</a></li>
</ul>
</li>
<li><a class="reference internal" href="#business-error-handling" id="id14">Business error handling</a><ul>
<li><a class="reference internal" href="#handling-business-exception-by-exception-handling-method" id="id15">Handling business exception by exception handling method</a></li>
<li><a class="reference internal" href="#handling-business-exception-in-handler-method" id="id16">Handling business exception in handler method</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id1">4.13.1. Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This section explains how to implement applications that use Ajax.</p>
<blockquote>
<div><div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p><strong>TBD</strong></p>
<blockquote class="last">
<div>Details regarding client side implementation etc. will follow in subsequent versions.</div></blockquote>
</div>
</div></blockquote>
<p>Ajax is the generic term used for group of techniques that perform the following asynchronous processes.</p>
<ul class="simple">
<li>Screen operations performed on the browser</li>
<li>HTTP communication with the server triggered by a screen operation and reflecting back the communication results to the user interface</li>
</ul>
<div class="line-block">
<div class="line">Ajax is often used to improve usability. This is because, screen operations can be continued during HTTP communication.</div>
<div class="line">Typical examples of Ajax are (a) Providing suggestions while searching words and (b) Real time search of a search site.</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="how-to-use">
<span id="ajax-how-to-use"></span><h2><a class="toc-backref" href="#id2">4.13.2. How to use</a><a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h2>
<div class="section" id="application-settings">
<h3><a class="toc-backref" href="#id3">4.13.2.1. Application settings</a><a class="headerlink" href="#application-settings" title="Permalink to this headline">¶</a></h3>
<p>Application settings for Ajax are explained below.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>DoS attack measures at the time of StAX(Streaming API for XML) use</strong></p>
<p class="last">If the StAX is used to parse the XML format data, protect DoS attack.
For details, refer to <a class="reference external" href="http://pivotal.io/security/cve-2015-3192">CVE-2015-3192 - DoS Attack with XML Input</a>.</p>
</div>
<div class="section" id="settings-to-enable-the-ajax-functionality-in-spring-mvc">
<h4><a class="toc-backref" href="#id4">4.13.2.1.1. Settings to enable the Ajax functionality in Spring MVC</a><a class="headerlink" href="#settings-to-enable-the-ajax-functionality-in-spring-mvc" title="Permalink to this headline">¶</a></h4>
<p>Content-Type (such as <code class="docutils literal"><span class="pre">&quot;application/xml&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;application/json&quot;</span></code> etc.) used in Ajax communication is set such that it can be handled by the handler method of Controller.</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">spring-mvc.xml</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;mvc:annotation-driven</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">If <code class="docutils literal"><span class="pre">&lt;mvc:annotation-driven&gt;</span></code> element is specified, the functionality required for Ajax communication is enabled.</div>
<div class="line">Therefore, special settings are not necessary for Ajax communication.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Functionalities required for Ajax communication specifically refer to the ones provided by <code class="docutils literal"><span class="pre">org.springframework.http.converter.HttpMessageConverter</span></code> class.</p>
<p><code class="docutils literal"><span class="pre">HttpMessageConverter</span></code> performs the following roles.</p>
<ul class="last simple">
<li>Creating Java object from data stored in the request body.</li>
<li>Creating the data to be written to the response Body from Java object.</li>
</ul>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The <code class="docutils literal"><span class="pre">HttpMessageConverter</span></code> which is enabled by default on specifying <code class="docutils literal"><span class="pre">&lt;mvc:annotation-driven&gt;</span></code>, is as follows.</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="30%" />
<col width="15%" />
<col width="45%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Class name</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Target</div>
<div class="line">Format</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.http.converter.json.</div>
<div class="line">MappingJackson2HttpMessageConverter</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">JSON</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">HttpMessageConverter</span></code> to handle JSON as request body or response body.</div>
<div class="line"><a class="reference external" href="https://github.com/FasterXML/jackson/">Jackson</a> system is included in the blank project. Hence, it can be used in its default state.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.http.converter.xml.</div>
<div class="line">Jaxb2RootElementHttpMessageConverter</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">XML</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">HttpMessageConverter</span></code> to handle XML as request body or response body.</div>
<div class="line">JAXB2.0 is included  as standard from JavaSE6. Hence it can be used in its default state.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>Notice If you change from jackson version 1.xx to jackson version 2.xx</strong>, refer to <a class="reference internal" href="../WebServiceDetail/REST.html#rest-note-changed-jackson-version"><span class="std std-ref">here</span></a>.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>XXE (XML External Entity) Injection measures</strong></p>
<p>When handling XML format data in Ajax communication, it is necessary to implement <a class="reference external" href="https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Processing">XXE(XML External Entity) Injection</a> measure.
Subsequent versions above terasoluna-gfw-web 1.0.1.RELEASE are Spring MVC (above 3.2.10.RELEASE) version dependent. As these Spring MVC versions implement XXE Injection measures, it is not necessary to implement them independently.</p>
<p>When using terasoluna-gfw-web 1.0.0.RELEASE, since it is dependent on the Spring MVC version (3.2.4.RELEASE) that does not implement XXE Injection, a class provided by Spring-oxm should be used.</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">spring-mvc.xml</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;xmlMarshaller&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.oxm.jaxb.Jaxb2Marshaller&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;packagesToScan&quot;</span> <span class="na">value=</span><span class="s">&quot;com.examples.app&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="c">&lt;!-- ... --&gt;</span>

<span class="nt">&lt;mvc:annotation-driven&gt;</span>

    <span class="nt">&lt;mvc:message-converters&gt;</span>
        <span class="c">&lt;!-- (3) --&gt;</span>
        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.http.converter.xml.MarshallingHttpMessageConverter&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;marshaller&quot;</span> <span class="na">ref=</span><span class="s">&quot;xmlMarshaller&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (4) --&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;unmarshaller&quot;</span> <span class="na">ref=</span><span class="s">&quot;xmlMarshaller&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (5) --&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;/mvc:message-converters&gt;</span>

    <span class="c">&lt;!-- ... --&gt;</span>

<span class="nt">&lt;/mvc:annotation-driven&gt;</span>

<span class="c">&lt;!-- ... --&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Perform the bean definition of <code class="docutils literal"><span class="pre">Jaxb2Marshaller</span></code> provided by Spring-oxm.</div>
<div class="line"><code class="docutils literal"><span class="pre">Jaxb2Marshaller</span></code> implements the XXE Injection measures in default state.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the package name where the JAXB JavaBean (JavaBean assigned with <code class="docutils literal"><span class="pre">javax.xml.bind.annotation.XmlRootElement</span></code>  annotation ) is stored in the <code class="docutils literal"><span class="pre">packagesToScan</span></code>  property.</div>
<div class="line">JAXB JavaBean stored under the specified package is scanned and registered for marshalling or unmarshalling the JavaBean.</div>
<div class="line">It is scanned in the same way as the base-package attribute of <code class="docutils literal"><span class="pre">&lt;context:component-scan&gt;</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add bean definition of <code class="docutils literal"><span class="pre">MarshallingHttpMessageConverter</span></code> to the <code class="docutils literal"><span class="pre">&lt;mvc:message-converters&gt;</span></code> element that is the child element of <code class="docutils literal"><span class="pre">&lt;mvc:annotation-driven&gt;</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the bean of <code class="docutils literal"><span class="pre">Jaxb2Marshaller</span></code> defined in (1) in <code class="docutils literal"><span class="pre">marshaller</span></code> property.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the bean of <code class="docutils literal"><span class="pre">Jaxb2Marshaller</span></code> defined in (1) in <code class="docutils literal"><span class="pre">unmarshaller</span></code> property.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Adding Spring-oxm as dependent artifact.</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">pom.xml</span></code></li>
</ul>
<blockquote class="last">
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- omitted --&gt;</span>

<span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-oxm<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!-- omitted --&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add Spring-oxm as dependent artifact.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Spring version should be fetched from the placeholder (${org.springframework-version}) that controls the Spring version number defined in <code class="file docutils literal"><span class="pre">pom.xml</span></code> of terasoluna-gfw-parent.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="implementing-controller">
<h3><a class="toc-backref" href="#id5">4.13.2.2. Implementing Controller</a><a class="headerlink" href="#implementing-controller" title="Permalink to this headline">¶</a></h3>
<p>Prerequisites for the sample code explained hereafter, are as follows.</p>
<ul class="simple">
<li>Response data should be in JSON format.</li>
<li>JQuery should be used at client side. It should be the latest version of 1.x series (1.10.2), which is used while writing this document.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Measures to circular reference</strong></p>
<p>When you serialize a JavaBean in JSON or XML format using <code class="docutils literal"><span class="pre">HttpMessageConverter</span></code> and
if property holds an object of cross reference relationship,
the <code class="docutils literal"><span class="pre">StackOverflowError</span></code> and <code class="docutils literal"><span class="pre">OutOfMemoryError</span></code> occur due to circular reference, hence it is necessary to exercise caution.</p>
<p>In order to avoid a circular reference,</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&#64;com.fasterxml.jackson.annotation.JsonIgnore</span></code> annotation to exclude the property from serialization in case of serialized in JSON format using the Jackson</li>
<li><code class="docutils literal"><span class="pre">&#64;javax.xml.bind.annotation.XmlTransient</span></code> annotation to exclude the property from serialization in case of serialized in XML format using the JAXB</li>
</ul>
<p>can be added.</p>
<p>Below is the example of how to exclude specific field from serialization while serializing in JSON format using the Jackson.</p>
<blockquote class="last">
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Order</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">orderId</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderLine</span><span class="o">&gt;</span> <span class="n">orderLines</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderLine</span> <span class="o">{</span>
    <span class="nd">@JsonIgnore</span>
    <span class="kd">private</span> <span class="n">Order</span> <span class="n">order</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">itemCode</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">quantity</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>The <code class="docutils literal"><span class="pre">&#64;JsonIgnore</span></code>annotation is added to exclude the property from serialization.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="fetching-data">
<h4><a class="toc-backref" href="#id6">4.13.2.2.1. Fetching data</a><a class="headerlink" href="#fetching-data" title="Permalink to this headline">¶</a></h4>
<p>How to fetch data using Ajax is explained here.</p>
<p>Following example serves as the Ajax communication that returns a list matching with the search word.</p>
<ul class="simple">
<li>JavaBean for receiving request data</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SearchCriteria</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="c1">// omitted</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">freeWord</span><span class="o">;</span> <span class="c1">// (2)</span>

    <span class="c1">// omitted setter/getter</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create the JavaBean that receives request data.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Match property name with parameter name of request parameter.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>JavaBean for storing the data to be returned</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// (3)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SearchResult</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="c1">// omitted</span>

    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">XxxEntity</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">;</span>

    <span class="c1">// omitted setter/getter</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create the JavaBean for storing the data to be returned.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Controller</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;search&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span> <span class="c1">// (4)</span>
<span class="nd">@ResponseBody</span> <span class="c1">// (5)</span>
<span class="kd">public</span> <span class="n">SearchResult</span> <span class="nf">search</span><span class="o">(</span><span class="nd">@Validated</span> <span class="n">SearchCriteria</span> <span class="n">criteria</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// (6)</span>

    <span class="n">SearchResult</span> <span class="n">searchResult</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SearchResult</span><span class="o">();</span> <span class="c1">// (7)</span>

    <span class="c1">// (8)</span>
    <span class="c1">// omitted</span>

    <span class="k">return</span> <span class="n">searchResult</span><span class="o">;</span> <span class="c1">// (9)</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify <code class="docutils literal"><span class="pre">RequestMethod.GET</span></code> in the method attribute of <code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code> annotation.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Assign <code class="docutils literal"><span class="pre">&#64;org.springframework.web.bind.annotation.ResponseBody</span></code> annotation.</div>
<div class="line">By assigning this annotation, the returned object is marshalled in JSON format and set in response body.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the JavaBean that receives request data, as an argument.</div>
<div class="line">If input validation is required, specify <code class="docutils literal"><span class="pre">&#64;Validated</span></code>. For error handling of input validation, refer to &#8220;<a class="reference internal" href="#ajax-how-to-use-input-error"><span class="std std-ref">Input error handling</span></a>&#8221;.</div>
<div class="line">For details on input validation, refer to &#8220;<a class="reference internal" href="Validation.html"><span class="doc">Input Validation</span></a>&#8221;.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create the JavaBean object to store the data to be returned.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Search data and store the search result in the object created in (7).</div>
<div class="line">In the above example, implementation is omitted.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Return the object to be marshalled in response body.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>HTML(JSP)</li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="c">&lt;!-- omitted --&gt;</span>

<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;contextPath&quot;</span> <span class="na">content=</span><span class="s">&quot;${pageContext.request.contextPath}&quot;</span> <span class="nt">/&gt;</span>

<span class="c">&lt;!-- omitted --&gt;</span>

<span class="c">&lt;!-- (10)  --&gt;</span>
<span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">&quot;searchForm&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;freeWord&quot;</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">&quot;return searchByFreeWord()&quot;</span><span class="nt">&gt;</span>Search<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Form to enter the search condition.</div>
<div class="line">In the above example, it has a text box to enter the search condition and a search button.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="c">&lt;!-- (11) --&gt;</span>
<span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span>
    <span class="na">src=</span><span class="s">&quot;${pageContext.request.contextPath}/resources/vendor/jquery/jquery-1.10.2.js&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/script&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(11)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Read the JQuery JavaScript file.</div>
<div class="line">In the above example, request is sent to the <code class="docutils literal"><span class="pre">/resources/vendor/jquery/jquery-1.10.2.js</span></code> path, to read the JQuery JavaScript file.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Refer to the settings below to read JQuery JavaScript file.
Setting values provided in the blank project are as follows.</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">spring-mvc.xml</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- (12) --&gt;</span>
<span class="nt">&lt;mvc:resources</span> <span class="na">mapping=</span><span class="s">&quot;/resources/**&quot;</span>
    <span class="na">location=</span><span class="s">&quot;/resources/,classpath:META-INF/resources/&quot;</span>
    <span class="na">cache-period=</span><span class="s">&quot;#{60 * 60}&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(12)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Settings for releasing resource files (JavaScript files, Stylesheet files, image files etc.).</div>
<div class="line">In the above setting example, when there is a request for path starting with <code class="docutils literal"><span class="pre">/resources/</span></code>, the files in <code class="docutils literal"><span class="pre">/resources/</span></code> directory of war file or the <code class="docutils literal"><span class="pre">/META-INF/resources/</span></code> directory of class path are sent as a response.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>In the above settings, the JQuery JavaScript file needs to be placed under any one of the following paths.</p>
<ul class="last">
<li><div class="first line-block">
<div class="line"><code class="docutils literal"><span class="pre">/resources/vendor/jquery/jquery-1.10.2.js</span></code> in war file</div>
<div class="line">It is <code class="docutils literal"><span class="pre">src/main/webapp/resources/vendor/jquery/jquery-1.10.2.js</span></code> when indicated by the path in the project.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><code class="docutils literal"><span class="pre">/META-INF/resources/vendor/jquery/jquery-1.10.2.js</span></code> in class path</div>
<div class="line">It is <code class="docutils literal"><span class="pre">src/main/resources/META-INF/resources/vendor/jquery/jquery-1.10.2.js</span></code> when indicated by the path in the project.</div>
</div>
</li>
</ul>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>JavaScript</li>
</ul>
<blockquote>
<div><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">contextPath</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;meta[name=&#39;contextPath&#39;]&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">);</span>

<span class="c1">// (13)</span>
<span class="kd">function</span> <span class="nx">searchByFreeWord</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span><span class="nx">contextPath</span> <span class="o">+</span> <span class="s2">&quot;/ajax/search&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">type</span> <span class="o">:</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="nx">data</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#searchForm&quot;</span><span class="p">).</span><span class="nx">serialize</span><span class="p">(),</span>
        <span class="nx">dataType</span> <span class="o">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="c1">// (14)</span>

    <span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// (15)</span>
        <span class="c1">// render search result</span>
        <span class="c1">// omitted</span>

    <span class="p">}).</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// (16)</span>
        <span class="c1">// render error message</span>
        <span class="c1">// omitted</span>

    <span class="p">});</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(13)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Ajax function that converts search criteria specified in the form to request parameter and sends the request for <cite>/ajax/search</cite> using GET method.</div>
<div class="line">In the above example, clicking the button acts as the trigger for Ajax communication. However, by setting key down or key up of text box as the trigger, real time search can be performed.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(14)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the data format to be received as a response.</div>
<div class="line">In the above example, as <code class="docutils literal"><span class="pre">&quot;json&quot;</span></code> is specified, <code class="docutils literal"><span class="pre">&quot;application/json&quot;</span></code> is set in Accept header.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(15)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implement the process when Ajax communication ends normally (when Http status code is <code class="docutils literal"><span class="pre">&quot;200&quot;</span></code>).</div>
<div class="line">In the above example, implementation is omitted.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(16)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implement the process when Ajax communication does not end normally (when Http status code is <code class="docutils literal"><span class="pre">&quot;4xx&quot;</span></code> and <code class="docutils literal"><span class="pre">&quot;5xx&quot;</span></code>).</div>
<div class="line">In the above example, implementation is omitted.</div>
<div class="line">For error process implementation, refer to <a class="reference internal" href="#ajax-post-formdata"><span class="std std-ref">Posting form data</span></a>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">In the above example, by setting context path (<code class="docutils literal"><span class="pre">${pageContext.request.contextPath}</span></code> ) of Web application in HTML``&lt;meta&gt;`` element.
JSP code is deleted from JavaScript code.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">Communication is as follows when &#8220;Search&#8221; button of Search form is clicked.</div>
<div class="line">Main points are highlighted.</div>
</div>
<ul class="simple">
<li>Request data</li>
</ul>
<blockquote>
<div><div class="highlight-guess"><div class="highlight"><pre><span></span><span class="hll"><span class="nf">GET</span> <span class="nn">/terasoluna-gfw-web-blank/ajax/search?freeWord=</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span><span class="na">Host</span><span class="o">:</span> <span class="l">localhost:9999</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
<span class="hll"><span class="na">Accept</span><span class="o">:</span> <span class="l">application/json, text/javascript, */*; q=0.01</span>
</span><span class="na">X-Requested-With</span><span class="o">:</span> <span class="l">XMLHttpRequest</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/30.0.1599.101 Safari/537.36</span>
<span class="na">Referer</span><span class="o">:</span> <span class="l">http://localhost:9999/terasoluna-gfw-web-blank/ajax/xxe</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip,deflate,sdch</span>
<span class="na">Accept-Language</span><span class="o">:</span> <span class="l">en-US,en;q=0.8,ja;q=0.6</span>
<span class="na">Cookie</span><span class="o">:</span> <span class="l">JSESSIONID=3A486604D7DEE62032BA6C073FC6BE9F</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Response data</li>
</ul>
<blockquote>
<div><div class="highlight-guess"><div class="highlight"><pre><span></span><span class="nt">HTTP</span><span class="o">/</span><span class="nt">1</span><span class="nc">.1</span> <span class="nt">200</span> <span class="nt">OK</span>
<span class="nt">Server</span><span class="o">:</span> <span class="nt">Apache-Coyote</span><span class="o">/</span><span class="nt">1</span><span class="nc">.1</span>
<span class="nt">X-Track</span><span class="o">:</span> <span class="nt">a8fb8fefaaf64ee2bffc2b0f77050226</span>
<span class="hll"><span class="nt">Content-Type</span><span class="o">:</span> <span class="nt">application</span><span class="o">/</span><span class="nt">json</span><span class="o">;</span><span class="nt">charset</span><span class="o">=</span><span class="nt">UTF-8</span>
</span><span class="nt">Transfer-Encoding</span><span class="o">:</span> <span class="nt">chunked</span>
<span class="nt">Date</span><span class="o">:</span> <span class="nt">Fri</span><span class="o">,</span> <span class="nt">25</span> <span class="nt">Oct</span> <span class="nt">2013</span> <span class="nt">13</span><span class="nd">:52:55</span> <span class="nt">GMT</span>

<span class="hll"><span class="p">{</span><span class="s2">&quot;list&quot;</span><span class="o">:</span><span class="cp">[]</span><span class="p">}</span>
</span></pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="posting-form-data">
<span id="ajax-post-formdata"></span><h4><a class="toc-backref" href="#id7">4.13.2.2.2. Posting form data</a><a class="headerlink" href="#posting-form-data" title="Permalink to this headline">¶</a></h4>
<p>How to post form data and fetch processing result using Ajax, is explained here.</p>
<p>Following example is about the Ajax communication of receiving two numbers and returning the calculation result.</p>
<ul class="simple">
<li>JavaBean to receive form data</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CalculationParameters</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="c1">// omitted</span>

    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">number1</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">number2</span><span class="o">;</span>

    <span class="c1">// omitted setter/getter</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create the JavaBean for receiving form data.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>JavaBean that stores processing result</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// (2)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CalculationResult</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="c1">// omitted</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">resultNumber</span><span class="o">;</span>

    <span class="c1">// omitted setter/getter</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create the JavaBean that stores processing result.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Controller</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;xxx&quot;</span><span class="o">)</span>
<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">XxxController</span> <span class="o">{</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;plusForForm&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span> <span class="c1">// (3)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">CalculationResult</span> <span class="nf">plusForForm</span><span class="o">(</span>
        <span class="nd">@Validated</span> <span class="n">CalculationParameters</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// (4)</span>
        <span class="n">CalculationResult</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CalculationResult</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="na">getNumber1</span><span class="o">()</span> <span class="o">+</span> <span class="n">params</span><span class="o">.</span><span class="na">getNumber2</span><span class="o">();</span>
        <span class="n">result</span><span class="o">.</span><span class="na">setResultNumber</span><span class="o">(</span><span class="n">sum</span><span class="o">);</span> <span class="c1">// (5)</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span> <span class="c1">// (6)</span>
    <span class="o">}</span>

    <span class="c1">// omitted</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify <code class="docutils literal"><span class="pre">RequestMethod.POST</span></code> in the method attribute of <code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code> annotation.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the JavaBean for receiving form data as an argument.</div>
<div class="line">Specify <code class="docutils literal"><span class="pre">&#64;Validated</span></code>  when input validation is required. For handling input validation errors, refer to &#8220;<a class="reference internal" href="#ajax-how-to-use-input-error"><span class="std std-ref">Input error handling</span></a>&#8221;.</div>
<div class="line">For details on input validation, refer to &#8220;<a class="reference internal" href="Validation.html"><span class="doc">Input Validation</span></a>&#8221;.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Store the processing result in the object created for the same.</div>
<div class="line">In the above example, calculation result of the two numbers fetched from form object, is stored.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Return the object to perform marshalling in response body.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>HTML (JSP)</li>
</ul>
<blockquote>
<div><div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="c">&lt;!-- omitted --&gt;</span>

<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;contextPath&quot;</span> <span class="na">content=</span><span class="s">&quot;${pageContext.request.contextPath}&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;sec:csrfMetaTags</span> <span class="nt">/&gt;</span>

<span class="c">&lt;!-- omitted --&gt;</span>

<span class="c">&lt;!-- (7)  --&gt;</span>
<span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">&quot;calculationForm&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;number1&quot;</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="nt">&gt;</span>+
    <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;number2&quot;</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">&quot;return plus()&quot;</span><span class="nt">&gt;</span>=<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">&quot;calculationResult&quot;</span><span class="nt">&gt;&lt;/span&gt;</span> <span class="c">&lt;!-- (8) --&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Form to enter the numerical value to be calculated.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Area to display calculation result.</div>
<div class="line">In the above example, calculation result is displayed when communication is successful and it is cleared when the communication fails.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>JavaScript</li>
</ul>
<blockquote>
<div><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">contextPath</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;meta[name=&#39;contextPath&#39;]&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">);</span>

<span class="c1">// (9)</span>
<span class="kd">var</span> <span class="nx">csrfToken</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;meta[name=&#39;_csrf&#39;]&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">csrfHeaderName</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;meta[name=&#39;_csrf_header&#39;]&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">);</span>
<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ajaxSend</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="nx">csrfHeaderName</span><span class="p">,</span> <span class="nx">csrfToken</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// (10)</span>
<span class="kd">function</span> <span class="nx">plus</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span><span class="nx">contextPath</span> <span class="o">+</span> <span class="s2">&quot;/ajax/plusForForm&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">type</span> <span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="nx">data</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#calculationForm&quot;</span><span class="p">).</span><span class="nx">serialize</span><span class="p">(),</span>
        <span class="nx">dataType</span> <span class="o">:</span> <span class="s2">&quot;json&quot;</span>
    <span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#calculationResult&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">resultNumber</span><span class="p">);</span>

    <span class="p">}).</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// (11)</span>
        <span class="kd">var</span> <span class="nx">messages</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
        <span class="c1">// (12)</span>
        <span class="k">if</span><span class="p">(</span><span class="mi">400</span> <span class="o">&lt;=</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">&lt;=</span> <span class="mi">499</span><span class="p">){</span>
            <span class="c1">// (13)</span>
            <span class="kd">var</span> <span class="nx">contentType</span> <span class="o">=</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">getResponseHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">contentType</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">contentType</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;json&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// (14)</span>
                <span class="nx">json</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">parseJSON</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
                <span class="nx">$</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">errorResults</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">errorResult</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">messages</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot;&lt;div&gt;&quot;</span> <span class="o">+</span> <span class="nx">errorResult</span><span class="p">.</span><span class="nx">message</span> <span class="o">+</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">);</span>
                <span class="p">});</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// (15)</span>
                <span class="nx">messages</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&lt;div&gt;&quot;</span> <span class="o">+</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">statusText</span> <span class="o">+</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="c1">// (16)</span>
            <span class="nx">messages</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&lt;div&gt;&quot;</span> <span class="o">+</span> <span class="s2">&quot;System error occurred.&quot;</span> <span class="o">+</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">// (17)</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#calculationResult&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">messages</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">To send the request using POST method, CSRF token needs to be set to HTTP header.</div>
<div class="line">In the above example, the header name and token value are set in the <code class="docutils literal"><span class="pre">&lt;meta&gt;</span></code> element of HTML and value is fetched by JavaScript.</div>
<div class="line">For details on CSRF measures, refer to <a class="reference internal" href="../../Security/CSRF.html"><span class="doc">CSRF Countermeasures</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Ajax function that converts the numerical value specified in form, to request parameter and sends the request for <code class="docutils literal"><span class="pre">/ajax/plusForForm</span></code> using POST method.</div>
<div class="line">In the above example, clicking the button acts as the trigger for Ajax communication however, real time calculation can be implemented by setting lost focus of the text box as the trigger.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(11)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implementation of error handling is shown below.</div>
<div class="line">For server side implementation of error handling, refer to <a class="reference internal" href="#ajax-how-to-use-input-error"><span class="std std-ref">Input error handling</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(12)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Determine the HTTP status code and type of error.</div>
<div class="line">HTTP status code is stored in the <code class="docutils literal"><span class="pre">status</span></code> field of XMLHttpRequest object.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(13)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Check whether the response data is in JSON format.</div>
<div class="line">In the above example, response data format is checked by referring to the value set in the Content-Type of response header.</div>
<div class="line">If the format is not checked and if it a format other than JSON, an error occurs while deserializing to JSON object.</div>
<div class="line">If error handling is performed easily at the server side, page may be returned in HTML format.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(14)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Deserialize the response data in JSON object.</div>
<div class="line">Response data is stored in the <code class="docutils literal"><span class="pre">responseText</span></code> field of XMLHttpRequest object.</div>
<div class="line">In the above example, error information is fetched from the deserialized JSON object and error message is created.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(15)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Perform the process when the response data is not in JSON format.</div>
<div class="line">In the above example, HTTP status text is stored in the error message.</div>
<div class="line">HTTP status text is stored in the <code class="docutils literal"><span class="pre">statusText</span></code>  field of XMLHttpRequest object.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(16)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Perform the process when there is a server error.</div>
<div class="line">In the above example, message notifying it as a system error is stored in error message.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(17)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Perform rendering process when there is an error.</div>
<div class="line">In the above example, error message is displayed in the area for displaying calculation result.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In the above example, processes namely, Ajax communication, DOM operation (rendering) and error handling are performed by the same function. It is recommended to split and implement these processes.</p>
</div>
<div class="admonition-todo admonition" id="index-1">
<p class="first admonition-title">Todo</p>
<p><strong>TBD</strong></p>
<p class="last">Implementation at client side will be explained in detail, in subsequent versions.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>In the above example, JSP code is deleted from JavaScript code by setting CSRF token value and CSRF token header name,
in the <code class="docutils literal"><span class="pre">&lt;meta&gt;</span></code> element of HTML using <code class="docutils literal"><span class="pre">&lt;sec:csrfMetaTags</span> <span class="pre">/&gt;</span></code>. Please refer, <a class="reference internal" href="../../Security/CSRF.html#csrf-ajax-token-setting"><span class="std std-ref">Coordination while using Ajax</span></a>.</p>
<p class="last">Please note that, CSRF token value and name of CSRF token header can also be fetched by using  <code class="docutils literal"><span class="pre">${_csrf.token}</span></code> and  <code class="docutils literal"><span class="pre">${_csrf.headerName}</span></code> respectively.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">Following communication occurs when the &#8220;=&#8221; button of search form is clicked.</div>
<div class="line">Main points are highlighted.</div>
</div>
<ul class="simple">
<li>Request data</li>
</ul>
<blockquote>
<div><div class="highlight-guess"><div class="highlight"><pre><span></span><span class="hll"><span class="nf">POST</span> <span class="nn">/terasoluna-gfw-web-blank/ajax/plusForForm</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span><span class="na">Host</span><span class="o">:</span> <span class="l">localhost:9999</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">19</span>
<span class="hll"><span class="na">Accept</span><span class="o">:</span> <span class="l">application/json, text/javascript, */*; q=0.01</span>
</span><span class="na">Origin</span><span class="o">:</span> <span class="l">http://localhost:9999</span>
<span class="hll"><span class="na">X-CSRF-TOKEN</span><span class="o">:</span> <span class="l">a5dd1858-8a4f-4ecc-88bd-a326388ab5c9</span>
</span><span class="na">X-Requested-With</span><span class="o">:</span> <span class="l">XMLHttpRequest</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/30.0.1599.101 Safari/537.36</span>
<span class="hll"><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded; charset=UTF-8</span>
</span><span class="na">Referer</span><span class="o">:</span> <span class="l">http://localhost:9999/terasoluna-gfw-web-blank/ajax/xxe</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip,deflate,sdch</span>
<span class="na">Accept-Language</span><span class="o">:</span> <span class="l">en-US,en;q=0.8,ja;q=0.6</span>
<span class="na">Cookie</span><span class="o">:</span> <span class="l">JSESSIONID=3A486604D7DEE62032BA6C073FC6BE9F</span>

<span class="hll">number1=1&amp;number2=2
</span></pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Response data</li>
</ul>
<blockquote>
<div><div class="highlight-guess"><div class="highlight"><pre><span></span><span class="nt">HTTP</span><span class="o">/</span><span class="nt">1</span><span class="nc">.1</span> <span class="nt">200</span> <span class="nt">OK</span>
<span class="nt">Server</span><span class="o">:</span> <span class="nt">Apache-Coyote</span><span class="o">/</span><span class="nt">1</span><span class="nc">.1</span>
<span class="nt">X-Track</span><span class="o">:</span> <span class="nt">c2d5066d0fa946f584536775f07d1900</span>
<span class="hll"><span class="nt">Content-Type</span><span class="o">:</span> <span class="nt">application</span><span class="o">/</span><span class="nt">json</span><span class="o">;</span><span class="nt">charset</span><span class="o">=</span><span class="nt">UTF-8</span>
</span><span class="nt">Transfer-Encoding</span><span class="o">:</span> <span class="nt">chunked</span>
<span class="nt">Date</span><span class="o">:</span> <span class="nt">Fri</span><span class="o">,</span> <span class="nt">25</span> <span class="nt">Oct</span> <span class="nt">2013</span> <span class="nt">14</span><span class="nd">:27:55</span> <span class="nt">GMT</span>

<span class="hll"><span class="p">{</span><span class="s2">&quot;resultNumber&quot;</span><span class="o">:</span><span class="m">3</span><span class="p">}</span>
</span></pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Response data in case of an input error</li>
</ul>
<blockquote>
<div><div class="highlight-guess"><div class="highlight"><pre><span></span><span class="hll"><span class="nt">HTTP</span><span class="o">/</span><span class="nt">1</span><span class="nc">.1</span> <span class="nt">400</span> <span class="nt">Bad</span> <span class="nt">Request</span>
</span><span class="nt">Server</span><span class="o">:</span> <span class="nt">Apache-Coyote</span><span class="o">/</span><span class="nt">1</span><span class="nc">.1</span>
<span class="nt">X-Track</span><span class="o">:</span> <span class="nt">cecd7b4d746249178643b7110b0eaa74</span>
<span class="hll"><span class="nt">Content-Type</span><span class="o">:</span> <span class="nt">application</span><span class="o">/</span><span class="nt">json</span><span class="o">;</span><span class="nt">charset</span><span class="o">=</span><span class="nt">UTF-8</span>
</span><span class="nt">Transfer-Encoding</span><span class="o">:</span> <span class="nt">chunked</span>
<span class="nt">Date</span><span class="o">:</span> <span class="nt">Wed</span><span class="o">,</span> <span class="nt">04</span> <span class="nt">Dec</span> <span class="nt">2013</span> <span class="nt">15</span><span class="nd">:06:01</span> <span class="nt">GMT</span>
<span class="nt">Connection</span><span class="o">:</span> <span class="nt">close</span>

<span class="hll"><span class="p">{</span><span class="s2">&quot;errorResults&quot;</span><span class="o">:</span><span class="cp">[</span><span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span><span class="s2">&quot;NotNull&quot;</span><span class="p">,</span><span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">number2</span><span class="se">\&quot;</span><span class="s2">maynotbenull.&quot;</span><span class="p">,</span><span class="s2">&quot;itemPath&quot;</span><span class="p">:</span><span class="s2">&quot;number2&quot;</span><span class="p">},{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span><span class="s2">&quot;NotNull&quot;</span><span class="p">,</span><span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">number1</span><span class="se">\&quot;</span><span class="s2">maynotbenull.&quot;</span><span class="p">,</span><span class="s2">&quot;itemPath&quot;</span><span class="p">:</span><span class="s2">&quot;number1&quot;</span><span class="p">}</span><span class="cp">]</span><span class="p">}</span>
</span></pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="posting-form-data-in-json-format">
<h4><a class="toc-backref" href="#id8">4.13.2.2.3. Posting form data in JSON format</a><a class="headerlink" href="#posting-form-data-in-json-format" title="Permalink to this headline">¶</a></h4>
<p>How to fetch processing result by converting form data to JSON format and subsequently posting it using Ajax, is explained here.</p>
<p>Difference between this method and  &#8220;Posting form data&#8221; method, is explained.</p>
<ul class="simple">
<li>Controller</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;xxx&quot;</span><span class="o">)</span>
<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">XxxController</span> <span class="o">{</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;plusForJson&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">CalculationResult</span> <span class="nf">plusForJson</span><span class="o">(</span>
            <span class="nd">@Validated</span> <span class="nd">@RequestBody</span> <span class="n">CalculationParameters</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// (1)</span>
        <span class="n">CalculationResult</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CalculationResult</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="na">getNumber1</span><span class="o">()</span> <span class="o">+</span> <span class="n">params</span><span class="o">.</span><span class="na">getNumber2</span><span class="o">();</span>
        <span class="n">result</span><span class="o">.</span><span class="na">setResultNumber</span><span class="o">(</span><span class="n">sum</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// omitted</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Assign <code class="docutils literal"><span class="pre">&#64;org.springframework.web.bind.annotation.RequestBody</span></code> as the argument annotation of JavaBean for receiving form data.</div>
<div class="line">By assigning this annotation, data in JSON format stored in the request body is unmarshalled and converted to object.</div>
<div class="line">Specify <code class="docutils literal"><span class="pre">&#64;Validated</span></code> when input validation is required. For error handling of input validation, refer to &#8220;<a class="reference internal" href="#ajax-how-to-use-input-error"><span class="std std-ref">Input error handling</span></a>&#8221;.</div>
<div class="line">For details on input validation, refer to <a class="reference internal" href="Validation.html"><span class="doc">Input Validation</span></a>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>JavaScript/HTML (JSP)</li>
</ul>
<blockquote>
<div><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// (2)</span>
<span class="kd">function</span> <span class="nx">toJson</span><span class="p">(</span><span class="nx">$form</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">$form</span><span class="p">.</span><span class="nx">serializeArray</span><span class="p">()).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">data</span><span class="p">[</span><span class="nx">v</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">plus</span><span class="p">()</span> <span class="p">{</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span><span class="nx">contextPath</span> <span class="o">+</span> <span class="s2">&quot;/ajax/plusForJson&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">type</span> <span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="nx">contentType</span> <span class="o">:</span> <span class="s2">&quot;application/json;charset=utf-8&quot;</span><span class="p">,</span> <span class="c1">// (3)</span>
        <span class="nx">data</span> <span class="o">:</span> <span class="nx">toJson</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#calculationForm&quot;</span><span class="p">)),</span> <span class="c1">// (2)</span>
        <span class="nx">dataType</span> <span class="o">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
        <span class="nx">beforeSend</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="nx">csrfHeaderName</span><span class="p">,</span> <span class="nx">csrfToken</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#calculationResult&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">resultNumber</span><span class="p">);</span>

    <span class="p">}).</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#calculationResult&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>

    <span class="p">});</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Function to change form input field to JSON string format.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Change the media type of Content-Type to <code class="docutils literal"><span class="pre">&quot;application/json&quot;</span></code> as the data stored in request body is in JSON format.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">Following communication occurs when &#8220;=&#8221; button of the search form mentioned above, is clicked.</div>
<div class="line">Main points are highlighted.</div>
</div>
<ul class="simple">
<li>Request data</li>
</ul>
<blockquote>
<div><div class="highlight-guess"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/terasoluna-gfw-web-blank/ajax/plusForJson</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost:9999</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">31</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json, text/javascript, */*; q=0.01</span>
<span class="na">Origin</span><span class="o">:</span> <span class="l">http://localhost:9999</span>
<span class="na">X-CSRF-TOKEN</span><span class="o">:</span> <span class="l">9d4f1e0c-c500-43f3-9125-a7a131ff88fa</span>
<span class="na">X-Requested-With</span><span class="o">:</span> <span class="l">XMLHttpRequest</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/30.0.1599.101 Safari/537.36</span>
<span class="hll"><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>
</span><span class="na">Referer</span><span class="o">:</span> <span class="l">http://localhost:9999/terasoluna-gfw-web-blank/ajax/xxe?</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip,deflate,sdch</span>
<span class="na">Accept-Language</span><span class="o">:</span> <span class="l">en-US,en;q=0.8,ja;q=0.6</span>
<span class="na">Cookie</span><span class="o">:</span> <span class="l">JSESSIONID=CECD7A6CB0431266B8D1173CCFA66B95</span>

<span class="hll"><span class="p">{</span><span class="nt">&quot;number1&quot;</span><span class="p">:</span><span class="s2">&quot;34&quot;</span><span class="p">,</span><span class="nt">&quot;number2&quot;</span><span class="p">:</span><span class="s2">&quot;56&quot;</span><span class="p">}</span>
</span></pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="input-error-handling">
<span id="ajax-how-to-use-input-error"></span><h3><a class="toc-backref" href="#id9">4.13.2.3. Input error handling</a><a class="headerlink" href="#input-error-handling" title="Permalink to this headline">¶</a></h3>
<p>How to perform error handling when an incorrect input value is specified, is explained here.</p>
<p>Input error handling methods are widely classified into the following.</p>
<ul class="simple">
<li>Method that performs error handling by providing an exception handling method.</li>
<li>Method that performs error handling by receiving <code class="docutils literal"><span class="pre">org.springframework.validation.BindingResult</span></code> as an argument of Controller handler method.</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="handling-bindexception">
<h4><a class="toc-backref" href="#id10">4.13.2.3.1. Handling BindException</a><a class="headerlink" href="#handling-bindexception" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.validation.BindException</span></code> is an exception class generated when an incorrect input value is specified while sending the data as request parameter for binding to JavaBean.</div>
<div class="line">To receive request parameter and form data at the time of GET, in <code class="docutils literal"><span class="pre">&quot;application/x-www-form-urlencoded&quot;</span></code> format, exception handling  of <code class="docutils literal"><span class="pre">BindException</span></code> class needs to be performed.</div>
</div>
<ul class="simple">
<li>Controller</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;xxx&quot;</span><span class="o">)</span>
<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">XxxController</span> <span class="o">{</span>

    <span class="c1">// omitted</span>

    <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">BindException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="c1">// (1)</span>
    <span class="nd">@ResponseStatus</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">HttpStatus</span><span class="o">.</span><span class="na">BAD_REQUEST</span><span class="o">)</span> <span class="c1">// (2)</span>
    <span class="nd">@ResponseBody</span> <span class="c1">// (3)</span>
    <span class="kd">public</span> <span class="n">ErrorResults</span> <span class="nf">handleBindException</span><span class="o">(</span><span class="n">BindException</span> <span class="n">e</span><span class="o">,</span> <span class="n">Locale</span> <span class="n">locale</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// (4)</span>
        <span class="c1">// (5)</span>
        <span class="n">ErrorResults</span> <span class="n">errorResults</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ErrorResults</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">FieldError</span> <span class="n">fieldError</span> <span class="o">:</span> <span class="n">e</span><span class="o">.</span><span class="na">getBindingResult</span><span class="o">().</span><span class="na">getFieldErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">errorResults</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">fieldError</span><span class="o">.</span><span class="na">getCode</span><span class="o">(),</span>
                    <span class="n">messageSource</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(</span><span class="n">fieldError</span><span class="o">,</span> <span class="n">locale</span><span class="o">),</span>
                        <span class="n">fieldError</span><span class="o">.</span><span class="na">getField</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">ObjectError</span> <span class="n">objectError</span> <span class="o">:</span> <span class="n">e</span><span class="o">.</span><span class="na">getBindingResult</span><span class="o">().</span><span class="na">getGlobalErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">errorResults</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">objectError</span><span class="o">.</span><span class="na">getCode</span><span class="o">(),</span>
                    <span class="n">messageSource</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(</span><span class="n">objectError</span><span class="o">,</span> <span class="n">locale</span><span class="o">),</span>
                        <span class="n">objectError</span><span class="o">.</span><span class="na">getObjectName</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">errorResults</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// omitted</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define the error handling method in Controller.</div>
<div class="line">Assign <code class="docutils literal"><span class="pre">&#64;org.springframework.web.bind.annotation.ExceptionHandler</span></code> annotation to the error handling method and specify the exception type to be handled in the value attribute.</div>
<div class="line">In the above example, <code class="docutils literal"><span class="pre">BindException.class</span></code> is specified as the exception for binding.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the HTTP status information sent as response.</div>
<div class="line">In the above example, <code class="docutils literal"><span class="pre">400</span></code> (Bad Request) is specified.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Assign <code class="docutils literal"><span class="pre">&#64;ResponseBody</span></code> annotation to write the returned object in response body.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Declare the exception class to be handled as an argument of the error handling method.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implement error handling.</div>
<div class="line">In the above example, a JavaBean is created to return the error information.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Locale object can be received as an argument while creating a message for error handling by considering internationalization.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>JavaBean storing the error information</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// (6)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ErrorResult</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">code</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">message</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">itemPath</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">code</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCode</span><span class="o">(</span><span class="n">String</span> <span class="n">code</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getMessage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">message</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMessage</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getItemPath</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">itemPath</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setItemPath</span><span class="o">(</span><span class="n">String</span> <span class="n">itemPath</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">itemPath</span> <span class="o">=</span> <span class="n">itemPath</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// (7)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ErrorResults</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ErrorResult</span><span class="o">&gt;</span> <span class="n">errorResults</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ErrorResult</span><span class="o">&gt;();</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ErrorResult</span><span class="o">&gt;</span> <span class="nf">getErrorResults</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">errorResults</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setErrorResults</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">ErrorResult</span><span class="o">&gt;</span> <span class="n">errorResults</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">errorResults</span> <span class="o">=</span> <span class="n">errorResults</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">ErrorResults</span> <span class="nf">add</span><span class="o">(</span><span class="n">String</span> <span class="n">code</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ErrorResult</span> <span class="n">errorResult</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ErrorResult</span><span class="o">();</span>
        <span class="n">errorResult</span><span class="o">.</span><span class="na">setCode</span><span class="o">(</span><span class="n">code</span><span class="o">);</span>
        <span class="n">errorResult</span><span class="o">.</span><span class="na">setMessage</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
        <span class="n">errorResults</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">errorResult</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">ErrorResults</span> <span class="nf">add</span><span class="o">(</span><span class="n">String</span> <span class="n">code</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">,</span> <span class="n">String</span> <span class="n">itemPath</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ErrorResult</span> <span class="n">errorResult</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ErrorResult</span><span class="o">();</span>
        <span class="n">errorResult</span><span class="o">.</span><span class="na">setCode</span><span class="o">(</span><span class="n">code</span><span class="o">);</span>
        <span class="n">errorResult</span><span class="o">.</span><span class="na">setMessage</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
        <span class="n">errorResult</span><span class="o">.</span><span class="na">setItemPath</span><span class="o">(</span><span class="n">itemPath</span><span class="o">);</span>
        <span class="n">errorResults</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">errorResult</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">JavaBean to store one record of error information.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">JavaBean to store multiple JavaBeans, each of which stores one record of error information.</div>
<div class="line">JavaBeans mentioned in (6) are stored as a list.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="handling-methodargumentnotvalidexception">
<h4><a class="toc-backref" href="#id11">4.13.2.3.2. Handling MethodArgumentNotValidException</a><a class="headerlink" href="#handling-methodargumentnotvalidexception" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.web.bind.MethodArgumentNotValidException</span></code> is the exception class generated when an incorrect input value is specified while binding the data stored in the request body to JavaBean using <code class="docutils literal"><span class="pre">&#64;RequestBody</span></code> annotation.</div>
<div class="line">To receive it in formats such as <code class="docutils literal"><span class="pre">&quot;application/json&quot;</span></code> or <code class="docutils literal"><span class="pre">&quot;application/xml&quot;</span></code> etc., exception handling of <code class="docutils literal"><span class="pre">MethodArgumentNotValidException</span></code> needs to be performed.</div>
</div>
<ul class="simple">
<li>Controller</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">MethodArgumentNotValidException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="c1">// (1)</span>
<span class="nd">@ResponseStatus</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">HttpStatus</span><span class="o">.</span><span class="na">BAD_REQUEST</span><span class="o">)</span>
<span class="nd">@ResponseBody</span>
<span class="kd">public</span> <span class="n">ErrorResults</span> <span class="nf">handleMethodArgumentNotValidException</span><span class="o">(</span>
        <span class="n">MethodArgumentNotValidException</span> <span class="n">e</span><span class="o">,</span> <span class="n">Locale</span> <span class="n">locale</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// (1)</span>
    <span class="n">ErrorResults</span> <span class="n">errorResults</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ErrorResults</span><span class="o">();</span>

    <span class="c1">// implement error handling.</span>
    <span class="c1">// omitted</span>

    <span class="k">return</span> <span class="n">errorResults</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify <code class="docutils literal"><span class="pre">MethodArgumentNotValidException.class</span></code> as an exception for error handling.</div>
<div class="line">Other than this, it is same as <code class="docutils literal"><span class="pre">BindException</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="handling-httpmessagenotreadableexception">
<h4><a class="toc-backref" href="#id12">4.13.2.3.3. Handling HttpMessageNotReadableException</a><a class="headerlink" href="#handling-httpmessagenotreadableexception" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.http.converter.HttpMessageNotReadableException</span></code> is the exception class generated when a JavaBean could not be created from the data stored in Body, while binding the data stored in the request body to JavaBean, using <code class="docutils literal"><span class="pre">&#64;RequestBody</span></code> annotation.</div>
<div class="line">To receive it in formats such as <code class="docutils literal"><span class="pre">&quot;application/json&quot;</span></code> or <code class="docutils literal"><span class="pre">&quot;application/xml&quot;</span></code> etc., exception handling of <code class="docutils literal"><span class="pre">MethodArgumentNotValidException</span></code> needs to be performed.</div>
</div>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Causes of specific errors differ depending on the implementation of <code class="docutils literal"><span class="pre">HttpMessageConverter</span></code> or library to be used.</p>
<p class="last">In <code class="docutils literal"><span class="pre">MappingJackson2HttpMessageConverter</span></code> implementation, wherein data in JSON format is to be converted to JavaBean using Jackson, if a string is specified in the Integer field instead of number, <code class="docutils literal"><span class="pre">HttpMessageNotReadableException</span></code> occurs.</p>
</div>
</div></blockquote>
<ul class="simple">
<li>Controller</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">HttpMessageNotReadableException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="c1">// (1)</span>
<span class="nd">@ResponseStatus</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">HttpStatus</span><span class="o">.</span><span class="na">BAD_REQUEST</span><span class="o">)</span>
<span class="nd">@ResponseBody</span>
<span class="kd">public</span> <span class="n">ErrorResults</span> <span class="nf">handleHttpMessageNotReadableException</span><span class="o">(</span>
        <span class="n">HttpMessageNotReadableException</span> <span class="n">e</span><span class="o">,</span> <span class="n">Locale</span> <span class="n">locale</span><span class="o">)</span> <span class="o">{</span>  <span class="c1">// (1)</span>
    <span class="n">ErrorResults</span> <span class="n">errorResults</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ErrorResults</span><span class="o">();</span>

    <span class="c1">// implement error handling.</span>
    <span class="c1">// omitted</span>

    <span class="k">return</span> <span class="n">errorResults</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify <code class="docutils literal"><span class="pre">HttpMessageNotReadableException.class</span></code> as the exception of error handling object.</div>
<div class="line">Other than this, it is same as <code class="docutils literal"><span class="pre">BindException</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="handling-by-using-bindingresult">
<h4><a class="toc-backref" href="#id13">4.13.2.3.4. Handling by using BindingResult</a><a class="headerlink" href="#handling-by-using-bindingresult" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">When same type of JavaBean is returned in case of normal termination and in case of input error, error handling can be performed by receiving <code class="docutils literal"><span class="pre">BindingResult</span></code> as the handler method argument.</div>
<div class="line">This method can be used irrespective of the request data format.</div>
<div class="line">When <code class="docutils literal"><span class="pre">BindingResult</span></code> is not to be specified as handler method argument, it is necessary to implement error handling by the exception handling method mentioned earlier.</div>
</div>
<ul class="simple">
<li>Controller</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;plus&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="nd">@ResponseBody</span>
<span class="kd">public</span> <span class="n">CalculationResult</span> <span class="nf">plus</span><span class="o">(</span>
        <span class="nd">@Validated</span> <span class="nd">@RequestBody</span> <span class="n">CalculationParameters</span> <span class="n">params</span><span class="o">,</span>
        <span class="n">BindingResult</span> <span class="n">bResult</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// (1)</span>
    <span class="n">CalculationResult</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CalculationResult</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">bResult</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span> <span class="c1">// (2)</span>

        <span class="c1">// (3)</span>
        <span class="c1">// implement error handling.</span>
        <span class="c1">// omitted</span>

        <span class="k">return</span> <span class="n">result</span><span class="o">;</span> <span class="c1">// (4)</span>
    <span class="o">}</span>
    <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="na">getNumber1</span><span class="o">()</span> <span class="o">+</span> <span class="n">params</span><span class="o">.</span><span class="na">getNumber2</span><span class="o">();</span>
    <span class="n">result</span><span class="o">.</span><span class="na">setResultNumber</span><span class="o">(</span><span class="n">sum</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Declare <code class="docutils literal"><span class="pre">BindingResult</span></code> as a handler method argument.</div>
<div class="line"><code class="docutils literal"><span class="pre">BindingResult</span></code> needs to be declared immediately after the JavaBean for input validation.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Check whether there is any input value error.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">If so, perform error handling for input error.</div>
<div class="line">In the above example, although error handling is omitted, it is assumed that settings for error message etc. are performed.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Return processing result.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In the above example, HTTP status code <code class="docutils literal"><span class="pre">200</span></code> (OK) is returned as response for both normal process as well as error.
When it is necessary to classify HTTP status codes as per processing results, it can be implemented by setting <code class="docutils literal"><span class="pre">org.springframework.http.ResponseEntity</span></code> as the return value.
As another approach, error handling can be implemented by the exception handling method mentioned earlier, without specifying <code class="docutils literal"><span class="pre">BindingResult</span></code> as the handler method argument.</p>
<blockquote class="last">
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;plus&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="nd">@ResponseBody</span>
<span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">CalculationResult</span><span class="o">&gt;</span> <span class="nf">plus</span><span class="o">(</span>
        <span class="nd">@Validated</span> <span class="nd">@RequestBody</span> <span class="n">CalculationParameters</span> <span class="n">params</span><span class="o">,</span>
        <span class="n">BindingResult</span> <span class="n">bResult</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">CalculationResult</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CalculationResult</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">bResult</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>

        <span class="c1">// implement error handling.</span>
        <span class="c1">// omitted</span>

        <span class="c1">// (1)</span>
        <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">badRequest</span><span class="o">().</span><span class="na">body</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// omitted</span>

    <span class="c1">// (2)</span>
    <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">().</span><span class="na">body</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Return response data and HTTP status in case of input error.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Return response data and HTTP status in case of normal termination.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="business-error-handling">
<h3><a class="toc-backref" href="#id14">4.13.2.4. Business error handling</a><a class="headerlink" href="#business-error-handling" title="Permalink to this headline">¶</a></h3>
<p>How to handle business errors is explained here.</p>
<p>Methods that handle business errors are widely classified as follows.</p>
<ul class="simple">
<li>Method that performs error handling by providing a business exception handling method.</li>
<li>Method that catches business exception in the handler method of Controller and performs error handling.</li>
</ul>
<div class="section" id="handling-business-exception-by-exception-handling-method">
<h4><a class="toc-backref" href="#id15">4.13.2.4.1. Handling business exception by exception handling method</a><a class="headerlink" href="#handling-business-exception-by-exception-handling-method" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Business exceptions are handled by providing an exception handling method same as in case of input error.</div>
<div class="line">This method is recommended when it is necessary to implement the same error handling in requests for multiple handler methods.</div>
</div>
<ul class="simple">
<li>Controller</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">BusinessException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="c1">// (1)</span>
<span class="nd">@ResponseStatus</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">HttpStatus</span><span class="o">.</span><span class="na">CONFLICT</span><span class="o">)</span> <span class="c1">// (2)</span>
<span class="nd">@ResponseBody</span>
<span class="kd">public</span> <span class="n">ErrorResults</span> <span class="nf">handleHttpBusinessException</span><span class="o">(</span><span class="n">BusinessException</span> <span class="n">e</span><span class="o">,</span> <span class="c1">// (1)</span>
        <span class="n">Locale</span> <span class="n">locale</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ErrorResults</span> <span class="n">errorResults</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ErrorResults</span><span class="o">();</span>

    <span class="c1">// implement error handling.</span>
    <span class="c1">// omitted</span>

    <span class="k">return</span> <span class="n">errorResults</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify <code class="docutils literal"><span class="pre">BusinessException.class</span></code> as an exception for error handling.</div>
<div class="line">Other than this, it is similar to the input error handling for <code class="docutils literal"><span class="pre">BindException</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the HTTP status information sent as response.</div>
<div class="line">In the above example, <code class="docutils literal"><span class="pre">409</span></code> (Conflict) is specified.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="handling-business-exception-in-handler-method">
<h4><a class="toc-backref" href="#id16">4.13.2.4.2. Handling business exception in handler method</a><a class="headerlink" href="#handling-business-exception-in-handler-method" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Business exception is caught by enclosing the process where the business error has occurred, in try clause.</div>
<div class="line">This method is implemented when error handling is different for each request.</div>
</div>
<ul class="simple">
<li>Controller</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;plus&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="nd">@ResponseBody</span>
<span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">CalculationResult</span><span class="o">&gt;</span> <span class="nf">plusForJson</span><span class="o">(</span>
        <span class="nd">@Validated</span> <span class="nd">@RequestBody</span> <span class="n">CalculationParameters</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">CalculationResult</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CalculationResult</span><span class="o">();</span>

    <span class="c1">// omitted</span>

    <span class="c1">// (1)</span>
    <span class="k">try</span> <span class="o">{</span>

        <span class="c1">// call service method.</span>
        <span class="c1">// omitted</span>

     <span class="c1">// (2)</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">BusinessException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// (3)</span>
        <span class="c1">// implement error handling.</span>
        <span class="c1">// omitted</span>

        <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">CONFLICT</span><span class="o">).</span><span class="na">body</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// omitted</span>

    <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">().</span><span class="na">body</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Sr. No.</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Enclose the method call where business exception occurs, in try clause.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Catch business exception.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Perform the error handling intended for business exception error.</div>
<div class="line">In the above example, although error handling is omitted, it is assumed that settings for error message etc. are performed.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="HealthCheck.html" title="4.14. Health Check"
             >next</a> |</li>
        <li class="right" >
          <a href="TagLibAndELFunctions.html" title="4.12. JSP Tag Libraries and EL Functions offered by common library"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.3.0.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >4. Web Application Development Features</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
      © Copyright 2013-2017, NTT DATA Corporation. © Copyright 2017, NTT Corporation.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.8.Theme by <a href="http://github.com/vkvn">vkvn</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>
