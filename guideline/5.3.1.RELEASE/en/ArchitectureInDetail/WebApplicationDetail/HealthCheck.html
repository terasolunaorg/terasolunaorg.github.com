<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>4.14. Health Check &#8212; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.3.1.RELEASE documentation</title>
    <link rel="stylesheet" href="../../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '5.3.1.RELEASE',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5. Web Services" href="../WebServiceDetail/index.html" />
    <link rel="prev" title="4.13. Ajax" href="Ajax.html" /><script src="../../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../../_static/solarized-dark.css" rel="stylesheet">
<link href="../../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../WebServiceDetail/index.html" title="5. Web Services"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Ajax.html" title="4.13. Ajax"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.3.1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">4. Web Application Development Features</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>

  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4.14. Health Check</a><ul>
<li><a class="reference internal" href="#overview">4.14.1. Overview</a><ul>
<li><a class="reference internal" href="#load-sharing-and-fallback-of-load-balancer">4.14.1.1. Load sharing and fallback of load balancer</a></li>
<li><a class="reference internal" href="#types-of-health-checks">4.14.1.2. Types of health checks</a></li>
<li><a class="reference internal" href="#structure-of-health-check-shown-in-the-guideline">4.14.1.3. Structure of health check shown in the guideline</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use">4.14.2. How to use</a><ul>
<li><a class="reference internal" href="#repository-interface">4.14.2.1. Repository interface</a></li>
<li><a class="reference internal" href="#service-class">4.14.2.2. Service class</a></li>
<li><a class="reference internal" href="#controller-class">4.14.2.3. Controller class</a></li>
<li><a class="reference internal" href="#jsp-file">4.14.2.4. JSP file</a></li>
<li><a class="reference internal" href="#configuring-access-rights">4.14.2.5. Configuring access rights</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendix">4.14.3. Appendix</a><ul>
<li><a class="reference internal" href="#configuration-for-minimising-the-data-volume-for-response">4.14.3.1. Configuration for minimising the data volume for response</a><ul>
<li><a class="reference internal" href="#should-not-receive-settings-of-apache-tiles">4.14.3.1.1. Should not receive settings of Apache Tiles</a></li>
<li><a class="reference internal" href="#prevent-reading-of-header-and-footer-files">4.14.3.1.2. Prevent reading of header and footer files</a></li>
<li><a class="reference internal" href="#remove-additional-line-breaks-from-response">4.14.3.1.3. Remove additional line breaks from response</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="Ajax.html"
                        title="previous chapter">4.13. Ajax</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../WebServiceDetail/index.html"
                        title="next chapter">5. Web Services</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/ArchitectureInDetail/WebApplicationDetail/HealthCheck.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="health-check">
<h1>4.14. Health Check<a class="headerlink" href="#health-check" title="Permalink to this headline">¶</a></h1>
<div class="admonition caution">
  <p class="first admonition-title">Caution</p>
  <p><strong>This version is already obsolete</strong>. Please check <a href="http://terasolunaorg.github.io/guideline/">the latest guideline</a>.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id5">Overview</a><ul>
<li><a class="reference internal" href="#load-sharing-and-fallback-of-load-balancer" id="id6">Load sharing and fallback of load balancer</a></li>
<li><a class="reference internal" href="#types-of-health-checks" id="id7">Types of health checks</a></li>
<li><a class="reference internal" href="#structure-of-health-check-shown-in-the-guideline" id="id8">Structure of health check shown in the guideline</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use" id="id9">How to use</a><ul>
<li><a class="reference internal" href="#repository-interface" id="id10">Repository interface</a></li>
<li><a class="reference internal" href="#service-class" id="id11">Service class</a></li>
<li><a class="reference internal" href="#controller-class" id="id12">Controller class</a></li>
<li><a class="reference internal" href="#jsp-file" id="id13">JSP file</a></li>
<li><a class="reference internal" href="#configuring-access-rights" id="id14">Configuring access rights</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendix" id="id15">Appendix</a><ul>
<li><a class="reference internal" href="#configuration-for-minimising-the-data-volume-for-response" id="id16">Configuration for minimising the data volume for response</a><ul>
<li><a class="reference internal" href="#should-not-receive-settings-of-apache-tiles" id="id17">Should not receive settings of Apache Tiles</a></li>
<li><a class="reference internal" href="#prevent-reading-of-header-and-footer-files" id="id18">Prevent reading of header and footer files</a></li>
<li><a class="reference internal" href="#remove-additional-line-breaks-from-response" id="id19">Remove additional line breaks from response</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="overview">
<span id="healthcheckoverview"></span><h2><a class="toc-backref" href="#id5">4.14.1. Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">This chapter explains about health check.</div>
</div>
<div class="section" id="load-sharing-and-fallback-of-load-balancer">
<span id="healthcheckoverview-loadbalancer"></span><h3><a class="toc-backref" href="#id6">4.14.1.1. Load sharing and fallback of load balancer</a><a class="headerlink" href="#load-sharing-and-fallback-of-load-balancer" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">A load balancer (hereafter referred to as LB) is used assuming that the Web system receives requests from a large number of users.</div>
<div class="line">A LB is a device to distribute the load on the Web system  by allocating requests to multiple servers and characterized in flexibly changing process efficiency of Web system by adding and deleting servers.</div>
<div class="line">Health check is a function to monitor operational status of each server allocating the requests. LB uses the health check function wherein it allocates the requests to the servers which are running normally and does not allocate requests to the servers which are malfunctioning. Accordingly, it is possible to continue the operation without stopping the Web system even when a failure occurs in a specific server. (it is called as a fallback)</div>
</div>
<div class="line-block">
<div class="line">In the example below, LB manages 3 servers and allocates requests accordingly.</div>
</div>
<div class="figure" id="id1">
<a class="reference internal image-reference" href="../../_images/healthcheck-overview-flow.png"><img alt="../../_images/healthcheck-overview-flow.png" src="../../_images/healthcheck-overview-flow.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - About Load Balancing</strong></span></p>
</div>
<div class="line-block">
<div class="line">LB periodically sends requests to the server and monitors operational status of the server by checking status code and response returned from the server. When an abnormality occurs in Server A of Fig., LB detects the same and does not allocate the request to server A.</div>
<div class="line">Client A which is originally connected to server A allocates the request to another server (here, server B) through LB.</div>
</div>
<div class="figure" id="id2">
<a class="reference internal image-reference" href="../../_images/healthcheck-overview-flow-failure.png"><img alt="../../_images/healthcheck-overview-flow-failure.png" src="../../_images/healthcheck-overview-flow-failure.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - About Fallback</strong></span></p>
</div>
</div>
<div class="section" id="types-of-health-checks">
<h3><a class="toc-backref" href="#id7">4.14.1.2. Types of health checks</a><a class="headerlink" href="#types-of-health-checks" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Health checks performed by LB are of various types. Example is shown below.</div>
</div>
<div class="figure" id="id3">
<a class="reference internal image-reference" href="../../_images/healthcheck-overview-healthcheckFlow.png"><img alt="../../_images/healthcheck-overview-healthcheckFlow.png" src="../../_images/healthcheck-overview-healthcheckFlow.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - HealthCheck Example</strong></span></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="20%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Types of health checks</th>
<th class="head">Details</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Health check in PING</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Verify operational status at the network layer level of OSI reference model. PING is sent for a server (OS) and determined as “server running” if appropriate response is received from the server.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Health check in TCP/UDP</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Verify operational status in transport layer level of OSI reference model. A request is sent to TCP port (or UDP port) of Web/AP server and determined as “server running” if the appropriate response is received from  the server.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Health check in application</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Verify operational status at the application layer level of OSI reference model. A HTTP request is sent to application running on Web/AP server and determined as “running” if the appropriate response is received from  the server.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">Verification is not possible for operational status of the application, in health check in PING or TCP/UDP. In case of Web application, the application must also be “running” along with running of server (OS) or Web/AP server.</div>
<div class="line">Hence, this guideline recommends a health check to be performed for the application.</div>
</div>
</div>
<div class="section" id="structure-of-health-check-shown-in-the-guideline">
<span id="healthcheckoverview-implementation"></span><h3><a class="toc-backref" href="#id8">4.14.1.3. Structure of health check shown in the guideline</a><a class="headerlink" href="#structure-of-health-check-shown-in-the-guideline" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">This guideline introduces an implementation example for the application wherein a health check is performed in the application.</div>
<div class="line">Basically, a handler consisting of the structure shown in Fig. is implemented which receives a request from LB.</div>
</div>
<div class="figure" id="id4">
<a class="reference internal image-reference" href="../../_images/healthcheck-overview-function.png"><img alt="../../_images/healthcheck-overview-function.png" src="../../_images/healthcheck-overview-function.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - HealthCheck Configuration</strong></span></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Run Controller, Service and Repository by receiving a request from LB.</div>
<div class="line">A method to perform  a simple health check also exists when only operational status is to be verified. However, this guideline also verifies whether the structure and framework used by the application is running correctly, using the health check and implements Controller, Service and Repository to achieve technological configuration of targeted application as much as possible.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Issue SQL from Repository and verify that the database is running.</div>
<div class="line">This is because, in an application with database access, an operation cannot be performed normally if an abnormality occurs in database, even if the application itself is running.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use JSP as a View which returns a response.</div>
<div class="line">Although this guideline explains about JSP, communication method and response format should be changed appropriately in accordance with the characteristics of application, while using REST or SOAP. For details, refer <a class="reference internal" href="../WebServiceDetail/REST.html"><span class="doc">RESTful Web Service</span></a>or <a class="reference internal" href="../WebServiceDetail/SOAP.html"><span class="doc">SOAP Web Service (Server/Client)</span></a>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">Status codes and responses returned by the implementation example of the guideline are as below.</div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="29%" />
<col width="35%" />
<col width="35%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Health check process results</th>
<th class="head">Status code</th>
<th class="head">Response details</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Success</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">200 (Normal)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">3 characters of <code class="docutils literal"><span class="pre">OK.</span></code></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Error occurrence</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Status code set by exception handling function</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Response set by exception handling function</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">For changing configuration of exception handling. refer <a class="reference internal" href="ExceptionHandling.html"><span class="doc">Exception Handling</span></a>.</div>
</div>
</div>
</div>
<div class="section" id="how-to-use">
<span id="healthcheckhowtouse"></span><h2><a class="toc-backref" href="#id9">4.14.2. How to use</a><a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">An implementation example shown in <a class="reference internal" href="#healthcheckoverview-implementation"><span class="std std-ref">Structure of health check shown in the guideline</span></a>is explained.</div>
</div>
<div class="section" id="repository-interface">
<span id="healthcheckhowtouserepository"></span><h3><a class="toc-backref" href="#id10">4.14.2.1. Repository interface</a><a class="headerlink" href="#repository-interface" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">At first, <code class="docutils literal"><span class="pre">HealthCheckRepository</span></code> is created. <code class="docutils literal"><span class="pre">HealthCheckRepository</span></code> executes SQL for health check and verifies database operation.</div>
<div class="line">Note that, an example to access database by using MyBatis3 is explained here. For adopting other methods, refer <a class="reference internal" href="../DataAccessDetail/index.html"><span class="doc">Data Access</span></a>.</div>
</div>
<p><strong>HealthCheckRepository.java</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.domain.repository.healthcheck</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">HealthCheckRepository</span> <span class="o">{</span>
   <span class="kt">void</span> <span class="nf">healthcheck</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">A requisite minimum SQL is configured since only whether database can be accessed correctly is to be verified here.</div>
<div class="line">In this guideline, SQL is configured so as to meet the following conditions.</div>
</div>
<ul class="simple">
<li>It should be a reference system</li>
<li>It should not require parameters</li>
</ul>
<div class="line-block">
<div class="line">An example of mapping file while using PostgreSQL is given below.</div>
</div>
<p><strong>HealthCheckRepository.xml(when PostgreSQL is used)</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">   &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>

<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.healthcheck.HealthCheckRepository&quot;</span><span class="nt">&gt;</span>

   <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;healthcheck&quot;</span> <span class="na">resultType=</span><span class="s">&quot;String&quot;</span><span class="nt">&gt;</span>
      SELECT &#39;1&#39;
   <span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Further, an example of mapping file while using Oracle is given below.</div>
</div>
<p><strong>HealthCheckRepository.xml(When Oracle is used)</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">   &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>

<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.healthcheck.HealthCheckRepository&quot;</span><span class="nt">&gt;</span>

   <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;healthcheck&quot;</span> <span class="na">resultType=</span><span class="s">&quot;String&quot;</span><span class="nt">&gt;</span>
      SELECT &#39;1&#39; FROM DUAL
   <span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="service-class">
<span id="healthcheckhowtouseservice"></span><h3><a class="toc-backref" href="#id11">4.14.2.2. Service class</a><a class="headerlink" href="#service-class" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Next, a <code class="docutils literal"><span class="pre">HealthCheckService</span></code> interface and a <code class="docutils literal"><span class="pre">HealthCheckServiceImpl</span></code> class which implements <code class="docutils literal"><span class="pre">HealthCheckService</span></code> interface are created.</div>
<div class="line"><code class="docutils literal"><span class="pre">HealthCheckServiceImpl</span></code> calls <code class="docutils literal"><span class="pre">healthcheck</span></code> method of <code class="docutils literal"><span class="pre">healthcheckRepository</span></code>and performs health check for the database.</div>
</div>
<p><strong>HealthCheckService.java</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.domain.service.healthcheck</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">HealthCheckService</span> <span class="o">{</span>
   <span class="kt">void</span> <span class="nf">healthcheck</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
<p><strong>HealthCheckServiceImpl.java</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.domain.service.healthcheck</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">healthcheck.domain.repository.healthcheck.HealthCheckRepository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HealthCheckServiceImpl</span> <span class="kd">implements</span> <span class="n">HealthCheckService</span> <span class="o">{</span>

   <span class="nd">@Inject</span>
   <span class="n">HealthCheckRepository</span> <span class="n">healthcheckRepository</span><span class="o">;</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">healthcheck</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">healthcheckRepository</span><span class="o">.</span><span class="na">healthcheck</span><span class="o">();</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="controller-class">
<span id="healthcheckhowtousecontroller"></span><h3><a class="toc-backref" href="#id12">4.14.2.3. Controller class</a><a class="headerlink" href="#controller-class" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Next, a <code class="docutils literal"><span class="pre">HealthCheckController</span></code> is created.</div>
<div class="line"><code class="docutils literal"><span class="pre">healthcheck</span></code> method of <code class="docutils literal"><span class="pre">HealthcheckService</span></code> is called and transition is done to the specified path based on execution results. When it is verified that “database is running”, a view to display <code class="docutils literal"><span class="pre">OK.</span></code> is returned.</div>
</div>
<p><strong>HealthCheckController.java</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.app.healthcheck</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">healthcheck.domain.service.healthcheck.HealthCheckService</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HealthCheckController</span> <span class="o">{</span>

   <span class="nd">@Inject</span>
   <span class="n">HealthCheckService</span> <span class="n">healthcheckService</span><span class="o">;</span>

   <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;healthcheck&quot;</span><span class="o">)</span> <span class="c1">// (1)</span>
   <span class="kd">public</span> <span class="n">String</span> <span class="nf">healthcheck</span><span class="o">(){</span>
      <span class="n">healthcheckService</span><span class="o">.</span><span class="na">healthcheck</span><span class="o">();</span>
      <span class="k">return</span> <span class="s">&quot;common/healthcheck/ok&quot;</span><span class="o">;</span> <span class="c1">// (2)</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">value</span></code>attribute acts as a URL for health check in order to verify operational status.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The directory where JSP file is placed, is kept one layer deep so as not to receive configuration of Apache Tiles. For details, refer <a class="reference internal" href="#healthcheckappendixappatchtiles"><span class="std std-ref">Should not receive settings of Apache Tiles</span></a>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="jsp-file">
<span id="healthcheckhowtousejsp"></span><h3><a class="toc-backref" href="#id13">4.14.2.4. JSP file</a><a class="headerlink" href="#jsp-file" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Finally, a JSP file that is moved once the health check is successful, is created.</div>
<div class="line">While creating JSP file, ensure that a newline character is not inserted between <code class="docutils literal"><span class="pre">&lt;%&#64;page&gt;</span></code> directive and <code class="docutils literal"><span class="pre">OK.</span></code> as shown below.</div>
<div class="line">This is to minimise the data volume for the response.</div>
</div>
<p><strong>ok.jsp</strong></p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="k">&lt;%@</span><span class="n">page</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/plain; charset=utf-8&quot;</span> <span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span> <span class="n">pageEncoding</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span> <span class="k">%&gt;</span>OK.
</pre></div>
</div>
<div class="line-block">
<div class="line">Other precautions must also be taken along with minimising the data volume for the response. For details, refer <a class="reference internal" href="#healthcheckappendixminresponce"><span class="std std-ref">Configuration for minimising the data volume for response</span></a>.</div>
</div>
</div>
<div class="section" id="configuring-access-rights">
<span id="healthcheckhowtousesecurity"></span><h3><a class="toc-backref" href="#id14">4.14.2.5. Configuring access rights</a><a class="headerlink" href="#configuring-access-rights" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">A URL for health check must always be kept active by using authentication and authorization functions, during a health check process.</div>
<div class="line">For example, <code class="docutils literal"><span class="pre">&lt;sec:intercept-url&gt;</span></code> of spring-security.xml is configured for enabling the access for any role.</div>
<div class="line">An example to perform  exclusion settings under <code class="docutils literal"><span class="pre">/common/healthcheck</span></code> is shown below.</div>
<div class="line">For details, refer <a class="reference internal" href="../../Security/Authorization.html"><span class="doc">Authorization</span></a>.</div>
</div>
<p><strong>spring-security.xml</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;sec:http&gt;</span>
   <span class="nt">&lt;sec:intercept-url</span> <span class="na">pattern=</span><span class="s">&quot;/healthcheck/**&quot;</span> <span class="na">access=</span><span class="s">&quot;permitAll&quot;</span><span class="nt">/&gt;</span>
   <span class="c">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/sec:http&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If authorization control is removed, URL for health check can be accessed by anyone.
Hence, countermeasures like using LB to prevent external access are required.</p>
</div>
</div>
</div>
<div class="section" id="appendix">
<span id="healthcheckappendix"></span><h2><a class="toc-backref" href="#id15">4.14.3. Appendix</a><a class="headerlink" href="#appendix" title="Permalink to this headline">¶</a></h2>
<div class="section" id="configuration-for-minimising-the-data-volume-for-response">
<span id="healthcheckappendixminresponce"></span><h3><a class="toc-backref" href="#id16">4.14.3.1. Configuration for minimising the data volume for response</a><a class="headerlink" href="#configuration-for-minimising-the-data-volume-for-response" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">As shown in <a class="reference internal" href="#healthcheckhowtousejsp"><span class="std std-ref">JSP file</span></a>, precautions must be primarily taken for following points in order to minimise data volume for response.</div>
</div>
<ul class="simple">
<li><a class="reference internal" href="#healthcheckappendixappatchtiles"><span class="std std-ref">Apache Tiles settings should not be received</span></a></li>
<li><a class="reference internal" href="#healthcheckappendixheader"><span class="std std-ref">Header file and footer file should not be read</span></a></li>
<li><a class="reference internal" href="#healthcheckappendixtrimwhitespace"><span class="std std-ref">Additional line breaks are to be removed from the response</span></a></li>
</ul>
<p>Respective implementation examples for above are shown below.</p>
<div class="section" id="should-not-receive-settings-of-apache-tiles">
<span id="healthcheckappendixappatchtiles"></span><h4><a class="toc-backref" href="#id17">4.14.3.1.1. Should not receive settings of Apache Tiles</a><a class="headerlink" href="#should-not-receive-settings-of-apache-tiles" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">As shown in <a class="reference internal" href="#healthcheckhowtousecontroller"><span class="std std-ref">Controller class</span></a>, JSP file must be placed under a directory which does not conform to <code class="docutils literal"><span class="pre">&lt;put-attribute&gt;</span></code> tag of tiles-definitions.xml so as not to receive Apache Tiles configuration.</div>
<div class="line">In the default configuration of blank project, since Apache Tiles configuration is applied to JSP corresponding to <code class="docutils literal"><span class="pre">/WEB-INF/views/{1}/{2}.jsp</span></code>, a directory which is a level deep in the hierarchy is created and JSP file is placed under <code class="docutils literal"><span class="pre">/WEB-INF/views/common/healthcheck/</span></code>.</div>
<div class="line">For details, refer <a class="reference internal" href="TilesLayout.html"><span class="doc">Screen Layout using Tiles</span></a>.</div>
</div>
</div>
<div class="section" id="prevent-reading-of-header-and-footer-files">
<span id="healthcheckappendixheader"></span><h4><a class="toc-backref" href="#id18">4.14.3.1.2. Prevent reading of header and footer files</a><a class="headerlink" href="#prevent-reading-of-header-and-footer-files" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Precautions must be taken to check the impact of <code class="docutils literal"><span class="pre">&lt;jsp-config&gt;</span></code>tag of web.xml on JSP file.</div>
<div class="line">When <code class="docutils literal"><span class="pre">&lt;include-prelude&gt;</span></code> and <code class="docutils literal"><span class="pre">&lt;include-coda&gt;</span></code> tags are set in <code class="docutils literal"><span class="pre">&lt;jsp-config&gt;</span></code> tag,</div>
<div class="line">header and footer files are read in JSP file. Check whether the configuration includes reading of header and footer files.</div>
<div class="line">Configuration example is shown below.</div>
</div>
<p><strong>web.xml</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;jsp-config&gt;</span>
    <span class="nt">&lt;jsp-property-group&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/WEB-INF/views/common/healthcheck/ok.jsp<span class="nt">&lt;/url-pattern&gt;</span>
        <span class="nt">&lt;el-ignored&gt;</span>false<span class="nt">&lt;/el-ignored&gt;</span>
        <span class="nt">&lt;page-encoding&gt;</span>UTF-8<span class="nt">&lt;/page-encoding&gt;</span>
        <span class="nt">&lt;scripting-invalid&gt;</span>false<span class="nt">&lt;/scripting-invalid&gt;</span>
        // (1)
    <span class="nt">&lt;/jsp-property-group&gt;</span>
<span class="nt">&lt;/jsp-config&gt;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">&lt;include-prelude&gt;</span></code> tag and <code class="docutils literal"><span class="pre">&lt;include-coda&gt;</span></code> tag are not set in order to not to incorporate additional headers and footers.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="remove-additional-line-breaks-from-response">
<span id="healthcheckappendixtrimwhitespace"></span><h4><a class="toc-backref" href="#id19">4.14.3.1.3. Remove additional line breaks from response</a><a class="headerlink" href="#remove-additional-line-breaks-from-response" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">For example, when <code class="docutils literal"><span class="pre">&lt;%&#64;taglib&gt;</span></code> directive is set at the beginning of JSP, in order to use tag library, additional line breaks are output at the beginning of response.</div>
<div class="line">Hence, <code class="docutils literal"><span class="pre">trimDirectiveWhitespaces</span></code> attribute is set in <code class="docutils literal"><span class="pre">&lt;%&#64;page&gt;</span></code> directive and output of additional line breaks in ok.jsp is prevented.</div>
</div>
<p><strong>ok.jsp (while setting trimDirectiveWhitespaces attribute)</strong></p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="k">&lt;%@</span><span class="n">page</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/plain; charset=utf-8&quot;</span> <span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span> <span class="n">pageEncoding</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span> <span class="n">trimDirectiveWhitespaces</span><span class="o">=</span><span class="s">&quot;true&quot;</span> <span class="k">%&gt;</span>OK.
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">/WEB-INF/views/common/include.jsp</span></code> is configured in <code class="docutils literal"><span class="pre">&lt;include-prelude&gt;</span></code>of web.xml, in the default configuration of Blank project.
Hence, it is necessary to configure as shown above or modify <code class="docutils literal"><span class="pre">&lt;url-pattern&gt;</span></code>so as not to include ok.jsp.
If these actions are not taken, include.jsp is read by entire JSP file and line breaks are output in ok.jsp.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>When WebLogic is used, line breaks are not removed when an additional character exists before <code class="docutils literal"><span class="pre">&lt;%&#64;page&gt;</span></code>directive, even when <code class="docutils literal"><span class="pre">trimDirectiveWhitespaces</span></code>attribute is configured as shown above.
Hence, a different method should be used.
As an example, how to configure a <code class="docutils literal"><span class="pre">&lt;trim-directive-whitespaces&gt;</span></code> tag in <code class="docutils literal"><span class="pre">&lt;jsp-property-group&gt;</span></code> tag of web.xml is shown below.</p>
<p><strong>web.xml(while setting &lt;trim-directive-whitespaces&gt;  tag)</strong></p>
<blockquote class="last">
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;jsp-config&gt;</span>
    <span class="nt">&lt;jsp-property-group&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/WEB-INF/views/common/healthcheck/ok.jsp<span class="nt">&lt;/url-pattern&gt;</span> // (1)
        <span class="nt">&lt;el-ignored&gt;</span>false<span class="nt">&lt;/el-ignored&gt;</span>
        <span class="nt">&lt;page-encoding&gt;</span>UTF-8<span class="nt">&lt;/page-encoding&gt;</span>
        <span class="nt">&lt;scripting-invalid&gt;</span>false<span class="nt">&lt;/scripting-invalid&gt;</span>
        <span class="nt">&lt;trim-directive-whitespaces&gt;</span>true<span class="nt">&lt;/trim-directive-whitespaces&gt;</span> // (2)
    <span class="nt">&lt;/jsp-property-group&gt;</span>
<span class="nt">&lt;/jsp-config&gt;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify only ok.jsp in <code class="docutils literal"><span class="pre">&lt;url-pattern&gt;</span></code> tag in order to apply <code class="docutils literal"><span class="pre">&lt;trim-directive-whitespaces&gt;</span></code> tag only in ok.jsp.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Remove additional line breaks from targeted jsp file (ok.jsp) by setting <code class="docutils literal"><span class="pre">true</span></code> in <code class="docutils literal"><span class="pre">&lt;trim-directive-whitespaces&gt;</span></code> tag.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div></blockquote>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../WebServiceDetail/index.html" title="5. Web Services"
             >next</a> |</li>
        <li class="right" >
          <a href="Ajax.html" title="4.13. Ajax"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.3.1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >4. Web Application Development Features</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
      © Copyright 2013-2017, NTT DATA Corporation. © Copyright 2017, NTT Corporation.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.3.Theme by <a href="http://github.com/vkvn">vkvn</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>
