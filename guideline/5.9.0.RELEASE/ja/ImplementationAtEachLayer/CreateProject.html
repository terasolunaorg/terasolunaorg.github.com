<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>3.5. 開発プロジェクトのビルド &#8212; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.9.0.RELEASE documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/solar.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4. Webアプリ開発機能" href="../ArchitectureInDetail/WebApplicationDetail/index.html" />
    <link rel="prev" title="3.4. アプリケーション層の実装" href="ApplicationLayer.html" /><script src="../_static/jquery.js" type="text/javascript"></script>
<script src="../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../_static/solarized-dark.css" rel="stylesheet">
<link href="../_static/jquery.treeview.css" rel="stylesheet">
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../ArchitectureInDetail/WebApplicationDetail/index.html" title="4. Webアプリ開発機能"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ApplicationLayer.html" title="3.4. アプリケーション層の実装"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.9.0.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U"><span class="section-number">3. </span>アプリケーション開発</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">3.5. </span>開発プロジェクトのビルド</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox"> scroll sidebar</label>
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">3.5. 開発プロジェクトのビルド</a><ul>
<li><a class="reference internal" href="#id3">3.5.1. 開発プロジェクトのビルド</a><ul>
<li><a class="reference internal" href="#envjarwar">3.5.1.1. envモジュールのjarファイルをwarファイルに含めないビルド方法</a><ul>
<li><a class="reference internal" href="#war">3.5.1.1.1. warファイルの作成</a></li>
<li><a class="reference internal" href="#envjar">3.5.1.1.2. envモジュールのjarファイルの作成</a></li>
</ul>
</li>
<li><a class="reference internal" href="#createwebapplicationprojectbuildwarincludeenvjar">3.5.1.2. envモジュールのjarファイルをwarファイルに含めるビルド方法</a><ul>
<li><a class="reference internal" href="#createwebapplicationprojectbuildwarincludeenvjarwar">3.5.1.2.1. warファイルの作成</a></li>
</ul>
</li>
<li><a class="reference internal" href="#createwebapplicationprojectbuilddeploy">3.5.1.3. デプロイ</a><ul>
<li><a class="reference internal" href="#tomcat">3.5.1.3.1. Tomcatへのデプロイ</a></li>
<li><a class="reference internal" href="#createwebapplicationprojectbuilddeploycontinueddeployment">3.5.1.3.2. 継続的なデプロイ</a><ul>
<li><a class="reference internal" href="#snapshot">3.5.1.3.2.1. SNAPSHOTバージョンの運用</a></li>
<li><a class="reference internal" href="#release">3.5.1.3.2.2. RELEASEバージョンの運用</a></li>
<li><a class="reference internal" href="#id8">3.5.1.3.2.3. アプリケーションサーバへのリリース</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="ApplicationLayer.html"
                          title="previous chapter"><span class="section-number">3.4. </span>アプリケーション層の実装</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../ArchitectureInDetail/WebApplicationDetail/index.html"
                          title="next chapter"><span class="section-number">4. </span>Webアプリ開発機能</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/ImplementationAtEachLayer/CreateProject.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="id1">
<h1><span class="section-number">3.5. </span>開発プロジェクトのビルド<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="id2">
<p class="topic-title">目次</p>
<ul class="simple">
<li><p><a class="reference internal" href="#id3" id="id9">開発プロジェクトのビルド</a></p>
<ul>
<li><p><a class="reference internal" href="#envjarwar" id="id10">envモジュールのjarファイルをwarファイルに含めないビルド方法</a></p>
<ul>
<li><p><a class="reference internal" href="#war" id="id11">warファイルの作成</a></p></li>
<li><p><a class="reference internal" href="#envjar" id="id12">envモジュールのjarファイルの作成</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#createwebapplicationprojectbuildwarincludeenvjar" id="id13">envモジュールのjarファイルをwarファイルに含めるビルド方法</a></p>
<ul>
<li><p><a class="reference internal" href="#createwebapplicationprojectbuildwarincludeenvjarwar" id="id14">warファイルの作成</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#createwebapplicationprojectbuilddeploy" id="id15">デプロイ</a></p>
<ul>
<li><p><a class="reference internal" href="#tomcat" id="id16">Tomcatへのデプロイ</a></p></li>
<li><p><a class="reference internal" href="#createwebapplicationprojectbuilddeploycontinueddeployment" id="id17">継続的なデプロイ</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="id3">
<h2><a class="toc-backref" href="#id9" role="doc-backlink"><span class="section-number">3.5.1. </span>開発プロジェクトのビルド</a><a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h2>
<p>アプリケーションサーバにデプロイするためのwarファイル、envモジュール(環境依存ファイルを格納するモジュール)のjarファイルを作成する方法を紹介する。</p>
<p>Maven Archetypeで作成したプロジェクトでは、warファイルを作成する方法として以下の2つの方法を提供している。</p>
<ul class="simple">
<li><p><a class="reference internal" href="#createwebapplicationprojectbuildwarexcludeenvjar"><span class="std std-ref">envモジュールのjarファイルをwarファイルに含めないビルド方法</span></a> (<strong>推奨</strong>)</p></li>
<li><p><a class="reference internal" href="#createwebapplicationprojectbuildwarincludeenvjar"><span class="std std-ref">envモジュールのjarファイルをwarファイルに含めるビルド方法</span></a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>推奨するビルド方法について</strong></p>
<p>本ガイドラインでは、<a class="reference internal" href="#createwebapplicationprojectbuildwarexcludeenvjar"><span class="std std-ref">envモジュールのjarファイルをwarファイルに含めないビルド方法</span></a>を推奨している。なお、ここで紹介するビルド方法は選択肢の一つであり、他のビルド方法を採用してもよい。</p>
<p>ただし、<strong>試験環境や商用環境にリリースするwarファイルとjarファイルは、EclipseなどのIDEが提供している機能を使って作成しないようにすること。</strong></p>
<p>Eclipseなどの一部のIDEでは、開発用に最適化された独自のコンパイラを使ってクラスファイルを作成しており、コンパイラの違いが原因でアプリケーション実行時に予期しないエラーが発生するリスクが生まれる。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>プロジェクト構成の原則</strong></p>
<p>原則として下記のようなプロジェクト構造とする。</p>
<ol class="arabic simple">
<li><p>必ずマルチプロジェクト構成にする。</p></li>
<li><p>一つのプロジェクトに環境依存性のある設定ファイル（ex. logback.xml, jdbc.properties）をできるだけ集約する。<strong>以降、このプロジェクトを *-env と表現する。</strong></p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>ex. secure-login-env</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>*-env以外のプロジェクトには環境依存性のある設定値を一切持たせない。</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>もちろん、src/test/resources 配下などにテスト用の環境依存性設定ファイルを格納しておくことは許可される。</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>全てのソフトウェアのパッケージ済みバイナリをパッケージリポジトリ上に保管して管理する。</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>*.jarファイルだけではなく*.warファイルも成果物としてパッケージリポジトリにデプロイする。したがって、それらのjar/warファイルには環境依存性が含まれていてはならない。</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>*-env プロジェクトは下記のような構造にする。</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>開発者のPC上での作業に必要な設定値をデフォルトとして src/main/resources 配下のファイルに格納する。</p></li>
<li><p>試験サーバ、本番サーバ等、環境毎に異なる設定ファイルを src/main/resources 以外(ex. configs/test-server)のフォルダに格納し、mavenのprofile機能を使って環境毎に自動的に設定値を差し替えながら *-env-x.y.z.jarファイルをビルドする。</p></li>
</ul>
</div></blockquote>
<p>上記のような構造を取ることにより、ソフトウェアライフサイクルの全ての場面において、適切に開発をすることができるようになる。</p>
<ol class="arabic simple">
<li><p>ローカル開発環境では、プロジェクト本体と*-envプロジェクトの両方をチェックアウトし、envプロジェクトを本体プロジェクトのビルドパスに含めることによって、ローカル開発環境でのコーディングとテストを可能にする。</p></li>
<li><p>CIサーバ上ではビルドツール(maven)によるテストの実行とパッケージングを行い、必要に応じてパッケージリポジトリにartifactをdeployする。</p></li>
<li><p>試験サーバ、本番サーバでは、パッケージリポジトリにあらかじめ保管しているプロジェクト本体に、リリース先環境にあわせてビルドした*-envプロジェクトを追加してリリースすることにより、アプリケーションの動作が可能になる。</p></li>
</ol>
<p>詳細についてはチュートリアル(<a class="reference external" href="https://github.com/terasolunaorg/tutorial-apps/tree/release/5.9.0.RELEASE/JavaConfig/secure-login-demo">JavaConfig</a>/<a class="reference external" href="https://github.com/terasolunaorg/tutorial-apps/tree/release/5.9.0.RELEASE/XMLConfig/secure-login-demo">XMLConfig</a>)を参考にされたい。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>ビルド環境について</strong></p>
<p>ここではWindows環境でビルドする例になっているが、Windows環境でビルドすることを推奨しているわけではない。</p>
<p>本ガイドラインでは、<strong>アプリケーションの実行環境と同じOSとJDKのバージョンを使ってビルドすることを推奨する。</strong></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">Mavenを使ってビルドする場合は、環境変数「JAVA_HOME」にコンパイル時に使用するJDKのホームディレクトリが指定されていることを確認されたい。</div>
<div class="line">環境変数が設定されていない場合や異なるバージョンのJDKのホームディレクトリが指定されている場合は、環境変数に適切なホームディレクトリを指定すること。</div>
</div>
<p><strong>[Windowsの場合]</strong></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">echo %JAVA_HOME%</span>
<span class="go">set JAVA_HOME={Please set home directory of JDK}</span>
</pre></div>
</div>
<p><strong>[Linux系の場合]</strong></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">echo $JAVA_HOME</span>
<span class="go">JAVA_HOME={Please set home directory of JDK}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>環境変数「JAVA_HOME」は、ビルドを実行するOSユーザーのユーザー環境変数に設定しておくとよい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="envjarwar">
<span id="createwebapplicationprojectbuildwarexcludeenvjar"></span><h3><a class="toc-backref" href="#id10" role="doc-backlink"><span class="section-number">3.5.1.1. </span>envモジュールのjarファイルをwarファイルに含めないビルド方法</a><a class="headerlink" href="#envjarwar" title="Permalink to this heading">¶</a></h3>
<section id="war">
<span id="createwebapplicationprojectbuildwarexcludeenvjarstepwar"></span><h4><a class="toc-backref" href="#id11" role="doc-backlink"><span class="section-number">3.5.1.1.1. </span>warファイルの作成</a><a class="headerlink" href="#war" title="Permalink to this heading">¶</a></h4>
<p>開発プロジェクトのルートディレクトリへ移動する。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd C:\work\todo</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">Mavenのプロファイル(<code class="docutils literal notranslate"><span class="pre">-P</span></code>パラメータ)に<code class="docutils literal notranslate"><span class="pre">warpack</span></code>を指定して、Maven installを実行する。</div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mvn -P warpack clean install</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Maven packageの実行が成功すると、webモジュールのtargetディレクトリの中に、envモジュールのjarファイルが含まれていないwarファイルが作成される。</div>
<div class="line">(例：<code class="docutils literal notranslate"><span class="pre">C:\work\todo\todo-web\target\todo-web.war</span></code>)</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>指定するゴールについて</strong></p>
<p>上記例ではゴールに<code class="docutils literal notranslate"><span class="pre">install</span></code>を指定してwarファイルをローカルリポジトリへインストールしているが、</p>
<ul class="simple">
<li><p>warファイルの作成のみ行う場合はゴールに<code class="docutils literal notranslate"><span class="pre">package</span></code></p></li>
<li><p>Nexusなどのリモートリポジトリへデプロイする場合はゴールに<code class="docutils literal notranslate"><span class="pre">deploy</span></code></p></li>
</ul>
<p>を指定すればよい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="envjar">
<span id="createwebapplicationprojectbuildwarexcludeenvjarstepenvjar"></span><h4><a class="toc-backref" href="#id12" role="doc-backlink"><span class="section-number">3.5.1.1.2. </span>envモジュールのjarファイルの作成</a><a class="headerlink" href="#envjar" title="Permalink to this heading">¶</a></h4>
<p>envモジュールのディレクトリへ移動する。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd C:\work\todo\todo-env</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Mavenのプロファイル(<code class="docutils literal notranslate"><span class="pre">-P</span></code>パラメータ)に<strong>環境を識別するプロファイルID</strong>を指定して、Maven packageを実行する。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mvn -P test-server clean package</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Maven packageの実行が成功すると、envモジュールのtargetディレクトリの中に、指定した環境用のjarファイルが作成される。</div>
<div class="line">(例：<code class="docutils literal notranslate"><span class="pre">C:\work\todo\todo-env\target\todo-env-1.0.0-SNAPSHOT-test-server.jar</span></code>)</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>環境を識別するプロファイルIDについて</strong></p>
<p>Maven Archetypeで作成したプロジェクトでは、以下のプロファイルIDがデフォルトで定義されている。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">local</span></code> : 開発者のローカル環境向け(IDE開発環境向け)のプロファイル (デフォルトのプロファイル)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test-server</span></code> : 試験環境向けのプロファイル</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">production-server</span></code> : 商用環境向けのプロファイル</p></li>
</ul>
<p>デフォルトで用意しているプロファイルは上記の3つだが、開発するシステムの環境構成にあわせて追加及び修正されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="createwebapplicationprojectbuildwarincludeenvjar">
<span id="id4"></span><h3><a class="toc-backref" href="#id13" role="doc-backlink"><span class="section-number">3.5.1.2. </span>envモジュールのjarファイルをwarファイルに含めるビルド方法</a><a class="headerlink" href="#createwebapplicationprojectbuildwarincludeenvjar" title="Permalink to this heading">¶</a></h3>
<section id="createwebapplicationprojectbuildwarincludeenvjarwar">
<span id="id5"></span><h4><a class="toc-backref" href="#id14" role="doc-backlink"><span class="section-number">3.5.1.2.1. </span>warファイルの作成</a><a class="headerlink" href="#createwebapplicationprojectbuildwarincludeenvjarwar" title="Permalink to this heading">¶</a></h4>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>envモジュールのjarファイルをwarファイルに含める場合の注意点</strong></p>
<p>envモジュールのjarファイルをwarファイルに含めた場合、warファイルを他の環境にデプロイすることができないため、間違って他の環境(特に商用環境)にデプロイされないようにwarファイルを管理すること。</p>
<p>また、環境毎にwarファイルを作成して各環境へリリースする方法を採用した場合、商用環境へリリースされるwarファイルが厳密にいうとテスト済みのwarファイルではないという点を意識してほしい。これは、商用環境用のwarファイルを作成する際にコンパイルをしなおすためである。</p>
<p>warファイルを環境毎に作成してリリースする場合は、GitやSubversionなどのVCS(Version Control System)の機能(タグ機能など)を活用し、テスト済みのソースファイルを使用して商用環境や各種テスト環境へリリースするwarファイルを作成する仕組みを確立することが特に重要である。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>開発プロジェクトのルートディレクトリへ移動する。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd C:\work\todo</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">Mavenのプロファイル(<code class="docutils literal notranslate"><span class="pre">-P</span></code>パラメータ)に<code class="docutils literal notranslate"><span class="pre">warpack-with-env</span></code>とenvモジュールの中で定義している<strong>環境を識別するプロファイルID</strong>を指定して、Maven packageを実行する。</div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mvn -P warpack-with-env,test-server clean package</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Maven packageの実行が成功すると、webモジュールのtargetディレクトリの中に、envモジュールのjarファイルを含んだwarファイルが作成される。</div>
<div class="line">(例：<code class="docutils literal notranslate"><span class="pre">C:\work\todo\todo-web\target\todo-web.war</span></code>)</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="createwebapplicationprojectbuilddeploy">
<span id="id6"></span><h3><a class="toc-backref" href="#id15" role="doc-backlink"><span class="section-number">3.5.1.3. </span>デプロイ</a><a class="headerlink" href="#createwebapplicationprojectbuilddeploy" title="Permalink to this heading">¶</a></h3>
<section id="tomcat">
<span id="createwebapplicationprojectbuilddeploytotomcat"></span><h4><a class="toc-backref" href="#id16" role="doc-backlink"><span class="section-number">3.5.1.3.1. </span>Tomcatへのデプロイ</a><a class="headerlink" href="#tomcat" title="Permalink to this heading">¶</a></h4>
<p>WebアプリケーションをTomcat上にリリースする場合は次のような手順をとる。</p>
<ol class="arabic simple">
<li><p>リリース対象のAPサーバ環境にあわせてmavenのprofileを指定し、 *-env プロジェクトを ビルドする。</p></li>
<li><p>上記でビルドした*-env-x.y.z.jarファイル をあらかじめ決定したAPサーバ上のフォルダに設置する。 ex. /etc/foo/bar/abcd-env-x.y.z.jar</p></li>
<li><p>あらかじめパッケージリポジトリにデプロイ済みの*.warファイルを [CATALINA_HOME]/webapps 配下にコピーする。</p></li>
<li><p>Tomcatのリソース機能を使用して、 /etc/foo/bar/*.jar をクラスパスに追加する。</p></li>
</ol>
<blockquote>
<div><ul>
<li><div class="line-block">
<div class="line">[CATALINA_HOME]/conf/Catalina/localhost/[contextPath].xmlファイルに下記の定義を追加する。</div>
<div class="line">詳しくは、<a class="reference external" href="https://tomcat.apache.org/tomcat-10.1-doc/config/resources.html">The Resources Component</a>と<a class="reference external" href="https://github.com/terasolunaorg/atrs/tree/release/1.10.0.RELEASE/XMLConfig-JSP/atrs/atrs-env/configs">atrs-envのconfigsフォルダ</a>を参考されたい。</div>
</div>
</li>
<li><p>リソースの設定例：</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;Resources</span><span class="w"> </span><span class="na">className=</span><span class="s">&quot;org.apache.catalina.webresources.StandardRoot&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;PreResources</span><span class="w"> </span><span class="na">className=</span><span class="s">&quot;org.apache.catalina.webresources.DirResourceSet&quot;</span>
<span class="w">                </span><span class="na">base=</span><span class="s">&quot;/etc/foo/bar/&quot;</span>
<span class="w">                </span><span class="na">internalPath=</span><span class="s">&quot;/&quot;</span>
<span class="w">                </span><span class="na">webAppMount=</span><span class="s">&quot;/WEB-INF/lib&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Resources&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Catalina以外のエンジン、およびlocalhost以外のホストを利用する場合は、[contextPath].xmlを[CATALINA_HOME]/conf/[enginename]/[hostname]に配置する。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="createwebapplicationprojectbuilddeploycontinueddeployment">
<span id="id7"></span><h4><a class="toc-backref" href="#id17" role="doc-backlink"><span class="section-number">3.5.1.3.2. </span>継続的なデプロイ</a><a class="headerlink" href="#createwebapplicationprojectbuilddeploycontinueddeployment" title="Permalink to this heading">¶</a></h4>
<p>プロジェクト（ソースコードツリー）の構造、バージョン管理、インスペクションとビルド作業、ライフサイクル管理の工程を恒常的にループさせることによって目的のソフトウェアをリリースし続けることが、継続的デプロイメントである。</p>
<div class="line-block">
<div class="line">開発の途中では、SNAPSHOTバージョンのソフトウェアをパッケージリポジトリや開発用APサーバにリリースし、テストを実施する。</div>
<div class="line">ソフトウェアを正式にリリースする場合には、バージョン番号を固定したうえでVCSのソースコードツリーに対してタグづけを行う必要がある。</div>
<div class="line">このように、スナップショットリリースの場合と正式リリースの場合で、ビルドとデプロイのフローが少し異なる。</div>
</div>
<p>また、Webサービスを提供するAPサーバにアプリケーションをデプロイする場合には、スナップショットバージョンか正式リリースバージョンかに関わらず、デプロイ先のAPサーバ環境に合わせた環境依存性設定ファイル群と*.warファイルをセットでデプロイする必要がある。</p>
<p>そこで、環境依存性設定を持たない状態のライブラリ(jar,war)をmavenリポジトリに登録する作業と、それらを実際にAPサーバにデプロイする作業を分離することによって、デプロイ作業を簡潔に実施可能にする。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>mavenの世界では、pom.xml上の&lt;version&gt;タグの内容によってそれがSNAPSHOTバージョンなのかRELEASEバージョンなのかが自動的に判別される。</p>
<ul class="simple">
<li><p>末尾が -SNAPSHOT である場合にSNAPSHOTとみなされる。例 : &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</p></li>
<li><p>末尾が -SNAPSHOT ではない場合はRELEASEとみなされる。例 : &lt;version&gt;1.0&lt;/version&gt;</p></li>
</ul>
<p>また、mavenパッケージリポジトリにはsnapshotsリポジトリとreleaseリポジトリの2種類があり、いくつかの制約があることに注意する。</p>
<ul class="simple">
<li><p>SNAPSHOTバージョンのソフトウェアをreleaseリポジトリに登録することはできない。その逆も不可能。</p></li>
<li><p>releaseリポジトリには、同一のGAV情報を持つartifactは1回しか登録できない。（GAV=groupId,artifactId,version）</p></li>
<li><p>snapshotリポジトリには、同一のGAV情報を持つartifactを何度でも登録しなおすことができる。</p></li>
</ul>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="snapshot">
<h5><span class="section-number">3.5.1.3.2.1. </span>SNAPSHOTバージョンの運用<a class="headerlink" href="#snapshot" title="Permalink to this heading">¶</a></h5>
<p>SNAPSHOTバージョンのソフトウェアのデリバリーフローは下図のように簡潔である。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/ContinuousDelivery-snapshot.png"><img alt="Continuous delivery for SNAPSHOT version." src="../_images/ContinuousDelivery-snapshot.png" style="width: 600px;" /></a>
</figure>
<ol class="arabic simple">
<li><p>開発用trunkからソースコードをチェックアウトする。</p></li>
<li><p>コンパイル、コードメトリクスの測定、テストを実行する。</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>コンパイルエラー、コードメトリクスでの一定以上のviolationの発生、テストの失敗の場合、以降の作業を中止する。</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>mavenパッケージリポジトリサーバにartifact(jar,warファイル)をアップロード(mvn deploy)する。</p></li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="release">
<h5><span class="section-number">3.5.1.3.2.2. </span>RELEASEバージョンの運用<a class="headerlink" href="#release" title="Permalink to this heading">¶</a></h5>
<p>正式なリリースの場合、バージョン番号の付与作業が必要なため、SNAPSHOTリリースよりもやや複雑なフローとなる。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/ContinuousDelivery-release.png"><img alt="Continuous delivery for RELEASE version." src="../_images/ContinuousDelivery-release.png" style="width: 600px;" /></a>
</figure>
<ol class="arabic simple">
<li><p>リリースに与えるバージョン番号を決定する。（例 : 1.0.1）</p></li>
<li><p>開発用trunk(またはリリース用branch)からソースコードをチェックアウトする。</p></li>
<li><p>pom.xml上の&lt;version&gt;タグを変更する。（例 : &lt;version&gt;1.0.1&lt;/version&gt;）</p></li>
<li><p>VCS上にtagを付与する。（例 : tags/1.0.1）</p></li>
<li><p>コンパイル、コードメトリクスの測定、テストを実行する。</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>コンパイルエラー、コードメトリクスでの一定以上のviolationの発生、テストの失敗の場合、以降の作業を中止する。</p></li>
<li><p>失敗した場合はVCS上のtagを削除する。</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>mavenパッケージリポジトリサーバにartifact(jar,warファイル)をアップロード(mvn deploy)する。</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>pom.xmlファイルの&lt;version&gt;タグの変更は<a class="reference external" href="https://www.mojohaus.org/versions-maven-plugin/">versions-maven-plugin</a>で可能である。</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mvn<span class="w"> </span>versions:set<span class="w"> </span>-DnewVersion<span class="o">=</span><span class="m">1</span>.0.0
</pre></div>
</div>
</div></blockquote>
<p>上記のようなコマンドで、pom.xml内のversionタグを&lt;version&gt;1.0.0&lt;/version&gt;のように編集することができる。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id8">
<h5><span class="section-number">3.5.1.3.2.3. </span>アプリケーションサーバへのリリース<a class="headerlink" href="#id8" title="Permalink to this heading">¶</a></h5>
<div class="line-block">
<div class="line">Webサービスを提供するAPサーバにアプリケーションをリリースする場合、あらかじめmavenパッケージリポジトリに登録済みのwarファイルと、リリース先のAPサーバ環境に合わせた環境依存性設定ファイル群とを、セットでリリースする。</div>
<div class="line">これはスナップショットリリースか正式リリースかに関わらず同じフローとなる。</div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/ContinuousDelivery-apserver.png"><img alt="Continuous delivery for webapp to application server." src="../_images/ContinuousDelivery-apserver.png" style="width: 600px;" /></a>
</figure>
<ol class="arabic simple">
<li><p>リリース対象バージョンのwarファイルをmavenパッケージリポジトリからダウンロードする</p></li>
<li><p>*-resourcesプロジェクト（環境依存性設定ファイルを集約しているプロジェクト）をVCSからチェックアウトする</p></li>
<li><p>mavenのprofileを機能によって、リリース先の環境に合わせた設定ファイル群で内容を差し替えてresourcesプロジェクトをパッケージし、*-resources-x.y.z.jarを生成する。</p></li>
<li><p>生成した*-resources-x.y.z.jarファイルを、warファイル内のWEB-INF/libフォルダ配下に追加する。</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>Tomcatの場合は、*-resources-x.y.z.jarをwarファイル内部に追加するのではなく、Tomcatサーバ上の任意のパスにコピーし、そのパスをVirtualWebappLoaderの拡張クラスパスに指定する。</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>warファイルをアプリケーションサーバにデプロイする。</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>mavenパッケージリポジトリからのwarファイルのダウンロードは、maven-dependency-pluginのcopyゴールで可能である。</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mvn<span class="w"> </span>org.apache.maven.plugins:maven-dependency-plugin:3.2.0:copy^
<span class="w"> </span>-Dartifact<span class="o">=</span>com.example:mywebapp:0.0.1-SNAPSHOT:war^
<span class="w"> </span>-DoutputDirectory<span class="o">=</span>target
</pre></div>
</div>
</div></blockquote>
<p>これで、targetというディレクトリ配下にmywebapp-0.0.1-SNAPSHOT.warファイルがダウンロードされる。</p>
<p>さらに、下記のようなコマンドで環境依存設定ファイルのパッケージをmywebapp-0.0.1-SNAPSHOT.warファイル内に追加することができる。</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$WORKSPACE</span>/target/WEB-INF/lib
<span class="nb">cd</span><span class="w"> </span><span class="nv">$WORKSPACE</span>/target
cp<span class="w"> </span>./mywebapp-resources*.jar<span class="w"> </span>WEB-INF/lib
jar<span class="w"> </span>-ufv<span class="w"> </span>mywebapp-0.0.1-SNAPSHOT.war<span class="w"> </span>WEB-INF/lib
</pre></div>
</div>
</div></blockquote>
</div>
</section>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../ArchitectureInDetail/WebApplicationDetail/index.html" title="4. Webアプリ開発機能"
             >next</a> |</li>
        <li class="right" >
          <a href="ApplicationLayer.html" title="3.4. アプリケーション層の実装"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.9.0.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" ><span class="section-number">3. </span>アプリケーション開発</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">3.5. </span>開発プロジェクトのビルド</a></li> 
      </ul>
    </div>
    <div class="footer">
      © Copyright 2024, NTT DATA Group Corporation. © Copyright 2013, NTT Corporation.
      Created using <a href="https://www.sphinx-doc.org/en/master/">Sphinx</a> 7.0.1.Theme is <a href="https://pypi.org/project/solar-theme/">Solar</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    </script>
  </body>
</html>