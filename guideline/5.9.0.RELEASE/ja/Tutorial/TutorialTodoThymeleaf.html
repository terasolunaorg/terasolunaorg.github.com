<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>11.2. チュートリアル(Todoアプリケーション Thymeleaf編) &#8212; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.9.0.RELEASE documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/solar.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/tabs.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="11.3. チュートリアル(Todoアプリケーション REST編)" href="TutorialREST.html" />
    <link rel="prev" title="11.1. チュートリアル(Todoアプリケーション JSP編)" href="TutorialTodo.html" /><script src="../_static/jquery.js" type="text/javascript"></script>
<script src="../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../_static/solarized-dark.css" rel="stylesheet">
<link href="../_static/jquery.treeview.css" rel="stylesheet">
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="TutorialREST.html" title="11.3. チュートリアル(Todoアプリケーション REST編)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="TutorialTodo.html" title="11.1. チュートリアル(Todoアプリケーション JSP編)"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.9.0.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U"><span class="section-number">11. </span>チュートリアル</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">11.2. </span>チュートリアル(Todoアプリケーション Thymeleaf編)</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox"> scroll sidebar</label>
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">11.2. チュートリアル(Todoアプリケーション Thymeleaf編)</a><ul>
<li><a class="reference internal" href="#id2">11.2.1. はじめに</a><ul>
<li><a class="reference internal" href="#id3">11.2.1.1. このチュートリアルで学ぶこと</a></li>
<li><a class="reference internal" href="#id4">11.2.1.2. 対象読者</a></li>
<li><a class="reference internal" href="#id5">11.2.1.3. 検証環境</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id6">11.2.2. 作成するアプリケーションの説明</a><ul>
<li><a class="reference internal" href="#tutorial-todo-application-overview-label-thymeleaf">11.2.2.1. アプリケーションの概要</a></li>
<li><a class="reference internal" href="#app-requirement-thymeleaf">11.2.2.2. アプリケーションの業務要件</a></li>
<li><a class="reference internal" href="#id9">11.2.2.3. アプリケーションの処理仕様</a><ul>
<li><a class="reference internal" href="#show-all-todo">11.2.2.3.1. Show all TODO</a></li>
<li><a class="reference internal" href="#create-todo">11.2.2.3.2. Create TODO</a></li>
<li><a class="reference internal" href="#finish-todo">11.2.2.3.3. Finish TODO</a></li>
<li><a class="reference internal" href="#delete-todo">11.2.2.3.4. Delete TODO</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id10">11.2.2.4. エラーメッセージ一覧</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id11">11.2.3. 環境構築</a><ul>
<li><a class="reference internal" href="#id12">11.2.3.1. プロジェクトの作成</a><ul>
<li><a class="reference internal" href="#o-r-mapper">11.2.3.1.1. O/R Mapperに依存しないブランクプロジェクトの作成</a></li>
<li><a class="reference internal" href="#mybatis3">11.2.3.1.2. MyBatis3用のブランクプロジェクトの作成</a></li>
<li><a class="reference internal" href="#jpa">11.2.3.1.3. JPA用のブランクプロジェクトの作成</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id13">11.2.3.2. プロジェクトのインポート</a></li>
<li><a class="reference internal" href="#id14">11.2.3.3. プロジェクトの構成</a></li>
<li><a class="reference internal" href="#id15">11.2.3.4. 設定ファイルの確認</a></li>
<li><a class="reference internal" href="#id16">11.2.3.5. プロジェクトの動作確認</a></li>
</ul>
</li>
<li><a class="reference internal" href="#todo">11.2.4. Todoアプリケーションのプロトタイプ作成</a><ul>
<li><a class="reference internal" href="#id17">11.2.4.1. プロトタイプ作成</a></li>
<li><a class="reference internal" href="#id18">11.2.4.2. 画面の静的表示の確認</a></li>
<li><a class="reference internal" href="#css">11.2.4.3. CSSファイルの使用</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id19">11.2.5. Todoアプリケーションの作成</a><ul>
<li><a class="reference internal" href="#id20">11.2.5.1. ドメイン層の作成</a><ul>
<li><a class="reference internal" href="#domain-object">11.2.5.1.1. Domain Objectの作成</a></li>
<li><a class="reference internal" href="#repository">11.2.5.1.2. Repositoryの作成</a></li>
<li><a class="reference internal" href="#repositoryimpl">11.2.5.1.3. RepositoryImplの作成(インフラストラクチャ層)</a></li>
<li><a class="reference internal" href="#service">11.2.5.1.4. Serviceの作成</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id21">11.2.5.2. アプリケーション層の作成</a><ul>
<li><a class="reference internal" href="#controller">11.2.5.2.1. Controllerの作成</a></li>
<li><a class="reference internal" href="#id22">11.2.5.2.2. Show all TODOの実装</a><ul>
<li><a class="reference internal" href="#form">11.2.5.2.2.1. Formの作成</a></li>
<li><a class="reference internal" href="#id23">11.2.5.2.2.2. Controllerの実装</a></li>
<li><a class="reference internal" href="#html">11.2.5.2.2.3. テンプレートHTMLの実装</a></li>
</ul>
</li>
<li><a class="reference internal" href="#createtodoimplementation-thymeleaf">11.2.5.2.3. Create TODOの実装</a><ul>
<li><a class="reference internal" href="#id25">11.2.5.2.3.1. マッパーインタフェースの作成</a></li>
<li><a class="reference internal" href="#id26">11.2.5.2.3.2. Controllerの修正</a></li>
<li><a class="reference internal" href="#id27">11.2.5.2.3.3. Formの修正</a></li>
<li><a class="reference internal" href="#id28">11.2.5.2.3.4. テンプレートHTMLの修正</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id29">11.2.5.2.4. Finish TODOの実装</a><ul>
<li><a class="reference internal" href="#id30">11.2.5.2.4.1. Formの修正</a></li>
<li><a class="reference internal" href="#id31">11.2.5.2.4.2. Controllerの修正</a></li>
<li><a class="reference internal" href="#id32">11.2.5.2.4.3. テンプレートHTMLの修正</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id33">11.2.5.2.5. Delete TODOの実装</a><ul>
<li><a class="reference internal" href="#id34">11.2.5.2.5.1. Formの修正</a></li>
<li><a class="reference internal" href="#id35">11.2.5.2.5.2. Controllerの修正</a></li>
<li><a class="reference internal" href="#id36">11.2.5.2.5.3. テンプレートHTMLの修正</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#tutorial-todo-infra-thymeleaf">11.2.6. データベースアクセスを伴うインフラストラクチャ層の作成</a><ul>
<li><a class="reference internal" href="#tutorialcreateormapperblankproject-thymeleaf">11.2.6.1. O/R Mapperに依存したブランクプロジェクトの作成</a></li>
<li><a class="reference internal" href="#tutorial-setup-database-thymeleaf">11.2.6.2. データベースのセットアップ</a><ul>
<li><a class="reference internal" href="#todo-infra-properties">11.2.6.2.1. todo-infra.propertiesの修正</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-mybatis3-thymeleaf">11.2.6.3. MyBatis3を使用したインフラストラクチャ層の作成</a><ul>
<li><a class="reference internal" href="#todorepository">11.2.6.3.1. TodoRepositoryの作成</a></li>
<li><a class="reference internal" href="#todorepositoryimpl">11.2.6.3.2. TodoRepositoryImplの作成</a></li>
<li><a class="reference internal" href="#mapper">11.2.6.3.3. Mapperファイルの作成</a></li>
</ul>
</li>
<li><a class="reference internal" href="#spring-data-jpa">11.2.6.4. Spring Data JPAを使用したインフラストラクチャ層の作成</a><ul>
<li><a class="reference internal" href="#entity">11.2.6.4.1. Entityの修正</a></li>
<li><a class="reference internal" href="#id42">11.2.6.4.2. TodoRepositoryの作成</a></li>
<li><a class="reference internal" href="#id43">11.2.6.4.3. TodoRepositoryImplの作成</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id44">11.2.7. おわりに</a></li>
<li><a class="reference internal" href="#appendix">11.2.8. Appendix</a><ul>
<li><a class="reference internal" href="#tutorialtodoappendixexpoundconfigurations-thymeleaf">11.2.8.1. 設定ファイルの解説</a><ul>
<li><a class="reference internal" href="#web-xml">11.2.8.1.1. web.xml</a></li>
<li><a class="reference internal" href="#bean">11.2.8.1.2. Bean定義ファイル</a><ul>
<li><a class="reference internal" href="#applicationcontext">11.2.8.1.2.1. applicationContext</a></li>
<li><a class="reference internal" href="#todo-domain">11.2.8.1.2.2. todo-domain</a></li>
<li><a class="reference internal" href="#todo-infra">11.2.8.1.2.3. todo-infra</a><ul>
<li><a class="reference internal" href="#o-r-mappertodo-infra">11.2.8.1.2.3.1. O/R Mapperに依存しないブランクプロジェクトを作成した場合のtodo-infra</a></li>
<li><a class="reference internal" href="#mybatis3todo-infra">11.2.8.1.2.3.2. MyBatis3用のブランクプロジェクトを作成した場合のtodo-infra</a></li>
<li><a class="reference internal" href="#jpatodo-infra">11.2.8.1.2.3.3. JPA用のブランクプロジェクトを作成した場合のtodo-infra</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id46">11.2.8.1.2.4. todo-infra.properties</a></li>
<li><a class="reference internal" href="#todo-env">11.2.8.1.2.5. todo-env</a></li>
<li><a class="reference internal" href="#spring-mvc">11.2.8.1.2.6. spring-mvc</a></li>
<li><a class="reference internal" href="#spring-security">11.2.8.1.2.7. spring-security</a></li>
</ul>
</li>
<li><a class="reference internal" href="#logback-xml">11.2.8.1.3. logback.xml</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="TutorialTodo.html"
                          title="previous chapter"><span class="section-number">11.1. </span>チュートリアル(Todoアプリケーション JSP編)</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="TutorialREST.html"
                          title="next chapter"><span class="section-number">11.3. </span>チュートリアル(Todoアプリケーション REST編)</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/Tutorial/TutorialTodoThymeleaf.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="todo-thymeleaf">
<h1><span class="section-number">11.2. </span>チュートリアル(Todoアプリケーション Thymeleaf編)<a class="headerlink" href="#todo-thymeleaf" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="id1">
<p class="topic-title">目次</p>
<ul class="simple">
<li><p><a class="reference internal" href="#id2" id="id48">はじめに</a></p>
<ul>
<li><p><a class="reference internal" href="#id3" id="id49">このチュートリアルで学ぶこと</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id50">対象読者</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id51">検証環境</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id6" id="id52">作成するアプリケーションの説明</a></p>
<ul>
<li><p><a class="reference internal" href="#tutorial-todo-application-overview-label-thymeleaf" id="id53">アプリケーションの概要</a></p></li>
<li><p><a class="reference internal" href="#app-requirement-thymeleaf" id="id54">アプリケーションの業務要件</a></p></li>
<li><p><a class="reference internal" href="#id9" id="id55">アプリケーションの処理仕様</a></p>
<ul>
<li><p><a class="reference internal" href="#show-all-todo" id="id56">Show all TODO</a></p></li>
<li><p><a class="reference internal" href="#create-todo" id="id57">Create TODO</a></p></li>
<li><p><a class="reference internal" href="#finish-todo" id="id58">Finish TODO</a></p></li>
<li><p><a class="reference internal" href="#delete-todo" id="id59">Delete TODO</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id10" id="id60">エラーメッセージ一覧</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id11" id="id61">環境構築</a></p>
<ul>
<li><p><a class="reference internal" href="#id12" id="id62">プロジェクトの作成</a></p>
<ul>
<li><p><a class="reference internal" href="#o-r-mapper" id="id63">O/R Mapperに依存しないブランクプロジェクトの作成</a></p></li>
<li><p><a class="reference internal" href="#mybatis3" id="id64">MyBatis3用のブランクプロジェクトの作成</a></p></li>
<li><p><a class="reference internal" href="#jpa" id="id65">JPA用のブランクプロジェクトの作成</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id13" id="id66">プロジェクトのインポート</a></p></li>
<li><p><a class="reference internal" href="#id14" id="id67">プロジェクトの構成</a></p></li>
<li><p><a class="reference internal" href="#id15" id="id68">設定ファイルの確認</a></p></li>
<li><p><a class="reference internal" href="#id16" id="id69">プロジェクトの動作確認</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#todo" id="id70">Todoアプリケーションのプロトタイプ作成</a></p>
<ul>
<li><p><a class="reference internal" href="#id17" id="id71">プロトタイプ作成</a></p></li>
<li><p><a class="reference internal" href="#id18" id="id72">画面の静的表示の確認</a></p></li>
<li><p><a class="reference internal" href="#css" id="id73">CSSファイルの使用</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id19" id="id74">Todoアプリケーションの作成</a></p>
<ul>
<li><p><a class="reference internal" href="#id20" id="id75">ドメイン層の作成</a></p>
<ul>
<li><p><a class="reference internal" href="#domain-object" id="id76">Domain Objectの作成</a></p></li>
<li><p><a class="reference internal" href="#repository" id="id77">Repositoryの作成</a></p></li>
<li><p><a class="reference internal" href="#repositoryimpl" id="id78">RepositoryImplの作成(インフラストラクチャ層)</a></p></li>
<li><p><a class="reference internal" href="#service" id="id79">Serviceの作成</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id21" id="id80">アプリケーション層の作成</a></p>
<ul>
<li><p><a class="reference internal" href="#controller" id="id81">Controllerの作成</a></p></li>
<li><p><a class="reference internal" href="#id22" id="id82">Show all TODOの実装</a></p></li>
<li><p><a class="reference internal" href="#createtodoimplementation-thymeleaf" id="id83">Create TODOの実装</a></p></li>
<li><p><a class="reference internal" href="#id29" id="id84">Finish TODOの実装</a></p></li>
<li><p><a class="reference internal" href="#id33" id="id85">Delete TODOの実装</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#tutorial-todo-infra-thymeleaf" id="id86">データベースアクセスを伴うインフラストラクチャ層の作成</a></p>
<ul>
<li><p><a class="reference internal" href="#tutorialcreateormapperblankproject-thymeleaf" id="id87">O/R Mapperに依存したブランクプロジェクトの作成</a></p></li>
<li><p><a class="reference internal" href="#tutorial-setup-database-thymeleaf" id="id88">データベースのセットアップ</a></p>
<ul>
<li><p><a class="reference internal" href="#todo-infra-properties" id="id89">todo-infra.propertiesの修正</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-mybatis3-thymeleaf" id="id90">MyBatis3を使用したインフラストラクチャ層の作成</a></p>
<ul>
<li><p><a class="reference internal" href="#todorepository" id="id91">TodoRepositoryの作成</a></p></li>
<li><p><a class="reference internal" href="#todorepositoryimpl" id="id92">TodoRepositoryImplの作成</a></p></li>
<li><p><a class="reference internal" href="#mapper" id="id93">Mapperファイルの作成</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#spring-data-jpa" id="id94">Spring Data JPAを使用したインフラストラクチャ層の作成</a></p>
<ul>
<li><p><a class="reference internal" href="#entity" id="id95">Entityの修正</a></p></li>
<li><p><a class="reference internal" href="#id42" id="id96">TodoRepositoryの作成</a></p></li>
<li><p><a class="reference internal" href="#id43" id="id97">TodoRepositoryImplの作成</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#id44" id="id98">おわりに</a></p></li>
<li><p><a class="reference internal" href="#appendix" id="id99">Appendix</a></p>
<ul>
<li><p><a class="reference internal" href="#tutorialtodoappendixexpoundconfigurations-thymeleaf" id="id100">設定ファイルの解説</a></p>
<ul>
<li><p><a class="reference internal" href="#web-xml" id="id101">web.xml</a></p></li>
<li><p><a class="reference internal" href="#bean" id="id102">Bean定義ファイル</a></p></li>
<li><p><a class="reference internal" href="#logback-xml" id="id103">logback.xml</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="id2">
<h2><a class="toc-backref" href="#id48" role="doc-backlink"><span class="section-number">11.2.1. </span>はじめに</a><a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h2>
<section id="id3">
<h3><a class="toc-backref" href="#id49" role="doc-backlink"><span class="section-number">11.2.1.1. </span>このチュートリアルで学ぶこと</a><a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>TERASOLUNA Server Framework for Java (5.x)による基本的なアプリケーションの開発方法</p></li>
<li><p>MavenおよびSTS(Eclipse)プロジェクトの構築方法</p></li>
<li><p>TERASOLUNA Server Framework for Java (5.x)の <a class="reference internal" href="../Overview/ApplicationLayering.html"><span class="doc">アプリケーションのレイヤ化</span></a> に従った開発方法</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id4">
<h3><a class="toc-backref" href="#id50" role="doc-backlink"><span class="section-number">11.2.1.2. </span>対象読者</a><a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>SpringのDIやAOPに関する基礎的な知識がある</p></li>
<li><p>Servlet/テンプレートエンジン(JSPなど)を使用してWebアプリケーションを開発したことがある</p></li>
<li><p>SQLに関する知識がある</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id5">
<h3><a class="toc-backref" href="#id51" role="doc-backlink"><span class="section-number">11.2.1.3. </span>検証環境</a><a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h3>
<p>このチュートリアルは以下の環境で動作確認している。他の環境で実施する際は本書をベースに適宜読み替えて設定していくこと。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>種別</p></th>
<th class="head"><p>名前</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>OS</p></td>
<td><p>Windows 10</p></td>
</tr>
<tr class="row-odd"><td><p>JVM</p></td>
<td><p><a class="reference external" href="https://developers.redhat.com/products/openjdk/download">Java</a> 17</p></td>
</tr>
<tr class="row-even"><td><p>IDE</p></td>
<td><p><a class="reference external" href="https://spring.io/tools">Spring Tool Suite</a> 4.17.1.RELEASE (以降「STS」と呼ぶ。設定方法は<a class="reference internal" href="../Appendix/SpringToolSuite4.html"><span class="doc">STS4の設定手順</span></a>を参照されたい。)</p></td>
</tr>
<tr class="row-odd"><td><p>Build Tool</p></td>
<td><p><a class="reference external" href="https://maven.apache.org/download.cgi">Apache Maven</a> 3.8.6 (以降「Maven」と呼ぶ)</p></td>
</tr>
<tr class="row-even"><td><p>Application Server</p></td>
<td><p><a class="reference external" href="https://tomcat.apache.org/tomcat-10.1-doc/index.html">Apache Tomcat</a> 10.1.15</p></td>
</tr>
<tr class="row-odd"><td><p>Web Browser</p></td>
<td><p><a class="reference external" href="https://www.google.co.jp/chrome/">Google Chrome</a> 117</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="id6">
<h2><a class="toc-backref" href="#id52" role="doc-backlink"><span class="section-number">11.2.2. </span>作成するアプリケーションの説明</a><a class="headerlink" href="#id6" title="Permalink to this heading">¶</a></h2>
<div class="line-block">
<div class="line">本チュートリアルでは、ViewとしてThymeleafを使用して開発するメリットを体感できるよう、最初にHTMLで画面デザインのみ実装したモックアップ（以降、プロトタイプと呼ぶ）を作成し、そこにアプリケーションの機能を追加していく。</div>
<div class="line">本ガイドラインでは、HTMLで作成したプロトタイプにThymeleafの属性を付与してテンプレート化したものを「テンプレートHTML」と呼ぶ。</div>
<div class="line"><br /></div>
</div>
<section id="tutorial-todo-application-overview-label-thymeleaf">
<span id="id7"></span><h3><a class="toc-backref" href="#id53" role="doc-backlink"><span class="section-number">11.2.2.1. </span>アプリケーションの概要</a><a class="headerlink" href="#tutorial-todo-application-overview-label-thymeleaf" title="Permalink to this heading">¶</a></h3>
<p>TODOを管理するアプリケーションを作成する。TODOの一覧表示、TODOの登録、TODOの完了、TODOの削除を行える。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/image0011.png"><img alt="../_images/image0011.png" src="../_images/image0011.png" style="width: 50%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="app-requirement-thymeleaf">
<span id="id8"></span><h3><a class="toc-backref" href="#id54" role="doc-backlink"><span class="section-number">11.2.2.2. </span>アプリケーションの業務要件</a><a class="headerlink" href="#app-requirement-thymeleaf" title="Permalink to this heading">¶</a></h3>
<p>アプリケーションの業務要件は、以下の通りとする。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 80.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ルールID</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>B01</p></td>
<td><p>未完了のTODOは5件までしか登録できない</p></td>
</tr>
<tr class="row-odd"><td><p>B02</p></td>
<td><p>完了済みのTODOは完了できない</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>本要件は学習のためのもので、現実的なTODO管理アプリケーションとしては適切ではない。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id9">
<h3><a class="toc-backref" href="#id55" role="doc-backlink"><span class="section-number">11.2.2.3. </span>アプリケーションの処理仕様</a><a class="headerlink" href="#id9" title="Permalink to this heading">¶</a></h3>
<p>アプリケーションの処理仕様と画面遷移は、以下の通りとする。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/image0021.png"><img alt="../_images/image0021.png" src="../_images/image0021.png" style="width: 60%;" /></a>
</figure>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 20.0%" />
<col style="width: 10.0%" />
<col style="width: 15.0%" />
<col style="width: 45.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>プロセス名</p></th>
<th class="head"><p>HTTPメソッド</p></th>
<th class="head"><p>URL</p></th>
<th class="head"><p>備考</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Show all TODO</p></td>
<td><p>-</p></td>
<td><p>/todo/list</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Create TODO</p></td>
<td><p>POST</p></td>
<td><p>/todo/create</p></td>
<td><p>作成処理終了後、Show all TODOへリダイレクト</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Finish TODO</p></td>
<td><p>POST</p></td>
<td><p>/todo/finish</p></td>
<td><p>完了処理終了後、Show all TODOへリダイレクト</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>Delete TODO</p></td>
<td><p>POST</p></td>
<td><p>/todo/delete</p></td>
<td><p>削除処理終了後、Show all TODOへリダイレクト</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="show-all-todo">
<h4><a class="toc-backref" href="#id56" role="doc-backlink"><span class="section-number">11.2.2.3.1. </span>Show all TODO</a><a class="headerlink" href="#show-all-todo" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>TODOを全件表示する</p></li>
<li><p>未完了のTODOに対しては「Finish」と「Delete」用のボタンが付く</p></li>
<li><p>完了のTODOは打ち消し線で装飾する</p></li>
<li><p>TODOの件名のみ表示する</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="create-todo">
<h4><a class="toc-backref" href="#id57" role="doc-backlink"><span class="section-number">11.2.2.3.2. </span>Create TODO</a><a class="headerlink" href="#create-todo" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>フォームから送信されたTODOを保存する</p></li>
<li><p>TODOの件名は1文字以上30文字以下であること</p></li>
<li><p><a class="reference internal" href="#app-requirement-thymeleaf"><span class="std std-ref">アプリケーションの業務要件</span></a>のB01を満たさない場合はエラーコードE001でビジネス例外をスローする</p></li>
<li><p>処理が成功した場合は、遷移先の画面で「Created successfully!」を表示する</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="finish-todo">
<h4><a class="toc-backref" href="#id58" role="doc-backlink"><span class="section-number">11.2.2.3.3. </span>Finish TODO</a><a class="headerlink" href="#finish-todo" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>フォームから送信された<code class="docutils literal notranslate"><span class="pre">todoId</span></code>に対応するTODOを完了済みにする</p></li>
<li><p>該当するTODOが存在しない場合はエラーコードE404でリソース未検出例外をスローする</p></li>
<li><p><a class="reference internal" href="#app-requirement-thymeleaf"><span class="std std-ref">アプリケーションの業務要件</span></a>のB02を満たさない場合はエラーコードE002でビジネス例外をスローする</p></li>
<li><p>処理が成功した場合は、遷移先の画面で「Finished successfully!」を表示する</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="delete-todo">
<h4><a class="toc-backref" href="#id59" role="doc-backlink"><span class="section-number">11.2.2.3.4. </span>Delete TODO</a><a class="headerlink" href="#delete-todo" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>フォームから送信された<code class="docutils literal notranslate"><span class="pre">todoId</span></code>に対応するTODOを削除する</p></li>
<li><p>該当するTODOが存在しない場合はエラーコードE404でリソース未検出例外をスローする</p></li>
<li><p>処理が成功した場合は、遷移先の画面で「Deleted successfully!」を表示する</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="id10">
<h3><a class="toc-backref" href="#id60" role="doc-backlink"><span class="section-number">11.2.2.4. </span>エラーメッセージ一覧</a><a class="headerlink" href="#id10" title="Permalink to this heading">¶</a></h3>
<p>エラーメッセージとして、以下の3つを定義する。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 15.0%" />
<col style="width: 50.0%" />
<col style="width: 35.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>エラーコード</p></th>
<th class="head"><p>メッセージ</p></th>
<th class="head"><p>置換パラメータ</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>E001</p></td>
<td><p>[E001] The count of un-finished Todo must not be over {0}.</p></td>
<td><p>{0}… max unfinished count</p></td>
</tr>
<tr class="row-odd"><td><p>E002</p></td>
<td><p>[E002] The requested Todo is already finished. (id={0})</p></td>
<td><p>{0}… todoId</p></td>
</tr>
<tr class="row-even"><td><p>E404</p></td>
<td><p>[E404] The requested Todo is not found. (id={0})</p></td>
<td><p>{0}… todoId</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="id11">
<h2><a class="toc-backref" href="#id61" role="doc-backlink"><span class="section-number">11.2.3. </span>環境構築</a><a class="headerlink" href="#id11" title="Permalink to this heading">¶</a></h2>
<p>本チュートリアルでは、インフラストラクチャ層のRepositoryImplの実装として、</p>
<ul class="simple">
<li><p>データベースを使用せず<code class="docutils literal notranslate"><span class="pre">java.util.Map</span></code>を使ったインメモリ実装のRepositoryImpl</p></li>
<li><p>MyBatis3を使用してデータベースにアクセスするRepositoryImpl</p></li>
<li><p>Spring Data JPAを使用してデータベースにアクセスするRepositoryImpl</p></li>
</ul>
<p>の3種類を用意している。用途に応じていずれかを選択する。</p>
<p>チュートリアルの進行上、まずはインメモリ実装を試し、その後MyBatis3またはSpring Data JPAを選ぶのが円滑である。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="id12">
<h3><a class="toc-backref" href="#id62" role="doc-backlink"><span class="section-number">11.2.3.1. </span>プロジェクトの作成</a><a class="headerlink" href="#id12" title="Permalink to this heading">¶</a></h3>
<p>まず、<code class="docutils literal notranslate"><span class="pre">mvn</span> <span class="pre">archetype:generate</span></code>を利用して、実装するインフラストラクチャ層向けのブランクプロジェクトを作成する。
ここでは、Windowsのコマンドプロンプトを使用してブランクプロジェクトを作成する手順となっている。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>インターネット接続するために、プロキシサーバーを介する必要がある場合、以下の作業を行うため、STSのProxy設定と、<a class="reference external" href="https://maven.apache.org/guides/mini/guide-proxies.html">MavenのProxy設定</a>が必要である。</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Bash上で<code class="docutils literal notranslate"><span class="pre">mvn</span> <span class="pre">archetype:generate</span></code>を実行する場合は、以下のように”<code class="docutils literal notranslate"><span class="pre">^</span></code>“を”<code class="docutils literal notranslate"><span class="pre">\</span></code>“に置き換えて実行すればよい。</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mvn<span class="w"> </span>archetype:generate<span class="w"> </span>-B<span class="se">\</span>
<span class="w"> </span>-DarchetypeGroupId<span class="o">=</span>org.terasoluna.gfw.blank<span class="se">\</span>
<span class="w"> </span>-DarchetypeArtifactId<span class="o">=</span>terasoluna-gfw-web-blank-thymeleaf-archetype<span class="se">\</span>
<span class="w"> </span>-DarchetypeVersion<span class="o">=</span><span class="m">5</span>.9.0.RELEASE<span class="se">\</span>
<span class="w"> </span>-DgroupId<span class="o">=</span>com.example.todo<span class="se">\</span>
<span class="w"> </span>-DartifactId<span class="o">=</span>todo<span class="se">\</span>
<span class="w"> </span>-Dversion<span class="o">=</span><span class="m">1</span>.0.0-SNAPSHOT
</pre></div>
</div>
</div></blockquote>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="o-r-mapper">
<span id="tutorialcreateplainblankproject-thymeleaf"></span><h4><a class="toc-backref" href="#id63" role="doc-backlink"><span class="section-number">11.2.3.1.1. </span>O/R Mapperに依存しないブランクプロジェクトの作成</a><a class="headerlink" href="#o-r-mapper" title="Permalink to this heading">¶</a></h4>
<p>データベースを使用せず<code class="docutils literal notranslate"><span class="pre">java.util.Map</span></code>を使ったインメモリ実装のRepositoryImpl用のプロジェクトを作成する場合は、以下のコマンドを実行してO/R Mapperに依存しないブランクプロジェクトを作成する。<strong>本チュートリアルを順序通り読み進める場合は、まずはこの方法でプロジェクトを作成すること</strong>。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-0-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-0-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-0-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-0-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mvn archetype:generate -B^</span>
<span class="go"> -DarchetypeGroupId=org.terasoluna.gfw.blank^</span>
<span class="go"> -DarchetypeArtifactId=terasoluna-gfw-web-blank-thymeleaf-archetype^</span>
<span class="go"> -DarchetypeVersion=5.9.0.RELEASE^</span>
<span class="go"> -DgroupId=com.example.todo^</span>
<span class="go"> -DartifactId=todo^</span>
<span class="go"> -Dversion=1.0.0-SNAPSHOT</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mvn archetype:generate -B^</span>
<span class="go"> -DarchetypeGroupId=org.terasoluna.gfw.blank^</span>
<span class="go"> -DarchetypeArtifactId=terasoluna-gfw-web-blank-xmlconfig-thymeleaf-archetype^</span>
<span class="go"> -DarchetypeVersion=5.9.0.RELEASE^</span>
<span class="go"> -DgroupId=com.example.todo^</span>
<span class="go"> -DartifactId=todo^</span>
<span class="go"> -Dversion=1.0.0-SNAPSHOT</span>
</pre></div>
</div>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="mybatis3">
<span id="tutorialcreatemybatis3blankproject-thymeleaf"></span><h4><a class="toc-backref" href="#id64" role="doc-backlink"><span class="section-number">11.2.3.1.2. </span>MyBatis3用のブランクプロジェクトの作成</a><a class="headerlink" href="#mybatis3" title="Permalink to this heading">¶</a></h4>
<p>MyBatis3を使用してデータベースにアクセスするRepositoryImpl用のプロジェクトを作成する場合は、
以下のコマンドを実行してMyBatis3用のブランクプロジェクトを作成する。このプロジェクト作成方法は<a class="reference internal" href="#using-mybatis3-thymeleaf"><span class="std std-ref">MyBatis3を使用したインフラストラクチャ層の作成</span></a>で使用する。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-1-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-1-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-1-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-1-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mvn archetype:generate -B^</span>
<span class="go"> -DarchetypeGroupId=org.terasoluna.gfw.blank^</span>
<span class="go"> -DarchetypeArtifactId=terasoluna-gfw-web-blank-thymeleaf-mybatis3-archetype^</span>
<span class="go"> -DarchetypeVersion=5.9.0.RELEASE^</span>
<span class="go"> -DgroupId=com.example.todo^</span>
<span class="go"> -DartifactId=todo^</span>
<span class="go"> -Dversion=1.0.0-SNAPSHOT</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mvn archetype:generate -B^</span>
<span class="go"> -DarchetypeGroupId=org.terasoluna.gfw.blank^</span>
<span class="go"> -DarchetypeArtifactId=terasoluna-gfw-web-blank-xmlconfig-thymeleaf-mybatis3-archetype^</span>
<span class="go"> -DarchetypeVersion=5.9.0.RELEASE^</span>
<span class="go"> -DgroupId=com.example.todo^</span>
<span class="go"> -DartifactId=todo^</span>
<span class="go"> -Dversion=1.0.0-SNAPSHOT</span>
</pre></div>
</div>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="jpa">
<span id="tutorialcreatejpablankproject-thymeleaf"></span><h4><a class="toc-backref" href="#id65" role="doc-backlink"><span class="section-number">11.2.3.1.3. </span>JPA用のブランクプロジェクトの作成</a><a class="headerlink" href="#jpa" title="Permalink to this heading">¶</a></h4>
<p>Spring Data JPAを使用してデータベースへアクセスするRepositoryImpl用のプロジェクトを作成する場合は、以下のコマンドを実行してJPA用のブランクプロジェクトを作成する。このプロジェクト作成方法は<a class="reference internal" href="#using-springdatajpa-thymeleaf"><span class="std std-ref">Spring Data JPAを使用したインフラストラクチャ層の作成</span></a>で使用する。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-2-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-2-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-2-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-2-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-2-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mvn archetype:generate -B^</span>
<span class="go"> -DarchetypeGroupId=org.terasoluna.gfw.blank^</span>
<span class="go"> -DarchetypeArtifactId=terasoluna-gfw-web-blank-thymeleaf-jpa-archetype^</span>
<span class="go"> -DarchetypeVersion=5.9.0.RELEASE^</span>
<span class="go"> -DgroupId=com.example.todo^</span>
<span class="go"> -DartifactId=todo^</span>
<span class="go"> -Dversion=1.0.0-SNAPSHOT</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-2-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mvn archetype:generate -B^</span>
<span class="go"> -DarchetypeGroupId=org.terasoluna.gfw.blank^</span>
<span class="go"> -DarchetypeArtifactId=terasoluna-gfw-web-blank-xmlconfig-thymeleaf-jpa-archetype^</span>
<span class="go"> -DarchetypeVersion=5.9.0.RELEASE^</span>
<span class="go"> -DgroupId=com.example.todo^</span>
<span class="go"> -DartifactId=todo^</span>
<span class="go"> -Dversion=1.0.0-SNAPSHOT</span>
</pre></div>
</div>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="id13">
<h3><a class="toc-backref" href="#id66" role="doc-backlink"><span class="section-number">11.2.3.2. </span>プロジェクトのインポート</a><a class="headerlink" href="#id13" title="Permalink to this heading">¶</a></h3>
<p>作成したブランクプロジェクトをSTSへインポートする。</p>
<p>STSのメニューから、[File] -&gt; [Import] -&gt; [Maven] -&gt; [Existing Maven Projects] -&gt; [Next]を選択し、archetypeで作成したプロジェクトを選択する。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/NewMVCProjectImport2.png"><img alt="New MVC Project Import" src="../_images/NewMVCProjectImport2.png" style="width: 60%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Root Directoryに<code class="docutils literal notranslate"><span class="pre">C:\work\todo</span></code>を設定し、Projectsにtodoのpom.xmlが選択された状態で、 [Finish] を押下する。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/NewMVCProjectCreate2.png"><img alt="New MVC Project Import" src="../_images/NewMVCProjectCreate2.png" style="width: 60%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>インポートが完了すると、Package Explorerに次のようなプロジェクトが表示される。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-3-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-3-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-3-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-3-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-3-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-3-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><figure class="align-default">
<img alt="workspace" src="../_images/image004_JavaConfig1.png" />
</figure>
</div><div aria-labelledby="tab-3-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-3-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><figure class="align-default">
<img alt="workspace" src="../_images/image004_XMLConfig1.png" />
</figure>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>インポート後にビルドエラーが発生する場合は、プロジェクト名を右クリックし、「Maven」-&gt;「Update Project…」をクリックし、「OK」ボタンをクリックすることでエラーが解消されるケースがある。</p>
<blockquote>
<div><figure class="align-default">
<a class="reference internal image-reference" href="../_images/update-project1.png"><img alt="../_images/update-project1.png" src="../_images/update-project1.png" style="width: 70%;" /></a>
</figure>
</div></blockquote>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ビルド時にJSPファイルで以下のエラーが発生する場合がある。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">The superclass &quot;javax.servlet.http.HttpServlet&quot;, determined from the Dynamic Web Module facet version (2.5), was not found on the Java Build Path</span>
</pre></div>
</div>
<p>この場合は、プロジェクト名を右クリックし、「Properties」を選択しプロパティ画面を開く。</p>
<p>「Project Facets」の「Dynamic Web Module」を5.0へ変更することで解決する。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/change-DynamicWebModule1.png"><img alt="../_images/change-DynamicWebModule1.png" src="../_images/change-DynamicWebModule1.png" style="width: 70%;" /></a>
</figure>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>パッケージの表示形式は、デフォルトは「Flat」だが、「Hierarchical」にしたほうが見通しがよい。</p>
<p>Package Explorerの「View Menu」 (右端の下矢印)をクリックし、「Package Presentation」-&gt;「Hierarchical」を選択する。</p>
<blockquote>
<div><figure class="align-default">
<a class="reference internal image-reference" href="../_images/presentation-hierarchical1.png"><img alt="../_images/presentation-hierarchical1.png" src="../_images/presentation-hierarchical1.png" style="width: 80%;" /></a>
</figure>
</div></blockquote>
<p>Package PresentationをHierarchicalにすると、以下の様な表示になる。</p>
<blockquote>
<div><figure class="align-default">
<img alt="../_images/presentation-hierarchical-view1.png" src="../_images/presentation-hierarchical-view1.png" />
</figure>
</div></blockquote>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>O/R Mapperを使用するブランクプロジェクトの場合、H2 Databaseがdependencyとして定義されているが、この設定は簡易的なアプリケーションを簡単に作成するためのものであり、実際のアプリケーション開発で使用されることは想定していない。</p>
<p>以下の定義は、実際のアプリケーション開発を行う際は削除すること。</p>
<blockquote>
<div><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>com.h2database<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>h2<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>上記設定例は、依存ライブラリのバージョンを親プロジェクトである terasoluna-gfw-parent で管理する前提であるため、pom.xmlでのバージョンの指定は不要である。</p>
<p>上記の依存ライブラリはterasoluna-gfw-parentが依存している<a class="reference external" href="https://docs.spring.io/spring-boot/docs/3.2.2/reference/htmlsingle/#dependency-versions">Spring Boot</a>で管理されている。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id14">
<h3><a class="toc-backref" href="#id67" role="doc-backlink"><span class="section-number">11.2.3.3. </span>プロジェクトの構成</a><a class="headerlink" href="#id14" title="Permalink to this heading">¶</a></h3>
<p>本チュートリアルで作成するプロジェクトの構成を以下に示す。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="../Overview/ApplicationLayering.html#application-layering-project-structure"><span class="std std-ref">前節の「プロジェクト構成」</span></a>ではマルチプロジェクトにすることを推奨していたが、本チュートリアルでは、学習容易性を重視しているためシングルプロジェクト構成にしている。</p>
<p><strong>ただし、実プロジェクトで適用する場合は、マルチプロジェクト構成を強く推奨する。</strong></p>
<p>マルチプロジェクトの作成方法は、「<a class="reference internal" href="../ImplementationAtEachLayer/CreateWebApplicationProject.html"><span class="doc">Webアプリケーション向け開発プロジェクトの作成</span></a>」を参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>[O/R Mapperに依存しないブランクプロジェクト、JPA用のブランクプロジェクト用を作成した場合の構成]</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-4-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-4-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-4-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-4-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-4-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-4-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">src</span>
<span class="go">  └main</span>
<span class="go">      ├java</span>
<span class="go">      │  └com</span>
<span class="go">      │    └example</span>
<span class="go">      │      └todo</span>
<span class="go">      │        ├ app ... (1)</span>
<span class="go">      │        │   ├common</span>
<span class="go">      │        │   │  └error</span>
<span class="go">      │        │   ├todo</span>
<span class="go">      │        │   └welcome</span>
<span class="go">      │        ├domain ... (2)</span>
<span class="go">      │        │  ├model ... (3)</span>
<span class="go">      │        │  ├repository ... (4)</span>
<span class="go">      │        │  │   └todo</span>
<span class="go">      │        │  └service ... (5)</span>
<span class="go">      │        │      └todo</span>
<span class="go">      │        └ config ... (6)</span>
<span class="go">      │            ├app</span>
<span class="go">      │            └web</span>
<span class="go">      ├resources</span>
<span class="go">      │  └META-INF</span>
<span class="go">      │      └spring ... (6)</span>
<span class="go">      └webapp</span>
<span class="go">          ├resources</span>
<span class="go">          │  └app</span>
<span class="go">          │    └css ... (7)</span>
<span class="go">          └WEB-INF</span>
<span class="go">              └views ... (8)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-4-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-4-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">src</span>
<span class="go">  └main</span>
<span class="go">      ├java</span>
<span class="go">      │  └com</span>
<span class="go">      │    └example</span>
<span class="go">      │      └todo</span>
<span class="go">      │        ├ app ... (1)</span>
<span class="go">      │        │   ├common</span>
<span class="go">      │        │   │  └error</span>
<span class="go">      │        │   ├todo</span>
<span class="go">      │        │   └welcome</span>
<span class="go">      │        └domain ... (2)</span>
<span class="go">      │            ├model ... (3)</span>
<span class="go">      │            ├repository ... (4)</span>
<span class="go">      │            │   └todo</span>
<span class="go">      │            └service ... (5)</span>
<span class="go">      │                └todo</span>
<span class="go">      ├resources</span>
<span class="go">      │  └META-INF</span>
<span class="go">      │      └spring ... (6)</span>
<span class="go">      └webapp</span>
<span class="go">          ├resources</span>
<span class="go">          │  └app</span>
<span class="go">          │    └css ... (7)</span>
<span class="go">          └WEB-INF</span>
<span class="go">              └views ... (8)</span>
</pre></div>
</div>
</div></div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>アプリケーション層のクラスを格納するパッケージ。</p>
<p>本チュートリアルでは、Todo管理業務用のクラスを格納するためのパッケージを作成する。</p>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>ドメイン層のクラスを格納するパッケージ。</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p>Domain Objectを格納するパッケージ。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><p>Repositoryを格納するパッケージ。</p>
<p>本チュートリアルでは、Todoオブジェクト(Domain Object)用のRepositoryを格納するためのパッケージを作成する</p>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><p>Serviceを格納するパッケージ。</p>
<p>本チュートリアルでは、Todo管理業務用のServiceを格納するためのパッケージを作成する。</p>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><p>Spring関連の設定ファイルを格納するディレクトリ。</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(7)</div>
</div>
</td>
<td><p>cssファイルを格納するディレクトリ。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(8)</div>
</div>
</td>
<td><p>ThymeleafのテンプレートHTMLを格納するディレクトリ。</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>[MyBatis3用のブランクプロジェクトを作成した場合の構成]</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-5-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-5-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-5-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-5-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-5-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-5-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">src</span>
<span class="go">  └main</span>
<span class="go">      ├java</span>
<span class="go">      │  └com</span>
<span class="go">      │    └example</span>
<span class="go">      │      └todo</span>
<span class="go">      │        ├ app</span>
<span class="go">      │        │   ├common</span>
<span class="go">      │        │   │  └error</span>
<span class="go">      │        │   ├todo</span>
<span class="go">      │        │   └welcome</span>
<span class="go">      │        ├domain</span>
<span class="go">      │        │  ├model</span>
<span class="go">      │        │  ├repository</span>
<span class="go">      │        │  │   └todo</span>
<span class="go">      │        │  └service</span>
<span class="go">      │        │      └todo</span>
<span class="go">      │        └ config</span>
<span class="go">      │            ├app</span>
<span class="go">      │            │ └mybatis ... (9)</span>
<span class="go">      │            └web</span>
<span class="go">      ├resources</span>
<span class="go">      │  ├META-INF</span>
<span class="go">      │  │  └spring</span>
<span class="go">      │  └com</span>
<span class="go">      │    └example</span>
<span class="go">      │      └todo</span>
<span class="go">      │        └domain</span>
<span class="go">      │            └repository ... (10)</span>
<span class="go">      │                 └todo</span>
<span class="go">      └webapp</span>
<span class="go">          ├resources</span>
<span class="go">          │  └app</span>
<span class="go">          │    └css</span>
<span class="go">          └WEB-INF</span>
<span class="go">              └views</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-5-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-5-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">src</span>
<span class="go">  └main</span>
<span class="go">      ├java</span>
<span class="go">      │  └com</span>
<span class="go">      │    └example</span>
<span class="go">      │      └todo</span>
<span class="go">      │        ├ app</span>
<span class="go">      │        │   ├common</span>
<span class="go">      │        │   │  └error</span>
<span class="go">      │        │   ├todo</span>
<span class="go">      │        │   └welcome</span>
<span class="go">      │        └domain</span>
<span class="go">      │            ├model</span>
<span class="go">      │            ├repository</span>
<span class="go">      │            │   └todo</span>
<span class="go">      │            └service</span>
<span class="go">      │                └todo</span>
<span class="go">      ├resources</span>
<span class="go">      │  ├META-INF</span>
<span class="go">      │  │  ├mybatis ... (9)</span>
<span class="go">      │  │  └spring</span>
<span class="go">      │  └com</span>
<span class="go">      │    └example</span>
<span class="go">      │      └todo</span>
<span class="go">      │        └domain</span>
<span class="go">      │            └repository ... (10)</span>
<span class="go">      │                 └todo</span>
<span class="go">      └webapp</span>
<span class="go">          ├resources</span>
<span class="go">          │  └app</span>
<span class="go">          │    └css</span>
<span class="go">          └WEB-INF</span>
<span class="go">              └views</span>
</pre></div>
</div>
</div></div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(9)</div>
</div>
</td>
<td><p>MyBatis関連の設定ファイルを格納するディレクトリ。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(10)</div>
</div>
</td>
<td><p>SQLを記述するMyBatisのMapperファイルを格納するディレクトリ。</p>
<p>本チュートリアルでは、Todoオブジェクト用のRepositoryのMapperファイルを格納するためのディレクトリを作成する。</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id15">
<h3><a class="toc-backref" href="#id68" role="doc-backlink"><span class="section-number">11.2.3.4. </span>設定ファイルの確認</a><a class="headerlink" href="#id15" title="Permalink to this heading">¶</a></h3>
<p>チュートリアルを進める上で必要となる設定の多くは、作成したブランクプロジェクトに既に設定済みの状態である。</p>
<p>チュートリアルを実施するだけであれば、これらの設定の理解は必須ではないが、アプリケーションを動かすためにどのような設定が必要なのかを理解しておくことを推奨する。</p>
<p>アプリケーションを動かすために必要な設定(設定ファイル)の解説については、「<a class="reference internal" href="#tutorialtodoappendixexpoundconfigurations-thymeleaf"><span class="std std-ref">設定ファイルの解説</span></a>」を参照されたい。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>まず、手を動かしてTodoアプリケーションを作成したい場合は、設定ファイルの確認は読み飛ばしてもよいが、Todoアプリケーションを作成した後に一読して頂きたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id16">
<h3><a class="toc-backref" href="#id69" role="doc-backlink"><span class="section-number">11.2.3.5. </span>プロジェクトの動作確認</a><a class="headerlink" href="#id16" title="Permalink to this heading">¶</a></h3>
<p>Todoアプリケーションの開発を始める前に、プロジェクトの動作確認を行う。</p>
<p>ブランクプロジェクトでは、トップページを表示するためのControllerとテンプレートHTMLの実装が用意されているため、トップページを表示する事で動作確認を行う事ができる。</p>
<p>ブランクプロジェクトから提供されているController(<code class="file docutils literal notranslate"><span class="pre">src/main/java/com/example/todo/app/welcome/HelloController.java</span></code>)は、以下のような実装となっている。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.app.welcome</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.text.DateFormat</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Date</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Locale</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.slf4j.Logger</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.slf4j.LoggerFactory</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Handles requests for the application home page.</span>
<span class="cm"> */</span>
<span class="c1">// (1)</span>
<span class="nd">@Controller</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">HelloController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span>
<span class="w">            </span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">HelloController</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Simply selects the home view to render by returning its name.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// (3)</span>
<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">home</span><span class="p">(</span><span class="n">Locale</span><span class="w"> </span><span class="n">locale</span><span class="p">,</span><span class="w"> </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// (4)</span>
<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Welcome home! The client locale is {}.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">locale</span><span class="p">);</span>

<span class="w">        </span><span class="n">Date</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Date</span><span class="p">();</span>
<span class="w">        </span><span class="n">DateFormat</span><span class="w"> </span><span class="n">dateFormat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DateFormat</span><span class="p">.</span><span class="na">getDateTimeInstance</span><span class="p">(</span><span class="n">DateFormat</span><span class="p">.</span><span class="na">LONG</span><span class="p">,</span>
<span class="w">                </span><span class="n">DateFormat</span><span class="p">.</span><span class="na">LONG</span><span class="p">,</span><span class="w"> </span><span class="n">locale</span><span class="p">);</span>

<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">formattedDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dateFormat</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">date</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// (5)</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;serverTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">formattedDate</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// (6)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;welcome/home&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Controllerとしてcomponent-scanの対象とするため、クラスレベルに<code class="docutils literal notranslate"><span class="pre">&#64;Controller</span></code>アノテーションが付与している。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">(4)でログ出力するためのロガーを生成している。</div>
<div class="line">ロガーの実装はlogbackのものであるが、APIはSLF4Jの<code class="docutils literal notranslate"><span class="pre">org.slf4j.Logger</span></code>を使用している。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;GetMapping</span></code>アノテーションを使用して、”<code class="docutils literal notranslate"><span class="pre">/</span></code>“ (ルート)へのアクセスに対するメソッドとしてマッピングを行っている。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">メソッドが呼ばれたことを通知するためのログをinfoレベルで出力している。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">画面に表示するための日付文字列を、<code class="docutils literal notranslate"><span class="pre">serverTime</span></code>という属性名でModelに設定している。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">view名として<code class="docutils literal notranslate"><span class="pre">welcome/home</span></code>を返す。<code class="docutils literal notranslate"><span class="pre">ViewResolver</span></code>の設定によりテンプレートHTMLとして<code class="docutils literal notranslate"><span class="pre">WEB-INF/views/welcome/home.html</span></code>を利用して生成したHTMLが返される。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>ブランクプロジェクトから提供されているテンプレートHTML(<code class="file docutils literal notranslate"><span class="pre">src/main/webapp/WEB-INF/views/welcome/home.html</span></code>)は、以下のような実装となっている。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Home<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span>
    <span class="na">href</span><span class="o">=</span><span class="s">&quot;../../../resources/app/css/styles.css&quot;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/resources/app/css/styles.css}&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;wrapper&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">&gt;</span>Hello world!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="cm">&lt;!-- (7) --&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;|The time on the server is ${serverTime}.|&quot;</span><span class="p">&gt;</span>The time on the server is 2018/01/01 00:00:00 JST.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ControllerでModelに設定した<code class="docutils literal notranslate"><span class="pre">serverTime</span></code>を表示する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:text</span></code>属性は、記述した要素のコンテンツを属性値で上書きする。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:text</span></code>属性に、変数式<code class="docutils literal notranslate"><span class="pre">${}</span></code>で変数名を指定することで、ControllerでModelに登録した変数を参照できる。</div>
<div class="line">ユーザの入力値を表示する場合は、<code class="docutils literal notranslate"><span class="pre">th:text</span></code>属性を用いて、必ずXSS対策を行うこと。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>プロジェクトを右クリックして「Run As」-&gt;「Run on Server」を選択する。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/image0311.jpg"><img alt="../_images/image0311.jpg" src="../_images/image0311.jpg" style="width: 70%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>APサーバー(Tomcat v10.1 Server at localhost)を選択し、「Next」をクリックする。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/image0321.jpg"><img alt="../_images/image0321.jpg" src="../_images/image0321.jpg" style="width: 70%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>todoが「Configured」に含まれていることを確認して「Finish」をクリックしてサーバーを起動する。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/image0331.jpg"><img alt="../_images/image0331.jpg" src="../_images/image0331.jpg" style="width: 70%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>起動すると以下のようなログが出力される。”<code class="docutils literal notranslate"><span class="pre">/</span></code>“というパスに対して<code class="docutils literal notranslate"><span class="pre">com.example.todo.app.welcome.HelloController</span></code>のhomeメソッドがマッピングされていることが分かる。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">date:2022-12-01 11:41:47      thread:main     X-Track:        level:INFO      logger:o.springframework.web.servlet.DispatcherServlet  message:Initializing Servlet &#39;appServlet&#39;</span>
<span class="go">date:2022-12-01 11:41:47      thread:main     X-Track:        level:TRACE     logger:o.s.w.s.m.m.a.RequestMappingHandlerMapping       message:</span>
<span class="go">    c.e.t.a.w.HelloController:</span>
<span class="go">    {GET [/]}: home(Locale,Model)</span>
<span class="go">date:2022-12-01 11:41:47      thread:main     X-Track:        level:DEBUG     logger:o.s.w.s.m.m.a.RequestMappingHandlerMapping       message:1 mappings in &#39;requestMappingHandlerMapping&#39;</span>
<span class="go">date:2022-12-01 11:41:48      thread:main     X-Track:        level:INFO      logger:o.springframework.web.servlet.DispatcherServlet  message:Completed initialization in 915 ms</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>ブラウザで<code class="docutils literal notranslate"><span class="pre">http://localhost:8080/todo</span></code>にアクセスすると、以下のように表示される。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/image0341.png"><img alt="../_images/image0341.png" src="../_images/image0341.png" style="width: 60%;" /></a>
</figure>
<p>コンソールを見ると、</p>
<ul class="simple">
<li><p>共通ライブラリから提供している<code class="docutils literal notranslate"><span class="pre">TraceLoggingInterceptor</span></code>のTRACEログ</p></li>
<li><p>Controllerで実装したINFOログ</p></li>
</ul>
<p>が出力されていることがわかる。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">date:2022-12-01 11:48:22      thread:http-nio-8080-exec-3     X-Track:d41df6b34f7d4002b7d1cf415e5ada95        level:TRACE     logger:o.t.gfw.web.logging.TraceLoggingInterceptor      message:[START CONTROLLER] HelloController.home(Locale,Model)</span>
<span class="go">date:2022-12-01 11:48:22      thread:http-nio-8080-exec-3     X-Track:d41df6b34f7d4002b7d1cf415e5ada95        level:INFO      logger:com.example.todo.app.welcome.HelloController     message:Welcome home! The client locale is ja.</span>
<span class="go">date:2022-12-01 11:48:22      thread:http-nio-8080-exec-3     X-Track:d41df6b34f7d4002b7d1cf415e5ada95        level:TRACE     logger:o.t.gfw.web.logging.TraceLoggingInterceptor      message:[END CONTROLLER  ] HelloController.home(Locale,Model)-&gt; view=welcome/home, model={serverTime=2022年12月1日 11:48:22 JST}</span>
<span class="go">date:2022-12-01 11:48:22      thread:http-nio-8080-exec-3     X-Track:d41df6b34f7d4002b7d1cf415e5ada95        level:TRACE     logger:o.t.gfw.web.logging.TraceLoggingInterceptor      message:[HANDLING TIME   ] HelloController.home(Locale,Model)-&gt; 38,729,900 ns</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">TraceLoggingInterceptor</span></code>はControllerの開始、終了でログを出力する。終了時には<code class="docutils literal notranslate"><span class="pre">View</span></code>と<code class="docutils literal notranslate"><span class="pre">Model</span></code>の情報および処理時間が出力される。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="todo">
<span id="create-prototype-of-tutorial-todo-label-thymeleaf"></span><h2><a class="toc-backref" href="#id70" role="doc-backlink"><span class="section-number">11.2.4. </span>Todoアプリケーションのプロトタイプ作成</a><a class="headerlink" href="#todo" title="Permalink to this heading">¶</a></h2>
<p>HTMLでTodoアプリケーションのプロトタイプを作成する。</p>
<p>本チュートリアルでは、ここで作成したプロトタイプにThymeleafの属性を付与して、Todoアプリケーションの画面を実装していく。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="id17">
<h3><a class="toc-backref" href="#id71" role="doc-backlink"><span class="section-number">11.2.4.1. </span>プロトタイプ作成</a><a class="headerlink" href="#id17" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="#tutorial-todo-application-overview-label-thymeleaf"><span class="std std-ref">アプリケーションの概要</span></a>で示した画面をプロトタイプとして作成する。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/image0011.png"><img alt="../_images/image0011.png" src="../_images/image0011.png" style="width: 40%;" /></a>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>実際のアプリケーション開発で作成するプロトタイプ</strong></p>
<p>実際のアプリケーション開発では、ユースケースごとに画面の状態が確認できるプロトタイプ（本チュートリアルの例では、「TODOを作成した状態」や「TODOを完了した状態」など）を作成するのが一般的だと思われるが、今回はThymeleafを使用したアプリケーションの作成を学ぶチュートリアルで、プロトタイプの正しい作り方を解説することは主眼ではないため、省略する。</p>
<p>また、プロトタイプをブランクプロジェクトベースで作成するかは開発プロジェクトの判断に任せるが、本チュートリアルでは、プロトタイプからアプリケーションを開発する工程を理解しやすいように、ブランクプロジェクトベースでプロトタイプを作成している。</p>
</div>
<p>Package Explorer上で右クリック -&gt; New -&gt; File を選択し、「Create New File」ダイアログを表示し、</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 33.3%" />
<col style="width: 55.6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>項目</p></th>
<th class="head"><p>入力値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Enter or select the parent folder</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">todo/src/main/webapp/WEB-INF/views/todo</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>File name</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">list.html</span></code></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>を入力して「Finish」する。</p>
<p>作成したファイルは以下のディレクトリに格納される。</p>
<figure class="align-default">
<img alt="../_images/create-list-jsp1.png" src="../_images/create-list-jsp1.png" />
</figure>
<p><a class="reference internal" href="#tutorial-todo-application-overview-label-thymeleaf"><span class="std std-ref">アプリケーションの概要</span></a>で示した画面をHTMLとして表示するために必要なプロトタイプの実装を行う。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Todo List<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">style</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>
<span class="p">.</span><span class="nc">strike</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">text-decoration</span><span class="p">:</span><span class="w"> </span><span class="kc">line-through</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">inline</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">inline-block</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Todo List<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;todoForm&quot;</span><span class="p">&gt;</span>
        <span class="cm">&lt;!-- (1) --&gt;</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/create&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Create Todo<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;todoList&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="cm">&lt;!-- (2) --&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>Send a e-mail<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/finish&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Finish<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/delete&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>Have a lunch<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/finish&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Finish<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/delete&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;strike&quot;</span><span class="p">&gt;</span>Read a book<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span><span class="cm">&lt;!-- (3) --&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/delete&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">新規作成処理用のformを表示する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">action</span></code>属性には新規作成処理を実行するためのパス(<code class="docutils literal notranslate"><span class="pre">/todo/create</span></code>)を指定する。</div>
<div class="line">新規作成処理は更新系の処理なので、<code class="docutils literal notranslate"><span class="pre">method</span></code>属性には<code class="docutils literal notranslate"><span class="pre">POST</span></code>メソッドを指定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">未完了のTODOに対しては「Finish」と「Delete」用のボタンを表示する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">action</span></code>属性には更新処理、削除処理を実行するためのパス(<code class="docutils literal notranslate"><span class="pre">/todo/finish</span></code>or <code class="docutils literal notranslate"><span class="pre">/todo/delete</span></code>)を指定する。</div>
<div class="line">更新処理、削除処理は更新系の処理なので、<code class="docutils literal notranslate"><span class="pre">method</span></code>属性には<code class="docutils literal notranslate"><span class="pre">POST</span></code>メソッドを指定する。</div>
<div class="line">なお、「Finish」と「Delete」用のボタンをインラインブロック要素（<code class="docutils literal notranslate"><span class="pre">display:</span> <span class="pre">inline-block;</span></code>）としてTODOの横に表示させている。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">完了しているTODOには、打ち消し線(<code class="docutils literal notranslate"><span class="pre">text-decoration:</span> <span class="pre">line-through;</span></code>)を装飾する。</div>
<div class="line">完了しているTODOに対しては「Delete」用のボタンのみを表示する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id18">
<h3><a class="toc-backref" href="#id72" role="doc-backlink"><span class="section-number">11.2.4.2. </span>画面の静的表示の確認</a><a class="headerlink" href="#id18" title="Permalink to this heading">¶</a></h3>
<p>作成したプロトタイプのデザインをWebブラウザで確認すると、以下のように表示される。（以降、プロトタイプやテンプレートHTMLをブラウザで直接開く事を静的表示と呼ぶ。）</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/image0011.png"><img alt="../_images/image0011.png" src="../_images/image0011.png" style="width: 40%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="css">
<h3><a class="toc-backref" href="#id73" role="doc-backlink"><span class="section-number">11.2.4.3. </span>CSSファイルの使用</a><a class="headerlink" href="#css" title="Permalink to this heading">¶</a></h3>
<p>上記例ではスタイルシートをHTMLファイルの中で直接定義していたが、実際のアプリケーションを開発する場合は、CSSファイルに定義するのが一般的である。</p>
<p>ここでは、スタイルシートをCSSファイルに定義する方法について説明する。</p>
<p>ブランクプロジェクトから提供しているCSSファイル(<code class="docutils literal notranslate"><span class="pre">src/main/webapp/resources/app/css/styles.css</span></code>)にスタイルシートの定義を追加する。 なお、ここでは、以降で使用するスタイルシートも含めて、CSSファイルに定義している。</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="c">/* ... */</span>

<span class="p">.</span><span class="nc">strike</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">text-decoration</span><span class="p">:</span><span class="w"> </span><span class="kc">line-through</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">inline</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">inline-block</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">alert</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="p">;</span>
<span class="w">    </span><span class="k">margin-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">alert-error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#c60f13</span><span class="p">;</span>
<span class="w">    </span><span class="k">border-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#970b0e</span><span class="p">;</span>
<span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">alert-success</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#5da423</span><span class="p">;</span>
<span class="w">    </span><span class="k">border-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#457a1a</span><span class="p">;</span>
<span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">text-error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#c60f13</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">alert</span><span class="w"> </span><span class="nt">ul</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="kt">px</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="w"> </span><span class="mi">15</span><span class="kt">px</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">#</span><span class="nn">todoList</span><span class="w"> </span><span class="nt">li</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">margin-top</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>プロトタイプからCSSファイルを読み込む。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Todo List<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="cm">&lt;!-- (1) --&gt;</span>
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;../../../resources/app/css/styles.css&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Todo List<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;todoForm&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/create&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Create Todo<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;todoList&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>Send a e-mail<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/finish&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Finish<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/delete&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>Have a lunch<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/finish&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Finish<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/delete&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;strike&quot;</span><span class="p">&gt;</span>Read a book<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/delete&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">HTMLからスタイルシートの定義を削除し、代わりにスタイルシートを定義したCSSファイルを読み込む。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>CSSファイルを適用すると、以下のようなレイアウトになる。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/list-screen-css1.png"><img alt="../_images/list-screen-css1.png" src="../_images/list-screen-css1.png" style="width: 40%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="id19">
<h2><a class="toc-backref" href="#id74" role="doc-backlink"><span class="section-number">11.2.5. </span>Todoアプリケーションの作成</a><a class="headerlink" href="#id19" title="Permalink to this heading">¶</a></h2>
<div class="line-block">
<div class="line">プロトタイプからTodoアプリケーションを作成する。作成する順は、以下の通りである。</div>
</div>
<ul class="simple">
<li><p>ドメイン層(+ インフラストラクチャ層)</p>
<ul>
<li><p>Domain Object作成</p></li>
<li><p>Repository作成</p></li>
<li><p>RepositoryImpl作成</p></li>
<li><p>Service作成</p></li>
</ul>
</li>
<li><p>アプリケーション層</p>
<ul>
<li><p>Controller作成</p></li>
<li><p>Form作成</p></li>
<li><p>View作成</p></li>
</ul>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>RepositoryImplの作成は、選択したインフラストラクチャ層の種類に応じて実装方法が異なる。</p>
<p>ここでは、データベースを使用せず<code class="docutils literal notranslate"><span class="pre">java.util.Map</span></code>を使ったインメモリ実装のRepositoryImplを作成する方法について説明を行う。データベースを使用する場合は、「<a class="reference internal" href="#tutorial-todo-infra-thymeleaf"><span class="std std-ref">データベースアクセスを伴うインフラストラクチャ層の作成</span></a>」に記載されている内容で読み替えて、Todoアプリケーションを作成して頂きたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="id20">
<h3><a class="toc-backref" href="#id75" role="doc-backlink"><span class="section-number">11.2.5.1. </span>ドメイン層の作成</a><a class="headerlink" href="#id20" title="Permalink to this heading">¶</a></h3>
<section id="domain-object">
<h4><a class="toc-backref" href="#id76" role="doc-backlink"><span class="section-number">11.2.5.1.1. </span>Domain Objectの作成</a><a class="headerlink" href="#domain-object" title="Permalink to this heading">¶</a></h4>
<p>Domainオブジェクトを作成する。</p>
<p>Package Explorer上で右クリック -&gt; New -&gt; Class を選択し、「New Java Class」ダイアログを表示し、</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 33.3%" />
<col style="width: 55.6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>項目</p></th>
<th class="head"><p>入力値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Package</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">com.example.todo.domain.model</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Name</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Todo</span></code></p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Interfaces</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">java.io.Serializable</span></code></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>を入力して「Finish」する。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/image0571.png"><img alt="../_images/image0571.png" src="../_images/image0571.png" style="width: 70%;" /></a>
</figure>
<p>作成したクラスは以下のディレクトリに格納される。</p>
<figure class="align-default">
<img alt="../_images/image0581.png" src="../_images/image0581.png" />
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>作成したクラスに以下のプロパティを追加する。</p>
<ul class="simple">
<li><p>ID → todoId</p></li>
<li><p>タイトル → todoTitle</p></li>
<li><p>完了フラグ → finished</p></li>
<li><p>作成日 → createdAt</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.domain.model</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.Serializable</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Date</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Todo</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">serialVersionUID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1L</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">todoId</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">finished</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getTodoId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">todoId</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTodoId</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">todoId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">todoId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">todoId</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getTodoTitle</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTodoTitle</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">todoTitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isFinished</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">finished</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setFinished</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">finished</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">finished</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">finished</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="nf">getCreatedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCreatedAt</span><span class="p">(</span><span class="n">Date</span><span class="w"> </span><span class="n">createdAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">createdAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Getter/SetterメソッドはSTSの機能を使って自動生成することができる。フィールドを定義した後、エディタ上で右クリックし、「Source」-&gt;「Generate Getters and Setters…」を選択する。</p>
<blockquote>
<div><figure class="align-default">
<a class="reference internal image-reference" href="../_images/image0591.png"><img alt="../_images/image0591.png" src="../_images/image0591.png" style="width: 90%;" /></a>
</figure>
</div></blockquote>
<p>serialVersionUID以外を選択して「Generate」</p>
<blockquote>
<div><figure class="align-default">
<a class="reference internal image-reference" href="../_images/image0601.png"><img alt="../_images/image0601.png" src="../_images/image0601.png" style="width: 60%;" /></a>
</figure>
</div></blockquote>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="repository">
<span id="tutorialtodocreaterepository-thymeleaf"></span><h4><a class="toc-backref" href="#id77" role="doc-backlink"><span class="section-number">11.2.5.1.2. </span>Repositoryの作成</a><a class="headerlink" href="#repository" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">TodoRepository</span></code>インタフェースを作成する。</div>
<div class="line">データベースを使用する場合は、「<a class="reference internal" href="#tutorial-todo-infra-thymeleaf"><span class="std std-ref">データベースアクセスを伴うインフラストラクチャ層の作成</span></a>」に記載されている内容で読み替えて、Repositoryを作成する。</div>
</div>
<p>Package Explorer上で右クリック -&gt; New -&gt; Interface を選択し、「New Java Interface」ダイアログを表示し、</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 33.3%" />
<col style="width: 55.6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>項目</p></th>
<th class="head"><p>入力値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Package</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">com.example.todo.domain.repository.todo</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Name</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TodoRepository</span></code></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>を入力して「Finish」する。</p>
<p>作成したインタフェースは以下のディレクトリに格納される。</p>
<figure class="align-default">
<img alt="../_images/image0611.png" src="../_images/image0611.png" />
</figure>
<p>作成したインタフェースに、今回のアプリケーションで必要となる以下のCRUD操作を行うメソッドを定義する。</p>
<ul class="simple">
<li><p>TODOの1件取得 → findById</p></li>
<li><p>TODOの全件取得 → findAll</p></li>
<li><p>TODOの1件作成 → create</p></li>
<li><p>TODOの1件更新 → update</p></li>
<li><p>TODOの1件削除 → delete</p></li>
<li><p>完了済みTODO件数の取得 → countByFinished</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.domain.repository.todo</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Collection</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Optional</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.todo.domain.model.Todo</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">TodoRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findById</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">todoId</span><span class="p">);</span>

<span class="w">    </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAll</span><span class="p">();</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="p">);</span>

<span class="w">    </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="p">);</span>

<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="nf">countByFinished</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">finished</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">java.util.Optional</span></code>型はJava 8から導入された<code class="docutils literal notranslate"><span class="pre">null</span></code>を安全に扱うための仕組みであり、コーディングミスによる<code class="docutils literal notranslate"><span class="pre">NullPointerException</span></code>等の防止に寄与する。</p>
<p>Repositoryの1件取得（<code class="docutils literal notranslate"><span class="pre">findById</span></code>）の戻り値を<code class="docutils literal notranslate"><span class="pre">Optional</span></code>型にすべきか否かは、以下のようにO/R Mapperにより異なるため、採用するO/R Mapperの仕様を確認されたい。</p>
<ul class="simple">
<li><p>O/R Mapperに依存しない場合とMyBatis3を利用する場合は、<strong>Optional型にしても良い。</strong></p></li>
<li><p>Spring Data JPAを利用する場合は、Repositoryのメソッドシグネチャが決まっており<strong>必ずOptional型となる。</strong></p></li>
</ul>
<p>本チュートリアルではO/R Mapperによらず戻り値に<code class="docutils literal notranslate"><span class="pre">Optional</span></code>型に統一しているが、これはRepositoryを上記3種類のO/R Mapperで実装し、それらを呼び出すServiceの実装を統一するためである。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ここでは、<code class="docutils literal notranslate"><span class="pre">TodoRepository</span></code>の汎用性を上げるため、「完了済み件数を取得する」メソッド(<code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">countFinished()</span></code>)ではなく、「完了状態がxxである件数を取得する」メソッド(<code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">countByFinished(boolean)</span></code>)として定義している。</p>
<p><code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">countByFinished(boolean)</span></code>の引数として<code class="docutils literal notranslate"><span class="pre">true</span></code>を渡すと「完了済みの件数」、<code class="docutils literal notranslate"><span class="pre">false</span></code>を渡すと「未完了の件数」が取得できる仕様としている。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="repositoryimpl">
<h4><a class="toc-backref" href="#id78" role="doc-backlink"><span class="section-number">11.2.5.1.3. </span>RepositoryImplの作成(インフラストラクチャ層)</a><a class="headerlink" href="#repositoryimpl" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">ここでは、説明を単純化するため、<code class="docutils literal notranslate"><span class="pre">java.util.Map</span></code>を使ったインメモリ実装のRepositoryImplを作成する。</div>
<div class="line">データベースを使用する場合は、「<a class="reference internal" href="#tutorial-todo-infra-thymeleaf"><span class="std std-ref">データベースアクセスを伴うインフラストラクチャ層の作成</span></a>」に記載されている内容で読み替えて、RepositoryImplを作成する。</div>
</div>
<p>Package Explorer上で右クリック -&gt; New -&gt; Class を選択し、「New Java Class」ダイアログを表示し、</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 33.3%" />
<col style="width: 55.6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>項目</p></th>
<th class="head"><p>入力値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Package</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">com.example.todo.domain.repository.todo</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Name</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TodoRepositoryImpl</span></code></p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Interfaces</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">com.example.todo.domain.repository.todo.TodoRepository</span></code></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>を入力して「Finish」する。</p>
<p>作成したクラスは以下のディレクトリに格納される。</p>
<figure class="align-default">
<img alt="../_images/image0621.png" src="../_images/image0621.png" />
</figure>
<p>作成したクラスにCRUD操作を実装する。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>RepositoryImplには、業務ロジックは含めず、Domainオブジェクトの保存先への出し入れ(CRUD操作)に終始することが実装ポイントである。</p>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.domain.repository.todo</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Collection</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Map</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Optional</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.ConcurrentHashMap</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Repository</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.todo.domain.model.Todo</span><span class="p">;</span>

<span class="nd">@Repository</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoRepositoryImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">TodoRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Todo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">TODO_MAP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConcurrentHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Todo</span><span class="o">&gt;</span><span class="p">();</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findById</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">todoId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">ofNullable</span><span class="p">(</span><span class="n">TODO_MAP</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">todoId</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAll</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">TODO_MAP</span><span class="p">.</span><span class="na">values</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TODO_MAP</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">todo</span><span class="p">.</span><span class="na">getTodoId</span><span class="p">(),</span><span class="w"> </span><span class="n">todo</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TODO_MAP</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">todo</span><span class="p">.</span><span class="na">getTodoId</span><span class="p">(),</span><span class="w"> </span><span class="n">todo</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TODO_MAP</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">todo</span><span class="p">.</span><span class="na">getTodoId</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">countByFinished</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">finished</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">TODO_MAP</span><span class="p">.</span><span class="na">values</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">finished</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">todo</span><span class="p">.</span><span class="na">isFinished</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">count</span><span class="o">++</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 88.9%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Repositoryとしてcomponent-scan対象とするため、クラスレベルに<code class="docutils literal notranslate"><span class="pre">&#64;Repository</span></code>アノテーションをつける。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>本チュートリアルでは、インフラストラクチャ層に属するクラス(RepositoryImpl)をドメイン層のパッケージ(<code class="docutils literal notranslate"><span class="pre">com.example.todo.domain</span></code>)に格納しているが、完全に層別にパッケージを分けるのであれば、インフラストラクチャ層のクラスは、<code class="docutils literal notranslate"><span class="pre">com.example.todo.infra</span></code>以下に作成した方が良い。</p>
<p>ただし、通常のプロジェクトでは、インフラストラクチャ層が変更されることを前提としていない(そのような前提で進めるプロジェクトは、少ない)。そこで、作業効率向上のために、ドメイン層のRepositoryインタフェースと同じ階層に、RepositoryImplを作成しても良い。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="service">
<h4><a class="toc-backref" href="#id79" role="doc-backlink"><span class="section-number">11.2.5.1.4. </span>Serviceの作成</a><a class="headerlink" href="#service" title="Permalink to this heading">¶</a></h4>
<p>まず、<code class="docutils literal notranslate"><span class="pre">TodoService</span></code>インタフェースを作成する。</p>
<p>Package Explorer上で右クリック -&gt; New -&gt; Interface を選択し、「New Java Interface」ダイアログを表示し、</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 33.3%" />
<col style="width: 55.6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>項目</p></th>
<th class="head"><p>入力値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Package</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">com.example.todo.domain.service.todo</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Name</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TodoService</span></code></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>を入力して「Finish」する。</p>
<p>作成したインタフェースは以下のディレクトリに格納される。</p>
<figure class="align-default">
<img alt="../_images/image0631.png" src="../_images/image0631.png" />
</figure>
<p>作成したインタフェースに以下の業務処理を行うメソッドを定義する。</p>
<ul class="simple">
<li><p>Todoの全件取得 → findAll</p></li>
<li><p>Todoの新規作成 → create</p></li>
<li><p>Todoの完了 → finish</p></li>
<li><p>Todoの削除 → delete</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.domain.service.todo</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Collection</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.todo.domain.model.Todo</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">TodoService</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAll</span><span class="p">();</span>

<span class="w">    </span><span class="n">Todo</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="p">);</span>

<span class="w">    </span><span class="n">Todo</span><span class="w"> </span><span class="nf">finish</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">todoId</span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">todoId</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>次に、<code class="docutils literal notranslate"><span class="pre">TodoService</span></code>インタフェースに定義したメソッドを実装する<code class="docutils literal notranslate"><span class="pre">TodoServiceImpl</span></code>クラスを作成する。</p>
<p>Package Explorer上で右クリック -&gt; New -&gt; Class を選択し、「New Java Class」ダイアログを表示し、</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 33.3%" />
<col style="width: 55.6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>項目</p></th>
<th class="head"><p>入力値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Package</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">com.example.todo.domain.service.todo</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Name</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TodoServiceImpl</span></code></p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Interfaces</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">com.example.todo.domain.service.todo.TodoService</span></code></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>を入力して「Finish」する。</p>
<p>作成したクラスは以下のディレクトリに格納される。</p>
<figure class="align-default">
<img alt="../_images/image0641.png" src="../_images/image0641.png" />
</figure>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.domain.service.todo</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Collection</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Date</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.UUID</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.exception.BusinessException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.exception.ResourceNotFoundException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.message.ResultMessage</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.message.ResultMessages</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.todo.domain.model.Todo</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.todo.domain.repository.todo.TodoRepository</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.inject.Inject</span><span class="p">;</span>

<span class="nd">@Service</span><span class="c1">// (1)</span>
<span class="nd">@Transactional</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">TodoService</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">MAX_UNFINISHED_COUNT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Inject</span><span class="c1">// (3)</span>
<span class="w">    </span><span class="n">TodoRepository</span><span class="w"> </span><span class="n">todoRepository</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="nd">@Transactional</span><span class="p">(</span><span class="n">readOnly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="c1">// (4)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAll</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">todoRepository</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Todo</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">unfinishedCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">todoRepository</span><span class="p">.</span><span class="na">countByFinished</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">unfinishedCount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">MAX_UNFINISHED_COUNT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// (5)</span>
<span class="w">            </span><span class="n">ResultMessages</span><span class="w"> </span><span class="n">messages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResultMessages</span><span class="p">.</span><span class="na">error</span><span class="p">();</span>
<span class="w">            </span><span class="n">messages</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">ResultMessage</span><span class="p">.</span><span class="na">fromText</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;[E001] The count of un-finished Todo must not be over &quot;</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">MAX_UNFINISHED_COUNT</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">));</span>
<span class="w">            </span><span class="c1">// (6)</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="n">messages</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// (7)</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">todoId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span>
<span class="w">        </span><span class="n">Date</span><span class="w"> </span><span class="n">createdAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Date</span><span class="p">();</span>

<span class="w">        </span><span class="n">todo</span><span class="p">.</span><span class="na">setTodoId</span><span class="p">(</span><span class="n">todoId</span><span class="p">);</span>
<span class="w">        </span><span class="n">todo</span><span class="p">.</span><span class="na">setCreatedAt</span><span class="p">(</span><span class="n">createdAt</span><span class="p">);</span>
<span class="w">        </span><span class="n">todo</span><span class="p">.</span><span class="na">setFinished</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="w">        </span><span class="n">todoRepository</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
<span class="w">        </span><span class="cm">/* REMOVE THIS LINE IF YOU USE JPA</span>
<span class="cm">            todoRepository.save(todo); // (8)</span>
<span class="cm">           REMOVE THIS LINE IF YOU USE JPA */</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">todo</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Todo</span><span class="w"> </span><span class="nf">finish</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">todoId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findOne</span><span class="p">(</span><span class="n">todoId</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">todo</span><span class="p">.</span><span class="na">isFinished</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">ResultMessages</span><span class="w"> </span><span class="n">messages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResultMessages</span><span class="p">.</span><span class="na">error</span><span class="p">();</span>
<span class="w">            </span><span class="n">messages</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">ResultMessage</span><span class="p">.</span><span class="na">fromText</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;[E002] The requested Todo is already finished. (id=&quot;</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">todoId</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;)&quot;</span><span class="p">));</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="n">messages</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">todo</span><span class="p">.</span><span class="na">setFinished</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">        </span><span class="n">todoRepository</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
<span class="w">        </span><span class="cm">/* REMOVE THIS LINE IF YOU USE JPA</span>
<span class="cm">            todoRepository.save(todo); // (9)</span>
<span class="cm">           REMOVE THIS LINE IF YOU USE JPA */</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">todo</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">todoId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findOne</span><span class="p">(</span><span class="n">todoId</span><span class="p">);</span>
<span class="w">        </span><span class="n">todoRepository</span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// (10)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Todo</span><span class="w"> </span><span class="nf">findOne</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">todoId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// (11)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">todoRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">todoId</span><span class="p">).</span><span class="na">orElseThrow</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">ResultMessages</span><span class="w"> </span><span class="n">messages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResultMessages</span><span class="p">.</span><span class="na">error</span><span class="p">();</span>
<span class="w">            </span><span class="n">messages</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">ResultMessage</span><span class="p">.</span><span class="na">fromText</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;[E404] The requested Todo is not found. (id=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">todoId</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;)&quot;</span><span class="p">));</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResourceNotFoundException</span><span class="p">(</span><span class="n">messages</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Serviceとしてcomponent-scanの対象とするため、クラスレベルに<code class="docutils literal notranslate"><span class="pre">&#64;Service</span></code>アノテーションをつける。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">クラスレベルに、<code class="docutils literal notranslate"><span class="pre">&#64;Transactional</span></code>アノテーションをつけることで、公開メソッドをすべてトランザクション管理する。</div>
<div class="line">アノテーションを付与することで、メソッド開始時にトランザクションを開始、メソッド正常終了時にトランザクションのコミットが行われる。</div>
<div class="line">また、途中で非検査例外が発生した場合は、トランザクションがロールバックされる。</div>
<div class="line"><br /></div>
<div class="line">データベースを使用しない場合は、<code class="docutils literal notranslate"><span class="pre">&#64;Transactional</span></code>アノテーションは不要である。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;Inject</span></code>アノテーションで、<code class="docutils literal notranslate"><span class="pre">TodoRepository</span></code>の実装をインジェクションする。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">参照のみ行う処理に関しては、<code class="docutils literal notranslate"><span class="pre">readOnly=true</span></code>をつける。</div>
<div class="line">O/R Mapperによっては、この設定により、参照時のトランザクション制御の最適化が行われる(JPAを使用する場合、効果はない)。</div>
<div class="line"><br /></div>
<div class="line">データベースを使用しない場合は、<code class="docutils literal notranslate"><span class="pre">&#64;Transactional</span></code>アノテーションは不要である。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">結果メッセージを格納するクラスとして、共通ライブラリで用意されている<code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.common.message.ResultMessage</span></code>を用いる。</div>
<div class="line">今回は、エラーメッセージを例外に追加する際に、<code class="docutils literal notranslate"><span class="pre">ResultMessages.error()</span></code>でメッセージ種別を指定して、<code class="docutils literal notranslate"><span class="pre">ResultMessage</span></code>を追加している。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">業務エラーが発生した場合、共通ライブラリで用意されている<code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.common.exception.BusinessException</span></code>をスローする。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">一意性のある値を生成するために、UUIDを使用している。データベースのシーケンスを用いてもよい。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Spring Data JPAを使用してデータベースにアクセスする場合は、<code class="docutils literal notranslate"><span class="pre">create</span></code>メソッドではなく、<code class="docutils literal notranslate"><span class="pre">save</span></code>メソッドを呼び出す。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Spring Data JPAを使用してデータベースにアクセスする場合は、<code class="docutils literal notranslate"><span class="pre">update</span></code>メソッドではなく、<code class="docutils literal notranslate"><span class="pre">save</span></code>メソッドを呼び出す。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">1件取得は、<code class="docutils literal notranslate"><span class="pre">finish</span></code>メソッドでも<code class="docutils literal notranslate"><span class="pre">delete</span></code>メソッドでも使用するため、メソッドとして用意しておく(interfaceに公開しても良い)。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(11)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">対象のデータが存在しない場合、共通ライブラリで用意されている<code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.common.exception.ResourceNotFoundException</span></code>をスローする。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>本節では、説明を単純化するため、エラーメッセージをハードコードしているが、メンテナンスの観点で本来は好ましくない。通常、メッセージは、プロパティファイルに外部化することが推奨される。</p>
<p>プロパティファイルに外部化する方法は、<a class="reference internal" href="../ArchitectureInDetail/GeneralFuncDetail/PropertyManagement.html"><span class="doc">プロパティ管理</span></a>を参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="id21">
<h3><a class="toc-backref" href="#id80" role="doc-backlink"><span class="section-number">11.2.5.2. </span>アプリケーション層の作成</a><a class="headerlink" href="#id21" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line">ドメイン層の実装が完了したので、次はドメイン層を利用して、アプリケーション層の作成に取り掛かる。</div>
<div class="line">画面（テンプレートHTML）には、プロトタイプとして作成したHTMLファイルを使用する。</div>
<div class="line"><br /></div>
</div>
<section id="controller">
<h4><a class="toc-backref" href="#id81" role="doc-backlink"><span class="section-number">11.2.5.2.1. </span>Controllerの作成</a><a class="headerlink" href="#controller" title="Permalink to this heading">¶</a></h4>
<p>まずは、Todo管理業務にかかわる画面遷移を、制御するControllerを作成する。</p>
<p>Package Explorer上で右クリック -&gt; New -&gt; Class を選択し、「New Java Class」ダイアログを表示し、</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 33.3%" />
<col style="width: 55.6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>項目</p></th>
<th class="head"><p>入力値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Package</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">com.example.todo.app.todo</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Name</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TodoController</span></code></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>を入力して「Finish」する。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>上位パッケージがドメイン層と異なるので注意すること。</strong></p>
</div>
<p>作成したクラスは以下のディレクトリに格納される。</p>
<figure class="align-default">
<img alt="../_images/image0651.png" src="../_images/image0651.png" />
</figure>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.app.todo</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>

<span class="nd">@Controller</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;todo&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoController</span><span class="w"> </span><span class="p">{</span>

<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Controllerとしてcomponent-scanの対象とするため、クラスレベルに、<code class="docutils literal notranslate"><span class="pre">&#64;Controller</span></code>アノテーションをつける。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">TodoController</span></code>が扱う画面遷移のパスを、すべて<code class="docutils literal notranslate"><span class="pre">&lt;contextPath&gt;/todo</span></code>配下にするため、クラスレベルに<code class="docutils literal notranslate"><span class="pre">&#64;RequestMapping(“todo”)</span></code>を設定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id22">
<h4><a class="toc-backref" href="#id82" role="doc-backlink"><span class="section-number">11.2.5.2.2. </span>Show all TODOの実装</a><a class="headerlink" href="#id22" title="Permalink to this heading">¶</a></h4>
<p>本チュートリアルで作成する画面では、</p>
<ul class="simple">
<li><p>新規作成フォームの表示</p></li>
<li><p>TODOの全件表示</p></li>
</ul>
<p>を行う。</p>
<p>はじめに、TODOの全件表示を行うための処理を実装する。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="form">
<h5><span class="section-number">11.2.5.2.2.1. </span>Formの作成<a class="headerlink" href="#form" title="Permalink to this heading">¶</a></h5>
<p>Formクラス(JavaBean)を作成する。</p>
<p>Package Explorer上で右クリック -&gt; New -&gt; Class を選択し、「New Java Class」ダイアログを表示し、</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 33.3%" />
<col style="width: 55.6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>項目</p></th>
<th class="head"><p>入力値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Package</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">com.example.todo.app.todo</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Name</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TodoForm</span></code></p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Interfaces</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">java.io.Serializable</span></code></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>を入力して「Finish」する。</p>
<p>作成したクラスは以下のディレクトリに格納される。</p>
<figure class="align-default">
<img alt="../_images/image0661.png" src="../_images/image0661.png" />
</figure>
<p>作成したクラスに以下のプロパティを追加する。</p>
<ul class="simple">
<li><p>タイトル → todoTitle</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.app.todo</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.Serializable</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoForm</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">serialVersionUID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1L</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getTodoTitle</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTodoTitle</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">todoTitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id23">
<h5><span class="section-number">11.2.5.2.2.2. </span>Controllerの実装<a class="headerlink" href="#id23" title="Permalink to this heading">¶</a></h5>
<p>一覧画面表示処理を<code class="docutils literal notranslate"><span class="pre">TodoController</span></code>に追加する。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.app.todo</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Collection</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.todo.domain.model.Todo</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.todo.domain.service.todo.TodoService</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.inject.Inject</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;todo&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Inject</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="n">TodoService</span><span class="w"> </span><span class="n">todoService</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@ModelAttribute</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">TodoForm</span><span class="w"> </span><span class="nf">setUpForm</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TodoForm</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TodoForm</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">form</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;list&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (3)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">todos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">todoService</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;todos&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">todos</span><span class="p">);</span><span class="w"> </span><span class="c1">// (4)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;todo/list&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// (5)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">TodoService</span></code>を、DIコンテナによってインジェクションさせるために、<code class="docutils literal notranslate"><span class="pre">&#64;Inject</span></code>アノテーションをつける。</div>
<div class="line"><br /></div>
<div class="line">DIコンテナの管理する<code class="docutils literal notranslate"><span class="pre">TodoService</span></code>型のインスタンス(<code class="docutils literal notranslate"><span class="pre">TodoServiceImpl</span></code>のインスタンス)がインジェクションされる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Formを初期化する。</div>
<div class="line"><br /></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;ModelAttribute</span></code>アノテーションをつけることで、このメソッドの返り値のformオブジェクトが、<code class="docutils literal notranslate"><span class="pre">todoForm</span></code>という名前で<code class="docutils literal notranslate"><span class="pre">Model</span></code>に追加される。</div>
<div class="line">これは、<code class="docutils literal notranslate"><span class="pre">TodoController</span></code>の各処理で、<code class="docutils literal notranslate"><span class="pre">model.addAttribute(&quot;todoForm&quot;,</span> <span class="pre">form)</span></code>を実装するのと同義である。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">/todo/list</span></code>というパスに<code class="docutils literal notranslate"><span class="pre">GET</span></code>メソッドを使用してリクエストされた際に、一覧画面表示処理用のメソッド(<code class="docutils literal notranslate"><span class="pre">list</span></code>メソッド)が実行されるように<code class="docutils literal notranslate"><span class="pre">&#64;GetMapping</span></code>アノテーションを設定する。</div>
<div class="line"><br /></div>
<div class="line">クラスレベルに<code class="docutils literal notranslate"><span class="pre">&#64;RequestMapping(“todo”)</span></code>が設定されているため、ここでは<code class="docutils literal notranslate"><span class="pre">&#64;GetMapping(&quot;list&quot;)</span></code>のみで良い。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">Model</span></code>にTodoのリストを追加して、Viewに渡す。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">View名として<code class="docutils literal notranslate"><span class="pre">todo/list</span></code>を返すと、spring-mvc.xmlまたはSpringMvcConfig.javaに定義した<code class="docutils literal notranslate"><span class="pre">ViewResolver</span></code>の設定によりテンプレートHTMLとして<code class="file docutils literal notranslate"><span class="pre">WEB-INF/views/todo/list.html</span></code>を利用して生成したHTMLが返される。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">&#64;GetMapping</span></code>や<code class="docutils literal notranslate"><span class="pre">&#64;PostMapping</span></code>は、対応するHTTPメソッドにマッピングする。</p>
<p>詳細は、<a class="reference internal" href="../ImplementationAtEachLayer/ApplicationLayer.html#controller-mapping-label"><span class="std std-ref">リクエストとハンドラメソッドのマッピング方法</span></a>を参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="html">
<h5><span class="section-number">11.2.5.2.2.3. </span>テンプレートHTMLの実装<a class="headerlink" href="#html" title="Permalink to this heading">¶</a></h5>
<p><a class="reference internal" href="#create-prototype-of-tutorial-todo-label-thymeleaf"><span class="std std-ref">Todoアプリケーションのプロトタイプ作成</span></a>で作成したプロトタイプにThymeleafの属性を付与してテンプレートHTMLを実装し、Controllerから渡されたModelを表示する。</p>
<p>TODOの一覧表示エリアを表示するために必要なテンプレートHTMLの実装を行う。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="cm">&lt;!-- (1) --&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Todo List<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="cm">&lt;!-- (2) --&gt;</span>
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span>
    <span class="na">href</span><span class="o">=</span><span class="s">&quot;../../../resources/app/css/styles.css&quot;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/resources/app/css/styles.css}&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Todo List<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;todoForm&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/create&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Create Todo<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;todoList&quot;</span><span class="p">&gt;</span>
        <span class="cm">&lt;!-- (3) --&gt;</span>
        <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">th:remove</span><span class="o">=</span><span class="s">&quot;all-but-first&quot;</span><span class="p">&gt;</span>
            <span class="cm">&lt;!-- (4) --&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;todo : ${todos}&quot;</span><span class="p">&gt;</span>
                <span class="cm">&lt;!-- (5)(6) --&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:class</span><span class="o">=</span><span class="s">&quot;${todo.finished} ? &#39;strike&#39;&quot;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${todo.todoTitle}&quot;</span><span class="p">&gt;</span>Send a e-mail<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="cm">&lt;!-- (7) --&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${!todo.finished}&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/finish&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Finish<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/delete&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>Have a lunch<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/finish&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Finish<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/delete&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;strike&quot;</span><span class="p">&gt;</span>Read a book<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/delete&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Thymeleaf独自の属性を使用するため、<code class="docutils literal notranslate"><span class="pre">&lt;html&gt;</span></code>タグにThymeleafのネームスペースを付与する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;link&gt;</span></code>タグに<code class="docutils literal notranslate"><span class="pre">th:href</span></code>属性を付与する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:href</span></code>属性値には、リンクURL式 <code class="docutils literal notranslate"><span class="pre">&#64;{}</span></code>を用いている。</div>
<div class="line">リンクURL式に”<code class="docutils literal notranslate"><span class="pre">/</span></code>“（スラッシュ）から始まるパスを指定することで、コンテキストルートからの相対パスが出力される。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">最初の子要素をThymeleafのテンプレートとして利用し、2番目以降の子要素は静的表示時のみに表示するために、Thymeleafの<code class="docutils literal notranslate"><span class="pre">th:remove</span></code>属性を使用する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:remove</span></code>属性に<code class="docutils literal notranslate"><span class="pre">all-but-first</span></code>を指定することで、Thymeleafでの処理時には、指定したタグにおける最初の子要素以外の要素が削除される。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:each</span></code>属性の右項にはControllerでModelに追加したコレクション<code class="docutils literal notranslate"><span class="pre">todos</span></code>を指定し、左項にはコレクションの要素オブジェクトを格納する変数名<code class="docutils literal notranslate"><span class="pre">todo</span></code>を指定している。</div>
<div class="line">これにより、<code class="docutils literal notranslate"><span class="pre">th:each</span></code>属性を付与した配下の要素が<code class="docutils literal notranslate"><span class="pre">todos</span></code>の要素数分繰り返し出力される。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:class</span></code>属性を使用することで、動的に<code class="docutils literal notranslate"><span class="pre">class</span></code>属性を設定できる。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:text</span></code>属性と同様に、変数式を利用してModelに登録した変数や<code class="docutils literal notranslate"><span class="pre">th:each</span></code>属性で定義した変数を参照できる。</div>
<div class="line">ここではEL式を利用して、<code class="docutils literal notranslate"><span class="pre">th:each</span></code>属性で取り出した<code class="docutils literal notranslate"><span class="pre">Todo</span></code>型オブジェクト<code class="docutils literal notranslate"><span class="pre">todo</span></code>の<code class="docutils literal notranslate"><span class="pre">finished</span></code>プロパティを参照して打ち消し線(<code class="docutils literal notranslate"><span class="pre">text-decoration:</span> <span class="pre">line-through;</span></code>)を装飾するかどうかを判断する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:text</span></code>属性を使用することで、記述した要素のコンテンツを属性値で上書きする。</div>
<div class="line"><strong>文字列値を出力する際は、XSS対策のため、必ずth:text属性を使用してHTMLエスケープを行うこと。</strong></div>
<div class="line">XSS対策についての詳細は、<a class="reference internal" href="../Security/XSS.html#xss-how-to-use-ouput-escaping"><span class="std std-ref">Output Escaping</span></a>を参照されたい。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:if</span></code>属性は条件に応じて、要素を出力するかどうか制御するための属性であり、<code class="docutils literal notranslate"><span class="pre">todo</span></code>の<code class="docutils literal notranslate"><span class="pre">finished</span></code>プロパティを参照して「Finish」ボタンの生成を判断する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Thymeleafの<code class="docutils literal notranslate"><span class="pre">th:object</span></code>属性を用いると、オブジェクト名を省略してプロパティを指定することが出来る。</p>
<p>list.htmlの<code class="docutils literal notranslate"><span class="pre">&lt;li&gt;</span></code>タグの部分は、<code class="docutils literal notranslate"><span class="pre">th:object</span></code>属性を用いることで以下のように記述量を減らすことが出来る。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">list.html</span></code></p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="p">&lt;</span><span class="nt">li</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;todo : ${todos}&quot;</span> <span class="na">th:object</span><span class="o">=</span><span class="s">&quot;${todo}&quot;</span><span class="p">&gt;</span>
    <span class="cm">&lt;!-- (2) --&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:class</span><span class="o">=</span><span class="s">&quot;*{finished} ? &#39;strike&#39;&quot;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;*{todoTitle}&quot;</span><span class="p">&gt;</span>Send a e-mail<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;*{!finished}&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/finish&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Finish<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/delete&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:object</span></code>属性にオブジェクトを変数式<code class="docutils literal notranslate"><span class="pre">${}</span></code>で指定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">オブジェクトのプロパティを選択変数式<code class="docutils literal notranslate"><span class="pre">*{}</span></code>で指定する。これは、変数式を用いて<code class="docutils literal notranslate"><span class="pre">th:class=&quot;${todo.finished}</span> <span class="pre">?</span> <span class="pre">'strike'&quot;</span></code>や<code class="docutils literal notranslate"><span class="pre">th:text=&quot;${todo.todoTitle}&quot;</span></code>と指定するのと同じ結果になる。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">STSで「todo」プロジェクトを右クリックし、「Run As」→「Run on Server」でWebアプリケーションを起動する。</div>
<div class="line">ブラウザで<code class="docutils literal notranslate"><span class="pre">http://localhost:8080/todo/todo/list</span></code>にアクセスすると、以下のような画面が表示される。</div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/image0671.png"><img alt="../_images/image0671.png" src="../_images/image0671.png" style="width: 25%;" /></a>
</figure>
<p>なお、表示されている「Create Todo」ボタンについては、「Create TODO」の実装が終了していないため、表示はされるが機能しない。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>上記で表示されている画面には、TODOが1件も登録されていないため、TODOの一覧は出力されない。</p>
<p>以下のように、ドメイン層の作成で作成したTodoRepositoryImplを一時的に修正し初期データを登録することで、TODOの一覧が出力されることを確認できる。</p>
<p>なお、次節「<a class="reference internal" href="#createtodoimplementation-thymeleaf"><span class="std std-ref">Create TODOの実装</span></a>」で実際にTODOを登録できるようになるため、一覧の出力が確認できたら削除して構わない。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">TodoRepositoryImpl.java</span></code></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.domain.repository.todo</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Collection</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Map</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.ConcurrentHashMap</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Repository</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.todo.domain.model.Todo</span><span class="p">;</span>

<span class="nd">@Repository</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoRepositoryImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">TodoRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Todo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">TODO_MAP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConcurrentHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Todo</span><span class="o">&gt;</span><span class="p">();</span>

<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Todo</span><span class="w"> </span><span class="n">todo1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Todo</span><span class="p">();</span>
<span class="w">        </span><span class="n">todo1</span><span class="p">.</span><span class="na">setTodoId</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">todo1</span><span class="p">.</span><span class="na">setTodoTitle</span><span class="p">(</span><span class="s">&quot;Send a e-mail&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Todo</span><span class="w"> </span><span class="n">todo2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Todo</span><span class="p">();</span>
<span class="w">        </span><span class="n">todo2</span><span class="p">.</span><span class="na">setTodoId</span><span class="p">(</span><span class="s">&quot;2&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">todo2</span><span class="p">.</span><span class="na">setTodoTitle</span><span class="p">(</span><span class="s">&quot;Have a lunch&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Todo</span><span class="w"> </span><span class="n">todo3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Todo</span><span class="p">();</span>
<span class="w">        </span><span class="n">todo3</span><span class="p">.</span><span class="na">setTodoId</span><span class="p">(</span><span class="s">&quot;3&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">todo3</span><span class="p">.</span><span class="na">setTodoTitle</span><span class="p">(</span><span class="s">&quot;Read a book&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">todo3</span><span class="p">.</span><span class="na">setFinished</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">        </span><span class="n">TODO_MAP</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">todo1</span><span class="p">.</span><span class="na">getTodoId</span><span class="p">(),</span><span class="w"> </span><span class="n">todo1</span><span class="p">);</span>
<span class="w">        </span><span class="n">TODO_MAP</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">todo2</span><span class="p">.</span><span class="na">getTodoId</span><span class="p">(),</span><span class="w"> </span><span class="n">todo2</span><span class="p">);</span>
<span class="w">        </span><span class="n">TODO_MAP</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">todo3</span><span class="p">.</span><span class="na">getTodoId</span><span class="p">(),</span><span class="w"> </span><span class="n">todo3</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// omitted</span>
</pre></div>
</div>
</li>
</ul>
<p>以下のように画面に出力される。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/show-all-todo-note1.png"><img alt="../_images/show-all-todo-note1.png" src="../_images/show-all-todo-note1.png" style="width: 30%;" /></a>
</figure>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="createtodoimplementation-thymeleaf">
<span id="id24"></span><h4><a class="toc-backref" href="#id83" role="doc-backlink"><span class="section-number">11.2.5.2.3. </span>Create TODOの実装</a><a class="headerlink" href="#createtodoimplementation-thymeleaf" title="Permalink to this heading">¶</a></h4>
<p>次に、一覧表示画面から「Create TODO」ボタンを押した後の、新規作成処理を実装する。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="id25">
<h5><span class="section-number">11.2.5.2.3.1. </span>マッパーインタフェースの作成<a class="headerlink" href="#id25" title="Permalink to this heading">¶</a></h5>
<p>Beanマッピングのマッパーインタフェースを作成する。</p>
<p>Package Explorer上で右クリック -&gt; New -&gt; Interface を選択し、「New Java Interface」ダイアログを表示し、</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 33.3%" />
<col style="width: 55.6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>項目</p></th>
<th class="head"><p>入力値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Package</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">com.example.todo.app.todo</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Name</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TodoMapper</span></code></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>を入力して「Finish」する。</p>
<p>作成したクラスは以下のディレクトリに格納される。</p>
<figure class="align-default">
<img alt="../_images/create-bean-mapper1.png" src="../_images/create-bean-mapper1.png" />
</figure>
<p>作成したクラスに以下の<code class="docutils literal notranslate"><span class="pre">&#64;Mapper</span></code>アノテーションを付与したBeanマッピングメソッドを追加する。</p>
<ul class="simple">
<li><p>Todo map(TodoForm form)</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;Mapping</span></code>アノテーションによるマッピング除外項目定義</p>
<ul>
<li><p>createdAt</p></li>
<li><p>finished</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.app.todo</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.mapstruct.Mapper</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.mapstruct.Mapping</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.todo.domain.model.Todo</span><span class="p">;</span>

<span class="nd">@Mapper</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">TodoMapper</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Mapping</span><span class="p">(</span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;createdAt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ignore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Mapping</span><span class="p">(</span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;finished&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ignore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="w">    </span><span class="n">Todo</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span><span class="n">TodoForm</span><span class="w"> </span><span class="n">form</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>マッパーインタフェース追加後、以下のようなビルドエラーが発生する場合がある。</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Caused by: org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type &#39;com.example.todo.app.todo.TodoMapper&#39;</span>
</pre></div>
</div>
</div></blockquote>
<p>この場合は、プロジェクト名を右クリックし、「Run As」-&gt;「Maven build」をクリックする。
Goalsに「compile」を指定し「Run」をクリックする。</p>
<blockquote>
<div><figure class="align-default">
<a class="reference internal image-reference" href="../_images/mvnBuild2.png"><img alt="../_images/mvnBuild2.png" src="../_images/mvnBuild2.png" style="width: 40%;" /></a>
</figure>
</div></blockquote>
<p>ビルドが成功した後、プロジェクト名を右クリックし、「Run As」-&gt;「Maven install」をクリックする。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id26">
<h5><span class="section-number">11.2.5.2.3.2. </span>Controllerの修正<a class="headerlink" href="#id26" title="Permalink to this heading">¶</a></h5>
<p>新規作成処理を<code class="docutils literal notranslate"><span class="pre">TodoController</span></code>に追加する。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.app.todo</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Collection</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.validation.BindingResult</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.servlet.mvc.support.RedirectAttributes</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.exception.BusinessException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.message.ResultMessage</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.message.ResultMessages</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.todo.domain.model.Todo</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.todo.domain.service.todo.TodoService</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.inject.Inject</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.Valid</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;todo&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Inject</span>
<span class="w">    </span><span class="n">TodoService</span><span class="w"> </span><span class="n">todoService</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="nd">@Inject</span>
<span class="w">    </span><span class="n">TodoMapper</span><span class="w"> </span><span class="n">beanMapper</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@ModelAttribute</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">TodoForm</span><span class="w"> </span><span class="nf">setUpForm</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TodoForm</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TodoForm</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">form</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;list&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">todos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">todoService</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;todos&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">todos</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;todo/list&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;create&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="nd">@Valid</span><span class="w"> </span><span class="n">TodoForm</span><span class="w"> </span><span class="n">todoForm</span><span class="p">,</span><span class="w"> </span><span class="n">BindingResult</span><span class="w"> </span><span class="n">bindingResult</span><span class="p">,</span><span class="w"> </span><span class="c1">// (3)</span>
<span class="w">            </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">RedirectAttributes</span><span class="w"> </span><span class="n">attributes</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (4)</span>

<span class="w">        </span><span class="c1">// (5)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// (6)</span>
<span class="w">        </span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beanMapper</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">todoForm</span><span class="p">);</span>

<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">todoService</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">BusinessException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// (7)</span>
<span class="w">            </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getResultMessages</span><span class="p">());</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// (8)</span>
<span class="w">        </span><span class="n">attributes</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="n">ResultMessages</span><span class="p">.</span><span class="na">success</span><span class="p">().</span><span class="na">add</span><span class="p">(</span><span class="n">ResultMessage</span>
<span class="w">                </span><span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;Created successfully!&quot;</span><span class="p">)));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/todo/list&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FormオブジェクトをDomainObjectに変換するために、<code class="docutils literal notranslate"><span class="pre">TodoMapper</span></code>インタフェースをインジェクションする。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">/todo/create</span></code>というパスに<code class="docutils literal notranslate"><span class="pre">POST</span></code>メソッドを使用してリクエストされた際に、新規作成処理用のメソッド(<code class="docutils literal notranslate"><span class="pre">create</span></code>メソッド)が実行されるように<code class="docutils literal notranslate"><span class="pre">&#64;PostMapping</span></code>アノテーションを設定する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">フォームの入力チェックを行うため、Formの引数に<code class="docutils literal notranslate"><span class="pre">&#64;Valid</span></code>アノテーションをつける。入力チェック結果は、その直後の引数<code class="docutils literal notranslate"><span class="pre">BindingResult</span></code>に格納される。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">正常に作成が完了した後にリダイレクトし、一覧画面を表示する。</div>
<div class="line">リダイレクト先への情報を格納するために、引数に<code class="docutils literal notranslate"><span class="pre">RedirectAttributes</span></code>を加える。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">入力エラーがあった場合、一覧画面に戻る。</div>
<div class="line">Todo全件取得を再度行う必要があるので、<code class="docutils literal notranslate"><span class="pre">list</span></code>メソッドを再実行する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">Mapstruct</span></code>を用いて、<code class="docutils literal notranslate"><span class="pre">TodoForm</span></code>オブジェクトから<code class="docutils literal notranslate"><span class="pre">Todo</span></code>オブジェクトを作成する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">業務処理を実行して、<code class="docutils literal notranslate"><span class="pre">BusinessException</span></code>が発生した場合、結果メッセージを<code class="docutils literal notranslate"><span class="pre">Model</span></code>に追加して、一覧画面に戻る。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">正常に作成が完了したので、結果メッセージをflashスコープに追加して、一覧画面でリダイレクトする。</div>
<div class="line">リダイレクトすることにより、ブラウザを再読み込みして、再び新規登録処理が<code class="docutils literal notranslate"><span class="pre">POST</span></code>されることがなくなる。（詳しくは、「<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/DoubleSubmitProtection.html#doublesubmitprotectionaboutprg"><span class="std std-ref">PRG(Post-Redirect-Get)パターンについて</span></a>」を参照されたい）</div>
<div class="line">なお、今回は成功メッセージであるため、<code class="docutils literal notranslate"><span class="pre">ResultMessages.success()</span></code>を使用している。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id27">
<h5><span class="section-number">11.2.5.2.3.3. </span>Formの修正<a class="headerlink" href="#id27" title="Permalink to this heading">¶</a></h5>
<p>入力チェックのルールを定義するため、Formオブジェクトにアノテーションを追加する。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.app.todo</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.Serializable</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.NotNull</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.Size</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoForm</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">serialVersionUID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1L</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@NotNull</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="nd">@Size</span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getTodoTitle</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTodoTitle</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">todoTitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 88.9%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;NotNull</span></code>アノテーションを使用して必須チェックを有効化する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;Size</span></code>アノテーションを使用して文字数チェックを有効化する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id28">
<h5><span class="section-number">11.2.5.2.3.4. </span>テンプレートHTMLの修正<a class="headerlink" href="#id28" title="Permalink to this heading">¶</a></h5>
<p>TODOを新規作成するため、テンプレートHTMLに以下の実装を追加する。</p>
<ul class="simple">
<li><p>TODOの入力フォームにThymeleafの属性を付与する</p></li>
<li><p>入力チェックエラーを表示するエリアを追加する</p></li>
<li><p>結果メッセージを表示するエリアを追加する</p></li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Todo List<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span>
    <span class="na">href</span><span class="o">=</span><span class="s">&quot;../../../resources/app/css/styles.css&quot;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/resources/app/css/styles.css}&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Todo List<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;todoForm&quot;</span><span class="p">&gt;</span>
        <span class="cm">&lt;!-- (1) --&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${resultMessages} != null&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-success&quot;</span> <span class="na">th:class</span><span class="o">=</span><span class="s">&quot;|alert alert-${resultMessages.type}|&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">li</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;message : ${resultMessages}&quot;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${message.text}&quot;</span><span class="p">&gt;</span>Created successfully!<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="cm">&lt;!-- (2) --&gt;</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/create&quot;</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&quot;@{/todo/create}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
            <span class="cm">&lt;!-- (3) --&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;${todoForm.todoTitle}&quot;</span> <span class="p">/&gt;</span>
            <span class="cm">&lt;!-- (4) --&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;todoTitle.errors&quot;</span> <span class="na">th:errors</span><span class="o">=</span><span class="s">&quot;${todoForm.todoTitle}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-error&quot;</span><span class="p">&gt;</span>size must be between 1 and 30<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Create Todo<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;todoList&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">th:remove</span><span class="o">=</span><span class="s">&quot;all-but-first&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;todo : ${todos}&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:class</span><span class="o">=</span><span class="s">&quot;${todo.finished} ? &#39;strike&#39;&quot;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${todo.todoTitle}&quot;</span><span class="p">&gt;</span>Send a e-mail<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${!todo.finished}&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/finish&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Finish<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/delete&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>Have a lunch<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/finish&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Finish<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/delete&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;strike&quot;</span><span class="p">&gt;</span>Read a book<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/delete&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 88.9%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">新規作成処理の結果メッセージを表示する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:if</span></code>属性を使用し、ServiceやControllerで<code class="docutils literal notranslate"><span class="pre">resultMessages</span></code>オブジェクトがModelに登録されている場合のみ、結果メッセージを表示している。</div>
<div class="line">また、<code class="docutils literal notranslate"><span class="pre">th:class</span></code>属性を使用することで、<code class="docutils literal notranslate"><span class="pre">ResultMessages</span></code>に設定されたメッセージタイプ（例:<code class="docutils literal notranslate"><span class="pre">info</span></code>,<code class="docutils literal notranslate"><span class="pre">error</span></code>）に応じた<code class="docutils literal notranslate"><span class="pre">class</span></code>属性を設定している。</div>
</div>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>一般的にThymeleafを利用して画面を実装する場合、HTMLファイルを直接ブラウザで表示することを考慮し、Thymeleafのテンプレートとしては不要だがHTML表示時に必要となる属性や文字列（コード例における<code class="docutils literal notranslate"><span class="pre">class=&quot;alert</span> <span class="pre">alert-success&quot;</span></code>や<code class="docutils literal notranslate"><span class="pre">Created</span> <span class="pre">successfully!</span></code>）を記述する。</p>
</div>
</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">新規作成処理用のformを実装する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:action</span></code>属性には、リンクURL式 <code class="docutils literal notranslate"><span class="pre">&#64;{}</span></code>を用いて新規作成処理を実行するためのパス（<code class="docutils literal notranslate"><span class="pre">/todo/create</span></code>）を指定する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;input&gt;</span></code>タグでフォームのプロパティをバインドする。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:field</span></code>属性値を<code class="docutils literal notranslate"><span class="pre">&lt;input&gt;</span></code>タグに適用すると、<code class="docutils literal notranslate"><span class="pre">id</span></code>属性、<code class="docutils literal notranslate"><span class="pre">name</span></code>属性、<code class="docutils literal notranslate"><span class="pre">value</span></code>属性が付加される。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:errors</span></code>属性を付与することで、指定したプロパティに対する入力エラーがあった場合に表示される。<code class="docutils literal notranslate"><span class="pre">th:errors</span></code>属性の値は、<code class="docutils literal notranslate"><span class="pre">&lt;input&gt;</span></code>タグの<code class="docutils literal notranslate"><span class="pre">th:field</span></code>属性と合わせる。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>フォームに適切な値を入力してsubmitすると、以下のように、成功メッセージが表示される。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/image0681.png"><img alt="../_images/image0681.png" src="../_images/image0681.png" style="width: 40%;" /></a>
</figure>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/image0691.png"><img alt="../_images/image0691.png" src="../_images/image0691.png" style="width: 40%;" /></a>
</figure>
<p>なお、TODOの横に表示されている「Finish」、「Delete」ボタンについては、「Finish TODO」、「Delete TODO」の実装が終了していないため、表示はされるが機能しない。</p>
<p>未完了のTODOが5件登録済みの場合は、業務エラーとなり、エラーメッセージが表示される。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/image0701.png"><img alt="../_images/image0701.png" src="../_images/image0701.png" style="width: 60%;" /></a>
</figure>
<p>入力フォームを、空文字にしてsubmitすると、以下のように、エラーメッセージが表示される。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/image0711.png"><img alt="../_images/image0711.png" src="../_images/image0711.png" style="width: 65%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="id29">
<h4><a class="toc-backref" href="#id84" role="doc-backlink"><span class="section-number">11.2.5.2.4. </span>Finish TODOの実装</a><a class="headerlink" href="#id29" title="Permalink to this heading">¶</a></h4>
<p>「Finish」ボタンにTODOを完了させるための処理を追加する。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="id30">
<h5><span class="section-number">11.2.5.2.4.1. </span>Formの修正<a class="headerlink" href="#id30" title="Permalink to this heading">¶</a></h5>
<p>完了処理用のFormについても、<code class="docutils literal notranslate"><span class="pre">TodoForm</span></code>を使用する。</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">TodoForm</span></code>に<code class="docutils literal notranslate"><span class="pre">todoId</span></code>プロパティを追加する必要があるが、単純に追加してしまうと、新規作成処理でも<code class="docutils literal notranslate"><span class="pre">todoId</span></code>プロパティのチェックが実行されてしまう。</div>
<div class="line">一つのFormクラスを使用して複数のformから送信されるリクエストパラメータをバインドする場合は、<code class="docutils literal notranslate"><span class="pre">groups</span></code>属性を使用して、入力チェックルールをグループ化する。</div>
</div>
<p>Formクラスに以下のプロパティを追加する。</p>
<ul class="simple">
<li><p>ID → todoId</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.app.todo</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.Serializable</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.NotNull</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.Size</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoForm</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">TodoCreate</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">TodoFinish</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">serialVersionUID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1L</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="nd">@NotNull</span><span class="p">(</span><span class="n">groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">TodoFinish</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">todoId</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// (3)</span>
<span class="w">    </span><span class="nd">@NotNull</span><span class="p">(</span><span class="n">groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">TodoCreate</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="nd">@Size</span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="n">groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">TodoCreate</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getTodoId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">todoId</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTodoId</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">todoId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">todoId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">todoId</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getTodoTitle</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTodoTitle</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">todoTitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">入力チェックルールをグループ化するためのインタフェースを作成する。</div>
<div class="line">入力チェックルールのグループ化については、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Validation.html"><span class="doc">入力チェック</span></a>を参照されたい。</div>
<div class="line"><br /></div>
<div class="line">ここでは、新規作成処理用のインタフェースとして<code class="docutils literal notranslate"><span class="pre">TodoCreate</span></code>を、完了処理用のインタフェースとして<code class="docutils literal notranslate"><span class="pre">TodoFinish</span></code>を作成している。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">todoId</span></code>は完了処理で使用するプロパティである。</div>
<div class="line">そのため、<code class="docutils literal notranslate"><span class="pre">&#64;NotNull</span></code>アノテーションの<code class="docutils literal notranslate"><span class="pre">groups</span></code>属性には、完了処理用の入力チェックルールである事を示す<code class="docutils literal notranslate"><span class="pre">TodoFinish</span></code>インタフェースを指定する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">todoTitle</span></code>は新規作成処理で使用するプロパティである。</div>
<div class="line">そのため、<code class="docutils literal notranslate"><span class="pre">&#64;NotNull</span></code>アノテーションと<code class="docutils literal notranslate"><span class="pre">&#64;Size</span></code>アノテーションの<code class="docutils literal notranslate"><span class="pre">groups</span></code>属性には、新規作成処理用の入力チェックルールである事を示す<code class="docutils literal notranslate"><span class="pre">TodoCreate</span></code>インタフェースを指定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id31">
<h5><span class="section-number">11.2.5.2.4.2. </span>Controllerの修正<a class="headerlink" href="#id31" title="Permalink to this heading">¶</a></h5>
<p>完了処理を<code class="docutils literal notranslate"><span class="pre">TodoController</span></code>に追加する。</p>
<p>グループ化した入力チェックルールを適用するためには、<strong>&#64;Valid アノテーションの代わりに、&#64;Validated アノテーションを使用すること</strong>に注意する。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.app.todo</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Collection</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.validation.BindingResult</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.validation.annotation.Validated</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.servlet.mvc.support.RedirectAttributes</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.exception.BusinessException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.message.ResultMessage</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.message.ResultMessages</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.todo.app.todo.TodoForm.TodoCreate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.todo.app.todo.TodoForm.TodoFinish</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.todo.domain.model.Todo</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.todo.domain.service.todo.TodoService</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.inject.Inject</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.groups.Default</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;todo&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Inject</span>
<span class="w">    </span><span class="n">TodoService</span><span class="w"> </span><span class="n">todoService</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Inject</span>
<span class="w">    </span><span class="n">TodoMapper</span><span class="w"> </span><span class="n">beanMapper</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@ModelAttribute</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">TodoForm</span><span class="w"> </span><span class="nf">setUpForm</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TodoForm</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TodoForm</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">form</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;list&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">todos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">todoService</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;todos&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">todos</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;todo/list&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;create&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="nd">@Validated</span><span class="p">({</span><span class="w"> </span><span class="n">Default</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">            </span><span class="n">TodoCreate</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="n">TodoForm</span><span class="w"> </span><span class="n">todoForm</span><span class="p">,</span><span class="w"> </span><span class="n">BindingResult</span><span class="w"> </span><span class="n">bindingResult</span><span class="p">,</span>
<span class="w">            </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">RedirectAttributes</span><span class="w"> </span><span class="n">attributes</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beanMapper</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">todoForm</span><span class="p">);</span>

<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">todoService</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">BusinessException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getResultMessages</span><span class="p">());</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">attributes</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="n">ResultMessages</span><span class="p">.</span><span class="na">success</span><span class="p">().</span><span class="na">add</span><span class="p">(</span><span class="n">ResultMessage</span>
<span class="w">                </span><span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;Created successfully!&quot;</span><span class="p">)));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/todo/list&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;finish&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">finish</span><span class="p">(</span><span class="nd">@Validated</span><span class="p">({</span><span class="w"> </span><span class="n">Default</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="c1">// (3)</span>
<span class="w">            </span><span class="n">TodoFinish</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="n">TodoForm</span><span class="w"> </span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">BindingResult</span><span class="w"> </span><span class="n">bindingResult</span><span class="p">,</span>
<span class="w">            </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">RedirectAttributes</span><span class="w"> </span><span class="n">attributes</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// (4)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">todoService</span><span class="p">.</span><span class="na">finish</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getTodoId</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">BusinessException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// (5)</span>
<span class="w">            </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getResultMessages</span><span class="p">());</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// (6)</span>
<span class="w">        </span><span class="n">attributes</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="n">ResultMessages</span><span class="p">.</span><span class="na">success</span><span class="p">().</span><span class="na">add</span><span class="p">(</span><span class="w"> </span><span class="n">ResultMessage</span>
<span class="w">                </span><span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;Finished successfully!&quot;</span><span class="p">)));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/todo/list&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">グループ化した入力チェックルールを適用するために、<code class="docutils literal notranslate"><span class="pre">&#64;Valid</span></code>アノテーションを<code class="docutils literal notranslate"><span class="pre">&#64;Validated</span></code>アノテーションに変更する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">value</span></code>属性には、適用する入力チェックルールのグループ(グループインタフェース)を指定する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Default.class</span></code>は、グループ化されていない入力チェックルールを適用するために用意されているグループインタフェースである。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">/todo/finish</span></code>というパスに<code class="docutils literal notranslate"><span class="pre">POST</span></code>メソッドを使用してリクエストされた際に、完了処理用のメソッド(<code class="docutils literal notranslate"><span class="pre">finish</span></code>メソッド)が実行されるように<code class="docutils literal notranslate"><span class="pre">&#64;PostMapping</span></code>アノテーションを設定する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">適用する入力チェックのグループとして、完了処理用のグループインタフェース(<code class="docutils literal notranslate"><span class="pre">TodoFinish</span></code>インタフェース)を指定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">入力エラーがあった場合、一覧画面に戻る。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">業務処理を実行して、<code class="docutils literal notranslate"><span class="pre">BusinessException</span></code>が発生した場合は、結果メッセージを<code class="docutils literal notranslate"><span class="pre">Model</span></code>に追加して、一覧画面に戻る。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">正常に作成が完了した場合は、結果メッセージをflashスコープに追加して、一覧画面でリダイレクトする。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>新規作成処理用と完了処理用を別々のFormクラスとして作成しても良い。別々のFormクラスにした場合、入力チェックルールをグループ化する必要がないため、入力チェックルールの定義はシンプルになる。</p>
<p>ただし、処理毎にFormクラスを作成した場合、</p>
<ul class="simple">
<li><p>クラス数が増える</p></li>
<li><p>プロパティが重複するため入力チェックルールを一元管理できない</p></li>
</ul>
<p>ため、仕様変更が発生した場合に修正コストが高くなる可能性があるという点に注意してほしい。</p>
<p>また、<code class="docutils literal notranslate"><span class="pre">&#64;ModelAttribute</span></code>メソッドを使用して複数のFormを初期化した場合、毎回すべてのFormが初期化されるため、不要なインスタンスが生成されることになる。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id32">
<h5><span class="section-number">11.2.5.2.4.3. </span>テンプレートHTMLの修正<a class="headerlink" href="#id32" title="Permalink to this heading">¶</a></h5>
<p>完了処理用のformを実装する。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Todo List<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span>
    <span class="na">href</span><span class="o">=</span><span class="s">&quot;../../../resources/app/css/styles.css&quot;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/resources/app/css/styles.css}&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Todo List<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;todoForm&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${resultMessages} != null&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-success&quot;</span> <span class="na">th:class</span><span class="o">=</span><span class="s">&quot;|alert alert-${resultMessages.type}|&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">li</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;message : ${resultMessages}&quot;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${message.text}&quot;</span><span class="p">&gt;</span>Created successfully!<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/create&quot;</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&quot;@{/todo/create}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;${todoForm.todoTitle}&quot;</span> <span class="p">/&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;todoTitle.errors&quot;</span> <span class="na">th:errors</span><span class="o">=</span><span class="s">&quot;${todoForm.todoTitle}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-error&quot;</span><span class="p">&gt;</span>size must be between 1 and 30<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Create Todo<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;todoList&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">th:remove</span><span class="o">=</span><span class="s">&quot;all-but-first&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;todo : ${todos}&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:class</span><span class="o">=</span><span class="s">&quot;${todo.finished} ? &#39;strike&#39;&quot;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${todo.todoTitle}&quot;</span><span class="p">&gt;</span>Send a e-mail<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="cm">&lt;!-- (1) --&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${!todo.finished}&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/finish&quot;</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&quot;@{/todo/finish}&quot;</span>
                    <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="cm">&lt;!-- (2) --&gt;</span>
                    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todoId&quot;</span> <span class="na">th:value</span><span class="o">=</span><span class="s">&quot;${todo.todoId}&quot;</span> <span class="p">/&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Finish<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/delete&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>Have a lunch<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/finish&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Finish<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/delete&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;strike&quot;</span><span class="p">&gt;</span>Read a book<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/delete&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:if</span></code>属性を使用し、TODOが未完了の場合は、TODOを完了させるためのリクエストを送信するformを表示する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:action</span></code>属性にはリンクURL式 <code class="docutils literal notranslate"><span class="pre">&#64;{}</span></code>を用いて完了処理を実行するためのパス（<code class="docutils literal notranslate"><span class="pre">/todo/finish</span></code>）を指定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">リクエストパラメータとして<code class="docutils literal notranslate"><span class="pre">todoId</span></code>を送信する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:value</span></code>属性を使用して、<code class="docutils literal notranslate"><span class="pre">todo</span></code>オブジェクトの<code class="docutils literal notranslate"><span class="pre">todoId</span></code>プロパティを値に設定している。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>TODOを新規作成した後に、「Finish」ボタン押下すると、以下のように打ち消し線が入り、完了したことがわかる。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/image0751.png"><img alt="../_images/image0751.png" src="../_images/image0751.png" style="width: 40%;" /></a>
</figure>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/image0761.png"><img alt="../_images/image0761.png" src="../_images/image0761.png" style="width: 40%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="id33">
<h4><a class="toc-backref" href="#id85" role="doc-backlink"><span class="section-number">11.2.5.2.5. </span>Delete TODOの実装</a><a class="headerlink" href="#id33" title="Permalink to this heading">¶</a></h4>
<p>「Delete」ボタンにTODOを削除するための処理を追加する。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="id34">
<h5><span class="section-number">11.2.5.2.5.1. </span>Formの修正<a class="headerlink" href="#id34" title="Permalink to this heading">¶</a></h5>
<p>削除処理用のFormについても、<code class="docutils literal notranslate"><span class="pre">TodoForm</span></code>を使用する。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.app.todo</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.Serializable</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.NotNull</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.Size</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoForm</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">TodoCreate</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">TodoFinish</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">TodoDelete</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">serialVersionUID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1L</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="nd">@NotNull</span><span class="p">(</span><span class="n">groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">TodoFinish</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">TodoDelete</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">todoId</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@NotNull</span><span class="p">(</span><span class="n">groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">TodoCreate</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="nd">@Size</span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="n">groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">TodoCreate</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getTodoId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">todoId</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTodoId</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">todoId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">todoId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">todoId</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getTodoTitle</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTodoTitle</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">todoTitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">削除処理用の入力チェックルールをグループ化するためのインタフェースとして<code class="docutils literal notranslate"><span class="pre">TodoDelete</span></code>を作成する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">削除処理では<code class="docutils literal notranslate"><span class="pre">todoId</span></code>プロパティを使用する。</div>
<div class="line">そのため、<code class="docutils literal notranslate"><span class="pre">todoId</span></code>の<code class="docutils literal notranslate"><span class="pre">&#64;NotNull</span></code>アノテーションの<code class="docutils literal notranslate"><span class="pre">groups</span></code>属性には、削除処理用の入力チェックルールである事を示す<code class="docutils literal notranslate"><span class="pre">TodoDelete</span></code>インタフェースを指定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id35">
<h5><span class="section-number">11.2.5.2.5.2. </span>Controllerの修正<a class="headerlink" href="#id35" title="Permalink to this heading">¶</a></h5>
<p>削除処理を<code class="docutils literal notranslate"><span class="pre">TodoController</span></code>に追加する。完了処理とほぼ同じである。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.app.todo</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Collection</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.validation.BindingResult</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.validation.annotation.Validated</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.servlet.mvc.support.RedirectAttributes</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.exception.BusinessException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.message.ResultMessage</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.message.ResultMessages</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.todo.app.todo.TodoForm.TodoCreate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.todo.app.todo.TodoForm.TodoDelete</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.todo.app.todo.TodoForm.TodoFinish</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.todo.domain.model.Todo</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.todo.domain.service.todo.TodoService</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.inject.Inject</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.groups.Default</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;todo&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Inject</span>
<span class="w">    </span><span class="n">TodoService</span><span class="w"> </span><span class="n">todoService</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Inject</span>
<span class="w">    </span><span class="n">TodoMapper</span><span class="w"> </span><span class="n">beanMapper</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@ModelAttribute</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">TodoForm</span><span class="w"> </span><span class="nf">setUpForm</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TodoForm</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TodoForm</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">form</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;list&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">todos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">todoService</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;todos&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">todos</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;todo/list&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;create&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="nd">@Validated</span><span class="p">({</span><span class="w"> </span><span class="n">Default</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
<span class="w">            </span><span class="n">TodoCreate</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="n">TodoForm</span><span class="w"> </span><span class="n">todoForm</span><span class="p">,</span><span class="w"> </span><span class="n">BindingResult</span><span class="w"> </span><span class="n">bindingResult</span><span class="p">,</span>
<span class="w">            </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">RedirectAttributes</span><span class="w"> </span><span class="n">attributes</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beanMapper</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">todoForm</span><span class="p">);</span>

<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">todoService</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">BusinessException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getResultMessages</span><span class="p">());</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">attributes</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="n">ResultMessages</span><span class="p">.</span><span class="na">success</span><span class="p">().</span><span class="na">add</span><span class="p">(</span><span class="n">ResultMessage</span>
<span class="w">                </span><span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;Created successfully!&quot;</span><span class="p">)));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/todo/list&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;finish&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">finish</span><span class="p">(</span><span class="nd">@Validated</span><span class="p">({</span><span class="w"> </span><span class="n">Default</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
<span class="w">            </span><span class="n">TodoFinish</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="n">TodoForm</span><span class="w"> </span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">BindingResult</span><span class="w"> </span><span class="n">bindingResult</span><span class="p">,</span>
<span class="w">            </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">RedirectAttributes</span><span class="w"> </span><span class="n">attributes</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">todoService</span><span class="p">.</span><span class="na">finish</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getTodoId</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">BusinessException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getResultMessages</span><span class="p">());</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">attributes</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="n">ResultMessages</span><span class="p">.</span><span class="na">success</span><span class="p">().</span><span class="na">add</span><span class="p">(</span><span class="n">ResultMessage</span>
<span class="w">                </span><span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;Finished successfully!&quot;</span><span class="p">)));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/todo/list&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;delete&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="nd">@Validated</span><span class="p">({</span><span class="w"> </span><span class="n">Default</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
<span class="w">            </span><span class="n">TodoDelete</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="n">TodoForm</span><span class="w"> </span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">BindingResult</span><span class="w"> </span><span class="n">bindingResult</span><span class="p">,</span>
<span class="w">            </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">RedirectAttributes</span><span class="w"> </span><span class="n">attributes</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">todoService</span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getTodoId</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">BusinessException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getResultMessages</span><span class="p">());</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">attributes</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="n">ResultMessages</span><span class="p">.</span><span class="na">success</span><span class="p">().</span><span class="na">add</span><span class="p">(</span><span class="n">ResultMessage</span>
<span class="w">                </span><span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;Deleted successfully!&quot;</span><span class="p">)));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/todo/list&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">/todo/delete</span></code>というパスに<code class="docutils literal notranslate"><span class="pre">POST</span></code>メソッドを使用してリクエストされた際に、削除処理用のメソッド(<code class="docutils literal notranslate"><span class="pre">delete</span></code>メソッド)が実行されるように<code class="docutils literal notranslate"><span class="pre">&#64;PostMapping</span></code>アノテーションを設定する。</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id36">
<h5><span class="section-number">11.2.5.2.5.3. </span>テンプレートHTMLの修正<a class="headerlink" href="#id36" title="Permalink to this heading">¶</a></h5>
<p>削除処理用のformを実装する。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Todo List<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span>
    <span class="na">href</span><span class="o">=</span><span class="s">&quot;../../../resources/app/css/styles.css&quot;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/resources/app/css/styles.css}&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Todo List<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;todoForm&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${resultMessages} != null&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-success&quot;</span> <span class="na">th:class</span><span class="o">=</span><span class="s">&quot;|alert alert-${resultMessages.type}|&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">li</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;message : ${resultMessages}&quot;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${message.text}&quot;</span><span class="p">&gt;</span>Created successfully!<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/create&quot;</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&quot;@{/todo/create}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;${todoForm.todoTitle}&quot;</span> <span class="p">/&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;todoTitle.errors&quot;</span> <span class="na">th:errors</span><span class="o">=</span><span class="s">&quot;${todoForm.todoTitle}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-error&quot;</span><span class="p">&gt;</span>size must be between 1 and 30<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Create Todo<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;todoList&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">th:remove</span><span class="o">=</span><span class="s">&quot;all-but-first&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;todo : ${todos}&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:class</span><span class="o">=</span><span class="s">&quot;${todo.finished} ? &#39;strike&#39;&quot;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${todo.todoTitle}&quot;</span><span class="p">&gt;</span>Send a e-mail<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${!todo.finished}&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/finish&quot;</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&quot;@{/todo/finish}&quot;</span>
                    <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todoId&quot;</span> <span class="na">th:value</span><span class="o">=</span><span class="s">&quot;${todo.todoId}&quot;</span> <span class="p">/&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Finish<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                <span class="cm">&lt;!-- (1) --&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/delete&quot;</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&quot;@{/todo/delete}&quot;</span>
                    <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="cm">&lt;!-- (2) --&gt;</span>
                    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todoId&quot;</span> <span class="na">th:value</span><span class="o">=</span><span class="s">&quot;${todo.todoId}&quot;</span> <span class="p">/&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>Have a lunch<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/finish&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Finish<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/delete&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;strike&quot;</span><span class="p">&gt;</span>Read a book<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/delete&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;inline&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:action</span></code>属性にはリンクURL式 <code class="docutils literal notranslate"><span class="pre">&#64;{}</span></code>を用いて削除処理を実行するためのパス（<code class="docutils literal notranslate"><span class="pre">/todo/delete</span></code>）を指定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">type=&quot;hidden&quot;</span></code>属性を使用して、リクエストパラメータとして<code class="docutils literal notranslate"><span class="pre">todoId</span></code>を送信する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>未完了状態のTODOの「Delete」ボタンを押下すると、以下のようにTODOが削除される。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/image0771.png"><img alt="../_images/image0771.png" src="../_images/image0771.png" style="width: 40%;" /></a>
</figure>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/image0781.png"><img alt="../_images/image0781.png" src="../_images/image0781.png" style="width: 40%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
</section>
</section>
<section id="tutorial-todo-infra-thymeleaf">
<span id="id37"></span><h2><a class="toc-backref" href="#id86" role="doc-backlink"><span class="section-number">11.2.6. </span>データベースアクセスを伴うインフラストラクチャ層の作成</a><a class="headerlink" href="#tutorial-todo-infra-thymeleaf" title="Permalink to this heading">¶</a></h2>
<p>ここでは、Domainオブジェクトをデータベースに永続化するためのインフラストラクチャ層の実装方法について説明する。</p>
<p>本チュートリアルでは、以下の2つのO/R Mapperを使用したインフラストラクチャ層の実装方法について説明する。</p>
<ul class="simple">
<li><p>MyBatis3</p></li>
<li><p>Spring Data JPA</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="tutorialcreateormapperblankproject-thymeleaf">
<span id="id38"></span><h3><a class="toc-backref" href="#id87" role="doc-backlink"><span class="section-number">11.2.6.1. </span>O/R Mapperに依存したブランクプロジェクトの作成</a><a class="headerlink" href="#tutorialcreateormapperblankproject-thymeleaf" title="Permalink to this heading">¶</a></h3>
<p>ここでは、O/R Mapperに依存したブランクプロジェクトの作成を行う。</p>
<p>まず、使用するO/R Mapperに応じてプロジェクトを作成し直す。</p>
<ul class="simple">
<li><p><a class="reference internal" href="#tutorialcreatemybatis3blankproject-thymeleaf"><span class="std std-ref">MyBatis3用のブランクプロジェクトの作成</span></a></p></li>
<li><p><a class="reference internal" href="#tutorialcreatejpablankproject-thymeleaf"><span class="std std-ref">JPA用のブランクプロジェクトの作成</span></a></p></li>
</ul>
<p>次に、<a class="reference internal" href="#tutorial-todo-infra-thymeleaf"><span class="std std-ref">データベースアクセスを伴うインフラストラクチャ層の作成</span></a>までで作成した<code class="file docutils literal notranslate"><span class="pre">src</span></code>フォルダ以下のうち、<strong>TodoRepositoryImplクラス以外のファイルを新規作成したプロジェクトにコピーする</strong>。</p>
<p><strong>ただし、コピーするファイルは新規作成したファイル・変更を加えたファイルに限り、修正を加えていないファイルはコピーしないこと</strong>。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="tutorial-setup-database-thymeleaf">
<span id="id39"></span><h3><a class="toc-backref" href="#id88" role="doc-backlink"><span class="section-number">11.2.6.2. </span>データベースのセットアップ</a><a class="headerlink" href="#tutorial-setup-database-thymeleaf" title="Permalink to this heading">¶</a></h3>
<p>ここでは、データベースのセットアップを行う。</p>
<p>本チュートリアルでは、データベースのセットアップの手間を省くため、H2 Databaseを使用する。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="todo-infra-properties">
<h4><a class="toc-backref" href="#id89" role="doc-backlink"><span class="section-number">11.2.6.2.1. </span>todo-infra.propertiesの修正</a><a class="headerlink" href="#todo-infra-properties" title="Permalink to this heading">¶</a></h4>
<p>APサーバ起動時にH2 Database上にテーブルが作成されるようにするために、<code class="file docutils literal notranslate"><span class="pre">src/main/resources/META-INF/spring/todo-infra.properties</span></code>の設定を変更する。</p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="na">database</span><span class="o">=</span><span class="s">H2</span>
<span class="c1"># (1)</span>
<span class="na">database.url</span><span class="o">=</span><span class="s">jdbc:h2:mem:todo;DB_CLOSE_DELAY=-1;INIT=create table if not exists todo(todo_id varchar(36) primary key, todo_title varchar(30), finished boolean, created_at timestamp)</span>
<span class="na">database.username</span><span class="o">=</span><span class="s">sa</span>
<span class="na">database.password</span><span class="o">=</span>
<span class="na">database.driverClassName</span><span class="o">=</span><span class="s">org.h2.Driver</span>
<span class="c1"># connection pool</span>
<span class="na">cp.maxActive</span><span class="o">=</span><span class="s">96</span>
<span class="na">cp.maxIdle</span><span class="o">=</span><span class="s">16</span>
<span class="na">cp.minIdle</span><span class="o">=</span><span class="s">0</span>
<span class="na">cp.maxWait</span><span class="o">=</span><span class="s">60000</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 88.9%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">接続URLのINITパラメータに、テーブルを作成するDDL文を指定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>INITパラメータに設定しているDDL文をフォーマットすると、以下の様なSQLとなる。</p>
<blockquote>
<div><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">exists</span><span class="w"> </span><span class="n">todo</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">todo_id</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="p">,</span>
<span class="w">    </span><span class="n">todo_title</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
<span class="w">    </span><span class="n">finished</span><span class="w"> </span><span class="nb">boolean</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">timestamp</span>
<span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="using-mybatis3-thymeleaf">
<span id="id40"></span><h3><a class="toc-backref" href="#id90" role="doc-backlink"><span class="section-number">11.2.6.3. </span>MyBatis3を使用したインフラストラクチャ層の作成</a><a class="headerlink" href="#using-mybatis3-thymeleaf" title="Permalink to this heading">¶</a></h3>
<p>ここでは、MyBatis3を使用してインフラストラクチャ層のRepositoryImplを作成する方法について説明する。</p>
<p>Spring Data JPAを使用する場合は、本節を読み飛ばして、<a class="reference internal" href="#using-springdatajpa-thymeleaf"><span class="std std-ref">Spring Data JPAを使用したインフラストラクチャ層の作成</span></a>に進んでよい。</p>
<section id="todorepository">
<h4><a class="toc-backref" href="#id91" role="doc-backlink"><span class="section-number">11.2.6.3.1. </span>TodoRepositoryの作成</a><a class="headerlink" href="#todorepository" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">TodoRepository</span></code>は、O/R Mapperを使用しない場合と同じ方法で作成する。</div>
<div class="line">作成方法は、「<a class="reference internal" href="#tutorialtodocreaterepository-thymeleaf"><span class="std std-ref">Repositoryの作成</span></a>」を参照されたい。</div>
<div class="line"><br /></div>
</div>
</section>
<section id="todorepositoryimpl">
<h4><a class="toc-backref" href="#id92" role="doc-backlink"><span class="section-number">11.2.6.3.2. </span>TodoRepositoryImplの作成</a><a class="headerlink" href="#todorepositoryimpl" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">MyBatis3を使用する場合、RepositoryImplはRepositoryインタフェース(Mapperインタフェース)から自動生成される。</div>
<div class="line">そのため、<code class="docutils literal notranslate"><span class="pre">TodoRepositoryImpl</span></code>の作成は不要である。作成した場合は削除すること。</div>
<div class="line"><br /></div>
</div>
</section>
<section id="mapper">
<h4><a class="toc-backref" href="#id93" role="doc-backlink"><span class="section-number">11.2.6.3.3. </span>Mapperファイルの作成</a><a class="headerlink" href="#mapper" title="Permalink to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">TodoRepository</span></code>インタフェースのメソッドが呼び出された際に実行するSQLを定義するためのMapperファイルを作成する。</p>
<p>Package Explorer上で右クリック -&gt; New -&gt; File を選択し、「Create New File」ダイアログを表示し、</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 33.3%" />
<col style="width: 55.6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>項目</p></th>
<th class="head"><p>入力値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Enter or select the parent folder</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">todo/src/main/resources/com/example/todo/domain/repository/todo</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>File name</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TodoRepository.xml</span></code></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>を入力して「Finish」する。</p>
<p>作成したファイルは以下のディレクトリに格納される。</p>
<figure class="align-default">
<img alt="../_images/create-mapper-for-mybatis31.png" src="../_images/create-mapper-for-mybatis31.png" />
</figure>
<p><code class="docutils literal notranslate"><span class="pre">TodoRepository</span></code>インタフェースに定義したメソッドが呼び出された際に実行するSQLを記述する。</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>

<span class="cm">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">namespace=</span><span class="s">&quot;com.example.todo.domain.repository.todo.TodoRepository&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;todoResultMap&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;todoId&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;todo_id&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;todoTitle&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;todo_title&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;finished&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;finished&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;createdAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;created_at&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/resultMap&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (3) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findById&quot;</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">&quot;String&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;todoResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="cp">&lt;![CDATA[</span>
<span class="cp">        SELECT</span>
<span class="cp">            todo_id,</span>
<span class="cp">            todo_title,</span>
<span class="cp">            finished,</span>
<span class="cp">            created_at</span>
<span class="cp">        FROM</span>
<span class="cp">            todo</span>
<span class="cp">        WHERE</span>
<span class="cp">            todo_id = #{todoId}</span>
<span class="cp">    ]]&gt;</span>
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (4) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findAll&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;todoResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="cp">&lt;![CDATA[</span>
<span class="cp">        SELECT</span>
<span class="cp">            todo_id,</span>
<span class="cp">            todo_title,</span>
<span class="cp">            finished,</span>
<span class="cp">            created_at</span>
<span class="cp">        FROM</span>
<span class="cp">            todo</span>
<span class="cp">    ]]&gt;</span>
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (5) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;insert</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;create&quot;</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="cp">&lt;![CDATA[</span>
<span class="cp">        INSERT INTO todo</span>
<span class="cp">        (</span>
<span class="cp">            todo_id,</span>
<span class="cp">            todo_title,</span>
<span class="cp">            finished,</span>
<span class="cp">            created_at</span>
<span class="cp">        )</span>
<span class="cp">        VALUES</span>
<span class="cp">        (</span>
<span class="cp">            #{todoId},</span>
<span class="cp">            #{todoTitle},</span>
<span class="cp">            #{finished},</span>
<span class="cp">            #{createdAt}</span>
<span class="cp">        )</span>
<span class="cp">    ]]&gt;</span>
<span class="w">    </span><span class="nt">&lt;/insert&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (6) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;update&quot;</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="cp">&lt;![CDATA[</span>
<span class="cp">        UPDATE todo</span>
<span class="cp">        SET</span>
<span class="cp">            todo_title = #{todoTitle},</span>
<span class="cp">            finished = #{finished},</span>
<span class="cp">            created_at = #{createdAt}</span>
<span class="cp">        WHERE</span>
<span class="cp">            todo_id = #{todoId}</span>
<span class="cp">    ]]&gt;</span>
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (7) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;delete</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;delete&quot;</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="cp">&lt;![CDATA[</span>
<span class="cp">        DELETE FROM</span>
<span class="cp">            todo</span>
<span class="cp">        WHERE</span>
<span class="cp">            todo_id = #{todoId}</span>
<span class="cp">    ]]&gt;</span>
<span class="w">    </span><span class="nt">&lt;/delete&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (8) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;countByFinished&quot;</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">&quot;Boolean&quot;</span>
<span class="w">        </span><span class="na">resultType=</span><span class="s">&quot;Long&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="cp">&lt;![CDATA[</span>
<span class="cp">        SELECT</span>
<span class="cp">            COUNT(*)</span>
<span class="cp">        FROM</span>
<span class="cp">            todo</span>
<span class="cp">        WHERE</span>
<span class="cp">            finished = #{finished}</span>
<span class="cp">    ]]&gt;</span>
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">mapper</span></code>要素の<code class="docutils literal notranslate"><span class="pre">namespace</span></code>属性に、Repositoryインタフェースの完全修飾クラス名(FQCN)を指定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;resultMap&gt;</span></code>要素に、検索結果(<code class="docutils literal notranslate"><span class="pre">ResultSet</span></code>)とJavaBeanのマッピング定義を行う。</div>
<div class="line">マッピングファイルの詳細は<a class="reference internal" href="../ArchitectureInDetail/DataAccessDetail/DataAccessMyBatis3.html"><span class="doc">データベースアクセス（MyBatis3編）</span></a>を参照されたい。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">todoId</span></code>(PK)が一致するレコードを1件取得するSQLを実装する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;select&gt;</span></code>要素の<code class="docutils literal notranslate"><span class="pre">resultMap</span></code>属性には、適用するマッピング定義のIDを指定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">全レコードを取得するSQLを実装している。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;select&gt;</span></code>要素の<code class="docutils literal notranslate"><span class="pre">resultMap</span></code>属性に、適用するマッピング定義のIDを指定する。</div>
<div class="line">アプリケーションの要件には記載がないが、最新のTODOが先頭に表示されるようにレコードを並び替えている。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">引数に指定されたTodoオブジェクトを挿入するSQLを実装する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;insert&gt;</span></code>要素の<code class="docutils literal notranslate"><span class="pre">parameterType</span></code>属性に、パラメータのクラス名(FQCN又はエイリアス名)を指定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">引数に指定されたTodoオブジェクトを更新するSQLを実装する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;update&gt;</span></code>要素の<code class="docutils literal notranslate"><span class="pre">parameterType</span></code>属性に、パラメータのクラス名(FQCN又はエイリアス名)を指定する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">引数に指定されたTodoオブジェクトを削除するSQLを実装する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;delete&gt;</span></code>要素の<code class="docutils literal notranslate"><span class="pre">parameterType</span></code>属性に、パラメータのクラス名(FQCN又はエイリアス名)を指定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">引数に指定された<code class="docutils literal notranslate"><span class="pre">finished</span></code>に一致するTodoの件数を取得するSQLを実装する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>以上で、MyBatis3を使用したインフラストラクチャ層の作成が完了したので、Service及びアプリケーション層の作成を行う。</p>
<p>Service及びアプリケーション層を作成後にAPサーバーを起動し、Todoの表示を行うと、以下のようなSQLログやトランザクションログが出力される。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">date:2022-12-01 16:49:29      thread:http-nio-8080-exec-2     X-Track:d3ef4363deef452d8823a00db0fbc71a        level:TRACE     logger:o.t.gfw.web.logging.TraceLoggingInterceptor      message:[START CONTROLLER] TodoController.list(Model)</span>
<span class="go">date:2022-12-01 16:49:29      thread:http-nio-8080-exec-2     X-Track:d3ef4363deef452d8823a00db0fbc71a        level:DEBUG     logger:o.s.jdbc.datasource.DataSourceTransactionManager message:Creating new transaction with name [com.example.todo.domain.service.todo.TodoServiceImpl.findAll]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly</span>
<span class="go">date:2022-12-01 16:49:29      thread:http-nio-8080-exec-2     X-Track:d3ef4363deef452d8823a00db0fbc71a        level:DEBUG     logger:o.s.jdbc.datasource.DataSourceTransactionManager message:Acquired Connection [13059960, URL=jdbc:h2:mem:todo-mybatis3, H2 JDBC Driver] for JDBC transaction</span>
<span class="go">date:2022-12-01 16:49:29      thread:http-nio-8080-exec-2     X-Track:d3ef4363deef452d8823a00db0fbc71a        level:DEBUG     logger:c.e.t.d.repository.todo.TodoRepository.findAll   message:==&gt;  Preparing: SELECT todo_id, todo_title, finished, created_at FROM todo</span>
<span class="go">date:2022-12-01 16:49:29      thread:http-nio-8080-exec-2     X-Track:d3ef4363deef452d8823a00db0fbc71a        level:DEBUG     logger:c.e.t.d.repository.todo.TodoRepository.findAll   message:==&gt; Parameters:</span>
<span class="go">date:2022-12-01 16:49:29      thread:http-nio-8080-exec-2     X-Track:d3ef4363deef452d8823a00db0fbc71a        level:DEBUG     logger:c.e.t.d.repository.todo.TodoRepository.findAll   message:&lt;==      Total: 0</span>
<span class="go">date:2022-12-01 16:49:29      thread:http-nio-8080-exec-2     X-Track:d3ef4363deef452d8823a00db0fbc71a        level:DEBUG     logger:o.s.jdbc.datasource.DataSourceTransactionManager message:Initiating transaction commit</span>
<span class="go">date:2022-12-01 16:49:29      thread:http-nio-8080-exec-2     X-Track:d3ef4363deef452d8823a00db0fbc71a        level:DEBUG     logger:o.s.jdbc.datasource.DataSourceTransactionManager message:Committing JDBC transaction on Connection [13059960, URL=jdbc:h2:mem:todo-mybatis3, H2 JDBC Driver]</span>
<span class="go">date:2022-12-01 16:49:29      thread:http-nio-8080-exec-2     X-Track:d3ef4363deef452d8823a00db0fbc71a        level:DEBUG     logger:o.s.jdbc.datasource.DataSourceTransactionManager message:Releasing JDBC Connection [13059960, URL=jdbc:h2:mem:todo-mybatis3, H2 JDBC Driver] after transaction</span>
<span class="go">date:2022-12-01 16:49:29      thread:http-nio-8080-exec-2     X-Track:d3ef4363deef452d8823a00db0fbc71a        level:TRACE     logger:o.t.gfw.web.logging.TraceLoggingInterceptor      message:[END CONTROLLER  ] TodoController.list(Model)-&gt; view=todo/list, model={todoForm=com.example.todo.app.todo.TodoForm@4e5a28b2, todos=[], org.springframework.validation.BindingResult.todoForm=org.springframework.validation.BeanPropertyBindingResult: 0 errors}</span>
<span class="go">date:2022-12-01 16:49:29      thread:http-nio-8080-exec-2     X-Track:d3ef4363deef452d8823a00db0fbc71a        level:TRACE     logger:o.t.gfw.web.logging.TraceLoggingInterceptor      message:[HANDLING TIME   ] TodoController.list(Model)-&gt; 205,791,900 ns</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="spring-data-jpa">
<span id="using-springdatajpa-thymeleaf"></span><h3><a class="toc-backref" href="#id94" role="doc-backlink"><span class="section-number">11.2.6.4. </span>Spring Data JPAを使用したインフラストラクチャ層の作成</a><a class="headerlink" href="#spring-data-jpa" title="Permalink to this heading">¶</a></h3>
<p>ここでは、<a class="reference external" href="https://spring.io/projects/spring-data-jpa">Spring Data JPA</a>を使用してインフラストラクチャ層のRepositoryImplを作成する方法について説明する。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="entity">
<h4><a class="toc-backref" href="#id95" role="doc-backlink"><span class="section-number">11.2.6.4.1. </span>Entityの修正</a><a class="headerlink" href="#entity" title="Permalink to this heading">¶</a></h4>
<p>TodoクラスとデータベースのTODOテーブルをマッピングするために、JPAのアノテーションを設定する。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.domain.model</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.Serializable</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Date</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.persistence.Column</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.persistence.Id</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.persistence.Table</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.persistence.Temporal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.persistence.TemporalType</span><span class="p">;</span>

<span class="c1">// (1)</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;todo&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Todo</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">serialVersionUID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1L</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="nd">@Id</span>
<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;todo_id&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">todoId</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;todo_title&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;finished&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">finished</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// (3)</span>
<span class="w">    </span><span class="nd">@Temporal</span><span class="p">(</span><span class="n">TemporalType</span><span class="p">.</span><span class="na">TIMESTAMP</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;created_at&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getTodoId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">todoId</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTodoId</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">todoId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">todoId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">todoId</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getTodoTitle</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTodoTitle</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">todoTitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">todoTitle</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isFinished</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">finished</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setFinished</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">finished</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">finished</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">finished</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="nf">getCreatedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCreatedAt</span><span class="p">(</span><span class="n">Date</span><span class="w"> </span><span class="n">createdAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">createdAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">JPAのエンティティであることを示す<code class="docutils literal notranslate"><span class="pre">&#64;Entity</span></code>アノテーションを付け、対応するテーブル名を<code class="docutils literal notranslate"><span class="pre">&#64;Table</span></code>アノテーションで設定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">主キーとなるカラムに対応するフィールドに、<code class="docutils literal notranslate"><span class="pre">&#64;Id</span></code>アノテーションをつける。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">java.util.Date</span></code>型は、<code class="docutils literal notranslate"><span class="pre">java.sql.Date</span></code>, <code class="docutils literal notranslate"><span class="pre">java.sql.Time</span></code>, <code class="docutils literal notranslate"><span class="pre">java.sql.Timestamp</span></code>のインスタンスを格納できるため、明示的にどの型のインスタンスを設定するか指定する必要がある。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">createdAt</span></code>プロパティには、<code class="docutils literal notranslate"><span class="pre">Timestamp</span></code>を指定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id42">
<h4><a class="toc-backref" href="#id96" role="doc-backlink"><span class="section-number">11.2.6.4.2. </span>TodoRepositoryの作成</a><a class="headerlink" href="#id42" title="Permalink to this heading">¶</a></h4>
<p>Spring Data JPAのRepository機能を使用して<code class="docutils literal notranslate"><span class="pre">TodoRepository</span></code>の作成を行う。</p>
<p>Package Explorer上で右クリック -&gt; New -&gt; Interface を選択し、「New Java Interface」ダイアログを表示し、</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 11.1%" />
<col style="width: 33.3%" />
<col style="width: 55.6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>項目</p></th>
<th class="head"><p>入力値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Package</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">com.example.todo.domain.repository.todo</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Name</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TodoRepository</span></code></p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Extended interfaces</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">org.springframework.data.jpa.repository.JpaRepository&lt;T,</span> <span class="pre">ID&gt;</span></code></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>を入力して「Finish」する。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.domain.repository.todo</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.jpa.repository.Query</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.repository.query.Param</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.todo.domain.model.Todo</span><span class="p">;</span>

<span class="c1">// (1)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">TodoRepository</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Todo</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Query</span><span class="p">(</span><span class="s">&quot;SELECT COUNT(t) FROM Todo t WHERE t.finished = :finished&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="nf">countByFinished</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;finished&quot;</span><span class="p">)</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">finished</span><span class="p">);</span><span class="w"> </span><span class="c1">// (3)</span>

<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">JpaRepository</span></code>のGenericsのパラメータを指定する。</div>
<div class="line">左から順に、Entityのクラス(<code class="docutils literal notranslate"><span class="pre">Todo</span></code>)、主キーのクラス(<code class="docutils literal notranslate"><span class="pre">String</span></code>)を指定する。</div>
<div class="line">基本的なCRUD操作(<code class="docutils literal notranslate"><span class="pre">findById</span></code>, <code class="docutils literal notranslate"><span class="pre">findAll</span></code>, <code class="docutils literal notranslate"><span class="pre">save</span></code>, <code class="docutils literal notranslate"><span class="pre">deleteById</span></code>など)は、<code class="docutils literal notranslate"><span class="pre">JpaRepository</span></code>インタフェースに定義済みであるため、<code class="docutils literal notranslate"><span class="pre">TodoRepository</span></code>には<code class="docutils literal notranslate"><span class="pre">countByFinished</span></code>メソッドのみ定義すればよい。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">countByFinished</span></code>メソッドを呼び出した際に実行するJPQLを、<code class="docutils literal notranslate"><span class="pre">&#64;Query</span></code>アノテーションで指定する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">(2)で指定したJPQL内のバインド変数に対応するメソッド引数に、<code class="docutils literal notranslate"><span class="pre">&#64;Param</span></code>アノテーションを指定する。</div>
<div class="line">ここでは、JPQL中の<code class="docutils literal notranslate"><span class="pre">”:finished”</span></code>に値を埋め込むために、メソッド引数の<code class="docutils literal notranslate"><span class="pre">finished</span></code>に<code class="docutils literal notranslate"><span class="pre">&#64;Param(“finished”)</span></code>を付けている。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id43">
<h4><a class="toc-backref" href="#id97" role="doc-backlink"><span class="section-number">11.2.6.4.3. </span>TodoRepositoryImplの作成</a><a class="headerlink" href="#id43" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">Spring Data JPAを使用する場合、RepositoryImplはRepositoryインタフェースから自動生成される。そのため、<code class="docutils literal notranslate"><span class="pre">TodoRepositoryImpl</span></code>の作成は不要である。作成した場合は削除すること。</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>当ページをはじめから順に実施した場合、<code class="docutils literal notranslate"><span class="pre">TodoRepositoryImpl</span></code>の削除が必要になるが、削除したタイミングで<code class="docutils literal notranslate"><span class="pre">TodoServiceImpl</span></code>がコンパイルエラーとなる。</p>
<p>JPA用のメソッドに切り替える必要があるため、ソースコード内のコメントを参考に<code class="docutils literal notranslate"><span class="pre">create</span></code>メソッドと<code class="docutils literal notranslate"><span class="pre">update</span></code>メソッドを<code class="docutils literal notranslate"><span class="pre">save</span></code>メソッドへ変更する必要がある。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>以上で、Spring Data JPAを使用したインフラストラクチャ層の作成が完了したので、Service及びアプリケーション層の作成を行う。</p>
<p>Service及びアプリケーション層を作成後にAPサーバーを起動し、Todoの表示を行うと、以下のようなSQLログや、トランザクションログが出力される。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">date:2022-11-29 17:42:58      thread:http-nio-8080-exec-4     X-Track:67bbe0a8a3e8416baf91d5dcd73273e8        level:TRACE     logger:o.t.gfw.web.logging.TraceLoggingInterceptor      message:[START CONTROLLER] TodoController.list(Model)</span>
<span class="go">date:2022-11-29 17:42:58      thread:http-nio-8080-exec-4     X-Track:67bbe0a8a3e8416baf91d5dcd73273e8        level:DEBUG     logger:o.h.engine.transaction.internal.TransactionImpl  message:On TransactionImpl creation, JpaCompliance#isJpaTransactionComplianceEnabled == false</span>
<span class="go">date:2022-11-29 17:42:58      thread:http-nio-8080-exec-4     X-Track:67bbe0a8a3e8416baf91d5dcd73273e8        level:DEBUG     logger:o.h.engine.transaction.internal.TransactionImpl  message:begin</span>
<span class="go">date:2022-11-29 17:42:58      thread:http-nio-8080-exec-4     X-Track:67bbe0a8a3e8416baf91d5dcd73273e8        level:DEBUG     logger:org.hibernate.SQL                                message:/* &lt;criteria&gt; */ select t1_0.todo_id,t1_0.created_at,t1_0.finished,t1_0.todo_title from todo t1_0</span>
<span class="go">date:2022-11-29 17:42:58      thread:http-nio-8080-exec-4     X-Track:67bbe0a8a3e8416baf91d5dcd73273e8        level:DEBUG     logger:o.h.engine.transaction.internal.TransactionImpl  message:committing</span>
<span class="go">date:2022-11-29 17:42:58      thread:http-nio-8080-exec-4     X-Track:67bbe0a8a3e8416baf91d5dcd73273e8        level:TRACE     logger:o.t.gfw.web.logging.TraceLoggingInterceptor      message:[END CONTROLLER  ] TodoController.list(Model)-&gt; view=todo/list, model={todoForm=com.example.todo.app.todo.TodoForm@5fcdd91a, todos=[], org.springframework.validation.BindingResult.todoForm=org.springframework.validation.BeanPropertyBindingResult: 0 errors}</span>
<span class="go">date:2022-11-29 17:42:58      thread:http-nio-8080-exec-4     X-Track:67bbe0a8a3e8416baf91d5dcd73273e8        level:TRACE     logger:o.t.gfw.web.logging.TraceLoggingInterceptor      message:[HANDLING TIME   ] TodoController.list(Model)-&gt; 247,911,500 ns</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
</section>
<section id="id44">
<h2><a class="toc-backref" href="#id98" role="doc-backlink"><span class="section-number">11.2.7. </span>おわりに</a><a class="headerlink" href="#id44" title="Permalink to this heading">¶</a></h2>
<p>このチュートリアルでは、以下の内容を学習した。</p>
<ul class="simple">
<li><p>TERASOLUNA Server Framework for Java (5.x)による基本的なアプリケーションの開発方法</p></li>
<li><p>MavenおよびSTS(Eclipse)プロジェクトの構築方法</p></li>
<li><p>TERASOLUNA Server Framework for Java (5.x)のアプリケーションのレイヤ化に従った開発方法</p>
<ul>
<li><p>POJO(+ Spring)を使用したドメイン層の実装</p></li>
<li><p>POJO(+ Spring MVC)とThymeleafを使用したアプリケーション層の実装</p></li>
<li><p>MyBatis3を使用したインフラストラクチャ層の実装</p></li>
<li><p>Spring Data JPAを使用したインフラストラクチャ層の実装</p></li>
<li><p>O/R Mapperを使用しないインフラストラクチャ層の実装</p></li>
</ul>
</li>
</ul>
<p>本チュートリアルで作成したTODO管理アプリケーションには、以下の改善点がある。アプリケーションの修正を学習課題として、ガイドライン中の該当する説明を参照されたい。</p>
<ul class="simple">
<li><p>プロパティ(未完了TODOの上限数)を外部化する → <a class="reference internal" href="../ArchitectureInDetail/GeneralFuncDetail/PropertyManagement.html"><span class="doc">プロパティ管理</span></a></p></li>
<li><p>メッセージを外部化する → <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/MessageManagement.html"><span class="doc">メッセージ管理</span></a></p></li>
<li><p>ページネーション機能を追加する → <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Pagination.html"><span class="doc">ページネーション</span></a></p></li>
<li><p>例外ハンドリングを加える → <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/ExceptionHandling.html"><span class="doc">例外ハンドリング</span></a></p></li>
<li><p>二重送信を防止する(トランザクショントークンチェックを追加する) → <a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/DoubleSubmitProtection.html"><span class="doc">二重送信防止</span></a></p></li>
<li><p>システム日時の取得元を変更する → <a class="reference internal" href="../ArchitectureInDetail/GeneralFuncDetail/SystemDate.html"><span class="doc">システム時刻</span></a></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="appendix">
<h2><a class="toc-backref" href="#id99" role="doc-backlink"><span class="section-number">11.2.8. </span>Appendix</a><a class="headerlink" href="#appendix" title="Permalink to this heading">¶</a></h2>
<section id="tutorialtodoappendixexpoundconfigurations-thymeleaf">
<span id="id45"></span><h3><a class="toc-backref" href="#id100" role="doc-backlink"><span class="section-number">11.2.8.1. </span>設定ファイルの解説</a><a class="headerlink" href="#tutorialtodoappendixexpoundconfigurations-thymeleaf" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line">アプリケーションを動かすためにどのような設定が必要なのかを理解するために、設定ファイルの解説を行う。</div>
<div class="line">ここでは、チュートリアルで作成するTodoアプリケーションで使用しない設定については、解説を割愛している箇所がある。</div>
<div class="line"><br /></div>
</div>
<section id="web-xml">
<h4><a class="toc-backref" href="#id101" role="doc-backlink"><span class="section-number">11.2.8.1.1. </span>web.xml</a><a class="headerlink" href="#web-xml" title="Permalink to this heading">¶</a></h4>
<p><code class="file docutils literal notranslate"><span class="pre">web.xml</span></code>には、WebアプリケーションとしてTodoアプリをデプロイするための設定を行う。</p>
<p>作成したブランクプロジェクトの<code class="file docutils literal notranslate"><span class="pre">src/main/webapp/WEB-INF/web.xml</span></code>は、以下のような設定となっている。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-6-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-6-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-6-WG1sIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-6-WG1sIENvbmZpZw==" name="WG1sIENvbmZpZw==" role="tab" tabindex="-1">Xml Config</button></div><div aria-labelledby="tab-6-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-6-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cm">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;web-app</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;https://jakarta.ee/xml/ns/jakartaee&quot;</span>
<span class="w">    </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="w">    </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;https://jakarta.ee/xml/ns/jakartaee https://jakarta.ee/xml/ns/jakartaee/web-app_6_0.xsd&quot;</span>
<span class="w">    </span><span class="na">version=</span><span class="s">&quot;6.0&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;context-param&gt;</span>
<span class="w">        </span><span class="nt">&lt;param-name&gt;</span>logbackDisableServletContainerInitializer<span class="nt">&lt;/param-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;param-value&gt;</span>true<span class="nt">&lt;/param-value&gt;</span>
<span class="w">    </span><span class="nt">&lt;/context-param&gt;</span>

<span class="w">    </span><span class="nt">&lt;context-param&gt;</span>
<span class="w">        </span><span class="nt">&lt;param-name&gt;</span>contextClass<span class="nt">&lt;/param-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;param-value&gt;</span>
<span class="w">            </span>org.springframework.web.context.support.AnnotationConfigWebApplicationContext
<span class="w">        </span><span class="nt">&lt;/param-value&gt;</span>
<span class="w">    </span><span class="nt">&lt;/context-param&gt;</span>

<span class="w">    </span><span class="nt">&lt;listener&gt;</span>
<span class="w">        </span><span class="nt">&lt;listener-class&gt;</span>ch.qos.logback.classic.servlet.LogbackServletContextListener<span class="nt">&lt;/listener-class&gt;</span>
<span class="w">    </span><span class="nt">&lt;/listener&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;listener&gt;</span>
<span class="w">        </span><span class="nt">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="nt">&lt;/listener-class&gt;</span>
<span class="w">    </span><span class="nt">&lt;/listener&gt;</span>
<span class="w">    </span><span class="nt">&lt;context-param&gt;</span>
<span class="w">        </span><span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- Root ApplicationContext --&gt;</span>
<span class="w">        </span><span class="nt">&lt;param-value&gt;</span>
<span class="w">            </span>com.example.todo.config.app.ApplicationContextConfig
<span class="w">            </span>com.example.todo.config.web.SpringSecurityConfig
<span class="w">        </span><span class="nt">&lt;/param-value&gt;</span>
<span class="w">    </span><span class="nt">&lt;/context-param&gt;</span>

<span class="w">    </span><span class="nt">&lt;listener&gt;</span>
<span class="w">        </span><span class="nt">&lt;listener-class&gt;</span>org.terasoluna.gfw.web.logging.HttpSessionEventLoggingListener<span class="nt">&lt;/listener-class&gt;</span>
<span class="w">    </span><span class="nt">&lt;/listener&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (3) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-name&gt;</span>MDCClearFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-class&gt;</span>org.terasoluna.gfw.web.logging.mdc.MDCClearFilter<span class="nt">&lt;/filter-class&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter-mapping&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-name&gt;</span>MDCClearFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter-mapping&gt;</span>

<span class="w">    </span><span class="nt">&lt;filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-name&gt;</span>exceptionLoggingFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="nt">&lt;/filter-class&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter-mapping&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-name&gt;</span>exceptionLoggingFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter-mapping&gt;</span>

<span class="w">    </span><span class="nt">&lt;filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-name&gt;</span>XTrackMDCPutFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-class&gt;</span>org.terasoluna.gfw.web.logging.mdc.XTrackMDCPutFilter<span class="nt">&lt;/filter-class&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter-mapping&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-name&gt;</span>XTrackMDCPutFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter-mapping&gt;</span>

<span class="w">    </span><span class="nt">&lt;filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-name&gt;</span>CharacterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="nt">&lt;/filter-class&gt;</span>
<span class="w">        </span><span class="nt">&lt;init-param&gt;</span>
<span class="w">            </span><span class="nt">&lt;param-name&gt;</span>encoding<span class="nt">&lt;/param-name&gt;</span>
<span class="w">            </span><span class="nt">&lt;param-value&gt;</span>UTF-8<span class="nt">&lt;/param-value&gt;</span>
<span class="w">        </span><span class="nt">&lt;/init-param&gt;</span>
<span class="w">        </span><span class="nt">&lt;init-param&gt;</span>
<span class="w">            </span><span class="nt">&lt;param-name&gt;</span>forceEncoding<span class="nt">&lt;/param-name&gt;</span>
<span class="w">            </span><span class="nt">&lt;param-value&gt;</span>true<span class="nt">&lt;/param-value&gt;</span>
<span class="w">        </span><span class="nt">&lt;/init-param&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter-mapping&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-name&gt;</span>CharacterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter-mapping&gt;</span>

<span class="w">    </span><span class="nt">&lt;filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="nt">&lt;/filter-class&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter-mapping&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter-mapping&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (4) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;servlet&gt;</span>
<span class="w">        </span><span class="nt">&lt;servlet-name&gt;</span>appServlet<span class="nt">&lt;/servlet-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
<span class="w">        </span><span class="nt">&lt;init-param&gt;</span>
<span class="w">            </span><span class="nt">&lt;param-name&gt;</span>contextClass<span class="nt">&lt;/param-name&gt;</span>
<span class="w">            </span><span class="nt">&lt;param-value&gt;</span>
<span class="w">                </span>org.springframework.web.context.support.AnnotationConfigWebApplicationContext
<span class="w">            </span><span class="nt">&lt;/param-value&gt;</span>
<span class="w">        </span><span class="nt">&lt;/init-param&gt;</span>
<span class="w">        </span><span class="nt">&lt;init-param&gt;</span>
<span class="w">            </span><span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
<span class="w">            </span><span class="cm">&lt;!-- ApplicationContext for Spring MVC --&gt;</span>
<span class="w">            </span><span class="nt">&lt;param-value&gt;</span>com.example.todo.config.web.SpringMvcConfig<span class="nt">&lt;/param-value&gt;</span>
<span class="w">        </span><span class="nt">&lt;/init-param&gt;</span>
<span class="w">        </span><span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
<span class="w">    </span><span class="nt">&lt;/servlet&gt;</span>
<span class="w">    </span><span class="nt">&lt;servlet-mapping&gt;</span>
<span class="w">        </span><span class="nt">&lt;servlet-name&gt;</span>appServlet<span class="nt">&lt;/servlet-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
<span class="w">    </span><span class="nt">&lt;/servlet-mapping&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (5) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;error-page&gt;</span>
<span class="w">        </span><span class="nt">&lt;error-code&gt;</span>500<span class="nt">&lt;/error-code&gt;</span>
<span class="w">        </span><span class="nt">&lt;location&gt;</span>/common/error/systemError<span class="nt">&lt;/location&gt;</span>
<span class="w">    </span><span class="nt">&lt;/error-page&gt;</span>

<span class="w">    </span><span class="nt">&lt;error-page&gt;</span>
<span class="w">        </span><span class="nt">&lt;error-code&gt;</span>404<span class="nt">&lt;/error-code&gt;</span>
<span class="w">        </span><span class="nt">&lt;location&gt;</span>/common/error/resourceNotFoundError<span class="nt">&lt;/location&gt;</span>
<span class="w">    </span><span class="nt">&lt;/error-page&gt;</span>

<span class="w">    </span><span class="nt">&lt;error-page&gt;</span>
<span class="w">        </span><span class="nt">&lt;exception-type&gt;</span>java.lang.Exception<span class="nt">&lt;/exception-type&gt;</span>
<span class="w">        </span><span class="nt">&lt;location&gt;</span>/WEB-INF/views/common/error/unhandledSystemError.html<span class="nt">&lt;/location&gt;</span>
<span class="w">    </span><span class="nt">&lt;/error-page&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (6) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;session-config&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- 30min --&gt;</span>
<span class="w">        </span><span class="nt">&lt;session-timeout&gt;</span>30<span class="nt">&lt;/session-timeout&gt;</span>
<span class="w">        </span><span class="nt">&lt;cookie-config&gt;</span>
<span class="w">            </span><span class="nt">&lt;http-only&gt;</span>true<span class="nt">&lt;/http-only&gt;</span>
<span class="w">            </span><span class="cm">&lt;!-- &lt;secure&gt;true&lt;/secure&gt; --&gt;</span>
<span class="w">        </span><span class="nt">&lt;/cookie-config&gt;</span>
<span class="w">        </span><span class="nt">&lt;tracking-mode&gt;</span>COOKIE<span class="nt">&lt;/tracking-mode&gt;</span>
<span class="w">    </span><span class="nt">&lt;/session-config&gt;</span>

<span class="nt">&lt;/web-app&gt;</span>
</pre></div>
</div>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Servlet6.0を使用するための宣言。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">サーブレットコンテキストリスナーの定義。</div>
</div>
<p>ブランクプロジェクトでは、</p>
<ul class="simple">
<li><p>アプリケーション全体で使用される<code class="docutils literal notranslate"><span class="pre">ApplicationContext</span></code>を作成するための<code class="docutils literal notranslate"><span class="pre">ContextLoaderListener</span></code></p></li>
<li><p>HttpSessionに対する操作をログ出力するための <code class="docutils literal notranslate"><span class="pre">HttpSessionEventLoggingListener</span></code></p></li>
</ul>
<p>が設定済みである。</p>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">サーブレットフィルタの定義。</div>
</div>
<p>ブランクプロジェクトでは、</p>
<ul class="simple">
<li><p>共通ライブラリから提供しているサーブレットフィルタ</p></li>
<li><p>Spring Frameworkから提供されている文字エンコーディングを指定するための<code class="docutils literal notranslate"><span class="pre">CharacterEncodingFilter</span></code></p></li>
<li><p>Spring Securityから提供されている認証・認可用のサーブレットフィルタ</p></li>
</ul>
<p>が設定済みである。</p>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Spring MVCのエントリポイントとなるDispatcherServletの定義。</div>
<div class="line"><br /></div>
<div class="line">DispatcherServletの中で使用する<code class="docutils literal notranslate"><span class="pre">ApplicationContext</span></code>を、(2)で作成した<code class="docutils literal notranslate"><span class="pre">ApplicationContext</span></code>の子として作成する。</div>
<div class="line">(2)で作成した<code class="docutils literal notranslate"><span class="pre">ApplicationContext</span></code>を親にすることで、(2)で読み込まれたコンポーネントも使用することができる。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">エラーページの定義。</div>
</div>
<p>ブランクプロジェクトでは、</p>
<ul class="simple">
<li><p>サーブレットコンテナにHTTPステータスコードとして、<code class="docutils literal notranslate"><span class="pre">404</span></code>又は<code class="docutils literal notranslate"><span class="pre">500</span></code>が応答</p></li>
<li><p>サーブレットコンテナに例外が通知</p></li>
</ul>
<p>された際の遷移先が定義済みである。</p>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">セッション管理の定義。</div>
</div>
<p>ブランクプロジェクトでは、</p>
<ul class="simple">
<li><p>セッションタイムアウトとして、30分</p></li>
</ul>
<p>が定義済みである。</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div><div aria-labelledby="tab-6-WG1sIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-6-WG1sIENvbmZpZw==" name="WG1sIENvbmZpZw==" role="tabpanel" tabindex="0"><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cm">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;web-app</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;https://jakarta.ee/xml/ns/jakartaee&quot;</span>
<span class="w">    </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="w">    </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;https://jakarta.ee/xml/ns/jakartaee https://jakarta.ee/xml/ns/jakartaee/web-app_6_0.xsd&quot;</span>
<span class="w">    </span><span class="na">version=</span><span class="s">&quot;6.0&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;context-param&gt;</span>
<span class="w">        </span><span class="nt">&lt;param-name&gt;</span>logbackDisableServletContainerInitializer<span class="nt">&lt;/param-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;param-value&gt;</span>true<span class="nt">&lt;/param-value&gt;</span>
<span class="w">    </span><span class="nt">&lt;/context-param&gt;</span>

<span class="w">    </span><span class="nt">&lt;listener&gt;</span>
<span class="w">        </span><span class="nt">&lt;listener-class&gt;</span>ch.qos.logback.classic.servlet.LogbackServletContextListener<span class="nt">&lt;/listener-class&gt;</span>
<span class="w">    </span><span class="nt">&lt;/listener&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;listener&gt;</span>
<span class="w">        </span><span class="nt">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="nt">&lt;/listener-class&gt;</span>
<span class="w">    </span><span class="nt">&lt;/listener&gt;</span>
<span class="w">    </span><span class="nt">&lt;context-param&gt;</span>
<span class="w">        </span><span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- Root ApplicationContext --&gt;</span>
<span class="w">        </span><span class="nt">&lt;param-value&gt;</span>
<span class="w">            </span>classpath*:META-INF/spring/applicationContext.xml
<span class="w">            </span>classpath*:META-INF/spring/spring-security.xml
<span class="w">        </span><span class="nt">&lt;/param-value&gt;</span>
<span class="w">    </span><span class="nt">&lt;/context-param&gt;</span>

<span class="w">    </span><span class="nt">&lt;listener&gt;</span>
<span class="w">        </span><span class="nt">&lt;listener-class&gt;</span>org.terasoluna.gfw.web.logging.HttpSessionEventLoggingListener<span class="nt">&lt;/listener-class&gt;</span>
<span class="w">    </span><span class="nt">&lt;/listener&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (3) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-name&gt;</span>MDCClearFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-class&gt;</span>org.terasoluna.gfw.web.logging.mdc.MDCClearFilter<span class="nt">&lt;/filter-class&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter-mapping&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-name&gt;</span>MDCClearFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter-mapping&gt;</span>

<span class="w">    </span><span class="nt">&lt;filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-name&gt;</span>exceptionLoggingFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="nt">&lt;/filter-class&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter-mapping&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-name&gt;</span>exceptionLoggingFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter-mapping&gt;</span>

<span class="w">    </span><span class="nt">&lt;filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-name&gt;</span>XTrackMDCPutFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-class&gt;</span>org.terasoluna.gfw.web.logging.mdc.XTrackMDCPutFilter<span class="nt">&lt;/filter-class&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter-mapping&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-name&gt;</span>XTrackMDCPutFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter-mapping&gt;</span>

<span class="w">    </span><span class="nt">&lt;filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-name&gt;</span>CharacterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="nt">&lt;/filter-class&gt;</span>
<span class="w">        </span><span class="nt">&lt;init-param&gt;</span>
<span class="w">            </span><span class="nt">&lt;param-name&gt;</span>encoding<span class="nt">&lt;/param-name&gt;</span>
<span class="w">            </span><span class="nt">&lt;param-value&gt;</span>UTF-8<span class="nt">&lt;/param-value&gt;</span>
<span class="w">        </span><span class="nt">&lt;/init-param&gt;</span>
<span class="w">        </span><span class="nt">&lt;init-param&gt;</span>
<span class="w">            </span><span class="nt">&lt;param-name&gt;</span>forceEncoding<span class="nt">&lt;/param-name&gt;</span>
<span class="w">            </span><span class="nt">&lt;param-value&gt;</span>true<span class="nt">&lt;/param-value&gt;</span>
<span class="w">        </span><span class="nt">&lt;/init-param&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter-mapping&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-name&gt;</span>CharacterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter-mapping&gt;</span>

<span class="w">    </span><span class="nt">&lt;filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="nt">&lt;/filter-class&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter-mapping&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter-mapping&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (4) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;servlet&gt;</span>
<span class="w">        </span><span class="nt">&lt;servlet-name&gt;</span>appServlet<span class="nt">&lt;/servlet-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
<span class="w">        </span><span class="nt">&lt;init-param&gt;</span>
<span class="w">            </span><span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
<span class="w">            </span><span class="cm">&lt;!-- ApplicationContext for Spring MVC --&gt;</span>
<span class="w">            </span><span class="nt">&lt;param-value&gt;</span>classpath*:META-INF/spring/spring-mvc.xml<span class="nt">&lt;/param-value&gt;</span>
<span class="w">        </span><span class="nt">&lt;/init-param&gt;</span>
<span class="w">        </span><span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
<span class="w">    </span><span class="nt">&lt;/servlet&gt;</span>
<span class="w">    </span><span class="nt">&lt;servlet-mapping&gt;</span>
<span class="w">        </span><span class="nt">&lt;servlet-name&gt;</span>appServlet<span class="nt">&lt;/servlet-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
<span class="w">    </span><span class="nt">&lt;/servlet-mapping&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (5) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;error-page&gt;</span>
<span class="w">        </span><span class="nt">&lt;error-code&gt;</span>500<span class="nt">&lt;/error-code&gt;</span>
<span class="w">        </span><span class="nt">&lt;location&gt;</span>/common/error/systemError<span class="nt">&lt;/location&gt;</span>
<span class="w">    </span><span class="nt">&lt;/error-page&gt;</span>

<span class="w">    </span><span class="nt">&lt;error-page&gt;</span>
<span class="w">        </span><span class="nt">&lt;error-code&gt;</span>404<span class="nt">&lt;/error-code&gt;</span>
<span class="w">        </span><span class="nt">&lt;location&gt;</span>/common/error/resourceNotFoundError<span class="nt">&lt;/location&gt;</span>
<span class="w">    </span><span class="nt">&lt;/error-page&gt;</span>

<span class="w">    </span><span class="nt">&lt;error-page&gt;</span>
<span class="w">        </span><span class="nt">&lt;exception-type&gt;</span>java.lang.Exception<span class="nt">&lt;/exception-type&gt;</span>
<span class="w">        </span><span class="nt">&lt;location&gt;</span>/WEB-INF/views/common/error/unhandledSystemError.html<span class="nt">&lt;/location&gt;</span>
<span class="w">    </span><span class="nt">&lt;/error-page&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (6) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;session-config&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- 30min --&gt;</span>
<span class="w">        </span><span class="nt">&lt;session-timeout&gt;</span>30<span class="nt">&lt;/session-timeout&gt;</span>
<span class="w">        </span><span class="nt">&lt;cookie-config&gt;</span>
<span class="w">            </span><span class="nt">&lt;http-only&gt;</span>true<span class="nt">&lt;/http-only&gt;</span>
<span class="w">            </span><span class="cm">&lt;!-- &lt;secure&gt;true&lt;/secure&gt; --&gt;</span>
<span class="w">        </span><span class="nt">&lt;/cookie-config&gt;</span>
<span class="w">        </span><span class="nt">&lt;tracking-mode&gt;</span>COOKIE<span class="nt">&lt;/tracking-mode&gt;</span>
<span class="w">    </span><span class="nt">&lt;/session-config&gt;</span>

<span class="nt">&lt;/web-app&gt;</span>
</pre></div>
</div>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Servlet6.0を使用するための宣言。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">サーブレットコンテキストリスナーの定義。</div>
</div>
<p>ブランクプロジェクトでは、</p>
<ul class="simple">
<li><p>アプリケーション全体で使用される<code class="docutils literal notranslate"><span class="pre">ApplicationContext</span></code>を作成するための<code class="docutils literal notranslate"><span class="pre">ContextLoaderListener</span></code></p></li>
<li><p>HttpSessionに対する操作をログ出力するための <code class="docutils literal notranslate"><span class="pre">HttpSessionEventLoggingListener</span></code></p></li>
</ul>
<p>が設定済みである。</p>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">サーブレットフィルタの定義。</div>
</div>
<p>ブランクプロジェクトでは、</p>
<ul class="simple">
<li><p>共通ライブラリから提供しているサーブレットフィルタ</p></li>
<li><p>Spring Frameworkから提供されている文字エンコーディングを指定するための<code class="docutils literal notranslate"><span class="pre">CharacterEncodingFilter</span></code></p></li>
<li><p>Spring Securityから提供されている認証・認可用のサーブレットフィルタ</p></li>
</ul>
<p>が設定済みである。</p>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Spring MVCのエントリポイントとなるDispatcherServletの定義。</div>
<div class="line"><br /></div>
<div class="line">DispatcherServletの中で使用する<code class="docutils literal notranslate"><span class="pre">ApplicationContext</span></code>を、(2)で作成した<code class="docutils literal notranslate"><span class="pre">ApplicationContext</span></code>の子として作成する。</div>
<div class="line">(2)で作成した<code class="docutils literal notranslate"><span class="pre">ApplicationContext</span></code>を親にすることで、(2)で読み込まれたコンポーネントも使用することができる。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">エラーページの定義。</div>
</div>
<p>ブランクプロジェクトでは、</p>
<ul class="simple">
<li><p>サーブレットコンテナにHTTPステータスコードとして、<code class="docutils literal notranslate"><span class="pre">404</span></code>又は<code class="docutils literal notranslate"><span class="pre">500</span></code>が応答</p></li>
<li><p>サーブレットコンテナに例外が通知</p></li>
</ul>
<p>された際の遷移先が定義済みである。</p>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">セッション管理の定義。</div>
</div>
<p>ブランクプロジェクトでは、</p>
<ul class="simple">
<li><p>セッションタイムアウトとして、30分</p></li>
</ul>
<p>が定義済みである。</p>
</td>
</tr>
</tbody>
</table>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="bean">
<h4><a class="toc-backref" href="#id102" role="doc-backlink"><span class="section-number">11.2.8.1.2. </span>Bean定義ファイル</a><a class="headerlink" href="#bean" title="Permalink to this heading">¶</a></h4>
<p>作成したブランクプロジェクトには、以下のBean定義ファイルとプロパティファイルが作成される。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-7-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-7-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-7-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-7-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-7-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-7-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><ul class="simple">
<li><p><code class="file docutils literal notranslate"><span class="pre">src/main/java/com/example/todo/config/app/ApplicationContextConfig.java</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">src/main/java/com/example/todo/config/app/TodoCodeListConfig.java</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">src/main/java/com/example/todo/config/app/TodoDomainConfig.java</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">src/main/java/com/example/todo/config/app/TodoInfraConfig.java</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">src/main/resources/META-INF/spring/todo-infra.properties</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">src/main/java/com/example/todo/config/app/TodoEnvConfig.java</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">src/main/java/com/example/todo/config/web/SpringMvcConfig.java</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">src/main/java/com/example/todo/config/web/SpringSecurityConfig.java</span></code></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>O/R Mapperに依存しないブランクプロジェクトを作成した場合は、<code class="docutils literal notranslate"><span class="pre">todo-infra.properties</span></code>と<code class="docutils literal notranslate"><span class="pre">TodoEnvConfig.java</span></code>は作成されない。</p>
</div>
</div><div aria-labelledby="tab-7-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-7-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><ul class="simple">
<li><p><code class="file docutils literal notranslate"><span class="pre">src/main/resources/META-INF/spring/applicationContext.xml</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">src/main/resources/META-INF/spring/todo-codelist.xml</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">src/main/resources/META-INF/spring/todo-domain.xml</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">src/main/resources/META-INF/spring/todo-infra.xml</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">src/main/resources/META-INF/spring/todo-infra.properties</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">src/main/resources/META-INF/spring/todo-env.xml</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">src/main/resources/META-INF/spring/spring-mvc.xml</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">src/main/resources/META-INF/spring/spring-security.xml</span></code></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>O/R Mapperに依存しないブランクプロジェクトを作成した場合は、<code class="docutils literal notranslate"><span class="pre">todo-infra.properties</span></code>と<code class="docutils literal notranslate"><span class="pre">todo-env.xml</span></code>は作成されない。</p>
</div>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>本ガイドラインでは、Bean定義ファイルを役割(層)ごとにファイルを分割することを推奨している。</p>
<p>これは、どこに何が定義されているか想像しやすく、メンテナンス性が向上するからである。今回のチュートリアルのような小さなアプリケーションでは効果はないが、アプリケーションの規模が大きくなるにつれ、効果が大きくなる。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="applicationcontext">
<h5><span class="section-number">11.2.8.1.2.1. </span>applicationContext<a class="headerlink" href="#applicationcontext" title="Permalink to this heading">¶</a></h5>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-8-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-8-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-8-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-8-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-8-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-8-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><p><code class="file docutils literal notranslate"><span class="pre">ApplicationContextConfig.java</span></code>には、Todoアプリ全体に関わる設定を行う。</p>
<div class="line-block">
<div class="line">作成したブランクプロジェクトの<code class="file docutils literal notranslate"><span class="pre">src/main/java/com/example/todo/config/app/ApplicationContextConfig.java</span></code> は、以下のような設定となっている。</div>
<div class="line">なお、チュートリアルで使用しないコンポーネントについての説明は割愛する。</div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.config.app</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.HashMap</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.LinkedHashMap</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Map</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Value</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.MessageSource</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.EnableAspectJAutoProxy</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Import</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.support.PropertySourcesPlaceholderConfigurer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.support.ResourceBundleMessageSource</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.core.io.Resource</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.crypto.password.DelegatingPasswordEncoder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.crypto.password.PasswordEncoder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.crypto.password.Pbkdf2PasswordEncoder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.exception.ExceptionCodeResolver</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.exception.ExceptionLogger</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.exception.SimpleMappingExceptionCodeResolver</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.web.exception.ExceptionLoggingFilter</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Application context.</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="nd">@EnableAspectJAutoProxy</span>
<span class="nd">@Import</span><span class="p">({</span><span class="w"> </span><span class="n">TodoDomainConfig</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ApplicationContextConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link PasswordEncoder} bean.</span>
<span class="cm">     * @return Bean of configured {@link DelegatingPasswordEncoder}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;passwordEncoder&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">PasswordEncoder</span><span class="w"> </span><span class="nf">passwordEncoder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">PasswordEncoder</span><span class="o">&gt;</span><span class="w"> </span><span class="n">idToPasswordEncoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="n">idToPasswordEncoder</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;pbkdf2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pbkdf2PasswordEncoder</span><span class="p">());</span>
<span class="w">        </span><span class="n">idToPasswordEncoder</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;bcrypt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">bCryptPasswordEncoder</span><span class="p">());</span>
<span class="w">        </span><span class="cm">/* When using commented out PasswordEncoders, you need to add bcprov-jdk18on.jar to the dependency.</span>
<span class="cm">        idToPasswordEncoder.put(&quot;argon2&quot;, argon2PasswordEncoder());</span>
<span class="cm">        idToPasswordEncoder.put(&quot;scrypt&quot;, sCryptPasswordEncoder());</span>
<span class="cm">        */</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DelegatingPasswordEncoder</span><span class="p">(</span><span class="s">&quot;pbkdf2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">idToPasswordEncoder</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link Pbkdf2PasswordEncoder} bean.</span>
<span class="cm">     * @return Bean of configured {@link Pbkdf2PasswordEncoder}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Pbkdf2PasswordEncoder</span><span class="w"> </span><span class="nf">pbkdf2PasswordEncoder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Pbkdf2PasswordEncoder</span><span class="p">.</span><span class="na">defaultsForSpringSecurity_v5_8</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link BCryptPasswordEncoder} bean.</span>
<span class="cm">     * @return Bean of configured {@link BCryptPasswordEncoder}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BCryptPasswordEncoder</span><span class="w"> </span><span class="nf">bCryptPasswordEncoder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BCryptPasswordEncoder</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/* When using commented out PasswordEncoders, you need to add bcprov-jdk18on.jar to the dependency.</span>
<span class="cm">    @Bean</span>
<span class="cm">    public Argon2PasswordEncoder argon2PasswordEncoder() {</span>
<span class="cm">        return Argon2PasswordEncoder.defaultsForSpringSecurity_v5_8();</span>
<span class="cm">    }</span>
<span class="cm">    @Bean</span>
<span class="cm">    public SCryptPasswordEncoder sCryptPasswordEncoder() {</span>
<span class="cm">        return SCryptPasswordEncoder.defaultsForSpringSecurity_v5_8();</span>
<span class="cm">    }</span>
<span class="cm">    */</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link PropertySourcesPlaceholderConfigurer} bean.</span>
<span class="cm">     * @param properties Property files to be read</span>
<span class="cm">     * @return Bean of configured {@link PropertySourcesPlaceholderConfigurer}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">PropertySourcesPlaceholderConfigurer</span><span class="w"> </span><span class="nf">propertySourcesPlaceholderConfigurer</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;classpath*:/META-INF/spring/*.properties&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">Resource</span><span class="p">...</span><span class="w"> </span><span class="n">properties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">PropertySourcesPlaceholderConfigurer</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PropertySourcesPlaceholderConfigurer</span><span class="p">();</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setLocations</span><span class="p">(</span><span class="n">properties</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link MessageSource} bean.</span>
<span class="cm">     * @return Bean of configured {@link ResourceBundleMessageSource}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;messageSource&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">MessageSource</span><span class="w"> </span><span class="nf">messageSource</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ResourceBundleMessageSource</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResourceBundleMessageSource</span><span class="p">();</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setBasenames</span><span class="p">(</span><span class="s">&quot;i18n/application-messages&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link ExceptionCodeResolver} bean.</span>
<span class="cm">     * @return Bean of configured {@link SimpleMappingExceptionCodeResolver}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;exceptionCodeResolver&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ExceptionCodeResolver</span><span class="w"> </span><span class="nf">exceptionCodeResolver</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">LinkedHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LinkedHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;ResourceNotFoundException&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;e.xx.fw.5001&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;InvalidTransactionTokenException&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;e.xx.fw.7001&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;BusinessException&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;e.xx.fw.8001&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;.DataAccessException&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;e.xx.fw.9002&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">SimpleMappingExceptionCodeResolver</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleMappingExceptionCodeResolver</span><span class="p">();</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setExceptionMappings</span><span class="p">(</span><span class="n">map</span><span class="p">);</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setDefaultExceptionCode</span><span class="p">(</span><span class="s">&quot;e.xx.fw.9001&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link ExceptionLogger} bean.</span>
<span class="cm">     * @return Bean of configured {@link ExceptionLogger}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;exceptionLogger&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ExceptionLogger</span><span class="w"> </span><span class="nf">exceptionLogger</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ExceptionLogger</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ExceptionLogger</span><span class="p">();</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setExceptionCodeResolver</span><span class="p">(</span><span class="n">exceptionCodeResolver</span><span class="p">());</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link ExceptionLoggingFilter} bean.</span>
<span class="cm">     * @return Bean of configured {@link ExceptionLoggingFilter}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;exceptionLoggingFilter&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ExceptionLoggingFilter</span><span class="w"> </span><span class="nf">exceptionLoggingFilter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ExceptionLoggingFilter</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ExceptionLoggingFilter</span><span class="p">();</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setExceptionLogger</span><span class="p">(</span><span class="n">exceptionLogger</span><span class="p">());</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ドメイン層に関するBean定義ファイルをimportする。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">プロパティファイルの読み込み設定を行う。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">src/main/resources/META-INF/spring</span></code>直下の任意のプロパティファイルを読み込む。</div>
<div class="line">この設定により、プロパティファイルの値をBean定義ファイル内で<code class="docutils literal notranslate"><span class="pre">${propertyName}</span></code>形式で埋め込んだり、Javaクラスに<code class="docutils literal notranslate"><span class="pre">&#64;Value(&quot;${propertyName}&quot;)</span></code>でインジェクションすることができる。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div><div aria-labelledby="tab-8-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-8-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><p><code class="file docutils literal notranslate"><span class="pre">applicationContext.xml</span></code>には、Todoアプリ全体に関わる設定を行う。</p>
<div class="line-block">
<div class="line">作成したブランクプロジェクトの<code class="file docutils literal notranslate"><span class="pre">src/main/resources/META-INF/spring/applicationContext.xml</span></code>は、以下のような設定となっている。</div>
<div class="line">なお、チュートリアルで使用しないコンポーネントについての説明は割愛する。</div>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
<span class="w">    </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="w">    </span><span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
<span class="w">    </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;</span>
<span class="s">        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">        http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd</span>
<span class="s">    &quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;import</span><span class="w"> </span><span class="na">resource=</span><span class="s">&quot;classpath:/META-INF/spring/todo-domain.xml&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;passwordEncoder&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.springframework.security.crypto.password.DelegatingPasswordEncoder&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;constructor-arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;idForEncode&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;pbkdf2&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;constructor-arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;idToPasswordEncoder&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;map&gt;</span>
<span class="w">                </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;pbkdf2&quot;</span><span class="nt">&gt;</span>
<span class="w">                    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.springframework.security.crypto.password.Pbkdf2PasswordEncoder&quot;</span><span class="w"> </span><span class="na">factory-method=</span><span class="s">&quot;defaultsForSpringSecurity_v5_8&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;/entry&gt;</span>
<span class="w">                </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;bcrypt&quot;</span><span class="nt">&gt;</span>
<span class="w">                    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;/entry&gt;</span>
<span class="w">                </span><span class="cm">&lt;!-- When using commented out PasswordEncoders, you need to add bcprov-jdk18on.jar to the dependency.</span>
<span class="cm">                &lt;entry key=&quot;argon2&quot;&gt;</span>
<span class="cm">                    &lt;bean class=&quot;org.springframework.security.crypto.argon2.Argon2PasswordEncoder&quot; factory-method=&quot;defaultsForSpringSecurity_v5_8&quot; /&gt;</span>
<span class="cm">                &lt;/entry&gt;</span>
<span class="cm">                &lt;entry key=&quot;scrypt&quot;&gt;</span>
<span class="cm">                    &lt;bean class=&quot;org.springframework.security.crypto.scrypt.SCryptPasswordEncoder&quot; factory-method=&quot;defaultsForSpringSecurity_v5_8&quot; /&gt;</span>
<span class="cm">                &lt;/entry&gt;</span>
<span class="cm">                --&gt;</span>
<span class="w">            </span><span class="nt">&lt;/map&gt;</span>
<span class="w">        </span><span class="nt">&lt;/constructor-arg&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;context:property-placeholder</span>
<span class="w">        </span><span class="na">location=</span><span class="s">&quot;classpath*:/META-INF/spring/*.properties&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- Message --&gt;</span>
<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;messageSource&quot;</span>
<span class="w">        </span><span class="na">class=</span><span class="s">&quot;org.springframework.context.support.ResourceBundleMessageSource&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;basenames&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;list&gt;</span>
<span class="w">                </span><span class="nt">&lt;value&gt;</span>i18n/application-messages<span class="nt">&lt;/value&gt;</span>
<span class="w">            </span><span class="nt">&lt;/list&gt;</span>
<span class="w">        </span><span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- Exception Code Resolver. --&gt;</span>
<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;exceptionCodeResolver&quot;</span>
<span class="w">        </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.exception.SimpleMappingExceptionCodeResolver&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- Setting and Customization by project. --&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;exceptionMappings&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;map&gt;</span>
<span class="w">                </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;ResourceNotFoundException&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;e.xx.fw.5001&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;InvalidTransactionTokenException&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;e.xx.fw.7001&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;BusinessException&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;e.xx.fw.8001&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;.DataAccessException&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;e.xx.fw.9002&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/map&gt;</span>
<span class="w">        </span><span class="nt">&lt;/property&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;defaultExceptionCode&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;e.xx.fw.9001&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- Exception Logger. --&gt;</span>
<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;exceptionLogger&quot;</span>
<span class="w">        </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.exception.ExceptionLogger&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;exceptionCodeResolver&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;exceptionCodeResolver&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- Filter. --&gt;</span>
<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;exceptionLoggingFilter&quot;</span>
<span class="w">        </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.exception.ExceptionLoggingFilter&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;exceptionLogger&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;exceptionLogger&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ドメイン層に関するBean定義ファイルをimportする。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">プロパティファイルの読み込み設定を行う。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">src/main/resources/META-INF/spring</span></code>直下の任意のプロパティファイルを読み込む。</div>
<div class="line">この設定により、プロパティファイルの値をBean定義ファイル内で<code class="docutils literal notranslate"><span class="pre">${propertyName}</span></code>形式で埋め込んだり、Javaクラスに<code class="docutils literal notranslate"><span class="pre">&#64;Value(&quot;${propertyName}&quot;)</span></code>でインジェクションすることができる。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>エディタの「Configure Namespaces」タブにて、以下のようにチェックを入れると、チェックしたXMLスキーマが有効になり、XML編集時にCtrl+Spaceを使用して入力を補完することができる。</p>
<p>「Namespace Versions」にはバージョンなしのxsdファイルを選択することを推奨する。バージョンなしのxsdファイルを選択することで、常にjarに含まれる最新のxsdが使用されるため、Springのバージョンアップを意識する必要がなくなる。</p>
<blockquote>
<div><figure class="align-default">
<a class="reference internal image-reference" href="../_images/image0211.jpg"><img alt="../_images/image0211.jpg" src="../_images/image0211.jpg" style="width: 90%;" /></a>
</figure>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/image0231.png"><img alt="../_images/image0231.png" src="../_images/image0231.png" style="width: 60%;" /></a>
</figure>
</div></blockquote>
</div>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="todo-domain">
<h5><span class="section-number">11.2.8.1.2.2. </span>todo-domain<a class="headerlink" href="#todo-domain" title="Permalink to this heading">¶</a></h5>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-9-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-9-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-9-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-9-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-9-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-9-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><p><code class="file docutils literal notranslate"><span class="pre">TodoDomainConfig.java</span></code>には、Todoアプリのドメイン層に関わる設定を行う。</p>
<div class="line-block">
<div class="line">作成したブランクプロジェクトの<code class="file docutils literal notranslate"><span class="pre">src/main/java/com/example/todo/config/app/TodoDomainConfig.java</span></code>は、以下のような設定となっている。</div>
<div class="line">なお、チュートリアルで使用しないコンポーネントについての説明は割愛する。</div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.config.app</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.aop.Advisor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.aop.aspectj.AspectJExpressionPointcut</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.aop.support.DefaultPointcutAdvisor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Import</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.exception.ExceptionLogger</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.exception.ResultMessagesLoggingInterceptor</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Bean definitions for domain layer.</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span><span class="p">(</span><span class="n">basePackages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;com.example.todo.domain&quot;</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="nd">@Import</span><span class="p">({</span><span class="w"> </span><span class="n">TodoInfraConfig</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
<span class="w">    </span><span class="n">TodoCodeListConfig</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoDomainConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure messages logging AOP.</span>
<span class="cm">     * @param exceptionLogger Bean defined by ApplicationContext#exceptionLogger</span>
<span class="cm">     * @see com.example.todo.config.app.ApplicationContext#exceptionLogger()</span>
<span class="cm">     * @return Bean of configured {@link ResultMessagesLoggingInterceptor}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;resultMessagesLoggingInterceptor&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultMessagesLoggingInterceptor</span><span class="w"> </span><span class="nf">resultMessagesLoggingInterceptor</span><span class="p">(</span>
<span class="w">            </span><span class="n">ExceptionLogger</span><span class="w"> </span><span class="n">exceptionLogger</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ResultMessagesLoggingInterceptor</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResultMessagesLoggingInterceptor</span><span class="p">();</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setExceptionLogger</span><span class="p">(</span><span class="n">exceptionLogger</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure messages logging AOP advisor.</span>
<span class="cm">     * @param resultMessagesLoggingInterceptor Bean defined by #resultMessagesLoggingInterceptor</span>
<span class="cm">     * @see #resultMessagesLoggingInterceptor(ExceptionLogger)</span>
<span class="cm">     * @return Advisor configured for PointCut</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Advisor</span><span class="w"> </span><span class="nf">resultMessagesLoggingInterceptorAdvisor</span><span class="p">(</span>
<span class="w">            </span><span class="n">ResultMessagesLoggingInterceptor</span><span class="w"> </span><span class="n">resultMessagesLoggingInterceptor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">AspectJExpressionPointcut</span><span class="w"> </span><span class="n">pointcut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AspectJExpressionPointcut</span><span class="p">();</span>
<span class="w">        </span><span class="n">pointcut</span><span class="p">.</span><span class="na">setExpression</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;@within(org.springframework.stereotype.Service)&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultPointcutAdvisor</span><span class="p">(</span><span class="n">pointcut</span><span class="p">,</span><span class="w"> </span><span class="n">resultMessagesLoggingInterceptor</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ドメイン層のクラスを管理するcom.example.todo.domainパッケージ配下をcomponent-scan対象とする。</div>
<div class="line">これにより、com.example.todo.domainパッケージ配下のクラスに<code class="docutils literal notranslate"><span class="pre">&#64;Repository</span></code>,<code class="docutils literal notranslate"><span class="pre">&#64;Service</span></code>などのアノテーションを付けることで、Spring Framerowkが管理するBeanとして登録される。</div>
<div class="line">登録されたクラス(Bean)は、ControllerやServiceクラスにDIする事で、利用する事が出来る。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">インフラストラクチャ層に関するBean定義ファイルをimportする。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>O/R Mapperに依存するブランクプロジェクトを作成した場合は、<code class="docutils literal notranslate"><span class="pre">&#64;Transactional</span></code>アノテーションによるトランザクション管理を有効にするために、<code class="docutils literal notranslate"><span class="pre">&#64;EnableTransactionManagement</span></code>アノテーションが設定されている。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@EnableTransactionManagement</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div><div aria-labelledby="tab-9-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-9-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><p><code class="file docutils literal notranslate"><span class="pre">todo-domain.xml</span></code>には、Todoアプリのドメイン層に関わる設定を行う。</p>
<div class="line-block">
<div class="line">作成したブランクプロジェクトの<code class="file docutils literal notranslate"><span class="pre">src/main/resources/META-INF/spring/todo-domain.xml</span></code>は、以下のような設定となっている。</div>
<div class="line">なお、チュートリアルで使用しないコンポーネントについての説明は割愛する。</div>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
<span class="w">    </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="w">    </span><span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
<span class="w">    </span><span class="na">xmlns:aop=</span><span class="s">&quot;http://www.springframework.org/schema/aop&quot;</span>
<span class="w">    </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;</span>
<span class="s">        http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd</span>
<span class="s">        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">        http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd</span>
<span class="s">    &quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;import</span><span class="w"> </span><span class="na">resource=</span><span class="s">&quot;classpath:META-INF/spring/todo-infra.xml&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;import</span><span class="w"> </span><span class="na">resource=</span><span class="s">&quot;classpath*:META-INF/spring/**/*-codelist.xml&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;context:component-scan</span><span class="w"> </span><span class="na">base-package=</span><span class="s">&quot;com.example.todo.domain&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- AOP. --&gt;</span>
<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;resultMessagesLoggingInterceptor&quot;</span>
<span class="w">        </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.exception.ResultMessagesLoggingInterceptor&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;exceptionLogger&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;exceptionLogger&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span>
<span class="w">    </span><span class="nt">&lt;aop:config&gt;</span>
<span class="w">        </span><span class="nt">&lt;aop:advisor</span><span class="w"> </span><span class="na">advice-ref=</span><span class="s">&quot;resultMessagesLoggingInterceptor&quot;</span>
<span class="w">            </span><span class="na">pointcut=</span><span class="s">&quot;@within(org.springframework.stereotype.Service)&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/aop:config&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">インフラストラクチャ層に関するBean定義ファイルをimportする。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ドメイン層のクラスを管理するcom.example.todo.domainパッケージ配下をcomponent-scan対象とする。</div>
<div class="line">これにより、com.example.todo.domainパッケージ配下のクラスに<code class="docutils literal notranslate"><span class="pre">&#64;Repository</span></code>,<code class="docutils literal notranslate"><span class="pre">&#64;Service</span></code>などのアノテーションを付けることで、Spring Framerowkが管理するBeanとして登録される。</div>
<div class="line">登録されたクラス(Bean)は、ControllerやServiceクラスにDIする事で、利用する事が出来る。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>O/R Mapperに依存するブランクプロジェクトを作成した場合は、<code class="docutils literal notranslate"><span class="pre">&#64;Transactional</span></code>アノテーションによるトランザクション管理を有効にするために、<code class="docutils literal notranslate"><span class="pre">&lt;tx:annotation-driven&gt;</span></code>タグが設定されている。</p>
<blockquote>
<div><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;tx:annotation-driven</span><span class="w"> </span><span class="nt">/&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="todo-infra">
<h5><span class="section-number">11.2.8.1.2.3. </span>todo-infra<a class="headerlink" href="#todo-infra" title="Permalink to this heading">¶</a></h5>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-10-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-10-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-10-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-10-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-10-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-10-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><p><code class="file docutils literal notranslate"><span class="pre">TodoInfraConfig.java</span></code>には、Todoアプリのインフラストラクチャ層に関わる設定を行う。</p>
<p>作成したブランクプロジェクトの<code class="file docutils literal notranslate"><span class="pre">src/main/java/com/example/todo/config/app/TodoInfraConfig.java</span></code>は、以下のような設定となっている。</p>
<p><code class="file docutils literal notranslate"><span class="pre">TodoInfraConfig.java</span></code>は、インフラストラクチャ層によって設定が大きく異なるため、ブランクプロジェクト毎に説明を行う。作成したブランクプロジェクト以外の説明は読み飛ばしてもよい。</p>
</div><div aria-labelledby="tab-10-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-10-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><p><code class="file docutils literal notranslate"><span class="pre">todo-infra.xml</span></code>には、Todoアプリのインフラストラクチャ層に関わる設定を行う。</p>
<p>作成したブランクプロジェクトの<code class="file docutils literal notranslate"><span class="pre">src/main/resources/META-INF/spring/todo-infra.xml</span></code>は、以下のような設定となっている。</p>
<p><code class="file docutils literal notranslate"><span class="pre">todo-infra.xml</span></code>は、インフラストラクチャ層によって設定が大きく異なるため、ブランクプロジェクト毎に説明を行う。作成したブランクプロジェクト以外の説明は読み飛ばしてもよい。</p>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="o-r-mappertodo-infra">
<h6><span class="section-number">11.2.8.1.2.3.1. </span>O/R Mapperに依存しないブランクプロジェクトを作成した場合のtodo-infra<a class="headerlink" href="#o-r-mappertodo-infra" title="Permalink to this heading">¶</a></h6>
<p>O/R Mapperに依存しないブランクプロジェクトを作成した場合、以下のように空定義のファイルが作成される。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-11-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-11-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-11-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-11-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-11-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-11-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.config.app</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Bean definitions for infrastructure layer.</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoInfraConfig</span><span class="w"> </span><span class="p">{</span>

<span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-11-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-11-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
<span class="w">    </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="w">    </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;</span>
<span class="s">        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">    &quot;</span><span class="nt">&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="mybatis3todo-infra">
<h6><span class="section-number">11.2.8.1.2.3.2. </span>MyBatis3用のブランクプロジェクトを作成した場合のtodo-infra<a class="headerlink" href="#mybatis3todo-infra" title="Permalink to this heading">¶</a></h6>
<p>MyBatis3用のブランクプロジェクトを作成した場合、以下のような設定となっている。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-12-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-12-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-12-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-12-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-12-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-12-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.config.app</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">javax.sql.DataSource</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.mybatis.spring.SqlSessionFactoryBean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.mybatis.spring.annotation.MapperScan</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Import</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.todo.config.app.mybatis.MybatisConfig</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Bean definitions for infrastructure layer.</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="nd">@MapperScan</span><span class="p">(</span><span class="s">&quot;com.example.todo.domain.repository&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="nd">@Import</span><span class="p">({</span><span class="w"> </span><span class="n">TodoEnvConfig</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoInfraConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link SqlSessionFactory} bean.</span>
<span class="cm">     * @param dataSource DataSource</span>
<span class="cm">     * @see com.example.todo.config.app.TodoEnvConfig#dataSource()</span>
<span class="cm">     * @return Bean of configured {@link SqlSessionFactoryBean}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// (3)</span>
<span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;sqlSessionFactory&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">SqlSessionFactoryBean</span><span class="w"> </span><span class="nf">sqlSessionFactory</span><span class="p">(</span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SqlSessionFactoryBean</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SqlSessionFactoryBean</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// (4)</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setDataSource</span><span class="p">(</span><span class="n">dataSource</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// (5)</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setConfiguration</span><span class="p">(</span><span class="n">MybatisConfig</span><span class="p">.</span><span class="na">configuration</span><span class="p">());</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Mapperインタフェースをスキャンするために<code class="docutils literal notranslate"><span class="pre">&#64;MapperScan</span></code>を定義し、Mapperインタフェースが格納されている基底パッケージを指定する。</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">環境依存するコンポーネント(データソースやトランザクションマネージャなど)を定義するBean定義ファイルをimportする。</div>
<div class="line"><br /></div>
<div class="line">指定されたパッケージ配下に格納されている Mapperインタフェースがスキャンされ、スレッドセーフなMapperオブジェクト(MapperインタフェースのProxyオブジェクト)が自動的に生成される。</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">SqlSessionFactory</span></code>を生成するためのコンポーネントとして、<code class="docutils literal notranslate"><span class="pre">SqlSessionFactoryBean</span></code>をbean定義する。</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">dataSource</span></code>プロパティに、設定済みのデータソースのbeanを指定する。</div>
<div class="line"><br /></div>
<div class="line">MyBatis3の処理の中でSQLを発行する際は、ここで指定したデータソースからコネクションが取得される。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">configuration</span></code>プロパティに、MyBatisの設定をしたConfigurationクラスを指定する。</div>
<div class="line"><br /></div>
<div class="line">ここで指定したクラスは<code class="docutils literal notranslate"><span class="pre">SqlSessionFactory</span></code>を生成する時に読み込まれる。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div><div aria-labelledby="tab-12-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-12-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
<span class="w">    </span><span class="na">xmlns:mybatis=</span><span class="s">&quot;http://mybatis.org/schema/mybatis-spring&quot;</span>
<span class="w">    </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="w">    </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;</span>
<span class="s">        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">        http://mybatis.org/schema/mybatis-spring http://mybatis.org/schema/mybatis-spring.xsd</span>
<span class="s">    &quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;import</span><span class="w"> </span><span class="na">resource=</span><span class="s">&quot;classpath:/META-INF/spring/todo-env.xml&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- define the SqlSessionFactory --&gt;</span>
<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;sqlSessionFactory&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- (3) --&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;dataSource&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- (4) --&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;configLocation&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;classpath:/META-INF/mybatis/mybatis-config.xml&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (5) --&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- scan for Mappers --&gt;</span>
<span class="w">    </span><span class="nt">&lt;mybatis:scan</span><span class="w"> </span><span class="na">base-package=</span><span class="s">&quot;com.example.todo.domain.repository&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">環境依存するコンポーネント(データソースやトランザクションマネージャなど)を定義するBean定義ファイルをimportする。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">SqlSessionFactory</span></code>を生成するためのコンポーネントとして、<code class="docutils literal notranslate"><span class="pre">SqlSessionFactoryBean</span></code>をbean定義する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">dataSource</span></code>プロパティに、設定済みのデータソースのbeanを指定する。</div>
<div class="line"><br /></div>
<div class="line">MyBatis3の処理の中でSQLを発行する際は、ここで指定したデータソースからコネクションが取得される。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">configLocation</span></code>プロパティに、MyBatis設定ファイルのパスを指定する。</div>
<div class="line"><br /></div>
<div class="line">ここで指定したファイルは<code class="docutils literal notranslate"><span class="pre">SqlSessionFactory</span></code>を生成する時に読み込まれる。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Mapperインタフェースをスキャンするために<code class="docutils literal notranslate"><span class="pre">&lt;mybatis:scan&gt;</span></code>を定義し、<code class="docutils literal notranslate"><span class="pre">base-package</span></code>属性には、</div>
<div class="line">Mapperインタフェースが格納されている基底パッケージを指定する。</div>
<div class="line"><br /></div>
<div class="line">指定されたパッケージ配下に格納されている Mapperインタフェースがスキャンされ、</div>
<div class="line">スレッドセーフなMapperオブジェクト(MapperインタフェースのProxyオブジェクト)が自動的に生成される。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="file docutils literal notranslate"><span class="pre">mybatis-config.xml</span></code>は、MyBatis3自体の動作設定を行う設定ファイルである。</p>
<p>ブランクプロジェクトでは、デフォルトで以下の設定が行われている。</p>
<blockquote>
<div><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE configuration</span>
<span class="cp">    PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span>
<span class="nt">&lt;configuration&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- See https://mybatis.org/mybatis-3/configuration.html#settings --&gt;</span>
<span class="w">    </span><span class="nt">&lt;settings&gt;</span>
<span class="w">        </span><span class="nt">&lt;setting</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;mapUnderscoreToCamelCase&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;setting</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;lazyLoadingEnabled&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;setting</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;defaultFetchSize&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;100&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="cm">&lt;!--</span>
<span class="cm">        &lt;setting name=&quot;defaultExecutorType&quot; value=&quot;REUSE&quot; /&gt;</span>
<span class="cm">        &lt;setting name=&quot;jdbcTypeForNull&quot; value=&quot;NULL&quot; /&gt;</span>
<span class="cm">        &lt;setting name=&quot;localCacheScope&quot; value=&quot;STATEMENT&quot; /&gt;</span>
<span class="cm">--&gt;</span>
<span class="w">    </span><span class="nt">&lt;/settings&gt;</span>

<span class="w">    </span><span class="nt">&lt;typeAliases&gt;</span>
<span class="w">        </span><span class="nt">&lt;package</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;com.example.todo.domain.model&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;package</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;com.example.todo.domain.repository&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="cm">&lt;!--</span>
<span class="cm">        &lt;package name=&quot;com.example.todo.infra.mybatis.typehandler&quot; /&gt;</span>
<span class="cm">--&gt;</span>
<span class="w">    </span><span class="nt">&lt;/typeAliases&gt;</span>

<span class="w">    </span><span class="nt">&lt;typeHandlers&gt;</span>
<span class="cm">&lt;!--</span>
<span class="cm">        &lt;package name=&quot;com.example.todo.infra.mybatis.typehandler&quot; /&gt;</span>
<span class="cm">--&gt;</span>
<span class="w">    </span><span class="nt">&lt;/typeHandlers&gt;</span>

<span class="nt">&lt;/configuration&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="jpatodo-infra">
<h6><span class="section-number">11.2.8.1.2.3.3. </span>JPA用のブランクプロジェクトを作成した場合のtodo-infra<a class="headerlink" href="#jpatodo-infra" title="Permalink to this heading">¶</a></h6>
<p>JPA用のブランクプロジェクトを作成した場合、以下のような設定となっている。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-13-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-13-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-13-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-13-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-13-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-13-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.config.app</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.HashMap</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Map</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">javax.sql.DataSource</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Value</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Import</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.jpa.repository.config.EnableJpaRepositories</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.orm.jpa.vendor.Database</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Bean definitions for infrastructure layer.</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="nd">@EnableJpaRepositories</span><span class="p">(</span><span class="s">&quot;com.example.todo.domain.repository&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="nd">@Import</span><span class="p">({</span><span class="w"> </span><span class="n">TodoEnvConfig</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoInfraConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Database property.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${database}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Database</span><span class="w"> </span><span class="n">database</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link HibernateJpaVendorAdapter} bean.</span>
<span class="cm">     * @return Bean of configured {@link HibernateJpaVendorAdapter}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// (3)</span>
<span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;jpaVendorAdapter&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">HibernateJpaVendorAdapter</span><span class="w"> </span><span class="nf">jpaVendorAdapter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">HibernateJpaVendorAdapter</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HibernateJpaVendorAdapter</span><span class="p">();</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setDatabase</span><span class="p">(</span><span class="n">database</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link LocalContainerEntityManagerFactoryBean} bean.</span>
<span class="cm">     * @param dataSource DataSource</span>
<span class="cm">     * @return Bean of configured {@link LocalContainerEntityManagerFactoryBean}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// (4)</span>
<span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;entityManagerFactory&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalContainerEntityManagerFactoryBean</span><span class="w"> </span><span class="nf">entityManagerFactory</span><span class="p">(</span>
<span class="w">            </span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">LocalContainerEntityManagerFactoryBean</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LocalContainerEntityManagerFactoryBean</span><span class="p">();</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setPackagesToScan</span><span class="p">(</span><span class="s">&quot;com.example.todo.domain.model&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setDataSource</span><span class="p">(</span><span class="n">dataSource</span><span class="p">);</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setJpaVendorAdapter</span><span class="p">(</span><span class="n">jpaVendorAdapter</span><span class="p">());</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setJpaPropertyMap</span><span class="p">(</span><span class="n">jpaPropertyMap</span><span class="p">());</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link LocalContainerEntityManagerFactoryBean}.JpaPropertyMap.</span>
<span class="cm">     * @return configured JpaPropertyMap</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// (5)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="o">?&gt;</span><span class="w"> </span><span class="n">jpaPropertyMap</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">jpaPropertyMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="n">jpaPropertyMap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;hibernate.connection.charSet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UTF-8&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">jpaPropertyMap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;hibernate.format_sql&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<span class="w">        </span><span class="n">jpaPropertyMap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;hibernate.use_sql_comments&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<span class="w">        </span><span class="n">jpaPropertyMap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;hibernate.jdbc.batch_size&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">);</span>
<span class="w">        </span><span class="n">jpaPropertyMap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;hibernate.jdbc.fetch_size&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">jpaPropertyMap</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Spring Data JPAを使用して、Repositoryインタフェースから実装クラスを自動生成する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;EnableJpaRepositories</span></code>アノテーションに、Repositoryを格納するパッケージを指定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">環境依存するコンポーネント(データソースやトランザクションマネージャなど)を定義するBean定義ファイルをimportする。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">JPAの実装ベンダの設定を行う。</div>
<div class="line">JPA実装として、Hibernateを使うため、<code class="docutils literal notranslate"><span class="pre">HibernateJpaVendorAdapter</span></code>を定義している。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">EntityManager</span></code>の定義を行う。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Hibernateに関する詳細な設定を行う。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div><div aria-labelledby="tab-13-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-13-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="w"> </span><span class="nt">&lt;beans</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
<span class="w">    </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="w">    </span><span class="na">xmlns:jpa=</span><span class="s">&quot;http://www.springframework.org/schema/data/jpa&quot;</span>
<span class="w">    </span><span class="na">xmlns:util=</span><span class="s">&quot;http://www.springframework.org/schema/util&quot;</span>
<span class="w">    </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;</span>
<span class="s">        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">        http://www.springframework.org/schema/util https://www.springframework.org/schema/util/spring-util.xsd</span>
<span class="s">        http://www.springframework.org/schema/data/jpa https://www.springframework.org/schema/data/jpa/spring-jpa.xsd</span>
<span class="s">    &quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;import</span><span class="w"> </span><span class="na">resource=</span><span class="s">&quot;classpath:/META-INF/spring/todo-env.xml&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;jpa:repositories</span><span class="w"> </span><span class="na">base-package=</span><span class="s">&quot;com.example.todo.domain.repository&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (3) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;jpaVendorAdapter&quot;</span>
<span class="w">        </span><span class="na">class=</span><span class="s">&quot;org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;showSql&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;database&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${database}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (4) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;entityManagerFactory&quot;</span>
<span class="w">        </span><span class="na">class=</span><span class="s">&quot;org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- (5) --&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;packagesToScan&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;com.example.todo.domain.model&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;dataSource&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;jpaVendorAdapter&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;jpaVendorAdapter&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- (6) --&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;jpaPropertyMap&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;util:map&gt;</span>
<span class="w">                </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;hibernate.connection.charSet&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;UTF-8&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;hibernate.format_sql&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;hibernate.use_sql_comments&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;hibernate.jdbc.batch_size&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;30&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;hibernate.jdbc.fetch_size&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;100&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/util:map&gt;</span>
<span class="w">        </span><span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">環境依存するコンポーネント(データソースやトランザクションマネージャなど)を定義するBean定義ファイルをimportする。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Spring Data JPAを使用して、Repositoryインタフェースから実装クラスを自動生成する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;jpa:repository&gt;</span></code>タグの<code class="docutils literal notranslate"><span class="pre">base-package</span></code>属性に、Repositoryを格納するパッケージを指定する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">JPAの実装ベンダの設定を行う。</div>
<div class="line">JPA実装として、Hibernateを使うため、<code class="docutils literal notranslate"><span class="pre">HibernateJpaVendorAdapter</span></code>を定義している。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">EntityManager</span></code>の定義を行う。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">JPAのエンティティとして扱うクラスが格納されているパッケージ名を指定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Hibernateに関する詳細な設定を行う。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="id46">
<h5><span class="section-number">11.2.8.1.2.4. </span>todo-infra.properties<a class="headerlink" href="#id46" title="Permalink to this heading">¶</a></h5>
<p><code class="file docutils literal notranslate"><span class="pre">todo-infra.properties</span></code>には、Todoアプリのインフラストラクチャ層における環境依存値の設定を行う。</p>
<p>O/R Mapperに依存しないブランクプロジェクトを作成した際は、<code class="file docutils literal notranslate"><span class="pre">todo-infra.properties</span></code>は作成されない。</p>
<p>作成したブランクプロジェクトの<code class="file docutils literal notranslate"><span class="pre">src/main/resources/META-INF/spring/todo-infra.properties</span></code>は、以下のような設定となっている。</p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="c1"># (1)</span>
<span class="na">database</span><span class="o">=</span><span class="s">H2</span>
<span class="na">database.url</span><span class="o">=</span><span class="s">jdbc:h2:mem:todo;DB_CLOSE_DELAY=-1</span>
<span class="na">database.username</span><span class="o">=</span><span class="s">sa</span>
<span class="na">database.password</span><span class="o">=</span>
<span class="na">database.driverClassName</span><span class="o">=</span><span class="s">org.h2.Driver</span>
<span class="c1"># (2)</span>
<span class="c1"># connection pool</span>
<span class="na">cp.maxActive</span><span class="o">=</span><span class="s">96</span>
<span class="na">cp.maxIdle</span><span class="o">=</span><span class="s">16</span>
<span class="na">cp.minIdle</span><span class="o">=</span><span class="s">0</span>
<span class="na">cp.maxWait</span><span class="o">=</span><span class="s">60000</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">データベースに関する設定を行う。</div>
<div class="line">本チュートリアルでは、データベースのセットアップの手間を省くため、H2 Databaseを使用する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">コネクションプールに関する設定。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>これらの設定値は、<code class="file docutils literal notranslate"><span class="pre">todo-env.xml</span></code>または<code class="file docutils literal notranslate"><span class="pre">TodoEnvConfig.java</span></code>から参照されている。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="todo-env">
<h5><span class="section-number">11.2.8.1.2.5. </span>todo-env<a class="headerlink" href="#todo-env" title="Permalink to this heading">¶</a></h5>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-14-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-14-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-14-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-14-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-14-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-14-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><p><code class="file docutils literal notranslate"><span class="pre">TodoEnvConfig.java</span></code>には、デプロイする環境によって設定が異なるコンポーネントの設定を行う。</p>
<p>作成したブランクプロジェクトの<code class="docutils literal notranslate"><span class="pre">src/main/java/com/example/todo/config/app/TodoEnvConfig.java</span></code>は、以下のような設定となっている。</p>
<p>ここでは、MyBatis3用のブランクプロジェクトに格納されるファイルを例に説明する。なお、データベースにアクセスしないブランクプロジェクトを作成した際は、<code class="file docutils literal notranslate"><span class="pre">TodoEnvConfig.java</span></code>は作成されない。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.config.app</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.Duration</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">javax.sql.DataSource</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.commons.dbcp2.BasicDataSource</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Value</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.core.io.ClassPathResource</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.jdbc.datasource.DataSourceTransactionManager</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.jdbc.datasource.init.DataSourceInitializer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.jdbc.datasource.init.ResourceDatabasePopulator</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.transaction.TransactionManager</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.time.ClockFactory</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.time.DefaultClockFactory</span><span class="p">;</span>

<span class="cm">/* REMOVE THIS LINE IF YOU USE JPA</span>
<span class="cm">import org.springframework.orm.jpa.JpaTransactionManager;</span>
<span class="cm">import jakarta.persistence.EntityManagerFactory;</span>
<span class="cm">REMOVE THIS LINE IF YOU USE JPA */</span>

<span class="cm">/**</span>
<span class="cm"> * Define settings for the environment.</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoEnvConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * DataSource.driverClassName property.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${database.driverClassName}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">driverClassName</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * DataSource.url property.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${database.url}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * DataSource.username property.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${database.username}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * DataSource.password property.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${database.password}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * DataSource.maxTotal property.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${cp.maxActive}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">maxActive</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * DataSource.maxIdle property.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${cp.maxIdle}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">maxIdle</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * DataSource.minIdle property.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${cp.minIdle}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">minIdle</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * DataSource.maxWaitMillis property.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${cp.maxWait}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">maxWait</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Property databaseName.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${database}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">database</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link ClockFactory}.</span>
<span class="cm">     * @return Bean of configured {@link DefaultClockFactory}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;dateFactory&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ClockFactory</span><span class="w"> </span><span class="nf">dateFactory</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultClockFactory</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link DataSource} bean.</span>
<span class="cm">     * @return Bean of configured {@link BasicDataSource}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;dataSource&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">destroyMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;close&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">DataSource</span><span class="w"> </span><span class="nf">dataSource</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">BasicDataSource</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BasicDataSource</span><span class="p">();</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setDriverClassName</span><span class="p">(</span><span class="n">driverClassName</span><span class="p">);</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setUrl</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="n">username</span><span class="p">);</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="n">password</span><span class="p">);</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setDefaultAutoCommit</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setMaxTotal</span><span class="p">(</span><span class="n">maxActive</span><span class="p">);</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setMaxIdle</span><span class="p">(</span><span class="n">maxIdle</span><span class="p">);</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setMinIdle</span><span class="p">(</span><span class="n">minIdle</span><span class="p">);</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setMaxWait</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofMillis</span><span class="p">(</span><span class="n">maxWait</span><span class="p">));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configuration to set up database during initialization.</span>
<span class="cm">     * @return Bean of configured {@link DataSourceInitializer}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">DataSourceInitializer</span><span class="w"> </span><span class="nf">dataSourceInitializer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">DataSourceInitializer</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DataSourceInitializer</span><span class="p">();</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setDataSource</span><span class="p">(</span><span class="n">dataSource</span><span class="p">());</span>
<span class="w">        </span><span class="c1">// (3)</span>
<span class="w">        </span><span class="n">ResourceDatabasePopulator</span><span class="w"> </span><span class="n">databasePopulator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResourceDatabasePopulator</span><span class="p">();</span>
<span class="w">        </span><span class="n">databasePopulator</span><span class="p">.</span><span class="na">addScript</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ClassPathResource</span><span class="p">(</span><span class="s">&quot;/database/&quot;</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">database</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;-schema.sql&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">databasePopulator</span><span class="p">.</span><span class="na">addScript</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ClassPathResource</span><span class="p">(</span><span class="s">&quot;/database/&quot;</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">database</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;-dataload.sql&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">databasePopulator</span><span class="p">.</span><span class="na">setSqlScriptEncoding</span><span class="p">(</span><span class="s">&quot;UTF-8&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">databasePopulator</span><span class="p">.</span><span class="na">setIgnoreFailedDrops</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setDatabasePopulator</span><span class="p">(</span><span class="n">databasePopulator</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// (4)</span>
<span class="w">    </span><span class="cm">/* REMOVE THIS LINE IF YOU USE JPA</span>
<span class="cm">    /**</span>
<span class="cm">     * Configure {@link TransactionManager} bean for use with JPA.</span>
<span class="cm">     * @param entityManagerFactory EntityManager used within a transaction</span>
<span class="cm">     * @return Bean of configured {@link JpaTransactionManager}</span>
<span class="cm">     *REMOVE THIS COMMENT IF YOU USE JPA/</span>
<span class="cm">    @Bean(&quot;transactionManager&quot;)</span>
<span class="cm">    public TransactionManager transactionManager(EntityManagerFactory entityManagerFactory) {</span>
<span class="cm">        JpaTransactionManager bean = new JpaTransactionManager();</span>
<span class="cm">        bean.setEntityManagerFactory(entityManagerFactory);</span>
<span class="cm">        return bean;</span>
<span class="cm">    }</span>
<span class="cm">    REMOVE THIS LINE IF YOU USE JPA */</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link TransactionManager} bean.</span>
<span class="cm">     * @return Bean of configured {@link DataSourceTransactionManager}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;transactionManager&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">TransactionManager</span><span class="w"> </span><span class="nf">transactionManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">DataSourceTransactionManager</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DataSourceTransactionManager</span><span class="p">();</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setDataSource</span><span class="p">(</span><span class="n">dataSource</span><span class="p">());</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setRollbackOnCommitFailure</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">実データソースの設定。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">データベース初期化の設定。</div>
<div class="line">データベースを初期化するSQLファイルを実行するための設定を行っている。</div>
<div class="line"><br /></div>
<div class="line">この設定は通常、開発中のみでしか使用しない(環境に依存する設定)ため、<code class="docutils literal notranslate"><span class="pre">TodoEnvConfig.java</span></code> に定義されている。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">データベースを初期化するSQLファイルの設定。</div>
<div class="line">データベースを初期化するための、DDL文が記載されているSQLファイルとDML文が記載されているSQLファイルを指定している。</div>
<div class="line"><br /></div>
<div class="line">ブランクプロジェクトの設定では<code class="docutils literal notranslate"><span class="pre">todo-infra.properties</span></code> に<code class="docutils literal notranslate"><span class="pre">database=H2</span></code> と定義されているため、<code class="docutils literal notranslate"><span class="pre">H2-schema.sql</span></code> 及び<code class="docutils literal notranslate"><span class="pre">H2-dataload.sql</span></code> が実行される。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">トランザクションマネージャの設定。</div>
<div class="line">id属性には、<code class="docutils literal notranslate"><span class="pre">transactionManager</span></code>を指定する。</div>
<div class="line"><br /></div>
<div class="line">ブランクプロジェクトでは、JDBCのAPIを使用してトランザクションを制御するクラス(<code class="docutils literal notranslate"><span class="pre">org.springframework.jdbc.datasource.DataSourceTransactionManager</span></code>)が設定されている。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>JPA用のブランクプロジェクトを作成した場合は、トランザクションマネージャには、JPAのAPIを使用してトランザクションを制御するクラス(<code class="docutils literal notranslate"><span class="pre">org.springframework.orm.jpa.JpaTransactionManager</span></code>)が設定されている。</p>
<blockquote>
<div><div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;transactionManager&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">TransactionManager</span><span class="w"> </span><span class="nf">transactionManager</span><span class="p">(</span><span class="n">EntityManagerFactory</span><span class="w"> </span><span class="n">entityManagerFactory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">JpaTransactionManager</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JpaTransactionManager</span><span class="p">();</span>
<span class="w">    </span><span class="n">bean</span><span class="p">.</span><span class="na">setEntityManagerFactory</span><span class="p">(</span><span class="n">entityManagerFactory</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div><div aria-labelledby="tab-14-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-14-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><p><code class="file docutils literal notranslate"><span class="pre">todo-env.xml</span></code>には、デプロイする環境によって設定が異なるコンポーネントの設定を行う。</p>
<p>作成したブランクプロジェクトの<code class="docutils literal notranslate"><span class="pre">src/main/resources/META-INF/spring/todo-env.xml</span></code>は、以下のような設定となっている。</p>
<p>ここでは、MyBatis3用のブランクプロジェクトに格納されるファイルを例に説明する。なお、データベースにアクセスしないブランクプロジェクトを作成した際は、<code class="file docutils literal notranslate"><span class="pre">todo-env.xml</span></code>は作成されない。</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
<span class="w">    </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="w">    </span><span class="na">xmlns:jdbc=</span><span class="s">&quot;http://www.springframework.org/schema/jdbc&quot;</span>
<span class="w">    </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;</span>
<span class="s">        http://www.springframework.org/schema/jdbc https://www.springframework.org/schema/jdbc/spring-jdbc.xsd</span>
<span class="s">        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">    &quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;dateFactory&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.time.DefaultClockFactory&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;dataSource&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.apache.commons.dbcp2.BasicDataSource&quot;</span>
<span class="w">        </span><span class="na">destroy-method=</span><span class="s">&quot;close&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;driverClassName&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${database.driverClassName}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;url&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${database.url}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;username&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${database.username}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;password&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${database.password}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;defaultAutoCommit&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;maxTotal&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${cp.maxActive}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;maxIdle&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${cp.maxIdle}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;minIdle&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${cp.minIdle}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;maxWait&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;java.time.Duration&quot;</span><span class="w"> </span><span class="na">factory-method=</span><span class="s">&quot;ofMillis&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;constructor-arg</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${cp.maxWait}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">          </span><span class="nt">&lt;/bean&gt;</span>
<span class="w">        </span><span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;jdbc:initialize-database</span><span class="w"> </span><span class="na">data-source=</span><span class="s">&quot;dataSource&quot;</span>
<span class="w">        </span><span class="na">ignore-failures=</span><span class="s">&quot;ALL&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- (3) --&gt;</span>
<span class="w">        </span><span class="nt">&lt;jdbc:script</span><span class="w"> </span><span class="na">location=</span><span class="s">&quot;classpath:/database/${database}-schema.sql&quot;</span><span class="w"> </span><span class="na">encoding=</span><span class="s">&quot;UTF-8&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;jdbc:script</span><span class="w"> </span><span class="na">location=</span><span class="s">&quot;classpath:/database/${database}-dataload.sql&quot;</span><span class="w"> </span><span class="na">encoding=</span><span class="s">&quot;UTF-8&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/jdbc:initialize-database&gt;</span>

<span class="w">    </span><span class="cm">&lt;!--  REMOVE THIS LINE IF YOU USE JPA</span>
<span class="cm">    &lt;bean id=&quot;transactionManager&quot;</span>
<span class="cm">        class=&quot;org.springframework.orm.jpa.JpaTransactionManager&quot;&gt;</span>
<span class="cm">        &lt;property name=&quot;entityManagerFactory&quot; ref=&quot;entityManagerFactory&quot; /&gt;</span>
<span class="cm">    &lt;/bean&gt;</span>
<span class="cm">          REMOVE THIS LINE IF YOU USE JPA  --&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- (4) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;transactionManager&quot;</span>
<span class="w">        </span><span class="na">class=</span><span class="s">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;dataSource&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;rollbackOnCommitFailure&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">実データソースの設定。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">データベース初期化の設定。</div>
<div class="line">データベースを初期化するSQLファイルを実行するための設定を行っている。</div>
<div class="line"><br /></div>
<div class="line">この設定は通常、開発中のみでしか使用しない(環境に依存する設定)ため、<code class="docutils literal notranslate"><span class="pre">todo-env.xml</span></code> に定義されている。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">データベースを初期化するSQLファイルの設定。</div>
<div class="line">データベースを初期化するための、DDL文が記載されているSQLファイルとDML文が記載されているSQLファイルを指定している。</div>
<div class="line"><br /></div>
<div class="line">ブランクプロジェクトの設定では<code class="docutils literal notranslate"><span class="pre">todo-infra.properties</span></code> に<code class="docutils literal notranslate"><span class="pre">database=H2</span></code> と定義されているため、<code class="docutils literal notranslate"><span class="pre">H2-schema.sql</span></code> 及び<code class="docutils literal notranslate"><span class="pre">H2-dataload.sql</span></code> が実行される。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">トランザクションマネージャの設定。</div>
<div class="line">id属性には、<code class="docutils literal notranslate"><span class="pre">transactionManager</span></code>を指定する。</div>
<div class="line">別の名前を指定する場合は、<code class="docutils literal notranslate"><span class="pre">&lt;tx:annotation-driven&gt;</span></code>タグにもトランザクションマネージャ名を指定する必要がある。</div>
<div class="line"><br /></div>
<div class="line">ブランクプロジェクトでは、JDBCのAPIを使用してトランザクションを制御するクラス(<code class="docutils literal notranslate"><span class="pre">org.springframework.jdbc.datasource.DataSourceTransactionManager</span></code>)が設定されている。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>JPA用のブランクプロジェクトを作成した場合は、トランザクションマネージャには、JPAのAPIを使用してトランザクションを制御するクラス(<code class="docutils literal notranslate"><span class="pre">org.springframework.orm.jpa.JpaTransactionManager</span></code>)が設定されている。</p>
<blockquote>
<div><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;transactionManager&quot;</span>
<span class="w">    </span><span class="na">class=</span><span class="s">&quot;org.springframework.orm.jpa.JpaTransactionManager&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;entityManagerFactory&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;entityManagerFactory&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="spring-mvc">
<h5><span class="section-number">11.2.8.1.2.6. </span>spring-mvc<a class="headerlink" href="#spring-mvc" title="Permalink to this heading">¶</a></h5>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-15-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-15-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-15-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-15-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-15-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-15-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><p><code class="file docutils literal notranslate"><span class="pre">SpringMvcConfig.java</span></code>には、Spring MVCに関する定義を行う。</p>
<div class="line-block">
<div class="line">作成したブランクプロジェクトの<code class="file docutils literal notranslate"><span class="pre">src/main/java/com/example/todo/config/web/SpringMvcConfig.java</span></code>は、以下のような設定となっている。</div>
<div class="line">なお、チュートリアルで使用しないコンポーネントについての説明は割愛する。</div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.config.web</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.HashSet</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Properties</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Set</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.regex.Pattern</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.aop.Advisor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.aop.aspectj.AspectJExpressionPointcut</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.aop.support.DefaultPointcutAdvisor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Value</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.EnableAspectJAutoProxy</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.support.PropertySourcesPlaceholderConfigurer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.core.io.Resource</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.web.PageableHandlerMethodArgumentResolver</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.http.HttpStatus</span><span class="p">;</span>
<span class="cm">/* REMOVE THIS LINE IF YOU USE JPA</span>
<span class="cm">import org.springframework.orm.jpa.support.OpenEntityManagerInViewInterceptor;</span>
<span class="cm">REMOVE THIS LINE IF YOU USE JPA */</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.web.method.annotation.AuthenticationPrincipalArgumentResolver</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.web.servlet.support.csrf.CsrfRequestDataValueProcessor</span><span class="p">;</span>
<span class="cm">/* REMOVE THIS LINE IF YOU USE JPA</span>
<span class="cm">import org.springframework.web.context.request.WebRequestInterceptor;</span>
<span class="cm">REMOVE THIS LINE IF YOU USE JPA */</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.method.support.HandlerMethodArgumentResolver</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.servlet.HandlerInterceptor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.servlet.config.annotation.DefaultServletHandlerConfigurer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.servlet.config.annotation.EnableWebMvc</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.servlet.config.annotation.InterceptorRegistry</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.servlet.config.annotation.ViewResolverRegistry</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.servlet.support.RequestDataValueProcessor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.exception.ExceptionCodeResolver</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.exception.ExceptionLogger</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.web.codelist.CodeListInterceptor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.web.exception.HandlerExceptionResolverLoggingInterceptor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.web.exception.SystemExceptionResolver</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.web.logging.TraceLoggingInterceptor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.web.mvc.support.CompositeRequestDataValueProcessor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.web.token.transaction.TransactionTokenInterceptor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.web.token.transaction.TransactionTokenRequestDataValueProcessor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.thymeleaf.dialect.IDialect</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.thymeleaf.extras.springsecurity6.dialect.SpringSecurityDialect</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.thymeleaf.spring6.SpringTemplateEngine</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.thymeleaf.spring6.templateresolver.SpringResourceTemplateResolver</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.thymeleaf.spring6.view.ThymeleafViewResolver</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.thymeleaf.templateresolver.ITemplateResolver</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm">* Configure SpringMVC.</span>
<span class="cm">*/</span>
<span class="c1">// (1)</span>
<span class="nd">@ComponentScan</span><span class="p">(</span><span class="n">basePackages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;com.example.todo.app&quot;</span><span class="w"> </span><span class="p">})</span>
<span class="nd">@EnableAspectJAutoProxy</span>
<span class="nd">@EnableWebMvc</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SpringMvcConfig</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">WebMvcConfigurer</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link PropertySourcesPlaceholderConfigurer} bean.</span>
<span class="cm">     * @param properties Property files to be read</span>
<span class="cm">     * @return Bean of configured {@link PropertySourcesPlaceholderConfigurer}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">PropertySourcesPlaceholderConfigurer</span><span class="w"> </span><span class="nf">propertySourcesPlaceholderConfigurer</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;classpath*:/META-INF/spring/*.properties&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">Resource</span><span class="p">...</span><span class="w"> </span><span class="n">properties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">PropertySourcesPlaceholderConfigurer</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PropertySourcesPlaceholderConfigurer</span><span class="p">();</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setLocations</span><span class="p">(</span><span class="n">properties</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * {@inheritDoc}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// (3)</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addArgumentResolvers</span><span class="p">(</span>
<span class="w">            </span><span class="n">List</span><span class="o">&lt;</span><span class="n">HandlerMethodArgumentResolver</span><span class="o">&gt;</span><span class="w"> </span><span class="n">argumentResolvers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">argumentResolvers</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">pageableHandlerMethodArgumentResolver</span><span class="p">());</span>
<span class="w">        </span><span class="n">argumentResolvers</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">authenticationPrincipalArgumentResolver</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link PageableHandlerMethodArgumentResolver} bean.</span>
<span class="cm">     * @return Bean of configured {@link PageableHandlerMethodArgumentResolver}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">PageableHandlerMethodArgumentResolver</span><span class="w"> </span><span class="nf">pageableHandlerMethodArgumentResolver</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PageableHandlerMethodArgumentResolver</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link AuthenticationPrincipalArgumentResolver} bean.</span>
<span class="cm">     * @return Bean of configured {@link AuthenticationPrincipalArgumentResolver}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">AuthenticationPrincipalArgumentResolver</span><span class="w"> </span><span class="nf">authenticationPrincipalArgumentResolver</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AuthenticationPrincipalArgumentResolver</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * {@inheritDoc}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configureDefaultServletHandling</span><span class="p">(</span>
<span class="w">            </span><span class="n">DefaultServletHandlerConfigurer</span><span class="w"> </span><span class="n">configurer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">configurer</span><span class="p">.</span><span class="na">enable</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * {@inheritDoc}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// (4)</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addResourceHandlers</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">ResourceHandlerRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">addResourceHandler</span><span class="p">(</span><span class="s">&quot;/resources/**&quot;</span><span class="p">).</span><span class="na">addResourceLocations</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;/resources/&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;classpath:META-INF/resources/&quot;</span><span class="p">).</span><span class="na">setCachePeriod</span><span class="p">(</span>
<span class="w">                        </span><span class="mi">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">60</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * {@inheritDoc}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// (5)</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addInterceptors</span><span class="p">(</span><span class="n">InterceptorRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">addInterceptor</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span><span class="w"> </span><span class="n">traceLoggingInterceptor</span><span class="p">());</span>
<span class="w">        </span><span class="n">addInterceptor</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span><span class="w"> </span><span class="n">transactionTokenInterceptor</span><span class="p">());</span>
<span class="w">        </span><span class="n">addInterceptor</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span><span class="w"> </span><span class="n">codeListInterceptor</span><span class="p">());</span>
<span class="w">        </span><span class="cm">/* REMOVE THIS LINE IF YOU USE JPA</span>
<span class="cm">        addWebRequestInterceptor(registry, openEntityManagerInViewInterceptor());</span>
<span class="cm">          REMOVE THIS LINE IF YOU USE JPA */</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Common processes used in #addInterceptors.</span>
<span class="cm">     * @param registry {@link InterceptorRegistry}</span>
<span class="cm">     * @param interceptor {@link HandlerInterceptor}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addInterceptor</span><span class="p">(</span><span class="n">InterceptorRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">,</span>
<span class="w">            </span><span class="n">HandlerInterceptor</span><span class="w"> </span><span class="n">interceptor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">addInterceptor</span><span class="p">(</span><span class="n">interceptor</span><span class="p">).</span><span class="na">addPathPatterns</span><span class="p">(</span><span class="s">&quot;/**&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">excludePathPatterns</span><span class="p">(</span><span class="s">&quot;/resources/**&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/* REMOVE THIS LINE IF YOU USE JPA</span>
<span class="cm">    /**</span>
<span class="cm">     * Common processes used in #addInterceptors.</span>
<span class="cm">     * @param registry {@link InterceptorRegistry}</span>
<span class="cm">     * @param interceptor {@link WebRequestInterceptor}</span>
<span class="cm">     *REMOVE THIS COMMENT IF YOU USE JPA/</span>
<span class="cm">    private void addWebRequestInterceptor(InterceptorRegistry registry,</span>
<span class="cm">            WebRequestInterceptor interceptor) {</span>
<span class="cm">        registry.addWebRequestInterceptor(interceptor).addPathPatterns(&quot;/**&quot;)</span>
<span class="cm">                .excludePathPatterns(&quot;/resources/**&quot;);</span>
<span class="cm">    }</span>
<span class="cm">    REMOVE THIS LINE IF YOU USE JPA */</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link TraceLoggingInterceptor} bean.</span>
<span class="cm">     * @return Bean of configured {@link TraceLoggingInterceptor}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">TraceLoggingInterceptor</span><span class="w"> </span><span class="nf">traceLoggingInterceptor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TraceLoggingInterceptor</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link TransactionTokenInterceptor} bean.</span>
<span class="cm">     * @return Bean of configured {@link TransactionTokenInterceptor}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">TransactionTokenInterceptor</span><span class="w"> </span><span class="nf">transactionTokenInterceptor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TransactionTokenInterceptor</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link CodeListInterceptor} bean.</span>
<span class="cm">     * @return Bean of configured {@link CodeListInterceptor}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CodeListInterceptor</span><span class="w"> </span><span class="nf">codeListInterceptor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">CodeListInterceptor</span><span class="w"> </span><span class="n">codeListInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CodeListInterceptor</span><span class="p">();</span>
<span class="w">        </span><span class="n">codeListInterceptor</span><span class="p">.</span><span class="na">setCodeListIdPattern</span><span class="p">(</span><span class="n">Pattern</span><span class="p">.</span><span class="na">compile</span><span class="p">(</span><span class="s">&quot;CL_.+&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">codeListInterceptor</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/* REMOVE THIS LINE IF YOU USE JPA</span>
<span class="cm">    /**</span>
<span class="cm">     * Configure {@link OpenEntityManagerInViewInterceptor} bean.</span>
<span class="cm">     * @return Bean of configured {@link OpenEntityManagerInViewInterceptor}</span>
<span class="cm">     *REMOVE THIS COMMENT IF YOU USE JPA/</span>
<span class="cm">    @Bean</span>
<span class="cm">    public OpenEntityManagerInViewInterceptor openEntityManagerInViewInterceptor() {</span>
<span class="cm">        return new OpenEntityManagerInViewInterceptor();</span>
<span class="cm">    }</span>
<span class="cm">    REMOVE THIS LINE IF YOU USE JPA */</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * {@inheritDoc}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configureViewResolvers</span><span class="p">(</span><span class="n">ViewResolverRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">viewResolver</span><span class="p">(</span><span class="n">thymeleafViewResolver</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure Thymeleaf bean.</span>
<span class="cm">     * @return Bean of configured ThymeleafViewResolver</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// (6)</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ThymeleafViewResolver</span><span class="w"> </span><span class="nf">thymeleafViewResolver</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ThymeleafViewResolver</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ThymeleafViewResolver</span><span class="p">();</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setTemplateEngine</span><span class="p">(</span><span class="n">templateEngine</span><span class="p">());</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setCharacterEncoding</span><span class="p">(</span><span class="s">&quot;UTF-8&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setForceContentType</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setContentType</span><span class="p">(</span><span class="s">&quot;text/html;charset=UTF-8&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure ITemplateResolver Bean.</span>
<span class="cm">     * @return Bean of configured SpringResourceTemplateResolver</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// (7)</span>
<span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;templateResolver&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ITemplateResolver</span><span class="w"> </span><span class="nf">templateResolver</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SpringResourceTemplateResolver</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SpringResourceTemplateResolver</span><span class="p">();</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setPrefix</span><span class="p">(</span><span class="s">&quot;/WEB-INF/views/&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setSuffix</span><span class="p">(</span><span class="s">&quot;.html&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setTemplateMode</span><span class="p">(</span><span class="s">&quot;HTML&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setCharacterEncoding</span><span class="p">(</span><span class="s">&quot;UTF-8&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure SpringTemplateEngine Bean.</span>
<span class="cm">     * @return Bean of configured SpringTemplateEngine</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;templateEngine&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">SpringTemplateEngine</span><span class="w"> </span><span class="nf">templateEngine</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SpringTemplateEngine</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SpringTemplateEngine</span><span class="p">();</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setTemplateResolver</span><span class="p">(</span><span class="n">templateResolver</span><span class="p">());</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setEnableSpringELCompiler</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">        </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">IDialect</span><span class="o">&gt;</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="n">set</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">SpringSecurityDialect</span><span class="p">());</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setAdditionalDialects</span><span class="p">(</span><span class="n">set</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link RequestDataValueProcessor} bean.</span>
<span class="cm">     * @return Bean of configured {@link CompositeRequestDataValueProcessor}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;requestDataValueProcessor&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RequestDataValueProcessor</span><span class="w"> </span><span class="nf">requestDataValueProcessor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CompositeRequestDataValueProcessor</span><span class="p">(</span><span class="n">csrfRequestDataValueProcessor</span><span class="p">(),</span><span class="w"> </span><span class="n">transactionTokenRequestDataValueProcessor</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link CsrfRequestDataValueProcessor} bean.</span>
<span class="cm">     * @return Bean of configured {@link CsrfRequestDataValueProcessor}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CsrfRequestDataValueProcessor</span><span class="w"> </span><span class="nf">csrfRequestDataValueProcessor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CsrfRequestDataValueProcessor</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link TransactionTokenRequestDataValueProcessor} bean.</span>
<span class="cm">     * @return Bean of configured {@link TransactionTokenRequestDataValueProcessor}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">TransactionTokenRequestDataValueProcessor</span><span class="w"> </span><span class="nf">transactionTokenRequestDataValueProcessor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TransactionTokenRequestDataValueProcessor</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link SystemExceptionResolver} bean.</span>
<span class="cm">     * @param exceptionCodeResolver Bean defined by ApplicationContext#exceptionCodeResolver</span>
<span class="cm">     * @see com.example.todo.config.app.ApplicationContext#exceptionCodeResolver()</span>
<span class="cm">     * @return Bean of configured {@link SystemExceptionResolver}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;systemExceptionResolver&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">SystemExceptionResolver</span><span class="w"> </span><span class="nf">systemExceptionResolver</span><span class="p">(</span>
<span class="w">            </span><span class="n">ExceptionCodeResolver</span><span class="w"> </span><span class="n">exceptionCodeResolver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SystemExceptionResolver</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SystemExceptionResolver</span><span class="p">();</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setExceptionCodeResolver</span><span class="p">(</span><span class="n">exceptionCodeResolver</span><span class="p">);</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setOrder</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="w">        </span><span class="n">Properties</span><span class="w"> </span><span class="n">exceptionMappings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Properties</span><span class="p">();</span>
<span class="w">        </span><span class="n">exceptionMappings</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="s">&quot;ResourceNotFoundException&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;common/error/resourceNotFoundError&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">exceptionMappings</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="s">&quot;BusinessException&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;common/error/businessError&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">exceptionMappings</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="s">&quot;InvalidTransactionTokenException&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;common/error/transactionTokenError&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">exceptionMappings</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="s">&quot;.DataAccessException&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;common/error/dataAccessError&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setExceptionMappings</span><span class="p">(</span><span class="n">exceptionMappings</span><span class="p">);</span>

<span class="w">        </span><span class="n">Properties</span><span class="w"> </span><span class="n">statusCodes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Properties</span><span class="p">();</span>
<span class="w">        </span><span class="n">statusCodes</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="s">&quot;common/error/resourceNotFoundError&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">String</span>
<span class="w">                </span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">.</span><span class="na">value</span><span class="p">()));</span>
<span class="w">        </span><span class="n">statusCodes</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="s">&quot;common/error/businessError&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span>
<span class="w">                </span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">CONFLICT</span><span class="p">.</span><span class="na">value</span><span class="p">()));</span>
<span class="w">        </span><span class="n">statusCodes</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="s">&quot;common/error/transactionTokenError&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">String</span>
<span class="w">                </span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">CONFLICT</span><span class="p">.</span><span class="na">value</span><span class="p">()));</span>
<span class="w">        </span><span class="n">statusCodes</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="s">&quot;common/error/dataAccessError&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span>
<span class="w">                </span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="p">.</span><span class="na">value</span><span class="p">()));</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setStatusCodes</span><span class="p">(</span><span class="n">statusCodes</span><span class="p">);</span>

<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setDefaultErrorView</span><span class="p">(</span><span class="s">&quot;common/error/systemError&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setDefaultStatusCode</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="p">.</span><span class="na">value</span><span class="p">());</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure messages logging AOP.</span>
<span class="cm">     * @param exceptionLogger Bean defined by ApplicationContext#exceptionLogger</span>
<span class="cm">     * @see com.example.todo.config.app.ApplicationContext#exceptionLogger()</span>
<span class="cm">     * @return Bean of configured {@link HandlerExceptionResolverLoggingInterceptor}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;handlerExceptionResolverLoggingInterceptor&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">HandlerExceptionResolverLoggingInterceptor</span><span class="w"> </span><span class="nf">handlerExceptionResolverLoggingInterceptor</span><span class="p">(</span>
<span class="w">            </span><span class="n">ExceptionLogger</span><span class="w"> </span><span class="n">exceptionLogger</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">HandlerExceptionResolverLoggingInterceptor</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HandlerExceptionResolverLoggingInterceptor</span><span class="p">();</span>
<span class="w">        </span><span class="n">bean</span><span class="p">.</span><span class="na">setExceptionLogger</span><span class="p">(</span><span class="n">exceptionLogger</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure messages logging AOP advisor.</span>
<span class="cm">     * @param handlerExceptionResolverLoggingInterceptor Bean defined by #handlerExceptionResolverLoggingInterceptor</span>
<span class="cm">     * @see #handlerExceptionResolverLoggingInterceptor(ExceptionLogger)</span>
<span class="cm">     * @return Advisor configured for PointCut</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Advisor</span><span class="w"> </span><span class="nf">handlerExceptionResolverLoggingInterceptorAdvisor</span><span class="p">(</span>
<span class="w">            </span><span class="n">HandlerExceptionResolverLoggingInterceptor</span><span class="w"> </span><span class="n">handlerExceptionResolverLoggingInterceptor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">AspectJExpressionPointcut</span><span class="w"> </span><span class="n">pointcut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AspectJExpressionPointcut</span><span class="p">();</span>
<span class="w">        </span><span class="n">pointcut</span><span class="p">.</span><span class="na">setExpression</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;execution(* org.springframework.web.servlet.HandlerExceptionResolver.resolveException(..))&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultPointcutAdvisor</span><span class="p">(</span><span class="n">pointcut</span><span class="p">,</span><span class="w"> </span><span class="n">handlerExceptionResolverLoggingInterceptor</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">アプリケーション層のクラスを管理するcom.example.todo.appパッケージ配下をcomponent-scan対象とする。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">プロパティファイルの読み込み設定を行う。</div>
<div class="line">src/main/resources/META-INF/spring直下の任意のプロパティファイルを読み込む。</div>
<div class="line">この設定により、プロパティファイルの値をBean定義ファイル内で<code class="docutils literal notranslate"><span class="pre">${propertyName}</span></code>形式で埋め込んだり、Javaクラスに<code class="docutils literal notranslate"><span class="pre">&#64;Value(&quot;${propertyName}&quot;)</span></code>でインジェクションすることができる。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Spring MVCのアノテーションベースのデフォルト設定を行う。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">静的リソース(css, images, jsなど)アクセスのための設定を行う。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">mapping</span></code>属性にURLのパスを、<code class="docutils literal notranslate"><span class="pre">location</span></code>属性に物理的なパスの設定を行う。</div>
<div class="line">この設定の場合<code class="docutils literal notranslate"><span class="pre">&lt;contextPath&gt;/resources/app/css/styles.css</span></code>に対してリクエストが来た場合、<code class="docutils literal notranslate"><span class="pre">WEB-INF/resources/app/css/styles.css</span></code>を探し、見つからなければクラスパス上(<code class="docutils literal notranslate"><span class="pre">src/main/resources</span></code>やjar内)の<code class="docutils literal notranslate"><span class="pre">META-INF/resources/app/css/styles.css</span></code>を探す。</div>
<div class="line">どこにも<code class="docutils literal notranslate"><span class="pre">styles.css</span></code>が格納されていない場合は、404エラーを返す。</div>
<div class="line">ここでは<code class="docutils literal notranslate"><span class="pre">cache-period</span></code>属性で静的リソースのキャッシュ時間(3600秒=60分)も設定している。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">cache-period=&quot;3600&quot;</span></code>と設定しても良いが、60分であることを明示するために<a class="reference external" href="https://docs.spring.io/spring-framework/docs/6.1.3/reference/html/core.html#expressions-beandef-xml-based">SpEL</a>を使用して <code class="docutils literal notranslate"><span class="pre">cache-period=&quot;#{60</span> <span class="pre">*</span> <span class="pre">60}&quot;</span></code>と書く方が分かりやすい。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">コントローラ処理のTraceログを出力するインターセプタを設定する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">/resources</span></code>配下を除く任意のパスに適用されるように設定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">ViewResolver</span></code>の設定を行う。</div>
<div class="line">画面のレンダリングをThymeleafに委譲し、<code class="docutils literal notranslate"><span class="pre">forceContentType</span></code>属性により<code class="docutils literal notranslate"><span class="pre">contentType</span></code>属性に指定したコンテンツタイプ（<code class="docutils literal notranslate"><span class="pre">text/html;charset=UTF-8</span></code>）をレスポンスに設定している。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">TemplateResolver</span></code>の設定を行う。</div>
<div class="line">この設定により、例えばコントローラからview名として<code class="docutils literal notranslate"><span class="pre">hello</span></code>が返却された場合には<code class="docutils literal notranslate"><span class="pre">/WEB-INF/views/hello.html</span></code>がテンプレートとして処理される。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>JPA用のブランクプロジェクトを作成した場合は、<code class="docutils literal notranslate"><span class="pre">addInterceptors</span></code>の定義として、<code class="docutils literal notranslate"><span class="pre">OpenEntityManagerInViewInterceptor</span></code>の定義が有効な状態となっている。</p>
<blockquote>
<div><div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addInterceptors</span><span class="p">(</span><span class="n">InterceptorRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">addInterceptor</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span><span class="w"> </span><span class="n">traceLoggingInterceptor</span><span class="p">());</span>
<span class="w">    </span><span class="n">addInterceptor</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span><span class="w"> </span><span class="n">transactionTokenInterceptor</span><span class="p">());</span>
<span class="w">    </span><span class="n">addInterceptor</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span><span class="w"> </span><span class="n">codeListInterceptor</span><span class="p">());</span>
<span class="w">    </span><span class="n">addWebRequestInterceptor</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span><span class="w"> </span><span class="n">openEntityManagerInViewInterceptor</span><span class="p">());</span>
<span class="p">}</span>

<span class="nd">@Bean</span>
<span class="kd">public</span><span class="w"> </span><span class="n">OpenEntityManagerInViewInterceptor</span><span class="w"> </span><span class="nf">openEntityManagerInViewInterceptor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OpenEntityManagerInViewInterceptor</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">OpenEntityManagerInViewInterceptor</span></code>は、<code class="docutils literal notranslate"><span class="pre">EntityManager</span></code>のライフサイクルの開始と終了を行う<code class="docutils literal notranslate"><span class="pre">Interceptor</span></code>である。この設定を追加することで、アプリケーション層(Controllerや、Viewクラス)でのLazy Loadが、サポートされる。</p>
</div>
</div><div aria-labelledby="tab-15-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-15-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><p><code class="file docutils literal notranslate"><span class="pre">spring-mvc.xml</span></code>には、Spring MVCに関する定義を行う。</p>
<div class="line-block">
<div class="line">作成したブランクプロジェクトの<code class="file docutils literal notranslate"><span class="pre">src/main/resources/META-INF/spring/spring-mvc.xml</span></code>は、以下のような設定となっている。</div>
<div class="line">なお、チュートリアルで使用しないコンポーネントについての説明は割愛する。</div>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
<span class="w">    </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="w">    </span><span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
<span class="w">    </span><span class="na">xmlns:mvc=</span><span class="s">&quot;http://www.springframework.org/schema/mvc&quot;</span>
<span class="w">    </span><span class="na">xmlns:util=</span><span class="s">&quot;http://www.springframework.org/schema/util&quot;</span>
<span class="w">    </span><span class="na">xmlns:aop=</span><span class="s">&quot;http://www.springframework.org/schema/aop&quot;</span>
<span class="w">    </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd</span>
<span class="s">        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">        http://www.springframework.org/schema/util https://www.springframework.org/schema/util/spring-util.xsd</span>
<span class="s">        http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd</span>
<span class="s">        http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd</span>
<span class="s">    &quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;context:property-placeholder</span>
<span class="w">        </span><span class="na">location=</span><span class="s">&quot;classpath*:/META-INF/spring/*.properties&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;mvc:annotation-driven&gt;</span>
<span class="w">        </span><span class="nt">&lt;mvc:argument-resolvers&gt;</span>
<span class="w">            </span><span class="nt">&lt;bean</span>
<span class="w">                </span><span class="na">class=</span><span class="s">&quot;org.springframework.data.web.PageableHandlerMethodArgumentResolver&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;bean</span>
<span class="w">                </span><span class="na">class=</span><span class="s">&quot;org.springframework.security.web.method.annotation.AuthenticationPrincipalArgumentResolver&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/mvc:argument-resolvers&gt;</span>
<span class="w">    </span><span class="nt">&lt;/mvc:annotation-driven&gt;</span>

<span class="w">    </span><span class="nt">&lt;mvc:default-servlet-handler</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (3) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;context:component-scan</span><span class="w"> </span><span class="na">base-package=</span><span class="s">&quot;com.example.todo.app&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (4) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;mvc:resources</span><span class="w"> </span><span class="na">mapping=</span><span class="s">&quot;/resources/**&quot;</span>
<span class="w">        </span><span class="na">location=</span><span class="s">&quot;/resources/,classpath:META-INF/resources/&quot;</span>
<span class="w">        </span><span class="na">cache-period=</span><span class="s">&quot;#{60 * 60}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="nt">&lt;mvc:interceptors&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- (5) --&gt;</span>
<span class="w">        </span><span class="nt">&lt;mvc:interceptor&gt;</span>
<span class="w">            </span><span class="nt">&lt;mvc:mapping</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;/**&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;mvc:exclude-mapping</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;/resources/**&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;bean</span>
<span class="w">                </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.logging.TraceLoggingInterceptor&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/mvc:interceptor&gt;</span>
<span class="w">        </span><span class="nt">&lt;mvc:interceptor&gt;</span>
<span class="w">            </span><span class="nt">&lt;mvc:mapping</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;/**&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;mvc:exclude-mapping</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;/resources/**&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;bean</span>
<span class="w">                </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.token.transaction.TransactionTokenInterceptor&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/mvc:interceptor&gt;</span>
<span class="w">        </span><span class="nt">&lt;mvc:interceptor&gt;</span>
<span class="w">            </span><span class="nt">&lt;mvc:mapping</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;/**&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;mvc:exclude-mapping</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;/resources/**&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.codelist.CodeListInterceptor&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;codeListIdPattern&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;CL_.+&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/bean&gt;</span>
<span class="w">        </span><span class="nt">&lt;/mvc:interceptor&gt;</span>
<span class="w">        </span><span class="cm">&lt;!--  REMOVE THIS LINE IF YOU USE JPA</span>
<span class="cm">        &lt;mvc:interceptor&gt;</span>
<span class="cm">            &lt;mvc:mapping path=&quot;/**&quot; /&gt;</span>
<span class="cm">            &lt;mvc:exclude-mapping path=&quot;/resources/**&quot; /&gt;</span>
<span class="cm">            &lt;bean</span>
<span class="cm">                class=&quot;org.springframework.orm.jpa.support.OpenEntityManagerInViewInterceptor&quot; /&gt;</span>
<span class="cm">        &lt;/mvc:interceptor&gt;</span>
<span class="cm">            REMOVE THIS LINE IF YOU USE JPA  --&gt;</span>
<span class="w">    </span><span class="nt">&lt;/mvc:interceptors&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (6) --&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- Settings View Resolver. --&gt;</span>
<span class="w">    </span><span class="nt">&lt;mvc:view-resolvers&gt;</span>
<span class="w">        </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.thymeleaf.spring6.view.ThymeleafViewResolver&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;templateEngine&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;templateEngine&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;characterEncoding&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;UTF-8&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;forceContentType&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;contentType&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;text/html;charset=UTF-8&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/bean&gt;</span>
<span class="w">    </span><span class="nt">&lt;/mvc:view-resolvers&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (7) --&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- TemplateResolver. --&gt;</span>
<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;templateResolver&quot;</span>
<span class="w">        </span><span class="na">class=</span><span class="s">&quot;org.thymeleaf.spring6.templateresolver.SpringResourceTemplateResolver&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;prefix&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;/WEB-INF/views/&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;suffix&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;.html&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;templateMode&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;HTML&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;characterEncoding&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;UTF-8&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- TemplateEngine. --&gt;</span>
<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;templateEngine&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.thymeleaf.spring6.SpringTemplateEngine&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;templateResolver&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;templateResolver&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;enableSpringELCompiler&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;additionalDialects&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;set&gt;</span>
<span class="w">                </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.thymeleaf.extras.springsecurity6.dialect.SpringSecurityDialect&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/set&gt;</span>
<span class="w">        </span><span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span>

<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;requestDataValueProcessor&quot;</span>
<span class="w">        </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.mvc.support.CompositeRequestDataValueProcessor&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;constructor-arg&gt;</span>
<span class="w">            </span><span class="nt">&lt;util:list&gt;</span>
<span class="w">                </span><span class="nt">&lt;bean</span>
<span class="w">                    </span><span class="na">class=</span><span class="s">&quot;org.springframework.security.web.servlet.support.csrf.CsrfRequestDataValueProcessor&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;bean</span>
<span class="w">                    </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.token.transaction.TransactionTokenRequestDataValueProcessor&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/util:list&gt;</span>
<span class="w">        </span><span class="nt">&lt;/constructor-arg&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- Setting Exception Handling. --&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- Exception Resolver. --&gt;</span>
<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;systemExceptionResolver&quot;</span>
<span class="w">        </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.exception.SystemExceptionResolver&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;exceptionCodeResolver&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;exceptionCodeResolver&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- Setting and Customization by project. --&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;order&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;3&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;exceptionMappings&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;map&gt;</span>
<span class="w">                </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;ResourceNotFoundException&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;common/error/resourceNotFoundError&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;BusinessException&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;common/error/businessError&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;InvalidTransactionTokenException&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;common/error/transactionTokenError&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;.DataAccessException&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;common/error/dataAccessError&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/map&gt;</span>
<span class="w">        </span><span class="nt">&lt;/property&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;statusCodes&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;map&gt;</span>
<span class="w">                </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;common/error/resourceNotFoundError&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;404&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;common/error/businessError&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;409&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;common/error/transactionTokenError&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;409&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;common/error/dataAccessError&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;500&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/map&gt;</span>
<span class="w">        </span><span class="nt">&lt;/property&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;excludedExceptions&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;array&gt;</span>
<span class="w">            </span><span class="nt">&lt;/array&gt;</span>
<span class="w">        </span><span class="nt">&lt;/property&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;defaultErrorView&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;common/error/systemError&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;defaultStatusCode&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;500&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- Setting AOP. --&gt;</span>
<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;handlerExceptionResolverLoggingInterceptor&quot;</span>
<span class="w">        </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.exception.HandlerExceptionResolverLoggingInterceptor&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;exceptionLogger&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;exceptionLogger&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span>
<span class="w">    </span><span class="nt">&lt;aop:config&gt;</span>
<span class="w">        </span><span class="nt">&lt;aop:advisor</span><span class="w"> </span><span class="na">advice-ref=</span><span class="s">&quot;handlerExceptionResolverLoggingInterceptor&quot;</span>
<span class="w">            </span><span class="na">pointcut=</span><span class="s">&quot;execution(* org.springframework.web.servlet.HandlerExceptionResolver.resolveException(..))&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/aop:config&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">プロパティファイルの読み込み設定を行う。</div>
<div class="line">src/main/resources/META-INF/spring直下の任意のプロパティファイルを読み込む。</div>
<div class="line">この設定により、プロパティファイルの値をBean定義ファイル内で<code class="docutils literal notranslate"><span class="pre">${propertyName}</span></code>形式で埋め込んだり、Javaクラスに<code class="docutils literal notranslate"><span class="pre">&#64;Value(&quot;${propertyName}&quot;)</span></code>でインジェクションすることができる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Spring MVCのアノテーションベースのデフォルト設定を行う。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">アプリケーション層のクラスを管理するcom.example.todo.appパッケージ配下をcomponent-scan対象とする。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">静的リソース(css, images, jsなど)アクセスのための設定を行う。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">mapping</span></code>属性にURLのパスを、<code class="docutils literal notranslate"><span class="pre">location</span></code>属性に物理的なパスの設定を行う。</div>
<div class="line">この設定の場合<code class="docutils literal notranslate"><span class="pre">&lt;contextPath&gt;/resources/app/css/styles.css</span></code>に対してリクエストが来た場合、<code class="docutils literal notranslate"><span class="pre">WEB-INF/resources/app/css/styles.css</span></code>を探し、見つからなければクラスパス上(<code class="docutils literal notranslate"><span class="pre">src/main/resources</span></code>やjar内)の<code class="docutils literal notranslate"><span class="pre">META-INF/resources/app/css/styles.css</span></code>を探す。</div>
<div class="line">どこにも<code class="docutils literal notranslate"><span class="pre">styles.css</span></code>が格納されていない場合は、404エラーを返す。</div>
<div class="line">ここでは<code class="docutils literal notranslate"><span class="pre">cache-period</span></code>属性で静的リソースのキャッシュ時間(3600秒=60分)も設定している。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">cache-period=&quot;3600&quot;</span></code>と設定しても良いが、60分であることを明示するために<a class="reference external" href="https://docs.spring.io/spring-framework/docs/6.1.3/reference/html/core.html#expressions-beandef-xml-based">SpEL</a>を使用して <code class="docutils literal notranslate"><span class="pre">cache-period=&quot;#{60</span> <span class="pre">*</span> <span class="pre">60}&quot;</span></code>と書く方が分かりやすい。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">コントローラ処理のTraceログを出力するインターセプタを設定する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">/resources</span></code>配下を除く任意のパスに適用されるように設定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">ViewResolver</span></code>の設定を行う。</div>
<div class="line">画面のレンダリングをThymeleafに委譲し、<code class="docutils literal notranslate"><span class="pre">forceContentType</span></code>属性により<code class="docutils literal notranslate"><span class="pre">contentType</span></code>属性に指定したコンテンツタイプ（<code class="docutils literal notranslate"><span class="pre">text/html;charset=UTF-8</span></code>）をレスポンスに設定している。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">TemplateResolver</span></code>の設定を行う。</div>
<div class="line">この設定により、例えばコントローラからview名として<code class="docutils literal notranslate"><span class="pre">hello</span></code>が返却された場合には<code class="docutils literal notranslate"><span class="pre">/WEB-INF/views/hello.html</span></code>がテンプレートとして処理される。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>JPA用のブランクプロジェクトを作成した場合は、<code class="docutils literal notranslate"><span class="pre">&lt;mvc:interceptors&gt;</span></code>の定義として、<code class="docutils literal notranslate"><span class="pre">OpenEntityManagerInViewInterceptor</span></code>の定義が有効な状態となっている。</p>
<blockquote>
<div><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;mvc:interceptor&gt;</span>
<span class="w">    </span><span class="nt">&lt;mvc:mapping</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;/**&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;mvc:exclude-mapping</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;/resources/**&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;bean</span>
<span class="w">        </span><span class="na">class=</span><span class="s">&quot;org.springframework.orm.jpa.support.OpenEntityManagerInViewInterceptor&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/mvc:interceptor&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">OpenEntityManagerInViewInterceptor</span></code>は、<code class="docutils literal notranslate"><span class="pre">EntityManager</span></code>のライフサイクルの開始と終了を行う<code class="docutils literal notranslate"><span class="pre">Interceptor</span></code>である。この設定を追加することで、アプリケーション層(Controllerや、Viewクラス)でのLazy Loadが、サポートされる。</p>
</div>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="spring-security">
<h5><span class="section-number">11.2.8.1.2.7. </span>spring-security<a class="headerlink" href="#spring-security" title="Permalink to this heading">¶</a></h5>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-16-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-16-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-16-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-16-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-16-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-16-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><p><code class="file docutils literal notranslate"><span class="pre">SpringSecurityConfig.java</span></code>には、Spring Securityに関する定義を行う。</p>
<div class="line-block">
<div class="line">作成したブランクプロジェクトの<code class="file docutils literal notranslate"><span class="pre">src/main/java/com/example/todo/config/web/SpringSecurityConfig.java</span></code>は、以下のような設定となっている。</div>
<div class="line">なお、本チュートリアルではSpring Securityの設定ファイルの説明は割愛する。Spring Securityの設定ファイルについては、「<a class="reference internal" href="TutorialSecurity.html"><span class="doc">Spring Securityチュートリアル</span></a>」を参照されたい。</div>
</div>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.todo.config.web</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.LinkedHashMap</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.access.AccessDeniedException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.config.Customizer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.config.annotation.web.configuration.WebSecurityCustomizer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.web.SecurityFilterChain</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.web.access.AccessDeniedHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.web.access.AccessDeniedHandlerImpl</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.web.access.DelegatingAccessDeniedHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.web.access.expression.DefaultWebSecurityExpressionHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.web.authentication.AnonymousAuthenticationFilter</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.web.csrf.InvalidCsrfTokenException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.web.csrf.MissingCsrfTokenException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.web.util.matcher.AntPathRequestMatcher</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.security.web.logging.UserIdMDCPutFilter</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Bean definition to configure SpringSecurity.</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SpringSecurityConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure ignore security pattern.</span>
<span class="cm">     * @return Bean of configured {@link WebSecurityCustomizer}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">WebSecurityCustomizer</span><span class="w"> </span><span class="nf">webSecurityCustomizer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">web</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">web</span><span class="p">.</span><span class="na">ignoring</span><span class="p">().</span><span class="na">requestMatchers</span><span class="p">(</span>
<span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">AntPathRequestMatcher</span><span class="p">(</span><span class="s">&quot;/resources/**&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link SecurityFilterChain} bean.</span>
<span class="cm">     * @param http Builder class for setting up authentication and authorization</span>
<span class="cm">     * @return Bean of configured {@link SecurityFilterChain}</span>
<span class="cm">     * @throws Exception Exception that occurs when setting HttpSecurity</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">SecurityFilterChain</span><span class="w"> </span><span class="nf">filterChain</span><span class="p">(</span><span class="n">HttpSecurity</span><span class="w"> </span><span class="n">http</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">http</span><span class="p">.</span><span class="na">formLogin</span><span class="p">(</span><span class="n">Customizer</span><span class="p">.</span><span class="na">withDefaults</span><span class="p">());</span>
<span class="w">        </span><span class="n">http</span><span class="p">.</span><span class="na">logout</span><span class="p">(</span><span class="n">Customizer</span><span class="p">.</span><span class="na">withDefaults</span><span class="p">());</span>
<span class="w">        </span><span class="n">http</span><span class="p">.</span><span class="na">exceptionHandling</span><span class="p">(</span><span class="n">ex</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ex</span><span class="p">.</span><span class="na">accessDeniedHandler</span><span class="p">(</span>
<span class="w">                </span><span class="n">accessDeniedHandler</span><span class="p">()));</span>
<span class="w">        </span><span class="n">http</span><span class="p">.</span><span class="na">addFilterAfter</span><span class="p">(</span><span class="n">userIdMDCPutFilter</span><span class="p">(),</span>
<span class="w">                </span><span class="n">AnonymousAuthenticationFilter</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">        </span><span class="n">http</span><span class="p">.</span><span class="na">sessionManagement</span><span class="p">(</span><span class="n">Customizer</span><span class="p">.</span><span class="na">withDefaults</span><span class="p">());</span>
<span class="w">        </span><span class="n">http</span><span class="p">.</span><span class="na">authorizeHttpRequests</span><span class="p">(</span><span class="n">authz</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">authz</span><span class="p">.</span><span class="na">requestMatchers</span><span class="p">(</span>
<span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">AntPathRequestMatcher</span><span class="p">(</span><span class="s">&quot;/**&quot;</span><span class="p">)).</span><span class="na">permitAll</span><span class="p">());</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">http</span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link AccessDeniedHandler} bean.</span>
<span class="cm">     * @return Bean of configured {@link AccessDeniedHandler}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;accessDeniedHandler&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">AccessDeniedHandler</span><span class="w"> </span><span class="nf">accessDeniedHandler</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">LinkedHashMap</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&lt;?</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AccessDeniedException</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">AccessDeniedHandler</span><span class="o">&gt;</span><span class="w"> </span><span class="n">errorHandlers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LinkedHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Invalid CSRF authenticator error handler</span>
<span class="w">        </span><span class="n">AccessDeniedHandlerImpl</span><span class="w"> </span><span class="n">invalidCsrfTokenErrorHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AccessDeniedHandlerImpl</span><span class="p">();</span>
<span class="w">        </span><span class="n">invalidCsrfTokenErrorHandler</span><span class="p">.</span><span class="na">setErrorPage</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;/common/error/invalidCsrfTokenError&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">errorHandlers</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">InvalidCsrfTokenException</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
<span class="w">                </span><span class="n">invalidCsrfTokenErrorHandler</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Missing CSRF authenticator error handler</span>
<span class="w">        </span><span class="n">AccessDeniedHandlerImpl</span><span class="w"> </span><span class="n">missingCsrfTokenErrorHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AccessDeniedHandlerImpl</span><span class="p">();</span>
<span class="w">        </span><span class="n">missingCsrfTokenErrorHandler</span><span class="p">.</span><span class="na">setErrorPage</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;/common/error/missingCsrfTokenError&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">errorHandlers</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">MissingCsrfTokenException</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
<span class="w">                </span><span class="n">missingCsrfTokenErrorHandler</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Default error handler</span>
<span class="w">        </span><span class="n">AccessDeniedHandlerImpl</span><span class="w"> </span><span class="n">defaultErrorHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AccessDeniedHandlerImpl</span><span class="p">();</span>
<span class="w">        </span><span class="n">defaultErrorHandler</span><span class="p">.</span><span class="na">setErrorPage</span><span class="p">(</span><span class="s">&quot;/common/error/accessDeniedError&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DelegatingAccessDeniedHandler</span><span class="p">(</span><span class="n">errorHandlers</span><span class="p">,</span><span class="w"> </span><span class="n">defaultErrorHandler</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link DefaultWebSecurityExpressionHandler} bean.</span>
<span class="cm">     * @return Bean of configured {@link DefaultWebSecurityExpressionHandler}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;webSecurityExpressionHandler&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">DefaultWebSecurityExpressionHandler</span><span class="w"> </span><span class="nf">webSecurityExpressionHandler</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultWebSecurityExpressionHandler</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Configure {@link UserIdMDCPutFilter} bean.</span>
<span class="cm">     * @return Bean of configured {@link UserIdMDCPutFilter}</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;userIdMDCPutFilter&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">UserIdMDCPutFilter</span><span class="w"> </span><span class="nf">userIdMDCPutFilter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserIdMDCPutFilter</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-16-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-16-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><p><code class="file docutils literal notranslate"><span class="pre">spring-security.xml</span></code>には、Spring Securityに関する定義を行う。</p>
<div class="line-block">
<div class="line">作成したブランクプロジェクトの<code class="file docutils literal notranslate"><span class="pre">src/main/resources/META-INF/spring/spring-security.xml</span></code>は、以下のような設定となっている。</div>
<div class="line">なお、本チュートリアルではSpring Securityの設定ファイルの説明は割愛する。Spring Securityの設定ファイルについては、「<a class="reference internal" href="TutorialSecurity.html"><span class="doc">Spring Securityチュートリアル</span></a>」を参照されたい。</div>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
<span class="w">    </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="w">    </span><span class="na">xmlns:sec=</span><span class="s">&quot;http://www.springframework.org/schema/security&quot;</span>
<span class="w">    </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;</span>
<span class="s">        http://www.springframework.org/schema/security https://www.springframework.org/schema/security/spring-security.xsd</span>
<span class="s">        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">    &quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;sec:http</span><span class="w"> </span><span class="na">pattern=</span><span class="s">&quot;/resources/**&quot;</span><span class="w"> </span><span class="na">request-matcher=</span><span class="s">&quot;ant&quot;</span><span class="w"> </span><span class="na">security=</span><span class="s">&quot;none&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;sec:http</span><span class="w"> </span><span class="na">request-matcher=</span><span class="s">&quot;ant&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;sec:form-login/&gt;</span>
<span class="w">        </span><span class="nt">&lt;sec:logout/&gt;</span>
<span class="w">        </span><span class="nt">&lt;sec:access-denied-handler</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;accessDeniedHandler&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;sec:custom-filter</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;userIdMDCPutFilter&quot;</span><span class="w"> </span><span class="na">after=</span><span class="s">&quot;ANONYMOUS_FILTER&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;sec:session-management</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;sec:intercept-url</span><span class="w"> </span><span class="na">pattern=</span><span class="s">&quot;/**&quot;</span><span class="w"> </span><span class="na">access=</span><span class="s">&quot;permitAll&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/sec:http&gt;</span>

<span class="w">    </span><span class="nt">&lt;sec:authentication-manager</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- CSRF Protection --&gt;</span>
<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;accessDeniedHandler&quot;</span>
<span class="w">        </span><span class="na">class=</span><span class="s">&quot;org.springframework.security.web.access.DelegatingAccessDeniedHandler&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;constructor-arg</span><span class="w"> </span><span class="na">index=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;map&gt;</span>
<span class="w">                </span><span class="nt">&lt;entry</span>
<span class="w">                    </span><span class="na">key=</span><span class="s">&quot;org.springframework.security.web.csrf.InvalidCsrfTokenException&quot;</span><span class="nt">&gt;</span>
<span class="w">                    </span><span class="nt">&lt;bean</span>
<span class="w">                        </span><span class="na">class=</span><span class="s">&quot;org.springframework.security.web.access.AccessDeniedHandlerImpl&quot;</span><span class="nt">&gt;</span>
<span class="w">                        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;errorPage&quot;</span>
<span class="w">                            </span><span class="na">value=</span><span class="s">&quot;/common/error/invalidCsrfTokenError&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                    </span><span class="nt">&lt;/bean&gt;</span>
<span class="w">                </span><span class="nt">&lt;/entry&gt;</span>
<span class="w">                </span><span class="nt">&lt;entry</span>
<span class="w">                    </span><span class="na">key=</span><span class="s">&quot;org.springframework.security.web.csrf.MissingCsrfTokenException&quot;</span><span class="nt">&gt;</span>
<span class="w">                    </span><span class="nt">&lt;bean</span>
<span class="w">                        </span><span class="na">class=</span><span class="s">&quot;org.springframework.security.web.access.AccessDeniedHandlerImpl&quot;</span><span class="nt">&gt;</span>
<span class="w">                        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;errorPage&quot;</span>
<span class="w">                            </span><span class="na">value=</span><span class="s">&quot;/common/error/missingCsrfTokenError&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                    </span><span class="nt">&lt;/bean&gt;</span>
<span class="w">                </span><span class="nt">&lt;/entry&gt;</span>
<span class="w">            </span><span class="nt">&lt;/map&gt;</span>
<span class="w">        </span><span class="nt">&lt;/constructor-arg&gt;</span>
<span class="w">        </span><span class="nt">&lt;constructor-arg</span><span class="w"> </span><span class="na">index=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;bean</span>
<span class="w">                </span><span class="na">class=</span><span class="s">&quot;org.springframework.security.web.access.AccessDeniedHandlerImpl&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;errorPage&quot;</span>
<span class="w">                    </span><span class="na">value=</span><span class="s">&quot;/common/error/accessDeniedError&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/bean&gt;</span>
<span class="w">        </span><span class="nt">&lt;/constructor-arg&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span>

<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;webSecurityExpressionHandler&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.springframework.security.web.access.expression.DefaultWebSecurityExpressionHandler&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- Put UserID into MDC --&gt;</span>
<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;userIdMDCPutFilter&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.security.web.logging.UserIdMDCPutFilter&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="logback-xml">
<h4><a class="toc-backref" href="#id103" role="doc-backlink"><span class="section-number">11.2.8.1.3. </span>logback.xml</a><a class="headerlink" href="#logback-xml" title="Permalink to this heading">¶</a></h4>
<p><code class="file docutils literal notranslate"><span class="pre">logback.xml</span></code>には、ログ出力に関する定義を行う。</p>
<div class="line-block">
<div class="line">作成したブランクプロジェクトの<code class="file docutils literal notranslate"><span class="pre">src/main/resources/logback.xml</span></code>は、以下のような設定となっている。</div>
<div class="line">なお、チュートリアルで使用しないログ設定についての説明は割愛する。</div>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE configuration&gt;</span>
<span class="nt">&lt;configuration&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;appender</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;STDOUT&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;encoder&gt;</span>
<span class="w">            </span><span class="nt">&lt;pattern&gt;</span><span class="cp">&lt;![CDATA[date:%d{yyyy-MM-dd HH:mm:ss}\tthread:%thread\tX-Track:%X{X-Track}\tlevel:%-5level\tlogger:%-48logger{48}\tmessage:%replace(%msg){&#39;(\r\n|\r|\n)&#39;,&#39;$1  &#39;}%n%replace(%replace(%xEx){&#39;(\r\n|\r|\n)&#39;,&#39;$1  &#39;}){&#39;  $&#39;,&#39;&#39;}%nopex]]&gt;</span><span class="nt">&lt;/pattern&gt;</span>
<span class="w">        </span><span class="nt">&lt;/encoder&gt;</span>
<span class="w">    </span><span class="nt">&lt;/appender&gt;</span>

<span class="w">    </span><span class="nt">&lt;appender</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;APPLICATION_LOG_FILE&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;file&gt;</span>${app.log.dir:-log}/todo-application.log<span class="nt">&lt;/file&gt;</span>
<span class="w">        </span><span class="nt">&lt;rollingPolicy</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;fileNamePattern&gt;</span>${app.log.dir:-log}/todo-application-%d{yyyyMMdd}.log<span class="nt">&lt;/fileNamePattern&gt;</span>
<span class="w">            </span><span class="nt">&lt;maxHistory&gt;</span>7<span class="nt">&lt;/maxHistory&gt;</span>
<span class="w">        </span><span class="nt">&lt;/rollingPolicy&gt;</span>
<span class="w">        </span><span class="nt">&lt;encoder&gt;</span>
<span class="w">            </span><span class="nt">&lt;charset&gt;</span>UTF-8<span class="nt">&lt;/charset&gt;</span>
<span class="w">            </span><span class="nt">&lt;pattern&gt;</span><span class="cp">&lt;![CDATA[date:%d{yyyy-MM-dd HH:mm:ss}\tthread:%thread\tX-Track:%X{X-Track}\tlevel:%-5level\tlogger:%-48logger{48}\tmessage:%replace(%msg){&#39;(\r\n|\r|\n)&#39;,&#39;$1  &#39;}%n%replace(%replace(%xEx){&#39;(\r\n|\r|\n)&#39;,&#39;$1  &#39;}){&#39;  $&#39;,&#39;&#39;}%nopex]]&gt;</span><span class="nt">&lt;/pattern&gt;</span>
<span class="w">        </span><span class="nt">&lt;/encoder&gt;</span>
<span class="w">    </span><span class="nt">&lt;/appender&gt;</span>

<span class="w">    </span><span class="nt">&lt;appender</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;MONITORING_LOG_FILE&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;file&gt;</span>${app.log.dir:-log}/todo-monitoring.log<span class="nt">&lt;/file&gt;</span>
<span class="w">        </span><span class="nt">&lt;rollingPolicy</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;fileNamePattern&gt;</span>${app.log.dir:-log}/todo-monitoring-%d{yyyyMMdd}.log<span class="nt">&lt;/fileNamePattern&gt;</span>
<span class="w">            </span><span class="nt">&lt;maxHistory&gt;</span>7<span class="nt">&lt;/maxHistory&gt;</span>
<span class="w">        </span><span class="nt">&lt;/rollingPolicy&gt;</span>
<span class="w">        </span><span class="nt">&lt;encoder&gt;</span>
<span class="w">            </span><span class="nt">&lt;charset&gt;</span>UTF-8<span class="nt">&lt;/charset&gt;</span>
<span class="w">            </span><span class="nt">&lt;pattern&gt;</span><span class="cp">&lt;![CDATA[date:%d{yyyy-MM-dd HH:mm:ss}\tX-Track:%X{X-Track}\tlevel:%-5level\tmessage:%replace(%msg){&#39;(\r\n|\r|\n)&#39;,&#39;$1  &#39;}%n%replace(%replace(%xEx){&#39;(\r\n|\r|\n)&#39;,&#39;$1  &#39;}){&#39;  $&#39;,&#39;&#39;}%nopex]]&gt;</span><span class="nt">&lt;/pattern&gt;</span>
<span class="w">        </span><span class="nt">&lt;/encoder&gt;</span>
<span class="w">    </span><span class="nt">&lt;/appender&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- Application Loggers --&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;logger</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;com.example.todo&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;level</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;debug&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/logger&gt;</span>

<span class="w">    </span><span class="nt">&lt;logger</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;com.example.todo.domain.repository&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;level</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;trace&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/logger&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- TERASOLUNA --&gt;</span>
<span class="w">    </span><span class="nt">&lt;logger</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;org.terasoluna.gfw&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;level</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;info&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/logger&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- (3) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;logger</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;org.terasoluna.gfw.web.logging.TraceLoggingInterceptor&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;level</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;trace&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/logger&gt;</span>
<span class="w">    </span><span class="nt">&lt;logger</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;org.terasoluna.gfw.common.exception.ExceptionLogger&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;level</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;info&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/logger&gt;</span>
<span class="w">    </span><span class="nt">&lt;logger</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;org.terasoluna.gfw.common.exception.ExceptionLogger.Monitoring&quot;</span><span class="w"> </span><span class="na">additivity=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;level</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;error&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;appender-ref</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;MONITORING_LOG_FILE&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/logger&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- 3rdparty Loggers --&gt;</span>
<span class="w">    </span><span class="nt">&lt;logger</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;org.springframework&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;level</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;warn&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/logger&gt;</span>

<span class="w">    </span><span class="nt">&lt;logger</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;org.springframework.web.servlet&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;level</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;info&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/logger&gt;</span>

<span class="w">    </span><span class="nt">&lt;logger</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;level</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;trace&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/logger&gt;</span>

<span class="w">    </span><span class="nt">&lt;logger</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;level</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;trace&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/logger&gt;</span>

<span class="w">    </span><span class="cm">&lt;!--  REMOVE THIS LINE IF YOU USE JPA</span>
<span class="cm">    &lt;logger name=&quot;org.hibernate.SQL&quot; additivity=&quot;true&quot;&gt;</span>
<span class="cm">        &lt;level value=&quot;debug&quot; /&gt;</span>
<span class="cm">    &lt;/logger&gt;</span>
<span class="cm">    &lt;logger name=&quot;org.hibernate.type&quot;&gt;</span>
<span class="cm">        &lt;level value=&quot;trace&quot; /&gt;</span>
<span class="cm">    &lt;/logger&gt;</span>
<span class="cm">    &lt;logger name=&quot;org.hibernate.engine.transaction&quot;&gt;</span>
<span class="cm">        &lt;level value=&quot;debug&quot; /&gt;</span>
<span class="cm">    &lt;/logger&gt;</span>
<span class="cm">          REMOVE THIS LINE IF YOU USE JPA  --&gt;</span>
<span class="w">    </span><span class="cm">&lt;!--  REMOVE THIS LINE IF YOU USE MyBatis3</span>
<span class="cm">    &lt;logger name=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span>
<span class="cm">        &lt;level value=&quot;debug&quot; /&gt;</span>
<span class="cm">    &lt;/logger&gt;</span>
<span class="cm">          REMOVE THIS LINE IF YOU USE MyBatis3  --&gt;</span>

<span class="w">    </span><span class="nt">&lt;root</span><span class="w"> </span><span class="na">level=</span><span class="s">&quot;warn&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;appender-ref</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;STDOUT&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;appender-ref</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;APPLICATION_LOG_FILE&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/root&gt;</span>

<span class="nt">&lt;/configuration&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">標準出力でログを出力するアペンダを設定。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">com.example.todoパッケージ以下はdebugレベル以上を出力するように設定。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">spring-mvc.xmlまたはSpringMvcConfig.javaに設定した<code class="docutils literal notranslate"><span class="pre">TraceLoggingInterceptor</span></code>に出力されるようにtraceレベルで設定。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>O/R Mapperを使用するブランクプロジェクトを作成した場合は、それぞれのO/R Mapperのログを出力するロガーが有効な状態となっている。</p>
<ul>
<li><p>JPA用のブランクプロジェクト</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;logger</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;org.hibernate.SQL&quot;</span><span class="w"> </span><span class="na">additivity=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;level</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;debug&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/logger&gt;</span>
<span class="nt">&lt;logger</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;org.hibernate.type&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;level</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;trace&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/logger&gt;</span>
<span class="nt">&lt;logger</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;org.hibernate.engine.transaction&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;level</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;debug&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/logger&gt;</span>
</pre></div>
</div>
</li>
<li><p>MyBatis3用のブランクプロジェクト</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;logger</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;com.example.todo&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;level</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;debug&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/logger&gt;</span>

<span class="nt">&lt;logger</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;com.example.todo.domain.repository&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;level</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;trace&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/logger&gt;</span>

<span class="cm">&lt;!-- omitted --&gt;</span>

<span class="nt">&lt;logger</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;level</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;debug&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/logger&gt;</span>
</pre></div>
</div>
</li>
</ul>
</div>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="TutorialREST.html" title="11.3. チュートリアル(Todoアプリケーション REST編)"
             >next</a> |</li>
        <li class="right" >
          <a href="TutorialTodo.html" title="11.1. チュートリアル(Todoアプリケーション JSP編)"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.9.0.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" ><span class="section-number">11. </span>チュートリアル</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">11.2. </span>チュートリアル(Todoアプリケーション Thymeleaf編)</a></li> 
      </ul>
    </div>
    <div class="footer">
      © Copyright 2024, NTT DATA Group Corporation. © Copyright 2013, NTT Corporation.
      Created using <a href="https://www.sphinx-doc.org/en/master/">Sphinx</a> 7.0.1.Theme is <a href="https://pypi.org/project/solar-theme/">Solar</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    </script>
  </body>
</html>