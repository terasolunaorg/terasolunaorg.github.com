<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>3. Tutorial (Todo Application) &#8212; TERASOLUNA Global Framework Development Guideline 1.0.2.RELEASE documentation</title>
    <link rel="stylesheet" href="../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.2.RELEASE',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4. Application Development using TERASOLUNA Global Framework" href="../ImplementationAtEachLayer/index.html" />
    <link rel="prev" title="2.4. Application Layering" href="../Overview/ApplicationLayering.html" /><script async src="https://www.googletagmanager.com/gtag/js?id=G-847V2Q99G8"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date()); gtag('config', 'G-847V2Q99G8');
</script>
<script src="../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../_static/solarized-dark.css" rel="stylesheet">
<link href="../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../ImplementationAtEachLayer/index.html" title="4. Application Development using TERASOLUNA Global Framework"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../Overview/ApplicationLayering.html" title="2.4. Application Layering"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Global Framework Development Guideline 1.0.2.RELEASE documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3. Tutorial (Todo Application)</a><ul>
<li><a class="reference internal" href="#introduction">3.1. Introduction</a><ul>
<li><a class="reference internal" href="#points-to-study-in-this-tutorial">3.1.1. Points to study in this tutorial</a></li>
<li><a class="reference internal" href="#target-readers">3.1.2. Target readers</a></li>
<li><a class="reference internal" href="#verification-environment">3.1.3. Verification environment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#description-of-application-to-be-created">3.2. Description of application to be created</a><ul>
<li><a class="reference internal" href="#overview-of-application">3.2.1. Overview of application</a></li>
<li><a class="reference internal" href="#business-requirements-of-application">3.2.2. Business requirements of application</a></li>
<li><a class="reference internal" href="#screen-transition-of-application">3.2.3. Screen transition of application</a><ul>
<li><a class="reference internal" href="#show-all-todo">3.2.3.1. Show all TODO</a></li>
<li><a class="reference internal" href="#create-todo">3.2.3.2. Create TODO</a></li>
<li><a class="reference internal" href="#finish-todo">3.2.3.3. Finish TODO</a></li>
<li><a class="reference internal" href="#delete-todo">3.2.3.4. Delete TODO</a></li>
</ul>
</li>
<li><a class="reference internal" href="#error-message-list">3.2.4. Error message list</a></li>
</ul>
</li>
<li><a class="reference internal" href="#environment-creation">3.3. Environment creation</a><ul>
<li><a class="reference internal" href="#project-creation">3.3.1. Project creation</a></li>
<li><a class="reference internal" href="#maven-settings">3.3.2. Maven settings</a></li>
<li><a class="reference internal" href="#project-configuration">3.3.3. Project configuration</a></li>
<li><a class="reference internal" href="#creation-of-configuration-file">3.3.4. Creation of configuration file</a><ul>
<li><a class="reference internal" href="#web-xml-settings">3.3.4.1. web.xml settings</a></li>
<li><a class="reference internal" href="#settings-of-common-jsp">3.3.4.2. Settings of common JSP</a></li>
<li><a class="reference internal" href="#settings-of-bean-definition-file">3.3.4.3. Settings of Bean definition file</a><ul>
<li><a class="reference internal" href="#applicationcontext-xml">3.3.4.3.1. applicationContext.xml</a></li>
<li><a class="reference internal" href="#todo-domain-xml">3.3.4.3.2. todo-domain.xml</a></li>
<li><a class="reference internal" href="#todo-infra-xml">3.3.4.3.3. todo-infra.xml</a></li>
<li><a class="reference internal" href="#spring-mvc-xml">3.3.4.3.4. spring-mvc.xml</a></li>
</ul>
</li>
<li><a class="reference internal" href="#logback-xml-settings">3.3.4.4. logback.xml settings</a></li>
</ul>
</li>
<li><a class="reference internal" href="#operation-verification">3.3.5. Operation verification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creation-of-todo-application">3.4. Creation of Todo application</a><ul>
<li><a class="reference internal" href="#creation-of-domain-layer">3.4.1. Creation of Domain layer</a><ul>
<li><a class="reference internal" href="#creation-of-domain-object">3.4.1.1. Creation of Domain Object</a></li>
<li><a class="reference internal" href="#repository-creation">3.4.1.2. Repository creation</a></li>
<li><a class="reference internal" href="#creation-of-repositoryimpl-infrastructure-layer">3.4.1.3. Creation of RepositoryImpl (Infrastructure layer)</a></li>
<li><a class="reference internal" href="#service-creation">3.4.1.4. Service creation</a></li>
<li><a class="reference internal" href="#creation-of-junit-for-service">3.4.1.5. Creation of JUnit for Service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creation-of-application-layer">3.4.2. Creation of application layer</a><ul>
<li><a class="reference internal" href="#creation-of-controller">3.4.2.1. Creation of Controller</a><ul>
<li><a class="reference internal" href="#id1">3.4.2.1.1. Show all TODO</a><ul>
<li><a class="reference internal" href="#form-creation">3.4.2.1.1.1. Form creation</a></li>
<li><a class="reference internal" href="#implementation-of-controller">3.4.2.1.1.2. Implementation of Controller</a></li>
<li><a class="reference internal" href="#jsp-creation">3.4.2.1.1.3. JSP creation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id4">3.4.2.1.2. Create TODO</a><ul>
<li><a class="reference internal" href="#modifications-in-controller">3.4.2.1.2.1. Modifications in Controller</a></li>
<li><a class="reference internal" href="#modifications-in-form">3.4.2.1.2.2. Modifications in Form</a></li>
<li><a class="reference internal" href="#modifications-in-jsp">3.4.2.1.2.3. Modifications in JSP</a></li>
<li><a class="reference internal" href="#customize-message-display">3.4.2.1.2.4. Customize message display</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id5">3.4.2.1.3. Finish TODO</a><ul>
<li><a class="reference internal" href="#id6">3.4.2.1.3.1. Modifications in JSP</a></li>
<li><a class="reference internal" href="#id7">3.4.2.1.3.2. Modifications in Form</a></li>
<li><a class="reference internal" href="#id8">3.4.2.1.3.3. Modifications in Controller</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id9">3.4.2.1.4. Delete TODO</a><ul>
<li><a class="reference internal" href="#id10">3.4.2.1.4.1. Modifications in JSP</a></li>
<li><a class="reference internal" href="#id11">3.4.2.1.4.2. Modifications in Form</a></li>
<li><a class="reference internal" href="#id12">3.4.2.1.4.3. Modifications in Controller</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#change-of-infrastructure-layer">3.5. Change of infrastructure layer</a><ul>
<li><a class="reference internal" href="#common-settings">3.5.1. Common settings</a><ul>
<li><a class="reference internal" href="#modifications-in-pom-xml">3.5.1.1. Modifications in pom.xml</a></li>
<li><a class="reference internal" href="#definition-of-data-source">3.5.1.2. Definition of data source</a><ul>
<li><a class="reference internal" href="#modifications-in-todo-infra-xml">3.5.1.2.1. Modifications in todo-infra.xml</a></li>
<li><a class="reference internal" href="#creation-of-todo-env-xml">3.5.1.2.2. Creation of todo-env.xml</a></li>
<li><a class="reference internal" href="#todo-infra-properties">3.5.1.2.3. todo-infra.properties</a></li>
</ul>
</li>
<li><a class="reference internal" href="#modifications-in-todo-domain-xml">3.5.1.3. Modifications in todo-domain.xml</a></li>
<li><a class="reference internal" href="#modifications-in-todoserviceimpl">3.5.1.4. Modifications in TodoServiceImpl</a></li>
</ul>
</li>
<li><a class="reference internal" href="#use-spring-data-jpa">3.5.2. Use Spring Data JPA</a><ul>
<li><a class="reference internal" href="#modifications-in-configuration-file-for-using-spring-data-jpa">3.5.2.1. Modifications in configuration file for using Spring Data JPA</a><ul>
<li><a class="reference internal" href="#id13">3.5.2.1.1. Modifications in pom.xml</a></li>
<li><a class="reference internal" href="#id14">3.5.2.1.2. Modifications in todo-infra.xml</a></li>
<li><a class="reference internal" href="#modifications-in-todo-env-xml">3.5.2.1.3. Modifications in todo-env.xml</a></li>
<li><a class="reference internal" href="#modifications-in-spring-mvc-xml">3.5.2.1.4. Modifications in spring-mvc.xml</a></li>
<li><a class="reference internal" href="#modifications-in-logback-xml">3.5.2.1.5. Modifications in logback.xml</a></li>
</ul>
</li>
<li><a class="reference internal" href="#settings-of-entity">3.5.2.2. Settings of Entity</a></li>
<li><a class="reference internal" href="#modifications-in-todorepository">3.5.2.3. Modifications in TodoRepository</a></li>
<li><a class="reference internal" href="#modifications-in-todorepositoryimpl">3.5.2.4. Modifications in TodoRepositoryImpl</a></li>
</ul>
</li>
<li><a class="reference internal" href="#use-terasoluna-dao">3.5.3. Use TERASOLUNA DAO</a><ul>
<li><a class="reference internal" href="#setting-for-using-the-terasoluna-dao">3.5.3.1. Setting for using the TERASOLUNA DAO</a><ul>
<li><a class="reference internal" href="#id15">3.5.3.1.1. Modifications in pom.xml</a></li>
<li><a class="reference internal" href="#id16">3.5.3.1.2. Modifications in todo-infra.xml</a></li>
<li><a class="reference internal" href="#id21">3.5.3.1.3. Modifications in todo-env.xml</a></li>
<li><a class="reference internal" href="#id22">3.5.3.1.4. Modifications in logback.xml</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creation-of-sqlmapconfig">3.5.3.2. Creation of sqlMapConfig</a></li>
<li><a class="reference internal" href="#modifications-in-repositoryimpl">3.5.3.3. Modifications in RepositoryImpl</a></li>
<li><a class="reference internal" href="#create-sqlmap-file">3.5.3.4. Create SQLMap file</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#in-the-end">3.6. In the end…</a></li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="../Overview/ApplicationLayering.html"
                        title="previous chapter">2.4. Application Layering</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../ImplementationAtEachLayer/index.html"
                        title="next chapter">4. Application Development using TERASOLUNA Global Framework</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/TutorialTodo/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tutorial-todo-application">
<h1>3. Tutorial (Todo Application)<a class="headerlink" href="#tutorial-todo-application" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="index">
<p class="topic-title">Index</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id23">Introduction</a><ul>
<li><a class="reference internal" href="#points-to-study-in-this-tutorial" id="id24">Points to study in this tutorial</a></li>
<li><a class="reference internal" href="#target-readers" id="id25">Target readers</a></li>
<li><a class="reference internal" href="#verification-environment" id="id26">Verification environment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#description-of-application-to-be-created" id="id27">Description of application to be created</a><ul>
<li><a class="reference internal" href="#overview-of-application" id="id28">Overview of application</a></li>
<li><a class="reference internal" href="#business-requirements-of-application" id="id29">Business requirements of application</a></li>
<li><a class="reference internal" href="#screen-transition-of-application" id="id30">Screen transition of application</a><ul>
<li><a class="reference internal" href="#show-all-todo" id="id31">Show all TODO</a></li>
<li><a class="reference internal" href="#create-todo" id="id32">Create TODO</a></li>
<li><a class="reference internal" href="#finish-todo" id="id33">Finish TODO</a></li>
<li><a class="reference internal" href="#delete-todo" id="id34">Delete TODO</a></li>
</ul>
</li>
<li><a class="reference internal" href="#error-message-list" id="id35">Error message list</a></li>
</ul>
</li>
<li><a class="reference internal" href="#environment-creation" id="id36">Environment creation</a><ul>
<li><a class="reference internal" href="#project-creation" id="id37">Project creation</a></li>
<li><a class="reference internal" href="#maven-settings" id="id38">Maven settings</a></li>
<li><a class="reference internal" href="#project-configuration" id="id39">Project configuration</a></li>
<li><a class="reference internal" href="#creation-of-configuration-file" id="id40">Creation of configuration file</a><ul>
<li><a class="reference internal" href="#web-xml-settings" id="id41">web.xml settings</a></li>
<li><a class="reference internal" href="#settings-of-common-jsp" id="id42">Settings of common JSP</a></li>
<li><a class="reference internal" href="#settings-of-bean-definition-file" id="id43">Settings of Bean definition file</a></li>
<li><a class="reference internal" href="#logback-xml-settings" id="id44">logback.xml settings</a></li>
</ul>
</li>
<li><a class="reference internal" href="#operation-verification" id="id45">Operation verification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creation-of-todo-application" id="id46">Creation of Todo application</a><ul>
<li><a class="reference internal" href="#creation-of-domain-layer" id="id47">Creation of Domain layer</a><ul>
<li><a class="reference internal" href="#creation-of-domain-object" id="id48">Creation of Domain Object</a></li>
<li><a class="reference internal" href="#repository-creation" id="id49">Repository creation</a></li>
<li><a class="reference internal" href="#creation-of-repositoryimpl-infrastructure-layer" id="id50">Creation of RepositoryImpl (Infrastructure layer)</a></li>
<li><a class="reference internal" href="#service-creation" id="id51">Service creation</a></li>
<li><a class="reference internal" href="#creation-of-junit-for-service" id="id52">Creation of JUnit for Service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creation-of-application-layer" id="id53">Creation of application layer</a><ul>
<li><a class="reference internal" href="#creation-of-controller" id="id54">Creation of Controller</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#change-of-infrastructure-layer" id="id55">Change of infrastructure layer</a><ul>
<li><a class="reference internal" href="#common-settings" id="id56">Common settings</a><ul>
<li><a class="reference internal" href="#modifications-in-pom-xml" id="id57">Modifications in pom.xml</a></li>
<li><a class="reference internal" href="#definition-of-data-source" id="id58">Definition of data source</a></li>
<li><a class="reference internal" href="#modifications-in-todo-domain-xml" id="id59">Modifications in todo-domain.xml</a></li>
<li><a class="reference internal" href="#modifications-in-todoserviceimpl" id="id60">Modifications in TodoServiceImpl</a></li>
</ul>
</li>
<li><a class="reference internal" href="#use-spring-data-jpa" id="id61">Use Spring Data JPA</a><ul>
<li><a class="reference internal" href="#modifications-in-configuration-file-for-using-spring-data-jpa" id="id62">Modifications in configuration file for using Spring Data JPA</a></li>
<li><a class="reference internal" href="#settings-of-entity" id="id63">Settings of Entity</a></li>
<li><a class="reference internal" href="#modifications-in-todorepository" id="id64">Modifications in TodoRepository</a></li>
<li><a class="reference internal" href="#modifications-in-todorepositoryimpl" id="id65">Modifications in TodoRepositoryImpl</a></li>
</ul>
</li>
<li><a class="reference internal" href="#use-terasoluna-dao" id="id66">Use TERASOLUNA DAO</a><ul>
<li><a class="reference internal" href="#setting-for-using-the-terasoluna-dao" id="id67">Setting for using the TERASOLUNA DAO</a></li>
<li><a class="reference internal" href="#creation-of-sqlmapconfig" id="id68">Creation of sqlMapConfig</a></li>
<li><a class="reference internal" href="#modifications-in-repositoryimpl" id="id69">Modifications in RepositoryImpl</a></li>
<li><a class="reference internal" href="#create-sqlmap-file" id="id70">Create SQLMap file</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#in-the-end" id="id71">In the end…</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id23">3.1. Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<div class="section" id="points-to-study-in-this-tutorial">
<h3><a class="toc-backref" href="#id24">3.1.1. Points to study in this tutorial</a><a class="headerlink" href="#points-to-study-in-this-tutorial" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Basic application development and configuration of Eclipse project using TERASOLUNA Global Framework</li>
<li>Development in accordance with application layering of this TERASOLUNA Global Framework</li>
</ul>
</div>
<div class="section" id="target-readers">
<h3><a class="toc-backref" href="#id25">3.1.2. Target readers</a><a class="headerlink" href="#target-readers" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Basic knowledge of DI and AOP of Spring is required</li>
<li>Web application development using Servlet/JSP</li>
<li>SQL knowledge</li>
</ul>
</div>
<div class="section" id="verification-environment">
<h3><a class="toc-backref" href="#id26">3.1.3. Verification environment</a><a class="headerlink" href="#verification-environment" title="Permalink to this headline">¶</a></h3>
<p>In this tutorial, operations are verified in the following environment.</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type</th>
<th class="head">Name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>OS</td>
<td>Windows7 64bit</td>
</tr>
<tr class="row-odd"><td>JVM</td>
<td>Java 1.6</td>
</tr>
<tr class="row-even"><td>IDE</td>
<td>Spring Tool Suite Version: 3.2.0.RELEASE, Build Id: 201303060821 (henceforth referred to STS) Build Maven 3.0.4 (STS attached)</td>
</tr>
<tr class="row-odd"><td>Application Server</td>
<td>VMWare vFabric tc Server Developer Edition v2.8 (STS attached)</td>
</tr>
<tr class="row-even"><td>Web Browser</td>
<td>Google Chrome 27.0.1453.94 m</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="description-of-application-to-be-created">
<h2><a class="toc-backref" href="#id27">3.2. Description of application to be created</a><a class="headerlink" href="#description-of-application-to-be-created" title="Permalink to this headline">¶</a></h2>
<div class="section" id="overview-of-application">
<h3><a class="toc-backref" href="#id28">3.2.1. Overview of application</a><a class="headerlink" href="#overview-of-application" title="Permalink to this headline">¶</a></h3>
<p>Application to manage TODO list is to be developed. TODO list display, TODO registration, TODO completion and TODO deletion can be performed.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image001.png"><img alt="../_images/image001.png" src="../_images/image001.png" style="width: 60%;" /></a>
</div>
</div>
<div class="section" id="business-requirements-of-application">
<span id="app-requirement"></span><h3><a class="toc-backref" href="#id29">3.2.2. Business requirements of application</a><a class="headerlink" href="#business-requirements-of-application" title="Permalink to this headline">¶</a></h3>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">RuleID</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>B01</td>
<td>Only up to 5 incomplete TODO records can be registered</td>
</tr>
<tr class="row-odd"><td>B02</td>
<td>For TODOs which are already completed, “TODO Complete” processing cannot be done.</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This application is for learning purpose only. It is not suitable as a real todo management application.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="screen-transition-of-application">
<h3><a class="toc-backref" href="#id30">3.2.3. Screen transition of application</a><a class="headerlink" href="#screen-transition-of-application" title="Permalink to this headline">¶</a></h3>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image002.png"><img alt="../_images/image002.png" src="../_images/image002.png" style="width: 60%;" /></a>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="20%" />
<col width="15%" />
<col width="15%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Process name</th>
<th class="head">HTTP method</th>
<th class="head">URL</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Show all TODO</td>
<td>GET</td>
<td>/todo/list</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Create TODO</td>
<td>POST</td>
<td>/todo/create</td>
<td>Redirect to 1 after creation is completed</td>
</tr>
<tr class="row-even"><td>3</td>
<td>Finish TODO</td>
<td>POST</td>
<td>/todo/finish</td>
<td>Redirect to 1 after creation is completed</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>Delete TODO</td>
<td>POST</td>
<td>/todo/delete</td>
<td>Redirect to 1 after creation is completed</td>
</tr>
</tbody>
</table>
<div class="section" id="show-all-todo">
<h4><a class="toc-backref" href="#id31">3.2.3.1. Show all TODO</a><a class="headerlink" href="#show-all-todo" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Display all records of TODO</li>
<li>Provide <code class="docutils literal"><span class="pre">Finish</span></code> and  <code class="docutils literal"><span class="pre">Delete</span></code> buttons for incomplete TODO</li>
<li>Strike-through the completed records of TODO</li>
<li>Only record name of TODO</li>
</ul>
</div>
<div class="section" id="create-todo">
<h4><a class="toc-backref" href="#id32">3.2.3.2. Create TODO</a><a class="headerlink" href="#create-todo" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Save TODO sent from the form</li>
<li>Record name of TODO should be between 1 - 30 characters</li>
<li>When <a class="reference internal" href="#app-requirement"><span class="std std-ref">Business requirements of application</span></a> B01 is not fulfilled, business exception with error code E001 is thrown</li>
</ul>
</div>
<div class="section" id="finish-todo">
<h4><a class="toc-backref" href="#id33">3.2.3.3. Finish TODO</a><a class="headerlink" href="#finish-todo" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>For the TODOs corresponding to todoId which is received from the form object, change the status to <code class="docutils literal"><span class="pre">completed</span></code>.</li>
<li>When <a class="reference internal" href="#app-requirement"><span class="std std-ref">Business requirements of application</span></a> B02 is not fulfilled, business exception with error code E002 is thrown</li>
<li>When the corresponding TODO does not exist, business exception with error code E404 is thrown</li>
</ul>
</div>
<div class="section" id="delete-todo">
<h4><a class="toc-backref" href="#id34">3.2.3.4. Delete TODO</a><a class="headerlink" href="#delete-todo" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Delete TODO corresponding to todoId sent from the form</li>
<li>When the corresponding TODO does not exist, business exception with error code E404 is thrown</li>
</ul>
</div>
</div>
<div class="section" id="error-message-list">
<h3><a class="toc-backref" href="#id35">3.2.4. Error message list</a><a class="headerlink" href="#error-message-list" title="Permalink to this headline">¶</a></h3>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="15%" />
<col width="45%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Error code</th>
<th class="head">Message</th>
<th class="head">Parameter to be replaced</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>E001</td>
<td>[E001] The count of un-finished Todo must not be over {0}.</td>
<td>{0}… max unfinished count</td>
</tr>
<tr class="row-odd"><td>E002</td>
<td>[E002] The requested Todo is already finished. (id={0})</td>
<td>{0}… todoId</td>
</tr>
<tr class="row-even"><td>E404</td>
<td>[E404] The requested Todo is not found. (id={0})</td>
<td>{0}… todoId</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="environment-creation">
<h2><a class="toc-backref" href="#id36">3.3. Environment creation</a><a class="headerlink" href="#environment-creation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="project-creation">
<h3><a class="toc-backref" href="#id37">3.3.1. Project creation</a><a class="headerlink" href="#project-creation" title="Permalink to this headline">¶</a></h3>
<p>Select <code class="docutils literal"><span class="pre">File</span></code> -&gt; <code class="docutils literal"><span class="pre">Other</span></code> -&gt; <code class="docutils literal"><span class="pre">Maven</span></code> -&gt; <code class="docutils literal"><span class="pre">Maven</span> <span class="pre">Project</span></code> and proceed to <code class="docutils literal"><span class="pre">Next</span></code></p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image004.jpg"><img alt="../_images/image004.jpg" src="../_images/image004.jpg" style="width: 60%;" /></a>
</div>
<p>Insert check-mark to <code class="docutils literal"><span class="pre">Create</span> <span class="pre">a</span> <span class="pre">simple</span> <span class="pre">project</span></code> and proceed to <code class="docutils literal"><span class="pre">Next</span></code></p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image006.jpg"><img alt="../_images/image006.jpg" src="../_images/image006.jpg" style="width: 60%;" /></a>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><th class="stub">Group Id:</th>
<td>org.terasoluna.tutorial</td>
</tr>
<tr class="row-even"><th class="stub">Artifact Id:</th>
<td>todo</td>
</tr>
<tr class="row-odd"><th class="stub">Packaging:</th>
<td>war</td>
</tr>
</tbody>
</table>
<p><code class="docutils literal"><span class="pre">Finish</span></code></p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image008.jpg"><img alt="../_images/image008.jpg" src="../_images/image008.jpg" style="width: 60%;" /></a>
</div>
<p>Project as shown below is created.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image009.png"><img alt="../_images/image009.png" src="../_images/image009.png" style="width: 40%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>For better visibility, Package Presentation must be changed to Hierarchical.</p>
<div class="last figure">
<a class="reference internal image-reference" href="../_images/presentation-hierarchical.png"><img alt="../_images/presentation-hierarchical.png" src="../_images/presentation-hierarchical.png" style="width: 80%;" /></a>
</div>
</div>
</div>
<div class="section" id="maven-settings">
<h3><a class="toc-backref" href="#id38">3.3.2. Maven settings</a><a class="headerlink" href="#maven-settings" title="Permalink to this headline">¶</a></h3>
<p>Change pom.xml as follows.
If basic knowledge of Maven is not there, then just copy the pom.xml and skip the below explanation.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span> <span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
     <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

     <span class="nt">&lt;groupId&gt;</span>org.terasoluna.tutorial<span class="nt">&lt;/groupId&gt;</span>
     <span class="nt">&lt;artifactId&gt;</span>todo<span class="nt">&lt;/artifactId&gt;</span>
     <span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
     <span class="nt">&lt;packaging&gt;</span>war<span class="nt">&lt;/packaging&gt;</span>
<span class="hll">     <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">     <span class="nt">&lt;parent&gt;</span>
</span><span class="hll">         <span class="nt">&lt;groupId&gt;</span>org.terasoluna.gfw<span class="nt">&lt;/groupId&gt;</span>
</span><span class="hll">         <span class="nt">&lt;artifactId&gt;</span>terasoluna-gfw-parent<span class="nt">&lt;/artifactId&gt;</span>
</span><span class="hll">         <span class="nt">&lt;version&gt;</span>1.0.0.RELEASE<span class="nt">&lt;/version&gt;</span>
</span><span class="hll">     <span class="nt">&lt;/parent&gt;</span>
</span><span class="hll">
</span><span class="hll">     <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">     <span class="nt">&lt;repositories&gt;</span>
</span><span class="hll">         <span class="nt">&lt;repository&gt;</span>
</span><span class="hll">             <span class="nt">&lt;releases&gt;</span>
</span><span class="hll">                 <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
</span><span class="hll">             <span class="nt">&lt;/releases&gt;</span>
</span><span class="hll">             <span class="nt">&lt;snapshots&gt;</span>
</span><span class="hll">                 <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
</span><span class="hll">             <span class="nt">&lt;/snapshots&gt;</span>
</span><span class="hll">             <span class="nt">&lt;id&gt;</span>terasoluna-gfw-releases<span class="nt">&lt;/id&gt;</span>
</span><span class="hll">             <span class="nt">&lt;url&gt;</span>http://repo.terasoluna.org/nexus/content/repositories/terasoluna-gfw-releases/<span class="nt">&lt;/url&gt;</span>
</span><span class="hll">         <span class="nt">&lt;/repository&gt;</span>
</span><span class="hll">         <span class="nt">&lt;repository&gt;</span>
</span><span class="hll">             <span class="nt">&lt;releases&gt;</span>
</span><span class="hll">                 <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
</span><span class="hll">             <span class="nt">&lt;/releases&gt;</span>
</span><span class="hll">             <span class="nt">&lt;snapshots&gt;</span>
</span><span class="hll">                 <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
</span><span class="hll">             <span class="nt">&lt;/snapshots&gt;</span>
</span><span class="hll">             <span class="nt">&lt;id&gt;</span>terasoluna-gfw-snapshots<span class="nt">&lt;/id&gt;</span>
</span><span class="hll">             <span class="nt">&lt;url&gt;</span>http://repo.terasoluna.org/nexus/content/repositories/terasoluna-gfw-snapshots/<span class="nt">&lt;/url&gt;</span>
</span><span class="hll">         <span class="nt">&lt;/repository&gt;</span>
</span><span class="hll">         <span class="nt">&lt;repository&gt;</span>
</span><span class="hll">             <span class="nt">&lt;releases&gt;</span>
</span><span class="hll">                 <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
</span><span class="hll">             <span class="nt">&lt;/releases&gt;</span>
</span><span class="hll">             <span class="nt">&lt;snapshots&gt;</span>
</span><span class="hll">                 <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
</span><span class="hll">             <span class="nt">&lt;/snapshots&gt;</span>
</span><span class="hll">             <span class="nt">&lt;id&gt;</span>terasoluna-gfw-3rdparty<span class="nt">&lt;/id&gt;</span>
</span><span class="hll">             <span class="nt">&lt;url&gt;</span>http://repo.terasoluna.org/nexus/content/repositories/terasoluna-gfw-3rdparty/<span class="nt">&lt;/url&gt;</span>
</span><span class="hll">         <span class="nt">&lt;/repository&gt;</span>
</span><span class="hll">     <span class="nt">&lt;/repositories&gt;</span>
</span><span class="hll">
</span><span class="hll">     <span class="nt">&lt;dependencies&gt;</span>
</span><span class="hll">         <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">         <span class="c">&lt;!-- TERASOLUNA --&gt;</span>
</span><span class="hll">         <span class="nt">&lt;dependency&gt;</span>
</span><span class="hll">             <span class="nt">&lt;groupId&gt;</span>org.terasoluna.gfw<span class="nt">&lt;/groupId&gt;</span>
</span><span class="hll">             <span class="nt">&lt;artifactId&gt;</span>terasoluna-gfw-web<span class="nt">&lt;/artifactId&gt;</span>
</span><span class="hll">         <span class="nt">&lt;/dependency&gt;</span>
</span><span class="hll">         <span class="c">&lt;!-- (4) --&gt;</span>
</span><span class="hll">         <span class="nt">&lt;dependency&gt;</span>
</span><span class="hll">             <span class="nt">&lt;groupId&gt;</span>org.terasoluna.gfw<span class="nt">&lt;/groupId&gt;</span>
</span><span class="hll">             <span class="nt">&lt;artifactId&gt;</span>terasoluna-gfw-security-web<span class="nt">&lt;/artifactId&gt;</span>
</span><span class="hll">             <span class="nt">&lt;/dependency&gt;</span>
</span><span class="hll">         <span class="c">&lt;!-- (5) --&gt;</span>
</span><span class="hll">         <span class="nt">&lt;dependency&gt;</span>
</span><span class="hll">             <span class="nt">&lt;groupId&gt;</span>org.terasoluna.gfw<span class="nt">&lt;/groupId&gt;</span>
</span><span class="hll">             <span class="nt">&lt;artifactId&gt;</span>terasoluna-gfw-recommended-dependencies<span class="nt">&lt;/artifactId&gt;</span>
</span><span class="hll">             <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
</span><span class="hll">         <span class="nt">&lt;/dependency&gt;</span>
</span><span class="hll">
</span><span class="hll">         <span class="c">&lt;!-- (6) --&gt;</span>
</span><span class="hll">         <span class="c">&lt;!-- Servlet API/ JSP API --&gt;</span>
</span><span class="hll">         <span class="nt">&lt;dependency&gt;</span>
</span><span class="hll">             <span class="nt">&lt;groupId&gt;</span>org.apache.tomcat<span class="nt">&lt;/groupId&gt;</span>
</span><span class="hll">             <span class="nt">&lt;artifactId&gt;</span>tomcat-servlet-api<span class="nt">&lt;/artifactId&gt;</span>
</span><span class="hll">             <span class="nt">&lt;version&gt;</span>7.0.40<span class="nt">&lt;/version&gt;</span>
</span><span class="hll">             <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
</span><span class="hll">         <span class="nt">&lt;/dependency&gt;</span>
</span><span class="hll">         <span class="nt">&lt;dependency&gt;</span>
</span><span class="hll">             <span class="nt">&lt;groupId&gt;</span>org.apache.tomcat<span class="nt">&lt;/groupId&gt;</span>
</span><span class="hll">             <span class="nt">&lt;artifactId&gt;</span>tomcat-jsp-api<span class="nt">&lt;/artifactId&gt;</span>
</span><span class="hll">             <span class="nt">&lt;version&gt;</span>7.0.40<span class="nt">&lt;/version&gt;</span>
</span><span class="hll">             <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
</span><span class="hll">         <span class="nt">&lt;/dependency&gt;</span>
</span><span class="hll">     <span class="nt">&lt;/dependencies&gt;</span>
</span> <span class="nt">&lt;/project&gt;</span>
</pre></div>
</div>
<p>Right click on the project name in “Package Explorer” and select [Maven] -&gt; [Update Project]</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/update-project.png"><img alt="../_images/update-project.png" src="../_images/update-project.png" style="width: 60%;" /></a>
</div>
<p>Press “OK” button.</p>
<p>Confirm that the version of “JRE System Library” is “[JavaSE-1.6]”.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/check-jre.jpg"><img alt="../_images/check-jre.jpg" src="../_images/check-jre.jpg" style="width: 30%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In order to update the version of JDK to 7, set <code class="docutils literal"><span class="pre">&lt;java-version&gt;1.7&lt;/java-version&gt;</span></code> in <code class="docutils literal"><span class="pre">&lt;properties&gt;</span></code>  of pom.xml.
After that, execute “Update Project”</p>
<blockquote class="last">
<div><div class="highlight-xml"><div class="highlight"><pre><span></span> <span class="nt">&lt;project&gt;</span>
     <span class="c">&lt;!-- omitted --&gt;</span>

<span class="hll">     <span class="nt">&lt;properties&gt;</span>
</span><span class="hll">         <span class="nt">&lt;java-version&gt;</span>1.7<span class="nt">&lt;/java-version&gt;</span>
</span><span class="hll">     <span class="nt">&lt;/properties&gt;</span>
</span> <span class="nt">&lt;/project&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div></blockquote>
<p>If you are familiar with the Maven, and to make sure the following discussion.</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify parent pom file of TERASOLUNA Global Framework.</div>
<div class="line">In this way, even without specifying the version, the library defined in terasoluna-parent can be added to dependency.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify URL of Maven repository for using TERASOLUNA Global Framework.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add common library of TERASOLUNA Global Framework to dependency.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add the library group recommended by TERASOLUNA Global Framework.</div>
<div class="line">Since terasoluna-gfw-recommended-dependencies is just pom file, <code class="docutils literal"><span class="pre">&lt;type&gt;pom&lt;/type&gt;</span></code> should be mentioned.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add the libraries which are recommended by TERASOLUNA Global Framework</div>
<div class="line">terasoluna-gfw-recommended-dependencies is just a pom file; hence <code class="docutils literal"><span class="pre">&lt;type&gt;pom&lt;/type&gt;</span></code>  must be specified.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">Add Servlet/JSP API to dependency. Compatiblity with Servlet3 is necessary.</div>
<div class="line">These API have scope=provided (provided by the original AP server), they are not included in war, but it should be added explicitly to dependency for compiling on eclipse.</div>
<div class="line">（Further, though dependency name is tomcat-xxx, but the package of embedded class is javax.servlet, there is no dependency on tomcat）</div>
</div>
<blockquote class="last">
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<dl class="docutils">
<dt>When proxy server is used to access the internet,</dt>
<dd>perform the following settings in &lt;HOME&gt;/.m2/settings.xml.</dd>
</dl>
<p>(In case of Windows7 C:\Users\&lt;YourName&gt;.m2\settings.xml)</p>
<blockquote class="last">
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;settings&gt;</span>
  <span class="nt">&lt;proxies&gt;</span>
    <span class="nt">&lt;proxy&gt;</span>
      <span class="nt">&lt;active&gt;</span>true<span class="nt">&lt;/active&gt;</span>
      <span class="nt">&lt;protocol&gt;</span>[Proxy Server Protocol (http)]<span class="nt">&lt;/protocol&gt;</span>
      <span class="nt">&lt;port&gt;</span>[Proxy Server Port]<span class="nt">&lt;/port&gt;</span>
      <span class="nt">&lt;host&gt;</span>[Proxy Server Host]<span class="nt">&lt;/host&gt;</span>
      <span class="nt">&lt;username&gt;</span>[Username]<span class="nt">&lt;/username&gt;</span>
      <span class="nt">&lt;password&gt;</span>[Password]<span class="nt">&lt;/password&gt;</span>
    <span class="nt">&lt;/proxy&gt;</span>
  <span class="nt">&lt;/proxies&gt;</span>
<span class="nt">&lt;/settings&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="project-configuration">
<h3><a class="toc-backref" href="#id39">3.3.3. Project configuration</a><a class="headerlink" href="#project-configuration" title="Permalink to this headline">¶</a></h3>
<p>Below is the structure of the project to be created.</p>
<blockquote>
<div><div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">  src</span>
<span class="go">└main</span>
<span class="go">    ├java</span>
<span class="go">    │  └todo</span>
<span class="go">    │    ├ app ... Application layer</span>
<span class="go">    │    │   └todo ... Classes related todo management business process</span>
<span class="go">    │    └domain ... Domain layer</span>
<span class="go">    │        ├model ... Domain Object</span>
<span class="go">    │        ├repository ... Repository</span>
<span class="go">    │        │   └todo ... Repository related to Todo</span>
<span class="go">    │        └service ... Services</span>
<span class="go">    │            └todo ... Service related to Todo</span>
<span class="go">    ├resources</span>
<span class="go">    │  └META-INF</span>
<span class="go">    │      └spring ... configuration files related to Spring</span>
<span class="go">    └wepapp</span>
<span class="go">        └WEB-INF</span>
<span class="go">            └views ... jsp</span>
</pre></div>
</div>
</div></blockquote>
<p>Since above will be created in order, there is no need to provide prepare the above structure beforehand.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It had been recommended to use a multi-project structure in <a class="reference internal" href="../Overview/ApplicationLayering.html#application-layering-project-structure"><span class="std std-ref">“Project Structure” section of previous chapter</span></a> .
In this tutorial, a single project configuration is used because it focuses on ease of learning. However, when in a real project, multi project configuration is
strongly recommended.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="creation-of-configuration-file">
<h3><a class="toc-backref" href="#id40">3.3.4. Creation of configuration file</a><a class="headerlink" href="#creation-of-configuration-file" title="Permalink to this headline">¶</a></h3>
<div class="section" id="web-xml-settings">
<h4><a class="toc-backref" href="#id41">3.3.4.1. web.xml settings</a><a class="headerlink" href="#web-xml-settings" title="Permalink to this headline">¶</a></h4>
<p>Create <code class="docutils literal"><span class="pre">src/main/webapp/WEB-INF/web.xml</span></code> and define servlet and filters.
New WEB-INF folder should be created by <code class="docutils literal"><span class="pre">New</span></code> -&gt; <code class="docutils literal"><span class="pre">Folder</span></code>.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image010.jpg"><img alt="../_images/image010.jpg" src="../_images/image010.jpg" style="width: 40%;" /></a>
</div>
<p>Create web.xml by <code class="docutils literal"><span class="pre">New</span></code> -&gt; <code class="docutils literal"><span class="pre">File</span></code>,</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image011.jpg"><img alt="../_images/image011.jpg" src="../_images/image011.jpg" style="width: 40%;" /></a>
</div>
<p>and describe the contents as follows.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;web-app</span> <span class="na">xmlns=</span><span class="s">&quot;http://java.sun.com/xml/ns/javaee&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span>
    <span class="na">version=</span><span class="s">&quot;3.0&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;listener&gt;</span>
        <span class="nt">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="nt">&lt;/listener-class&gt;</span>
    <span class="nt">&lt;/listener&gt;</span>
    <span class="nt">&lt;context-param&gt;</span>
        <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
        <span class="c">&lt;!-- Root ApplicationContext --&gt;</span>
        <span class="nt">&lt;param-value&gt;</span>
            classpath*:META-INF/spring/applicationContext.xml
        <span class="nt">&lt;/param-value&gt;</span>
    <span class="nt">&lt;/context-param&gt;</span>

    <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;filter&gt;</span>
        <span class="nt">&lt;filter-name&gt;</span>CharacterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
        <span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="nt">&lt;/filter-class&gt;</span>
        <span class="nt">&lt;init-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>encoding<span class="nt">&lt;/param-name&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>UTF-8<span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/init-param&gt;</span>
        <span class="nt">&lt;init-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>forceEncoding<span class="nt">&lt;/param-name&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>true<span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/init-param&gt;</span>
    <span class="nt">&lt;/filter&gt;</span>
    <span class="nt">&lt;filter-mapping&gt;</span>
        <span class="nt">&lt;filter-name&gt;</span>CharacterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/filter-mapping&gt;</span>

    <span class="c">&lt;!-- (4) --&gt;</span>
    <span class="nt">&lt;servlet&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>appServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
        <span class="nt">&lt;init-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
            <span class="c">&lt;!-- ApplicationContext for Spring MVC --&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>classpath*:META-INF/spring/spring-mvc.xml<span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/init-param&gt;</span>
        <span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
    <span class="nt">&lt;/servlet&gt;</span>

    <span class="nt">&lt;servlet-mapping&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>appServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/servlet-mapping&gt;</span>

    <span class="c">&lt;!-- (5) --&gt;</span>
    <span class="nt">&lt;jsp-config&gt;</span>
        <span class="nt">&lt;jsp-property-group&gt;</span>
            <span class="nt">&lt;url-pattern&gt;</span>*.jsp<span class="nt">&lt;/url-pattern&gt;</span>
            <span class="nt">&lt;el-ignored&gt;</span>false<span class="nt">&lt;/el-ignored&gt;</span>
            <span class="nt">&lt;page-encoding&gt;</span>UTF-8<span class="nt">&lt;/page-encoding&gt;</span>
            <span class="nt">&lt;scripting-invalid&gt;</span>false<span class="nt">&lt;/scripting-invalid&gt;</span>
            <span class="nt">&lt;include-prelude&gt;</span>/WEB-INF/views/common/include.jsp<span class="nt">&lt;/include-prelude&gt;</span>
        <span class="nt">&lt;/jsp-property-group&gt;</span>
    <span class="nt">&lt;/jsp-config&gt;</span>
<span class="nt">&lt;/web-app&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Declaration for using Servlet3.0.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define <code class="docutils literal"><span class="pre">ContextLoaderListener</span></code>. <code class="docutils literal"><span class="pre">ApplicationContext</span></code> created by this listener is the root context.</div>
<div class="line">Path of Bean definition file is <code class="docutils literal"><span class="pre">META-INF/spring/applicationContext.xml</span></code> just under the classpath.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define <code class="docutils literal"><span class="pre">CharacterEncodingFilter</span></code>. This is done for changing the character encoding of request and response to UTF-8.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define <code class="docutils literal"><span class="pre">DispatcherServlet</span></code> that is the entry point of Spring MVC.</div>
<div class="line">Path of Bean definition file to be used in Spring MVC is <code class="docutils literal"><span class="pre">META-INF/spring/spring-mvc.xml</span></code> just under the classpath.</div>
<div class="line"><code class="docutils literal"><span class="pre">ApplicationContext</span></code> created here is the child of <code class="docutils literal"><span class="pre">ApplicationContext</span></code> created in step (2).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define common JSP to be included. Include <code class="docutils literal"><span class="pre">/WEB-INF/views/common/include.jsp</span></code> for any JSP(*.JSP)</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image013.png"><img alt="../_images/image013.png" src="../_images/image013.png" style="width: 40%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="settings-of-common-jsp">
<h4><a class="toc-backref" href="#id42">3.3.4.2. Settings of common JSP</a><a class="headerlink" href="#settings-of-common-jsp" title="Permalink to this headline">¶</a></h4>
<p>Describe the contents to be included in each common JSP in src/main/webapp/WEB-INF/views/common/include.jsp. Also define taglib in common area.
Create views/common folder and include.jsp file and describe as follows.</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">session</span><span class="o">=</span><span class="s">&quot;false&quot;</span><span class="k">%&gt;</span>
<span class="c">&lt;!-- (1) --&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;c&quot;</span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://java.sun.com/jsp/jstl/fmt&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;fmt&quot;</span><span class="k">%&gt;</span>
<span class="c">&lt;!-- (2)  --&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/tags&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;spring&quot;</span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/tags/form&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;form&quot;</span><span class="k">%&gt;</span>
<span class="c">&lt;!-- (3) --&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/security/tags&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;sec&quot;</span><span class="k">%&gt;</span>
<span class="c">&lt;!-- (4) --&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://terasoluna.org/functions&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;f&quot;</span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://terasoluna.org/tags&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;t&quot;</span><span class="k">%&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define standard tag library.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define tag library for Spring MVC.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define tag library for Spring Security.(However, it is not used in this tutorial)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define EL function and tag library provided in common library.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image014.png"><img alt="../_images/image014.png" src="../_images/image014.png" style="width: 40%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="settings-of-bean-definition-file">
<h4><a class="toc-backref" href="#id43">3.3.4.3. Settings of Bean definition file</a><a class="headerlink" href="#settings-of-bean-definition-file" title="Permalink to this headline">¶</a></h4>
<p>Create 4 types of Bean definition files in the following order.</p>
<ul class="simple">
<li>applicationContext.xml</li>
<li>todo-domain.xml</li>
<li>todo-infra.xml</li>
<li>spring-mvc.xml</li>
</ul>
<div class="section" id="applicationcontext-xml">
<h5>3.3.4.3.1. applicationContext.xml<a class="headerlink" href="#applicationcontext-xml" title="Permalink to this headline">¶</a></h5>
<p>Carry out settings related to entire Todo application in src/main/resources/META-INF/spring/applicationContext.xml.</p>
<p>Create META-INF/spring folder and create applicationContext.xml using <code class="docutils literal"><span class="pre">New</span></code> -&gt; <code class="docutils literal"><span class="pre">Spring</span> <span class="pre">Bean</span> <span class="pre">Configuration</span> <span class="pre">File</span></code>.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image016.jpg"><img alt="../_images/image016.jpg" src="../_images/image016.jpg" style="width: 40%;" /></a>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&quot;classpath:/META-INF/spring/todo-domain.xml&quot;</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;context:property-placeholder</span>
        <span class="na">location=</span><span class="s">&quot;classpath*:/META-INF/spring/*.properties&quot;</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.dozer.spring.DozerBeanMapperFactoryBean&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;mappingFiles&quot;</span>
            <span class="na">value=</span><span class="s">&quot;classpath*:/META-INF/dozer/**/*-mapping.xml&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Import Bean definition file related to domain layer.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Read the settings of property file.</div>
<div class="line">Read any property file under <code class="docutils literal"><span class="pre">src/main/resources/META-INF/spring</span></code>.</div>
<div class="line">Using this setting, it is possible to insert property file value in ${propertyName} format in Bean definition file and to inject using &#64;Value(“${propertyName}”) in Java class.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define Mapper of library Dozer for Bean conversion.</div>
<div class="line">(Not used in this tutorial, but while defining XML file for mapping, it should be created in <code class="docutils literal"><span class="pre">src/main/resources/META-INF/dozer/xxx-mapping.xml</span></code> format.</div>
<div class="line">For the mapping file, refer to <a class="reference external" href="http://dozer.sourceforge.net/documentation/mappings.html">Dozer manual</a> .)</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image018.png"><img alt="../_images/image018.png" src="../_images/image018.png" style="width: 40%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>While entering the above contents manually without copying them, open <code class="docutils literal"><span class="pre">namespace</span></code> tab and insert check-mark in <code class="docutils literal"><span class="pre">beans</span></code> and <code class="docutils literal"><span class="pre">context</span></code> in <code class="docutils literal"><span class="pre">Configure</span> <span class="pre">Namespace</span></code>.
It is recommended to select xsd file without version in <code class="docutils literal"><span class="pre">Namespace</span> <span class="pre">Versions</span></code>.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/image021.jpg"><img alt="../_images/image021.jpg" src="../_images/image021.jpg" style="width: 60%;" /></a>
</div>
<p>Thus, at the time of editing XML, it is possible to supplement the input using Ctrl+Space.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/image023.png"><img alt="../_images/image023.png" src="../_images/image023.png" style="width: 60%;" /></a>
</div>
<p class="last">Moreover, by not specifying the version, latest xsd included in the jar is used.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="todo-domain-xml">
<h5>3.3.4.3.2. todo-domain.xml<a class="headerlink" href="#todo-domain-xml" title="Permalink to this headline">¶</a></h5>
<p>Carry out settings related to domain layer in <code class="docutils literal"><span class="pre">src/main/resources/META-INF/spring/todo-domain.xml</span></code>.</p>
<p>Create todo-domain.xml using <code class="docutils literal"><span class="pre">New</span></code> -&gt; <code class="docutils literal"><span class="pre">Spring</span> <span class="pre">Bean</span> <span class="pre">Configuration</span> <span class="pre">File</span></code> under <code class="docutils literal"><span class="pre">META-INF/spring</span></code>.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&quot;classpath:META-INF/spring/todo-infra.xml&quot;</span><span class="nt">/&gt;</span>
    <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&quot;todo.domain&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Import Bean definition file related to infrastructure layer (explained later).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Components under todo.domain package are target of component scan.</div>
<div class="line">Thus, it is possible to make DI target by attaching annotations like <code class="docutils literal"><span class="pre">&#64;Repository</span></code> , <code class="docutils literal"><span class="pre">&#64;Service</span></code> , <code class="docutils literal"><span class="pre">&#64;Controller</span></code>, <code class="docutils literal"><span class="pre">&#64;Component</span></code> to the class under todo.domain package.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image024.png"><img alt="../_images/image024.png" src="../_images/image024.png" style="width: 40%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="todo-infra-xml">
<h5>3.3.4.3.3. todo-infra.xml<a class="headerlink" href="#todo-infra-xml" title="Permalink to this headline">¶</a></h5>
<p>Define Beans related to infrastructure layer in <code class="docutils literal"><span class="pre">src/main/resources/META-INF/spring/todo-infra.xml</span></code>.
Here, DB setting are carried out, but DB is not used in this section, hence the definition may be blank as follows. Bean will be defined in next section.</p>
<p>Create todo-infra.xml using <code class="docutils literal"><span class="pre">New</span></code> -&gt; <code class="docutils literal"><span class="pre">Spring</span> <span class="pre">Bean</span> <span class="pre">Configuration</span> <span class="pre">File</span></code> under <code class="docutils literal"><span class="pre">META-INF/spring</span></code>.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image025.png"><img alt="../_images/image025.png" src="../_images/image025.png" style="width: 40%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All the contents of todo-domain.xml, todo-infra.xml may likely be described in applicationContext.xml, however
it is recommended to split the file for each layer. It will be easy to understand the definitions at various locations and to improve maintainability.
There is no effect on a small application like the current tutorial, but larger the scope more the effect.</p>
</div>
</div>
<div class="section" id="spring-mvc-xml">
<h5>3.3.4.3.4. spring-mvc.xml<a class="headerlink" href="#spring-mvc-xml" title="Permalink to this headline">¶</a></h5>
<p>Define Spring MVC related definitions in <code class="docutils literal"><span class="pre">src/main/resources/META-INF/spring/spring-mvc.xml</span></code>.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
    <span class="na">xmlns:mvc=</span><span class="s">&quot;http://www.springframework.org/schema/mvc&quot;</span> <span class="na">xmlns:util=</span><span class="s">&quot;http://www.springframework.org/schema/util&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd</span>
<span class="s">        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd</span>
<span class="s">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;mvc:annotation-driven&gt;&lt;/mvc:annotation-driven&gt;</span>

    <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&quot;todo.app&quot;</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;mvc:resources</span> <span class="na">mapping=</span><span class="s">&quot;/resources/**&quot;</span>
        <span class="na">location=</span><span class="s">&quot;/resources/,classpath:META-INF/resources/&quot;</span>
        <span class="na">cache-period=</span><span class="s">&quot;#{60 * 60}&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;mvc:interceptors&gt;</span>
        <span class="c">&lt;!-- (4) --&gt;</span>
        <span class="nt">&lt;mvc:interceptor&gt;</span>
            <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&quot;/**&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/resources/**&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;bean</span>
                <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.logging.TraceLoggingInterceptor&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/mvc:interceptor&gt;</span>
    <span class="nt">&lt;/mvc:interceptors&gt;</span>

    <span class="c">&lt;!-- (5) --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;viewResolver&quot;</span>
        <span class="na">class=</span><span class="s">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;prefix&quot;</span> <span class="na">value=</span><span class="s">&quot;/WEB-INF/views/&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;suffix&quot;</span> <span class="na">value=</span><span class="s">&quot;.jsp&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Carry out annotation based default settings of Spring MVC.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Components under todo.app package that holds classes of application layer are made target of component-scan.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Carry out the settings for accessing the static resource (css, images, js etc.).</div>
<div class="line">Set URL path to <code class="docutils literal"><span class="pre">mapping</span></code> attribute and physical path to <code class="docutils literal"><span class="pre">location</span></code> attribute.</div>
<div class="line">In case of this setting, when there is a request for <code class="docutils literal"><span class="pre">&lt;contextPath&gt;/resources/css/styles.css</span></code>, <code class="docutils literal"><span class="pre">WEB-INF/resources/css/styles.css</span></code> is searched.</div>
<div class="line">If not found, <code class="docutils literal"><span class="pre">resources/css/style.css</span></code> is searched in classpath (src/main/resources and jar). If not found again, 404 error is returned.</div>
<div class="line">Cache period (3600 seconds = 60 minutes) of static resources is set in <code class="docutils literal"><span class="pre">cache-period</span></code> attribute.</div>
<div class="line">Further, static resources are not used in this tutorial.</div>
<div class="line"><code class="docutils literal"><span class="pre">cache-period=&quot;3600&quot;</span></code> is also correct, however, in order to demostrate that it is 60 minutes, it is better to write as <code class="docutils literal"><span class="pre">cache-period=&quot;#{60</span> <span class="pre">*</span> <span class="pre">60}&quot;</span></code> which uses <a class="reference external" href="http://static.springsource.org/spring/docs/3.2.x/spring-framework-reference/html/expressions.html#expressions-beandef-xml-based">SpEL</a> .</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set interceptor that outputs trace log of controller processing. Set so that it excludes the path under <code class="docutils literal"><span class="pre">/resources</span></code> from mapping.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Carry out the settings of ViewResolver. Using these settings, for example, when view name <code class="docutils literal"><span class="pre">hello</span></code> is returned from controller, <code class="docutils literal"><span class="pre">/WEB-INF/views/hello.jsp</span></code> is executed.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image026.png"><img alt="../_images/image026.png" src="../_images/image026.png" style="width: 40%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p>While entering the above contents manually without copying them, in addition to the operations described in todo-domain.xml, check mark should be put also to “mvc” and “util”.</p>
<div class="last figure align-center">
<a class="reference internal image-reference" href="../_images/image028.png"><img alt="../_images/image028.png" src="../_images/image028.png" style="width: 60%;" /></a>
</div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="logback-xml-settings">
<h4><a class="toc-backref" href="#id44">3.3.4.4. logback.xml settings</a><a class="headerlink" href="#logback-xml-settings" title="Permalink to this headline">¶</a></h4>
<p>Carry out log output settings using logback in <code class="docutils literal"><span class="pre">src/main/resources/logback.xml</span></code>.</p>
<p>Create logback.xml by <code class="docutils literal"><span class="pre">New</span></code> -&gt; <code class="docutils literal"><span class="pre">File</span></code> just under <code class="docutils literal"><span class="pre">src/main/resources/</span></code>.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE logback&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;STDOUT&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;encoder&gt;</span>
            <span class="nt">&lt;pattern&gt;</span><span class="cp">&lt;![CDATA[%d{yyyy-MM-dd HH:mm:ss} [%thread] [%-5level] [%-48logger{48}] - %msg%n]]&gt;</span><span class="nt">&lt;/pattern&gt;</span>
        <span class="nt">&lt;/encoder&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="c">&lt;!-- Application Loggers --&gt;</span>
    <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;todo&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;debug&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>

    <span class="c">&lt;!-- TERASOLUNA --&gt;</span>
    <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.terasoluna.gfw&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;info&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>
    <span class="c">&lt;!-- (4) --&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.terasoluna.gfw.web.logging.TraceLoggingInterceptor&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;trace&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>

    <span class="c">&lt;!-- 3rdparty Loggers --&gt;</span>
    <span class="c">&lt;!-- (5) --&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.springframework&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;warn&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>

    <span class="c">&lt;!-- (6) --&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.springframework.web.servlet&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;info&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>

    <span class="c">&lt;!-- (7) --&gt;</span>
    <span class="nt">&lt;root</span> <span class="na">level=</span><span class="s">&quot;WARN&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;STDOUT&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/root&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set appender that outputs the log in standard output.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set so that log of level ‘debug’ and above is output under todo package.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Change the log level of common library to info.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set log level to ‘trace’ for <code class="docutils literal"><span class="pre">TraceLoggingInterceptor</span></code> which is defined in spring-mvc.xml.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set so that log of level ‘warn’ and above is output for Spring Framework.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">For log of Spring Framework, set the log level to ‘info’ and above for <code class="docutils literal"><span class="pre">org.springframework.web.servlet</span></code> so that logs valueable to development activity gets output.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set so that log level of ‘warn’ and above is output by default.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image029.png"><img alt="../_images/image029.png" src="../_images/image029.png" style="width: 40%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="operation-verification">
<h3><a class="toc-backref" href="#id45">3.3.5. Operation verification</a><a class="headerlink" href="#operation-verification" title="Permalink to this headline">¶</a></h3>
<p>Before starting development of Todo application, create SpringMVC HelloWorld application and verify the operation.</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><th class="stub">Package:</th>
<td>todo.app.hello</td>
</tr>
<tr class="row-even"><th class="stub">Name:</th>
<td>HelloController</td>
</tr>
</tbody>
</table>
<p>Create todo.app.hello.HelloController using <code class="docutils literal"><span class="pre">New</span></code> -&gt; <code class="docutils literal"><span class="pre">Class</span></code>.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image030.jpg"><img alt="../_images/image030.jpg" src="../_images/image030.jpg" style="width: 40%;" /></a>
</div>
<p>Edit HelloController as shown below.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.app.hello</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>

<span class="c1">// (1)</span>
<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloController</span> <span class="p">{</span>
    <span class="c1">// (2)</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span>
            <span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">HelloController</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

    <span class="c1">// (3)</span>
    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Date</span> <span class="n">now</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="p">();</span>
        <span class="c1">// (4)</span>
        <span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;hello {}&quot;</span><span class="p">,</span> <span class="n">now</span><span class="p">);</span>
        <span class="c1">// (5)</span>
        <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;now&quot;</span><span class="p">,</span> <span class="n">now</span><span class="p">);</span>
        <span class="c1">// (6)</span>
        <span class="k">return</span> <span class="s">&quot;hello&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In order to make the Controller as component-scan target, attach <code class="docutils literal"><span class="pre">&#64;Controller</span></code> annotation to class level.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Generate logger. Since logback implements logger and API is SLF4J, <code class="docutils literal"><span class="pre">org.slf4j.Logger</span></code> should be used.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set mapping of methods for accessing <code class="docutils literal"><span class="pre">/</span></code> (root) using <code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Output debug log. <code class="docutils literal"><span class="pre">{}</span></code> is the placeholder.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">For passing date to the screen, add Date object with name <code class="docutils literal"><span class="pre">now</span></code> to Model.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Return hello as view name. Using ViewResolver settings, WEB-INF/views/hello.jsp is output.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Next, create view(jsp). Create src/main/webapp/WEB-INF/views/hello.jsp as follows.</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>Hello World!<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Hello World!<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
        Today is
        <span class="c">&lt;!-- (1) --&gt;</span>
        <span class="nt">&lt;fmt:formatDate</span> <span class="na">value=</span><span class="s">&quot;${now}&quot;</span> <span class="na">pattern=</span><span class="s">&quot;yyyy-MM-dd HH:mm:ss&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Display <code class="docutils literal"><span class="pre">now</span></code> passed from Controller. Here, <code class="docutils literal"><span class="pre">&lt;fmt:formatDate&gt;</span></code> tag is used for date formating.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Right click package project name <code class="docutils literal"><span class="pre">todo</span></code> and click <code class="docutils literal"><span class="pre">Run</span> <span class="pre">As</span></code> -&gt; <code class="docutils literal"><span class="pre">Run</span> <span class="pre">on</span> <span class="pre">Server</span></code></p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image031.jpg"><img alt="../_images/image031.jpg" src="../_images/image031.jpg" style="width: 40%;" /></a>
</div>
<p>Select AP server (here, VMWare vFabric tc Server Developer Edition v2.8) to be executed
Click <code class="docutils literal"><span class="pre">Next</span></code></p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image032.jpg"><img alt="../_images/image032.jpg" src="../_images/image032.jpg" style="width: 40%;" /></a>
</div>
<p>Verify that todo is included in <code class="docutils literal"><span class="pre">Configured</span></code>, click <code class="docutils literal"><span class="pre">Finish</span></code> to start the server.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image033.jpg"><img alt="../_images/image033.jpg" src="../_images/image033.jpg" style="width: 40%;" /></a>
</div>
<p>When started, log shown as below will be output. For <code class="docutils literal"><span class="pre">/</span></code> path, it is understood that hello method of <code class="docutils literal"><span class="pre">todo.app.hello.HelloController</span></code> is mapped.</p>
<div class="highlight-guess"><div class="highlight"><pre><span></span><span class="err"> 2013-06-14 14:26:54 [localhost-startStop-1] [WARN ] [org.dozer.config.GlobalSettings                 ] - Dozer configuration file not found: dozer.properties.  Using defaults for all Dozer global properties.</span>
<span class="err"> 2013-06-14 14:26:54 [localhost-startStop-1] [INFO ] [o.springframework.web.servlet.DispatcherServlet ] - FrameworkServlet &#39;appServlet&#39;: initialization started</span>
<span class="hll"><span class="err"> 2013-06-14 14:26:54 [localhost-startStop-1] [INFO ] [o.s.w.s.m.m.a.RequestMappingHandlerMapping      ] - Mapped &quot;{[/],methods=[],params=[],headers=[],consumes=[],produces=[],custom=[]}&quot; onto public java.lang.String todo.app.hello.HelloController.hello(org.springframework.ui.Model)</span>
</span><span class="err"> 2013-06-14 14:26:55 [localhost-startStop-1] [INFO ] [o.s.web.servlet.handler.SimpleUrlHandlerMapping ] - Mapped URL path [/resources/**] onto handler &#39;org.springframework.web.servlet.resource.ResourceHttpRequestHandler#0&#39;</span>
<span class="err"> 2013-06-14 14:26:55 [localhost-startStop-1] [INFO ] [o.springframework.web.servlet.DispatcherServlet ] - FrameworkServlet &#39;appServlet&#39;: initialization completed in 986 ms</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">WARN log of the first row may be ignored. In order to prevent, a blank dozer.properties should be created in src/main/resources.</p>
</div>
</div></blockquote>
<p>If <a class="reference external" href="http://localhost:8080/todo">http://localhost:8080/todo</a> is accessed in browser,
following is displayed.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image034.png"><img alt="../_images/image034.png" src="../_images/image034.png" style="width: 40%;" /></a>
</div>
<p>If you see console, you will understand that TRACE log using <code class="docutils literal"><span class="pre">TraceLoggingInterceptor</span></code> and debug log implemented by Controller is output.</p>
<div class="highlight-guess"><div class="highlight"><pre><span></span><span class="mi">2013</span><span class="o">-</span><span class="mo">06</span><span class="o">-</span><span class="mi">14</span> <span class="mi">15</span><span class="o">:</span><span class="mi">40</span><span class="o">:</span><span class="mi">59</span> <span class="p">[</span><span class="n">tomcat</span><span class="o">-</span><span class="n">http</span><span class="o">--</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">TRACE</span><span class="p">]</span> <span class="p">[</span><span class="n">o</span><span class="p">.</span><span class="n">t</span><span class="p">.</span><span class="n">gfw</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">logging</span><span class="p">.</span><span class="n">TraceLoggingInterceptor</span>     <span class="p">]</span> <span class="o">-</span> <span class="p">[</span><span class="n">START</span> <span class="n">CONTROLLER</span><span class="p">]</span> <span class="n">HelloController</span><span class="p">.</span><span class="n">hello</span><span class="p">(</span><span class="n">Model</span><span class="p">)</span>
<span class="mi">2013</span><span class="o">-</span><span class="mo">06</span><span class="o">-</span><span class="mi">14</span> <span class="mi">15</span><span class="o">:</span><span class="mi">40</span><span class="o">:</span><span class="mi">59</span> <span class="p">[</span><span class="n">tomcat</span><span class="o">-</span><span class="n">http</span><span class="o">--</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">DEBUG</span><span class="p">]</span> <span class="p">[</span><span class="n">todo</span><span class="p">.</span><span class="n">app</span><span class="p">.</span><span class="n">hello</span><span class="p">.</span><span class="n">HelloController</span>                  <span class="p">]</span> <span class="o">-</span> <span class="n">hello</span> <span class="n">Fri</span> <span class="n">Jun</span> <span class="mi">14</span> <span class="mi">15</span><span class="o">:</span><span class="mi">40</span><span class="o">:</span><span class="mi">59</span> <span class="n">JST</span> <span class="mi">2013</span>
<span class="mi">2013</span><span class="o">-</span><span class="mo">06</span><span class="o">-</span><span class="mi">14</span> <span class="mi">15</span><span class="o">:</span><span class="mi">40</span><span class="o">:</span><span class="mi">59</span> <span class="p">[</span><span class="n">tomcat</span><span class="o">-</span><span class="n">http</span><span class="o">--</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">TRACE</span><span class="p">]</span> <span class="p">[</span><span class="n">o</span><span class="p">.</span><span class="n">t</span><span class="p">.</span><span class="n">gfw</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">logging</span><span class="p">.</span><span class="n">TraceLoggingInterceptor</span>     <span class="p">]</span> <span class="o">-</span> <span class="p">[</span><span class="n">END</span> <span class="n">CONTROLLER</span>  <span class="p">]</span> <span class="n">HelloController</span><span class="p">.</span><span class="n">hello</span><span class="p">(</span><span class="n">Model</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">view</span><span class="o">=</span><span class="n">hello</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="n">now</span><span class="o">=</span><span class="n">Fri</span> <span class="n">Jun</span> <span class="mi">14</span> <span class="mi">15</span><span class="o">:</span><span class="mi">40</span><span class="o">:</span><span class="mi">59</span> <span class="n">JST</span> <span class="mi">2013</span><span class="p">}</span>
<span class="mi">2013</span><span class="o">-</span><span class="mo">06</span><span class="o">-</span><span class="mi">14</span> <span class="mi">15</span><span class="o">:</span><span class="mi">40</span><span class="o">:</span><span class="mi">59</span> <span class="p">[</span><span class="n">tomcat</span><span class="o">-</span><span class="n">http</span><span class="o">--</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">TRACE</span><span class="p">]</span> <span class="p">[</span><span class="n">o</span><span class="p">.</span><span class="n">t</span><span class="p">.</span><span class="n">gfw</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">logging</span><span class="p">.</span><span class="n">TraceLoggingInterceptor</span>     <span class="p">]</span> <span class="o">-</span> <span class="p">[</span><span class="n">HANDLING</span> <span class="n">TIME</span>   <span class="p">]</span> <span class="n">HelloController</span><span class="p">.</span><span class="n">hello</span><span class="p">(</span><span class="n">Model</span><span class="p">)</span><span class="o">-&gt;</span> <span class="mi">15</span><span class="p">,</span><span class="mo">043</span><span class="p">,</span><span class="mi">704</span> <span class="n">ns</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">TraceLoggingInterceptor</span></code> outputs start and end of Controller in log. While ending, View and Model information and processing time are output.</p>
</div>
</div></blockquote>
<p>After verification of log, one can delete HelloController and hello.jsp.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="creation-of-todo-application">
<h2><a class="toc-backref" href="#id46">3.4. Creation of Todo application</a><a class="headerlink" href="#creation-of-todo-application" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">Create Todo application. Order in which it must be created is as follows</div>
</div>
<ul class="simple">
<li>Domain layer (+ Infrastructure layer)</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Domain Object creation</li>
<li>Repository creation</li>
<li>Service creation</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Application layer</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Controller creation</li>
<li>Form creation</li>
<li>View creation</li>
</ul>
</div></blockquote>
<p>Further, do not use DB for saving Todo in this section. Creation of Repository in which DB is used, is carried out in <a class="reference internal" href="#tutorial-todo-infra"><span class="std std-ref">Change of infrastructure layer</span></a>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="creation-of-domain-layer">
<h3><a class="toc-backref" href="#id47">3.4.1. Creation of Domain layer</a><a class="headerlink" href="#creation-of-domain-layer" title="Permalink to this headline">¶</a></h3>
<div class="section" id="creation-of-domain-object">
<h4><a class="toc-backref" href="#id48">3.4.1.1. Creation of Domain Object</a><a class="headerlink" href="#creation-of-domain-object" title="Permalink to this headline">¶</a></h4>
<p>Following properties are required in domain object.</p>
<ol class="arabic simple">
<li>ID</li>
<li>Title</li>
<li>Completion flag</li>
<li>Created on</li>
</ol>
<p>Create the following Domain objects.
FQCN should be <code class="docutils literal"><span class="pre">todo.domain.model.Todo</span></code>. Implement as JavaBean.</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><th class="stub">Package:</th>
<td>todo.domain.model</td>
</tr>
<tr class="row-even"><th class="stub">Name:</th>
<td>Todo</td>
</tr>
<tr class="row-odd"><th class="stub">Interfaces:</th>
<td>java.io.Serializable</td>
</tr>
</tbody>
</table>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image057.png"><img alt="../_images/image057.png" src="../_images/image057.png" style="width: 40%;" /></a>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.domain.model</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Todo</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="p">;</span>


    <span class="kd">private</span> <span class="n">String</span> <span class="n">todoId</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">todoTitle</span><span class="p">;</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">finished</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">Date</span> <span class="n">createdAt</span><span class="p">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTodoId</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">todoId</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTodoId</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">todoId</span> <span class="o">=</span> <span class="n">todoId</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTodoTitle</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">todoTitle</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTodoTitle</span><span class="p">(</span><span class="n">String</span> <span class="n">todoTitle</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">todoTitle</span> <span class="o">=</span> <span class="n">todoTitle</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isFinished</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">finished</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFinished</span><span class="p">(</span><span class="kt">boolean</span> <span class="n">finished</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">finished</span> <span class="o">=</span> <span class="n">finished</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getCreatedAt</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">createdAt</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCreatedAt</span><span class="p">(</span><span class="n">Date</span> <span class="n">createdAt</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">createdAt</span> <span class="o">=</span> <span class="n">createdAt</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image058.png"><img alt="../_images/image058.png" src="../_images/image058.png" style="width: 40%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Getter/Setter can be generated automatically. After defining fields, right click <code class="docutils literal"><span class="pre">Source</span></code> -&gt; <code class="docutils literal"><span class="pre">Generate</span> <span class="pre">Getter</span> <span class="pre">and</span> <span class="pre">Setters…</span></code></p>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image059.png"><img alt="../_images/image059.png" src="../_images/image059.png" style="width: 40%;" /></a>
</div>
<p>Click <code class="docutils literal"><span class="pre">OK</span></code> after selecting all other than serialVersionUID</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image060.png"><img alt="../_images/image060.png" src="../_images/image060.png" style="width: 40%;" /></a>
</div>
</div></blockquote>
</div>
<div class="section" id="repository-creation">
<h4><a class="toc-backref" href="#id49">3.4.1.2. Repository creation</a><a class="headerlink" href="#repository-creation" title="Permalink to this headline">¶</a></h4>
<p>Following are the steps of CRUD operations pertaining to TODO object required in the current application.</p>
<ul class="simple">
<li>Fetch 1 record of TODO</li>
<li>Fetch all records of TODO</li>
<li>Delete 1 record of TODO</li>
<li>Update 1 record of TODO</li>
<li>Fetch record count of completed TODO</li>
</ul>
<p>Create interface TodoRepository that defines these operations.
FQCN should be <code class="docutils literal"><span class="pre">todo.domain.repository.todo.TodoRepository</span></code>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.domain.repository.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">todo.domain.model.Todo</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoRepository</span> <span class="p">{</span>
    <span class="n">Todo</span> <span class="nf">findOne</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">);</span>

    <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="p">();</span>

    <span class="n">Todo</span> <span class="nf">save</span><span class="p">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="p">);</span>

    <span class="kt">void</span> <span class="nf">delete</span><span class="p">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="p">);</span>

    <span class="kt">long</span> <span class="nf">countByFinished</span><span class="p">(</span><span class="kt">boolean</span> <span class="n">finished</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image061.png"><img alt="../_images/image061.png" src="../_images/image061.png" style="width: 40%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Here, to improve versatility of TodoRepository, method is defined to fetch <code class="docutils literal"><span class="pre">record</span> <span class="pre">count</span> <span class="pre">having</span> <span class="pre">x</span> <span class="pre">completion</span> <span class="pre">status</span></code> and not <code class="docutils literal"><span class="pre">Fetch</span> <span class="pre">completed</span> <span class="pre">record</span> <span class="pre">count</span></code>.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="creation-of-repositoryimpl-infrastructure-layer">
<h4><a class="toc-backref" href="#id50">3.4.1.3. Creation of RepositoryImpl (Infrastructure layer)</a><a class="headerlink" href="#creation-of-repositoryimpl-infrastructure-layer" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">For simplification, in-memory implementation that uses Map as the implementation of Repository is used.</div>
<div class="line">Repository implementation using DB is described in <a class="reference internal" href="#tutorial-todo-infra"><span class="std std-ref">Change of infrastructure layer</span></a>.</div>
<div class="line">FQCN should be <code class="docutils literal"><span class="pre">todo.domain.repository.todo.TodoRepositoryImpl</span></code>.</div>
<div class="line"><code class="docutils literal"><span class="pre">&#64;Repository</span></code>annotation must be used at class level.</div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.domain.repository.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ConcurrentHashMap</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">todo.domain.model.Todo</span><span class="p">;</span>

<span class="nd">@Repository</span> <span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoRepositoryImpl</span> <span class="kd">implements</span> <span class="n">TodoRepository</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Todo</span><span class="o">&gt;</span> <span class="n">TODO_MAP</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Todo</span><span class="o">&gt;</span><span class="p">();</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Todo</span> <span class="nf">findOne</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">TODO_MAP</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">todoId</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">TODO_MAP</span><span class="p">.</span><span class="na">values</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Todo</span> <span class="nf">save</span><span class="p">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">TODO_MAP</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">todo</span><span class="p">.</span><span class="na">getTodoId</span><span class="p">(),</span> <span class="n">todo</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="p">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">TODO_MAP</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">todo</span><span class="p">.</span><span class="na">getTodoId</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">countByFinished</span><span class="p">(</span><span class="kt">boolean</span> <span class="n">finished</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">long</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">Todo</span> <span class="n">todo</span> <span class="p">:</span> <span class="n">TODO_MAP</span><span class="p">.</span><span class="na">values</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">finished</span> <span class="o">==</span> <span class="n">todo</span><span class="p">.</span><span class="na">isFinished</span><span class="p">())</span> <span class="p">{</span>
                <span class="n">count</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">count</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">To consider Repository as component scan target, add <code class="docutils literal"><span class="pre">&#64;Repository</span></code>annotation at class level.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Since the business rules must not be included in Repository, it should focus only on inserting and removing information from the persistence store (here, it is Map).</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image062.png"><img alt="../_images/image062.png" src="../_images/image062.png" style="width: 40%;" /></a>
</div>
<dl class="docutils">
<dt></dt>
<dd><div class="first last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If package is divided completed on the basis of layers, it is better create classes of infrastructure layer under <code class="docutils literal"><span class="pre">todo.infrastructure</span></code>.
However, in a normal project, infrastructure layer rarely changes.
Hence, in order to improve the work efficiency, RepositoryImpl can be created in the layer same as the repository of domain layer.</p>
</div>
</dd>
</dl>
</div>
<div class="section" id="service-creation">
<h4><a class="toc-backref" href="#id51">3.4.1.4. Service creation</a><a class="headerlink" href="#service-creation" title="Permalink to this headline">¶</a></h4>
<p>Implement business logic. The required processes are as follows.</p>
<ul class="simple">
<li>Fetch all records of Todo</li>
<li>New creation of Todo</li>
<li>Todo completion</li>
<li>Todo deletion</li>
</ul>
<p>First, create TodoService interface and then define the above.
FQCN shold be <code class="docutils literal"><span class="pre">todo.domain.serivce.todo.TodoService</span></code>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.domain.service.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">todo.domain.model.Todo</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoService</span> <span class="p">{</span>
    <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="p">();</span>

    <span class="n">Todo</span> <span class="nf">create</span><span class="p">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="p">);</span>

    <span class="n">Todo</span> <span class="nf">finish</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">);</span>

    <span class="kt">void</span> <span class="nf">delete</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The required processes and the corresponding implementation methods are as follows</p>
<ul class="simple">
<li>Fetch all records of Todo→ findAll method</li>
<li>New creation of Todo→create method</li>
<li>Todo completion→finish method</li>
<li>Todo deletion→delete method</li>
</ul>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image063.png"><img alt="../_images/image063.png" src="../_images/image063.png" style="width: 40%;" /></a>
</div>
<p>FQCN of implementation class should be <code class="docutils literal"><span class="pre">todo.domain.service.TodoServiceImpl</span></code>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.domain.service.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.UUID</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>
<span class="c1">//import org.springframework.transaction.annotation.Transactional;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.exception.BusinessException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.exception.ResourceNotFoundException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessage</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessages</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">todo.domain.model.Todo</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">todo.domain.repository.todo.TodoRepository</span><span class="p">;</span>

<span class="nd">@Service</span><span class="c1">// (1)</span>
<span class="c1">// @Transactional // (2)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoServiceImpl</span> <span class="kd">implements</span> <span class="n">TodoService</span> <span class="p">{</span>
    <span class="nd">@Inject</span><span class="c1">// (3)</span>
    <span class="kd">protected</span> <span class="n">TodoRepository</span> <span class="n">todoRepository</span><span class="p">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">MAX_UNFINISHED_COUNT</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

    <span class="c1">// (4)</span>
    <span class="kd">public</span> <span class="n">Todo</span> <span class="nf">findOne</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Todo</span> <span class="n">todo</span> <span class="o">=</span> <span class="n">todoRepository</span><span class="p">.</span><span class="na">findOne</span><span class="p">(</span><span class="n">todoId</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">todo</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// (5)</span>
            <span class="n">ResultMessages</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">ResultMessages</span><span class="p">.</span><span class="na">error</span><span class="p">();</span>
            <span class="n">messages</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">ResultMessage</span>
                    <span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;[E404] The requested Todo is not found. (id=&quot;</span>
                            <span class="o">+</span> <span class="n">todoId</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">));</span>
            <span class="c1">// (6)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">ResourceNotFoundException</span><span class="p">(</span><span class="n">messages</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">todo</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">todoRepository</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Todo</span> <span class="nf">create</span><span class="p">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">long</span> <span class="n">unfinishedCount</span> <span class="o">=</span> <span class="n">todoRepository</span><span class="p">.</span><span class="na">countByFinished</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">unfinishedCount</span> <span class="o">&gt;=</span> <span class="n">MAX_UNFINISHED_COUNT</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">ResultMessages</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">ResultMessages</span><span class="p">.</span><span class="na">error</span><span class="p">();</span>
            <span class="n">messages</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">ResultMessage</span>
                    <span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;[E001] The count of un-finished Todo must not be over &quot;</span>
                            <span class="o">+</span> <span class="n">MAX_UNFINISHED_COUNT</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span><span class="p">));</span>
            <span class="c1">// (7)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">BusinessException</span><span class="p">(</span><span class="n">messages</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// (8)</span>
        <span class="n">String</span> <span class="n">todoId</span> <span class="o">=</span> <span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span>
        <span class="n">Date</span> <span class="n">createdAt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="p">();</span>

        <span class="n">todo</span><span class="p">.</span><span class="na">setTodoId</span><span class="p">(</span><span class="n">todoId</span><span class="p">);</span>
        <span class="n">todo</span><span class="p">.</span><span class="na">setCreatedAt</span><span class="p">(</span><span class="n">createdAt</span><span class="p">);</span>
        <span class="n">todo</span><span class="p">.</span><span class="na">setFinished</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

        <span class="n">todoRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">todo</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Todo</span> <span class="nf">finish</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Todo</span> <span class="n">todo</span> <span class="o">=</span> <span class="n">findOne</span><span class="p">(</span><span class="n">todoId</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">todo</span><span class="p">.</span><span class="na">isFinished</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">ResultMessages</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">ResultMessages</span><span class="p">.</span><span class="na">error</span><span class="p">();</span>
            <span class="n">messages</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">ResultMessage</span>
                    <span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;[E002] The requested Todo is already finished. (id=&quot;</span>
                            <span class="o">+</span> <span class="n">todoId</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">));</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">BusinessException</span><span class="p">(</span><span class="n">messages</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">todo</span><span class="p">.</span><span class="na">setFinished</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="n">todoRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">todo</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Todo</span> <span class="n">todo</span> <span class="o">=</span> <span class="n">findOne</span><span class="p">(</span><span class="n">todoId</span><span class="p">);</span>
        <span class="n">todoRepository</span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">To consider Service as component-scan target, add <code class="docutils literal"><span class="pre">&#64;Service</span></code> at class level.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">DB is not used in the current implementation, hence transaction management is not required, but when DB is to be used, <code class="docutils literal"><span class="pre">&#64;Transactional</span></code> should be added at class level.</div>
<div class="line">It is described in <a class="reference internal" href="#tutorial-todo-infra"><span class="std std-ref">Change of infrastructure layer</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Inject TodoRepository implementation using <code class="docutils literal"><span class="pre">&#64;Inject</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Logic fetch a single record is used in both, delete and finish method. Hence it should be implemented in a method (OK to make it public by declaring in the interface).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use <code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.message.ResultMessage</span></code> provided in common library, as a class that stores result messages.</div>
<div class="line">Currently, for throwing error message, ResultMessage is added by specifying message type using <code class="docutils literal"><span class="pre">ResultMessages.error()</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When target data is not found, <code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.exception.ResourceNotFoundException</span></code> provided in common library is thrown.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When business error occurs, <code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.exception.BusinessException</span></code> provided in common library is thrown.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">UUID is used to generate a unique value. DB sequence may be used.</div>
</div>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt></dt>
<dd><div class="first last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In this chapter, error message is hard coded for simplification, but in reality it is not preferred from maintenance viewpoint.
Usually, it is recommended to create message externally in property file.
The method for creating the message externally in property file is described in <a class="reference internal" href="../ArchitectureInDetail/PropertyManagement.html"><span class="doc">Properties Management</span></a>.</p>
</div>
</dd>
</dl>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image064.png"><img alt="../_images/image064.png" src="../_images/image064.png" style="width: 40%;" /></a>
</div>
</div>
<div class="section" id="creation-of-junit-for-service">
<h4><a class="toc-backref" href="#id52">3.4.1.5. Creation of JUnit for Service</a><a class="headerlink" href="#creation-of-junit-for-service" title="Permalink to this headline">¶</a></h4>
<p>TBD</p>
</div>
</div>
<div class="section" id="creation-of-application-layer">
<h3><a class="toc-backref" href="#id53">3.4.2. Creation of application layer</a><a class="headerlink" href="#creation-of-application-layer" title="Permalink to this headline">¶</a></h3>
<p>Since domain layer implementation is completed, use the domain layer to create application layer.</p>
<div class="section" id="creation-of-controller">
<h4><a class="toc-backref" href="#id54">3.4.2.1. Creation of Controller</a><a class="headerlink" href="#creation-of-controller" title="Permalink to this headline">¶</a></h4>
<p>First create TodoController that controls screen transition.
FQCN should be <code class="docutils literal"><span class="pre">todo.app.todo.TodoController</span></code>.
It should be noted that the higher level package is different from the domain layer.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.app.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>

<span class="nd">@Controller</span> <span class="c1">// (1)</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;todo&quot;</span><span class="p">)</span> <span class="c1">// (2)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoController</span> <span class="p">{</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In order to make Controller as component-scan target, add <code class="docutils literal"><span class="pre">&#64;Controller</span></code> at class level.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In order to bring all screen transitions handled by TodoController, under <code class="docutils literal"><span class="pre">&lt;contextPath&gt;/todo</span></code>, set <code class="docutils literal"><span class="pre">&#64;RequestMapping(“todo”)</span></code> at class level.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image065.png"><img alt="../_images/image065.png" src="../_images/image065.png" style="width: 40%;" /></a>
</div>
<div class="section" id="id1">
<h5>3.4.2.1.1. Show all TODO<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
<p>Following is performed on this screen.</p>
<ul class="simple">
<li>Display of new form</li>
<li>Display of all records of TODO</li>
</ul>
<div class="section" id="form-creation">
<h6>3.4.2.1.1.1. Form creation<a class="headerlink" href="#form-creation" title="Permalink to this headline">¶</a></h6>
<p>Form must contain title information. It should be implemented as JavaBean as shown below. FQCN should be <code class="docutils literal"><span class="pre">todo.app.todo.TodoForm</span></code>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">todo.app.todo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoForm</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">todoTitle</span><span class="p">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTodoTitle</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">todoTitle</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTodoTitle</span><span class="p">(</span><span class="n">String</span> <span class="n">todoTitle</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">todoTitle</span> <span class="o">=</span> <span class="n">todoTitle</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image066.png"><img alt="../_images/image066.png" src="../_images/image066.png" style="width: 40%;" /></a>
</div>
</div>
<div class="section" id="implementation-of-controller">
<h6>3.4.2.1.1.2. Implementation of Controller<a class="headerlink" href="#implementation-of-controller" title="Permalink to this headline">¶</a></h6>
<p>Implement <code class="docutils literal"><span class="pre">setUpForm</span></code> method and <code class="docutils literal"><span class="pre">list</span></code> method in TodoController.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span> <span class="kn">package</span> <span class="nn">todo.app.todo</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">todo.domain.model.Todo</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">todo.domain.service.todo.TodoService</span><span class="p">;</span>

 <span class="nd">@Controller</span>
 <span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;todo&quot;</span><span class="p">)</span>
 <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoController</span> <span class="p">{</span>
     <span class="nd">@Inject</span> <span class="c1">// (3)</span>
<span class="hll">     <span class="kd">protected</span> <span class="n">TodoService</span> <span class="n">todoService</span><span class="p">;</span>
</span><span class="hll">
</span><span class="hll">     <span class="nd">@ModelAttribute</span> <span class="c1">// (4)</span>
</span><span class="hll">     <span class="kd">public</span> <span class="n">TodoForm</span> <span class="nf">setUpForm</span><span class="p">()</span> <span class="p">{</span>
</span><span class="hll">         <span class="n">TodoForm</span> <span class="n">form</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TodoForm</span><span class="p">();</span>
</span><span class="hll">         <span class="k">return</span> <span class="n">form</span><span class="p">;</span>
</span><span class="hll">     <span class="p">}</span>
</span><span class="hll">
</span><span class="hll">     <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;list&quot;</span><span class="p">)</span> <span class="c1">// (5)</span>
</span><span class="hll">     <span class="kd">public</span> <span class="n">String</span> <span class="nf">list</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">         <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">todos</span> <span class="o">=</span> <span class="n">todoService</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
</span><span class="hll">         <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;todos&quot;</span><span class="p">,</span> <span class="n">todos</span><span class="p">);</span> <span class="c1">// (6</span>
</span><span class="hll">         <span class="k">return</span> <span class="s">&quot;todo/list&quot;</span><span class="p">;</span> <span class="c1">// (7)</span>
</span><span class="hll">     <span class="p">}</span>
</span><span class="hll"> <span class="p">}</span>
</span></pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add <code class="docutils literal"><span class="pre">&#64;Inject</span></code> annotation for injecting <code class="docutils literal"><span class="pre">TodoService</span></code> using DI container. Since instance  of type <code class="docutils literal"><span class="pre">TodoService</span></code> managed by DI container is injected,</div>
<div class="line">as a result, <code class="docutils literal"><span class="pre">TodoServicelmpl</span></code> instance is injected.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Initialize Form. Adding <code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code> annotation, form object of the return value of this method is added to Model with name <code class="docutils literal"><span class="pre">todoForm</span></code>.</div>
<div class="line">It is same as executing model.addAttribute(“todoForm”, form) in each method of TodoController.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Map list method to <code class="docutils literal"><span class="pre">&lt;contextPath&gt;/todo/list</span></code>. Since &#64;RequestMapping(“todo”) is being set at class level, only &#64;RequestMapping(value = “list”) is required to be set here.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add Todo list to Model and pass to View.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">If <code class="docutils literal"><span class="pre">todo/list</span></code> is returned as View name, <code class="docutils literal"><span class="pre">WEB-INF/views/todo/list.jsp</span></code> will be rendered using <code class="docutils literal"><span class="pre">InternalResourceViewResolver</span></code> defined in spring-mvc.xml.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="jsp-creation">
<h6>3.4.2.1.1.3. JSP creation<a class="headerlink" href="#jsp-creation" title="Permalink to this headline">¶</a></h6>
<p>Display Model passed from Controller in <code class="docutils literal"><span class="pre">WEB-INF/views/todo/list.jsp</span></code>.
First, create buttons except “Finish”<a href="#id2"><span class="problematic" id="id3">`</span></a>, “Delete”.</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>Todo List<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;style</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
.strike {
    text-decoration: line-through;
}
<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Todo List<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;todoForm&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- (1) --&gt;</span>
        <span class="nt">&lt;form:form</span>
           <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/todo/create&quot;</span>
            <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">modelAttribute=</span><span class="s">&quot;todoForm&quot;</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- (2) --&gt;</span>
            <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;todoTitle&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Create Todo&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form:form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;hr</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;todoList&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ul&gt;</span>
            <span class="c">&lt;!-- (3) --&gt;</span>
            <span class="nt">&lt;c:forEach</span> <span class="na">items=</span><span class="s">&quot;${todos}&quot;</span> <span class="na">var=</span><span class="s">&quot;todo&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;li&gt;&lt;c:choose&gt;</span>
                        <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">&quot;${todo.finished}&quot;</span><span class="nt">&gt;</span><span class="c">&lt;!-- (4) --&gt;</span>
                            <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;strike&quot;</span><span class="nt">&gt;</span>
                            <span class="c">&lt;!-- (5) --&gt;</span>
                            ${f:h(todo.todoTitle)}
                            <span class="nt">&lt;/span&gt;</span>
                        <span class="nt">&lt;/c:when&gt;</span>
                        <span class="nt">&lt;c:otherwise&gt;</span>
                            ${f:h(todo.todoTitle)}
                         <span class="nt">&lt;/c:otherwise&gt;</span>
                    <span class="nt">&lt;/c:choose&gt;&lt;/li&gt;</span>
            <span class="nt">&lt;/c:forEach&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Display form object using &lt;form:form&gt; tag. Specify name of the form object added to Model by Controller in <code class="docutils literal"><span class="pre">modelAttribute</span></code> attribute.</div>
<div class="line"><code class="docutils literal"><span class="pre">contextPath</span></code> to be specified in <code class="docutils literal"><span class="pre">action</span></code> attribute can be fetched in <code class="docutils literal"><span class="pre">${pageContext.request.contextPath}</span></code></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Bind form property using &lt;form:input&gt; tag. Property name of form which is specified in <code class="docutils literal"><span class="pre">modelAttribute</span></code> should match with the value of <code class="docutils literal"><span class="pre">path</span></code> attribute.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Display entire list of Todo using <code class="docutils literal"><span class="pre">&lt;c:forEach&gt;</span></code> tag.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Determine whether to decorate text using strikethrough(text-decoration: line-through;) to display if it is completed (finished).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><strong>To take XSS countermeasures at the time of output of character string, HTML escape should be performed using f:h() function.</strong></div>
<div class="line">Regarding XSS measures, refer to <a class="reference internal" href="../Security/XSS.html"><span class="doc">XSS Countermeasures</span></a>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">Right click <code class="docutils literal"><span class="pre">todo</span></code> project in STS and start Web application by <code class="docutils literal"><span class="pre">Run</span> <span class="pre">As</span></code> → <code class="docutils literal"><span class="pre">Run</span> <span class="pre">on</span> <span class="pre">Server</span></code>.</div>
<div class="line">If <code class="docutils literal"><span class="pre">http://localhost:8080/todo/todo/list</span></code> is accessed in browser, the following screen gets displayed.</div>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image067.png"><img alt="../_images/image067.png" src="../_images/image067.png" style="width: 40%;" /></a>
</div>
</div>
</div>
<div class="section" id="id4">
<h5>3.4.2.1.2. Create TODO<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
<p>Next, implement a new business logic after clicking  <code class="docutils literal"><span class="pre">Create</span> <span class="pre">TODO</span></code> button on List display screen.</p>
<div class="section" id="modifications-in-controller">
<h6>3.4.2.1.2.1. Modifications in Controller<a class="headerlink" href="#modifications-in-controller" title="Permalink to this headline">¶</a></h6>
<p>Add <code class="docutils literal"><span class="pre">create</span></code> method to TodoController.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span> <span class="kn">package</span> <span class="nn">todo.app.todo</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">javax.validation.Valid</span><span class="p">;</span>

<span class="hll"> <span class="kn">import</span> <span class="nn">org.dozer.Mapper</span><span class="p">;</span>
</span> <span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.web.servlet.mvc.support.RedirectAttributes</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.exception.BusinessException</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessage</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessages</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">todo.domain.model.Todo</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">todo.domain.service.todo.TodoService</span><span class="p">;</span>

 <span class="nd">@Controller</span>
 <span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;todo&quot;</span><span class="p">)</span>
 <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoController</span> <span class="p">{</span>
     <span class="nd">@Inject</span>
     <span class="n">TodoService</span> <span class="n">todoService</span><span class="p">;</span>

<span class="hll">     <span class="c1">// (8)</span>
</span><span class="hll">     <span class="nd">@Inject</span>
</span><span class="hll">     <span class="n">Mapper</span> <span class="n">beanMapper</span><span class="p">;</span>
</span>
     <span class="nd">@ModelAttribute</span>
     <span class="kd">public</span> <span class="n">TodoForm</span> <span class="nf">setUpForm</span><span class="p">()</span> <span class="p">{</span>
         <span class="n">TodoForm</span> <span class="n">form</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TodoForm</span><span class="p">();</span>
         <span class="k">return</span> <span class="n">form</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;list&quot;</span><span class="p">)</span>
     <span class="kd">public</span> <span class="n">String</span> <span class="nf">list</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">todos</span> <span class="o">=</span> <span class="n">todoService</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
         <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;todos&quot;</span><span class="p">,</span> <span class="n">todos</span><span class="p">);</span>
         <span class="k">return</span> <span class="s">&quot;todo/list&quot;</span><span class="p">;</span>
     <span class="p">}</span>

<span class="hll">     <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span> <span class="c1">// (9)</span>
</span><span class="hll">     <span class="kd">public</span> <span class="n">String</span> <span class="nf">create</span><span class="p">(</span><span class="nd">@Valid</span> <span class="n">TodoForm</span> <span class="n">todoForm</span><span class="p">,</span> <span class="n">BindingResult</span> <span class="n">bindingResult</span><span class="p">,</span> <span class="c1">// (10)</span>
</span><span class="hll">             <span class="n">Model</span> <span class="n">model</span><span class="p">,</span> <span class="n">RedirectAttributes</span> <span class="n">attributes</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// (11)</span>
</span><span class="hll">
</span><span class="hll">         <span class="c1">// (12)</span>
</span><span class="hll">         <span class="k">if</span> <span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
</span><span class="hll">             <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
</span><span class="hll">         <span class="p">}</span>
</span><span class="hll">
</span><span class="hll">         <span class="c1">// (13)</span>
</span><span class="hll">         <span class="n">Todo</span> <span class="n">todo</span> <span class="o">=</span> <span class="n">beanMapper</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">todoForm</span><span class="p">,</span> <span class="n">Todo</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span class="hll">
</span><span class="hll">         <span class="k">try</span> <span class="p">{</span>
</span><span class="hll">             <span class="n">todoService</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
</span><span class="hll">         <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">BusinessException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">             <span class="c1">// (14)</span>
</span><span class="hll">             <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getResultMessages</span><span class="p">());</span>
</span><span class="hll">             <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
</span><span class="hll">         <span class="p">}</span>
</span><span class="hll">
</span><span class="hll">         <span class="c1">// (15)</span>
</span><span class="hll">         <span class="n">attributes</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="n">ResultMessages</span><span class="p">.</span><span class="na">success</span><span class="p">().</span><span class="na">add</span><span class="p">(</span>
</span><span class="hll">                 <span class="n">ResultMessage</span><span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;Created successfully!&quot;</span><span class="p">)));</span>
</span><span class="hll">         <span class="k">return</span> <span class="s">&quot;redirect:/todo/list&quot;</span><span class="p">;</span>
</span><span class="hll">     <span class="p">}</span>
</span>
 <span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">At the time of converting form object into domain object. Inject useful Mapper.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set <code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code> such that HTTP method corresponds to POST with path <code class="docutils literal"><span class="pre">/todo/create</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">For performing input validation of form, add <code class="docutils literal"><span class="pre">&#64;Valid</span></code> to form argument. Input validation result is stored in the immediate next argument <code class="docutils literal"><span class="pre">BindingResult</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(11)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Return to list screen by redirecting after it is created normally. Add <code class="docutils literal"><span class="pre">RedirectAttributes</span></code> to argument for storing the information to be redirected.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(12)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Return to list screen in case of input error. Re-execute <code class="docutils literal"><span class="pre">list</span></code> method as it is necessary to fetch all records of Todo again.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(13)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create Todo object from TodoForm using Mapper. No need to set if the property name of conversion source and destination is the same.</div>
<div class="line">There is no merit in using Mapper to convert only todoTitle property, but it is very convenient in case of multiple properties.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(14)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Execute business logic and in case of <code class="docutils literal"><span class="pre">BusinessException</span></code>, add the result message to Model and return to list screen.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(15)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Since it is created normally, add the result message to flash scope and redirect to list screen. Since redirect is used, there is no case of browser being</div>
<div class="line">read again and a new registration process being launched. Since this time ‘Created successfully’ message is displayed, ResultMessages.success() is used.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="modifications-in-form">
<h6>3.4.2.1.2.2. Modifications in Form<a class="headerlink" href="#modifications-in-form" title="Permalink to this headline">¶</a></h6>
<p>To define input validation rules, add annotations in form class.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span> <span class="kn">package</span> <span class="nn">todo.app.todo</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="p">;</span>

<span class="hll"> <span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="p">;</span>
</span><span class="hll"> <span class="kn">import</span> <span class="nn">javax.validation.constraints.Size</span><span class="p">;</span>
</span>
 <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoForm</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>
     <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="p">;</span>

<span class="hll">     <span class="nd">@NotNull</span> <span class="c1">// (1)</span>
</span><span class="hll">     <span class="nd">@Size</span><span class="p">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span> <span class="c1">// (2)</span>
</span>     <span class="kd">private</span> <span class="n">String</span> <span class="n">todoTitle</span><span class="p">;</span>

     <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTodoTitle</span><span class="p">()</span> <span class="p">{</span>
         <span class="k">return</span> <span class="n">todoTitle</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTodoTitle</span><span class="p">(</span><span class="n">String</span> <span class="n">todoTitle</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">this</span><span class="p">.</span><span class="na">todoTitle</span> <span class="o">=</span> <span class="n">todoTitle</span><span class="p">;</span>
     <span class="p">}</span>
 <span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Since it is a mandatory item, add <code class="docutils literal"><span class="pre">&#64;NotNull</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the range for <code class="docutils literal"><span class="pre">&#64;Size</span></code> between 1 - 30 characters.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="modifications-in-jsp">
<h6>3.4.2.1.2.3. Modifications in JSP<a class="headerlink" href="#modifications-in-jsp" title="Permalink to this headline">¶</a></h6>
<p>Add the tag for dislaying the result message.</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span> <span class="cp">&lt;!DOCTYPE html&gt;</span>
 <span class="nt">&lt;html&gt;</span>
 <span class="nt">&lt;head&gt;</span>
 <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;title&gt;</span>Todo List<span class="nt">&lt;/title&gt;</span>
 <span class="nt">&lt;style</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
 .strike {
     text-decoration: line-through;
 }
 <span class="nt">&lt;/style&gt;</span>
 <span class="nt">&lt;/head&gt;</span>
 <span class="nt">&lt;body&gt;</span>
     <span class="nt">&lt;h1&gt;</span>Todo List<span class="nt">&lt;/h1&gt;</span>
     <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;todoForm&quot;</span><span class="nt">&gt;</span>
         <span class="c">&lt;!-- (6) --&gt;</span>
<span class="hll">         <span class="nt">&lt;t:messagesPanel</span> <span class="nt">/&gt;</span>
</span>
         <span class="nt">&lt;form:form</span>
            <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/todo/create&quot;</span>
             <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">modelAttribute=</span><span class="s">&quot;todoForm&quot;</span><span class="nt">&gt;</span>
             <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;todoTitle&quot;</span> <span class="nt">/&gt;</span>
<span class="hll">             <span class="nt">&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;todoTitle&quot;</span> <span class="nt">/&gt;</span><span class="c">&lt;!-- (7) --&gt;</span>
</span>             <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Create Todo&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;/form:form&gt;</span>
     <span class="nt">&lt;/div&gt;</span>
     <span class="nt">&lt;hr</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;todoList&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;ul&gt;</span>
             <span class="nt">&lt;c:forEach</span> <span class="na">items=</span><span class="s">&quot;${todos}&quot;</span> <span class="na">var=</span><span class="s">&quot;todo&quot;</span><span class="nt">&gt;</span>
                 <span class="nt">&lt;li&gt;&lt;c:choose&gt;</span>
                         <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">&quot;${todo.finished}&quot;</span><span class="nt">&gt;</span>
                             <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">&quot;text-decoration: line-through;&quot;</span><span class="nt">&gt;</span>
                             ${f:h(todo.todoTitle)}
                             <span class="nt">&lt;/span&gt;</span>
                         <span class="nt">&lt;/c:when&gt;</span>
                         <span class="nt">&lt;c:otherwise&gt;</span>
                             ${f:h(todo.todoTitle)}
                          <span class="nt">&lt;/c:otherwise&gt;</span>
                     <span class="nt">&lt;/c:choose&gt;&lt;/li&gt;</span>
             <span class="nt">&lt;/c:forEach&gt;</span>
         <span class="nt">&lt;/ul&gt;</span>
     <span class="nt">&lt;/div&gt;</span>
 <span class="nt">&lt;/body&gt;</span>
 <span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Display result message using <code class="docutils literal"><span class="pre">&lt;t:messagesPanel&gt;</span></code> tag.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Display errors in case of input error using <code class="docutils literal"><span class="pre">&lt;form:errors&gt;</span></code> tag. Match value of <code class="docutils literal"><span class="pre">path</span></code> attribute of <code class="docutils literal"><span class="pre">&lt;form:errors&gt;</span></code> with <code class="docutils literal"><span class="pre">path</span></code> attribute of <code class="docutils literal"><span class="pre">&lt;form:input&gt;</span></code> tag.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>If form is submitted by entering appropriate value in the form, ‘Created successfully’ message is displayed as given below.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image068.png"><img alt="../_images/image068.png" src="../_images/image068.png" style="width: 40%;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image069.png"><img alt="../_images/image069.png" src="../_images/image069.png" style="width: 40%;" /></a>
</div>
<p>When 6 or more records are registered and business error occurs, error message is displayed.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image070.png"><img alt="../_images/image070.png" src="../_images/image070.png" style="width: 40%;" /></a>
</div>
<p>If form is submitted by entering null character, the following error message is displayed.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image071.png"><img alt="../_images/image071.png" src="../_images/image071.png" style="width: 40%;" /></a>
</div>
</div>
<div class="section" id="customize-message-display">
<h6>3.4.2.1.2.4. Customize message display<a class="headerlink" href="#customize-message-display" title="Permalink to this headline">¶</a></h6>
<p><code class="docutils literal"><span class="pre">&lt;t:messagesPanel&gt;</span></code> result is output by default as follows.</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-success&quot;</span><span class="p">&gt;&lt;</span><span class="nt">ul</span><span class="p">&gt;&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Created successfully!<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;&lt;/</span><span class="nt">ul</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>With the following modifications in style sheet (in &lt;style&gt; tag of <code class="docutils literal"><span class="pre">list.jsp</span></code>), customize appearance of the result message.</p>
<div class="highlight-css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">alert</span> <span class="p">{</span>
    <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">alert-error</span> <span class="p">{</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="mh">#c60f13</span><span class="p">;</span>
    <span class="k">border-color</span><span class="p">:</span> <span class="mh">#970b0e</span><span class="p">;</span>
    <span class="k">color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">alert-success</span> <span class="p">{</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="mh">#5da423</span><span class="p">;</span>
    <span class="k">border-color</span><span class="p">:</span> <span class="mh">#457a1a</span><span class="p">;</span>
    <span class="k">color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The message is as follows.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image072.png"><img alt="../_images/image072.png" src="../_images/image072.png" style="width: 40%;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image073.png"><img alt="../_images/image073.png" src="../_images/image073.png" style="width: 40%;" /></a>
</div>
<p>Moreover, input error message class can be specified to <code class="docutils literal"><span class="pre">cssClass</span></code> attribute of &lt;form:errors&gt; tag. Modify JSP as follows,</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form:errors</span> <span class="na">path</span><span class="o">=</span><span class="s">&quot;todoTitle&quot;</span> <span class="na">cssClass</span><span class="o">=</span><span class="s">&quot;text-error&quot;</span> <span class="p">/&gt;</span>
</pre></div>
</div>
<p>and add the following to style sheet.</p>
<div class="highlight-css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">text-error</span> <span class="p">{</span>
    <span class="k">color</span><span class="p">:</span> <span class="mh">#c60f13</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Input error is as follows.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image074.png"><img alt="../_images/image074.png" src="../_images/image074.png" style="width: 40%;" /></a>
</div>
</div>
</div>
<div class="section" id="id5">
<h5>3.4.2.1.3. Finish TODO<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<p>Add <code class="docutils literal"><span class="pre">Finish</span></code> button to List display screen. If the form is submited, then hidden todoId target will be sent and the corresponding Todo will be completed.</p>
<div class="section" id="id6">
<h6>3.4.2.1.3.1. Modifications in JSP<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h6>
<p>Add form in the JSP for completion of Todo.</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span> <span class="cp">&lt;!DOCTYPE html&gt;</span>
 <span class="nt">&lt;html&gt;</span>
 <span class="nt">&lt;head&gt;</span>
 <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;title&gt;</span>Todo List<span class="nt">&lt;/title&gt;</span>
 <span class="nt">&lt;/head&gt;</span>
 <span class="nt">&lt;style</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
 .strike {
     text-decoration: line-through;
 }

 .alert {
     border: 1px solid;
 }

 .alert-error {
     background-color: #c60f13;
     border-color: #970b0e;
     color: white;
 }

 .alert-success {
     background-color: #5da423;
     border-color: #457a1a;
     color: white;
 }

 .text-error {
     color: #c60f13;
 }
 <span class="nt">&lt;/style&gt;</span>
 <span class="nt">&lt;body&gt;</span>
     <span class="nt">&lt;h1&gt;</span>Todo List<span class="nt">&lt;/h1&gt;</span>

     <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;todoForm&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;t:messagesPanel</span> <span class="nt">/&gt;</span>

         <span class="nt">&lt;form:form</span>
             <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/todo/create&quot;</span>
             <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">modelAttribute=</span><span class="s">&quot;todoForm&quot;</span><span class="nt">&gt;</span>
             <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;todoTitle&quot;</span> <span class="nt">/&gt;</span>
             <span class="nt">&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;todoTitle&quot;</span> <span class="na">cssClass=</span><span class="s">&quot;text-error&quot;</span> <span class="nt">/&gt;</span>
             <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Create Todo&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;/form:form&gt;</span>
     <span class="nt">&lt;/div&gt;</span>
     <span class="nt">&lt;hr</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;todoList&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;ul&gt;</span>
             <span class="nt">&lt;c:forEach</span> <span class="na">items=</span><span class="s">&quot;${todos}&quot;</span> <span class="na">var=</span><span class="s">&quot;todo&quot;</span><span class="nt">&gt;</span>
                 <span class="nt">&lt;li&gt;&lt;c:choose&gt;</span>
                         <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">&quot;${todo.finished}&quot;</span><span class="nt">&gt;</span>
                             <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;strike&quot;</span><span class="nt">&gt;</span>${f:h(todo.todoTitle)}<span class="nt">&lt;/span&gt;</span>
                         <span class="nt">&lt;/c:when&gt;</span>
                         <span class="nt">&lt;c:otherwise&gt;</span>
                             ${f:h(todo.todoTitle)}
<span class="hll">                             <span class="c">&lt;!-- (8) --&gt;</span>
</span><span class="hll">                             <span class="nt">&lt;form:form</span>
</span><span class="hll">                                 <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/todo/finish&quot;</span>
</span><span class="hll">                                 <span class="na">method=</span><span class="s">&quot;post&quot;</span>
</span><span class="hll">                                 <span class="na">modelAttribute=</span><span class="s">&quot;todoForm&quot;</span>
</span><span class="hll">                                 <span class="na">cssStyle=</span><span class="s">&quot;display: inline-block;&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                                 <span class="c">&lt;!-- (9) --&gt;</span>
</span><span class="hll">                                 <span class="nt">&lt;form:hidden</span> <span class="na">path=</span><span class="s">&quot;todoId&quot;</span>
</span><span class="hll">                                     <span class="na">value=</span><span class="s">&quot;${f:h(todo.todoId)}&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">                                 <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;finish&quot;</span>
</span><span class="hll">                                     <span class="na">value=</span><span class="s">&quot;Finish&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">                             <span class="nt">&lt;/form:form&gt;</span>
</span>                         <span class="nt">&lt;/c:otherwise&gt;</span>
                     <span class="nt">&lt;/c:choose&gt;&lt;/li&gt;</span>
             <span class="nt">&lt;/c:forEach&gt;</span>
         <span class="nt">&lt;/ul&gt;</span>
     <span class="nt">&lt;/div&gt;</span>
 <span class="nt">&lt;/body&gt;</span>
 <span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Display the form only if there are incomplete Todo. Send todoId by POST to <code class="docutils literal"><span class="pre">&lt;contextPath&gt;/todo/finish</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Pass todoId using <code class="docutils literal"><span class="pre">&lt;form:hidden&gt;</span></code> tag. Also while setting the value in <code class="docutils literal"><span class="pre">value</span></code> attribute, HTML escaping should always be performed using  <strong>f:h() function.</strong></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id7">
<h6>3.4.2.1.3.2. Modifications in Form<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h6>
<p>Form for completion process flow uses TodoForm.
When todoId property needs to be added to TodoForm, input validation rules for new creation are applied as it is.
For specifying separate rules for new creation and completion in a single Form, set <code class="docutils literal"><span class="pre">group</span></code> attribute.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span> <span class="kn">package</span> <span class="nn">todo.app.todo</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">javax.validation.constraints.Size</span><span class="p">;</span>

 <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoForm</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>
<span class="hll">     <span class="c1">// (3)</span>
</span><span class="hll">     <span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">TodoCreate</span> <span class="p">{</span>
</span><span class="hll">     <span class="p">};</span>
</span>
<span class="hll">     <span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">TodoFinish</span> <span class="p">{</span>
</span><span class="hll">     <span class="p">};</span>
</span>
     <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="p">;</span>

<span class="hll">     <span class="c1">// (4)</span>
</span><span class="hll">     <span class="nd">@NotNull</span><span class="p">(</span><span class="n">groups</span> <span class="o">=</span> <span class="p">{</span> <span class="n">TodoFinish</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span>
</span><span class="hll">     <span class="kd">private</span> <span class="n">String</span> <span class="n">todoId</span><span class="p">;</span>
</span>
<span class="hll">     <span class="c1">// (5)</span>
</span><span class="hll">     <span class="nd">@NotNull</span><span class="p">(</span><span class="n">groups</span> <span class="o">=</span> <span class="p">{</span> <span class="n">TodoCreate</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span>
</span>     <span class="nd">@Size</span><span class="p">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="p">{</span> <span class="n">TodoCreate</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span>
     <span class="kd">private</span> <span class="n">String</span> <span class="n">todoTitle</span><span class="p">;</span>

<span class="hll">     <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTodoId</span><span class="p">()</span> <span class="p">{</span>
</span><span class="hll">         <span class="k">return</span> <span class="n">todoId</span><span class="p">;</span>
</span><span class="hll">     <span class="p">}</span>
</span><span class="hll">
</span><span class="hll">     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTodoId</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">         <span class="k">this</span><span class="p">.</span><span class="na">todoId</span> <span class="o">=</span> <span class="n">todoId</span><span class="p">;</span>
</span><span class="hll">     <span class="p">}</span>
</span>
     <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTodoTitle</span><span class="p">()</span> <span class="p">{</span>
         <span class="k">return</span> <span class="n">todoTitle</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTodoTitle</span><span class="p">(</span><span class="n">String</span> <span class="n">todoTitle</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">this</span><span class="p">.</span><span class="na">todoTitle</span> <span class="o">=</span> <span class="n">todoTitle</span><span class="p">;</span>
     <span class="p">}</span>

 <span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create the class which will be the group name for performing group validation. Since class may be blank, define the interface here.</div>
<div class="line">Refer to <a class="reference internal" href="../ArchitectureInDetail/Validation.html"><span class="doc">Input Validation</span></a> for group validation.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">todoId is mandatory for completion process, hence add &#64;NotNull. It is the rule required only at the time of completion, set TodoFinish.class in group attribute.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Rule for new creation is not required for completion process, hence set TodoCreate.class in group attribute of respective <code class="docutils literal"><span class="pre">&#64;NotNull</span></code> and <code class="docutils literal"><span class="pre">&#64;Size</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id8">
<h6>3.4.2.1.3.3. Modifications in Controller<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h6>
<p>Add completion processing logic to TodoController.
Take precaution of using <strong>&#64;Validated instead of &#64;Valid</strong> for executing the group validation.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span> <span class="kn">package</span> <span class="nn">todo.app.todo</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="p">;</span>
<span class="hll"> <span class="kn">import</span> <span class="nn">javax.validation.groups.Default</span><span class="p">;</span>
</span>
 <span class="kn">import</span> <span class="nn">org.dozer.Mapper</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="p">;</span>
<span class="hll"> <span class="kn">import</span> <span class="nn">org.springframework.validation.annotation.Validated</span><span class="p">;</span>
</span> <span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.web.servlet.mvc.support.RedirectAttributes</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.exception.BusinessException</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessage</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessages</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">todo.app.todo.TodoForm.TodoCreate</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">todo.app.todo.TodoForm.TodoFinish</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">todo.domain.model.Todo</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">todo.domain.service.todo.TodoService</span><span class="p">;</span>

 <span class="nd">@Controller</span>
 <span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;todo&quot;</span><span class="p">)</span>
 <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoController</span> <span class="p">{</span>
     <span class="nd">@Inject</span>
     <span class="n">TodoService</span> <span class="n">todoService</span><span class="p">;</span>

     <span class="nd">@Inject</span>
     <span class="n">Mapper</span> <span class="n">beanMapper</span><span class="p">;</span>

     <span class="nd">@ModelAttribute</span>
     <span class="kd">public</span> <span class="n">TodoForm</span> <span class="nf">setUpForm</span><span class="p">()</span> <span class="p">{</span>
         <span class="n">TodoForm</span> <span class="n">form</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TodoForm</span><span class="p">();</span>
         <span class="k">return</span> <span class="n">form</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;list&quot;</span><span class="p">)</span>
     <span class="kd">public</span> <span class="n">String</span> <span class="nf">list</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">todos</span> <span class="o">=</span> <span class="n">todoService</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
         <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;todos&quot;</span><span class="p">,</span> <span class="n">todos</span><span class="p">);</span>
         <span class="k">return</span> <span class="s">&quot;todo/list&quot;</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
     <span class="kd">public</span> <span class="n">String</span> <span class="nf">create</span><span class="p">(</span>
<span class="hll">             <span class="nd">@Validated</span><span class="p">({</span> <span class="n">Default</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">TodoCreate</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span> <span class="n">TodoForm</span> <span class="n">todoForm</span><span class="p">,</span> <span class="c1">// (16)</span>
</span>             <span class="n">BindingResult</span> <span class="n">bindingResult</span><span class="p">,</span> <span class="n">Model</span> <span class="n">model</span><span class="p">,</span>
             <span class="n">RedirectAttributes</span> <span class="n">attributes</span><span class="p">)</span> <span class="p">{</span>

         <span class="k">if</span> <span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
             <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
         <span class="p">}</span>

         <span class="n">Todo</span> <span class="n">todo</span> <span class="o">=</span> <span class="n">beanMapper</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">todoForm</span><span class="p">,</span> <span class="n">Todo</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

         <span class="k">try</span> <span class="p">{</span>
             <span class="n">todoService</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
         <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">BusinessException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
             <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getResultMessages</span><span class="p">());</span>
             <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
         <span class="p">}</span>

         <span class="n">attributes</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="n">ResultMessages</span><span class="p">.</span><span class="na">success</span><span class="p">().</span><span class="na">add</span><span class="p">(</span>
                 <span class="n">ResultMessage</span><span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;Created successfully!&quot;</span><span class="p">)));</span>
         <span class="k">return</span> <span class="s">&quot;redirect:/todo/list&quot;</span><span class="p">;</span>
     <span class="p">}</span>

<span class="hll">     <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;finish&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span> <span class="c1">// (17)</span>
</span><span class="hll">     <span class="kd">public</span> <span class="n">String</span> <span class="nf">finish</span><span class="p">(</span>
</span><span class="hll">             <span class="nd">@Validated</span><span class="p">({</span> <span class="n">Default</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">TodoFinish</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span> <span class="n">TodoForm</span> <span class="n">form</span><span class="p">,</span> <span class="c1">// (18)</span>
</span><span class="hll">             <span class="n">BindingResult</span> <span class="n">bindingResult</span><span class="p">,</span> <span class="n">Model</span> <span class="n">model</span><span class="p">,</span>
</span><span class="hll">             <span class="n">RedirectAttributes</span> <span class="n">attributes</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">         <span class="c1">// (19)</span>
</span><span class="hll">         <span class="k">if</span> <span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
</span><span class="hll">             <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
</span><span class="hll">         <span class="p">}</span>
</span><span class="hll">
</span><span class="hll">         <span class="k">try</span> <span class="p">{</span>
</span><span class="hll">             <span class="n">todoService</span><span class="p">.</span><span class="na">finish</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getTodoId</span><span class="p">());</span>
</span><span class="hll">         <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">BusinessException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">             <span class="c1">// (20)</span>
</span><span class="hll">             <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getResultMessages</span><span class="p">());</span>
</span><span class="hll">             <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
</span><span class="hll">         <span class="p">}</span>
</span><span class="hll">
</span><span class="hll">         <span class="c1">// (21)</span>
</span><span class="hll">         <span class="n">attributes</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="n">ResultMessages</span><span class="p">.</span><span class="na">success</span><span class="p">().</span><span class="na">add</span><span class="p">(</span>
</span><span class="hll">                 <span class="n">ResultMessage</span><span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;Finished successfully!&quot;</span><span class="p">)));</span>
</span><span class="hll">         <span class="k">return</span> <span class="s">&quot;redirect:/todo/list&quot;</span><span class="p">;</span>
</span><span class="hll">     <span class="p">}</span>
</span> <span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(16)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Change &#64;Valid to &#64;Validated for executing group validation. Multiple group classes can be specified in value.</div>
<div class="line"><code class="docutils literal"><span class="pre">Default.class</span></code> is the group when group is not specified in validation rules. At the time of using <code class="docutils literal"><span class="pre">&#64;Validated</span></code>, <code class="docutils literal"><span class="pre">Default.class</span></code> can also be specified.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(17)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set <code class="docutils literal"><span class="pre">&#64;RequestMapping</span></code> to <code class="docutils literal"><span class="pre">/todo/finish</span></code> and HTTP method to POST.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(18)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify TodoFinish.class as the group for Finish.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(19)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In case of input error, return to list screen.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(20)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Execute business logic, add result message to Model and return to list screen in case when <code class="docutils literal"><span class="pre">BusinessException</span></code> occurs.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(21)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Since it is created normally, add result message to flash scope and redirect to list screen.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Separate Form can also be created for Create and Finish. In that case, only the required parameters will be the properties of Form.
However, as the number of classes increase, duplicate properties also increase, and when the specifications change, the modification cost will also be more.
Moreover, if multiple Form objects in the same Controller are initialized by <code class="docutils literal"><span class="pre">&#64;ModelAttribute</span></code> method,
unnecessary instance gets generated because every time all Forms are being initialized. Therefore,
it is recommended to basically consolidate the Form as much as possible to be used in a single Controller and carry out the group validation settings.</p>
</div>
<p>After creating new Todo, if submit is performed by Finish button, then strike-through is shown as below and it can be understood that the operation is completed.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image075.png"><img alt="../_images/image075.png" src="../_images/image075.png" style="width: 40%;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image076.png"><img alt="../_images/image076.png" src="../_images/image076.png" style="width: 40%;" /></a>
</div>
</div>
</div>
<div class="section" id="id9">
<h5>3.4.2.1.4. Delete TODO<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h5>
<p>Add <code class="docutils literal"><span class="pre">Delete</span></code> button to list display screen. If the form is submitted, the hidden todoId target will be sent and corresponding Todo will be deleted.</p>
<div class="section" id="id10">
<h6>3.4.2.1.4.1. Modifications in JSP<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h6>
<p>Add form to the JSP for deletion business logic.</p>
<div class="highlight-jsp"><div class="highlight"><pre><span></span> <span class="cp">&lt;!DOCTYPE html&gt;</span>
 <span class="nt">&lt;html&gt;</span>
 <span class="nt">&lt;head&gt;</span>
 <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;title&gt;</span>Todo List<span class="nt">&lt;/title&gt;</span>
 <span class="nt">&lt;/head&gt;</span>
 <span class="nt">&lt;style</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
 .strike {
     text-decoration: line-through;
 }

 .alert {
     border: 1px solid;
 }

 .alert-error {
     background-color: #c60f13;
     border-color: #970b0e;
     color: white;
 }

 .alert-success {
     background-color: #5da423;
     border-color: #457a1a;
     color: white;
 }

 .text-error {
     color: #c60f13;
 }
 <span class="nt">&lt;/style&gt;</span>
 <span class="nt">&lt;body&gt;</span>
     <span class="nt">&lt;h1&gt;</span>Todo List<span class="nt">&lt;/h1&gt;</span>

     <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;todoForm&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;t:messagesPanel</span> <span class="nt">/&gt;</span>

         <span class="nt">&lt;form:form</span>
             <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/todo/create&quot;</span>
             <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">modelAttribute=</span><span class="s">&quot;todoForm&quot;</span><span class="nt">&gt;</span>
             <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;todoTitle&quot;</span> <span class="nt">/&gt;</span>
             <span class="nt">&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;todoTitle&quot;</span> <span class="na">cssClass=</span><span class="s">&quot;text-error&quot;</span> <span class="nt">/&gt;</span>
             <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Create Todo&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;/form:form&gt;</span>
     <span class="nt">&lt;/div&gt;</span>
     <span class="nt">&lt;hr</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;todoList&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;ul&gt;</span>
             <span class="nt">&lt;c:forEach</span> <span class="na">items=</span><span class="s">&quot;${todos}&quot;</span> <span class="na">var=</span><span class="s">&quot;todo&quot;</span><span class="nt">&gt;</span>
                 <span class="nt">&lt;li&gt;&lt;c:choose&gt;</span>
                         <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">&quot;${todo.finished}&quot;</span><span class="nt">&gt;</span>
                             <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;strike&quot;</span><span class="nt">&gt;</span>${f:h(todo.todoTitle)}<span class="nt">&lt;/span&gt;</span>
                         <span class="nt">&lt;/c:when&gt;</span>
                         <span class="nt">&lt;c:otherwise&gt;</span>
                             ${f:h(todo.todoTitle)}
                             <span class="nt">&lt;form:form</span>
                                 <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/todo/finish&quot;</span>
                                 <span class="na">method=</span><span class="s">&quot;post&quot;</span>
                                 <span class="na">modelAttribute=</span><span class="s">&quot;todoForm&quot;</span>
                                 <span class="na">cssStyle=</span><span class="s">&quot;display: inline-block;&quot;</span><span class="nt">&gt;</span>
                                 <span class="nt">&lt;form:hidden</span> <span class="na">path=</span><span class="s">&quot;todoId&quot;</span>
                                     <span class="na">value=</span><span class="s">&quot;${f:h(todo.todoId)}&quot;</span> <span class="nt">/&gt;</span>
                                 <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;finish&quot;</span>
                                     <span class="na">value=</span><span class="s">&quot;Finish&quot;</span> <span class="nt">/&gt;</span>
                             <span class="nt">&lt;/form:form&gt;</span>
                         <span class="nt">&lt;/c:otherwise&gt;</span>
                     <span class="nt">&lt;/c:choose&gt;</span>
<span class="hll">                     <span class="c">&lt;!-- (10) --&gt;</span>
</span><span class="hll">                     <span class="nt">&lt;form:form</span>
</span><span class="hll">                         <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/todo/delete&quot;</span>
</span><span class="hll">                         <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">modelAttribute=</span><span class="s">&quot;todoForm&quot;</span>
</span><span class="hll">                         <span class="na">cssStyle=</span><span class="s">&quot;display: inline-block;&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                         <span class="c">&lt;!-- (11) --&gt;</span>
</span><span class="hll">                         <span class="nt">&lt;form:hidden</span> <span class="na">path=</span><span class="s">&quot;todoId&quot;</span>
</span><span class="hll">                             <span class="na">value=</span><span class="s">&quot;${f:h(todo.todoId)}&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">                         <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Delete&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">                     <span class="nt">&lt;/form:form&gt;</span>
</span>                 <span class="nt">&lt;/li&gt;</span>
             <span class="nt">&lt;/c:forEach&gt;</span>
         <span class="nt">&lt;/ul&gt;</span>
     <span class="nt">&lt;/div&gt;</span>
 <span class="nt">&lt;/body&gt;</span>
 <span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Display form in the JSP for deletion request. Send todoId by POST to <code class="docutils literal"><span class="pre">&lt;contextPath&gt;/todo/delete</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(11)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Pass todoId using &lt;form:hidden&gt; tag. Also while setting the value in <code class="docutils literal"><span class="pre">value</span></code> attribute, HTML escaping should always be performed using <strong>f:h() function.</strong></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id11">
<h6>3.4.2.1.4.2. Modifications in Form<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h6>
<p>Add group for Delete to TodoForm. Rules are almost same as for Finish.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span> <span class="kn">package</span> <span class="nn">todo.app.todo</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">javax.validation.constraints.Size</span><span class="p">;</span>

 <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoForm</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>
     <span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">TodoCreate</span> <span class="p">{</span>
     <span class="p">};</span>

     <span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">TodoFinish</span> <span class="p">{</span>
     <span class="p">};</span>

<span class="hll">     <span class="c1">// (6)</span>
</span><span class="hll">     <span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">TodoDelete</span> <span class="p">{</span>
</span><span class="hll">     <span class="p">}</span>
</span>
     <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="p">;</span>

<span class="hll">     <span class="c1">// (7)</span>
</span><span class="hll">     <span class="nd">@NotNull</span><span class="p">(</span><span class="n">groups</span> <span class="o">=</span> <span class="p">{</span> <span class="n">TodoFinish</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">TodoDelete</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span>
</span>     <span class="kd">private</span> <span class="n">String</span> <span class="n">todoId</span><span class="p">;</span>

     <span class="nd">@NotNull</span><span class="p">(</span><span class="n">groups</span> <span class="o">=</span> <span class="p">{</span> <span class="n">TodoCreate</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span>
     <span class="nd">@Size</span><span class="p">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="p">{</span> <span class="n">TodoCreate</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span>
     <span class="kd">private</span> <span class="n">String</span> <span class="n">todoTitle</span><span class="p">;</span>

     <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTodoId</span><span class="p">()</span> <span class="p">{</span>
         <span class="k">return</span> <span class="n">todoId</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTodoId</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">this</span><span class="p">.</span><span class="na">todoId</span> <span class="o">=</span> <span class="n">todoId</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTodoTitle</span><span class="p">()</span> <span class="p">{</span>
         <span class="k">return</span> <span class="n">todoTitle</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTodoTitle</span><span class="p">(</span><span class="n">String</span> <span class="n">todoTitle</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">this</span><span class="p">.</span><span class="na">todoTitle</span> <span class="o">=</span> <span class="n">todoTitle</span><span class="p">;</span>
     <span class="p">}</span>

 <span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define group TodoDelete for Delete.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set so that validation of TodoDelete group will be carried out for todoId property.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id12">
<h6>3.4.2.1.4.3. Modifications in Controller<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h6>
<p>Add the logic for delete processing to TodoController. It is almost same as the completion process.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span> <span class="kn">package</span> <span class="nn">todo.app.todo</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">javax.validation.groups.Default</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">org.dozer.Mapper</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.validation.annotation.Validated</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.web.servlet.mvc.support.RedirectAttributes</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.exception.BusinessException</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessage</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessages</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">todo.app.todo.TodoForm.TodoDelete</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">todo.app.todo.TodoForm.TodoCreate</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">todo.app.todo.TodoForm.TodoFinish</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">todo.domain.model.Todo</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">todo.domain.service.todo.TodoService</span><span class="p">;</span>

 <span class="nd">@Controller</span>
 <span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;todo&quot;</span><span class="p">)</span>
 <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoController</span> <span class="p">{</span>
     <span class="nd">@Inject</span>
     <span class="n">TodoService</span> <span class="n">todoService</span><span class="p">;</span>

     <span class="nd">@Inject</span>
     <span class="n">Mapper</span> <span class="n">beanMapper</span><span class="p">;</span>

     <span class="nd">@ModelAttribute</span>
     <span class="kd">public</span> <span class="n">TodoForm</span> <span class="nf">setUpForm</span><span class="p">()</span> <span class="p">{</span>
         <span class="n">TodoForm</span> <span class="n">form</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TodoForm</span><span class="p">();</span>
         <span class="k">return</span> <span class="n">form</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;list&quot;</span><span class="p">)</span>
     <span class="kd">public</span> <span class="n">String</span> <span class="nf">list</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">todos</span> <span class="o">=</span> <span class="n">todoService</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
         <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;todos&quot;</span><span class="p">,</span> <span class="n">todos</span><span class="p">);</span>
         <span class="k">return</span> <span class="s">&quot;todo/list&quot;</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;create&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
     <span class="kd">public</span> <span class="n">String</span> <span class="nf">create</span><span class="p">(</span>
             <span class="nd">@Validated</span><span class="p">({</span> <span class="n">Default</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">TodoCreate</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span> <span class="n">TodoForm</span> <span class="n">todoForm</span><span class="p">,</span>
             <span class="n">BindingResult</span> <span class="n">bindingResult</span><span class="p">,</span> <span class="n">Model</span> <span class="n">model</span><span class="p">,</span>
             <span class="n">RedirectAttributes</span> <span class="n">attributes</span><span class="p">)</span> <span class="p">{</span>

         <span class="k">if</span> <span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
             <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
         <span class="p">}</span>

         <span class="n">Todo</span> <span class="n">todo</span> <span class="o">=</span> <span class="n">beanMapper</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">todoForm</span><span class="p">,</span> <span class="n">Todo</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

         <span class="k">try</span> <span class="p">{</span>
             <span class="n">todoService</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
         <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">BusinessException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
             <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getResultMessages</span><span class="p">());</span>
             <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
         <span class="p">}</span>

         <span class="n">attributes</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="n">ResultMessages</span><span class="p">.</span><span class="na">success</span><span class="p">().</span><span class="na">add</span><span class="p">(</span>
                 <span class="n">ResultMessage</span><span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;Created successfully!&quot;</span><span class="p">)));</span>
         <span class="k">return</span> <span class="s">&quot;redirect:/todo/list&quot;</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;finish&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
     <span class="kd">public</span> <span class="n">String</span> <span class="nf">finish</span><span class="p">(</span>
             <span class="nd">@Validated</span><span class="p">({</span> <span class="n">Default</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">TodoFinish</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span> <span class="n">TodoForm</span> <span class="n">form</span><span class="p">,</span>
             <span class="n">BindingResult</span> <span class="n">bindingResult</span><span class="p">,</span> <span class="n">Model</span> <span class="n">model</span><span class="p">,</span>
             <span class="n">RedirectAttributes</span> <span class="n">attributes</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
             <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
         <span class="p">}</span>

         <span class="k">try</span> <span class="p">{</span>
             <span class="n">todoService</span><span class="p">.</span><span class="na">finish</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getTodoId</span><span class="p">());</span>
         <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">BusinessException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
             <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getResultMessages</span><span class="p">());</span>
             <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
         <span class="p">}</span>

         <span class="n">attributes</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="n">ResultMessages</span><span class="p">.</span><span class="na">success</span><span class="p">().</span><span class="na">add</span><span class="p">(</span>
                 <span class="n">ResultMessage</span><span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;Finished successfully!&quot;</span><span class="p">)));</span>
         <span class="k">return</span> <span class="s">&quot;redirect:/todo/list&quot;</span><span class="p">;</span>
     <span class="p">}</span>

<span class="hll">     <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;delete&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
</span><span class="hll">     <span class="kd">public</span> <span class="n">String</span> <span class="nf">delete</span><span class="p">(</span>
</span><span class="hll">             <span class="nd">@Validated</span><span class="p">({</span> <span class="n">Default</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">TodoDelete</span><span class="p">.</span><span class="na">class</span> <span class="p">})</span> <span class="n">TodoForm</span> <span class="n">form</span><span class="p">,</span>
</span><span class="hll">             <span class="n">BindingResult</span> <span class="n">bindingResult</span><span class="p">,</span> <span class="n">Model</span> <span class="n">model</span><span class="p">,</span>
</span><span class="hll">             <span class="n">RedirectAttributes</span> <span class="n">attributes</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">
</span><span class="hll">         <span class="k">if</span> <span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
</span><span class="hll">             <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
</span><span class="hll">         <span class="p">}</span>
</span><span class="hll">
</span><span class="hll">         <span class="k">try</span> <span class="p">{</span>
</span><span class="hll">             <span class="n">todoService</span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getTodoId</span><span class="p">());</span>
</span><span class="hll">         <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">BusinessException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">             <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getResultMessages</span><span class="p">());</span>
</span><span class="hll">             <span class="k">return</span> <span class="n">list</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
</span><span class="hll">         <span class="p">}</span>
</span><span class="hll">
</span><span class="hll">         <span class="n">attributes</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="n">ResultMessages</span><span class="p">.</span><span class="na">success</span><span class="p">().</span><span class="na">add</span><span class="p">(</span>
</span><span class="hll">                 <span class="n">ResultMessage</span><span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;Deleted successfully!&quot;</span><span class="p">)));</span>
</span><span class="hll">         <span class="k">return</span> <span class="s">&quot;redirect:/todo/list&quot;</span><span class="p">;</span>
</span><span class="hll">     <span class="p">}</span>
</span>
 <span class="p">}</span>
</pre></div>
</div>
<p>If submit is performed for Todo using <code class="docutils literal"><span class="pre">Delete</span></code> button, the following target TODO gets deleted.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image077.png"><img alt="../_images/image077.png" src="../_images/image077.png" style="width: 40%;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/image078.png"><img alt="../_images/image078.png" src="../_images/image078.png" style="width: 40%;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="change-of-infrastructure-layer">
<span id="tutorial-todo-infra"></span><h2><a class="toc-backref" href="#id55">3.5. Change of infrastructure layer</a><a class="headerlink" href="#change-of-infrastructure-layer" title="Permalink to this headline">¶</a></h2>
<p>Till the last section, infrastructure layer is implemented using memory, but in this chapter, it is implemented using DB.
O/R Mapper is used for accessing DB, here 2 methods are described: one  using Spring Data JPA and second using TERASOLUNA DAO.</p>
<div class="section" id="common-settings">
<h3><a class="toc-backref" href="#id56">3.5.1. Common settings</a><a class="headerlink" href="#common-settings" title="Permalink to this headline">¶</a></h3>
<p>First, apply settings common to the both, Spring Data JPA version and TERASOLUNA Dao version.
Currently, H2Database is used for reducing the effort of setting up a DB.</p>
<div class="section" id="modifications-in-pom-xml">
<h4><a class="toc-backref" href="#id57">3.5.1.1. Modifications in pom.xml</a><a class="headerlink" href="#modifications-in-pom-xml" title="Permalink to this headline">¶</a></h4>
<p>Define dependency for using H2Database in pom.xml.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.h2database<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>h2<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.3.172<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>The above settings are <strong>for easy trial of the application</strong> and is not to be used in actual application development. Dependency settings of H2Database must be deleted in actual application development.</p>
<p class="last">Further, in actual application development, usually use a data source that is provided by the application server.
If your application are using a data source that is provided by the application server, <code class="docutils literal"><span class="pre">&lt;scope&gt;</span></code> of JDBC driver must be <code class="docutils literal"><span class="pre">provided</span></code>.</p>
</div>
</div>
<div class="section" id="definition-of-data-source">
<h4><a class="toc-backref" href="#id58">3.5.1.2. Definition of data source</a><a class="headerlink" href="#definition-of-data-source" title="Permalink to this headline">¶</a></h4>
<div class="section" id="modifications-in-todo-infra-xml">
<h5>3.5.1.2.1. Modifications in todo-infra.xml<a class="headerlink" href="#modifications-in-todo-infra-xml" title="Permalink to this headline">¶</a></h5>
<p>Since data source definition is related to infrastructure layer, it should be defined in todo-infra.xml, but
it is recommended to define the information depending on the environment like user name, password etc. of database in a separate Bean definition file (todo-env.xml).</p>
<p>Here, only import todo-env.xml.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&quot;classpath:/META-INF/spring/todo-env.xml&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By saving xxx-env.xml in another file and replacing only this file with build tools like Maven, configurations values that differs with each environment
(development environment, test environment etc.) can be managed. Also the configuration file, in which data source of only specific environment is fetched from JNDI,
can be managed.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="creation-of-todo-env-xml">
<h5>3.5.1.2.2. Creation of todo-env.xml<a class="headerlink" href="#creation-of-todo-env-xml" title="Permalink to this headline">¶</a></h5>
<p>Create <code class="docutils literal"><span class="pre">src/main/resources/META-INF/spring/todo-env.xml</span></code> and perform the following settings. Include the environment dependent settings (here, DataSource) in this file.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">class=</span><span class="s">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>
        <span class="na">destroy-method=</span><span class="s">&quot;close&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;driverClassName&quot;</span> <span class="na">value=</span><span class="s">&quot;${database.driverClassName}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;url&quot;</span> <span class="na">value=</span><span class="s">&quot;${database.url}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span> <span class="na">value=</span><span class="s">&quot;${database.username}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">value=</span><span class="s">&quot;${database.password}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultAutoCommit&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxActive&quot;</span> <span class="na">value=</span><span class="s">&quot;${cp.maxActive}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxIdle&quot;</span> <span class="na">value=</span><span class="s">&quot;${cp.maxIdle}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;minIdle&quot;</span> <span class="na">value=</span><span class="s">&quot;${cp.minIdle}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxWait&quot;</span> <span class="na">value=</span><span class="s">&quot;${cp.maxWait}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<p>For improving maintainability define the properties in external property file.
</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">DataSource should be fetched using JNDI depending on the environment (Application Server).
In that case, define  <code class="docutils literal"><span class="pre">&lt;jee:jndi-lookup</span> <span class="pre">id=&quot;dataSource&quot;</span> <span class="pre">jndi-name=&quot;JNDI</span> <span class="pre">name&quot;</span> <span class="pre">/&gt;</span></code>
env file is created in such a way that, switch-over becomes possible at the time of build, between commons-dbcp in development environment and JNDI in test environment.</p>
</div>
</div>
<div class="section" id="todo-infra-properties">
<h5>3.5.1.2.3. todo-infra.properties<a class="headerlink" href="#todo-infra-properties" title="Permalink to this headline">¶</a></h5>
<p>Define property value related to infrastructure layer in <code class="docutils literal"><span class="pre">src/main/resources/META-INF/spring/todo-infra.properties</span></code>.</p>
<div class="highlight-properties"><div class="highlight"><pre><span></span><span class="na">database</span><span class="o">=</span><span class="s">H2</span>
<span class="c">## (1)</span>
<span class="na">database.url</span><span class="o">=</span><span class="s">jdbc:h2:mem:todo;DB_CLOSE_DELAY=-1;INIT=create table if not exists todo(todo_id varchar(36) primary key, todo_title varchar(30), finished boolean, created_at timestamp)</span>
<span class="na">database.username</span><span class="o">=</span><span class="s">sa</span>
<span class="na">database.password</span><span class="o">=</span>
<span class="na">database.driverClassName</span><span class="o">=</span><span class="s">org.h2.Driver</span>
<span class="c"># connection pool</span>
<span class="c">## (2)</span>
<span class="na">cp.maxActive</span><span class="o">=</span><span class="s">96</span>
<span class="na">cp.maxIdle</span><span class="o">=</span><span class="s">16</span>
<span class="na">cp.minIdle</span><span class="o">=</span><span class="s">0</span>
<span class="na">cp.maxWait</span><span class="o">=</span><span class="s">60000</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Perform settings related to database. Set H2 URL and driver. For simplification, in-memory DB is used here and settings are made such that initialization DDL is executed whenever AP server starts.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Perform settings related to connection pool. Here sample values are being set. Take note that the actual value differ according to server performance.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="modifications-in-todo-domain-xml">
<h4><a class="toc-backref" href="#id59">3.5.1.3. Modifications in todo-domain.xml</a><a class="headerlink" href="#modifications-in-todo-domain-xml" title="Permalink to this headline">¶</a></h4>
<p>In order to enable transaction management using &#64;Transactional annotation, set <code class="docutils literal"><span class="pre">&lt;tx:annotation-driven&gt;</span></code> tag.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span> <span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
 <span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
     <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
     <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
<span class="hll">     <span class="na">xmlns:tx=</span><span class="s">&quot;http://www.springframework.org/schema/tx&quot;</span>
</span>     <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="hll"><span class="s">         http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd</span>
</span><span class="s">         http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&quot;todo.domain&quot;</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&quot;classpath:META-INF/spring/todo-infra.xml&quot;</span><span class="nt">/&gt;</span>
<span class="hll">     <span class="nt">&lt;tx:annotation-driven/&gt;</span>
</span> <span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="modifications-in-todoserviceimpl">
<h4><a class="toc-backref" href="#id60">3.5.1.4. Modifications in TodoServiceImpl</a><a class="headerlink" href="#modifications-in-todoserviceimpl" title="Permalink to this headline">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span> <span class="kn">package</span> <span class="nn">todo.domain.service.todo</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">java.util.Date</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">java.util.UUID</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>
<span class="hll"> <span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="p">;</span>
</span> <span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.exception.BusinessException</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.exception.ResourceNotFoundException</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessage</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.message.ResultMessages</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">todo.domain.model.Todo</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">todo.domain.repository.todo.TodoRepository</span><span class="p">;</span>

 <span class="nd">@Service</span>
<span class="hll"> <span class="nd">@Transactional</span> <span class="c1">// (9)</span>
</span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoServiceImpl</span> <span class="kd">implements</span> <span class="n">TodoService</span> <span class="p">{</span>
     <span class="nd">@Inject</span>
     <span class="n">TodoRepository</span> <span class="n">todoRepository</span><span class="p">;</span>

     <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">MAX_UNFINISHED_COUNT</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

     <span class="kd">public</span> <span class="n">Todo</span> <span class="nf">findOne</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">Todo</span> <span class="n">todo</span> <span class="o">=</span> <span class="n">todoRepository</span><span class="p">.</span><span class="na">findOne</span><span class="p">(</span><span class="n">todoId</span><span class="p">);</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">todo</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
             <span class="n">ResultMessages</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">ResultMessages</span><span class="p">.</span><span class="na">error</span><span class="p">();</span>
             <span class="n">messages</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">ResultMessage</span>
                     <span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;[E404] The requested Todo is not found. (id=&quot;</span>
                             <span class="o">+</span> <span class="n">todoId</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">));</span>
             <span class="k">throw</span> <span class="k">new</span> <span class="n">ResourceNotFoundException</span><span class="p">(</span><span class="n">messages</span><span class="p">);</span>
         <span class="p">}</span>
         <span class="k">return</span> <span class="n">todo</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="nd">@Override</span>
<span class="hll">     <span class="nd">@Transactional</span><span class="p">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="p">)</span> <span class="c1">// (10)</span>
</span>     <span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="p">()</span> <span class="p">{</span>
         <span class="k">return</span> <span class="n">todoRepository</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
     <span class="p">}</span>

     <span class="nd">@Override</span>
     <span class="kd">public</span> <span class="n">Todo</span> <span class="nf">create</span><span class="p">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="p">)</span> <span class="p">{</span>
         <span class="kt">long</span> <span class="n">unfinishedCount</span> <span class="o">=</span> <span class="n">todoRepository</span><span class="p">.</span><span class="na">countByFinished</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">unfinishedCount</span> <span class="o">&gt;=</span> <span class="n">MAX_UNFINISHED_COUNT</span><span class="p">)</span> <span class="p">{</span>
             <span class="n">ResultMessages</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">ResultMessages</span><span class="p">.</span><span class="na">error</span><span class="p">();</span>
             <span class="n">messages</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">ResultMessage</span>
                     <span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;[E001] The count of un-finished Todo must not be over &quot;</span>
                             <span class="o">+</span> <span class="n">MAX_UNFINISHED_COUNT</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span><span class="p">));</span>

             <span class="k">throw</span> <span class="k">new</span> <span class="n">BusinessException</span><span class="p">(</span><span class="n">messages</span><span class="p">);</span>
         <span class="p">}</span>

         <span class="n">String</span> <span class="n">todoId</span> <span class="o">=</span> <span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span>
         <span class="n">Date</span> <span class="n">createdAt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="p">();</span>

         <span class="n">todo</span><span class="p">.</span><span class="na">setTodoId</span><span class="p">(</span><span class="n">todoId</span><span class="p">);</span>
         <span class="n">todo</span><span class="p">.</span><span class="na">setCreatedAt</span><span class="p">(</span><span class="n">createdAt</span><span class="p">);</span>
         <span class="n">todo</span><span class="p">.</span><span class="na">setFinished</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

         <span class="n">todoRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>

         <span class="k">return</span> <span class="n">todo</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="nd">@Override</span>
     <span class="kd">public</span> <span class="n">Todo</span> <span class="nf">finish</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">Todo</span> <span class="n">todo</span> <span class="o">=</span> <span class="n">findOne</span><span class="p">(</span><span class="n">todoId</span><span class="p">);</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">todo</span><span class="p">.</span><span class="na">isFinished</span><span class="p">())</span> <span class="p">{</span>
             <span class="n">ResultMessages</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">ResultMessages</span><span class="p">.</span><span class="na">error</span><span class="p">();</span>
             <span class="n">messages</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">ResultMessage</span>
                     <span class="p">.</span><span class="na">fromText</span><span class="p">(</span><span class="s">&quot;[E002] The requested Todo is already finished. (id=&quot;</span>
                             <span class="o">+</span> <span class="n">todoId</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">));</span>
             <span class="k">throw</span> <span class="k">new</span> <span class="n">BusinessException</span><span class="p">(</span><span class="n">messages</span><span class="p">);</span>
         <span class="p">}</span>
         <span class="n">todo</span><span class="p">.</span><span class="na">setFinished</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
         <span class="n">todoRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
         <span class="k">return</span> <span class="n">todo</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="nd">@Override</span>
     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">Todo</span> <span class="n">todo</span> <span class="o">=</span> <span class="n">findOne</span><span class="p">(</span><span class="n">todoId</span><span class="p">);</span>
         <span class="n">todoRepository</span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
     <span class="p">}</span>
 <span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add <code class="docutils literal"><span class="pre">&#64;Transactional</span></code> at class level and manage all public methods as transactions. This will enable to start transaction while starting the method and</div>
<div class="line">to commit when the method ends normally. When unchecked exception occurs in between, transaction is rolled-back.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add <code class="docutils literal"><span class="pre">readOnly=true</span></code> for the methods which only read data from the db. Depending on O/R Mapper, optimization is done at the time of reference queries</div>
<div class="line">by using this setting (not effective while using JPA).</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-spring-data-jpa">
<h3><a class="toc-backref" href="#id61">3.5.2. Use Spring Data JPA</a><a class="headerlink" href="#use-spring-data-jpa" title="Permalink to this headline">¶</a></h3>
<p>In this section, configuration is explained when  <a class="reference external" href="http://www.springsource.org/spring-data/jpa">Spring Data JPA</a>  is to be used in infrastructure layer.
Proceed to <a class="reference internal" href="#using-terasolunadao"><span class="std std-ref">Use TERASOLUNA DAO</span></a> by skipping this section when TERASOLUNA DAO is to be used.</p>
<div class="section" id="modifications-in-configuration-file-for-using-spring-data-jpa">
<h4><a class="toc-backref" href="#id62">3.5.2.1. Modifications in configuration file for using Spring Data JPA</a><a class="headerlink" href="#modifications-in-configuration-file-for-using-spring-data-jpa" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id13">
<h5>3.5.2.1.1. Modifications in pom.xml<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h5>
<p>Add the following to pom.xml for adding Spring Data JPA dependent library.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.terasoluna.gfw<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>terasoluna-gfw-jpa<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id14">
<h5>3.5.2.1.2. Modifications in todo-infra.xml<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h5>
<p>This setting in todo-infra.xml is for using JPA and Spring Data JPA . Define EntityManagerFactory of JPA here.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span> <span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
     <span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
     <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="hll">     <span class="na">xmlns:jpa=</span><span class="s">&quot;http://www.springframework.org/schema/data/jpa&quot;</span>
</span><span class="hll">     <span class="na">xmlns:util=</span><span class="s">&quot;http://www.springframework.org/schema/util&quot;</span>
</span>     <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="hll"><span class="s">             http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd</span>
</span><span class="hll"><span class="s">             http://www.springframework.org/schema/data/jpa http://www.springframework.org/schema/data/jpa/spring-jpa.xsd&quot;</span><span class="nt">&gt;</span>
</span>
     <span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&quot;classpath:/META-INF/spring/todo-env.xml&quot;</span> <span class="nt">/&gt;</span>

<span class="hll">     <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">     <span class="nt">&lt;jpa:repositories</span> <span class="na">base-package=</span><span class="s">&quot;todo.domain.repository&quot;</span><span class="nt">&gt;&lt;/jpa:repositories&gt;</span>
</span><span class="hll">
</span><span class="hll">     <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">     <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;jpaVendorAdapter&quot;</span>
</span><span class="hll">         <span class="na">class=</span><span class="s">&quot;org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;showSql&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;database&quot;</span> <span class="na">value=</span><span class="s">&quot;${database}&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">     <span class="nt">&lt;/bean&gt;</span>
</span><span class="hll">
</span><span class="hll">     <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">     <span class="nt">&lt;bean</span>
</span><span class="hll">         <span class="na">class=</span><span class="s">&quot;org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean&quot;</span>
</span><span class="hll">         <span class="na">id=</span><span class="s">&quot;entityManagerFactory&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">         <span class="c">&lt;!-- (4) --&gt;</span>
</span><span class="hll">         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;packagesToScan&quot;</span> <span class="na">value=</span><span class="s">&quot;todo.domain.model&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;jpaVendorAdapter&quot;</span> <span class="na">ref=</span><span class="s">&quot;jpaVendorAdapter&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">         <span class="c">&lt;!-- (5) --&gt;</span>
</span><span class="hll">         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;jpaPropertyMap&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">             <span class="nt">&lt;util:map&gt;</span>
</span><span class="hll">                 <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;hibernate.hbm2ddl.auto&quot;</span> <span class="na">value=</span><span class="s">&quot;none&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">                 <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;hibernate.ejb.naming_strategy&quot;</span>
</span><span class="hll">                     <span class="na">value=</span><span class="s">&quot;org.hibernate.cfg.ImprovedNamingStrategy&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">                 <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;hibernate.connection.charSet&quot;</span> <span class="na">value=</span><span class="s">&quot;UTF-8&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">                 <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;hibernate.show_sql&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">                 <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;hibernate.format_sql&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">                 <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;hibernate.use_sql_comments&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">                 <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;hibernate.jdbc.batch_size&quot;</span> <span class="na">value=</span><span class="s">&quot;30&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">                 <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;hibernate.jdbc.fetch_size&quot;</span> <span class="na">value=</span><span class="s">&quot;100&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">             <span class="nt">&lt;/util:map&gt;</span>
</span><span class="hll">         <span class="nt">&lt;/property&gt;</span>
</span><span class="hll">     <span class="nt">&lt;/bean&gt;</span>
</span>
 <span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">If Spring Data JPA is used, the class that implements <code class="docutils literal"><span class="pre">Repository</span></code> interface gets generated automatically.</div>
<div class="line">Specify the package that includes target repositories in <code class="docutils literal"><span class="pre">base-package</span></code> attribute of <code class="docutils literal"><span class="pre">&lt;jpa:repository&gt;</span></code> tag.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set JPA implementation vendor. Define HibernateJpaVendorAdapter for using Hibernate for JPA implementation.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define EntityManager.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify package name of entity.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Perform detailed settings related to Hibernate.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="modifications-in-todo-env-xml">
<h5>3.5.2.1.3. Modifications in todo-env.xml<a class="headerlink" href="#modifications-in-todo-env-xml" title="Permalink to this headline">¶</a></h5>
<p>Add Bean definition related to transaction manager.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span> <span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
 <span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
     <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
     <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="nt">&gt;</span>

     <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">class=</span><span class="s">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>
         <span class="na">destroy-method=</span><span class="s">&quot;close&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;driverClassName&quot;</span> <span class="na">value=</span><span class="s">&quot;${database.driverClassName}&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;url&quot;</span> <span class="na">value=</span><span class="s">&quot;${database.url}&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span> <span class="na">value=</span><span class="s">&quot;${database.username}&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">value=</span><span class="s">&quot;${database.password}&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultAutoCommit&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxActive&quot;</span> <span class="na">value=</span><span class="s">&quot;${cp.maxActive}&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxIdle&quot;</span> <span class="na">value=</span><span class="s">&quot;${cp.maxIdle}&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;minIdle&quot;</span> <span class="na">value=</span><span class="s">&quot;${cp.minIdle}&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxWait&quot;</span> <span class="na">value=</span><span class="s">&quot;${cp.maxWait}&quot;</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;/bean&gt;</span>

     <span class="c">&lt;!-- (6) --&gt;</span>
<span class="hll">     <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.orm.jpa.JpaTransactionManager&quot;</span>
</span><span class="hll">         <span class="na">id=</span><span class="s">&quot;transactionManager&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;entityManagerFactory&quot;</span> <span class="na">ref=</span><span class="s">&quot;entityManagerFactory&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">     <span class="nt">&lt;/bean&gt;</span>
</span><span class="hll">
</span>
 <span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set transaction manager. <code class="docutils literal"><span class="pre">id</span></code> should set to <code class="docutils literal"><span class="pre">transactionManager</span></code>.</div>
<div class="line">When another name is to be specified, transaction manager name should be specified in &lt;tx:annotation-driven&gt; tag in todo-domain.xml and &lt;jpa:repository&gt; tag in todo-infra.xml.</div>
</div>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt></dt>
<dd><div class="first last admonition note">
<p class="first admonition-title">Note</p>
<p>Transaction manager should use JtaTransactionManager in case of JavaEE container. In this case, define transaction manager using &lt;tx:jta-transaction-manager /&gt;.</p>
<p class="last">These settings can be defined in  todo-infra.xml for the project (while using Tomcat) which does not change with environment.</p>
</div>
</dd>
</dl>
</div>
<div class="section" id="modifications-in-spring-mvc-xml">
<h5>3.5.2.1.4. Modifications in spring-mvc.xml<a class="headerlink" href="#modifications-in-spring-mvc-xml" title="Permalink to this headline">¶</a></h5>
<p>Add <code class="docutils literal"><span class="pre">OpenEntityManagerInViewFilter</span></code> to spring-mvc.xml. Start and end of EntityManager lifecycle is carried out using Interceptor.
By adding this configuration, Lazy Load support gets enabled at application layer (Controller or View class).</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span>    <span class="nt">&lt;mvc:interceptors&gt;</span>

    <span class="c">&lt;!-- ... --&gt;</span>

    <span class="c">&lt;!-- (6) --&gt;</span>
    <span class="nt">&lt;mvc:interceptor&gt;</span>
        <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&quot;/**&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/resources/**&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;bean</span>
            <span class="na">class=</span><span class="s">&quot;org.springframework.orm.jpa.support.OpenEntityManagerInViewInterceptor&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/mvc:interceptor&gt;</span>

<span class="nt">&lt;/mvc:interceptors&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">No.</th>
<th class="head">Details</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">During the access (<code class="docutils literal"><span class="pre">/resources/**</span></code>) to static resources (css, js, image etc), database access is not going to happen for sure. Hence, intercept has been exempted.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="modifications-in-logback-xml">
<h5>3.5.2.1.5. Modifications in logback.xml<a class="headerlink" href="#modifications-in-logback-xml" title="Permalink to this headline">¶</a></h5>
<div class="highlight-xml"><div class="highlight"><pre><span></span> <span class="cp">&lt;!DOCTYPE logback&gt;</span>
 <span class="nt">&lt;configuration&gt;</span>
     <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;STDOUT&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;encoder&gt;</span>
             <span class="nt">&lt;pattern&gt;</span><span class="cp">&lt;![CDATA[%d{yyyy-MM-dd HH:mm:ss} [%thread] [%-5level] [%-48logger{48}] - %msg%n]]&gt;</span><span class="nt">&lt;/pattern&gt;</span>
         <span class="nt">&lt;/encoder&gt;</span>
     <span class="nt">&lt;/appender&gt;</span>

     <span class="c">&lt;!-- Application Loggers --&gt;</span>
     <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;todo&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;debug&quot;</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;/logger&gt;</span>

     <span class="c">&lt;!-- TERASOLUNA --&gt;</span>
     <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.terasoluna.gfw&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;info&quot;</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;/logger&gt;</span>

     <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.terasoluna.gfw.web.logging.TraceLoggingInterceptor&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;trace&quot;</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;/logger&gt;</span>

     <span class="c">&lt;!-- 3rdparty Loggers --&gt;</span>
     <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.springframework&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;warn&quot;</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;/logger&gt;</span>

     <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.springframework.web.servlet&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;info&quot;</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;/logger&gt;</span>

<span class="hll">     <span class="c">&lt;!-- (8) --&gt;</span>
</span><span class="hll">     <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.hibernate.SQL&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">         <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;debug&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">     <span class="nt">&lt;/logger&gt;</span>
</span><span class="hll">
</span><span class="hll">     <span class="c">&lt;!-- (9) --&gt;</span>
</span><span class="hll">     <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.hibernate.type.descriptor.sql.BasicBinder&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">         <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;trace&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">     <span class="nt">&lt;/logger&gt;</span>
</span><span class="hll">
</span><span class="hll">     <span class="c">&lt;!-- (10) --&gt;</span>
</span><span class="hll">     <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.hibernate.engine.transaction&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">         <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;debug&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">     <span class="nt">&lt;/logger&gt;</span>
</span>
     <span class="nt">&lt;root</span> <span class="na">level=</span><span class="s">&quot;WARN&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;STDOUT&quot;</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;/root&gt;</span>
 <span class="nt">&lt;/configuration&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">This setting is to output SQL log using Hibernate.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">This setting is to output SQL bind variable using Hibernate.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">This setting is to output transaction log using Hibernate.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="settings-of-entity">
<h4><a class="toc-backref" href="#id63">3.5.2.2. Settings of Entity</a><a class="headerlink" href="#settings-of-entity" title="Permalink to this headline">¶</a></h4>
<p>JPA annotation must be used to map Todo class with database.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span> <span class="kn">package</span> <span class="nn">todo.domain.model</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">java.util.Date</span><span class="p">;</span>

<span class="hll"> <span class="kn">import</span> <span class="nn">javax.persistence.Column</span><span class="p">;</span>
</span><span class="hll"> <span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
</span><span class="hll"> <span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="p">;</span>
</span><span class="hll"> <span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="p">;</span>
</span><span class="hll"> <span class="kn">import</span> <span class="nn">javax.persistence.Temporal</span><span class="p">;</span>
</span><span class="hll"> <span class="kn">import</span> <span class="nn">javax.persistence.TemporalType</span><span class="p">;</span>
</span>
<span class="hll"> <span class="c1">// (1)</span>
</span><span class="hll"> <span class="nd">@Entity</span>
</span><span class="hll"> <span class="nd">@Table</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;todo&quot;</span><span class="p">)</span>
</span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Todo</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>
     <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="p">;</span>

<span class="hll">     <span class="c1">// (2)</span>
</span><span class="hll">     <span class="nd">@Id</span>
</span><span class="hll">     <span class="c1">// (3)</span>
</span><span class="hll">     <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;todo_id&quot;</span><span class="p">)</span>
</span>     <span class="kd">private</span> <span class="n">String</span> <span class="n">todoId</span><span class="p">;</span>

<span class="hll">     <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;todo_title&quot;</span><span class="p">)</span>
</span>     <span class="kd">private</span> <span class="n">String</span> <span class="n">todoTitle</span><span class="p">;</span>

<span class="hll">     <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;finished&quot;</span><span class="p">)</span>
</span>     <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">finished</span><span class="p">;</span>

<span class="hll">     <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;created_at&quot;</span><span class="p">)</span>
</span>     <span class="c1">// (4)</span>
<span class="hll">     <span class="nd">@Temporal</span><span class="p">(</span><span class="n">TemporalType</span><span class="p">.</span><span class="na">TIMESTAMP</span><span class="p">)</span>
</span>     <span class="kd">private</span> <span class="n">Date</span> <span class="n">createdAt</span><span class="p">;</span>

     <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTodoId</span><span class="p">()</span> <span class="p">{</span>
         <span class="k">return</span> <span class="n">todoId</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTodoId</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">this</span><span class="p">.</span><span class="na">todoId</span> <span class="o">=</span> <span class="n">todoId</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTodoTitle</span><span class="p">()</span> <span class="p">{</span>
         <span class="k">return</span> <span class="n">todoTitle</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTodoTitle</span><span class="p">(</span><span class="n">String</span> <span class="n">todoTitle</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">this</span><span class="p">.</span><span class="na">todoTitle</span> <span class="o">=</span> <span class="n">todoTitle</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isFinished</span><span class="p">()</span> <span class="p">{</span>
         <span class="k">return</span> <span class="n">finished</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFinished</span><span class="p">(</span><span class="kt">boolean</span> <span class="n">finished</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">this</span><span class="p">.</span><span class="na">finished</span> <span class="o">=</span> <span class="n">finished</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getCreatedAt</span><span class="p">()</span> <span class="p">{</span>
         <span class="k">return</span> <span class="n">createdAt</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCreatedAt</span><span class="p">(</span><span class="n">Date</span> <span class="n">createdAt</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">this</span><span class="p">.</span><span class="na">createdAt</span> <span class="o">=</span> <span class="n">createdAt</span><span class="p">;</span>
     <span class="p">}</span>
 <span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add <code class="docutils literal"><span class="pre">&#64;Entity</span></code> showing that it is JPA entity and set the corresponding table name using <code class="docutils literal"><span class="pre">&#64;Table</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add <code class="docutils literal"><span class="pre">&#64;Id</span></code> to the field corresponding to primary key column.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set the corresponding column name by <code class="docutils literal"><span class="pre">&#64;Column</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">It has to be clearly specified that <code class="docutils literal"><span class="pre">Date</span></code> type corresponds to which of <code class="docutils literal"><span class="pre">java.sql.Date</span></code>, <code class="docutils literal"><span class="pre">java.sql.Time</span></code>, <code class="docutils literal"><span class="pre">java.sql.Timestamp</span></code>. Here <code class="docutils literal"><span class="pre">Timestamp</span></code> is specified.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="modifications-in-todorepository">
<h4><a class="toc-backref" href="#id64">3.5.2.3. Modifications in TodoRepository</a><a class="headerlink" href="#modifications-in-todorepository" title="Permalink to this headline">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span> <span class="kn">package</span> <span class="nn">todo.domain.repository.todo</span><span class="p">;</span>

<span class="hll"> <span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="p">;</span>
</span><span class="hll"> <span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.Query</span><span class="p">;</span>
</span><span class="hll"> <span class="kn">import</span> <span class="nn">org.springframework.data.repository.query.Param</span><span class="p">;</span>
</span>
 <span class="kn">import</span> <span class="nn">todo.domain.model.Todo</span><span class="p">;</span>

 <span class="c1">// (1)</span>
<span class="hll"> <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoRepository</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Todo</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class="hll">     <span class="nd">@Query</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;SELECT COUNT(x) FROM Todo x WHERE x.finished = :finished&quot;</span><span class="p">)</span> <span class="c1">// (2)</span>
</span><span class="hll">     <span class="kt">long</span> <span class="nf">countByFinished</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;finished&quot;</span><span class="p">)</span> <span class="kt">boolean</span> <span class="n">finished</span><span class="p">);</span> <span class="c1">// (3)</span>
</span> <span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set interface that extends JpaRepository. Specify Entity class (Todo) and primary key type (String) sequentially in Generics parameter.</div>
<div class="line">Since basic CRUD operations (findOne, findAll, save, delete etc.) are defined in upper level interface, only <code class="docutils literal"><span class="pre">countByFinished</span></code> can be defined in <code class="docutils literal"><span class="pre">TodoRepository</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify JPQL executed at the time of calling <code class="docutils literal"><span class="pre">countByFinished</span></code> by &#64;Query.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set bind variable of JPQL specified in (2) by <code class="docutils literal"><span class="pre">&#64;Param</span></code>.</div>
<div class="line">Here, add <code class="docutils literal"><span class="pre">&#64;Param(&quot;finished&quot;)</span></code> to method argument for inserting <code class="docutils literal"><span class="pre">`:finished&quot;</span></code> in JPQL.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="modifications-in-todorepositoryimpl">
<h4><a class="toc-backref" href="#id65">3.5.2.4. Modifications in TodoRepositoryImpl</a><a class="headerlink" href="#modifications-in-todorepositoryimpl" title="Permalink to this headline">¶</a></h4>
<p>When Spring Data JPA is used, RepositoryImpl gets generated automatically from interface. Hence, delete the unnecessary TodoRepositoryImpl.</p>
<p>Usage of Spring Data JPA is completed here.
Start AP server to output SQL log and transaction log as follows for Todo display and new creation.</p>
</div>
</div>
<div class="section" id="use-terasoluna-dao">
<span id="using-terasolunadao"></span><h3><a class="toc-backref" href="#id66">3.5.3. Use TERASOLUNA DAO</a><a class="headerlink" href="#use-terasoluna-dao" title="Permalink to this headline">¶</a></h3>
<p>Configuration method using TERASOLUNA DAO in infrastructure layer, is explained in this section.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>TERASOLUNA DAO is the library providing a simple SQL mapper which is extended from <code class="docutils literal"><span class="pre">org.springframework.orm.ibatis.support.SqlMapClientDaoSupport</span></code> which is a linkage class of MyBatis2.3.5 and Spring.
DAO having the following 4 interfaces is provided.</p>
<blockquote>
<div><ol class="arabic simple">
<li>jp.terasoluna.fw.dao.QueryDAO</li>
<li>jp.terasoluna.fw.dao.UpdateDAO</li>
<li>jp.terasoluna.fw.dao.StoredProcedureDAO</li>
<li>jp.terasoluna.fw.dao.QueryRowHandleDAO</li>
</ol>
</div></blockquote>
<p class="last">jp.terasoluna.fw.dao.ibatis.XxxDAOiBatisImpl is implemented for each interface.</p>
</div>
<div class="section" id="setting-for-using-the-terasoluna-dao">
<h4><a class="toc-backref" href="#id67">3.5.3.1. Setting for using the TERASOLUNA DAO</a><a class="headerlink" href="#setting-for-using-the-terasoluna-dao" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id15">
<h5>3.5.3.1.1. Modifications in pom.xml<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h5>
<p>Add the following in pom.xml in order to add dependent library related to TERASOLUNA DAO.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.terasoluna.gfw<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>terasoluna-gfw-mybatis2<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id16">
<h5>3.5.3.1.2. Modifications in todo-infra.xml<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h5>
<p>The following setting is to be done in todo-infra.xml to use TERASOLUNA DAO.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span> <span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
 <span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
     <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
     <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="nt">&gt;</span>

     <span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&quot;classpath:/META-INF/spring/todo-env.xml&quot;</span> <span class="nt">/&gt;</span>

<span class="hll">     <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">     <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;sqlMapClient&quot;</span>
</span><span class="hll">         <span class="na">class=</span><span class="s">&quot;org.springframework.orm.ibatis.SqlMapClientFactoryBean&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">         <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;configLocations&quot;</span>
</span><span class="hll">             <span class="na">value=</span><span class="s">&quot;classpath*:/META-INF/mybatis/config/*sqlMapConfig.xml&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">         <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;mappingLocations&quot;</span>
</span><span class="hll">             <span class="na">value=</span><span class="s">&quot;classpath*:/META-INF/mybatis/sql/**/*-sqlmap.xml&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">     <span class="nt">&lt;/bean&gt;</span>
</span><span class="hll">
</span><span class="hll">     <span class="c">&lt;!-- (4) --&gt;</span>
</span><span class="hll">     <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;queryDAO&quot;</span> <span class="na">class=</span><span class="s">&quot;jp.terasoluna.fw.dao.ibatis.QueryDAOiBatisImpl&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;sqlMapClient&quot;</span> <span class="na">ref=</span><span class="s">&quot;sqlMapClient&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">     <span class="nt">&lt;/bean&gt;</span>
</span><span class="hll">
</span><span class="hll">     <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;updateDAO&quot;</span> <span class="na">class=</span><span class="s">&quot;jp.terasoluna.fw.dao.ibatis.UpdateDAOiBatisImpl&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;sqlMapClient&quot;</span> <span class="na">ref=</span><span class="s">&quot;sqlMapClient&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">     <span class="nt">&lt;/bean&gt;</span>
</span><span class="hll">
</span><span class="hll">     <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;spDAO&quot;</span>
</span><span class="hll">         <span class="na">class=</span><span class="s">&quot;jp.terasoluna.fw.dao.ibatis.StoredProcedureDAOiBatisImpl&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;sqlMapClient&quot;</span> <span class="na">ref=</span><span class="s">&quot;sqlMapClient&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">     <span class="nt">&lt;/bean&gt;</span>
</span><span class="hll">
</span><span class="hll">     <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;queryRowHandleDAO&quot;</span>
</span><span class="hll">         <span class="na">class=</span><span class="s">&quot;jp.terasoluna.fw.dao.ibatis.QueryRowHandleDAOiBatisImpl&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;sqlMapClient&quot;</span> <span class="na">ref=</span><span class="s">&quot;sqlMapClient&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">     <span class="nt">&lt;/bean&gt;</span>
</span> <span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define <code class="docutils literal"><span class="pre">SqlMapClient</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set the path of SqlMap configuration file. Read <a href="#id17"><span class="problematic" id="id18">*</span></a>sqlMapConfig.xml under <code class="docutils literal"><span class="pre">META-INF/mybatis/config</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set the path of SqlMap file. Read <a href="#id19"><span class="problematic" id="id20">*</span></a>-sqlmap.xml of any folder under <code class="docutils literal"><span class="pre">META-INF/mybatis/sql</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define TERASOLUNA DAO.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id21">
<h5>3.5.3.1.3. Modifications in todo-env.xml<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h5>
<p>Add definition of transaction manager.
Define transaction manager in environment dependent configuration file since JtaTransactionManager can also be used in JavaEE container.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span> <span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
 <span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
     <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
     <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="nt">&gt;</span>

     <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">class=</span><span class="s">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>
         <span class="na">destroy-method=</span><span class="s">&quot;close&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;driverClassName&quot;</span> <span class="na">value=</span><span class="s">&quot;${database.driverClassName}&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;url&quot;</span> <span class="na">value=</span><span class="s">&quot;${database.url}&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span> <span class="na">value=</span><span class="s">&quot;${database.username}&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">value=</span><span class="s">&quot;${database.password}&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultAutoCommit&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxActive&quot;</span> <span class="na">value=</span><span class="s">&quot;${cp.maxActive}&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxIdle&quot;</span> <span class="na">value=</span><span class="s">&quot;${cp.maxIdle}&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;minIdle&quot;</span> <span class="na">value=</span><span class="s">&quot;${cp.minIdle}&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxWait&quot;</span> <span class="na">value=</span><span class="s">&quot;${cp.maxWait}&quot;</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;/bean&gt;</span>

<span class="hll">     <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">     <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;transactionManager&quot;</span>
</span><span class="hll">         <span class="na">class=</span><span class="s">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">     <span class="nt">&lt;/bean&gt;</span>
</span>
 <span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set transaction manager. <code class="docutils literal"><span class="pre">id</span></code> should be set to <code class="docutils literal"><span class="pre">transactionManager</span></code>.</div>
<div class="line">If a separate name is to be specified, transaction manager name should be specified even in &lt;tx:annotation-driven&gt; tag.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id22">
<h5>3.5.3.1.4. Modifications in logback.xml<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h5>
<div class="highlight-xml"><div class="highlight"><pre><span></span> <span class="cp">&lt;!DOCTYPE logback&gt;</span>
 <span class="nt">&lt;configuration&gt;</span>
     <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;STDOUT&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;encoder&gt;</span>
             <span class="nt">&lt;pattern&gt;</span><span class="cp">&lt;![CDATA[%d{yyyy-MM-dd HH:mm:ss} [%thread] [%-5level] [%-48logger{48}] - %msg%n]]&gt;</span><span class="nt">&lt;/pattern&gt;</span>
         <span class="nt">&lt;/encoder&gt;</span>
     <span class="nt">&lt;/appender&gt;</span>

     <span class="c">&lt;!-- Application Loggers --&gt;</span>
     <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;todo&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;debug&quot;</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;/logger&gt;</span>

     <span class="c">&lt;!-- TERASOLUNA --&gt;</span>
     <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.terasoluna.gfw&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;info&quot;</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;/logger&gt;</span>

     <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.terasoluna.gfw.web.logging.TraceLoggingInterceptor&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;trace&quot;</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;/logger&gt;</span>

     <span class="c">&lt;!-- 3rdparty Loggers --&gt;</span>
     <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.springframework&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;warn&quot;</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;/logger&gt;</span>

     <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.springframework.web.servlet&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;info&quot;</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;/logger&gt;</span>

<span class="hll">     <span class="c">&lt;!-- (8) --&gt;</span>
</span><span class="hll">     <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">         <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;debug&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">     <span class="nt">&lt;/logger&gt;</span>
</span><span class="hll">
</span><span class="hll">     <span class="c">&lt;!-- (9) --&gt;</span>
</span><span class="hll">     <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;java.sql.Connection&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">         <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;trace&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">     <span class="nt">&lt;/logger&gt;</span>
</span><span class="hll">     <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;java.sql.PreparedStatement&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">         <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;debug&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">     <span class="nt">&lt;/logger&gt;</span>
</span>
     <span class="nt">&lt;root</span> <span class="na">level=</span><span class="s">&quot;WARN&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;STDOUT&quot;</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;/root&gt;</span>
 <span class="nt">&lt;/configuration&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set to output transaction log for <code class="docutils literal"><span class="pre">DataSourceTransactionManager</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set to output SQL log.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="creation-of-sqlmapconfig">
<h4><a class="toc-backref" href="#id68">3.5.3.2. Creation of sqlMapConfig</a><a class="headerlink" href="#creation-of-sqlmapconfig" title="Permalink to this headline">¶</a></h4>
<p>Create <code class="docutils literal"><span class="pre">src/main/resources/META-INF/mybatis/config/sqlMapConfig.xml</span></code> as given below.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE sqlMapConfig</span>
<span class="cp">            PUBLIC &quot;-//ibatis.apache.org//DTD SQL Map Config 2.0//EN&quot;</span>
<span class="cp">            &quot;http://ibatis.apache.org/dtd/sql-map-config-2.dtd&quot;&gt;</span>
<span class="nt">&lt;sqlMapConfig&gt;</span>
    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;settings</span> <span class="na">useStatementNamespaces=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/sqlMapConfig&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">This setting is to give namespace to SQLID.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="modifications-in-repositoryimpl">
<h4><a class="toc-backref" href="#id69">3.5.3.3. Modifications in RepositoryImpl</a><a class="headerlink" href="#modifications-in-repositoryimpl" title="Permalink to this headline">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span> <span class="kn">package</span> <span class="nn">todo.domain.repository.todo</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>

<span class="hll"> <span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="p">;</span>
</span>
<span class="hll"> <span class="kn">import</span> <span class="nn">jp.terasoluna.fw.dao.QueryDAO</span><span class="p">;</span>
</span><span class="hll"> <span class="kn">import</span> <span class="nn">jp.terasoluna.fw.dao.UpdateDAO</span><span class="p">;</span>
</span>
 <span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="p">;</span>
<span class="hll"> <span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="p">;</span>
</span>
 <span class="kn">import</span> <span class="nn">todo.domain.model.Todo</span><span class="p">;</span>

 <span class="nd">@Repository</span>
<span class="hll"> <span class="c1">// (1)</span>
</span><span class="hll"> <span class="nd">@Transactional</span>
</span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoRepositoryImpl</span> <span class="kd">implements</span> <span class="n">TodoRepository</span> <span class="p">{</span>
<span class="hll">     <span class="c1">// (2)</span>
</span><span class="hll">     <span class="nd">@Inject</span>
</span><span class="hll">     <span class="n">QueryDAO</span> <span class="n">queryDAO</span><span class="p">;</span>
</span>
<span class="hll">     <span class="nd">@Inject</span>
</span><span class="hll">     <span class="n">UpdateDAO</span> <span class="n">updateDAO</span><span class="p">;</span>
</span>
     <span class="c1">// (3)</span>
     <span class="nd">@Override</span>
<span class="hll">     <span class="nd">@Transactional</span><span class="p">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="p">)</span>
</span>     <span class="kd">public</span> <span class="n">Todo</span> <span class="nf">findOne</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">         <span class="k">return</span> <span class="n">queryDAO</span><span class="p">.</span><span class="na">executeForObject</span><span class="p">(</span><span class="s">&quot;todo.findOne&quot;</span><span class="p">,</span> <span class="n">todoId</span><span class="p">,</span> <span class="n">Todo</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span>     <span class="p">}</span>

     <span class="nd">@Override</span>
<span class="hll">     <span class="nd">@Transactional</span><span class="p">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="p">)</span>
</span>     <span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="p">()</span> <span class="p">{</span>
<span class="hll">         <span class="k">return</span> <span class="n">queryDAO</span><span class="p">.</span><span class="na">executeForObjectList</span><span class="p">(</span><span class="s">&quot;todo.findAll&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
</span>     <span class="p">}</span>

     <span class="nd">@Override</span>
     <span class="kd">public</span> <span class="n">Todo</span> <span class="nf">save</span><span class="p">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">         <span class="c1">// (4)</span>
</span><span class="hll">         <span class="k">if</span> <span class="p">(</span><span class="n">exists</span><span class="p">(</span><span class="n">todo</span><span class="p">.</span><span class="na">getTodoId</span><span class="p">()))</span> <span class="p">{</span>
</span><span class="hll">             <span class="n">updateDAO</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="s">&quot;todo.update&quot;</span><span class="p">,</span> <span class="n">todo</span><span class="p">);</span>
</span><span class="hll">         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class="hll">             <span class="n">updateDAO</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="s">&quot;todo.create&quot;</span><span class="p">,</span> <span class="n">todo</span><span class="p">);</span>
</span><span class="hll">         <span class="p">}</span>
</span><span class="hll">         <span class="k">return</span> <span class="n">todo</span><span class="p">;</span>
</span>     <span class="p">}</span>

<span class="hll">     <span class="nd">@Transactional</span><span class="p">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="p">)</span>
</span>     <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">exists</span><span class="p">(</span><span class="n">String</span> <span class="n">todoId</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">         <span class="kt">long</span> <span class="n">count</span> <span class="o">=</span> <span class="n">queryDAO</span><span class="p">.</span><span class="na">executeForObject</span><span class="p">(</span><span class="s">&quot;todo.exists&quot;</span><span class="p">,</span> <span class="n">todoId</span><span class="p">,</span>
</span>                 <span class="n">Long</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
         <span class="k">return</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="nd">@Override</span>
     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="p">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">updateDAO</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="s">&quot;todo.delete&quot;</span><span class="p">,</span> <span class="n">todo</span><span class="p">);</span>
     <span class="p">}</span>

     <span class="nd">@Override</span>
<span class="hll">     <span class="nd">@Transactional</span><span class="p">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="p">)</span>
</span>     <span class="kd">public</span> <span class="kt">long</span> <span class="nf">countByFinished</span><span class="p">(</span><span class="kt">boolean</span> <span class="n">finished</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">         <span class="k">return</span> <span class="n">queryDAO</span><span class="p">.</span><span class="na">executeForObject</span><span class="p">(</span><span class="s">&quot;todo.countByFinished&quot;</span><span class="p">,</span> <span class="n">finished</span><span class="p">,</span>
</span>                 <span class="n">Long</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
     <span class="p">}</span>
 <span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr.No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Manage all the transactions of public methods by adding <code class="docutils literal"><span class="pre">&#64;Transactional</span></code> at class level.</div>
<div class="line">Since settings are made even at Service side that calls the Repository, the transactions can be managed even without adding <code class="docutils literal"><span class="pre">&#64;Transactional</span></code>.</div>
<div class="line">However, since the <code class="docutils literal"><span class="pre">propagation</span></code> attribute is <code class="docutils literal"><span class="pre">REQUIRED</span></code> by default, internal (Repository side) transactions take part in external (Service side)</div>
<div class="line">transactions when the transactions are nested.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Inject QueryDAO and UpdateDAO using <code class="docutils literal"><span class="pre">&#64;Inject</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implementing repository methods involves passing of <code class="docutils literal"><span class="pre">SQLID</span></code> and parameters to TERASOLUNA DAO.</div>
<div class="line">Use <code class="docutils literal"><span class="pre">QueryDAO</span></code> for reference and <code class="docutils literal"><span class="pre">UpdateDAO</span></code> for update. Set SQL corresponding to SQLID as follows.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create new and update are executed using <code class="docutils literal"><span class="pre">save</span></code> method. In order to determine which process is to be executed, create ‘exists’ method.</div>
<div class="line">In this method, the record count of todoId is acquired and whether the record count is greater than 0 is checked.</div>
</div>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt></dt>
<dd><div class="first last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is convenient to use save method as it can be used to create new and to update.
On the other hand, the disadvantage  of using save method from performance perspective is that SQL gets executed twice.
If performance is higher priority, then create <code class="docutils literal"><span class="pre">create</span></code> method for new creation and <code class="docutils literal"><span class="pre">update</span></code> method for updating the data.</p>
</div>
</dd>
</dl>
</div>
<div class="section" id="create-sqlmap-file">
<h4><a class="toc-backref" href="#id70">3.5.3.4. Create SQLMap file</a><a class="headerlink" href="#create-sqlmap-file" title="Permalink to this headline">¶</a></h4>
<p>Create <code class="docutils literal"><span class="pre">src/main/resources/META-INF/mybatis/sql/todo-sqlmap.xml</span></code> and mention sql corresponding to <code class="docutils literal"><span class="pre">SQLID</span></code> used in TodoRepositoryImpl as shown below.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE sqlMap</span>
<span class="cp">            PUBLIC &quot;-//ibatis.apache.org//DTD SQL Map 2.0//EN&quot;</span>
<span class="cp">            &quot;http://ibatis.apache.org/dtd/sql-map-2.dtd&quot;&gt;</span>
<span class="nt">&lt;sqlMap</span> <span class="na">namespace=</span><span class="s">&quot;todo&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;todo&quot;</span> <span class="na">class=</span><span class="s">&quot;todo.domain.model.Todo&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;todoId&quot;</span> <span class="na">column=</span><span class="s">&quot;todo_id&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;todoTitle&quot;</span> <span class="na">column=</span><span class="s">&quot;todo_title&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;finished&quot;</span> <span class="na">column=</span><span class="s">&quot;finished&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;createdAt&quot;</span> <span class="na">column=</span><span class="s">&quot;created_at&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/resultMap&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span> <span class="na">parameterClass=</span><span class="s">&quot;java.lang.String&quot;</span>
        <span class="na">resultMap=</span><span class="s">&quot;todo&quot;</span><span class="nt">&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">SELECT todo_id,</span>
<span class="cp">       todo_title,</span>
<span class="cp">       finished,</span>
<span class="cp">       created_at</span>
<span class="cp">FROM   todo</span>
<span class="cp">WHERE  todo_id = #value#</span>
<span class="cp">]]&gt;</span><span class="nt">&lt;/select&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findAll&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;todo&quot;</span><span class="nt">&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">SELECT todo_id,</span>
<span class="cp">       todo_title,</span>
<span class="cp">       finished,</span>
<span class="cp">       created_at</span>
<span class="cp">FROM   todo</span>
<span class="cp">]]&gt;</span><span class="nt">&lt;/select&gt;</span>

    <span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&quot;create&quot;</span> <span class="na">parameterClass=</span><span class="s">&quot;todo.domain.model.Todo&quot;</span><span class="nt">&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">INSERT INTO todo</span>
<span class="cp">            (todo_id,</span>
<span class="cp">             todo_title,</span>
<span class="cp">             finished,</span>
<span class="cp">             created_at)</span>
<span class="cp">VALUES      ( #todoId#,</span>
<span class="cp">             #todoTitle#,</span>
<span class="cp">             #finished#,</span>
<span class="cp">             #createdAt# )</span>
<span class="cp">]]&gt;</span><span class="nt">&lt;/insert&gt;</span>

    <span class="nt">&lt;update</span> <span class="na">id=</span><span class="s">&quot;update&quot;</span> <span class="na">parameterClass=</span><span class="s">&quot;todo.domain.model.Todo&quot;</span><span class="nt">&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">UPDATE todo</span>
<span class="cp">SET    todo_title = #todoTitle#,</span>
<span class="cp">       finished = #finished#,</span>
<span class="cp">       created_at = #createdAt#</span>
<span class="cp">WHERE  todo_id = #todoId#</span>
<span class="cp">]]&gt;</span><span class="nt">&lt;/update&gt;</span>

    <span class="nt">&lt;delete</span> <span class="na">id=</span><span class="s">&quot;delete&quot;</span> <span class="na">parameterClass=</span><span class="s">&quot;todo.domain.model.Todo&quot;</span><span class="nt">&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">DELETE FROM todo</span>
<span class="cp">WHERE  todo_id = #todoId#</span>
<span class="cp">]]&gt;</span><span class="nt">&lt;/delete&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;countByFinished&quot;</span> <span class="na">parameterClass=</span><span class="s">&quot;java.lang.Boolean&quot;</span>
        <span class="na">resultClass=</span><span class="s">&quot;java.lang.Long&quot;</span><span class="nt">&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">SELECT COUNT(*)</span>
<span class="cp">FROM   todo</span>
<span class="cp">WHERE  finished = #value#</span>
<span class="cp">]]&gt;</span><span class="nt">&lt;/select&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;exists&quot;</span> <span class="na">parameterClass=</span><span class="s">&quot;java.lang.String&quot;</span>
        <span class="na">resultClass=</span><span class="s">&quot;java.lang.Long&quot;</span><span class="nt">&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">SELECT COUNT(*)</span>
<span class="cp">FROM   todo</span>
<span class="cp">WHERE  todo_id = #value#</span>
<span class="cp">]]&gt;</span><span class="nt">&lt;/select&gt;</span>
<span class="nt">&lt;/sqlMap&gt;</span>
</pre></div>
</div>
<p>With this, usage of TERASOLUNA DAO is completed. Start AP server,
SQL log and transaction log as shown below are output for the display of Todo and for creating a new one.</p>
<div class="highlight-guess"><div class="highlight"><pre><span></span> <span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">28</span> <span class="mi">14</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">37</span> <span class="p">[</span><span class="n">tomcat</span><span class="o">-</span><span class="n">http</span><span class="o">--</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">TRACE</span><span class="p">]</span> <span class="p">[</span><span class="n">o</span><span class="p">.</span><span class="n">t</span><span class="p">.</span><span class="n">gfw</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">logging</span><span class="p">.</span><span class="n">TraceLoggingInterceptor</span>     <span class="p">]</span> <span class="o">-</span> <span class="p">[</span><span class="n">START</span> <span class="n">CONTROLLER</span><span class="p">]</span> <span class="n">TodoController</span><span class="p">.</span><span class="n">list</span><span class="p">(</span><span class="n">Model</span><span class="p">)</span>
<span class="hll"> <span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">28</span> <span class="mi">14</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">37</span> <span class="p">[</span><span class="n">tomcat</span><span class="o">-</span><span class="n">http</span><span class="o">--</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">DEBUG</span><span class="p">]</span> <span class="p">[</span><span class="n">o</span><span class="p">.</span><span class="n">s</span><span class="p">.</span><span class="n">jdbc</span><span class="p">.</span><span class="n">datasource</span><span class="p">.</span><span class="n">DataSourceTransactionManager</span><span class="p">]</span> <span class="o">-</span> <span class="n">Creating</span> <span class="n">new</span> <span class="n">transaction</span> <span class="n">with</span> <span class="n">name</span> <span class="p">[</span><span class="n">todo</span><span class="p">.</span><span class="n">domain</span><span class="p">.</span><span class="n">serivce</span><span class="p">.</span><span class="n">todo</span><span class="p">.</span><span class="n">TodoServiceImpl</span><span class="p">.</span><span class="n">findAll</span><span class="p">]</span><span class="o">:</span> <span class="n">PROPAGATION_REQUIRED</span><span class="p">,</span><span class="n">ISOLATION_DEFAULT</span><span class="p">,</span><span class="n">readOnly</span><span class="p">;</span> <span class="err">&#39;&#39;</span>
</span><span class="hll"> <span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">28</span> <span class="mi">14</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">37</span> <span class="p">[</span><span class="n">tomcat</span><span class="o">-</span><span class="n">http</span><span class="o">--</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">DEBUG</span><span class="p">]</span> <span class="p">[</span><span class="n">o</span><span class="p">.</span><span class="n">s</span><span class="p">.</span><span class="n">jdbc</span><span class="p">.</span><span class="n">datasource</span><span class="p">.</span><span class="n">DataSourceTransactionManager</span><span class="p">]</span> <span class="o">-</span> <span class="n">Acquired</span> <span class="n">Connection</span> <span class="p">[</span><span class="nl">jdbc</span><span class="p">:</span><span class="nl">h2</span><span class="p">:</span><span class="nl">mem</span><span class="p">:</span><span class="n">todo</span><span class="p">,</span> <span class="n">UserName</span><span class="o">=</span><span class="n">SA</span><span class="p">,</span> <span class="n">H2</span> <span class="n">JDBC</span> <span class="n">Driver</span><span class="p">]</span> <span class="k">for</span> <span class="n">JDBC</span> <span class="n">transaction</span>
</span><span class="hll"> <span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">28</span> <span class="mi">14</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">37</span> <span class="p">[</span><span class="n">tomcat</span><span class="o">-</span><span class="n">http</span><span class="o">--</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">DEBUG</span><span class="p">]</span> <span class="p">[</span><span class="n">o</span><span class="p">.</span><span class="n">s</span><span class="p">.</span><span class="n">jdbc</span><span class="p">.</span><span class="n">datasource</span><span class="p">.</span><span class="n">DataSourceTransactionManager</span><span class="p">]</span> <span class="o">-</span> <span class="n">Participating</span> <span class="k">in</span> <span class="n">existing</span> <span class="n">transaction</span>
</span><span class="hll"> <span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">28</span> <span class="mi">14</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">37</span> <span class="p">[</span><span class="n">tomcat</span><span class="o">-</span><span class="n">http</span><span class="o">--</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">DEBUG</span><span class="p">]</span> <span class="p">[</span><span class="n">java</span><span class="p">.</span><span class="n">sql</span><span class="p">.</span><span class="n">Connection</span>                             <span class="p">]</span> <span class="o">-</span> <span class="p">{</span><span class="n">conn</span><span class="o">-</span><span class="mi">100014</span><span class="p">}</span> <span class="n">Connection</span>
</span><span class="hll"> <span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">28</span> <span class="mi">14</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">37</span> <span class="p">[</span><span class="n">tomcat</span><span class="o">-</span><span class="n">http</span><span class="o">--</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">DEBUG</span><span class="p">]</span> <span class="p">[</span><span class="n">java</span><span class="p">.</span><span class="n">sql</span><span class="p">.</span><span class="n">Connection</span>                             <span class="p">]</span> <span class="o">-</span> <span class="p">{</span><span class="n">conn</span><span class="o">-</span><span class="mi">100014</span><span class="p">}</span> <span class="n">Preparing</span> <span class="nl">Statement</span><span class="p">:</span>  <span class="n">SELECT</span> <span class="n">todo_id</span><span class="p">,</span>        <span class="n">todo_title</span><span class="p">,</span>        <span class="n">finished</span><span class="p">,</span>        <span class="n">created_at</span> <span class="n">FROM</span>   <span class="n">todo</span>
</span><span class="hll"> <span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">28</span> <span class="mi">14</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">37</span> <span class="p">[</span><span class="n">tomcat</span><span class="o">-</span><span class="n">http</span><span class="o">--</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">DEBUG</span><span class="p">]</span> <span class="p">[</span><span class="n">java</span><span class="p">.</span><span class="n">sql</span><span class="p">.</span><span class="n">PreparedStatement</span>                      <span class="p">]</span> <span class="o">-</span> <span class="p">{</span><span class="n">pstm</span><span class="o">-</span><span class="mi">100015</span><span class="p">}</span> <span class="n">Executing</span> <span class="nl">Statement</span><span class="p">:</span>  <span class="n">SELECT</span> <span class="n">todo_id</span><span class="p">,</span>        <span class="n">todo_title</span><span class="p">,</span>        <span class="n">finished</span><span class="p">,</span>        <span class="n">created_at</span> <span class="n">FROM</span>   <span class="n">todo</span>
</span><span class="hll"> <span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">28</span> <span class="mi">14</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">37</span> <span class="p">[</span><span class="n">tomcat</span><span class="o">-</span><span class="n">http</span><span class="o">--</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">DEBUG</span><span class="p">]</span> <span class="p">[</span><span class="n">java</span><span class="p">.</span><span class="n">sql</span><span class="p">.</span><span class="n">PreparedStatement</span>                      <span class="p">]</span> <span class="o">-</span> <span class="p">{</span><span class="n">pstm</span><span class="o">-</span><span class="mi">100015</span><span class="p">}</span> <span class="nl">Parameters</span><span class="p">:</span> <span class="p">[]</span>
</span><span class="hll"> <span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">28</span> <span class="mi">14</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">37</span> <span class="p">[</span><span class="n">tomcat</span><span class="o">-</span><span class="n">http</span><span class="o">--</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">DEBUG</span><span class="p">]</span> <span class="p">[</span><span class="n">java</span><span class="p">.</span><span class="n">sql</span><span class="p">.</span><span class="n">PreparedStatement</span>                      <span class="p">]</span> <span class="o">-</span> <span class="p">{</span><span class="n">pstm</span><span class="o">-</span><span class="mi">100015</span><span class="p">}</span> <span class="nl">Types</span><span class="p">:</span> <span class="p">[]</span>
</span><span class="hll"> <span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">28</span> <span class="mi">14</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">37</span> <span class="p">[</span><span class="n">tomcat</span><span class="o">-</span><span class="n">http</span><span class="o">--</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">DEBUG</span><span class="p">]</span> <span class="p">[</span><span class="n">o</span><span class="p">.</span><span class="n">s</span><span class="p">.</span><span class="n">jdbc</span><span class="p">.</span><span class="n">datasource</span><span class="p">.</span><span class="n">DataSourceTransactionManager</span><span class="p">]</span> <span class="o">-</span> <span class="n">Initiating</span> <span class="n">transaction</span> <span class="n">commit</span>
</span><span class="hll"> <span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">28</span> <span class="mi">14</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">37</span> <span class="p">[</span><span class="n">tomcat</span><span class="o">-</span><span class="n">http</span><span class="o">--</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">DEBUG</span><span class="p">]</span> <span class="p">[</span><span class="n">o</span><span class="p">.</span><span class="n">s</span><span class="p">.</span><span class="n">jdbc</span><span class="p">.</span><span class="n">datasource</span><span class="p">.</span><span class="n">DataSourceTransactionManager</span><span class="p">]</span> <span class="o">-</span> <span class="n">Committing</span> <span class="n">JDBC</span> <span class="n">transaction</span> <span class="n">on</span> <span class="n">Connection</span> <span class="p">[</span><span class="nl">jdbc</span><span class="p">:</span><span class="nl">h2</span><span class="p">:</span><span class="nl">mem</span><span class="p">:</span><span class="n">todo</span><span class="p">,</span> <span class="n">UserName</span><span class="o">=</span><span class="n">SA</span><span class="p">,</span> <span class="n">H2</span> <span class="n">JDBC</span> <span class="n">Driver</span><span class="p">]</span>
</span><span class="hll"> <span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">28</span> <span class="mi">14</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">37</span> <span class="p">[</span><span class="n">tomcat</span><span class="o">-</span><span class="n">http</span><span class="o">--</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">DEBUG</span><span class="p">]</span> <span class="p">[</span><span class="n">o</span><span class="p">.</span><span class="n">s</span><span class="p">.</span><span class="n">jdbc</span><span class="p">.</span><span class="n">datasource</span><span class="p">.</span><span class="n">DataSourceTransactionManager</span><span class="p">]</span> <span class="o">-</span> <span class="n">Releasing</span> <span class="n">JDBC</span> <span class="n">Connection</span> <span class="p">[</span><span class="nl">jdbc</span><span class="p">:</span><span class="nl">h2</span><span class="p">:</span><span class="nl">mem</span><span class="p">:</span><span class="n">todo</span><span class="p">,</span> <span class="n">UserName</span><span class="o">=</span><span class="n">SA</span><span class="p">,</span> <span class="n">H2</span> <span class="n">JDBC</span> <span class="n">Driver</span><span class="p">]</span> <span class="n">after</span> <span class="n">transaction</span>
</span> <span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">28</span> <span class="mi">14</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">37</span> <span class="p">[</span><span class="n">tomcat</span><span class="o">-</span><span class="n">http</span><span class="o">--</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">TRACE</span><span class="p">]</span> <span class="p">[</span><span class="n">o</span><span class="p">.</span><span class="n">t</span><span class="p">.</span><span class="n">gfw</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">logging</span><span class="p">.</span><span class="n">TraceLoggingInterceptor</span>     <span class="p">]</span> <span class="o">-</span> <span class="p">[</span><span class="n">END</span> <span class="n">CONTROLLER</span>  <span class="p">]</span> <span class="n">TodoController</span><span class="p">.</span><span class="n">list</span><span class="p">(</span><span class="n">Model</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">view</span><span class="o">=</span><span class="n">todo</span><span class="o">/</span><span class="n">list</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="n">todoForm</span><span class="o">=</span><span class="n">todo</span><span class="p">.</span><span class="n">app</span><span class="p">.</span><span class="n">todo</span><span class="p">.</span><span class="n">TodoForm</span><span class="mi">@1386751</span><span class="p">,</span> <span class="n">todos</span><span class="o">=</span><span class="p">[</span><span class="n">todo</span><span class="p">.</span><span class="n">domain</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">Todo</span><span class="mi">@72</span><span class="n">edc</span><span class="p">],</span> <span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">validation</span><span class="p">.</span><span class="n">BindingResult</span><span class="p">.</span><span class="n">todoForm</span><span class="o">=</span><span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">validation</span><span class="p">.</span><span class="nl">BeanPropertyBindingResult</span><span class="p">:</span> <span class="mi">0</span> <span class="n">errors</span><span class="p">}</span>
 <span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">28</span> <span class="mi">14</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">37</span> <span class="p">[</span><span class="n">tomcat</span><span class="o">-</span><span class="n">http</span><span class="o">--</span><span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="n">TRACE</span><span class="p">]</span> <span class="p">[</span><span class="n">o</span><span class="p">.</span><span class="n">t</span><span class="p">.</span><span class="n">gfw</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">logging</span><span class="p">.</span><span class="n">TraceLoggingInterceptor</span>     <span class="p">]</span> <span class="o">-</span> <span class="p">[</span><span class="n">HANDLING</span> <span class="n">TIME</span>   <span class="p">]</span> <span class="n">TodoController</span><span class="p">.</span><span class="n">list</span><span class="p">(</span><span class="n">Model</span><span class="p">)</span><span class="o">-&gt;</span> <span class="mi">2</span><span class="p">,</span><span class="mi">461</span><span class="p">,</span><span class="mi">131</span> <span class="n">ns</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="in-the-end">
<h2><a class="toc-backref" href="#id71">3.6. In the end…</a><a class="headerlink" href="#in-the-end" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial, following contents have been learnt</p>
<ul class="simple">
<li>How to develop basic applications by TERASOLUNA Global Framework, and how to build Eclipse project</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Using the STS</li>
<li>How to use TERASOLUNA Global Framework with Maven</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Way of development using application layering of TERASOLUNA Global Framework.</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Implementation of domain layer with POJO(+ Spring)</li>
<li>Implementation of application layer with the use of JSP tag libraries and Sring MVC</li>
<li>Development of Infrastructure layer with the use of Spring Data JPA</li>
<li>Development of Infrastructure layer with the use of MyBatis2</li>
</ul>
</div></blockquote>
<p>The following improvement can be done in the TODO management application.</p>
<ul class="simple">
<li>To externalize the property → <a class="reference internal" href="../ArchitectureInDetail/PropertyManagement.html"><span class="doc">Properties Management</span></a></li>
<li>To externalize the messages → <a class="reference internal" href="../ArchitectureInDetail/MessageManagement.html"><span class="doc">Message Management</span></a></li>
<li>To add paging → <a class="reference internal" href="../ArchitectureInDetail/Pagination.html"><span class="doc">Pagination</span></a></li>
<li>To add exception handling → <a class="reference internal" href="../ArchitectureInDetail/ExceptionHandling.html"><span class="doc">Exception Handling</span></a></li>
<li>To add a CSRF measures → <a class="reference internal" href="../Security/CSRF.html"><span class="doc">[coming soon] CSRF(Cross Site Request Forgeries) Countermeasures</span></a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../ImplementationAtEachLayer/index.html" title="4. Application Development using TERASOLUNA Global Framework"
             >next</a> |</li>
        <li class="right" >
          <a href="../Overview/ApplicationLayering.html" title="2.4. Application Layering"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Global Framework Development Guideline 1.0.2.RELEASE documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013-2015, NTT DATA.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.3.Theme by <a href="http://github.com/vkvn">vkvn</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>