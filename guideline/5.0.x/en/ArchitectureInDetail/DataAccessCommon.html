<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>5.1. Database Access (Common) &mdash; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.0.0-SNAPSHOT documentation</title>
    
    <link rel="stylesheet" href="../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.0.0-SNAPSHOT',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.0.0-SNAPSHOT documentation" href="../index.html" />
    <link rel="up" title="5. Architecture in Detail - TERASOLUNA Server Framework for Java (5.x)" href="index.html" />
    <link rel="next" title="5.2. Database Access (JPA)" href="DataAccessJpa.html" />
    <link rel="prev" title="5. Architecture in Detail - TERASOLUNA Server Framework for Java (5.x)" href="index.html" /><script src="../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../_static/solarized-dark.css" rel="stylesheet">
<link href="../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="DataAccessJpa.html" title="5.2. Database Access (JPA)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="5. Architecture in Detail - TERASOLUNA Server Framework for Java (5.x)"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.0.0-SNAPSHOT documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">5. Architecture in Detail - TERASOLUNA Server Framework for Java (5.x)</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">5.1. Database Access (Common)</a><ul>
<li><a class="reference internal" href="#overview">5.1.1. Overview</a><ul>
<li><a class="reference internal" href="#about-jdbc-datasource">5.1.1.1. About JDBC DataSource</a><ul>
<li><a class="reference internal" href="#jdbc-datasource-provided-by-application-server">5.1.1.1.1. JDBC datasource provided by Application Server</a></li>
<li><a class="reference internal" href="#jdbc-datasource-provided-by-oss-third-party-library">5.1.1.1.2. JDBC datasource provided by OSS/Third-Party library</a></li>
<li><a class="reference internal" href="#jdbc-datasource-provided-by-spring-framework">5.1.1.1.3. JDBC datasource provided by Spring Framework</a></li>
</ul>
</li>
<li><a class="reference internal" href="#about-transaction-management">5.1.1.2. About transaction management</a></li>
<li><a class="reference internal" href="#about-declaration-of-transaction-boundary-attribute">5.1.1.3. About declaration of transaction boundary/attribute</a></li>
<li><a class="reference internal" href="#about-exclusion-control-of-data">5.1.1.4. About exclusion control of data</a></li>
<li><a class="reference internal" href="#about-exception-handling">5.1.1.5. About exception handling</a></li>
<li><a class="reference internal" href="#about-multiple-datasources">5.1.1.6. About multiple datasources</a></li>
<li><a class="reference internal" href="#about-common-library-classes">5.1.1.7. About common library classes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use">5.1.2. How to use</a><ul>
<li><a class="reference internal" href="#datasource-settings">5.1.2.1. Datasource settings</a><ul>
<li><a class="reference internal" href="#settings-when-using-datasource-defined-in-application-server">5.1.2.1.1. Settings when using DataSource defined in Application Server</a></li>
<li><a class="reference internal" href="#settings-when-using-datasource-for-which-bean-is-defined">5.1.2.1.2. Settings when using DataSource for which Bean is defined</a></li>
</ul>
</li>
<li><a class="reference internal" href="#settings-to-enable-transaction-management">5.1.2.2. Settings to enable transaction management</a></li>
<li><a class="reference internal" href="#jdbc-debug-log-settings">5.1.2.3. JDBC debug log settings</a><ul>
<li><a class="reference internal" href="#settings-related-to-datasource-provided-by-log4jdbc">5.1.2.3.1. Settings related to datasource provided by log4jdbc</a></li>
<li><a class="reference internal" href="#log4jdbc-logger-settings">5.1.2.3.2. log4jdbc logger settings</a></li>
<li><a class="reference internal" href="#settings-of-log4jdbc-option">5.1.2.3.3. Settings of log4jdbc option</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-extend">5.1.3. How to extend</a><ul>
<li><a class="reference internal" href="#settings-for-using-multiple-datasources">5.1.3.1. Settings for using multiple datasources</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-resolve-the-problem">5.1.4. How to resolve the problem</a><ul>
<li><a class="reference internal" href="#how-to-resolve-n-1">5.1.4.1. How to resolve N+1</a><ul>
<li><a class="reference internal" href="#resolving-n-1-using-joins-join-fetch">5.1.4.1.1. Resolving N+1 using JOINs (Join Fetch)</a></li>
<li><a class="reference internal" href="#resolving-n-1-by-fetching-related-records-in-batch">5.1.4.1.2. Resolving N+1 by fetching related records in batch</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#appendix">5.1.5. Appendix</a><ul>
<li><a class="reference internal" href="#escaping-during-like-search">5.1.5.1. Escaping during LIKE search</a><ul>
<li><a class="reference internal" href="#specifications-of-escaping-of-common-library">5.1.5.1.1. Specifications of escaping of common library</a></li>
<li><a class="reference internal" href="#about-escaping-methods-provided-by-common-library">5.1.5.1.2. About escaping methods provided by common library</a></li>
<li><a class="reference internal" href="#how-to-use-common-library">5.1.5.1.3. How to use common library</a></li>
</ul>
</li>
<li><a class="reference internal" href="#about-sequencer">5.1.5.2. About Sequencer</a><ul>
<li><a class="reference internal" href="#about-classes-provided-by-common-library">5.1.5.2.1. About classes provided by common library</a></li>
<li><a class="reference internal" href="#data-access-common-howtouse-sequencer">5.1.5.2.2. How to use common library</a></li>
</ul>
</li>
<li><a class="reference internal" href="#classes-provided-by-spring-framework-for-converting-to-data-access-exception">5.1.5.3. Classes provided by Spring Framework for converting to data access exception</a></li>
<li><a class="reference internal" href="#jdbc-datasource-classes-provided-by-spring-framework">5.1.5.4. JDBC datasource classes provided by Spring Framework</a></li>
</ul>
</li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">5. Architecture in Detail - TERASOLUNA Server Framework for Java (5.x)</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="DataAccessJpa.html"
                        title="next chapter">5.2. Database Access (JPA)</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/ArchitectureInDetail/DataAccessCommon.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="database-access-common">
<h1>5.1. Database Access (Common)<a class="headerlink" href="#database-access-common" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id3">Overview</a><ul>
<li><a class="reference internal" href="#about-jdbc-datasource" id="id4">About JDBC DataSource</a><ul>
<li><a class="reference internal" href="#jdbc-datasource-provided-by-application-server" id="id5">JDBC datasource provided by Application Server</a></li>
<li><a class="reference internal" href="#jdbc-datasource-provided-by-oss-third-party-library" id="id6">JDBC datasource provided by OSS/Third-Party library</a></li>
<li><a class="reference internal" href="#jdbc-datasource-provided-by-spring-framework" id="id7">JDBC datasource provided by Spring Framework</a></li>
</ul>
</li>
<li><a class="reference internal" href="#about-transaction-management" id="id8">About transaction management</a></li>
<li><a class="reference internal" href="#about-declaration-of-transaction-boundary-attribute" id="id9">About declaration of transaction boundary/attribute</a></li>
<li><a class="reference internal" href="#about-exclusion-control-of-data" id="id10">About exclusion control of data</a></li>
<li><a class="reference internal" href="#about-exception-handling" id="id11">About exception handling</a></li>
<li><a class="reference internal" href="#about-multiple-datasources" id="id12">About multiple datasources</a></li>
<li><a class="reference internal" href="#about-common-library-classes" id="id13">About common library classes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use" id="id14">How to use</a><ul>
<li><a class="reference internal" href="#datasource-settings" id="id15">Datasource settings</a><ul>
<li><a class="reference internal" href="#settings-when-using-datasource-defined-in-application-server" id="id16">Settings when using DataSource defined in Application Server</a></li>
<li><a class="reference internal" href="#settings-when-using-datasource-for-which-bean-is-defined" id="id17">Settings when using DataSource for which Bean is defined</a></li>
</ul>
</li>
<li><a class="reference internal" href="#settings-to-enable-transaction-management" id="id18">Settings to enable transaction management</a></li>
<li><a class="reference internal" href="#jdbc-debug-log-settings" id="id19">JDBC debug log settings</a><ul>
<li><a class="reference internal" href="#settings-related-to-datasource-provided-by-log4jdbc" id="id20">Settings related to datasource provided by log4jdbc</a></li>
<li><a class="reference internal" href="#log4jdbc-logger-settings" id="id21">log4jdbc logger settings</a></li>
<li><a class="reference internal" href="#settings-of-log4jdbc-option" id="id22">Settings of log4jdbc option</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-extend" id="id23">How to extend</a><ul>
<li><a class="reference internal" href="#settings-for-using-multiple-datasources" id="id24">Settings for using multiple datasources</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-resolve-the-problem" id="id25">How to resolve the problem</a><ul>
<li><a class="reference internal" href="#how-to-resolve-n-1" id="id26">How to resolve N+1</a><ul>
<li><a class="reference internal" href="#resolving-n-1-using-joins-join-fetch" id="id27">Resolving N+1 using JOINs (Join Fetch)</a></li>
<li><a class="reference internal" href="#resolving-n-1-by-fetching-related-records-in-batch" id="id28">Resolving N+1 by fetching related records in batch</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#appendix" id="id29">Appendix</a><ul>
<li><a class="reference internal" href="#escaping-during-like-search" id="id30">Escaping during LIKE search</a><ul>
<li><a class="reference internal" href="#specifications-of-escaping-of-common-library" id="id31">Specifications of escaping of common library</a></li>
<li><a class="reference internal" href="#about-escaping-methods-provided-by-common-library" id="id32">About escaping methods provided by common library</a></li>
<li><a class="reference internal" href="#how-to-use-common-library" id="id33">How to use common library</a></li>
</ul>
</li>
<li><a class="reference internal" href="#about-sequencer" id="id34">About Sequencer</a><ul>
<li><a class="reference internal" href="#about-classes-provided-by-common-library" id="id35">About classes provided by common library</a></li>
<li><a class="reference internal" href="#data-access-common-howtouse-sequencer" id="id36">How to use common library</a></li>
</ul>
</li>
<li><a class="reference internal" href="#classes-provided-by-spring-framework-for-converting-to-data-access-exception" id="id37">Classes provided by Spring Framework for converting to data access exception</a></li>
<li><a class="reference internal" href="#jdbc-datasource-classes-provided-by-spring-framework" id="id38">JDBC datasource classes provided by Spring Framework</a></li>
</ul>
</li>
</ul>
</div>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p><strong>TBD</strong></p>
<p>The following topics in this chapter are currently under study.</p>
<ul class="last">
<li><div class="first line-block">
<div class="line">About multiple datasources</div>
<div class="line">For details, refer to <a class="reference internal" href="#data-access-common-todo-multiple-datasource-overview"><em>Overview - About multiple datasources</em></a> and <a class="reference internal" href="#data-access-common-todo-multiple-datasource-howtoextends"><em>How to extends - About multiple datasources</em></a>.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">About handling of unique constraint errors and pessimistic exclusion errors when using JPA</div>
<div class="line">For details, refer to <a class="reference internal" href="#data-access-common-todo-exception"><em>Overview - About exception handling</em></a>.</div>
</div>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id3">5.1.1. Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">This chapter explains the method of accessing the data stored in RDBMS.</div>
<div class="line">For O/R Mapper dependent part, refer to <a class="reference internal" href="DataAccessJpa.html"><em>Database Access (JPA)</em></a>.</div>
</div>
<div class="section" id="about-jdbc-datasource">
<h3><a class="toc-backref" href="#id4">5.1.1.1. About JDBC DataSource</a><a class="headerlink" href="#about-jdbc-datasource" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">RDBMS can be accessed from the application by referring to JDBC datasource.</div>
<div class="line">JDBC datasource can be used to exclude settings such as JDBC driver load, connection information (URL, user, password etc.) from application.</div>
<div class="line">Therefore, RDBMS to be used and environment in which the application is to be deployed need not be taken into account.</div>
</div>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../_images/dataaccess_common-datasource.png"><img alt="about data source" src="../_images/dataaccess_common-datasource.png" style="width: 90%;" /></a>
<p class="caption"><strong>Picture - About JDBC DataSource</strong></p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">JDBC datasource is implemented from Application Server, OSS library, Third-Party library, Spring Framework etc.; hence it is necessary to select the datasource based on project requirements and deployment environment.</div>
<div class="line">The typical datasources are introduced below.</div>
</div>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#datasource-application-server-label"><em>JDBC datasource provided by Application Server</em></a></li>
<li><a class="reference internal" href="#datasource-oss-thirdparty-label"><em>JDBC datasource provided by OSS/Third-Party library</em></a></li>
<li><a class="reference internal" href="#datasource-spring-framework-label"><em>JDBC datasource provided by Spring Framework</em></a></li>
</ul>
</div></blockquote>
<div class="section" id="jdbc-datasource-provided-by-application-server">
<span id="datasource-application-server-label"></span><h4><a class="toc-backref" href="#id5">5.1.1.1.1. JDBC datasource provided by Application Server</a><a class="headerlink" href="#jdbc-datasource-provided-by-application-server" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">When datasource is to be used in Web application, normally JDBC datasource provided by Application Server is used.</div>
<div class="line">JDBC datasource of Application Server provides functionalities required in web application such as Connection Pooling as standard functionalities.</div>
</div>
<blockquote>
<div><table border="1" class="docutils">
<caption><strong>Datasources provided by Application Server</strong></caption>
<colgroup>
<col width="10%" />
<col width="35%" />
<col width="55%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Application Server</th>
<th class="head">Reference page</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Apache Tomcat 7</td>
<td><div class="first last line-block">
<div class="line">Refer to <a class="reference external" href="http://tomcat.apache.org/tomcat-7.0-doc/jdbc-pool.html">Apache Tomcat 7 User Guide (The Tomcat JDBC Connection Pool)</a>.</div>
<div class="line">Refer to <a class="reference external" href="http://tomcat.apache.org/tomcat-7.0-doc/jndi-datasource-examples-howto.html">Apache Tomcat 7 User Guide (JNDI Datasource HOW-TO)</a> (Apache Commons DBCP).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>Oracle WebLogic Server 12c</td>
<td>Refer to <a class="reference external" href="http://docs.oracle.com/cd/E24329_01/web.1211/e24367/toc.htm">Oracle WebLogic Server Product Documentation</a>.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>IBM WebSphere Application Server Version 8.5</td>
<td>Refer to <a class="reference external" href="http://pic.dhe.ibm.com/infocenter/wasinfo/v8r5/index.jsp?topic=%2Fcom.ibm.websphere.nd.doc%2Fae%2Ftdat_ccrtpds.html">WebSphere Application Server Online information center</a>.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>Resin 4.0</td>
<td>Refer to <a class="reference external" href="http://www.caucho.com/resin-4.0/admin/database.xtp">Resin Documentation</a>.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="jdbc-datasource-provided-by-oss-third-party-library">
<span id="datasource-oss-thirdparty-label"></span><h4><a class="toc-backref" href="#id6">5.1.1.1.2. JDBC datasource provided by OSS/Third-Party library</a><a class="headerlink" href="#jdbc-datasource-provided-by-oss-third-party-library" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">When JDBC datasource of Application Server is not used, JDBC datasource of OSS/Third-Party library should be used.</div>
<div class="line">This guideline introduces only Apache Commons DBCP; however other libraries can also be used.</div>
</div>
<blockquote>
<div><table border="1" class="docutils">
<caption><strong>JDBC datasource provided by OSS/Third-Party library</strong></caption>
<colgroup>
<col width="10%" />
<col width="35%" />
<col width="55%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Library name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Apache Commons DBCP</td>
<td>Refer to <a class="reference external" href="http://commons.apache.org/proper/commons-dbcp/index.html">Apache Commons DBCP</a>.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="jdbc-datasource-provided-by-spring-framework">
<span id="datasource-spring-framework-label"></span><h4><a class="toc-backref" href="#id7">5.1.1.1.3. JDBC datasource provided by Spring Framework</a><a class="headerlink" href="#jdbc-datasource-provided-by-spring-framework" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Implementation class of JDBC datasource of Spring Framework cannot be used as datasource of Web application since it does not provide connection pooling.</div>
<div class="line">In Spring Framework, implementation class and adapter class of JDBC datasource are provided; however they are introduced as  <a class="reference internal" href="#appendix-datasource-of-spring-label"><em>JDBC datasource classes provided by Spring Framework</em></a> of Appendix, since usage is restricted.</div>
</div>
</div>
</div>
<div class="section" id="about-transaction-management">
<h3><a class="toc-backref" href="#id8">5.1.1.2. About transaction management</a><a class="headerlink" href="#about-transaction-management" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">When transactions are to be stored using Spring Framework functionality, PlatformTransactionManager needs to be selected based on project requirements and deployment environment.</div>
<div class="line">For details, refer to <a class="reference internal" href="../ImplementationAtEachLayer/DomainLayer.html#service-enable-transaction-management"><em>Settings for using transaction management</em></a> of <a class="reference internal" href="../ImplementationAtEachLayer/DomainLayer.html"><em>Domain Layer Implementation</em></a>.</div>
</div>
</div>
<div class="section" id="about-declaration-of-transaction-boundary-attribute">
<h3><a class="toc-backref" href="#id9">5.1.1.3. About declaration of transaction boundary/attribute</a><a class="headerlink" href="#about-declaration-of-transaction-boundary-attribute" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Transaction boundary and transaction attributes should be declared by specifying  <tt class="docutils literal"><span class="pre">&#64;Transactional</span></tt> annotation in Service.</div>
<div class="line">For details, refer to <a class="reference internal" href="../ImplementationAtEachLayer/DomainLayer.html#service-transaction-management"><em>Regarding transaction management</em></a> of <a class="reference internal" href="../ImplementationAtEachLayer/DomainLayer.html"><em>Domain Layer Implementation</em></a> .</div>
</div>
</div>
<div class="section" id="about-exclusion-control-of-data">
<h3><a class="toc-backref" href="#id10">5.1.1.4. About exclusion control of data</a><a class="headerlink" href="#about-exclusion-control-of-data" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">When updating data, it is necessary to execute exclusion control to ensure data consistency and integrity.</div>
<div class="line">For details on exclusion control of data, refer to <a class="reference internal" href="ExclusionControl.html"><em>Exclusive Control</em></a>.</div>
</div>
</div>
<div class="section" id="about-exception-handling">
<h3><a class="toc-backref" href="#id11">5.1.1.5. About exception handling</a><a class="headerlink" href="#about-exception-handling" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">In Spring Framework, a function is provided to convert JDBC exception (<tt class="docutils literal"><span class="pre">java.sql.SQLException</span></tt>) and O/R Mapper specific exception to data access exception (subclass of (<tt class="docutils literal"><span class="pre">org.springframework.dao.DataAccessException</span></tt>) provided by Spring Framework.</div>
<div class="line">For the class which is converted to data access exception of Spring Framework, refer to <a class="reference internal" href="#appendix-dataaccessexception-converter-class-label"><em>Classes provided by Spring Framework for converting to data access exception</em></a> of Appendix.</div>
</div>
<div class="line-block">
<div class="line">The converted data access exception need not be handled in application code; however, some errors (such as unique constraint violation, exclusion error etc.) need to be handled as per the requirements.</div>
<div class="line">When handling data access exception, exception of subclass notifying error details should be caught instead of <tt class="docutils literal"><span class="pre">DataAccessException</span></tt>.</div>
<div class="line">Typical subclasses which are likely to be handled in application code are as follows:</div>
</div>
<blockquote>
<div><table border="1" class="docutils">
<caption><strong>Subclasses of DB access exception, which are likely to be handled</strong></caption>
<colgroup>
<col width="10%" />
<col width="35%" />
<col width="55%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Class name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.dao.</div>
<div class="line">DuplicateKeyException</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Exception that occurs in case of unique constraint violation.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.dao.</div>
<div class="line">OptimisticLockingFailureException</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Exception that occurs in case of optimistic locking failure. It occurs when same data is updated with different logic.</div>
<div class="line">This exception occurs when JPA is used as O/R Mapper. Mybatis does not have optimistic locking function; hence this exception does not occur from O/R Mapper.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.dao.</div>
<div class="line">PessimisticLockingFailureException</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Exception that occurs in case of pessimistic locking failure. It occurs when same data is locked with different logic and the lock is not released even after &#8220;waiting for unlocking&#8221; timeout period has elapsed.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>When optimistic locking is to be implemented using Mybatis in O/R Mapper, it should be implemented as Service or Repository process.</p>
<p>As a method of notifying the optimistic locking failure to Controller, this guideline recommends generation of <tt class="docutils literal"><span class="pre">OptimisticLockingFailureException</span></tt> and exception of its child class.</p>
<p class="last">This is to make implementation of application layer (implementation of Controller) independent of O/R Mapper to be used.</p>
</div>
</div></blockquote>
<blockquote id="data-access-common-todo-exception">
<div><div class="admonition-todo admonition" id="index-1">
<p class="first admonition-title">Todo</p>
<p><strong>It has been recently found that using JPA (Hibernate) results in occurrence of unexpected errors.</strong></p>
<ul class="last simple">
<li>In case of unique constraint violation, <tt class="docutils literal"><span class="pre">org.springframework.dao.DataIntegrityViolationException</span></tt> occurs and not <tt class="docutils literal"><span class="pre">DuplicateKeyException</span></tt>.</li>
</ul>
</div>
</div></blockquote>
<p>See the example below for handling unique constraint violation as business exception.</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="k">try</span> <span class="o">{</span>
    <span class="n">accountRepository</span><span class="o">.</span><span class="na">saveAndFlash</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">DuplicateKeyException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// (1)</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">BusinessException</span><span class="o">(</span><span class="n">ResultMessages</span><span class="o">.</span><span class="na">error</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;e.xx.xx.0002&quot;</span><span class="o">),</span> <span class="n">e</span><span class="o">);</span> <span class="c1">// (2)</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Exception (DuplicateKeyException) that occurs in case of unique constraint violation is caught.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Business exception indicating that there is duplicate data is thrown.</div>
<div class="line">When exception is caught, make sure to specify the cause of exception (<tt class="docutils literal"><span class="pre">e</span></tt>) in business exception.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="about-multiple-datasources">
<h3><a class="toc-backref" href="#id12">5.1.1.6. About multiple datasources</a><a class="headerlink" href="#about-multiple-datasources" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Multiple datasources may be required depending on the application.</div>
<div class="line">Typical cases wherein multiple datasources are required, are shown below.</div>
</div>
<blockquote>
<div><table border="1" class="docutils">
<caption><strong>Typical case where multiple datasources are required</strong></caption>
<colgroup>
<col width="10%" />
<col width="30%" />
<col width="30%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Case</th>
<th class="head">Example</th>
<th class="head">Feature</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>When database and schema are divided according to data (tables).</td>
<td>When group of tables maintaining customer information and group of tables maintaining invoice information are stored in separate database and schema.</td>
<td>The data to be handled in the process is fixed; hence the datasource to be used can be defined statically.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>When database and schema to be used are divided according to users (login users).</td>
<td>When database and schema are divided according to users (Multitenant etc.).</td>
<td>The datasource to be used differs depending on users; hence the datasource to be used dynamically can be defined.</td>
</tr>
</tbody>
</table>
<div class="admonition-todo admonition" id="index-2">
<span id="data-access-common-todo-multiple-datasource-overview"></span><p class="first admonition-title">Todo</p>
<p><strong>TBD</strong></p>
<p>The following details will be added in future.</p>
<ul class="last simple">
<li>Conceptual diagram</li>
<li>Details of above two cases
Especially, in case (1), transaction management method is likely to change depending on processing pattern (such as DB update using multiple datasources; DB update using only a single datasource, DB read only, no concurrent access etc.); hence plan to break down considering all these aspects.</li>
</ul>
</div>
</div></blockquote>
</div>
<div class="section" id="about-common-library-classes">
<h3><a class="toc-backref" href="#id13">5.1.1.7. About common library classes</a><a class="headerlink" href="#about-common-library-classes" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Common library provides classes that carry out following processes.</div>
<div class="line">For more details about common library, refer to links given below.</div>
</div>
<ul class="simple">
<li><a class="reference internal" href="#data-access-common-appendix-like-escape"><em>Escaping during LIKE search</em></a></li>
<li><a class="reference internal" href="#data-access-common-appendix-sequencer"><em>About Sequencer</em></a></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="how-to-use">
<h2><a class="toc-backref" href="#id14">5.1.2. How to use</a><a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h2>
<div class="section" id="datasource-settings">
<span id="data-access-common-howtouse-datasource"></span><h3><a class="toc-backref" href="#id15">5.1.2.1. Datasource settings</a><a class="headerlink" href="#datasource-settings" title="Permalink to this headline">¶</a></h3>
<div class="section" id="settings-when-using-datasource-defined-in-application-server">
<h4><a class="toc-backref" href="#id16">5.1.2.1.1. Settings when using DataSource defined in Application Server</a><a class="headerlink" href="#settings-when-using-datasource-defined-in-application-server" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">When using datasource defined in Application Server, it is necessary to perform settings in Bean definition file to register the object fetched through JNDI as a bean.</div>
<div class="line">Settings when PostgreSQL is used as database and Tomcat7 is used as Application Server are given below.</div>
</div>
<ul>
<li><p class="first"><tt class="file docutils literal"><span class="pre">xxx-context.xml</span></tt> (Tomcat config file)</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;Resource</span>
   <span class="na">type=</span><span class="s">&quot;javax.sql.DataSource&quot;</span>
   <span class="na">name=</span><span class="s">&quot;jdbc/SampleDataSource&quot;</span>
   <span class="na">driverClassName=</span><span class="s">&quot;org.postgresql.Driver&quot;</span>
   <span class="na">url=</span><span class="s">&quot;jdbc:postgresql://localhost:5432/terasoluna&quot;</span>
   <span class="na">username=</span><span class="s">&quot;postgres&quot;</span>
   <span class="na">password=</span><span class="s">&quot;postgres&quot;</span>
   <span class="na">defaultAutoCommit=</span><span class="s">&quot;false&quot;</span>
   <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first"><tt class="file docutils literal"><span class="pre">xxx-env.xml</span></tt></p>
</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;jee:jndi-lookup</span> <span class="na">id=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">jndi-name=</span><span class="s">&quot;jdbc/SampleDataSource&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="10%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Attribute name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>-</td>
<td>Define datasource.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td>type</td>
<td>Specify resource type. Specify <tt class="docutils literal"><span class="pre">javax.sql.DataSource</span></tt>.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td>name</td>
<td>Specify resource name. The name specified here is JNDI name.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td>driverClassName</td>
<td>Specify JDBC driver class. In the example, JDBC driver class provided by PostgreSQL is specified.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td>url</td>
<td>Specify URL. [Needs to be changed as per environment]</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td>username</td>
<td>Specify user name. [Needs to be changed as per environment]</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td>password</td>
<td>Specify password of user. [Needs to be changed as per environment]</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td>defaultAutoCommit</td>
<td>Specify default value of auto commit flag. Specify &#8216;false&#8217;. It is forcibly set to &#8216;false&#8217; when it is under Transaction Management.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>-</td>
<td><div class="first last line-block">
<div class="line">In case of Tomcat7, tomcat-jdbc-pool is used if factory attribute is omitted.</div>
<div class="line">For more details about settings, refer to <a class="reference external" href="http://tomcat.apache.org/tomcat-7.0-doc/jdbc-pool.html#Attributes">Attributes of The Tomcat JDBC Connection Pool</a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>-</td>
<td>Specify JNDI name of datasource. In case of Tomcat, specify the value specified in resource name &#8220;(1)-name&#8221; at the time of defining datasource.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="settings-when-using-datasource-for-which-bean-is-defined">
<h4><a class="toc-backref" href="#id17">5.1.2.1.2. Settings when using DataSource for which Bean is defined</a><a class="headerlink" href="#settings-when-using-datasource-for-which-bean-is-defined" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">When using datasource of OSS/Third-Party library or JDBC datasource of Spring Framework without using the datasource provided by Application Server,</div>
<div class="line">bean for DataSource class needs to be defined in Bean definition file.</div>
<div class="line">Settings when PostgreSQL is used as database and Apache Commons DBCP is used as datasource are given below.</div>
</div>
<ul class="simple">
<li><tt class="file docutils literal"><span class="pre">xxx-env.xml</span></tt></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">class=</span><span class="s">&quot;org.apache.commons.dbcp2.BasicDataSource&quot;</span>
    <span class="na">destroy-method=</span><span class="s">&quot;close&quot;</span><span class="nt">&gt;</span>                                           <span class="c">&lt;!-- (1) (8) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;driverClassName&quot;</span> <span class="na">value=</span><span class="s">&quot;org.postgresql.Driver&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;url&quot;</span> <span class="na">value=</span><span class="s">&quot;jdbc:postgresql://localhost:5432/terasoluna&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span> <span class="na">value=</span><span class="s">&quot;postgres&quot;</span> <span class="nt">/&gt;</span>                     <span class="c">&lt;!-- (4) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">value=</span><span class="s">&quot;postgres&quot;</span> <span class="nt">/&gt;</span>                     <span class="c">&lt;!-- (5) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultAutoCommit&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>               <span class="c">&lt;!-- (6) --&gt;</span>
    <span class="c">&lt;!-- (7) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Specify implementation class of datasource. In the example, datasource class (<tt class="docutils literal"><span class="pre">org.apache.commons.dbcp2.BasicDataSource</span></tt>) provided by Apache Commons DBCP is specified.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>Specify JDBC driver class. In the example, JDBC driver class provided by PostgreSQL is specified.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>Specify URL. [Needs to be changed as per environment]</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td>Specify user name. [Needs to be changed as per environment]</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td>Specify password of user. [Needs to be changed as per environment]</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td>Specify default value of auto commit flag. Specify &#8216;false&#8217;. It is forcibly set to &#8216;false&#8217; when it is under Transaction Management.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In BasicDataSource, configuration values common in JDBC, JDBC driver specific properties values, connection pooling configuration values can be specified other than the values mentioned above.</div>
<div class="line">For more details about settings, refer to <a class="reference external" href="http://commons.apache.org/proper/commons-dbcp/configuration.html">DBCP Configuration</a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In the example, values are specified directly; however, for fields where configuration values change with the environment, actual configuration values should be specified in properties file using Placeholder(${...}).</div>
<div class="line">For Placeholder, refer to <tt class="docutils literal"><span class="pre">PropertyPlaceholderConfigurer</span></tt> of <a class="reference external" href="http://docs.spring.io/spring/docs/4.1.4.RELEASE/spring-framework-reference/html/beans.html#beans-factory-extension-factory-postprocessors">Spring Reference Document</a>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="settings-to-enable-transaction-management">
<h3><a class="toc-backref" href="#id18">5.1.2.2. Settings to enable transaction management</a><a class="headerlink" href="#settings-to-enable-transaction-management" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">For basic settings to enable transaction management, refer to <a class="reference internal" href="../ImplementationAtEachLayer/DomainLayer.html#service-enable-transaction-management"><em>Settings for using transaction management</em></a> of <a class="reference internal" href="../ImplementationAtEachLayer/DomainLayer.html"><em>Domain Layer Implementation</em></a>.</div>
<div class="line">For PlatformTransactionManager, the class to be used changes depending on the O/R Mapper used; hence for detailed settings, refer to <a class="reference internal" href="DataAccessJpa.html"><em>Database Access (JPA)</em></a>.</div>
</div>
</div>
<div class="section" id="jdbc-debug-log-settings">
<h3><a class="toc-backref" href="#id19">5.1.2.3. JDBC debug log settings</a><a class="headerlink" href="#jdbc-debug-log-settings" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">When more detailed information than the log output using O/R Mapper(Hibernate, MyBatis) is required, the information output using log4jdbc(log4jdbc-remix) can be used.</div>
<div class="line">For details on log4jdbc, refer to <a class="reference external" href="https://code.google.com/p/log4jdbc/">log4jdbc project page</a>.</div>
<div class="line">For details on log4jdbc-remix, refer to <a class="reference external" href="https://code.google.com/p/log4jdbc-remix/">log4jdbc-remix project page</a>.</div>
</div>
<dl class="docutils">
<dt></dt>
<dd><div class="first last admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><strong>This is a debug setting; hence it should not be performed in case of applications that are to be released in performance test environment or production environment.</strong></p>
</div>
</dd>
</dl>
<div class="section" id="settings-related-to-datasource-provided-by-log4jdbc">
<h4><a class="toc-backref" href="#id20">5.1.2.3.1. Settings related to datasource provided by log4jdbc</a><a class="headerlink" href="#settings-related-to-datasource-provided-by-log4jdbc" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><tt class="file docutils literal"><span class="pre">xxx-env.xml</span></tt></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;jee:jndi-lookup</span> <span class="na">id=</span><span class="s">&quot;dataSourceSpied&quot;</span> <span class="na">jndi-name=</span><span class="s">&quot;jdbc/SampleDataSource&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">class=</span><span class="s">&quot;net.sf.log4jdbc.Log4jdbcProxyDataSource&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">ref=</span><span class="s">&quot;dataSourceSpied&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Define actual datasource. In the example, the datasource fetched through JNDI from Application Server is being used.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>Specify <tt class="docutils literal"><span class="pre">net.sf.log4jdbc.Log4jdbcProxyDataSource</span></tt> provided by log4jdbc.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>In constructor, specify bean which is an actual datasource.</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>When the application is to be released in performance test environment or production environment, Log4jdbcProxyDataSource should not be used as datasource.</strong></p>
<p class="last">Specifically, exclude settings of (2) and (3) and change bean name of <tt class="docutils literal"><span class="pre">&quot;dataSourceSpied&quot;</span></tt> to <tt class="docutils literal"><span class="pre">&quot;dataSource&quot;</span></tt>.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="log4jdbc-logger-settings">
<h4><a class="toc-backref" href="#id21">5.1.2.3.2. log4jdbc logger settings</a><a class="headerlink" href="#log4jdbc-logger-settings" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><tt class="file docutils literal"><span class="pre">logback.xml</span></tt></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;jdbc.sqltiming&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;debug&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/logger&gt;</span>

<span class="c">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;jdbc.sqlonly&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;warn&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/logger&gt;</span>

<span class="c">&lt;!-- (3) --&gt;</span>
<span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;jdbc.audit&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;warn&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/logger&gt;</span>

<span class="c">&lt;!-- (4) --&gt;</span>
<span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;jdbc.connection&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;warn&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/logger&gt;</span>

<span class="c">&lt;!-- (5) --&gt;</span>
<span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;jdbc.resultset&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;warn&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/logger&gt;</span>

<span class="c">&lt;!-- (6) --&gt;</span>
<span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;jdbc.resultsettable&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;debug&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/logger&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Logger to output SQL execution time and SQL statement wherein the value is set in bind variable. Since this SQL contains values for bind variables, it can be executed using DB access tool.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Logger to output SQL statement wherein the value is set in bind variable. The difference with (1) is that SQL execution time is not output.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Logger to exclude ResultSet interface, call methods of JDBC interface and to output arguments and return values. This log is useful for analyzing the JDBC related issues; however volume of the output log is large.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Logger to output connected/disconnected events and number of connections in use. This log is useful for analyzing connection leak, but it need not be output unless there is connection leak issue.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Logger to call methods of ResultSet interface and output arguments and return values. This log is useful during analysis when actual result differs from expected result; however volume of the output log is large.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Logger to output the contents of ResultSet by converting them into a format so that they can be easily verified. This log is useful during analysis when actual result differs from expected result; however volume of the output log is large.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Large amount of log is output depending on the type of logger; hence only the required logger should be defined or output.</strong></p>
<p>In the above sample, log level for loggers which output very useful logs during development, is set to <tt class="docutils literal"><span class="pre">&quot;debug&quot;</span></tt>.
As for other loggers, the log level needs to be set to <tt class="docutils literal"><span class="pre">&quot;debug&quot;</span></tt> whenever required.</p>
<p><strong>When the application is to be released in performance test environment or production environment, log using log4jdbc logger should not be output at the time of normal end of process.</strong></p>
<p class="last">Typically log level should be set to <tt class="docutils literal"><span class="pre">&quot;warn&quot;</span></tt>.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="settings-of-log4jdbc-option">
<h4><a class="toc-backref" href="#id22">5.1.2.3.3. Settings of log4jdbc option</a><a class="headerlink" href="#settings-of-log4jdbc-option" title="Permalink to this headline">¶</a></h4>
<p>Default operations of log4jdbc can be customized by placing properties file <tt class="file docutils literal"><span class="pre">log4jdbc.properties</span></tt>under class path.</p>
<ul class="simple">
<li><tt class="file docutils literal"><span class="pre">log4jdbc.properties</span></tt></li>
</ul>
<blockquote>
<div><div class="highlight-properties"><div class="highlight"><pre><span class="c"># (1)</span>
<span class="na">log4jdbc.dump.sql.maxlinelength</span><span class="o">=</span><span class="s">0</span>
<span class="c"># (2)</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Specify word-wrap setting for SQL statement. If &#8216;0&#8217; is specified, SQL statement is not wrapped.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>For option details, refer to <a class="reference external" href="https://code.google.com/p/log4jdbc/#Options">log4jdbc project page</a>.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="how-to-extend">
<h2><a class="toc-backref" href="#id23">5.1.3. How to extend</a><a class="headerlink" href="#how-to-extend" title="Permalink to this headline">¶</a></h2>
<div class="section" id="settings-for-using-multiple-datasources">
<h3><a class="toc-backref" href="#id24">5.1.3.1. Settings for using multiple datasources</a><a class="headerlink" href="#settings-for-using-multiple-datasources" title="Permalink to this headline">¶</a></h3>
<div class="admonition-todo admonition" id="index-3">
<span id="data-access-common-todo-multiple-datasource-howtoextends"></span><p class="first admonition-title">Todo</p>
<p><strong>TBD</strong></p>
<p>Following details will be added in future.</p>
<ul class="last simple">
<li>Example of settings based on notes to be considered while using multiple datasources</li>
<li>Example of implementation if it is getting impacted</li>
</ul>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="how-to-resolve-the-problem">
<h2><a class="toc-backref" href="#id25">5.1.4. How to resolve the problem</a><a class="headerlink" href="#how-to-resolve-the-problem" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="how-to-resolve-n-1">
<span id="data-access-common-howtosolve-n-plus-1"></span><h3><a class="toc-backref" href="#id26">5.1.4.1. How to resolve N+1</a><a class="headerlink" href="#how-to-resolve-n-1" title="Permalink to this headline">¶</a></h3>
<p>N+1 occurs when more number of SQL statements need to be executed in accordance with the number of records to be fetched from the database. This problem causes high load on the database and deteriorates response time.</p>
<p>Details are given below.</p>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../_images/dataaccess_common-n_plus_1.png"><img alt="about N+1 Problem" src="../_images/dataaccess_common-n_plus_1.png" style="width: 90%;" /></a>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Search the records matching the search conditions from MainTable.</div>
<div class="line">In the above example, col1 of MainTable fetches <tt class="docutils literal"><span class="pre">'Foo'</span></tt> records and the total records fetched are 20.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">For each record searched in (1), related records are fetched from SubTable.</div>
<div class="line">In the above example, the id column of SubTable fetches the same records as the id column of records fetched in (1).</div>
<div class="line"><strong>This SQL is executed for number of records fetched in (1).</strong></div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">In the above example, <strong>SQL is executed totally 21 times.</strong></div>
<div class="line">Supposing there are 3 SubTables, <strong>SQL is executed totally 61 times; hence countermeasures are required.</strong></div>
</div>
</div></blockquote>
<p>Typical example to resolve N+1 is given below.</p>
<div class="section" id="resolving-n-1-using-joins-join-fetch">
<h4><a class="toc-backref" href="#id27">5.1.4.1.1. Resolving N+1 using JOINs (Join Fetch)</a><a class="headerlink" href="#resolving-n-1-using-joins-join-fetch" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">By performing JOIN on SubTable and MainTable, records of MainTable and SubTable are fetched by executing SQL once.</div>
<div class="line">When relation of MainTable and SubTable is 1:1, check whether N+1 can be resolved using this method.</div>
</div>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../_images/dataaccess_common-n_plus_1_solve_join.png"><img alt="about solve N+1 Problem using JOIN" src="../_images/dataaccess_common-n_plus_1_solve_join.png" style="width: 90%;" /></a>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When searching records matching the search conditions, the records are fetched in batch from MainTable and SubTable, by performing JOIN on SubTable.</div>
<div class="line">In the above example, col1 of MainTable collectively fetches <tt class="docutils literal"><span class="pre">'Foo'</span></tt> records and records of SubTable that match the id of the records matching with search conditions.</div>
<div class="line">When there are duplicate column names, it is necessary to assign alias name in order to identify the table to which that column belongs.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">If JOIN (Join Fetch) is used, <strong>all the required data can be fetched by executing SQL once.</strong></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>When performing JOIN by JPQL</strong></p>
<p class="last">For example of performing JOIN using JPQL, refer to <a class="reference internal" href="DataAccessJpa.html#data-access-jpa-howtouse-join-fetch"><em>JOIN FETCH</em></a>.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>When relation with SubTable is 1:N, the problem can be resolved using JOIN (Join Fetch); however the following points should be noted.</p>
<ul class="last simple">
<li>When JOIN is performed on records having 1:N relation, unnecessary data is fetched depending on the number of records in SubTable.
For details, refer to <a class="reference internal" href="DataAccessMyBatis3.html#dataaccessmybatis3appendixacquirerelatedobjectswarningsqlmapping"><em>Notes during collective fetch</em></a>.</li>
<li>When using JPA (Hibernate), if N portions in 1:N are multiple, then it is necessary to use <tt class="docutils literal"><span class="pre">java.util.Set</span></tt> instead of <tt class="docutils literal"><span class="pre">java.util.List</span></tt> as a collection type storage N portion.</li>
</ul>
</div>
</div></blockquote>
</div>
<div class="section" id="resolving-n-1-by-fetching-related-records-in-batch">
<h4><a class="toc-backref" href="#id28">5.1.4.1.2. Resolving N+1 by fetching related records in batch</a><a class="headerlink" href="#resolving-n-1-by-fetching-related-records-in-batch" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">There are cases where, it has proved better when the related records are fetched in batch for patterns with multiple 1:N relations etc.; and then sorted by programming.</div>
<div class="line">When relation with SubTable is 1:N, analyze whether the problem can be resolved using this method.</div>
</div>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../_images/dataaccess_common-n_plus_1_solve_programing.png"><img alt="about solve N+1 Problem using programing" src="../_images/dataaccess_common-n_plus_1_solve_programing.png" style="width: 90%;" /></a>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Search the records matching the search conditions from MainTable.</div>
<div class="line">In the above example, col1 of MainTable fetches <tt class="docutils literal"><span class="pre">'Foo'</span></tt> records and the total records fetched are 20.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">For each record searched in (1), related records are fetched from SubTable.</div>
<div class="line">Related records are not fetched one by one; but the records matching the foreign key of each record fetched in (1), are fetched in batch.</div>
<div class="line">In the above example, id column of SubTable collectively fetches same records as id column of records fetched in (1) using IN clause.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">SubTable records fetched in (2) sorted and merged with records fetched in (1).</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">In the above example, <strong>all the required data can be fetched by executing SQL twice.</strong></div>
<div class="line">Even supposing there are 3 SubTables, <strong>SQL needs to be executed totally 4 times.</strong></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This method has a special feature. It can fetch only the required data by optimizing SQL execution.
It is necessary to sort SubTable records by programming; however when there are many SubTables or when number of N records in 1:N is more, there are cases wherein it is better to resolve the problem using this method.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="appendix">
<h2><a class="toc-backref" href="#id29">5.1.5. Appendix</a><a class="headerlink" href="#appendix" title="Permalink to this headline">¶</a></h2>
<div class="section" id="escaping-during-like-search">
<span id="data-access-common-appendix-like-escape"></span><h3><a class="toc-backref" href="#id30">5.1.5.1. Escaping during LIKE search</a><a class="headerlink" href="#escaping-during-like-search" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">While performing LIKE search, the values to be used as search conditions need to be escaped.</div>
<div class="line">Escaping for LIKE search can be done using methods of <tt class="docutils literal"><span class="pre">org.terasoluna.gfw.common.query.QueryEscapeUtils</span></tt> class provided by common library.</div>
</div>
<div class="section" id="specifications-of-escaping-of-common-library">
<h4><a class="toc-backref" href="#id31">5.1.5.1.1. Specifications of escaping of common library</a><a class="headerlink" href="#specifications-of-escaping-of-common-library" title="Permalink to this headline">¶</a></h4>
<p>Specifications of escaping provided by common library are as follows:</p>
<ul class="simple">
<li>Escape character is <tt class="docutils literal"><span class="pre">&quot;~&quot;</span></tt> .</li>
<li>Characters to be escaped are 4, namely <tt class="docutils literal"><span class="pre">&quot;%&quot;</span></tt> , <tt class="docutils literal"><span class="pre">&quot;_&quot;</span></tt> , <tt class="docutils literal"><span class="pre">&quot;％&quot;</span></tt> , <tt class="docutils literal"><span class="pre">&quot;＿&quot;</span></tt> .</li>
</ul>
<p>See the example of escaping below.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="15%" />
<col width="25%" />
<col width="10%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Target string</th>
<th class="head">String after escaping</th>
<th class="head">Escape flag</th>
<th class="head">Explanation</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><tt class="docutils literal"><span class="pre">&quot;a&quot;</span></tt></td>
<td><tt class="docutils literal"><span class="pre">&quot;a&quot;</span></tt></td>
<td>OFF</td>
<td>Escaping not done as the string does not contain character to be escaped.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><tt class="docutils literal"><span class="pre">&quot;a~&quot;</span></tt></td>
<td><tt class="docutils literal"><span class="pre">&quot;a~~&quot;</span></tt></td>
<td>ON</td>
<td>Escaping done as the string contains escape character.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><tt class="docutils literal"><span class="pre">&quot;a%&quot;</span></tt></td>
<td><tt class="docutils literal"><span class="pre">&quot;a~%&quot;</span></tt></td>
<td>ON</td>
<td>Escaping done as the string contains character to be escaped.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td><tt class="docutils literal"><span class="pre">&quot;a_&quot;</span></tt></td>
<td><tt class="docutils literal"><span class="pre">&quot;a~_&quot;</span></tt></td>
<td>ON</td>
<td>Similar to No.3.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td><tt class="docutils literal"><span class="pre">&quot;_a%&quot;</span></tt></td>
<td><tt class="docutils literal"><span class="pre">&quot;~_a~%&quot;</span></tt></td>
<td>ON</td>
<td>Escaping done as the string contains characters to be escaped. When there are multiple characters to be escaped, escaping is done for all characters.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td><tt class="docutils literal"><span class="pre">&quot;a％&quot;</span></tt></td>
<td><tt class="docutils literal"><span class="pre">&quot;a~％&quot;</span></tt></td>
<td>ON</td>
<td>Similar to No.3.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="7">
<li></li>
</ol>
</td>
<td><tt class="docutils literal"><span class="pre">&quot;a＿&quot;</span></tt></td>
<td><tt class="docutils literal"><span class="pre">&quot;a~＿&quot;</span></tt></td>
<td>ON</td>
<td>Similar to No.3.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="8">
<li></li>
</ol>
</td>
<td><tt class="docutils literal"><span class="pre">&quot;</span> <span class="pre">&quot;</span></tt></td>
<td><tt class="docutils literal"><span class="pre">&quot;</span> <span class="pre">&quot;</span></tt></td>
<td>OFF</td>
<td>Similar to No.1.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="9">
<li></li>
</ol>
</td>
<td><tt class="docutils literal"><span class="pre">&quot;&quot;</span></tt></td>
<td><tt class="docutils literal"><span class="pre">&quot;&quot;</span></tt></td>
<td>OFF</td>
<td>Similar to No.1.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="10">
<li></li>
</ol>
</td>
<td><tt class="docutils literal"><span class="pre">null</span></tt></td>
<td><tt class="docutils literal"><span class="pre">null</span></tt></td>
<td>OFF</td>
<td>Similar to No.1.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="about-escaping-methods-provided-by-common-library">
<h4><a class="toc-backref" href="#id32">5.1.5.1.2. About escaping methods provided by common library</a><a class="headerlink" href="#about-escaping-methods-provided-by-common-library" title="Permalink to this headline">¶</a></h4>
<p>List of escaping methods of <tt class="docutils literal"><span class="pre">QueryEscapeUtils</span></tt> class provided by common library is given below.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="35%" />
<col width="55%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Method name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>toLikeCondition(String)</td>
<td><div class="first last line-block">
<div class="line">String passed as an argument is escaped for LIKE search.</div>
<div class="line">When specifying type of matching (Forward match, Backward match and Partial match) at SQL or JPQL side, perform only escaping using this method.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>toStartingWithCondition(String)</td>
<td><div class="first last line-block">
<div class="line">After escaping a string passed as an argument for LIKE search, assign <tt class="docutils literal"><span class="pre">&quot;%&quot;</span></tt> at the end of the string after escaping.</div>
<div class="line">This method is used in order to convert into a value for Forward match search.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>toEndingWithCondition(String)</td>
<td><div class="first last line-block">
<div class="line">After escaping a string passed as an argument for LIKE search, assign <tt class="docutils literal"><span class="pre">&quot;%&quot;</span></tt> at the beginning of the string after escaping.</div>
<div class="line">This method is used in order to convert into a value for Backward match search.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>toContainingCondition(String)</td>
<td><div class="first last line-block">
<div class="line">After escaping a string passed as an argument for LIKE search, assign <tt class="docutils literal"><span class="pre">&quot;%&quot;</span></tt> at the beginning and end of the string after escaping.</div>
<div class="line">This method is used in order to convert into a value for Partial match search.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Methods of No.2, 3, 4 are used when specifying the type of matching (Forward match, Backward match and Partial match) at program side and not at SQL or JPQL side.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="how-to-use-common-library">
<h4><a class="toc-backref" href="#id33">5.1.5.1.3. How to use common library</a><a class="headerlink" href="#how-to-use-common-library" title="Permalink to this headline">¶</a></h4>
<p>For example of escaping at the time of LIKE search, refer to Document for O/R Mapper to be used.</p>
<ul class="simple">
<li>When using JPA (Spring Data JPA), refer to <a class="reference internal" href="DataAccessJpa.html#data-access-jpa-howtouse-like-escape"><em>Escaping at the time of LIKE search</em></a>of <a class="reference internal" href="DataAccessJpa.html"><em>Database Access (JPA)</em></a>.</li>
</ul>
</div>
</div>
<div class="section" id="about-sequencer">
<span id="data-access-common-appendix-sequencer"></span><h3><a class="toc-backref" href="#id34">5.1.5.2. About Sequencer</a><a class="headerlink" href="#about-sequencer" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Sequencer is a common library for fetching sequence value.</div>
<div class="line">Use the sequence value fetched from Sequencer as a configuration value of primary key column of the database.</div>
</div>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Reason for creating Sequencer as a common library</strong></p>
<p>The reason for creating Sequencer is that there is no mechanism to format the sequence value as string in ID generator functionality of JPA.
In actual application development, sometimes the formatted string is also set as primary key; hence Sequencer is provided as common library.</p>
<p>When value set as primary key is number, it is recommended to use ID generator functionality of JPA. For ID generator functionality of JPA, refer to <a class="reference internal" href="DataAccessJpa.html#data-access-jpa-how-to-use-way-to-add-entity"><em>How to add entities</em></a> of <a class="reference internal" href="DataAccessJpa.html"><em>Database Access (JPA)</em></a>.</p>
<p class="last">The primary objective of creating Sequencer is to supplement functions which are not supported by JPA; but it can also be used when sequence value is required in the processes not relating to JPA.</p>
</div>
</div></blockquote>
<div class="section" id="about-classes-provided-by-common-library">
<h4><a class="toc-backref" href="#id35">5.1.5.2.1. About classes provided by common library</a><a class="headerlink" href="#about-classes-provided-by-common-library" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">List of classes of Sequencer functionality of common library is as follows:</div>
<div class="line">For usage example, refer to <a class="reference internal" href="#data-access-common-howtouse-sequencer"><em>How to use common library</em></a> of How to use.</div>
</div>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="30%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Class name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">org.terasoluna.gfw.common.sequencer.</div>
<div class="line">Sequencer</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Interface that defines the method to fetch subsequent sequence value (getNext) and method to return current sequence value (getCurrent).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">org.terasoluna.gfw.common.sequencer.</div>
<div class="line">JdbcSequencer</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implementation class of <tt class="docutils literal"><span class="pre">Sequencer</span></tt>  interface for JDBC.</div>
<div class="line">This class is used to fetch sequence value by executing SQL in the database.</div>
<div class="line">For this class, it is assumed that values are fetched from sequence object of the database; however it is also possible to fetch the values from other than sequence object by calling function stored in the database.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="data-access-common-howtouse-sequencer">
<span id="id2"></span><h4><a class="toc-backref" href="#id36">5.1.5.2.2. How to use common library</a><a class="headerlink" href="#data-access-common-howtouse-sequencer" title="Permalink to this headline">¶</a></h4>
<p>Define a bean for Sequencer.</p>
<ul class="simple">
<li><tt class="file docutils literal"><span class="pre">xxx-infra.xml</span></tt></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;articleIdSequencer&quot;</span> <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.sequencer.JdbcSequencer&quot;</span><span class="nt">&gt;</span>
     <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span> <span class="nt">/&gt;</span>
     <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;sequenceClass&quot;</span> <span class="na">value=</span><span class="s">&quot;java.lang.String&quot;</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!-- (4) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;nextValueQuery&quot;</span>
        <span class="na">value=</span><span class="s">&quot;SELECT TO_CHAR(NEXTVAL(&#39;seq_article&#39;),&#39;AFM0000000000&#39;)&quot;</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!-- (5) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;currentValueQuery&quot;</span>
        <span class="na">value=</span><span class="s">&quot;SELECT TO_CHAR(CURRVAL(&#39;seq_article&#39;),&#39;AFM0000000000&#39;)&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define a bean for class that implements <tt class="docutils literal"><span class="pre">org.terasoluna.gfw.common.sequencer.Sequencer</span></tt>.</div>
<div class="line">In the above example, (<tt class="docutils literal"><span class="pre">JdbcSequencer</span></tt>) class for fetching sequence value by executing SQL is specified.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the datasource for executing the SQL to fetch sequence value.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the type of sequence value to be fetched.</div>
<div class="line">In the above example, since conversion to string is done using SQL; <tt class="docutils literal"><span class="pre">java.lang.String</span></tt> type is specified.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify SQL for fetching subsequent sequence value.</div>
<div class="line">In the above example, sequence value fetched from sequence object of (PostgreSQL) database is formatted as string.</div>
<div class="line">When sequence value fetched from the database is <tt class="docutils literal"><span class="pre">1</span></tt>, <tt class="docutils literal"><span class="pre">&quot;A0000000001&quot;</span></tt> is returned as return value of <tt class="docutils literal"><span class="pre">Sequencer#getNext()</span></tt> method.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify SQL for fetching current sequence value.</div>
<div class="line">When sequence value fetched from the database is <tt class="docutils literal"><span class="pre">2</span></tt>, <tt class="docutils literal"><span class="pre">&quot;A0000000002&quot;</span></tt> is returned as return value of <tt class="docutils literal"><span class="pre">Sequencer#getCurrent()</span></tt> method.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Fetch sequence value from Sequencer for which bean is defined.</p>
<ul class="simple">
<li>Service</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="c1">// omitted</span>

<span class="c1">// (1)</span>
<span class="nd">@Inject</span>
<span class="nd">@Named</span><span class="o">(</span><span class="s">&quot;articleIdSequencer&quot;</span><span class="o">)</span> <span class="c1">// (2)</span>
<span class="n">Sequencer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">articleIdSequencer</span><span class="o">;</span>

<span class="c1">// omitted</span>

<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="n">Article</span> <span class="nf">createArticle</span><span class="o">(</span><span class="n">Article</span> <span class="n">inputtedArticle</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">String</span> <span class="n">articleId</span> <span class="o">=</span> <span class="n">articleIdSequencer</span><span class="o">.</span><span class="na">getNext</span><span class="o">();</span> <span class="c1">// (3)</span>
    <span class="n">inputtedArticle</span><span class="o">.</span><span class="na">setArticleId</span><span class="o">(</span><span class="n">articleId</span><span class="o">);</span>

    <span class="n">Article</span> <span class="n">savedArticle</span> <span class="o">=</span> <span class="n">articleRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">inputtedArticle</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">savedArticle</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Inject <tt class="docutils literal"><span class="pre">Sequencer</span></tt> object for which bean is defined.</div>
<div class="line">In the above example, since sequence value is fetched as formatted string, <tt class="docutils literal"><span class="pre">java.lang.String</span></tt> type is specified as generics type of <tt class="docutils literal"><span class="pre">Sequencer</span></tt>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify bean name of the bean to be injected in value attribute of <tt class="docutils literal"><span class="pre">&#64;javax.inject.Named</span></tt> annotation.</div>
<div class="line">In the above example, bean name (<tt class="docutils literal"><span class="pre">&quot;articleIdSequencer&quot;</span></tt>) defined in <tt class="file docutils literal"><span class="pre">xxx-infra.xml</span></tt> is specified.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Call <tt class="docutils literal"><span class="pre">Sequencer#getNext()</span></tt> method and fetch the subsequent sequence value.</div>
<div class="line">In the above example, fetched sequence value is used as Entity ID.</div>
<div class="line">When fetching current sequence value, call <tt class="docutils literal"><span class="pre">Sequencer#getCurrent()</span></tt> method.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">When <tt class="docutils literal"><span class="pre">Sequencer</span></tt> for which bean is defined is 1, <tt class="docutils literal"><span class="pre">&#64;Named</span></tt> annotation can be omitted. When specifying multiple sequencers, bean name needs to be specified using <tt class="docutils literal"><span class="pre">&#64;Named</span></tt> annotation.</p>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="classes-provided-by-spring-framework-for-converting-to-data-access-exception">
<span id="appendix-dataaccessexception-converter-class-label"></span><h3><a class="toc-backref" href="#id37">5.1.5.3. Classes provided by Spring Framework for converting to data access exception</a><a class="headerlink" href="#classes-provided-by-spring-framework-for-converting-to-data-access-exception" title="Permalink to this headline">¶</a></h3>
<p>Classes of Spring Framework which play a role in converting an exception to data access exception, are as follows:</p>
<blockquote>
<div><table border="1" class="docutils">
<caption><strong>Classes of Spring Framework for converting to data access exception</strong></caption>
<colgroup>
<col width="10%" />
<col width="33%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Class name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.jdbc.support.</div>
<div class="line">SQLErrorCodeSQLExceptionTranslator</div>
</div>
</td>
<td>When MyBatis or <tt class="docutils literal"><span class="pre">JdbcTemplate</span></tt> is used, JDBC exception is converted to data access exception of Spring Framework using this class. Conversion rules are mentioned in XML file. XML file used by default is <tt class="docutils literal"><span class="pre">org/springframework/jdbc/support/sql-error-codes.xml</span></tt> in <tt class="docutils literal"><span class="pre">spring-jdbc.jar</span></tt>.
It is also possible to change the default behavior by placing XML file (<tt class="docutils literal"><span class="pre">sql-error-codes.xml</span></tt>) just below class path.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.orm.jpa.vendor.</div>
<div class="line">HibernateJpaDialect</div>
</div>
</td>
<td>When JPA (Hibernate implementation) is used, O/R Mapper exception(Hibernate exception) is converted to data access exception of Spring Framework using this class.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.orm.jpa.</div>
<div class="line">EntityManagerFactoryUtils</div>
</div>
</td>
<td>If an exception that can not be converted by <tt class="docutils literal"><span class="pre">HibernateJpaDialect</span></tt> has occurred, JPA exception is converted to data access exception of Spring Framework using this class.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">Sub classes of</div>
<div class="line">org.hibernate.dialect.Dialect</div>
</div>
</td>
<td>When JPA (Hibernate implementation) is used, exceptions are converted to JDBC exception and O/R Mapper exception using this class.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="jdbc-datasource-classes-provided-by-spring-framework">
<span id="appendix-datasource-of-spring-label"></span><h3><a class="toc-backref" href="#id38">5.1.5.4. JDBC datasource classes provided by Spring Framework</a><a class="headerlink" href="#jdbc-datasource-classes-provided-by-spring-framework" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Spring Framework provides implementation of JDBC datasource. However since they are very simple classes, they are rarely used in production environment.</div>
<div class="line">These classes are mainly used during Unit Testing.</div>
</div>
<blockquote>
<div><table border="1" class="docutils">
<caption><strong>JDBC datasource classes provided by Spring Framework</strong></caption>
<colgroup>
<col width="10%" />
<col width="35%" />
<col width="55%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Class name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.jdbc.datasource.</div>
<div class="line">DriverManagerDataSource</div>
</div>
</td>
<td>Datasource class for creating new connection by calling <tt class="docutils literal"><span class="pre">java.sql.DriverManager#getConnection</span></tt> when connection fetch request is received from the application.
When connection pooling is required, Application Server datasource or datasource of OSS/Third-Party library should be used.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.jdbc.datasource.</div>
<div class="line">SingleConnectionDataSource</div>
</div>
</td>
<td>Child class of <tt class="docutils literal"><span class="pre">DriverManagerDataSource</span></tt>.This class provides implementation of single shared connection. This is a datasource class for unit test which works with single thread.
Even in case of Unit Testing, if this class is used when datasource is to be accessed with multithread, care needs to be taken as it may not show the expected behavior.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.jdbc.datasource.</div>
<div class="line">SimpleDriverDataSource</div>
</div>
</td>
<td>Datasource class for creating new connection by calling <tt class="docutils literal"><span class="pre">java.sql.Driver#getConnection</span></tt> when connection fetch request is received from the application.
When connection pooling is required, Application Server datasource or datasource of OSS/Third-Party library should be used.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line">Spring Framework provides adapter classes with extended JDBC datasource operations.</div>
<div class="line">Specific adapter classes are introduced below.</div>
</div>
<blockquote>
<div><table border="1" class="docutils">
<caption><strong>JDBC datasource adapter classes provided by Spring Framework</strong></caption>
<colgroup>
<col width="10%" />
<col width="35%" />
<col width="55%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Class name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.jdbc.datasource.</div>
<div class="line">TransactionAwareDataSourceProxy</div>
</div>
</td>
<td>Adapter class for converting a datasource which does not store transactions, into a datasource storing Spring Framework transactions.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.jdbc.datasource.lookup.</div>
<div class="line">IsolationLevelDataSourceRoute</div>
</div>
</td>
<td>Adapter class for switching the datasource to be used based on independence level of an active transaction.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="DataAccessJpa.html" title="5.2. Database Access (JPA)"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="5. Architecture in Detail - TERASOLUNA Server Framework for Java (5.x)"
             >previous</a> |</li>
        <li><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.0.0-SNAPSHOT documentation</a> &raquo;</li>
          <li><a href="index.html" >5. Architecture in Detail - TERASOLUNA Server Framework for Java (5.x)</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013-2015, NTT DATA.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.Theme by <a href="http://github.com/vkvn">vkvn</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>