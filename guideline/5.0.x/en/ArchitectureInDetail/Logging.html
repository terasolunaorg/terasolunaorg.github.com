<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>5.6. Logging &mdash; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.0.0-SNAPSHOT documentation</title>
    
    <link rel="stylesheet" href="../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.0.0-SNAPSHOT',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.0.0-SNAPSHOT documentation" href="../index.html" />
    <link rel="up" title="5. Architecture in Detail - TERASOLUNA Server Framework for Java (5.x)" href="index.html" />
    <link rel="next" title="5.7. Exception Handling" href="ExceptionHandling.html" />
    <link rel="prev" title="5.5. Input Validation" href="Validation.html" /><script src="../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../_static/solarized-dark.css" rel="stylesheet">
<link href="../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ExceptionHandling.html" title="5.7. Exception Handling"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Validation.html" title="5.5. Input Validation"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.0.0-SNAPSHOT documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">5. Architecture in Detail - TERASOLUNA Server Framework for Java (5.x)</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">5.6. Logging</a><ul>
<li><a class="reference internal" href="#overview">5.6.1. Overview</a><ul>
<li><a class="reference internal" href="#types-of-logs">5.6.1.1. Types of Logs</a></li>
<li><a class="reference internal" href="#output-contents-of-log">5.6.1.2. Output contents of log</a></li>
<li><a class="reference internal" href="#log-output-points">5.6.1.3. Log output points</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use">5.6.2. How to use</a><ul>
<li><a class="reference internal" href="#settings-of-logback">5.6.2.1. Settings of Logback</a></li>
<li><a class="reference internal" href="#basic-log-output-by-calling-api-of-slf4j">5.6.2.2. Basic log output by calling API of SLF4J</a></li>
<li><a class="reference internal" href="#points-to-be-noted-for-the-description-of-log-output">5.6.2.3. Points to be noted for the description of log output</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendix">5.6.3. Appendix</a><ul>
<li><a class="reference internal" href="#using-mdc">5.6.3.1. Using MDC</a><ul>
<li><a class="reference internal" href="#basic-usage-method">5.6.3.1.1. Basic usage method</a></li>
<li><a class="reference internal" href="#setting-value-in-mdc-using-filter">5.6.3.1.2. Setting value in MDC using Filter</a></li>
</ul>
</li>
<li><a class="reference internal" href="#log-output-related-functionalities-provided-by-common-library">5.6.3.2. Log output related functionalities provided by common library</a><ul>
<li><a class="reference internal" href="#httpsessioneventlogginglistener">5.6.3.2.1. HttpSessionEventLoggingListener</a></li>
<li><a class="reference internal" href="#tracelogginginterceptor">5.6.3.2.2. TraceLoggingInterceptor</a></li>
<li><a class="reference internal" href="#exceptionlogger">5.6.3.2.3. ExceptionLogger</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="Validation.html"
                        title="previous chapter">5.5. Input Validation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ExceptionHandling.html"
                        title="next chapter">5.7. Exception Handling</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/ArchitectureInDetail/Logging.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="logging">
<h1>5.6. Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id2">Overview</a><ul>
<li><a class="reference internal" href="#types-of-logs" id="id3">Types of Logs</a></li>
<li><a class="reference internal" href="#output-contents-of-log" id="id4">Output contents of log</a></li>
<li><a class="reference internal" href="#log-output-points" id="id5">Log output points</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use" id="id6">How to use</a><ul>
<li><a class="reference internal" href="#settings-of-logback" id="id7">Settings of Logback</a></li>
<li><a class="reference internal" href="#basic-log-output-by-calling-api-of-slf4j" id="id8">Basic log output by calling API of SLF4J</a></li>
<li><a class="reference internal" href="#points-to-be-noted-for-the-description-of-log-output" id="id9">Points to be noted for the description of log output</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendix" id="id10">Appendix</a><ul>
<li><a class="reference internal" href="#using-mdc" id="id11">Using MDC</a><ul>
<li><a class="reference internal" href="#basic-usage-method" id="id12">Basic usage method</a></li>
<li><a class="reference internal" href="#setting-value-in-mdc-using-filter" id="id13">Setting value in MDC using Filter</a></li>
</ul>
</li>
<li><a class="reference internal" href="#log-output-related-functionalities-provided-by-common-library" id="id14">Log output related functionalities provided by common library</a><ul>
<li><a class="reference internal" href="#httpsessioneventlogginglistener" id="id15">HttpSessionEventLoggingListener</a></li>
<li><a class="reference internal" href="#tracelogginginterceptor" id="id16">TraceLoggingInterceptor</a></li>
<li><a class="reference internal" href="#exceptionlogger" id="id17">ExceptionLogger</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This contents described in this chapter are just guidelines that can be customized as per the business requirements.</p>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id2">5.6.1. Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">When a system is being operated, logs and messages are output as information sources to analyze the business process usage and</div>
<div class="line">to determine the causes when the system is down or when a business error etc. occurs.</div>
</div>
<div class="line-block">
<div class="line">It is important to output the log since effectiveness of analysis improves significantly if it is output at the time of debugging.</div>
</div>
<div class="line-block">
<div class="line">If only the behavior is to be checked, it can be done by debugging in IDE or through a simple output such as <tt class="docutils literal"><span class="pre">System.out.println</span></tt>.</div>
<div class="line">However, if the output result is not manually stored, it is not possible to check the results later. This hampers the effectiveness of analysis.</div>
<div class="line">Obtaining the log by implementing logging library is just writing the code to be output.</div>
<div class="line">Log can be verified at any convenient time later on.</div>
<div class="line">Considering operating time, trail and analysis, it is recommended to implement logging library.</div>
</div>
<div class="line-block">
<div class="line">There are various log output methods in Java and a number of methods can be selected; however this guideline recommends <a class="reference external" href="http://www.slf4j.org/">SLF4J</a> (interface) + <a class="reference external" href="http://logback.qos.ch/">Logback</a> (implementation)</div>
<div class="line">due to simplicity of coding, ease of modification and performance.</div>
</div>
<div class="section" id="types-of-logs">
<h3><a class="toc-backref" href="#id3">5.6.1.1. Types of Logs</a><a class="headerlink" href="#types-of-logs" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">A typical log at the time of application development is shown below.</div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="15%" />
<col width="35%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Log level</th>
<th class="head">Category</th>
<th class="head">Purpose of output</th>
<th class="head">Output contents</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>TRACE</td>
<td>Performance log</td>
<td><div class="first last line-block">
<div class="line">Measurement of request processing time</div>
<div class="line">(Should not be output during production environment operations)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Process start and end time, process elapsed time (ms),</div>
<div class="line">Information that can identify the execution process etc. (execution controller + method, request URL etc.).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>DEBUG</td>
<td>Debug log</td>
<td><div class="first last line-block">
<div class="line">Debug at the time of development</div>
<div class="line">(Should not be output during production environment operations)</div>
</div>
</td>
<td>Optional (Executed query, Input parameter, Return value etc.)</td>
</tr>
<tr class="row-even"><td>INFO</td>
<td>Access log</td>
<td><div class="first last line-block">
<div class="line">Assessing business process volume</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Information that can identify access date and time, user (IP address, authentication information)</div>
<div class="line">Information that can identify execution process (request URL) etc., information for leaving a trail</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>INFO</td>
<td>External communication log</td>
<td><div class="first last line-block">
<div class="line">Analysis of error that occurs while communicating with external system</div>
</div>
</td>
<td>Send and receive time, send and receive data etc.</td>
</tr>
<tr class="row-even"><td>WARN</td>
<td>Business error log</td>
<td>Business error records</td>
<td><div class="first last line-block">
<div class="line">Business error occurrence time, Message ID and message corresponding to business error</div>
<div class="line">Information necessary for analysis such as input information, exception message etc.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>ERROR</td>
<td>System error log</td>
<td>Record the events where it is difficult to continue a system operation</td>
<td><div class="first last line-block">
<div class="line">System error occurrence time, Message and message ID corresponding to system error</div>
<div class="line">Information necessary for analysis such as input information, exception message etc.</div>
<div class="line">Basically, framework is output and business process logic is not output.</div>
</div>
</td>
</tr>
<tr class="row-even"><td>ERROR</td>
<td>Monitoring log</td>
<td>Monitoring the occurrence of an exception</td>
<td><div class="first last line-block">
<div class="line">Exception occurrence time, Message ID corresponding to system error</div>
<div class="line">Use tools for monitoring and keep the output contents to a minimum.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">Debug log, Access log, Communication log, Business error log and System error log are output to same file.</div>
<div class="line">In this guideline, the log file that outputs the above mentioned logs is called as application log.</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The sequence of log levels of SLF4J or Logback is TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR.
It does not include FATAL level provided in commons-loggins or Log4J.</p>
</div>
</div>
<div class="section" id="output-contents-of-log">
<h3><a class="toc-backref" href="#id4">5.6.1.2. Output contents of log</a><a class="headerlink" href="#output-contents-of-log" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">It is important to note the points given below for the output contents of log.</div>
</div>
<ol class="arabic">
<li><div class="first line-block">
<div class="line">ID to be output to log</div>
<div class="line">When log is to be monitored during the operation, it is recommended to include a message ID in the log to be monitored.</div>
<div class="line">Further, when the business process volume is to be assessed using an access log, the log should be output according to the ID assigned to each business process as explained in Message Management.</div>
<div class="line">This facilitates overall data compilation.</div>
</div>
</li>
</ol>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The readability of log is enhanced by including an ID in the log thereby reducing the time required for primary isolation of failure analysis.
Refer to <a class="reference internal" href="MessageManagement.html"><em>Message Management</em></a> for log ID structure.
However, there is no need to assign an ID to all the logs. ID is not required at the time of debugging. It is recommended when the system is operational so as to isolate the log quickly.</p>
<p>During failure, when a system user is notified by displaying a log ID (or a message ID) on the error screen and the ID is then notified to the call center, for that user,
failure analysis becomes easier.</p>
<p>However, note that the vulnerabilities of the system may be exposed if errors are displayed on the screen along with the failure details.</p>
<p class="last">In common library, the mechanism(component) is provided to include the message ID(exception code) into the log and the screen when an exception is occurred.
Details refer to &#8220;<a class="reference internal" href="ExceptionHandling.html"><em>Exception Handling</em></a>&#8221;.</p>
</div>
</div></blockquote>
<ol class="arabic" start="2">
<li><div class="first line-block">
<div class="line">Traceability</div>
<div class="line">To improve the traceability, it is recommended to output a unique track ID (hereafter referred to as X-Track) at request level in each log.</div>
<div class="line">Example of logs including X-Track is given below.</div>
</div>
</li>
</ol>
<blockquote>
<div><div class="highlight-console"><div class="highlight"><pre><span class="go">date:2013-09-06 19:36:31    X-Track:85a437108e9f4a959fd227f07f72ca20        message:[START CONTROLLER] (omitted)</span>
<span class="go">date:2013-09-06 19:36:31    X-Track:85a437108e9f4a959fd227f07f72ca20        message:[END CONTROLLER  ] (omitted)</span>
<span class="go">date:2013-09-06 19:36:31    X-Track:85a437108e9f4a959fd227f07f72ca20        message:[HANDLING TIME   ] (omitted)</span>
<span class="go">date:2013-09-06 19:36:33    X-Track:948c8b9fd04944b78ad8aa9e24d9f263        message:[START CONTROLLER] (omitted)</span>
<span class="go">date:2013-09-06 19:36:33    X-Track:142ff9674efd486cbd1e293e5aa53a78        message:[START CONTROLLER] (omitted)</span>
<span class="go">date:2013-09-06 19:36:33    X-Track:142ff9674efd486cbd1e293e5aa53a78        message:[END CONTROLLER  ] (omitted)</span>
<span class="go">date:2013-09-06 19:36:33    X-Track:142ff9674efd486cbd1e293e5aa53a78        message:[HANDLING TIME   ] (omitted)</span>
<span class="go">date:2013-09-06 19:36:33    X-Track:948c8b9fd04944b78ad8aa9e24d9f263        message:[END CONTROLLER  ] (omitted)</span>
<span class="go">date:2013-09-06 19:36:33    X-Track:948c8b9fd04944b78ad8aa9e24d9f263        message:[HANDLING TIME   ] (omitted)</span>
</pre></div>
</div>
</div></blockquote>
<p></p>
<blockquote>
<div><div class="line-block">
<div class="line">Logs can be linked together using Track IDs even when the output is irregular.</div>
<div class="line">In the above example, it can be clearly understood that 4th, 8th and 9th rows in the log are pertaining to the same request.</div>
<div class="line">In common library, <tt class="docutils literal"><span class="pre">org.terasoluna.gfw.web.logging.mdc.XTrackMDCPutFilter</span></tt> to be added to MDC is provided by generating a unique key for each request.</div>
<div class="line"><tt class="docutils literal"><span class="pre">XTrackMDCPutFilter</span></tt> sets Track ID in &#8220;X-Track&#8221; of HTTP response header as well. X-Track is used as a Track ID label in the log.</div>
<div class="line">Refer to <a class="reference internal" href="#log-mdc"><em>About MDC</em></a> for the usage methods.</div>
</div>
</div></blockquote>
<ol class="arabic" start="3">
<li><div class="first line-block">
<div class="line">Log mask</div>
<div class="line">If personal information, credit card number etc. are output to the log file as is, the information that has security threat should be masked if needed.</div>
</div>
</li>
</ol>
</div>
<div class="section" id="log-output-points">
<h3><a class="toc-backref" href="#id5">5.6.1.3. Log output points</a><a class="headerlink" href="#log-output-points" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Category</th>
<th class="head">Output points</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Performance log</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The processing time of business process is measured and it is output after executing business process. Request processing time is measured and log is output when response is returned.</div>
<div class="line">It is usually implemented in AOP or Servlet filter.</div>
<div class="line"><br /></div>
<div class="line">Common library provides <tt class="docutils literal"><span class="pre">org.terasoluna.gfw.web.logging.TraceLoggingInterceptor</span></tt> which outputs processing time of SpringMVC Controller method</div>
<div class="line">in TRACE log after the execution of processing method of Controller.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Debug log</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When it is necessary to output debug information at the time of development, a suitable log output process is implemented in source code.</div>
<div class="line"><br /></div>
<div class="line">Common library provides <tt class="docutils literal"><span class="pre">org.terasoluna.gfw.web.logging.HttpSessionEventLoggingListener</span></tt> listener which outputs DEBUG log at the time of HTTP session creation/destruction/attribute addition.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Access log</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">INFO log is output at the time of receiving a request and returning the response.</div>
<div class="line">It is usually implemented in AOP or Servlet filter.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">External communication log</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">INFO log is output before and after external system linking.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Business error log</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">WARN log is output when business process exception is thrown.</div>
<div class="line">It is usually implemented in AOP.</div>
<div class="line"><br /></div>
<div class="line">In common library, when <cite>org.terasoluna.gfw.common.exception.BusinessException</cite> is thrown at the time of business process execution, <tt class="docutils literal"><span class="pre">org.terasoluna.gfw.common.exception.BusinessExceptionLoggingInterceptor</span></tt> that outputs WARN log is provided.</div>
<div class="line">Refer to <a class="reference internal" href="ExceptionHandling.html"><em>Exception Handling</em></a> for details.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">System error log</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">An ERROR log is output when system exception or unexpected exception occurs.</div>
<div class="line">It is usually implemented in AOP or Servlet filter.</div>
<div class="line"><br /></div>
<div class="line">In common library, <tt class="docutils literal"><span class="pre">org.terasoluna.gfw.web.exception.HandlerExceptionResolverLoggingInterceptor</span></tt> and</div>
<div class="line"><tt class="docutils literal"><span class="pre">org.terasoluna.gfw.web.exception.ExceptionLoggingFilter</span></tt> are provided.</div>
<div class="line">Refer to <a class="reference internal" href="ExceptionHandling.html"><em>Exception Handling</em></a>  for details.</div>
</div>
</td>
</tr>
<tr class="row-even"><td>Monitoring log</td>
<td>It is output at the same time as business error log and system error log.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that when the log is output, the contents should not be exactly identical to other logs. This is helpful in easily identifying the location of the output.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="how-to-use">
<h2><a class="toc-backref" href="#id6">5.6.2. How to use</a><a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h2>
<p>The following are required to output the log in SLF4J + Logback.</p>
<ol class="arabic simple">
<li>Settings of Logback</li>
<li>Calling API of SLF4J</li>
</ol>
<div class="section" id="settings-of-logback">
<h3><a class="toc-backref" href="#id7">5.6.2.1. Settings of Logback</a><a class="headerlink" href="#settings-of-logback" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Logback settings are described in logback.xml under the class path. An example of configuration is shown below.</div>
<div class="line">Refer to <a class="reference external" href="http://logback.qos.ch/manual/configuration.html">Official Manual</a> for the detailed configuration of logback.xml.</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Settings of Logback are read automatically as per the rules given below.</p>
<ol class="arabic simple">
<li>logback.groovy on class path</li>
<li>If file &#8220;1&#8221; is not found, logback-text.xml on class path</li>
<li>If file &#8220;2&#8221; is not found, logback.xml on class path</li>
<li>If file &#8220;3&#8221; is not found, settings of BasicConfigurator class (console output)</li>
</ol>
<p class="last">In this guideline, it is recommended to place logback.xml in the class path.
Moreover, apart from automatic reading, <a class="reference external" href="http://logback.qos.ch/manual/configuration.html#joranDirectly">it is possible to read programmatically through an API</a>and <a class="reference external" href="http://logback.qos.ch/manual/configuration.html#configFileProperty">specify the configuration file in system properties</a>.</p>
</div>
<p>logback.xml</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE logback&gt;</span>
<span class="nt">&lt;configuration&gt;</span>

    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;STDOUT&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
        <span class="nt">&lt;encoder&gt;</span>
            <span class="nt">&lt;pattern&gt;</span><span class="cp">&lt;![CDATA[date:%d{yyyy-MM-dd HH:mm:ss}\tthread:%thread\tX-Track:%X{X-Track}\tlevel:%-5level\tlogger:%-48logger{48}\tmessage:%msg%n]]&gt;</span><span class="nt">&lt;/pattern&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
        <span class="nt">&lt;/encoder&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;APPLICATION_LOG_FILE&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
        <span class="nt">&lt;file&gt;</span>log/projectName-application.log<span class="nt">&lt;/file&gt;</span> <span class="c">&lt;!-- (4) --&gt;</span>
        <span class="nt">&lt;rollingPolicy</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;fileNamePattern&gt;</span>log/projectName-application-%d{yyyyMMddHH}.log<span class="nt">&lt;/fileNamePattern&gt;</span> <span class="c">&lt;!-- (5) --&gt;</span>
            <span class="nt">&lt;maxHistory&gt;</span>7<span class="nt">&lt;/maxHistory&gt;</span> <span class="c">&lt;!-- (6) --&gt;</span>
        <span class="nt">&lt;/rollingPolicy&gt;</span>
        <span class="nt">&lt;encoder&gt;</span>
            <span class="nt">&lt;charset&gt;</span>UTF-8<span class="nt">&lt;/charset&gt;</span> <span class="c">&lt;!-- (7) --&gt;</span>
            <span class="nt">&lt;pattern&gt;</span><span class="cp">&lt;![CDATA[date:%d{yyyy-MM-dd HH:mm:ss}\tthread:%thread\tX-Track:%X{X-Track}\tlevel:%-5level\tlogger:%-48logger{48}\tmessage:%msg%n]]&gt;</span><span class="nt">&lt;/pattern&gt;</span>
        <span class="nt">&lt;/encoder&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;MONITORING_LOG_FILE&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (8) --&gt;</span>
        <span class="nt">&lt;file&gt;</span>log/projectName-monitoring.log<span class="nt">&lt;/file&gt;</span>
        <span class="nt">&lt;rollingPolicy</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;fileNamePattern&gt;</span>log/projectName-monitoring-%d{yyyyMMdd}.log<span class="nt">&lt;/fileNamePattern&gt;</span>
            <span class="nt">&lt;maxHistory&gt;</span>7<span class="nt">&lt;/maxHistory&gt;</span>
        <span class="nt">&lt;/rollingPolicy&gt;</span>
        <span class="nt">&lt;encoder&gt;</span>
            <span class="nt">&lt;charset&gt;</span>UTF-8<span class="nt">&lt;/charset&gt;</span>
            <span class="nt">&lt;pattern&gt;</span><span class="cp">&lt;![CDATA[date:%d{yyyy-MM-dd HH:mm:ss}\tX-Track:%X{X-Track}\tlevel:%-5level\tmessage:%msg%n]]&gt;</span><span class="nt">&lt;/pattern&gt;</span>
        <span class="nt">&lt;/encoder&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="c">&lt;!-- Application Loggers --&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;com.example.sample&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (9) --&gt;</span>
        <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;debug&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>

    <span class="c">&lt;!-- TERASOLUNA --&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.terasoluna.gfw&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;info&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.terasoluna.gfw.web.logging.TraceLoggingInterceptor&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;trace&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.terasoluna.gfw.common.exception.ExceptionLogger&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;info&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.terasoluna.gfw.common.exception.ExceptionLogger.Monitoring&quot;</span> <span class="na">additivity=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span><span class="c">&lt;!-- (10) --&gt;</span>
        <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;error&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;MONITORING_LOG_FILE&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>

    <span class="c">&lt;!-- 3rdparty Loggers --&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.springframework&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;warn&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>

    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.springframework.web.servlet&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;info&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>

    <span class="nt">&lt;root</span> <span class="na">level=</span><span class="s">&quot;warn&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (11) --&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;STDOUT&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (12) --&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;APPLICATION_LOG_FILE&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/root&gt;</span>

<span class="nt">&lt;/configuration&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Definition of appender is specified to output the log on console.</div>
<div class="line">It can be selected whether the output destination is standard output or standard error, however when the destination is not specified, it is considered as standard output.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The output format for log is specified. If the format is not specified, the message alone is output.</div>
<div class="line">Time and message level etc. are output according to the business requirements.</div>
<div class="line">Here, LTSV (Labeled Tab Separated Value) of &#8220;Label:Value&lt;TAB&gt;Label:Value&lt;TAB&gt;...&#8221; format is set.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Definition for appender is specified to output application log.</div>
<div class="line">The appender to be used can also be specified in &lt;logger&gt;, however, here it is referred to root (11) since application log is used by default.</div>
<div class="line">RollingFileAppender is commonly used at the time of application log output, however, FileAppender may also be used to implement log rotation using another functions such as logrotate.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A current file name (File name of log being output) is specified. It should be specified when it is necessary to specify a fixed file name.</div>
<div class="line">If &lt;file&gt;log file name&lt;/file&gt; is not specified, it is output with the name in pattern (5).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Name of the file after rotation is specified. Usually, date or time format is widely used.</div>
<div class="line">Note that 24 hour clock is not set if HH is mistakenly set as hh.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The number of remaining files for which rotation is performed is specified.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A character code of log file is specified.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">It is set so as to output the application log by default.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The logger name is set so that logger under com.example.sample outputs the log above debug level.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A monitoring log is set. Refer to <a class="reference internal" href="ExceptionHandling.html#exception-handling-how-to-use-application-configuration-common-label"><em>Common Settings</em></a> of <a class="reference internal" href="ExceptionHandling.html"><em>Exception Handling</em></a>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(11)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">It is set such that logger without &lt;logger&gt; specification outputs the log of warn level or above.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(12)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">It is set in such a way that ConsoleAppender, RollingFileAppender (application logs) are used by default.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>About LTSV(Labeled Tab Separated Value)</strong></p>
<p><a class="reference external" href="http://ltsv.org/">LTSV</a> is one of text data formats, and mainly used as the log format.</p>
<p>For log fomart, LTSV is easy to parse using some tools because it has following features.</p>
<ul class="simple">
<li>It&#8217;s easy to split the field compared to other delimiters because tabs is used as field delimiters.</li>
<li>Even if the field definition (changing the position of field or adding the field or removing the field) is changed, it does not affect to parsing because of including a label(name) in the field.</li>
</ul>
<p class="last">It is also one of features that there are that pasting on the Excel can format it with the least effort.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The following three items should be set in logback.xml.</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type</th>
<th class="head">Overview</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>appender</td>
<td>&#8220;Location&#8221; and &#8220;Layout&#8221; to be used for output</td>
</tr>
<tr class="row-odd"><td>root</td>
<td>Default &#8220;Appender&#8221; and the minimum &#8220;Log level&#8221; to be used for output</td>
</tr>
<tr class="row-even"><td>logger</td>
<td>&#8220;Which logger (package or class etc.)&#8221; is to be output at which minimum &#8220;log level&#8221;</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>In &lt;appender&gt; element, the &#8220;location&#8221; and the &#8220;layout&#8221; to be used for output are defined.
It is not used at the time of the log output only by defining the appender.
It is used for the first time when it is referred in &lt;logger&gt; element or &lt;root&gt; element.
There are two attributes, namely, &#8220;name&#8221; and &#8220;class&#8221; and both are mandatory.</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Attribute</th>
<th class="head">Overview</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>name</td>
<td>Name of the appender. It is specified by appender-ref. Any name can be assigned as there is no restriction on assigning the name.</td>
</tr>
<tr class="row-odd"><td>class</td>
<td>FQCN of appender implementation class.</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The main appenders that are provided are shown below.</p>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Appender</th>
<th class="head">Overview</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference external" href="http://logback.qos.ch/manual/appenders.html#ConsoleAppender">ConsoleAppender</a></td>
<td>Console output</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="http://logback.qos.ch/manual/appenders.html#FileAppender">FileAppender</a></td>
<td>File output</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="http://logback.qos.ch/manual/appenders.html#RollingFileAppender">RollingFileAppender</a></td>
<td>File output (Rolling possible)</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="http://logback.qos.ch/manual/appenders.html#AsyncAppender">AsyncAppender</a></td>
<td>Asynchronous output. It is used for logging in processes with high performance requirement. (It is necessary to set the output destination in other Appender.)</td>
</tr>
</tbody>
</table>
<p>Refer to <a class="reference external" href="http://logback.qos.ch/manual/appenders.html">Official Manual</a> for detailed Appender types.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="basic-log-output-by-calling-api-of-slf4j">
<h3><a class="toc-backref" href="#id8">5.6.2.2. Basic log output by calling API of SLF4J</a><a class="headerlink" href="#basic-log-output-by-calling-api-of-slf4j" title="Permalink to this headline">¶</a></h3>
<p>Log is output by calling a method according to each log level of SLF4J logger(<tt class="docutils literal"><span class="pre">org.slf4j.Logger</span></tt>).</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">sample</span><span class="o">.</span><span class="na">app</span><span class="o">.</span><span class="na">welcome</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HomeController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span>
            <span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">HomeController</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;/&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="o">{</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span>
            <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span> <span class="o">})</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&quot;This log is trace log.&quot;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;This log is debug log.&quot;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;This log is info log.&quot;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&quot;This log is warn log.&quot;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&quot;This log is error log.&quot;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&quot;welcome/home&quot;</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">Logger</span></tt> is generated from <tt class="docutils literal"><span class="pre">org.slf4j.LoggerFactory</span></tt>. If Class object is set as an argument of <tt class="docutils literal"><span class="pre">getLogger</span></tt>, the logger name acts as an FQCN of that class.</div>
<div class="line">In this example, the logger name is &#8220;com.example.sample.app.welcome.HomeController&#8221;.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The log of TRACE level is output.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The log of DEBUG level is output.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The log of INFO level is output.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The log of WARN level is output.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The log of ERROR level is output.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Log output results are shown below. Log level of com.example.sample is DEBUG, hence TRACE log is not output.</p>
<div class="highlight-xml"><div class="highlight"><pre>date:2013-11-06 20:13:05    thread:tomcat-http--3 X-Track:5844f073b7434b67a875cb85b131e686    level:DEBUG logger:com.example.sample.app.welcome.HomeController    message:This log is debug log.
date:2013-11-06 20:13:05    thread:tomcat-http--3 X-Track:5844f073b7434b67a875cb85b131e686    level:INFO  logger:com.example.sample.app.welcome.HomeController    message:This log is info log.
date:2013-11-06 20:13:05    thread:tomcat-http--3 X-Track:5844f073b7434b67a875cb85b131e686    level:WARN  logger:com.example.sample.app.welcome.HomeController    message:This log is warn log.
date:2013-11-06 20:13:05    thread:tomcat-http--3 X-Track:5844f073b7434b67a875cb85b131e686    level:ERROR logger:com.example.sample.app.welcome.HomeController    message:This log is error log.
</pre></div>
</div>
<p>The description can be as given below when an argument is to be entered in placeholder of a log message.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;a={}&quot;</span><span class="o">,</span> <span class="n">a</span><span class="o">);</span>
<span class="n">String</span> <span class="n">b</span> <span class="o">=</span> <span class="s">&quot;bbb&quot;</span><span class="o">;</span>
<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;a={}, b={}&quot;</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">);</span>
</pre></div>
</div>
<p>The log given below is output.</p>
<div class="highlight-xml"><div class="highlight"><pre>date:2013-11-06 20:32:45    thread:tomcat-http--3   X-Track:853aa701a401404a87342a574c69efbc    level:DEBUG logger:com.example.sample.app.welcome.HomeController    message:a=1
date:2013-11-06 20:32:45    thread:tomcat-http--3   X-Track:853aa701a401404a87342a574c69efbc    level:DEBUG logger:com.example.sample.app.welcome.HomeController    message:a=1, b=bbb
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Note that string concatenation such as <tt class="docutils literal"><span class="pre">logger.debug(&quot;a=&quot;</span> <span class="pre">+</span> <span class="pre">a</span> <span class="pre">+</span> <span class="pre">&quot;</span> <span class="pre">,</span> <span class="pre">b=&quot;</span> <span class="pre">+</span> <span class="pre">b);</span></tt> should not be carried out.</p>
</div>
<p>When the exception is to be caught,
ERROR log (WARN log in some cases) is output as shown below. Error message and exception generated are passed to the log method.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// omitted</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="n">throwException</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&quot;Exception happened!&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="c1">// omitted</span>
    <span class="o">}</span>
    <span class="c1">// omitted</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">throwException</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="o">(</span><span class="s">&quot;Test Exception!&quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Accordingly, stack trace of caused exception is output and the cause of the error can be easily analyzed.</p>
<div class="highlight-xml"><div class="highlight"><pre>date:2013-11-06 20:38:04    thread:tomcat-http--5   X-Track:11d7dbdf64e44782822c5aea4fc4bb4f    level:ERROR logger:com.example.sample.app.welcome.HomeController    message:Exception happend!
java.lang.Exception: Test Exception!
    at com.example.sample.app.welcome.HomeController.throwException(HomeController.java:40) ~[HomeController.class:na]
    at com.example.sample.app.welcome.HomeController.home(HomeController.java:31) ~[HomeController.class:na]
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.7.0_40]
    (omitted)
</pre></div>
</div>
<p>However, as shown below, when the exception that is caught is wrapped with other exception and is re-thrown at upper level, there is no need to output the log. This is because usually the error log is output at upper level.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="k">try</span> <span class="o">{</span>
    <span class="n">throwException</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">SystemException</span><span class="o">(</span><span class="s">&quot;e.ex.fw.9001&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
    <span class="c1">// no need to log</span>
<span class="o">}</span>
</pre></div>
</div>
<dl class="docutils">
<dt></dt>
<dd><div class="first last admonition note">
<p class="first admonition-title">Note</p>
<p>When cause exception is to be passed to a log method, a placeholder cannot be used. Only in this case,
the message argument can be concatenated using a string.</p>
<blockquote class="last">
<div><div class="highlight-java"><div class="highlight"><pre><span class="k">try</span> <span class="o">{</span>
    <span class="n">throwException</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// NG =&gt; logger.error(&quot;Exception happend! [a={} , b={}]&quot;, e, a, b);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&quot;Exception happend! [a=&quot;</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="s">&quot; , b=&quot;</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
    <span class="c1">// omitted</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
</dd>
</dl>
</div>
<div class="section" id="points-to-be-noted-for-the-description-of-log-output">
<h3><a class="toc-backref" href="#id9">5.6.2.3. Points to be noted for the description of log output</a><a class="headerlink" href="#points-to-be-noted-for-the-description-of-log-output" title="Permalink to this headline">¶</a></h3>
<p>SLF4J Logger internally checks the log level and outputs actual log only for the required levels.</p>
<p>Therefore, the log level check as given below is basically not necessary.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;This log is Debug.&quot;</span><span class="o">);</span>
<span class="o">}</span>

<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;a={}&quot;</span><span class="o">,</span> <span class="n">a</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>However, the log level should be checked in the cases given below to prevent performance degradation.</p>
<ol class="arabic">
<li><p class="first">When there are 3 or more arguments</p>
<blockquote>
<div><p>When arguments of log message are 3 or more, argument array should be passed in the API of SLF4J. Log level should be checked in order to
to avoid the cost for generating an array and the array should be generated only when necessary.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;a={}, b={}, c={}&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span> <span class="o">{</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span> <span class="o">});</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">When it is necessary to call a method for creating an argument</p>
<blockquote>
<div><p>When it is necessary to call a method while creating an argument for the log message, the log level should be checked
to avoid the method execution cost and the method should be executed only when necessary.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;xxx={}&quot;</span><span class="o">,</span> <span class="n">foo</span><span class="o">.</span><span class="na">getXxx</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="appendix">
<h2><a class="toc-backref" href="#id10">5.6.3. Appendix</a><a class="headerlink" href="#appendix" title="Permalink to this headline">¶</a></h2>
<div class="section" id="using-mdc">
<span id="log-mdc"></span><h3><a class="toc-backref" href="#id11">5.6.3.1. Using MDC</a><a class="headerlink" href="#using-mdc" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">A cross-sectional log can be output by using <a class="reference external" href="http://logback.qos.ch/manual/mdc.html">MDC</a> (Mapped Diagnostic Context).</div>
<div class="line">Log traceability improves if same information (such as user name or unique request ID) is included in the log to be output in a request.</div>
</div>
<div class="line-block">
<div class="line">MDC internally consists of a ThreadLocal map and sets value for the key. The value set in log can be output till it is removed.</div>
<div class="line">The value should be set at the beginning of the request and removed at the time of process termination.</div>
</div>
<div class="section" id="basic-usage-method">
<h4><a class="toc-backref" href="#id12">5.6.3.1.1. Basic usage method</a><a class="headerlink" href="#basic-usage-method" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">An example of using MDC is given below.</div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.MDC</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">key</span> <span class="o">=</span> <span class="s">&quot;MDC_SAMPLE&quot;</span><span class="o">;</span>
        <span class="n">MDC</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="s">&quot;sample&quot;</span><span class="o">);</span> <span class="c1">// (1)</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;debug log&quot;</span><span class="o">);</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;info log&quot;</span><span class="o">);</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&quot;warn log&quot;</span><span class="o">);</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&quot;error log&quot;</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">MDC</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">key</span><span class="o">);</span> <span class="c1">// (2)</span>
        <span class="o">}</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;mdc removed!&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The value added to MDC can be output in log by defining the output format as
<tt class="docutils literal"><span class="pre">%X{key</span> <span class="pre">name}</span></tt>format in <tt class="docutils literal"><span class="pre">&lt;pattern&gt;</span></tt> of logback.xml.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;STDOUT&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;encoder&gt;</span>
        <span class="nt">&lt;pattern&gt;</span><span class="cp">&lt;![CDATA[date:%d{yyyy-MM-dd HH:mm:ss}\tthread:%thread\tmdcSample:%X{MDC_SAMPLE}\tlevel:%-5level\t\tmessage:%msg%n]]&gt;</span><span class="nt">&lt;/pattern&gt;</span>
    <span class="nt">&lt;/encoder&gt;</span>
<span class="nt">&lt;/appender&gt;</span>
</pre></div>
</div>
<p>Execution results are as follows:</p>
<div class="highlight-xml"><div class="highlight"><pre>date:2013-11-08 17:45:48    thread:main mdcSample:sample    level:DEBUG     message:debug log
date:2013-11-08 17:45:48    thread:main mdcSample:sample    level:INFO      message:info log
date:2013-11-08 17:45:48    thread:main mdcSample:sample    level:WARN      message:warn log
date:2013-11-08 17:45:48    thread:main mdcSample:sample    level:ERROR     message:error log
date:2013-11-08 17:45:48    thread:main mdcSample:  level:DEBUG     message:mdc removed!
</pre></div>
</div>
<dl class="docutils">
<dt></dt>
<dd><div class="first last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If <tt class="docutils literal"><span class="pre">MDC.clear()</span></tt> is executed, all the added values are deleted.</p>
</div>
</dd>
</dl>
</div>
<div class="section" id="setting-value-in-mdc-using-filter">
<h4><a class="toc-backref" href="#id13">5.6.3.1.2. Setting value in MDC using Filter</a><a class="headerlink" href="#setting-value-in-mdc-using-filter" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Common library provides <tt class="docutils literal"><span class="pre">org.terasoluna.gfw.web.logging.mdc.AbstractMDCPutFilter</span></tt> as a base class to add/delete values from MDC using filter.</div>
<div class="line">Further, following are provided as implementation classes.</div>
</div>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">org.terasoluna.gfw.web.logging.mdc.XTrackMDCPutFilter</span></tt> to set an unique ID for each request in MDC</li>
<li><tt class="docutils literal"><span class="pre">org.terasoluna.gfw.security.web.logging.UserIdMDCPutFilter</span></tt> to set authentication user name of Spring Security in MDC</li>
</ul>
<div class="line-block">
<div class="line">If individual values are to be added to MDC using Filter, it is desirable to implement <tt class="docutils literal"><span class="pre">AbstractMDCPutFilter</span></tt></div>
<div class="line">based on implementation of <tt class="docutils literal"><span class="pre">org.terasoluna.gfw.web.logging.mdc.XTrackMDCPutFilter</span></tt>.</div>
</div>
<p>How to use MDCFilter</p>
<p>Definition of MDCFilter is added to the filter definition of web.xml.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- omitted --&gt;</span>

<span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>MDCClearFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;filter-class&gt;</span>org.terasoluna.gfw.web.logging.mdc.MDCClearFilter<span class="nt">&lt;/filter-class&gt;</span>
<span class="nt">&lt;/filter&gt;</span>

<span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>MDCClearFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span>

<span class="c">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>XTrackMDCPutFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;filter-class&gt;</span>org.terasoluna.gfw.web.logging.mdc.XTrackMDCPutFilter<span class="nt">&lt;/filter-class&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>XTrackMDCPutFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span>

<span class="c">&lt;!-- (3) --&gt;</span>
<span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>UserIdMDCPutFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;filter-class&gt;</span>org.terasoluna.gfw.security.web.logging.UserIdMDCPutFilter<span class="nt">&lt;/filter-class&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>UserIdMDCPutFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span>

<span class="c">&lt;!-- omitted --&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">MDCClearFilter</span></tt> that clears the contents of MDC is set.</div>
<div class="line">Values in MDC added by various <tt class="docutils literal"><span class="pre">MDCPutFilter</span></tt> are deleted by this Filter.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">XTrackMDCPutFilter</span></tt> is set. <tt class="docutils literal"><span class="pre">XTrackMDCPutFilter</span></tt> sets Request ID in key &#8220;X-Track&#8221;.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">UserIdMDCPutFilter</span></tt> is set. <tt class="docutils literal"><span class="pre">UserIdMDCPutFilter</span></tt> sets User ID in key &#8220;USER&#8221;.</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>As shown in the sequence diagram below, <tt class="docutils literal"><span class="pre">MDCClearFilter</span></tt> should be defined prior to each <tt class="docutils literal"><span class="pre">MDCPutFilter</span></tt>to clear the contents of MDC for post-processing.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/logging-mdcput-sequence.png"><img alt="../_images/logging-mdcput-sequence.png" src="../_images/logging-mdcput-sequence.png" style="width: 80%;" /></a>
</div>
<p>Request ID and User ID can be output to log by adding <tt class="docutils literal"><span class="pre">%X{X-Track}</span></tt> and <tt class="docutils literal"><span class="pre">%X{USER}</span></tt> in <tt class="docutils literal"><span class="pre">&lt;pattern&gt;</span></tt> of logback.xml.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;APPLICATION_LOG_FILE&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;file&gt;</span>log/projectName-application.log<span class="nt">&lt;/file&gt;</span>
    <span class="nt">&lt;rollingPolicy</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;fileNamePattern&gt;</span>log/projectName-application-%d{yyyyMMdd}.log<span class="nt">&lt;/fileNamePattern&gt;</span>
        <span class="nt">&lt;maxHistory&gt;</span>7<span class="nt">&lt;/maxHistory&gt;</span>
    <span class="nt">&lt;/rollingPolicy&gt;</span>
    <span class="nt">&lt;encoder&gt;</span>
        <span class="nt">&lt;charset&gt;</span>UTF-8<span class="nt">&lt;/charset&gt;</span>
        <span class="nt">&lt;pattern&gt;</span><span class="cp">&lt;![CDATA[date:%d{yyyy-MM-dd HH:mm:ss}\tthread:%thread\tUSER:%X{USER}\tX-Track:%X{X-Track}\tlevel:%-5level\tlogger:%-48logger{48}\tmessage:%msg%n]]&gt;</span><span class="nt">&lt;/pattern&gt;</span>
    <span class="nt">&lt;/encoder&gt;</span>
<span class="nt">&lt;/appender&gt;</span>
<span class="c">&lt;!-- omitted --&gt;</span>
</pre></div>
</div>
<p>Example of log output</p>
<div class="highlight-xml"><div class="highlight"><pre>date:2013-09-06 23:05:22  thread:tomcat-http--3   USER:   X-Track:97988cc077f94f9d9d435f6f76027428    level:DEBUG logger:o.t.g.w.logging.HttpSessionEventLoggingListener  message:SESSIONID#D7AD1D42D3E77D61DB64E7C8C65CB488 sessionCreated : org.apache.catalina.session.StandardSessionFacade@e51960
date:2013-09-06 23:05:22  thread:tomcat-http--3   USER:anonymousUser  X-Track:97988cc077f94f9d9d435f6f76027428    logger:o.t.gfw.web.logging.TraceLoggingInterceptor      message:[START CONTROLLER] HomeController.home(Locale,Model)
date:2013-09-06 23:05:22  thread:tomcat-http--3   USER:anonymousUser  X-Track:97988cc077f94f9d9d435f6f76027428    level:INFO  logger:c.terasoluna.logging.app.welcome.HomeController  message:Welcome home! The client locale is ja.
date:2013-09-06 23:05:22  thread:tomcat-http--3   USER:anonymousUser  X-Track:97988cc077f94f9d9d435f6f76027428    logger:o.t.gfw.web.logging.TraceLoggingInterceptor      message:[END CONTROLLER  ] HomeController.home(Locale,Model)-&gt; view=home, model={serverTime=2013/09/06 23:05:22 JST}
date:2013-09-06 23:05:22  thread:tomcat-http--3   USER:anonymousUser  X-Track:97988cc077f94f9d9d435f6f76027428    logger:o.t.gfw.web.logging.TraceLoggingInterceptor      message:[HANDLING TIME   ] HomeController.home(Locale,Model)-&gt; 36,508,860 ns
</pre></div>
</div>
<dl class="docutils">
<dt></dt>
<dd><div class="first last admonition note">
<p class="first admonition-title">Note</p>
<p>User information to be set in MDC by <tt class="docutils literal"><span class="pre">UserIdMDCPutFilter</span></tt> is created by Spring Security Filter.
As mentioned earlier, if <tt class="docutils literal"><span class="pre">UserIdMDCPutFilter</span></tt>  is defined in web.xml, user ID is output to
log after the completion of a series of Spring Security processes. If user information is to be output to the log immediately after it is generated,
the information should be incorporated in Spring Security Filter as shown below by deleting web.xml definition.</p>
<p>The definitions given below are added to spring-security.xml.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;sec:http</span> <span class="na">auto-config=</span><span class="s">&quot;true&quot;</span> <span class="na">use-expressions=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
    <span class="nt">&lt;sec:custom-filter</span> <span class="na">ref=</span><span class="s">&quot;userIdMDCPutFilter&quot;</span> <span class="na">after=</span><span class="s">&quot;ANONYMOUS_FILTER&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/sec:http&gt;</span>

<span class="c">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;userIdMDCPutFilter&quot;</span> <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.security.web.logging.UserIdMDCPutFilter&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">UserIdMDCPutFilter</span></tt>  defined in Bean is added after &#8220;ANONYMOUS_FILTER&#8221;.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">UserIdMDCPutFilter</span></tt>  is defined.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p class="last">In blank project, <tt class="docutils literal"><span class="pre">UserIdMDCPutFilter</span></tt> is defined in spring-security.xml.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="log-output-related-functionalities-provided-by-common-library">
<h3><a class="toc-backref" href="#id14">5.6.3.2. Log output related functionalities provided by common library</a><a class="headerlink" href="#log-output-related-functionalities-provided-by-common-library" title="Permalink to this headline">¶</a></h3>
<div class="section" id="httpsessioneventlogginglistener">
<span id="logging-appendix-httpsessioneventlogginglistener"></span><h4><a class="toc-backref" href="#id15">5.6.3.2.1. HttpSessionEventLoggingListener</a><a class="headerlink" href="#httpsessioneventlogginglistener" title="Permalink to this headline">¶</a></h4>
<p> <tt class="docutils literal"><span class="pre">org.terasoluna.fw.web.logging.HttpSessionEventLoggingListener</span></tt> is a listener class
that outputs debug log at the time of generating, discarding, activating or deactivating session, and adding or deleting session attributes.</p>
<p>The following should be added to web.xml.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;web-app</span> <span class="na">xmlns=</span><span class="s">&quot;http://java.sun.com/xml/ns/javaee&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span>
    <span class="na">version=</span><span class="s">&quot;3.0&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;listener&gt;</span>
        <span class="nt">&lt;listener-class&gt;</span>org.terasoluna.gfw.web.logging.HttpSessionEventLoggingListener<span class="nt">&lt;/listener-class&gt;</span>
    <span class="nt">&lt;/listener&gt;</span>

    <span class="c">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/web-app&gt;</span>
</pre></div>
</div>
<p>In logback.xml, <tt class="docutils literal"><span class="pre">org.terasoluna.gfw.web.logging.HttpSessionEventLoggingListener</span></tt> is set at debug level as shown below.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;logger</span>
    <span class="na">name=</span><span class="s">&quot;org.terasoluna.gfw.web.logging.HttpSessionEventLoggingListener&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;debug&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/logger&gt;</span>
</pre></div>
</div>
<p>Debug log as shown below is output.</p>
<div class="highlight-xml"><div class="highlight"><pre>date:2013-09-06 16:41:33    thread:tomcat-http--3   USER:   X-Track:c004ddb56a3642d5bc5f6b5d884e5db2        level:DEBUG     logger:o.t.g.w.logging.HttpSessionEventLoggingListener  message:SESSIONID#EDC3C240A7A1CCE87146A6BA1321AD0F sessionCreated : org.apache.catalina.session.StandardSessionFacade@f00e0f
</pre></div>
</div>
<p>When the lifecycle of an object is managed using a Session such as <tt class="docutils literal"><span class="pre">&#64;SessionAttribute</span></tt> etc.,
it is strongly recommended to use this listener to confirm whether the attributes added to the session are deleted as anticipated.</p>
</div>
<div class="section" id="tracelogginginterceptor">
<h4><a class="toc-backref" href="#id16">5.6.3.2.2. TraceLoggingInterceptor</a><a class="headerlink" href="#tracelogginginterceptor" title="Permalink to this headline">¶</a></h4>
<p> <tt class="docutils literal"><span class="pre">org.terasoluna.gfw.web.logging.TraceLoggingInterceptor</span></tt> is the
<tt class="docutils literal"><span class="pre">HandlerInterceptor</span></tt> to output start and termination of Controller process to the log.
When the process is terminated, View name returned by the Controller, attributes added to Model and the time required for Controller process are also output.</p>
<p><tt class="docutils literal"><span class="pre">TraceLoggingInterceptor</span></tt>is added in <tt class="docutils literal"><span class="pre">&lt;mvc:interceptors&gt;</span></tt> of spring-mvc.xml as shown below.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;mvc:interceptors&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
    <span class="nt">&lt;mvc:interceptor&gt;</span>
        <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&quot;/**&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/resources/**&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;bean</span>
            <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.logging.TraceLoggingInterceptor&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;/mvc:interceptor&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/mvc:interceptors&gt;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">By default, WARN log is output if Controller process takes more than 3 seconds.</div>
<div class="line">When the threshold value is to be changed, it is specified in nano seconds in <tt class="docutils literal"><span class="pre">warnHandlingNanos</span></tt> property.</div>
</div>
<p>The following settings should be performed if the threshold value is to be changed to 10 seconds (10 * 1000 * 1000 * 1000 nano seconds).</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;mvc:interceptors&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
    <span class="nt">&lt;mvc:interceptor&gt;</span>
        <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&quot;/**&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/resources/**&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;bean</span>
            <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.logging.TraceLoggingInterceptor&quot;</span><span class="nt">&gt;</span>
<span class="hll">            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;warnHandlingNanos&quot;</span> <span class="na">value=</span><span class="s">&quot;#{10 * 1000 * 1000 * 1000}&quot;</span> <span class="nt">/&gt;</span>
</span>        <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;/mvc:interceptor&gt;</span>
    <span class="c">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/mvc:interceptors&gt;</span>
</pre></div>
</div>
<p>In logback.xml, <tt class="docutils literal"><span class="pre">org.terasoluna.gfw.web.logging.TraceLoggingInterceptor</span></tt> is set at trace level as shown below.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.terasoluna.gfw.web.logging.TraceLoggingInterceptor&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;trace&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/logger&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="exceptionlogger">
<h4><a class="toc-backref" href="#id17">5.6.3.2.3. ExceptionLogger</a><a class="headerlink" href="#exceptionlogger" title="Permalink to this headline">¶</a></h4>
<p><tt class="docutils literal"><span class="pre">org.terasoluna.gfw.common.exception.ExceptionLogger</span></tt> is provided as a logger when an exception occurs.</p>
<p>Refer to <a class="reference internal" href="ExceptionHandling.html#exception-handling-how-to-use-label"><em>How to use</em></a> of <a class="reference internal" href="ExceptionHandling.html"><em>Exception Handling</em></a> for the usage method.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ExceptionHandling.html" title="5.7. Exception Handling"
             >next</a> |</li>
        <li class="right" >
          <a href="Validation.html" title="5.5. Input Validation"
             >previous</a> |</li>
        <li><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.0.0-SNAPSHOT documentation</a> &raquo;</li>
          <li><a href="index.html" >5. Architecture in Detail - TERASOLUNA Server Framework for Java (5.x)</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013-2015, NTT DATA.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.Theme by <a href="http://github.com/vkvn">vkvn</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>