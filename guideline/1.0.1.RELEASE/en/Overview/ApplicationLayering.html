<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>2.4. Application Layering &#8212; TERASOLUNA Global Framework Development Guideline 1.0.1.RELEASE documentation</title>
    <link rel="stylesheet" href="../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.1.RELEASE',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3. Tutorial (Todo Application)" href="../TutorialTodo/index.html" />
    <link rel="prev" title="2.3. First application based on Spring MVC" href="FirstApplication.html" /><script async src="https://www.googletagmanager.com/gtag/js?id=G-847V2Q99G8"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date()); gtag('config', 'G-847V2Q99G8');
</script>
<script src="../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../_static/solarized-dark.css" rel="stylesheet">
<link href="../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../TutorialTodo/index.html" title="3. Tutorial (Todo Application)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="FirstApplication.html" title="2.3. First application based on Spring MVC"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Global Framework Development Guideline 1.0.1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">2. Summary - Architecture of TERASOLUNA Global Framework</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2.4. Application Layering</a><ul>
<li><a class="reference internal" href="#layer-definition">2.4.1. Layer definition</a><ul>
<li><a class="reference internal" href="#application-layer">2.4.1.1. Application layer</a><ul>
<li><a class="reference internal" href="#controller">2.4.1.1.1. Controller</a></li>
<li><a class="reference internal" href="#view">2.4.1.1.2. View</a></li>
<li><a class="reference internal" href="#form">2.4.1.1.3. Form</a></li>
<li><a class="reference internal" href="#helper">2.4.1.1.4. Helper</a></li>
</ul>
</li>
<li><a class="reference internal" href="#domain-layer">2.4.1.2. Domain layer</a><ul>
<li><a class="reference internal" href="#domainobject">2.4.1.2.1. DomainObject</a></li>
<li><a class="reference internal" href="#repository">2.4.1.2.2. Repository</a></li>
<li><a class="reference internal" href="#service">2.4.1.2.3. Service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#infrastructure-layer">2.4.1.3. Infrastructure layer</a><ul>
<li><a class="reference internal" href="#repositoryimpl">2.4.1.3.1. RepositoryImpl</a></li>
<li><a class="reference internal" href="#o-r-mapper">2.4.1.3.2. O/R Mapper</a></li>
<li><a class="reference internal" href="#integration-system-connector">2.4.1.3.3. Integration System Connector</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#dependency-between-layers">2.4.2. Dependency between layers</a></li>
<li><a class="reference internal" href="#project-structure">2.4.3. Project structure</a><ul>
<li><a class="reference internal" href="#projectname-domain">2.4.3.1. [projectname]-domain</a></li>
<li><a class="reference internal" href="#projectname-web">2.4.3.2. [projectname]-web</a></li>
<li><a class="reference internal" href="#projectname-env">2.4.3.3. [projectname]-env</a></li>
</ul>
</li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="FirstApplication.html"
                        title="previous chapter">2.3. First application based on Spring MVC</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../TutorialTodo/index.html"
                        title="next chapter">3. Tutorial (Todo Application)</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/Overview/ApplicationLayering.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="application-layering">
<h1>2.4. Application Layering<a class="headerlink" href="#application-layering" title="Permalink to this headline">¶</a></h1>
<div class="admonition caution">
  <p class="first admonition-title">Caution</p>
  <p><strong>This version is already obsolete</strong>. Please check <a href="http://terasolunaorg.github.io/guideline/">the latest guideline</a>.</p>
</div>
<div class="contents local topic" id="index">
<p class="topic-title">Index</p>
<ul class="simple">
<li><a class="reference internal" href="#layer-definition" id="id3">Layer definition</a><ul>
<li><a class="reference internal" href="#application-layer" id="id4">Application layer</a><ul>
<li><a class="reference internal" href="#controller" id="id5">Controller</a></li>
<li><a class="reference internal" href="#view" id="id6">View</a></li>
<li><a class="reference internal" href="#form" id="id7">Form</a></li>
<li><a class="reference internal" href="#helper" id="id8">Helper</a></li>
</ul>
</li>
<li><a class="reference internal" href="#domain-layer" id="id9">Domain layer</a><ul>
<li><a class="reference internal" href="#domainobject" id="id10">DomainObject</a></li>
<li><a class="reference internal" href="#repository" id="id11">Repository</a></li>
<li><a class="reference internal" href="#service" id="id12">Service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#infrastructure-layer" id="id13">Infrastructure layer</a><ul>
<li><a class="reference internal" href="#repositoryimpl" id="id14">RepositoryImpl</a></li>
<li><a class="reference internal" href="#o-r-mapper" id="id15">O/R Mapper</a></li>
<li><a class="reference internal" href="#integration-system-connector" id="id16">Integration System Connector</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#dependency-between-layers" id="id17">Dependency between layers</a></li>
<li><a class="reference internal" href="#project-structure" id="id18">Project structure</a><ul>
<li><a class="reference internal" href="#projectname-domain" id="id19">[projectname]-domain</a></li>
<li><a class="reference internal" href="#projectname-web" id="id20">[projectname]-web</a></li>
<li><a class="reference internal" href="#projectname-env" id="id21">[projectname]-env</a></li>
</ul>
</li>
</ul>
</div>
<p>In this guideline, the application is classified into the following 3 layers.</p>
<ul class="simple">
<li>Application layer</li>
<li>Domain layer</li>
<li>Infrastructure layer</li>
</ul>
<p>Each layer has the following components.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/ApplicationLayer.png"><img alt="application layers" src="../_images/ApplicationLayer.png" style="width: 80%;" /></a>
</div>
<p>Application layer as well as infrastructure layer depends on domain layer, however
<strong>domain layer should not depend on other layers.</strong>
There can be changes in the application layer with the changes in domain layer,
However, there should be no changes in domain layer with the changes in application layer.</p>
<p>Each layer is explained.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Application layer, domain layer, infrastructure layer are the terms
explained in “Domain-Driven Design (2004, Addison-Wesley)” of Eric Evans.
However, though the terms are used, they are not necessarily as per the concept used in Domain Driven Design.</p>
</div>
<div class="section" id="layer-definition">
<h2><a class="toc-backref" href="#id3">2.4.1. Layer definition</a><a class="headerlink" href="#layer-definition" title="Permalink to this headline">¶</a></h2>
<p>Flow of data from input to output is Application layer → Domain layer → Infrastructure layer,
hence explanation is given in this sequence.</p>
<div class="section" id="application-layer">
<h3><a class="toc-backref" href="#id4">2.4.1.1. Application layer</a><a class="headerlink" href="#application-layer" title="Permalink to this headline">¶</a></h3>
<p>Application layer does the wiring part of the application. It provides a UI to input/output information,
calls the domain layer by converting request information into model information and also constructs the output from the processing result.
<strong>This layer should be as thin as possible and should not contain any business rules.</strong></p>
<div class="section" id="controller">
<h4><a class="toc-backref" href="#id5">2.4.1.1.1. Controller</a><a class="headerlink" href="#controller" title="Permalink to this headline">¶</a></h4>
<p>Controller is responsible for mapping the requests to the process and passing the results to the view as well as session management.
Main logic processing must be done in Service of domain layer without performing them in the Controller.</p>
<p>In Spring MVC, POJO class having <code class="docutils literal"><span class="pre">&#64;Controller</span></code> annotation becomes the Controller class.
The output of Controller is (logical name of) the View.</p>
</div>
<div class="section" id="view">
<h4><a class="toc-backref" href="#id6">2.4.1.1.2. View</a><a class="headerlink" href="#view" title="Permalink to this headline">¶</a></h4>
<p>View generates output to the Client. Returns output results in various formats such as JSP/PDF/Excel/JSON.
In Spring MVC, all this is done by <code class="docutils literal"><span class="pre">View</span></code> class.</p>
</div>
<div class="section" id="form">
<h4><a class="toc-backref" href="#id7">2.4.1.1.3. Form</a><a class="headerlink" href="#form" title="Permalink to this headline">¶</a></h4>
<p>Represents the form of the screen. Used for sending form information to the Controller and data output from Controller to form of the screen.
Conversion from Form to DomainObject(such as Entity) and conversion from DomainObject to Form has to be done in application layer,
so that domain layer does not dependent on the application layer.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When conversion is done in controller, source code of controller can get too long and visibility of Controller’s main responsibility (like screen transition) becomes poor.
In that case, it is recommended to create helper class and delegate conversion logic to helper classes.</p>
</div>
<p>In Spring MVC, form object are the POJO class that store request parameters. It is called as form backing bean.</p>
</div>
<div class="section" id="helper">
<h4><a class="toc-backref" href="#id8">2.4.1.1.4. Helper</a><a class="headerlink" href="#helper" title="Permalink to this headline">¶</a></h4>
<p>It plays the role of assisting the Controller and performs the processes other than original duties of Controller such as mutual conversion of model
between Application layer and Domain layer. It can be considered as a part of Controller.</p>
<p>Helper is an option, and should be created as POJO class if required.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Helper class exists to improve the visibility of Controller; hence, it is OK to think of it as a part of Controller.</p>
<p>The main duty of Controller is routing (URL mapping and sepcifying the destination). If there is any processing required (converting JavaBean etc),
then that part must be cut-off from controller and must be delegated to helper classes.</p>
<p class="last">The purpose is to keep the controller class clean; hence, helper class is similar to private methods of Controller.</p>
</div>
</div>
</div>
<div class="section" id="domain-layer">
<h3><a class="toc-backref" href="#id9">2.4.1.2. Domain layer</a><a class="headerlink" href="#domain-layer" title="Permalink to this headline">¶</a></h3>
<p>Domain layer is the core of the application. Represents the business issues to be resolved and has business object and business rules
(checks like whether there is sufficient balance when crediting amount into the account).
Domain layer is not so thick as compared to other layers and is reusable.</p>
<div class="section" id="domainobject">
<h4><a class="toc-backref" href="#id10">2.4.1.2.1. DomainObject</a><a class="headerlink" href="#domainobject" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">DomainObject is a model that represents resources required for business and items generated in the business process.</div>
<div class="line">Models are broadly classified into following 3 categories.</div>
</div>
<ul class="simple">
<li>Resource models such as Employee, Customer, Product etc. (generally indicated by a noun),</li>
<li>Event models such as Order, Payment (generally indicated by a verb),</li>
<li>Summary model such as YearlySales, MonthlySales.</li>
</ul>
<p>Domain Object is the Entity that represents an object which indicates 1 record of database table.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Mainly <a class="reference external" href="http://martinfowler.com/bliki/AnemicDomainModel.html">Models holding state only</a>are handled in this guideline.</p>
<p>In “Patterns of Enterprise Application Architecture (2002, Addison-Wesley)” of Martin Fowler,
Domain Model is defined as <a class="reference external" href="http://martinfowler.com/eaaCatalog/domainModel.html">Item having state and behavior</a>.
We will not be touching such models in detail.</p>
<p class="last">In this guideline, <a class="reference external" href="http://domaindrivendesign.org">Rich domain model</a> proposed by Eric Evans is also not included.
However, it is mentioned here for classification.</p>
</div>
</div>
<div class="section" id="repository">
<h4><a class="toc-backref" href="#id11">2.4.1.2.2. Repository</a><a class="headerlink" href="#repository" title="Permalink to this headline">¶</a></h4>
<p>It can be thought of as a collection of DomainObjects and is responsible for CRUD operations such as create, read, update and delete of DomainObject.
In this layer, only interface is defined. It is implemented by RepositoryImpl of infrastructure layer. Hence, in this layer, there is no information about
how data access is implemented.</p>
</div>
<div class="section" id="service">
<h4><a class="toc-backref" href="#id12">2.4.1.2.3. Service</a><a class="headerlink" href="#service" title="Permalink to this headline">¶</a></h4>
<p>Provides the business logic. This is also the transaction boundary.</p>
<p>Information related to Web such as Form and HttpRequest should not be handled in service.
This information should be converted to object of domain layer in Application layer before calling Service.</p>
</div>
</div>
<div class="section" id="infrastructure-layer">
<h3><a class="toc-backref" href="#id13">2.4.1.3. Infrastructure layer</a><a class="headerlink" href="#infrastructure-layer" title="Permalink to this headline">¶</a></h3>
<p>Implementation (Repository interface) of domain layer is provided in infrastructure layer.
It is responsible for storing the data permanently (location where data is stored such as RDBMS, NoSQL etc.) as well as transmission of messages.</p>
<div class="section" id="repositoryimpl">
<h4><a class="toc-backref" href="#id14">2.4.1.3.1. RepositoryImpl</a><a class="headerlink" href="#repositoryimpl" title="Permalink to this headline">¶</a></h4>
<p>Represents implementation of Repository interface of domain layer. It covers life cycle management of DomainObject.
With the help of this structure, it is possible to hide implementation details from domain layer.
When using Spring Data JPA, a few RepositoryImpls are created by Spring Data JPA automatically.</p>
</div>
<div class="section" id="o-r-mapper">
<h4><a class="toc-backref" href="#id15">2.4.1.3.2. O/R Mapper</a><a class="headerlink" href="#o-r-mapper" title="Permalink to this headline">¶</a></h4>
<p>It is responsible for mapping database with Entity.
This function is provided by JPA, MyBatis and Spring JDBC.
When using JPA specifically, EntityManager can be used. In case of MyBatis2 (TERASOLUNA DAO), QueryDAO and UpdateDAO are applicable are used.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is more correct to classify MyBatis and Spring JDBC as “SQL Mapper” and not “O/R Mapper”; however, in this guideline it is treated as “O/R Mapper”.</p>
</div>
</div>
<div class="section" id="integration-system-connector">
<h4><a class="toc-backref" href="#id16">2.4.1.3.3. Integration System Connector</a><a class="headerlink" href="#integration-system-connector" title="Permalink to this headline">¶</a></h4>
<p>It links a data store other than the database; such as messaging system, Key-Value-Store, Web service, existing legacy system etc.
It also links with some external systems. Used for implementation of Repository.</p>
</div>
</div>
</div>
<div class="section" id="dependency-between-layers">
<h2><a class="toc-backref" href="#id17">2.4.2. Dependency between layers</a><a class="headerlink" href="#dependency-between-layers" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">As explained earlier, domain layer is the core of the application, and application layer and infrastructure layer are dependent on it.</div>
</div>
<div class="line-block">
<div class="line">In this guideline, it is assumed that,</div>
</div>
<ul class="simple">
<li>Spring MVC is used in application layer</li>
<li>Spring Data JPA and MyBatis are used in infrastructure layer</li>
</ul>
<div class="line-block">
<div class="line">Even if there is change in implementation technology, the differences can be absorbed in respective layers and there should not be any impact on domain layer.</div>
<div class="line">Coupling between layers is done by using interfaces and hence they can be made independent of implementation technology being used in each layer.</div>
</div>
<p>It is recommended to make loosely-coupled design by understanding the layering.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/LayerDependencies.png"><img alt="../_images/LayerDependencies.png" src="../_images/LayerDependencies.png" style="width: 80%;" /></a>
</div>
<p>Object dependency in each layer can be resolved by DI container.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/LayerDependencyInjection.png"><img alt="../_images/LayerDependencyInjection.png" src="../_images/LayerDependencyInjection.png" style="width: 90%;" /></a>
</div>
<p>The flow from input to output is given in the following figure.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/LayeringPattern1.png"><img alt="Data flow from request to response" src="../_images/LayeringPattern1.png" style="width: 100%;" /></a>
</div>
<p>Sequence is explained using the example of update operation.</p>
<ol class="arabic simple">
<li>Controller receives the Request.</li>
<li>(Optional) Controller calls Helper and converts the Form information to DomainObject or DTO.</li>
<li>Controller calls the Service by using DomainObject or DTO.</li>
<li>Service calls the Repository and executes business logic.</li>
<li>Repository calls the O/R Mapper and persists DomainObject or DTO.</li>
<li>(Implementation dependency) O/R Mapper stores DomainObject or DTO information in DB.</li>
<li>Service returns DomainObject or DTO which is the result of business logic execution to Controller.</li>
<li>(Optional) Controller calls the Helper and converts DomainObject or DTO to Form.</li>
<li>Controller returns View name of transition destination.</li>
<li>View outputs Response.</li>
</ol>
<p>Please refer to the below table to determine whether it is OK to call a component from another component.</p>
<table border="1" class="docutils" id="id1">
<caption><span class="caption-text">Possibility of calling between components</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head stub">Caller/Callee</th>
<th class="head">Controller</th>
<th class="head">Service</th>
<th class="head">Repository</th>
<th class="head">O/R Mapper</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><th class="stub">Controller</th>
<td><img alt="../_images/cross.png" class="first last align-center" src="../_images/cross.png" />
</td>
<td><img alt="../_images/tick.png" class="first last align-center" src="../_images/tick.png" />
</td>
<td><img alt="../_images/cross.png" class="first last align-center" src="../_images/cross.png" />
</td>
<td><img alt="../_images/cross.png" class="first last align-center" src="../_images/cross.png" />
</td>
</tr>
<tr class="row-odd"><th class="stub">Service</th>
<td><img alt="../_images/cross.png" class="first last align-center" src="../_images/cross.png" />
</td>
<td><img alt="../_images/exclamation.png" class="first last align-center" src="../_images/exclamation.png" />
</td>
<td><img alt="../_images/tick.png" class="first last align-center" src="../_images/tick.png" />
</td>
<td><img alt="../_images/cross.png" class="first last align-center" src="../_images/cross.png" />
</td>
</tr>
<tr class="row-even"><th class="stub">Repository</th>
<td><img alt="../_images/cross.png" class="first last align-center" src="../_images/cross.png" />
</td>
<td><img alt="../_images/cross.png" class="first last align-center" src="../_images/cross.png" />
</td>
<td><img alt="../_images/cross.png" class="first last align-center" src="../_images/cross.png" />
</td>
<td><img alt="../_images/tick.png" class="first last align-center" src="../_images/tick.png" />
</td>
</tr>
</tbody>
</table>
<p>Note that <strong>calling a Service from another Service is basically prohibited</strong>.
If services that can be used even from other services are required,
SharedService should be created in order to clarify such a possibility.
Refer to <a class="reference internal" href="../ImplementationAtEachLayer/DomainLayer.html"><span class="doc">Domain Layer Implementation</span></a> for the details.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It may be difficult to follow the above rules at the initial phase of application development.
If looking at a very small application, it can be created quickly by directly calling the Repository from Controller.
However, when rules are not followed, there will be many maintainability issues when development scope becoms larger. It may be difficult to understand the impact of modifications and to add common logic which is cross-cutting in nature.
It is strongly recommended to pay attention to dependency from the beginning of development so that there will be no problem later on.</p>
</div>
<p>Hiding the implementation details and sharing of data access logic are the merits of creating a Repository.
However, it is difficult to share data access logic depending on the project team structure (multiple companies may separately implement business processes and control on sharing may be difficult etc.)
In such cases, if abstraction of data access is not required, O/R Mapper can be called directly from Service as shown in the following diagram, without creating the repository.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/LayeringPattern2.png"><img alt="Data flow from request to response (without Repository)" src="../_images/LayeringPattern2.png" style="width: 100%;" /></a>
</div>
<p>Inter-dependency between components in this case must be as shown below:</p>
<table border="1" class="docutils" id="id2">
<caption><span class="caption-text">Inter-dependency between components (without Repository)</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head stub">Caller/Callee</th>
<th class="head">Controller</th>
<th class="head">Service</th>
<th class="head">O/R Mapper</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><th class="stub">Controller</th>
<td><img alt="../_images/cross.png" class="first last align-center" src="../_images/cross.png" />
</td>
<td><img alt="../_images/tick.png" class="first last align-center" src="../_images/tick.png" />
</td>
<td><img alt="../_images/cross.png" class="first last align-center" src="../_images/cross.png" />
</td>
</tr>
<tr class="row-odd"><th class="stub">Service</th>
<td><img alt="../_images/cross.png" class="first last align-center" src="../_images/cross.png" />
</td>
<td><img alt="../_images/exclamation.png" class="first last align-center" src="../_images/exclamation.png" />
</td>
<td><img alt="../_images/tick.png" class="first last align-center" src="../_images/tick.png" />
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="project-structure">
<span id="application-layering-project-structure"></span><h2><a class="toc-backref" href="#id18">2.4.3. Project structure</a><a class="headerlink" href="#project-structure" title="Permalink to this headline">¶</a></h2>
<p>Here, recommended project structure is explained when application layering is done as described earlier.</p>
<p>The standard maven directory structure is pre-requisite.</p>
<p>Basically, it is recommended to create the multiple projects with the following configuration.</p>
<ul class="simple">
<li>[projectname]-domain … Project for storing classes/configuration files related to domain layer</li>
<li>[projectname]-web … Project for storing classes/configuration files related to application layer</li>
<li>[projectname]-env … Project for storing files dependent on environment</li>
</ul>
<p>([projectname] is the target project name)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Classes of infrastructure layer such as RepositoryImpl are also included in project-domain.
Originally, [projectname]-infra project should be created separately; however, normally there
is no need to conceal the implementation details in the infra project and development becomes easy if implementation is also stored in domain project.
Moreover, when required, [projectname]-infra project can be created.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">For the example of multi-project structure, refer to <a class="reference external" href="https://github.com/terasolunaorg/terasoluna-tourreservation">Sample Application</a> or <a class="reference external" href="https://github.com/terasolunaorg/terasoluna-gfw-functionaltest">Test Application of Common Library</a>.</p>
</div>
<div class="section" id="projectname-domain">
<h3><a class="toc-backref" href="#id19">2.4.3.1. [projectname]-domain</a><a class="headerlink" href="#projectname-domain" title="Permalink to this headline">¶</a></h3>
<p>Recommended structure of [projectname]-domain project is as below:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">[projectName]-domain</span>
<span class="go">  └src</span>
<span class="go">      └main</span>
<span class="go">          ├java</span>
<span class="go">          │  └com</span>
<span class="go">          │      └example</span>
<span class="go">          │          └domain ...(1)</span>
<span class="go">          │              ├model</span>
<span class="go">          │              │  ├Xxx.java</span>
<span class="go">          │              │  ├Yyy.java</span>
<span class="go">          │              │  └Zzz.java</span>
<span class="go">          │              ├repository ...(2)</span>
<span class="go">          │              │  ├xxx</span>
<span class="go">          │              │  │  └XxxRepository.java</span>
<span class="go">          │              │  ├yyy</span>
<span class="go">          │              │  │  └YyyRepository.java</span>
<span class="go">          │              │  └zzz</span>
<span class="go">          │              │      ├ZzzRepository.java</span>
<span class="go">          │              │      └ZzzRepositoryImpl.java</span>
<span class="go">          │              └service ...(3)</span>
<span class="go">          │                  ├aaa</span>
<span class="go">          │                  │  ├AaaService.java</span>
<span class="go">          │                  │  └AaaServiceImpl.java</span>
<span class="go">          │                  └bbb</span>
<span class="go">          │                      ├BbbService.java</span>
<span class="go">          │                      └BbbServiceImpl.java</span>
<span class="go">          └resources</span>
<span class="go">              └META-INF</span>
<span class="go">                  └spring</span>
<span class="go">                      ├[projectname]-domain.xml ...(4)</span>
<span class="go">                      └[projectname]-infra.xml ...(5)</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">No.</th>
<th class="head">Details</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Store DomainObjects</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Store Repository interfaces. Create a separate package for each Entity.</div>
<div class="line">If there are associated Entities to the main entity, then Repository interfaces of associated Entities must also be placed in the same package as main Entity.</div>
<div class="line">(For example, Order and OrderLine). If DTO is also required, it too must be placed in this package.</div>
<div class="line">RepositoryImpl belongs to Infrastructure layer; however, there is no problem in keeping it in this project.</div>
<div class="line">In case of using different data stores or existance of multiple persistence platforms, RepositoryImpl class must be kept in separate project or separate package so that implementation related details are concealed.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Service classes are kept here. Package must be created based on Entity Model or other functional unit. Interface and Implementation class must be kept at the same level of package.</div>
<div class="line">If input/output classes are also required, then they must be placed in this package.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Bean definition pertaining to domain layer.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Bean definition pertaining to infrastructure layer.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="projectname-web">
<h3><a class="toc-backref" href="#id20">2.4.3.2. [projectname]-web</a><a class="headerlink" href="#projectname-web" title="Permalink to this headline">¶</a></h3>
<p>Recommended structure of [projectname]-web</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">[projectName]-web</span>
<span class="go">  └src</span>
<span class="go">      └main</span>
<span class="go">          ├java</span>
<span class="go">          │  └com</span>
<span class="go">          │      └example</span>
<span class="go">          │          └app ...(1)</span>
<span class="go">          │              ├abc</span>
<span class="go">          │              │  ├AbcController.java</span>
<span class="go">          │              │  ├AbcForm.java</span>
<span class="go">          │              │  └AbcHelper.java</span>
<span class="go">          │              └def</span>
<span class="go">          │                  ├DefController.java</span>
<span class="go">          │                  ├DefForm.java</span>
<span class="go">          │                  └DefOutput.java</span>
<span class="go">          ├resources</span>
<span class="go">          │  ├META-INF</span>
<span class="go">          │  │  └spring</span>
<span class="go">          │  │      ├applicationContext.xml ...(2)</span>
<span class="go">          │  │      ├application.properties ...(3)</span>
<span class="go">          │  │      ├spring-mvc.xml ...(4)</span>
<span class="go">          │  │      └spring-security.xml ...(5)</span>
<span class="go">          │  └i18n</span>
<span class="go">          │      └application-messages.properties ...(6)</span>
<span class="go">          └webapp</span>
<span class="go">              └WEB-INF</span>
<span class="go">                  ├views ...(7)</span>
<span class="go">                  │  ├abc</span>
<span class="go">                  │  │ ├list.jsp</span>
<span class="go">                  │  │ └createForm.jsp</span>
<span class="go">                  │  └def</span>
<span class="go">                  │     ├list.jsp</span>
<span class="go">                  │     └createForm.jsp</span>
<span class="go">                  └web.xml</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">No,</th>
<th class="head">Details</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Package to store configuration elements of application layer.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Bean definited related to the entire application.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define the properties to be used in the application.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Bean definitions related to Spring MVC.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Bean definitions related to Spring Security</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define the messages and other contents to be used for screen display (internationalization).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Store View(jsp) files.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="projectname-env">
<h3><a class="toc-backref" href="#id21">2.4.3.3. [projectname]-env</a><a class="headerlink" href="#projectname-env" title="Permalink to this headline">¶</a></h3>
<p>The recommended structure of [projectname]-env project is below:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">[projectName]-env</span>
<span class="go">  └src</span>
<span class="go">      └main</span>
<span class="go">          └resources</span>
<span class="go">              └META-INF</span>
<span class="go">                  └spring</span>
<span class="go">                      ├[projectname]-env.xml ...(1)</span>
<span class="go">                      └[projectname]-infra.properties ...(2)</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">No.</th>
<th class="head">Details</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Bean definitions that depend on the environment (like dataSource etc).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Property definitions which depend on the environment.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The purpose of separating [projectname]-domain and [projectname]-web into different projects is to prevent reverse dependency among them.</p>
<p>It is natural that [projectname]-web uses [projectname]-domain; however, [projectname]-domain must not refer projectname]-web.</p>
<p class="last">If configruation elements of both, [projectname]-web and [projectname]-domain, are kept in a single project, it may lead to an incorrect reference by mistake.
It is strongly recommended to prevent reference to [projectname]-web from [projectname]-domain by separating the project and setting order of reference.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The reason for creating [projectname]-env is to separate the information depending on the environment and thereby enable switching of environment.</p>
<p>For example, set local development environment by default and at the time of building the application, create war file without including [projectname]-env.
By creating a separate jar for integration test environment or system test environment, deployment becomes possible just by replacing the jar of corresponding environment.</p>
<p>Further, it is also possible to minimize the changes in case of project where RDBMS being used changes.</p>
<p>If the above point is not considered, contents of configuration files have to changed according to the target environment and the project has to be re-build.</p>
<p class="last">For further details regarding significance of creating a separate project for environment dependent files, refer to <a class="reference internal" href="../Appendix/EnvironmentIndependency.html"><span class="doc">[coming soon] Exclude Environmental Dependencies</span></a>.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../TutorialTodo/index.html" title="3. Tutorial (Todo Application)"
             >next</a> |</li>
        <li class="right" >
          <a href="FirstApplication.html" title="2.3. First application based on Spring MVC"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Global Framework Development Guideline 1.0.1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >2. Summary - Architecture of TERASOLUNA Global Framework</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013-2014, NTT DATA.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.3.Theme by <a href="http://github.com/vkvn">vkvn</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>
