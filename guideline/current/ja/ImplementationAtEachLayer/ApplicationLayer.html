<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>3.4. アプリケーション層の実装 &#8212; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.9.0.RELEASE documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/solar.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/tabs.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3.5. 開発プロジェクトのビルド" href="CreateProject.html" />
    <link rel="prev" title="3.3. インフラストラクチャ層の実装" href="InfrastructureLayer.html" /><script src="../_static/jquery.js" type="text/javascript"></script>
<script src="../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../_static/solarized-dark.css" rel="stylesheet">
<link href="../_static/jquery.treeview.css" rel="stylesheet">
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="CreateProject.html" title="3.5. 開発プロジェクトのビルド"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="InfrastructureLayer.html" title="3.3. インフラストラクチャ層の実装"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.9.0.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U"><span class="section-number">3. </span>アプリケーション開発</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">3.4. </span>アプリケーション層の実装</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox"> scroll sidebar</label>
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">3.4. アプリケーション層の実装</a><ul>
<li><a class="reference internal" href="#controller">3.4.1. Controllerの実装</a><ul>
<li><a class="reference internal" href="#controller-new-label">3.4.1.1. Controllerクラスの作成方法</a></li>
<li><a class="reference internal" href="#controller-mapping-label">3.4.1.2. リクエストとハンドラメソッドのマッピング方法</a><ul>
<li><a class="reference internal" href="#http">3.4.1.2.1. HTTPメソッドでマッピング</a></li>
<li><a class="reference internal" href="#controller-mapping-path-label">3.4.1.2.2. リクエストパスでマッピング</a></li>
<li><a class="reference internal" href="#controller-mapping-params-label">3.4.1.2.3. リクエストパラメータでマッピング</a></li>
<li><a class="reference internal" href="#controller-mapping-headers-label">3.4.1.2.4. リクエストヘッダでマッピング</a></li>
<li><a class="reference internal" href="#content-type">3.4.1.2.5. Content-Typeヘッダでマッピング</a></li>
<li><a class="reference internal" href="#accept">3.4.1.2.6. Acceptヘッダでマッピング</a></li>
</ul>
</li>
<li><a class="reference internal" href="#controller-mapping-policy-label">3.4.1.3. リクエストとハンドラメソッドのマッピング方針</a><ul>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-overview-label">3.4.1.3.1. サンプルアプリケーションの概要</a></li>
<li><a class="reference internal" href="#url">3.4.1.3.2. リクエストURL</a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-mapping-design-label">3.4.1.3.3. リクエストとハンドラメソッドのマッピング</a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-form-impl-label">3.4.1.3.4. フォーム表示の実装</a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-confirm-impl-label">3.4.1.3.5. 入力内容確認表示の実装</a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-redo-impl-label">3.4.1.3.6. フォーム再表示の実装</a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-create-impl-label">3.4.1.3.7. 新規作成の実装</a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-complete-impl-label">3.4.1.3.8. 新規作成完了表示の実装</a></li>
<li><a class="reference internal" href="#html-form">3.4.1.3.9. HTML form上に複数のボタンを配置する場合の実装</a></li>
<li><a class="reference internal" href="#controller-mapping-policy-sampleapp-all-impl-label">3.4.1.3.10. サンプルアプリケーションのControllerのソースコード</a></li>
</ul>
</li>
<li><a class="reference internal" href="#controller-method-argument-label">3.4.1.4. ハンドラメソッドの引数について</a><ul>
<li><a class="reference internal" href="#view">3.4.1.4.1. 画面(View)にデータを渡す</a></li>
<li><a class="reference internal" href="#controller-method-argument-pathvariable-label">3.4.1.4.2. URLのパスから値を取得する</a></li>
<li><a class="reference internal" href="#controller-method-argument-requestparam-label">3.4.1.4.3. リクエストパラメータを個別に取得する</a></li>
<li><a class="reference internal" href="#controller-method-argument-form-label">3.4.1.4.4. リクエストパラメータをまとめて取得する</a></li>
<li><a class="reference internal" href="#controller-method-argument-validation-label">3.4.1.4.5. 入力チェックを行う</a></li>
<li><a class="reference internal" href="#controller-method-argument-redirectattributes-label">3.4.1.4.6. リダイレクト先にデータを渡す</a></li>
<li><a class="reference internal" href="#controller-method-argument-redirectattributes-param-label">3.4.1.4.7. リダイレクト先へリクエストパラメータを渡す</a></li>
<li><a class="reference internal" href="#controller-method-argument-redirectattributes-path-label">3.4.1.4.8. リダイレクト先URLのパスに値を埋め込む</a></li>
<li><a class="reference internal" href="#cookie">3.4.1.4.9. Cookieから値を取得する</a></li>
<li><a class="reference internal" href="#controller-method-argument-cookiewrite-label">3.4.1.4.10. Cookieに値を書き込む</a></li>
<li><a class="reference internal" href="#controller-method-argument-pagination-label">3.4.1.4.11. ページネーション情報を取得する</a></li>
<li><a class="reference internal" href="#controller-method-argument-upload-label">3.4.1.4.12. アップロードファイルを取得する</a></li>
<li><a class="reference internal" href="#controller-method-argument-message-label">3.4.1.4.13. 画面に結果メッセージを表示する</a></li>
</ul>
</li>
<li><a class="reference internal" href="#controller-method-return-label">3.4.1.5. ハンドラメソッドの返り値について</a><ul>
<li><a class="reference internal" href="#html">3.4.1.5.1. HTMLを応答する</a></li>
<li><a class="reference internal" href="#controller-method-return-download-label">3.4.1.5.2. ダウンロードデータを応答する</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id36">3.4.1.6. 処理の実装</a><ul>
<li><a class="reference internal" href="#controller-logic-correlationcheck-label">3.4.1.6.1. 入力値の相関チェック</a></li>
<li><a class="reference internal" href="#controller-logic-businesslogic-label">3.4.1.6.2. 業務処理の呼び出し</a></li>
<li><a class="reference internal" href="#controller-logic-domainobject-label">3.4.1.6.3. ドメインオブジェクトへの値反映</a></li>
<li><a class="reference internal" href="#controller-logic-formobject-label">3.4.1.6.4. フォームオブジェクトへの値反映</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#formobject">3.4.2. フォームオブジェクトの実装</a><ul>
<li><a class="reference internal" href="#formobject-new-label">3.4.2.1. フォームオブジェクトの作成方法</a><ul>
<li><a class="reference internal" href="#id43">3.4.2.1.1. フィールド単位の数値型変換</a></li>
<li><a class="reference internal" href="#applicationlayer-datetimeformat">3.4.2.1.2. フィールド単位の日時型変換</a></li>
<li><a class="reference internal" href="#id45">3.4.2.1.3. Controller単位の型変換</a></li>
<li><a class="reference internal" href="#id46">3.4.2.1.4. 入力チェック用のアノテーションの指定</a></li>
</ul>
</li>
<li><a class="reference internal" href="#formobject-init-label">3.4.2.2. フォームオブジェクトの初期化方法</a></li>
<li><a class="reference internal" href="#formobject-bindhtmlform-label">3.4.2.3. HTMLへのバインディング方法</a></li>
<li><a class="reference internal" href="#formobject-bindrequestparam-label">3.4.2.4. リクエストパラメータのバインディング方法</a><ul>
<li><a class="reference internal" href="#id50">3.4.2.4.1. バインディング結果の判定</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id51">3.4.3. Viewの実装</a><ul>
<li><a class="reference internal" href="#jspthymeleafhtml">3.4.3.1. JSPおよびThymeleafのテンプレートHTMLの実装</a><ul>
<li><a class="reference internal" href="#jsp">3.4.3.1.1. インクルード用の共通JSPの作成</a></li>
<li><a class="reference internal" href="#view-jsp-out-label">3.4.3.1.2. モデルに格納されている値を表示する</a></li>
<li><a class="reference internal" href="#view-jsp-outnumber-label">3.4.3.1.3. モデルに格納されている数値を表示する</a></li>
<li><a class="reference internal" href="#view-jsp-outdate-label">3.4.3.1.4. モデルに格納されている日時を表示する</a></li>
<li><a class="reference internal" href="#view-jsp-requesturl-label">3.4.3.1.5. リクエストURLを生成する</a></li>
<li><a class="reference internal" href="#view-jsp-form-label">3.4.3.1.6. HTML formへフォームオブジェクトをバインドする</a></li>
<li><a class="reference internal" href="#view-jsp-errors-label">3.4.3.1.7. 入力チェックエラーを表示する</a></li>
<li><a class="reference internal" href="#view-jsp-resultmessages-label">3.4.3.1.8. 処理結果のメッセージを表示する</a></li>
<li><a class="reference internal" href="#view-jsp-codelist-label">3.4.3.1.9. コードリストを表示する</a></li>
<li><a class="reference internal" href="#view-jsp-message-label">3.4.3.1.10. 固定文言を表示する</a></li>
<li><a class="reference internal" href="#view-jsp-if-label">3.4.3.1.11. 条件によって表示を切り替える</a></li>
<li><a class="reference internal" href="#view-jsp-foreach-label">3.4.3.1.12. コレクションの要素に対して表示処理を繰り返す</a></li>
<li><a class="reference internal" href="#view-jsp-pagination-label">3.4.3.1.13. ページネーション用のリンクを表示する</a></li>
<li><a class="reference internal" href="#view-jsp-authorization-label">3.4.3.1.14. 権限によって表示を切り替える</a></li>
</ul>
</li>
<li><a class="reference internal" href="#thymeleafhtml">3.4.3.2. ThymeleafのテンプレートHTMLの実装</a><ul>
<li><a class="reference internal" href="#thymeleaf">3.4.3.2.1. Thymeleafのネームスペースを設定する</a></li>
<li><a class="reference internal" href="#view-thymeleaf-text-label">3.4.3.2.2. モデルに格納されている値を表示する</a></li>
<li><a class="reference internal" href="#view-thymeleaf-numbers-label">3.4.3.2.3. モデルに格納されている数値を表示する</a></li>
<li><a class="reference internal" href="#view-thymeleaf-dates-label">3.4.3.2.4. モデルに格納されている日時を表示する</a></li>
<li><a class="reference internal" href="#view-thymeleaf-requesturl-label">3.4.3.2.5. リクエストURLを生成する</a></li>
<li><a class="reference internal" href="#view-thymeleaf-message-label">3.4.3.2.6. メッセージを表示する</a></li>
<li><a class="reference internal" href="#view-thymeleaf-textcombine-label">3.4.3.2.7. 文字列を組み立てる</a></li>
<li><a class="reference internal" href="#view-thymeleaf-conditional-label">3.4.3.2.8. 条件を判定する</a></li>
<li><a class="reference internal" href="#view-thymeleaf-if-label">3.4.3.2.9. 条件によって表示を切り替える</a></li>
<li><a class="reference internal" href="#view-thymeleaf-each-label">3.4.3.2.10. コレクションの要素に対して表示処理を繰り返す</a></li>
<li><a class="reference internal" href="#view-thymeleaf-object-label">3.4.3.2.11. オブジェクトのプロパティを省略して指定する</a></li>
<li><a class="reference internal" href="#view-thymeleaf-with-label">3.4.3.2.12. ローカル変数を定義する</a></li>
<li><a class="reference internal" href="#view-thymeleaf-preprocessing-label">3.4.3.2.13. プリプロセッシング</a></li>
<li><a class="reference internal" href="#view-thymeleaf-form-label">3.4.3.2.14. フォームオブジェクトのプロパティをバインドする</a></li>
<li><a class="reference internal" href="#view-thymeleaf-errors-label">3.4.3.2.15. 入力チェックエラーを表示する</a></li>
<li><a class="reference internal" href="#view-thymeleaf-resultmessages-label">3.4.3.2.16. 処理結果のメッセージを表示する</a></li>
<li><a class="reference internal" href="#view-thymeleaf-codelist-label">3.4.3.2.17. コードリストを表示する</a></li>
<li><a class="reference internal" href="#view-thymeleaf-pagination-label">3.4.3.2.18. ページネーション用のリンクを表示する</a></li>
<li><a class="reference internal" href="#view-thymeleaf-authorization-label">3.4.3.2.19. 権限によって表示を切り替える</a></li>
</ul>
</li>
<li><a class="reference internal" href="#javascript">3.4.3.3. JavaScriptの実装</a></li>
<li><a class="reference internal" href="#id88">3.4.3.4. スタイルシートの実装</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id89">3.4.4. 共通処理の実装</a><ul>
<li><a class="reference internal" href="#controller-common-process">3.4.4.1. Controllerの呼び出し前後で行う共通処理の実装</a><ul>
<li><a class="reference internal" href="#servlet-filter">3.4.4.1.1. Servlet Filterの実装</a></li>
<li><a class="reference internal" href="#handlerinterceptor">3.4.4.1.2. HandlerInterceptorの実装</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id91">3.4.4.2. Controllerの共通処理の実装</a><ul>
<li><a class="reference internal" href="#handlermethodargumentresolver">3.4.4.2.1. HandlerMethodArgumentResolverの実装</a></li>
<li><a class="reference internal" href="#controlleradvice">3.4.4.2.2. <code class="docutils literal notranslate"><span class="pre">&#64;ControllerAdvice</span></code>の実装</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id92">3.4.5. 二重送信防止について</a></li>
<li><a class="reference internal" href="#id93">3.4.6. セッションの使用について</a></li>
<li><a class="reference internal" href="#appendix">3.4.7. Appendix</a><ul>
<li><a class="reference internal" href="#value">3.4.7.1. 引数に付与するアノテーションのvalue属性の省略</a></li>
<li><a class="reference internal" href="#spring-mvc">3.4.7.2. Spring MVCのパスパターンマッチングにおける拡張子および末尾<code class="docutils literal notranslate"><span class="pre">/</span></code>の考慮</a><ul>
<li><a class="reference internal" href="#suffix-match">3.4.7.2.1. Suffix Match</a></li>
<li><a class="reference internal" href="#id94">3.4.7.2.2. Trailing Slash</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="InfrastructureLayer.html"
                          title="previous chapter"><span class="section-number">3.3. </span>インフラストラクチャ層の実装</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="CreateProject.html"
                          title="next chapter"><span class="section-number">3.5. </span>開発プロジェクトのビルド</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/ImplementationAtEachLayer/ApplicationLayer.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="id1">
<h1><span class="section-number">3.4. </span>アプリケーション層の実装<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="id2">
<p class="topic-title">目次</p>
<ul class="simple">
<li><p><a class="reference internal" href="#controller" id="id102">Controllerの実装</a></p>
<ul>
<li><p><a class="reference internal" href="#controller-new-label" id="id103">Controllerクラスの作成方法</a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-label" id="id104">リクエストとハンドラメソッドのマッピング方法</a></p>
<ul>
<li><p><a class="reference internal" href="#http" id="id105">HTTPメソッドでマッピング</a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-path-label" id="id106">リクエストパスでマッピング</a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-params-label" id="id107">リクエストパラメータでマッピング</a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-headers-label" id="id108">リクエストヘッダでマッピング</a></p></li>
<li><p><a class="reference internal" href="#content-type" id="id109">Content-Typeヘッダでマッピング</a></p></li>
<li><p><a class="reference internal" href="#accept" id="id110">Acceptヘッダでマッピング</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#controller-mapping-policy-label" id="id111">リクエストとハンドラメソッドのマッピング方針</a></p>
<ul>
<li><p><a class="reference internal" href="#controller-mapping-policy-sampleapp-overview-label" id="id112">サンプルアプリケーションの概要</a></p></li>
<li><p><a class="reference internal" href="#url" id="id113">リクエストURL</a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-policy-sampleapp-mapping-design-label" id="id114">リクエストとハンドラメソッドのマッピング</a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-policy-sampleapp-form-impl-label" id="id115">フォーム表示の実装</a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-policy-sampleapp-confirm-impl-label" id="id116">入力内容確認表示の実装</a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-policy-sampleapp-redo-impl-label" id="id117">フォーム再表示の実装</a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-policy-sampleapp-create-impl-label" id="id118">新規作成の実装</a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-policy-sampleapp-complete-impl-label" id="id119">新規作成完了表示の実装</a></p></li>
<li><p><a class="reference internal" href="#html-form" id="id120">HTML form上に複数のボタンを配置する場合の実装</a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-policy-sampleapp-all-impl-label" id="id121">サンプルアプリケーションのControllerのソースコード</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#controller-method-argument-label" id="id122">ハンドラメソッドの引数について</a></p>
<ul>
<li><p><a class="reference internal" href="#view" id="id123">画面(View)にデータを渡す</a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-pathvariable-label" id="id124">URLのパスから値を取得する</a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-requestparam-label" id="id125">リクエストパラメータを個別に取得する</a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-form-label" id="id126">リクエストパラメータをまとめて取得する</a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-validation-label" id="id127">入力チェックを行う</a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-redirectattributes-label" id="id128">リダイレクト先にデータを渡す</a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-redirectattributes-param-label" id="id129">リダイレクト先へリクエストパラメータを渡す</a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-redirectattributes-path-label" id="id130">リダイレクト先URLのパスに値を埋め込む</a></p></li>
<li><p><a class="reference internal" href="#cookie" id="id131">Cookieから値を取得する</a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-cookiewrite-label" id="id132">Cookieに値を書き込む</a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-pagination-label" id="id133">ページネーション情報を取得する</a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-upload-label" id="id134">アップロードファイルを取得する</a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-message-label" id="id135">画面に結果メッセージを表示する</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#controller-method-return-label" id="id136">ハンドラメソッドの返り値について</a></p>
<ul>
<li><p><a class="reference internal" href="#html" id="id137">HTMLを応答する</a></p></li>
<li><p><a class="reference internal" href="#controller-method-return-download-label" id="id138">ダウンロードデータを応答する</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id36" id="id139">処理の実装</a></p>
<ul>
<li><p><a class="reference internal" href="#controller-logic-correlationcheck-label" id="id140">入力値の相関チェック</a></p></li>
<li><p><a class="reference internal" href="#controller-logic-businesslogic-label" id="id141">業務処理の呼び出し</a></p></li>
<li><p><a class="reference internal" href="#controller-logic-domainobject-label" id="id142">ドメインオブジェクトへの値反映</a></p></li>
<li><p><a class="reference internal" href="#controller-logic-formobject-label" id="id143">フォームオブジェクトへの値反映</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#formobject" id="id144">フォームオブジェクトの実装</a></p>
<ul>
<li><p><a class="reference internal" href="#formobject-new-label" id="id145">フォームオブジェクトの作成方法</a></p>
<ul>
<li><p><a class="reference internal" href="#id43" id="id146">フィールド単位の数値型変換</a></p></li>
<li><p><a class="reference internal" href="#applicationlayer-datetimeformat" id="id147">フィールド単位の日時型変換</a></p></li>
<li><p><a class="reference internal" href="#id45" id="id148">Controller単位の型変換</a></p></li>
<li><p><a class="reference internal" href="#id46" id="id149">入力チェック用のアノテーションの指定</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#formobject-init-label" id="id150">フォームオブジェクトの初期化方法</a></p></li>
<li><p><a class="reference internal" href="#formobject-bindhtmlform-label" id="id151">HTMLへのバインディング方法</a></p></li>
<li><p><a class="reference internal" href="#formobject-bindrequestparam-label" id="id152">リクエストパラメータのバインディング方法</a></p>
<ul>
<li><p><a class="reference internal" href="#id50" id="id153">バインディング結果の判定</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#id51" id="id154">Viewの実装</a></p>
<ul>
<li><p><a class="reference internal" href="#jspthymeleafhtml" id="id155">JSPおよびThymeleafのテンプレートHTMLの実装</a></p>
<ul>
<li><p><a class="reference internal" href="#jsp" id="id156">インクルード用の共通JSPの作成</a></p></li>
<li><p><a class="reference internal" href="#view-jsp-out-label" id="id157">モデルに格納されている値を表示する</a></p></li>
<li><p><a class="reference internal" href="#view-jsp-outnumber-label" id="id158">モデルに格納されている数値を表示する</a></p></li>
<li><p><a class="reference internal" href="#view-jsp-outdate-label" id="id159">モデルに格納されている日時を表示する</a></p></li>
<li><p><a class="reference internal" href="#view-jsp-requesturl-label" id="id160">リクエストURLを生成する</a></p></li>
<li><p><a class="reference internal" href="#view-jsp-form-label" id="id161">HTML formへフォームオブジェクトをバインドする</a></p></li>
<li><p><a class="reference internal" href="#view-jsp-errors-label" id="id162">入力チェックエラーを表示する</a></p></li>
<li><p><a class="reference internal" href="#view-jsp-resultmessages-label" id="id163">処理結果のメッセージを表示する</a></p></li>
<li><p><a class="reference internal" href="#view-jsp-codelist-label" id="id164">コードリストを表示する</a></p></li>
<li><p><a class="reference internal" href="#view-jsp-message-label" id="id165">固定文言を表示する</a></p></li>
<li><p><a class="reference internal" href="#view-jsp-if-label" id="id166">条件によって表示を切り替える</a></p></li>
<li><p><a class="reference internal" href="#view-jsp-foreach-label" id="id167">コレクションの要素に対して表示処理を繰り返す</a></p></li>
<li><p><a class="reference internal" href="#view-jsp-pagination-label" id="id168">ページネーション用のリンクを表示する</a></p></li>
<li><p><a class="reference internal" href="#view-jsp-authorization-label" id="id169">権限によって表示を切り替える</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#thymeleafhtml" id="id170">ThymeleafのテンプレートHTMLの実装</a></p>
<ul>
<li><p><a class="reference internal" href="#thymeleaf" id="id171">Thymeleafのネームスペースを設定する</a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-text-label" id="id172">モデルに格納されている値を表示する</a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-numbers-label" id="id173">モデルに格納されている数値を表示する</a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-dates-label" id="id174">モデルに格納されている日時を表示する</a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-requesturl-label" id="id175">リクエストURLを生成する</a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-message-label" id="id176">メッセージを表示する</a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-textcombine-label" id="id177">文字列を組み立てる</a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-conditional-label" id="id178">条件を判定する</a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-if-label" id="id179">条件によって表示を切り替える</a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-each-label" id="id180">コレクションの要素に対して表示処理を繰り返す</a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-object-label" id="id181">オブジェクトのプロパティを省略して指定する</a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-with-label" id="id182">ローカル変数を定義する</a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-preprocessing-label" id="id183">プリプロセッシング</a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-form-label" id="id184">フォームオブジェクトのプロパティをバインドする</a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-errors-label" id="id185">入力チェックエラーを表示する</a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-resultmessages-label" id="id186">処理結果のメッセージを表示する</a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-codelist-label" id="id187">コードリストを表示する</a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-pagination-label" id="id188">ページネーション用のリンクを表示する</a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-authorization-label" id="id189">権限によって表示を切り替える</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#javascript" id="id190">JavaScriptの実装</a></p></li>
<li><p><a class="reference internal" href="#id88" id="id191">スタイルシートの実装</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id89" id="id192">共通処理の実装</a></p>
<ul>
<li><p><a class="reference internal" href="#controller-common-process" id="id193">Controllerの呼び出し前後で行う共通処理の実装</a></p>
<ul>
<li><p><a class="reference internal" href="#servlet-filter" id="id194">Servlet Filterの実装</a></p></li>
<li><p><a class="reference internal" href="#handlerinterceptor" id="id195">HandlerInterceptorの実装</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id91" id="id196">Controllerの共通処理の実装</a></p>
<ul>
<li><p><a class="reference internal" href="#handlermethodargumentresolver" id="id197">HandlerMethodArgumentResolverの実装</a></p></li>
<li><p><a class="reference internal" href="#controlleradvice" id="id198"><code class="docutils literal notranslate"><span class="pre">&#64;ControllerAdvice</span></code>の実装</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#id92" id="id199">二重送信防止について</a></p></li>
<li><p><a class="reference internal" href="#id93" id="id200">セッションの使用について</a></p></li>
<li><p><a class="reference internal" href="#appendix" id="id201">Appendix</a></p>
<ul>
<li><p><a class="reference internal" href="#value" id="id202">引数に付与するアノテーションのvalue属性の省略</a></p></li>
<li><p><a class="reference internal" href="#spring-mvc" id="id203">Spring MVCのパスパターンマッチングにおける拡張子および末尾<code class="docutils literal notranslate"><span class="pre">/</span></code>の考慮</a></p>
<ul>
<li><p><a class="reference internal" href="#suffix-match" id="id204">Suffix Match</a></p></li>
<li><p><a class="reference internal" href="#id94" id="id205">Trailing Slash</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>本節では、HTML formを使った画面遷移型のアプリケーションにおけるアプリケーション層の実装について説明する。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ajaxの開発やREST APIの開発で必要となる実装についての説明は以下のページを参照されたい。</p>
<ul class="simple">
<li><p><a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Ajax.html"><span class="doc">Ajax</span></a></p></li>
</ul>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>アプリケーション層の実装は、以下の3つにわかれる。</p>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><a class="reference internal" href="#controller-label"><span class="std std-ref">Controllerの実装</span></a></div>
<div class="line">Controllerは、リクエストの受付、業務処理の呼び出し、モデルの更新、Viewの決定といった処理を行い、リクエストを受けてからの一連の処理フローを制御する。</div>
<div class="line">アプリケーション層の実装において、もっとも重要な実装となる。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><a class="reference internal" href="#formobject"><span class="std std-ref">フォームオブジェクトの実装</span></a></div>
<div class="line">フォームオブジェクトは、HTML formとアプリケーションの間での値の受け渡しを行う。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><a class="reference internal" href="#id51"><span class="std std-ref">Viewの実装</span></a></div>
<div class="line">View(JSP/Thymeleaf)は、モデル（フォームオブジェクトやドメインオブジェクトなど）からデータを取得し、画面(HTML)を生成する。</div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="controller">
<span id="controller-label"></span><h2><a class="toc-backref" href="#id102" role="doc-backlink"><span class="section-number">3.4.1. </span>Controllerの実装</a><a class="headerlink" href="#controller" title="Permalink to this heading">¶</a></h2>
<div class="line-block">
<div class="line">まず、Controllerの実装から説明する。</div>
<div class="line">Controllerは、以下5つの役割を担う。</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>リクエストを受け取るためのメソッドを提供する。</strong></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;RequestMapping</span></code>アノテーションもしくは<code class="docutils literal notranslate"><span class="pre">&#64;RequestMapping</span></code>合成アノテーションが付与されたメソッドを実装することで、リクエストを受け取ることができる。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>リクエストパラメータの入力チェックを行う。</strong></div>
<div class="line">入力チェックが必要なリクエストを受け取るメソッドでは、<code class="docutils literal notranslate"><span class="pre">&#64;Validated</span></code>アノテーションをフォームオブジェクトの引数に指定することで、リクエストパラメータの入力チェックを行うことができる。</div>
<div class="line">単項目チェックはBean Validation、相関チェックはSpring Validator又はBean Validationでチェックを行う。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>業務処理の呼び出しを行う。</strong></div>
<div class="line">Controllerでは業務処理の実装は行わず、Serviceのメソッドに処理を委譲する。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>業務処理の処理結果をModelに反映する。</strong></div>
<div class="line">Serviceのメソッドから返却されたドメインオブジェクトを<code class="docutils literal notranslate"><span class="pre">Model</span></code>に反映することで、Viewから処理結果を参照できるようにする。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>処理結果に対応するView名を返却する。</strong></div>
<div class="line">Controllerでは処理結果に対する描画処理を実装せず、描画処理はJSP/Thymeleaf等のViewで実装する。</div>
<div class="line">Controllerでは描画処理が実装されているViewのView名の返却のみ行う。</div>
<div class="line">View名に対応するViewの解決は、Spring Frameworkより提供されている<code class="docutils literal notranslate"><span class="pre">ViewResolver</span></code>によって行われ、処理結果に対応するView(JSP/Thymeleafなど)が呼び出される仕組みになっている。</div>
</div>
</li>
</ol>
<figure class="align-center" id="id95">
<a class="reference internal image-reference" href="../_images/application_logic-of-controller.png"><img alt="responsibility of logic" src="../_images/application_logic-of-controller.png" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Picture - Logic of controller</strong></span><a class="headerlink" href="#id95" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Controllerでは、業務処理の呼び出し、処理結果の<code class="docutils literal notranslate"><span class="pre">Model</span></code>への反映、遷移先(View名)の決定などの<strong>ルーティング処理の実装に徹することを推奨する。</strong></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Controllerの実装について、以下4つの点に着目して説明する。</p>
<ul class="simple">
<li><p><a class="reference internal" href="#controller-new-label"><span class="std std-ref">Controllerクラスの作成方法</span></a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-label"><span class="std std-ref">リクエストとハンドラメソッドのマッピング方法</span></a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-label"><span class="std std-ref">ハンドラメソッドの引数について</span></a></p></li>
<li><p><a class="reference internal" href="#controller-method-return-label"><span class="std std-ref">ハンドラメソッドの返り値について</span></a></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="controller-new-label">
<span id="id3"></span><h3><a class="toc-backref" href="#id103" role="doc-backlink"><span class="section-number">3.4.1.1. </span>Controllerクラスの作成方法</a><a class="headerlink" href="#controller-new-label" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line"><strong>Controllerは、POJOクラスに &#64;Controller アノテーションを付加したクラス (Annotation-based Controller)として作成する。</strong></div>
<div class="line">Spring MVCのControllerとしては、<code class="docutils literal notranslate"><span class="pre">org.springframework.web.servlet.mvc.Controller</span></code>インタフェースを実装する方法 (Interface-based Controller)もあるが、Spring3以降はDeprecatedになっているため、原則使用しない。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SampleController</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-mapping-label">
<span id="id4"></span><h3><a class="toc-backref" href="#id104" role="doc-backlink"><span class="section-number">3.4.1.2. </span>リクエストとハンドラメソッドのマッピング方法</a><a class="headerlink" href="#controller-mapping-label" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line">リクエストを受け取るメソッドは、<code class="docutils literal notranslate"><span class="pre">&#64;RequestMapping</span></code>アノテーションを付与する。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">RequestMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">Spring Framework 4.3から<code class="docutils literal notranslate"><span class="pre">&#64;RequestMapping</span></code>の合成アノテーションである<code class="docutils literal notranslate"><span class="pre">&#64;GetMapping</span></code>や<code class="docutils literal notranslate"><span class="pre">&#64;PostMapping</span></code>が追加された。</div>
<div class="line">これらを使用すると、上記の例は以下のように表せる。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;GetMapping</span></code>や<code class="docutils literal notranslate"><span class="pre">&#64;PostMapping</span></code>を使用すると、シンプルにマッピングを定義することができ、意図しないHTTPメソッドのマッピング防止とソースコードの可読性向上が期待できる。</div>
<div class="line">本ガイドラインでは、リクエストを受け取るメソッドを「ハンドラメソッド」と呼ぶ。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>リクエストとハンドラメソッドをマッピングするためのルールは、<code class="docutils literal notranslate"><span class="pre">&#64;RequestMapping</span></code>アノテーション、<code class="docutils literal notranslate"><span class="pre">&#64;RequestMapping</span></code>合成アノテーションの属性に指定する。</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 10.0%" />
<col style="width: 80.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>属性名</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ol class="arabic simple">
<li></li>
</ol>
</td>
<td><p>value</p></td>
<td><div class="line-block">
<div class="line">マッピング対象にするリクエストパスを指定する(複数可)。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p>method</p></td>
<td><div class="line-block">
<div class="line">マッピング対象にするHTTPメソッド(<code class="docutils literal notranslate"><span class="pre">RequestMethod</span></code>型)を指定する(複数可)。</div>
<div class="line">GET/POSTについてはHTML form向けのリクエストをマッピングする際にも使用するが、それ以外のHTTPメソッド(PUT/DELETEなど)はREST API向けのリクエストをマッピングする際に使用する。</div>
<div class="line">本ガイドラインではHTTPメソッドの指定はこの属性を使用せず、<code class="docutils literal notranslate"><span class="pre">&#64;GetMapping</span></code>/<code class="docutils literal notranslate"><span class="pre">&#64;PostMapping</span></code>/<code class="docutils literal notranslate"><span class="pre">&#64;PutMapping</span></code>/<code class="docutils literal notranslate"><span class="pre">&#64;DeleteMapping</span></code>などの<code class="docutils literal notranslate"><span class="pre">&#64;RequestMapping</span></code>合成アノテーションを使用することを推奨する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p>params</p></td>
<td><div class="line-block">
<div class="line">マッピング対象にするリクエストパラメータを指定する(複数可)。</div>
<div class="line">主にHTML form向けのリクエストをマッピングする際に使用する。このマッピング方法を使用すると、HTML form上に複数のボタンが存在する場合のマッピングを簡単に実現する事ができる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="4">
<li></li>
</ol>
</td>
<td><p>headers</p></td>
<td><div class="line-block">
<div class="line">マッピング対象とするリクエストヘッダを指定する(複数可)。</div>
<div class="line">主にREST APIやAjax向けのリクエストをマッピングする際に使用する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="5">
<li></li>
</ol>
</td>
<td><p>consumes</p></td>
<td><div class="line-block">
<div class="line">リクエストのContent-Typeヘッダを使ってマッピングすることが出来る。マッピング対象とするメディアタイプを指定する(複数可)。</div>
<div class="line">主にREST APIやAjax向けのリクエストをマッピングする際に使用する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="6">
<li></li>
</ol>
</td>
<td><p>produces</p></td>
<td><div class="line-block">
<div class="line">リクエストのAcceptヘッダを使ってマッピングすることが出来る。マッピング対象とするメディアタイプを指定する(複数可)。</div>
<div class="line">主にREST APIやAjax向けのリクエストをマッピングする際に使用する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>マッピングの組み合わせについて</strong></p>
<p>複数の属性を組み合わせることで複雑なマッピングを行うことも可能だが、保守性を考慮し、可能な限りシンプルな定義になるようにマッピングの設計を行うこと。2つの属性の組み合わせ（value属性と別の属性1つ）を目安にすることを推奨する。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">以下、マッピングの具体例を5つ示す。</div>
</div>
<ul class="simple">
<li><p><a class="reference internal" href="#controller-mapping-method-label"><span class="std std-ref">HTTPメソッドでマッピング</span></a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-path-label"><span class="std std-ref">リクエストパスでマッピング</span></a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-params-label"><span class="std std-ref">リクエストパラメータでマッピング</span></a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-headers-label"><span class="std std-ref">リクエストヘッダでマッピング</span></a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-contenttype-label"><span class="std std-ref">Content-Typeヘッダでマッピング</span></a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-accept-label"><span class="std std-ref">Acceptヘッダでマッピング</span></a></p></li>
</ul>
<div class="line-block">
<div class="line">以降の説明では、以下のControllerクラスにハンドラメソッドを定義する前提となっている。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Controller</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;sample&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SampleController</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&#64;Controller</span></code>アノテーションを付加することでAnnotation-basedなコントローラークラスとして認識され、component scanの対象となる。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>クラスレベルで<code class="docutils literal notranslate"><span class="pre">&#64;RequestMapping(&quot;sample&quot;)</span></code>アノテーションを付けることでこのクラス内のハンドラメソッドがsample配下のURLにマッピングされる。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">&#64;RequestMapping</span></code>の値（value属性）を省略した場合、サーブレットルート（”<code class="docutils literal notranslate"><span class="pre">/</span></code>“）のURLにマッピングされる。</p>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="http">
<span id="controller-mapping-method-label"></span><h4><a class="toc-backref" href="#id105" role="doc-backlink"><span class="section-number">3.4.1.2.1. </span>HTTPメソッドでマッピング</a><a class="headerlink" href="#http" title="Permalink to this heading">¶</a></h4>
<p>下記の定義の場合、<code class="docutils literal notranslate"><span class="pre">sample</span></code>というURLにGETメソッドでアクセスすると、helloメソッドが実行される。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">下記の定義の場合、<code class="docutils literal notranslate"><span class="pre">sample</span></code>というURLにPOSTメソッドでアクセスすると、helloメソッドが実行される。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@PostMapping</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>1つのハンドラメソッドに対して複数のHTTPメソッドを指定したい場合</strong></p>
<p>1つのハンドラメソッドに対して<code class="docutils literal notranslate"><span class="pre">&#64;GetMapping</span></code>や<code class="docutils literal notranslate"><span class="pre">&#64;PostMapping</span></code>を同時に使用することはできない。この場合は<code class="docutils literal notranslate"><span class="pre">&#64;RequestMapping</span></code>を使用し、method属性に複数の値を指定することで実現できる。</p>
<p>下記の定義の場合、<code class="docutils literal notranslate"><span class="pre">sample/hello</span></code>というURLにGET又はPOSTメソッドでアクセスすると、helloメソッドが実行される。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">RequestMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span><span class="w"> </span><span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">})</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</pre></div>
</div>
</div></blockquote>
<p>ただし、HTTPメソッドを複数指定することにより機能障害やセキュリティホールに繋がる可能性がある。</p>
<p>ハンドラメソッドの目的に応じて使用するHTTPリクエストメソッドを1つに絞り、<code class="docutils literal notranslate"><span class="pre">&#64;GetMapping</span></code>や<code class="docutils literal notranslate"><span class="pre">&#64;PostMapping</span></code>を使用することを推奨する。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-mapping-path-label">
<span id="id5"></span><h4><a class="toc-backref" href="#id106" role="doc-backlink"><span class="section-number">3.4.1.2.2. </span>リクエストパスでマッピング</a><a class="headerlink" href="#controller-mapping-path-label" title="Permalink to this heading">¶</a></h4>
<p>下記の定義の場合、<code class="docutils literal notranslate"><span class="pre">sample/hello</span></code>というURLにGETメソッドでアクセスすると、helloメソッドが実行される。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">リクエストパスを複数指定した場合は、OR条件で扱われる。</div>
<div class="line">下記の定義の場合、<code class="docutils literal notranslate"><span class="pre">sample/hello</span></code>又は<code class="docutils literal notranslate"><span class="pre">sample/bonjour</span></code>というURLにGETメソッドでアクセスすると、helloメソッドが実行される。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bonjour&quot;</span><span class="p">})</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</pre></div>
</div>
</div></blockquote>
<p>指定するリクエストパスは、具体的な値ではなくパターンを指定することも可能である。パターン指定の詳細は、<a class="reference external" href="https://docs.spring.io/spring-framework/docs/6.1.3/reference/html/web.html#mvc-ann-requestmapping-uri-templates">Spring Framework Documentation -URI patterns-</a>を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-mapping-params-label">
<span id="id6"></span><h4><a class="toc-backref" href="#id107" role="doc-backlink"><span class="section-number">3.4.1.2.3. </span>リクエストパラメータでマッピング</a><a class="headerlink" href="#controller-mapping-params-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">下記の定義の場合、<code class="docutils literal notranslate"><span class="pre">sample/hello?form</span></code>というURLにGETメソッドでアクセスすると、helloメソッドが実行される。</div>
<div class="line">POSTでリクエストする場合は、リクエストパラメータはURLになくてもリクエストBODYに存在していればよい。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;form&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">リクエストパラメータを複数指定した場合は、AND条件で扱われる。</div>
<div class="line">下記の定義の場合、<code class="docutils literal notranslate"><span class="pre">sample/hello?form&amp;formType=foo</span></code>というURLにGETメソッドでアクセスすると、helloメソッドが実行される。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;form&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;formType=foo&quot;</span><span class="p">})</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span><span class="nd">@RequestParam</span><span class="p">(</span><span class="s">&quot;formType&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">formType</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</pre></div>
</div>
</div></blockquote>
<p>サポートされている指定形式は以下の通り。</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 8.0%" />
<col style="width: 25.0%" />
<col style="width: 67.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>形式</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ol class="arabic simple">
<li></li>
</ol>
</td>
<td><p>paramName</p></td>
<td><p>指定したparameNameのリクエストパラメータが存在する場合にマッピングされる。</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p>!paramName</p></td>
<td><p>指定したparameNameのリクエストパラメータが存在しない場合にマッピングされる。</p></td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p>paramName=paramValue</p></td>
<td><p>指定したparameNameの値がparamValueの場合にマッピングされる。</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="4">
<li></li>
</ol>
</td>
<td><p>paramName!=paramValue</p></td>
<td><p>指定したparameNameの値がparamValueでない場合にマッピングされる。</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-mapping-headers-label">
<span id="id7"></span><h4><a class="toc-backref" href="#id108" role="doc-backlink"><span class="section-number">3.4.1.2.4. </span>リクエストヘッダでマッピング</a><a class="headerlink" href="#controller-mapping-headers-label" title="Permalink to this heading">¶</a></h4>
<p>主にREST APIやAjax向けのリクエストをマッピングする際に使用するため、詳細は以下のページを参照されたい。</p>
<ul class="simple">
<li><p><a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Ajax.html"><span class="doc">Ajax</span></a></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="content-type">
<span id="controller-mapping-contenttype-label"></span><h4><a class="toc-backref" href="#id109" role="doc-backlink"><span class="section-number">3.4.1.2.5. </span>Content-Typeヘッダでマッピング</a><a class="headerlink" href="#content-type" title="Permalink to this heading">¶</a></h4>
<p>主にREST APIやAjax向けのリクエストをマッピングする際に使用するため、詳細は以下のページを参照されたい。</p>
<ul class="simple">
<li><p><a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Ajax.html"><span class="doc">Ajax</span></a></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="accept">
<span id="controller-mapping-accept-label"></span><h4><a class="toc-backref" href="#id110" role="doc-backlink"><span class="section-number">3.4.1.2.6. </span>Acceptヘッダでマッピング</a><a class="headerlink" href="#accept" title="Permalink to this heading">¶</a></h4>
<p>主にREST APIやAjax向けのリクエストをマッピングする際に使用するため、詳細は以下のページを参照されたい。</p>
<ul class="simple">
<li><p><a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Ajax.html"><span class="doc">Ajax</span></a></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="controller-mapping-policy-label">
<span id="id8"></span><h3><a class="toc-backref" href="#id111" role="doc-backlink"><span class="section-number">3.4.1.3. </span>リクエストとハンドラメソッドのマッピング方針</a><a class="headerlink" href="#controller-mapping-policy-label" title="Permalink to this heading">¶</a></h3>
<p>以下の方針でマッピングを行うことを推奨する。</p>
<ul>
<li><div class="line-block">
<div class="line"><strong>業務や機能といった意味のある単位で、リクエストのURLをグループ化する。</strong></div>
<div class="line">URLのグループ化とは、<code class="docutils literal notranslate"><span class="pre">&#64;RequestMapping(value</span> <span class="pre">=</span> <span class="pre">&quot;xxx&quot;)</span></code>をクラスレベルのアノテーションとして定義することを意味する。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>処理内の画面フローで使用するリクエストのURLは、同じURLにする。</strong></div>
<div class="line">同じURLとは<code class="docutils literal notranslate"><span class="pre">&#64;RequestMapping(value</span> <span class="pre">=</span> <span class="pre">&quot;xxx&quot;)</span></code>のvalue属性の値を同じ値にすることを意味する。</div>
<div class="line">処理内の画面フローで使用するハンドラメソッドの切り替えは、HTTPメソッドとHTTPパラメータによって行う。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>ハンドラメソッドには&#64;RequestMappingではなく、&#64;GetMappingや&#64;PostMappingなどの&#64;RequestMapping合成アノテーションを使用する</strong></div>
<div class="line">意図しないHTTPメソッドのマッピング防止と可読性の向上のために<code class="docutils literal notranslate"><span class="pre">&#64;RequestMapping</span></code>合成アノテーションの使用を推奨する。</div>
</div>
</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Spring MVCでは<code class="docutils literal notranslate"><span class="pre">&#64;RequestMapping(value</span> <span class="pre">=</span> <span class="pre">&quot;xxx&quot;)</span></code>のvalue属性によってリクエストがマッピングされる際、サーブレットパスとパス情報は区別されず、パス情報が存在する場合はパス情報、存在しない場合はサーブレットパスがマッピングに利用される。</p>
<p>そのため、サーブレットパスとパス情報に同一のパスを設定した場合、意図せぬパス（URL）がマッピングされる可能性がある。</p>
<p>具体的には、<a class="reference internal" href="#controller-mapping-path-label"><span class="std std-ref">リクエストパスでマッピング</span></a>のようにハンドラメソッドにマッピングするパスを「<code class="docutils literal notranslate"><span class="pre">/sample/hello</span></code>」と定義した場合、web.xmlでサーブレットパスを同じ「<code class="docutils literal notranslate"><span class="pre">/sample/hello/*</span></code>」と定義すると、本来マッピングしたい”/sample/hello/sample/hello”だけでなく、意図しない”/sample/hello”もマッピングされてしまう。</p>
<p>業務上、意図せぬパス（URL）でハンドラメソッドにアクセスできてしまう可能性があり、また、Spring MVCのリクエストマッピング（<code class="docutils literal notranslate"><span class="pre">&#64;RequestMapping</span></code>）ではサーブレット内のパスを指定するのに対し、Spring Security（Servlet Filter）の認可（<code class="docutils literal notranslate"><span class="pre">&lt;sec:intercept-url&gt;</span></code>）ではWebアプリケーション内のパスを指定する。このため、意図しないパス（上記の場合、”/sample/hello”）への認可設定が漏れ、認可をバイパスされる脆弱性を作りこんでしまう恐れがある。</p>
<p>サーブレットパスとパス情報には異なる値を設定するようにされたい。</p>
</div>
<p>以下にベーシックな画面フローを行うサンプルアプリケーションを例にして、リクエストとハンドラメソッドの具体的なマッピング例を示す。</p>
<ul class="simple">
<li><p><a class="reference internal" href="#controller-mapping-policy-sampleapp-overview-label"><span class="std std-ref">サンプルアプリケーションの概要</span></a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-policy-sampleapp-url-design-label"><span class="std std-ref">リクエストURL</span></a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-policy-sampleapp-mapping-design-label"><span class="std std-ref">リクエストとハンドラメソッドのマッピング</span></a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-policy-sampleapp-form-impl-label"><span class="std std-ref">フォーム表示の実装</span></a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-policy-sampleapp-confirm-impl-label"><span class="std std-ref">入力内容確認表示の実装</span></a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-policy-sampleapp-redo-impl-label"><span class="std std-ref">フォーム再表示の実装</span></a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-policy-sampleapp-create-impl-label"><span class="std std-ref">新規作成の実装</span></a></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="controller-mapping-policy-sampleapp-overview-label">
<span id="id9"></span><h4><a class="toc-backref" href="#id112" role="doc-backlink"><span class="section-number">3.4.1.3.1. </span>サンプルアプリケーションの概要</a><a class="headerlink" href="#controller-mapping-policy-sampleapp-overview-label" title="Permalink to this heading">¶</a></h4>
<p>サンプルアプリケーションの機能概要は以下の通り。</p>
<ul>
<li><div class="line-block">
<div class="line">EntityのCRUD処理を行う機能を提供する。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">以下の5つの処理を提供する。</div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 20.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>処理名</p></th>
<th class="head"><p>処理概要</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ol class="arabic simple">
<li></li>
</ol>
</td>
<td><p>Entity一覧取得</p></td>
<td><p>作成済みのEntityを全て取得し、一覧画面に表示する。</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p>Entity新規作成</p></td>
<td><p>指定した内容で新たにEntityを作成する。処理内には、画面フロー（フォーム画面、確認画面、完了画面）が存在する。</p></td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p>Entity参照</p></td>
<td><p>指定されたIDのEntityを取得し、詳細画面に表示する。</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="4">
<li></li>
</ol>
</td>
<td><p>Entity更新</p></td>
<td><p>指定されたIDのEntityを更新する。処理内には、画面フロー（フォーム画面、確認画面、完了画面）が存在する。</p></td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="5">
<li></li>
</ol>
</td>
<td><p>Entity削除</p></td>
<td><p>指定されたIDのEntityを削除する。</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line">機能全体の画面フローは以下の通り。</div>
<div class="line">画面フロー図には記載していないが、入力チェックエラーが発生した場合はフォーム画面を再描画するものとする。</div>
</div>
</li>
</ul>
<figure class="align-center" id="id96">
<a class="reference internal image-reference" href="../_images/application_sample-screen-flow.png"><img alt="Screen flow of entity management function" src="../_images/application_sample-screen-flow.png" style="width: 90%;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Picture - Screen flow of entity management function</strong></span><a class="headerlink" href="#id96" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="url">
<span id="controller-mapping-policy-sampleapp-url-design-label"></span><h4><a class="toc-backref" href="#id113" role="doc-backlink"><span class="section-number">3.4.1.3.2. </span>リクエストURL</a><a class="headerlink" href="#url" title="Permalink to this heading">¶</a></h4>
<p>必要となるリクエストのURLの設計を行う。</p>
<ul>
<li><div class="line-block">
<div class="line">機能内で必要となるリクエストのリクエストURLをグループ化する。</div>
<div class="line">ここではAbcというEntityのCRUD操作を行う機能となるので、<code class="docutils literal notranslate"><span class="pre">/abc/</span></code>から始まるURLとする。</div>
</div>
</li>
<li><p>処理毎にリクエストURLを設ける。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 30.0%" />
<col style="width: 60.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>処理名</p></th>
<th class="head"><p>処理毎のURL(パターン)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ol class="arabic simple">
<li></li>
</ol>
</td>
<td><p>Entity一覧取得</p></td>
<td><p>/abc/list</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p>Entity新規作成</p></td>
<td><p>/abc/create</p></td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p>Entity参照</p></td>
<td><p>/abc/{id}</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="4">
<li></li>
</ol>
</td>
<td><p>Entity更新</p></td>
<td><p>/abc/{id}/update</p></td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="5">
<li></li>
</ol>
</td>
<td><p>Entity削除</p></td>
<td><p>/abc/{id}/delete</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Entity参照、Entity更新、Entity削除処理のURL内に指定している<code class="docutils literal notranslate"><span class="pre">{id}</span></code>は、<a class="reference external" href="https://docs.spring.io/spring-framework/docs/6.1.3/reference/html/web.html#mvc-ann-requestmapping-uri-templates">URI patterns</a>と呼ばれ、任意の値を指定する事ができる。</p>
<p>サンプルアプリケーションでは、操作するEntityのIDを指定する。</p>
</div>
<p>画面フロー図に各処理に割り振られたURLをマッピングすると以下のようになる。</p>
</li>
</ul>
<figure class="align-center" id="id97">
<a class="reference internal image-reference" href="../_images/application_sample-screen-flow-assigned-url.png"><img alt="Screen flow of entity management function and assigned URL" src="../_images/application_sample-screen-flow-assigned-url.png" style="width: 90%;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Picture - Screen flow of entity management function and assigned URL</strong></span><a class="headerlink" href="#id97" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-mapping-policy-sampleapp-mapping-design-label">
<span id="id10"></span><h4><a class="toc-backref" href="#id114" role="doc-backlink"><span class="section-number">3.4.1.3.3. </span>リクエストとハンドラメソッドのマッピング</a><a class="headerlink" href="#controller-mapping-policy-sampleapp-mapping-design-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">リクエストとハンドラメソッドのマッピングの設計を行う。</div>
<div class="line">以下は、マッピング方針に則って設計したマッピング定義となる。</div>
</div>
<blockquote>
<div><table class="longtable docutils align-default">
<colgroup>
<col style="width: 5.0%" />
<col style="width: 20.0%" />
<col style="width: 15.0%" />
<col style="width: 22.0%" />
<col style="width: 10.0%" />
<col style="width: 13.0%" />
<col style="width: 15.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">項番</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">処理名</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">URL</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">リクエスト名</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">HTTP</div>
<div class="line">メソッド</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">HTTP</div>
<div class="line">パラメータ</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">ハンドラメソッド</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ol class="arabic simple">
<li></li>
</ol>
</td>
<td><p>Entity一覧取得</p></td>
<td><p>/abc/list</p></td>
<td><p>一覧表示</p></td>
<td><p>GET</p></td>
<td><p>-</p></td>
<td><p>list</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p>Entity新規作成</p></td>
<td><p>/abc/create</p></td>
<td><p>フォーム表示</p></td>
<td><p>GET</p></td>
<td><p>form</p></td>
<td><p>createForm</p></td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="3">
<li></li>
</ol>
</td>
<td></td>
<td></td>
<td><p>入力内容確認表示</p></td>
<td><p>POST</p></td>
<td><p>confirm</p></td>
<td><p>createConfirm</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="4">
<li></li>
</ol>
</td>
<td></td>
<td></td>
<td><p>フォーム再表示</p></td>
<td><p>POST</p></td>
<td><p>redo</p></td>
<td><p>createRedo</p></td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="5">
<li></li>
</ol>
</td>
<td></td>
<td></td>
<td><p>新規作成</p></td>
<td><p>POST</p></td>
<td><p>-</p></td>
<td><p>create</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="6">
<li></li>
</ol>
</td>
<td></td>
<td></td>
<td><p>新規作成完了表示</p></td>
<td><p>GET</p></td>
<td><p>complete</p></td>
<td><p>createComplete</p></td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="7">
<li></li>
</ol>
</td>
<td><p>Entity参照</p></td>
<td><p>/abc/{id}</p></td>
<td><p>詳細表示</p></td>
<td><p>GET</p></td>
<td><p>-</p></td>
<td><p>read</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="8">
<li></li>
</ol>
</td>
<td><p>Entity更新</p></td>
<td><p>/abc/{id}/update</p></td>
<td><p>フォーム表示</p></td>
<td><p>GET</p></td>
<td><p>form</p></td>
<td><p>updateForm</p></td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="9">
<li></li>
</ol>
</td>
<td></td>
<td></td>
<td><p>入力内容確認表示</p></td>
<td><p>POST</p></td>
<td><p>confirm</p></td>
<td><p>updateConfirm</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="10">
<li></li>
</ol>
</td>
<td></td>
<td></td>
<td><p>フォーム再表示</p></td>
<td><p>POST</p></td>
<td><p>redo</p></td>
<td><p>updateRedo</p></td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="11">
<li></li>
</ol>
</td>
<td></td>
<td></td>
<td><p>更新</p></td>
<td><p>POST</p></td>
<td><p>-</p></td>
<td><p>update</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="12">
<li></li>
</ol>
</td>
<td></td>
<td></td>
<td><p>更新完了表示</p></td>
<td><p>GET</p></td>
<td><p>complete</p></td>
<td><p>updateComplete</p></td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="13">
<li></li>
</ol>
</td>
<td><p>Entity削除</p></td>
<td><p>/abc/{id}/delete</p></td>
<td><p>削除</p></td>
<td><p>POST</p></td>
<td><p>-</p></td>
<td><p>delete</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="14">
<li></li>
</ol>
</td>
<td></td>
<td></td>
<td><p>削除完了表示</p></td>
<td><p>GET</p></td>
<td><p>complete</p></td>
<td><p>deleteComplete</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line">Entity新規作成、Entity更新、Entity削除処理では、処理内に複数のリクエストが存在しているため、HTTPメソッドとHTTPパラメータによってハンドラメソッドを切り替えている。</div>
<div class="line">以下に、Entity新規作成処理を例に、処理内に複数のリクエストが存在する場合のリクエストフローを示す。</div>
<div class="line">URLは全て<code class="docutils literal notranslate"><span class="pre">/abc/create</span></code>で、HTTPメソッドとHTTPパラメータの組み合わせでハンドラメソッドを切り替えている点に注目すること。</div>
</div>
<figure class="align-center" id="id98">
<a class="reference internal image-reference" href="../_images/applicationScreenflow.png"><img alt="Request flow of entity create processing" src="../_images/applicationScreenflow.png" style="width: 90%;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Picture - Request flow of entity create processing</strong></span><a class="headerlink" href="#id98" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">以下に、Entity新規作成処理のハンドラメソッドの実装コードを示す。</div>
<div class="line">ここではリクエストとハンドラメソッドのマッピングについて理解してもらうのが目的なので、<code class="docutils literal notranslate"><span class="pre">&#64;RequestMapping</span></code>、<code class="docutils literal notranslate"><span class="pre">&#64;GetMapping</span></code>、<code class="docutils literal notranslate"><span class="pre">&#64;PostMapping</span></code>の書き方に注目すること。</div>
<div class="line">ハンドラメソッドの引数や返り値(View名及びView)の詳細については、次章以降で説明する。</div>
</div>
<ul class="simple">
<li><p><a class="reference internal" href="#controller-mapping-policy-sampleapp-form-impl-label"><span class="std std-ref">フォーム表示の実装</span></a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-policy-sampleapp-confirm-impl-label"><span class="std std-ref">入力内容確認表示の実装</span></a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-policy-sampleapp-redo-impl-label"><span class="std std-ref">フォーム再表示の実装</span></a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-policy-sampleapp-create-impl-label"><span class="std std-ref">新規作成の実装</span></a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-policy-sampleapp-complete-impl-label"><span class="std std-ref">新規作成完了表示の実装</span></a></p></li>
<li><p><a class="reference internal" href="#controller-mapping-policy-sampleapp-multi-impl-label"><span class="std std-ref">HTML form上に複数のボタンを配置する場合の実装</span></a></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-mapping-policy-sampleapp-form-impl-label">
<span id="id11"></span><h4><a class="toc-backref" href="#id115" role="doc-backlink"><span class="section-number">3.4.1.3.4. </span>フォーム表示の実装</a><a class="headerlink" href="#controller-mapping-policy-sampleapp-form-impl-label" title="Permalink to this heading">¶</a></h4>
<p>フォーム表示する場合は、HTTPパラメータとして<code class="docutils literal notranslate"><span class="pre">form</span></code>を指定させる。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;create&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;form&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">createForm</span><span class="p">(</span><span class="n">AbcForm</span><span class="w"> </span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;abc/createForm&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&#64;GetMapping</span></code>を使用し、params属性に<code class="docutils literal notranslate"><span class="pre">form</span></code>を指定する。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>フォーム画面を描画するためのView名を返却する。</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>以下に、ハンドラメソッド以外の部分の実装例についても説明しておく。</p>
<p>フォーム表示を行う場合、ハンドラメソッドの実装以外に、</p>
<ul class="simple">
<li><p>フォームオブジェクトの生成処理の実装。</p></li>
<li><p>フォーム画面のViewの実装。</p></li>
</ul>
<div class="line-block">
<div class="line">が必要になる。</div>
<div class="line">フォームオブジェクトおよびViewの詳細は<a class="reference internal" href="#formobject"><span class="std std-ref">フォームオブジェクトの実装</span></a>、<a class="reference internal" href="#id51"><span class="std std-ref">Viewの実装</span></a>を参照されたい。</div>
</div>
<p>以下のフォームオブジェクトを使用する。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AbcForm</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">serialVersionUID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1L</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@NotEmpty</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">input1</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@NotNull</span>
<span class="w">    </span><span class="nd">@Min</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Max</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">input2</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// omitted setter&amp;getter</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>フォームオブジェクトを生成する。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@ModelAttribute</span>
<span class="kd">public</span><span class="w"> </span><span class="n">AbcForm</span><span class="w"> </span><span class="nf">setUpAbcForm</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AbcForm</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>フォーム画面のViewを作成する。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-0-SlNQ" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-SlNQ" name="SlNQ" role="tab" tabindex="0">JSP</button><button aria-controls="panel-0-VGh5bWVsZWFm" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-VGh5bWVsZWFm" name="VGh5bWVsZWFm" role="tab" tabindex="-1">Thymeleaf</button></div><div aria-labelledby="tab-0-SlNQ" class="sphinx-tabs-panel group-tab" id="panel-0-SlNQ" name="SlNQ" role="tabpanel" tabindex="0"><div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;h1&gt;</span>Abc<span class="w"> </span>Create<span class="w"> </span>Form<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;form:form</span><span class="w"> </span><span class="na">modelAttribute=</span><span class="s">&quot;abcForm&quot;</span>
<span class="w">    </span><span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/abc/create&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;form:label</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;input1&quot;</span><span class="nt">&gt;</span>Input1<span class="nt">&lt;/form:label&gt;</span>
<span class="w">    </span><span class="nt">&lt;form:input</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;input1&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;form:errors</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;input1&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;br&gt;</span>
<span class="w">    </span><span class="nt">&lt;form:label</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;input2&quot;</span><span class="nt">&gt;</span>Input2<span class="nt">&lt;/form:label&gt;</span>
<span class="w">    </span><span class="nt">&lt;form:input</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;input2&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;form:errors</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;input2&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;br&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;submit&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;confirm&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Confirm&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;/form:form&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>確認画面へ遷移するためのsubmitボタンには<code class="docutils literal notranslate"><span class="pre">name=&quot;confirm&quot;</span></code>というパラメータを指定しておく。</p></td>
</tr>
</tbody>
</table>
</div><div aria-labelledby="tab-0-VGh5bWVsZWFm" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-VGh5bWVsZWFm" name="VGh5bWVsZWFm" role="tabpanel" tabindex="0"><div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Abc Create Form<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&quot;@{/abc/create}&quot;</span> <span class="na">th:object</span><span class="o">=</span><span class="s">&quot;${abcForm}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;input1&quot;</span><span class="p">&gt;</span>Input1<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{input1}&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:errors</span><span class="o">=</span><span class="s">&quot;*{input1}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;input2&quot;</span><span class="p">&gt;</span>Input2<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{input2}&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:errors</span><span class="o">=</span><span class="s">&quot;*{input2}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;confirm&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Confirm&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (1) --&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>確認画面へ遷移するためのsubmitボタンには<code class="docutils literal notranslate"><span class="pre">name=&quot;confirm&quot;</span></code>というパラメータを指定しておく。</p></td>
</tr>
</tbody>
</table>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>以下に、フォーム表示の動作について説明する。</p>
<div class="line-block">
<div class="line">フォーム表示処理を呼び出す。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">abc/create?form</span></code>というURIにアクセスする。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">form</span></code>というHTTPパラメータの指定があるため、ControllerのcreateFormメソッドが呼び出されフォーム画面が表示される。</div>
</div>
<blockquote>
<div><figure class="align-default">
<a class="reference internal image-reference" href="../_images/applicationCreateFormDisplay.png"><img alt="../_images/applicationCreateFormDisplay.png" src="../_images/applicationCreateFormDisplay.png" style="width: 90%;" /></a>
</figure>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-mapping-policy-sampleapp-confirm-impl-label">
<span id="id12"></span><h4><a class="toc-backref" href="#id116" role="doc-backlink"><span class="section-number">3.4.1.3.5. </span>入力内容確認表示の実装</a><a class="headerlink" href="#controller-mapping-policy-sampleapp-confirm-impl-label" title="Permalink to this heading">¶</a></h4>
<p>フォームの入力内容を確認する場合は、POSTメソッドでデータを送信し、HTTPパラメータに <code class="docutils literal notranslate"><span class="pre">confirm</span></code> を指定させる。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@PostMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;create&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;confirm&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">createConfirm</span><span class="p">(</span><span class="nd">@Validated</span><span class="w"> </span><span class="n">AbcForm</span><span class="w"> </span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">BindingResult</span><span class="w"> </span><span class="n">result</span><span class="p">,</span>
<span class="w">        </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">createRedo</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">);</span><span class="w"> </span><span class="c1">// return &quot;abc/createForm&quot;; (2)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;abc/createConfirm&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// (3)</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&#64;PostMapping</span></code>を使用し、params属性に<code class="docutils literal notranslate"><span class="pre">confirm</span></code>を指定する。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>入力チェックエラーが発生した場合の処理は、フォーム再表示用のハンドラメソッドを呼び出すことを推奨する。フォーム画面を再表示するための処理の共通化を行うことができる。</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p>入力内容確認画面を描画するためのView名を返却する。</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>POSTメソッドを指定させる理由は、個人情報やパスワードなどの秘密情報がブラウザのアドレスバーに現れ、他人に容易に閲覧されることを防ぐためである。(もちろんセキュリティ対策としては十分ではなく、SSLなどのセキュアなサイトにする必要がある)。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>以下に、ハンドラメソッド以外の部分の実装例についても説明しておく。</p>
<p>入力内容確認表示を行う場合、ハンドラメソッドの実装以外に、</p>
<ul class="simple">
<li><p>入力内容確認画面のViewの実装。</p></li>
</ul>
<div class="line-block">
<div class="line">が必要になる。</div>
<div class="line">Viewの詳細は<a class="reference internal" href="#id51"><span class="std std-ref">Viewの実装</span></a>を参照されたい。</div>
</div>
<div class="line-block">
<div class="line">入力内容確認画面のViewを作成する。</div>
</div>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-1-SlNQ" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-SlNQ" name="SlNQ" role="tab" tabindex="0">JSP</button><button aria-controls="panel-1-VGh5bWVsZWFm" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-VGh5bWVsZWFm" name="VGh5bWVsZWFm" role="tab" tabindex="-1">Thymeleaf</button></div><div aria-labelledby="tab-1-SlNQ" class="sphinx-tabs-panel group-tab" id="panel-1-SlNQ" name="SlNQ" role="tabpanel" tabindex="0"><div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;h1&gt;</span>Abc<span class="w"> </span>Create<span class="w"> </span>Form<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;form:form</span><span class="w"> </span><span class="na">modelAttribute=</span><span class="s">&quot;abcForm&quot;</span>
<span class="w">    </span><span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/abc/create&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;form:label</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;input1&quot;</span><span class="nt">&gt;</span>Input1<span class="nt">&lt;/form:label&gt;</span>
<span class="w">        </span>${f:h(abcForm.input1)}
<span class="w">    </span><span class="nt">&lt;form:hidden</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;input1&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;br&gt;</span>
<span class="w">    </span><span class="nt">&lt;form:label</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;input2&quot;</span><span class="nt">&gt;</span>Input2<span class="nt">&lt;/form:label&gt;</span>
<span class="w">        </span>${f:h(abcForm.input2)}
<span class="w">    </span><span class="nt">&lt;form:hidden</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;input2&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;br&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;submit&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;redo&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Back&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;submit&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Create&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (3) --&gt;</span>
<span class="nt">&lt;/form:form&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>フォーム画面で入力された値は、Createボタン及びBackボタンが押下された際に再度サーバに送る必要があるため、HTML formのhidden項目とする。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>フォーム画面に戻るためのsubmitボタンには<code class="docutils literal notranslate"><span class="pre">name=&quot;redo&quot;</span></code>というパラメータを指定しておく。</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p>新規作成を行うためのsubmitボタンにはパラメータ名の指定は不要。</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>この例では確認項目を表示する際にHTMLエスケープするため、<code class="docutils literal notranslate"><span class="pre">f:h()</span></code>関数を使用している。XSS対策のため、必ず行うこと。</p>
<p>詳細については<a class="reference internal" href="../Security/XSS.html"><span class="doc">Cross Site Scripting</span></a>を参照されたい。</p>
</div>
</div><div aria-labelledby="tab-1-VGh5bWVsZWFm" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-VGh5bWVsZWFm" name="VGh5bWVsZWFm" role="tabpanel" tabindex="0"><div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Abc Create Form<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&quot;@{/abc/create}&quot;</span> <span class="na">th:object</span><span class="o">=</span><span class="s">&quot;${abcForm}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;input1&quot;</span><span class="p">&gt;</span>Input1<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;*{input1}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{input1}&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (1) --&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;input2&quot;</span><span class="p">&gt;</span>Input2<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;*{input2}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{input2}&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (1) --&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;redo&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Back&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (2) --&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Create&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (3) --&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>フォーム画面で入力された値は、Createボタン及びBackボタンが押下された際に再度サーバに送る必要があるため、HTML formのhidden項目とする。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>フォーム画面に戻るためのsubmitボタンには<code class="docutils literal notranslate"><span class="pre">name=&quot;redo&quot;</span></code>というパラメータを指定しておく。</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p>新規作成を行うためのsubmitボタンにはパラメータ名の指定は不要。</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">th:text</span></code>属性を使用すると、値をHTMLエスケープして表示することができる。XSS対策のため、HTMLエスケープは必ず行うこと。</p>
<p>詳細については<a class="reference internal" href="../Security/XSS.html#xss-how-to-use-ouput-escaping"><span class="std std-ref">Output Escaping</span></a>を参照されたい。</p>
</div>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>以下に、入力内容確認の動作について説明する。</p>
<div class="line-block">
<div class="line">入力内容確認表示処理を呼び出す。</div>
<div class="line">フォーム画面でInput1に<code class="docutils literal notranslate"><span class="pre">aa</span></code>を、Input2に”<code class="docutils literal notranslate"><span class="pre">5</span></code>“を入力し、Confirmボタンを押下する。</div>
<div class="line">Confirmボタンを押下すると、<code class="docutils literal notranslate"><span class="pre">abc/create?confirm</span></code>というURIにPOSTメソッドでアクセスする。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">confirm</span></code>というHTTPパラメータがあるため、ControllerのcreateConfirmメソッドが呼び出され、入力内容確認画面が表示される。</div>
</div>
<blockquote>
<div><figure class="align-default">
<a class="reference internal image-reference" href="../_images/applicationCreateConfirmDisplay.png"><img alt="../_images/applicationCreateConfirmDisplay.png" src="../_images/applicationCreateConfirmDisplay.png" style="width: 90%;" /></a>
</figure>
</div></blockquote>
<p>Confirmボタンを押下するとPOSTメソッドでHTTPパラメータが送信されるため、URIには現れていないが、HTTPパラメータとして<code class="docutils literal notranslate"><span class="pre">confirm</span></code>が含まれている。</p>
<blockquote>
<div><figure class="align-default">
<a class="reference internal image-reference" href="../_images/applicationCreateConfirmNetwork.png"><img alt="../_images/applicationCreateConfirmNetwork.png" src="../_images/applicationCreateConfirmNetwork.png" style="width: 90%;" /></a>
</figure>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-mapping-policy-sampleapp-redo-impl-label">
<span id="id13"></span><h4><a class="toc-backref" href="#id117" role="doc-backlink"><span class="section-number">3.4.1.3.6. </span>フォーム再表示の実装</a><a class="headerlink" href="#controller-mapping-policy-sampleapp-redo-impl-label" title="Permalink to this heading">¶</a></h4>
<p>フォームを再表示する場合は、HTTPパラメータにredoを指定させる。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@PostMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;create&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;redo&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">createRedo</span><span class="p">(</span><span class="n">AbcForm</span><span class="w"> </span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;abc/createForm&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;PostMapping</span></code>を使用し、params属性に<code class="docutils literal notranslate"><span class="pre">redo</span></code>を指定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">入力内容確認画面を描画するためのView名を返却する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>以下に、フォーム再表示の動作について説明する。</p>
<div class="line-block">
<div class="line">フォーム再表示リクエストを呼び出す。</div>
<div class="line">入力内容確認画面で、Backボタンを押下する。</div>
<div class="line">Backボタンを押下すると、<code class="docutils literal notranslate"><span class="pre">abc/create?redo</span></code>というURIにPOSTメソッドでアクセスする。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">redo</span></code>というHTTPパラメータがあるため、ControllerのcreateRedoメソッドが呼び出され、フォーム画面が再表示される。</div>
</div>
<blockquote>
<div><figure class="align-default">
<a class="reference internal image-reference" href="../_images/applicationCreateConfirmDisplay.png"><img alt="../_images/applicationCreateConfirmDisplay.png" src="../_images/applicationCreateConfirmDisplay.png" style="width: 90%;" /></a>
</figure>
</div></blockquote>
<p>Backボタンを押下するとPOSTメソッドでHTTPパラメータが送信されるため、URIには現れていないが、HTTPパラメータとして<code class="docutils literal notranslate"><span class="pre">redo</span></code>が含まれている。また、フォームの入力値をhidden項目として送信されるため、フォーム画面で入力値を復元することが出来る。</p>
<blockquote>
<div><figure class="align-default">
<a class="reference internal image-reference" href="../_images/applicationBackToCreateFormDisplay.png"><img alt="../_images/applicationBackToCreateFormDisplay.png" src="../_images/applicationBackToCreateFormDisplay.png" style="width: 90%;" /></a>
</figure>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/applicationBackToCreateFormNetwork.png"><img alt="../_images/applicationBackToCreateFormNetwork.png" src="../_images/applicationBackToCreateFormNetwork.png" style="width: 90%;" /></a>
</figure>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>戻るボタンの実現方法には、ボタンの属性に<code class="docutils literal notranslate"><span class="pre">onclick=&quot;javascript:history.back()&quot;</span></code>を設定する方法もある。両者では以下が異なり、要件に応じて選択する必要がある。</p>
<ul class="simple">
<li><p>ブラウザの戻るボタンを押した場合の挙動</p></li>
<li><p>戻るボタンがあるページに直接アクセスして戻るボタンを押した場合の挙動</p></li>
<li><p>ブラウザの履歴</p></li>
</ul>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-mapping-policy-sampleapp-create-impl-label">
<span id="id14"></span><h4><a class="toc-backref" href="#id118" role="doc-backlink"><span class="section-number">3.4.1.3.7. </span>新規作成の実装</a><a class="headerlink" href="#controller-mapping-policy-sampleapp-create-impl-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">フォームの入力内容を登録する場合は、POSTで登録対象のデータ(hiddenパラメータ)を送信させる。</div>
<div class="line">新規作成リクエストはこの処理のメインリクエストになるので、HTTPパラメータによる振り分けは行っていない。</div>
<div class="line">この処理ではデータベースの状態を変更するので、二重送信によって新規作成処理が複数回実行されないように制御する必要がある。</div>
<div class="line">そのため、この処理が終了した後はView(画面)を直接表示するのではなく、次の画面(新規作成完了画面)へリダイレクトしている。このパターンをPOST-Redirect-GET(PRG)パターンと呼ぶ。 <abbr title="Post-Redirect-Get">PRG</abbr>パターンの詳細については<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/DoubleSubmitProtection.html"><span class="doc">二重送信防止</span></a>を参照されたい。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@PostMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;create&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="nd">@Validated</span><span class="w"> </span><span class="n">AbcForm</span><span class="w"> </span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">BindingResult</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">createRedo</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">);</span><span class="w"> </span><span class="c1">// return &quot;abc/createForm&quot;;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/abc/create?complete&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&#64;PostMapping</span></code>を使用し、params属性は指定しない。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p><abbr title="Post-Redirect-Get">PRG</abbr>パターンとするため、新規作成完了表示リクエストにリダイレクトするためのURLをView名として返却する。</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>“redirect:/xxx”を返却すると”/xxx”へリダイレクトさせることができる。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>PRGパターンとすることで、ブラウザのF5ボタン押下時のリロードによる二重送信を防ぐ事はできるが、二重送信の対策としては十分ではない。二重送信の対策としては、共通部品として提供しているTransactionTokenCheckを行う必要がある。</p>
<p>TransactionTokenCheckの詳細については<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/DoubleSubmitProtection.html"><span class="doc">二重送信防止</span></a>を参照されたい。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>以下に、「新規作成」の動作について説明する。</p>
<div class="line-block">
<div class="line">新規作成処理を呼び出す。</div>
<div class="line">入力内容確認画面で、Createボタンを押下する。</div>
<div class="line">Createボタンを押下すると、<code class="docutils literal notranslate"><span class="pre">abc/create</span></code>というURIにPOSTメソッドでアクセスする。</div>
<div class="line">ボタンを識別するためのHTTPパラメータを送信していないので、Entity新規作成処理のメインのリクエストと判断され、Controllerのcreateメソッドが呼び出される。</div>
</div>
<div class="line-block">
<div class="line">新規作成リクエストでは、直接画面を返さず、新規作成完了表示(<code class="docutils literal notranslate"><span class="pre">/abc/create?complete</span></code>)へリダイレクトしているため、HTTPステータスが302になっている。</div>
</div>
<blockquote>
<div><figure class="align-default">
<a class="reference internal image-reference" href="../_images/applicationCreateNetwork.png"><img alt="../_images/applicationCreateNetwork.png" src="../_images/applicationCreateNetwork.png" style="width: 90%;" /></a>
</figure>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-mapping-policy-sampleapp-complete-impl-label">
<span id="id15"></span><h4><a class="toc-backref" href="#id119" role="doc-backlink"><span class="section-number">3.4.1.3.8. </span>新規作成完了表示の実装</a><a class="headerlink" href="#controller-mapping-policy-sampleapp-complete-impl-label" title="Permalink to this heading">¶</a></h4>
<p>新規作成処理が完了した事を通知する場合は、HTTPパラメータに<code class="docutils literal notranslate"><span class="pre">complete</span></code>を指定させる。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;create&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;complete&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">createComplete</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;abc/createComplete&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&#64;GetMapping</span></code>を使用し、params属性に<code class="docutils literal notranslate"><span class="pre">complete</span></code>を指定する。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>新規作成完了画面を描画するため、View名を返却する。</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>以下に、「新規作成完了表示」の動作について説明する。</p>
<div class="line-block">
<div class="line">新規作成完了後、リダイレクト先に指定されたURI(<code class="docutils literal notranslate"><span class="pre">/abc/create?complete</span></code>)にアクセスする。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">complete</span></code>というHTTPパラメータがあるため、ControllerのcreateCompleteメソッドが呼び出され、新規作成完了画面が表示される。</div>
</div>
<blockquote>
<div><figure class="align-default">
<a class="reference internal image-reference" href="../_images/applicationCreateCompleteDisplay.png"><img alt="../_images/applicationCreateCompleteDisplay.png" src="../_images/applicationCreateCompleteDisplay.png" style="width: 90%;" /></a>
</figure>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/applicationCreateCompleteNetwork.png"><img alt="../_images/applicationCreateCompleteNetwork.png" src="../_images/applicationCreateCompleteNetwork.png" style="width: 90%;" /></a>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>PRGパターンを利用しているため、ブラウザをリロードしても、新規作成処理は実行されず、新規作成完了が再度表示されるだけである。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="html-form">
<span id="controller-mapping-policy-sampleapp-multi-impl-label"></span><h4><a class="toc-backref" href="#id120" role="doc-backlink"><span class="section-number">3.4.1.3.9. </span>HTML form上に複数のボタンを配置する場合の実装</a><a class="headerlink" href="#html-form" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">1つのフォームに対して複数のボタンを設置したい場合、ボタンを識別するためのHTTPパラメータを送ることで、実行するハンドラメソッドを切り替える。</div>
<div class="line">ここではサンプルアプリケーションの入力内容確認画面のCreateボタンとBackボタンを例に説明する。</div>
</div>
<p>下図のように、入力内容確認画面のフォームには、新規作成を行うCreateボタンと新規作成フォーム画面を再表示するBackボタンが存在する。</p>
<figure class="align-center" id="id99">
<a class="reference internal image-reference" href="../_images/applicationControllerBackToForm.png"><img alt="Multiple button in the HTML form" src="../_images/applicationControllerBackToForm.png" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Picture - Multiple button in the HTML form</strong></span><a class="headerlink" href="#id99" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Backボタンを押下した場合、新規作成フォーム画面を再表示するためのリクエスト(<code class="docutils literal notranslate"><span class="pre">/abc/create?redo</span></code>)を送信する必要があるため、
HTML form内に以下のコードが必要となる。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-2-SlNQ" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-2-SlNQ" name="SlNQ" role="tab" tabindex="0">JSP</button><button aria-controls="panel-2-VGh5bWVsZWFm" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-VGh5bWVsZWFm" name="VGh5bWVsZWFm" role="tab" tabindex="-1">Thymeleaf</button></div><div aria-labelledby="tab-2-SlNQ" class="sphinx-tabs-panel group-tab" id="panel-2-SlNQ" name="SlNQ" role="tabpanel" tabindex="0"><div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;submit&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;redo&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Back&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;submit&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Create&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>上記のように、入力内容確認画面(<code class="docutils literal notranslate"><span class="pre">abc/createConfirm.jsp</span></code>)のBackボタンに<code class="docutils literal notranslate"><span class="pre">name=&quot;redo&quot;</span></code>というパラメータを指定する。</p></td>
</tr>
</tbody>
</table>
</div><div aria-labelledby="tab-2-VGh5bWVsZWFm" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-VGh5bWVsZWFm" name="VGh5bWVsZWFm" role="tabpanel" tabindex="0"><div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;redo&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Back&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (1) --&gt;</span>
<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Create&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>上記のように、入力内容確認画面(<code class="docutils literal notranslate"><span class="pre">abc/createConfirm.html</span></code>)のBackボタンに<code class="docutils literal notranslate"><span class="pre">name=&quot;redo&quot;</span></code>というパラメータを指定する。</p></td>
</tr>
</tbody>
</table>
</div></div>
<p>Backボタン押下時の動作については、<a class="reference internal" href="#controller-mapping-policy-sampleapp-redo-impl-label"><span class="std std-ref">フォーム再表示の実装</span></a>を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-mapping-policy-sampleapp-all-impl-label">
<span id="id16"></span><h4><a class="toc-backref" href="#id121" role="doc-backlink"><span class="section-number">3.4.1.3.10. </span>サンプルアプリケーションのControllerのソースコード</a><a class="headerlink" href="#controller-mapping-policy-sampleapp-all-impl-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">以下に、サンプルアプリケーションの新規作成処理実装後のControllerの全ソースを示す。</div>
<div class="line">Entity一覧取得、Entity参照、Entity更新、Entity削除も同じ要領で実装することになるが、説明は割愛する。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;abc&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AbcController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@ModelAttribute</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">AbcForm</span><span class="w"> </span><span class="nf">setUpAbcForm</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AbcForm</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Handling request of &quot;GET /abc/create?form&quot;</span>
<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;create&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;form&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">createForm</span><span class="p">(</span><span class="n">AbcForm</span><span class="w"> </span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// omitted</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;abc/createForm&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Handling request of &quot;POST /abc/create?confirm&quot;</span>
<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;create&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;confirm&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">createConfirm</span><span class="p">(</span><span class="nd">@Validated</span><span class="w"> </span><span class="n">AbcForm</span><span class="w"> </span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">BindingResult</span><span class="w"> </span><span class="n">result</span><span class="p">,</span>
<span class="w">            </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">createRedo</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// omitted</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;abc/createConfirm&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Handling request of &quot;POST /abc/create?redo&quot;</span>
<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;create&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;redo&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">createRedo</span><span class="p">(</span><span class="n">AbcForm</span><span class="w"> </span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// omitted</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;abc/createForm&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Handling request of &quot;POST /abc/create&quot;</span>
<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;create&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="nd">@Validated</span><span class="w"> </span><span class="n">AbcForm</span><span class="w"> </span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">BindingResult</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">createRedo</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// omitted</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/abc/create?complete&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Handling request of &quot;GET /abc/create?complete&quot;</span>
<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;create&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;complete&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">createComplete</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// omitted</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;abc/createComplete&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="controller-method-argument-label">
<span id="id17"></span><h3><a class="toc-backref" href="#id122" role="doc-backlink"><span class="section-number">3.4.1.4. </span>ハンドラメソッドの引数について</a><a class="headerlink" href="#controller-method-argument-label" title="Permalink to this heading">¶</a></h3>
<p><a class="reference external" href="https://docs.spring.io/spring-framework/docs/6.1.3/reference/html/web.html#mvc-ann-arguments">ハンドラメソッドの引数は様々な値をとることができる</a>が、基本的には次に挙げるものは原則として使用しないこと。</p>
<ul class="simple">
<li><p>ServletRequest</p></li>
<li><p>HttpServletRequest</p></li>
<li><p>org.springframework.web.context.request.WebRequest</p></li>
<li><p>org.springframework.web.context.request.NativeWebRequest</p></li>
<li><p>java.io.InputStream</p></li>
<li><p>java.io.Reader</p></li>
<li><p>java.io.OutputStream</p></li>
<li><p>java.io.Writer</p></li>
<li><p>java.util.Map</p></li>
<li><p>org.springframework.ui.ModelMap</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">HttpServletRequest</span></code>のgetAttribute/setAttributeや<code class="docutils literal notranslate"><span class="pre">Map</span></code>のget/putのような汎用的なメソッドの利用を許可すると自由な値の受け渡しができてしまい、プロジェクトの規模が大きくなると保守性を著しく低下させる可能性がある。</p>
<p>同様の理由で、他で代替できる場合は<code class="docutils literal notranslate"><span class="pre">HttpSession</span></code>を極力使用しないことを推奨する。</p>
<p>共通的なパラメータ(リクエストパラメータ)をJavaBeanに格納してControllerの引数に渡したい場合は、後述の<a class="reference internal" href="#methodargumentresolver"><span class="std std-ref">HandlerMethodArgumentResolverの実装</span></a>を使用することで実現できる。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>以下に、引数の使用方法について、目的別に13例示す。</p>
<ul class="simple">
<li><p><a class="reference internal" href="#controller-method-argument-model-label"><span class="std std-ref">画面(View)にデータを渡す</span></a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-pathvariable-label"><span class="std std-ref">URLのパスから値を取得する</span></a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-requestparam-label"><span class="std std-ref">リクエストパラメータを個別に取得する</span></a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-form-label"><span class="std std-ref">リクエストパラメータをまとめて取得する</span></a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-validation-label"><span class="std std-ref">入力チェックを行う</span></a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-redirectattributes-label"><span class="std std-ref">リダイレクト先にデータを渡す</span></a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-redirectattributes-param-label"><span class="std std-ref">リダイレクト先へリクエストパラメータを渡す</span></a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-redirectattributes-path-label"><span class="std std-ref">リダイレクト先URLのパスに値を埋め込む</span></a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-cookievalue-label"><span class="std std-ref">Cookieから値を取得する</span></a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-cookiewrite-label"><span class="std std-ref">Cookieに値を書き込む</span></a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-pagination-label"><span class="std std-ref">ページネーション情報を取得する</span></a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-upload-label"><span class="std std-ref">アップロードファイルを取得する</span></a></p></li>
<li><p><a class="reference internal" href="#controller-method-argument-message-label"><span class="std std-ref">画面に結果メッセージを表示する</span></a></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="view">
<span id="controller-method-argument-model-label"></span><h4><a class="toc-backref" href="#id123" role="doc-backlink"><span class="section-number">3.4.1.4.1. </span>画面(View)にデータを渡す</a><a class="headerlink" href="#view" title="Permalink to this heading">¶</a></h4>
<p>画面(View)に表示するデータを渡したい場合は、<code class="docutils literal notranslate"><span class="pre">org.springframework.ui.Model</span></code>(以降<code class="docutils literal notranslate"><span class="pre">Model</span></code>と呼ぶ) をハンドラメソッドの引数として受け取り、<code class="docutils literal notranslate"><span class="pre">Model</span></code>オブジェクトに渡したいデータ(オブジェクト)を追加する。</p>
<ul>
<li><p>SampleController.java</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello World!&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">HelloBean</span><span class="p">(</span><span class="s">&quot;Bean Hello World!&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// (3)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// returns view name</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-3-SlNQ" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-3-SlNQ" name="SlNQ" role="tab" tabindex="0">JSP</button><button aria-controls="panel-3-VGh5bWVsZWFm" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-3-VGh5bWVsZWFm" name="VGh5bWVsZWFm" role="tab" tabindex="-1">Thymeleaf</button></div><div aria-labelledby="tab-3-SlNQ" class="sphinx-tabs-panel group-tab" id="panel-3-SlNQ" name="SlNQ" role="tabpanel" tabindex="0"><ul>
<li><p>hello.jsp</p>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span>Message<span class="w"> </span>:<span class="w"> </span>${f:h(hello)}<span class="nt">&lt;br&gt;</span><span class="w"> </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
Message<span class="w"> </span>:<span class="w"> </span>${f:h(helloBean.message)}<span class="nt">&lt;br&gt;</span><span class="w"> </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
</pre></div>
</div>
</li>
<li><p>HTML of created by View(hello.jsp)</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>Message : Hello World!<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (6) --&gt;</span>
Message : Bean Hello World!<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (6) --&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">Model</span></code>オブジェクトを引数として受け取る。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">引数で受け取った<code class="docutils literal notranslate"><span class="pre">Model</span></code>オブジェクトの<code class="docutils literal notranslate"><span class="pre">addAttribute</span></code>メソッドを呼び出し、渡したいデータを<code class="docutils literal notranslate"><span class="pre">Model</span></code>オブジェクトに追加する。</div>
<div class="line">例では、<code class="docutils literal notranslate"><span class="pre">hello</span></code> という属性名で <code class="docutils literal notranslate"><span class="pre">HelloWorld!</span></code> という文字列のデータを追加している。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">addAttribute</span></code>メソッドの第一引数を省略すると<a class="reference external" href="https://docs.spring.io/spring-framework/docs/6.1.3/javadoc-api/org/springframework/core/Conventions.html#getVariableName(java.lang.Object)">Conventions#getVariableName</a>の仕様に基づき、値のクラス名から属性名を決定する。</div>
<div class="line">例では、<code class="docutils literal notranslate"><span class="pre">model.addAttribute(&quot;helloBean&quot;,</span> <span class="pre">new</span> <span class="pre">HelloBean());</span></code>を行ったのと同じ結果となる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">View(JSP)側では、「${属性名}」と記述することで<code class="docutils literal notranslate"><span class="pre">Model</span></code>オブジェクトに追加したデータを取得することができる。</div>
<div class="line">例ではHTMLエスケープを行うEL式の関数を呼び出しているため、「${f:h(属性名)}」としている。</div>
<div class="line">HTMLエスケープを行うEL式の関数の詳細については、<a class="reference internal" href="../Security/XSS.html"><span class="doc">Cross Site Scripting</span></a>を参照されたい。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">「${属性名.JavaBeanのプロパティ名}」と記述することで<code class="docutils literal notranslate"><span class="pre">Model</span></code>に格納されているJavaBeanから値を取得することができる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">JSP実行後に出力されるHTML。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div><div aria-labelledby="tab-3-VGh5bWVsZWFm" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-3-VGh5bWVsZWFm" name="VGh5bWVsZWFm" role="tabpanel" tabindex="0"><ul>
<li><p>hello.html</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>Message : <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${hello}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (4) */--&gt;</span>
Message : <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${helloBean.message}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (5) */--&gt;</span>
</pre></div>
</div>
</li>
<li><p>HTML of created by View(hello.html)</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>Message : <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>Hello World!<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (6) --&gt;</span>
Message : <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>Bean Hello World!<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (6) --&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">Model</span></code>オブジェクトを引数として受け取る。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">引数で受け取った<code class="docutils literal notranslate"><span class="pre">Model</span></code>オブジェクトの<code class="docutils literal notranslate"><span class="pre">addAttribute</span></code>メソッドを呼び出し、渡したいデータを<code class="docutils literal notranslate"><span class="pre">Model</span></code>オブジェクトに追加する。</div>
<div class="line">例では、<code class="docutils literal notranslate"><span class="pre">hello</span></code>という属性名で<code class="docutils literal notranslate"><span class="pre">Hello</span> <span class="pre">World!</span></code>という文字列のデータを追加している。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">addAttribute</span></code>メソッドの第一引数を省略すると<a class="reference external" href="https://docs.spring.io/spring-framework/docs/6.1.3/javadoc-api/org/springframework/core/Conventions.html#getVariableName(java.lang.Object)">Conventions#getVariableName</a>の仕様に基づき、値のクラス名から属性名を決定する。</div>
<div class="line">例では、<code class="docutils literal notranslate"><span class="pre">model.addAttribute(&quot;helloBean&quot;,</span> <span class="pre">new</span> <span class="pre">HelloBean());</span></code>を行ったのと同じ結果となる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">テンプレートHTML側では、<code class="docutils literal notranslate"><span class="pre">th:text</span></code>などの属性において${属性名}のような式を記述することできる。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">${}</span></code>は変数式で、<code class="docutils literal notranslate"><span class="pre">Model</span></code>オブジェクトに追加したデータを取得することができる。</div>
<div class="line">例では、取得したデータをHTMLエスケープして出力するために<code class="docutils literal notranslate"><span class="pre">th:text</span></code>属性を利用し、「th:text=”${hello}”」としている。</div>
<div class="line">HTMLエスケープの詳細については、<a class="reference internal" href="../Security/XSS.html#xss-how-to-use-ouput-escaping"><span class="std std-ref">Output Escaping</span></a>を参照されたい。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">「${属性名.JavaBeanのプロパティ名}」と記述することで<code class="docutils literal notranslate"><span class="pre">Model</span></code>に格納されているJavaBeanから値を取得することができる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Thymeleafによって出力されるHTML。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div><div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">Model</span></code>は使用しない場合でも引数に指定しておいてもよい。実装初期段階では必要なくても後で使う場合がある(後々メソッドのシグニチャを変更する必要がなくなる)。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">Model</span></code>に<code class="docutils literal notranslate"><span class="pre">addAttribute</span></code>することで、<code class="docutils literal notranslate"><span class="pre">HttpServletRequest</span></code>に<code class="docutils literal notranslate"><span class="pre">setAttribute</span></code>されるため、Spring MVCの管理下にないモジュール(例えばServletFilterなど)からも値を参照することが出来る。</p>
</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-method-argument-pathvariable-label">
<span id="id20"></span><h4><a class="toc-backref" href="#id124" role="doc-backlink"><span class="section-number">3.4.1.4.2. </span>URLのパスから値を取得する</a><a class="headerlink" href="#controller-method-argument-pathvariable-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">URLのパスから値を取得する場合は、引数に<code class="docutils literal notranslate"><span class="pre">&#64;PathVariable</span></code>アノテーションを付与する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;PathVariable</span></code>アノテーションを使用してパスから値を取得する場合、 <code class="docutils literal notranslate"><span class="pre">&#64;GetMapping</span></code>アノテーションのvalue属性に取得したい部分を変数化しておく必要がある。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;hello/{id}/{version}&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">        </span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&quot;version&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">version</span><span class="p">,</span>
<span class="w">        </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// do something</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// returns view name</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;GetMapping</span></code>アノテーションのvalue属性に、抜き出したい箇所をパス変数として指定する。パス変数は、「{変数名}」の形式で指定する。</div>
<div class="line">上記例では、<code class="docutils literal notranslate"><span class="pre">id</span></code>と<code class="docutils literal notranslate"><span class="pre">version</span></code>という二つのパス変数を指定している。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;PathVariable</span></code>アノテーションのvalue属性には、パス変数の変数名を指定する。</div>
<div class="line">上記例では、<code class="docutils literal notranslate"><span class="pre">sample/hello/aaaa/1</span></code>というURLにアクセスした場合、引数idに文字列<code class="docutils literal notranslate"><span class="pre">aaaa</span></code>が渡る。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>バインドする引数の型が合わない場合は<code class="docutils literal notranslate"><span class="pre">org.springframework.beans.TypeMismatchException</span></code>がスローされ、デフォルトの動作では400(Bad Request)が応答される。</p>
<p>例えば、上記例で<code class="docutils literal notranslate"><span class="pre">sample/hello/aaaa/v1</span></code>というURLでアクセスした場合、<code class="docutils literal notranslate"><span class="pre">v1</span></code>をIntegerに変換できないため例外がスローされる。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-method-argument-requestparam-label">
<span id="id21"></span><h4><a class="toc-backref" href="#id125" role="doc-backlink"><span class="section-number">3.4.1.4.3. </span>リクエストパラメータを個別に取得する</a><a class="headerlink" href="#controller-method-argument-requestparam-label" title="Permalink to this heading">¶</a></h4>
<p>リクエストパラメータを1つずつ取得したい場合は、引数に<code class="docutils literal notranslate"><span class="pre">&#64;RequestParam</span></code>アノテーションを付与する。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;bindRequestParams&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">bindRequestParams</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">        </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;age&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">        </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;genderCode&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">defaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">genderCode</span><span class="p">,</span><span class="w"> </span><span class="c1">// (3)</span>
<span class="w">        </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// do something</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// returns view name</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;RequestParam</span></code>アノテーションのvalue属性には、リクエストパラメータ名を指定する。</div>
<div class="line">上記例では、<code class="docutils literal notranslate"><span class="pre">sample/hello?id=aaaa</span></code>というURLにアクセスした場合、引数idに文字列<code class="docutils literal notranslate"><span class="pre">aaaa</span></code>が渡る。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">デフォルトの動作では、指定したリクエストパラメータが存在しないとエラーとなる。リクエストパラメータが存在しないケースを許容する場合は、required属性を<code class="docutils literal notranslate"><span class="pre">false</span></code>に指定する。</div>
<div class="line">上記例では、<code class="docutils literal notranslate"><span class="pre">age</span></code>というリクエストパラメータがない状態でアクセスした場合、引数ageに<code class="docutils literal notranslate"><span class="pre">null</span></code>が渡る。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">指定したリクエストパラメータが存在しない場合にデフォルト値を使用したい場合は、defaultValue属性にデフォルト値を指定する。</div>
<div class="line">上記例では、<code class="docutils literal notranslate"><span class="pre">genderCode</span></code>というリクエストパラメータがない状態でアクセスした場合、引数genderCodeに<code class="docutils literal notranslate"><span class="pre">unknown</span></code>が渡る。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>必須パラメータを指定しないでアクセスした場合は、<code class="docutils literal notranslate"><span class="pre">org.springframework.web.bind.MissingServletRequestParameterException</span></code>がスローされ、デフォルトの動作は400(Bad Request)が応答される。</p>
<p>ただし、defaultValue属性を指定している場合、例外はスローされず、defaultValue属性で指定した値が渡る。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>バインドする引数の型はString以外でも良い。型が合わない場合は<code class="docutils literal notranslate"><span class="pre">org.springframework.beans.TypeMismatchException</span></code>がスローされ、デフォルトの動作は400(Bad Request)が応答される。</p>
<p>例えば、上記例で<code class="docutils literal notranslate"><span class="pre">sample/hello?age=aaaa&amp;...</span></code>というURLでアクセスした場合、<code class="docutils literal notranslate"><span class="pre">aaaa</span></code>をIntegerに変換できないため、例外がスローされる。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>以下の条件に当てはまる場合は、次に説明するフォームオブジェクトにバインドすること。</strong></p>
<ul class="simple">
<li><p>リクエストパラメータがHTML form内の項目である。</p></li>
<li><p>リクエストパラメータはHTML form内の項目ではないが、リクエストパラメータに必須チェック以外の入力チェックを行う必要がある。</p></li>
<li><p>リクエストパラメータの入力チェックエラーのエラー詳細をパラメータ毎に出力する必要がある。</p></li>
<li><p>3つ以上のリクエストパラメータをバインドする。(保守性、可読性の観点)</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-method-argument-form-label">
<span id="id22"></span><h4><a class="toc-backref" href="#id126" role="doc-backlink"><span class="section-number">3.4.1.4.4. </span>リクエストパラメータをまとめて取得する</a><a class="headerlink" href="#controller-method-argument-form-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">リクエストパラメータをオブジェクトにまとめて取得する場合は、フォームオブジェクトを使用する。</div>
<div class="line">フォームオブジェクトは、HTML formを表現するJavaBeanである。フォームオブジェクトの詳細は<a class="reference internal" href="#formobject"><span class="std std-ref">フォームオブジェクトの実装</span></a>を参照されたい。</div>
</div>
<p>以下は、<code class="docutils literal notranslate"><span class="pre">&#64;RequestParam</span></code>で個別にリクエストパラメータを受け取っていたハンドラメソッドを、フォームオブジェクトで受け取るように変更した場合の実装例である。</p>
<p><code class="docutils literal notranslate"><span class="pre">&#64;RequestParam</span></code>を使って個別にリクエストパラメータを受け取っているハンドラメソッドは以下の通り。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;bindRequestParams&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">bindRequestParams</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;age&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">age</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;genderCode&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">defaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">genderCode</span><span class="p">,</span>
<span class="w">        </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// do something</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// returns view name</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">フォームオブジェクトクラスを作成する。</div>
<div class="line">このフォームオブジェクトに対応するHTML formのjspおよびテンプレートHTMLは<a class="reference internal" href="#formobject-bindhtmlform-label"><span class="std std-ref">HTMLへのバインディング方法</span></a>を参照されたい。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SampleForm</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">serialVersionUID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1477614498217715937L</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">genderCode</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// omit setters and getters</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>リクエストパラメータ名とフォームオブジェクトのプロパティ名は一致させる必要がある。</strong></p>
</div>
</div></blockquote>
<p>上記のフォームオブジェクトに対して <code class="docutils literal notranslate"><span class="pre">id=aaa&amp;name=bbbb&amp;age=19&amp;genderCode=men?tel=01234567</span></code>というパラメータが送信された場合、<code class="docutils literal notranslate"><span class="pre">id</span></code>,<code class="docutils literal notranslate"><span class="pre">name</span></code>,<code class="docutils literal notranslate"><span class="pre">age</span></code>,<code class="docutils literal notranslate"><span class="pre">genderCode</span></code>は名前が一致するプロパティに値が格納されるが、<code class="docutils literal notranslate"><span class="pre">tel</span></code>は名前が一致するプロパティがないため、フォームオブジェクトに取り込まれない。</p>
<p><code class="docutils literal notranslate"><span class="pre">&#64;RequestParam</span></code>を使って個別に受け取っていたリクエストパラメータをフォームオブジェクトとして受け取るようにする。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;bindRequestParams&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">bindRequestParams</span><span class="p">(</span><span class="nd">@Validated</span><span class="w"> </span><span class="n">SampleForm</span><span class="w"> </span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">        </span><span class="n">BindingResult</span><span class="w"> </span><span class="n">result</span><span class="p">,</span>
<span class="w">        </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// do something</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// returns view name</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">SampleForm</span></code>オブジェクトを引数として受け取る。</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>フォームオブジェクトを引数に用いた場合、<code class="docutils literal notranslate"><span class="pre">&#64;RequestParam</span></code>の場合とは異なり、必須チェックは行われない。<strong>フォームオブジェクトを使用する場合は、次に説明する</strong><a class="reference internal" href="#controller-method-argument-validation-label"><span class="std std-ref">入力チェックを行う</span></a><strong>を行うこと</strong>。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>EntityなどDomainオブジェクトをそのままフォームオブジェクトとして使うこともできるが、実際には、WEBの画面上にしか存在しないパラメータ（確認用パスワードや、規約確認チェックボックス等）が存在する。</p>
<p>Domainオブジェクトにそのような画面項目に依存する項目を入れるべきではないので、Domainオブジェクトとは別にフォームオブジェクト用のクラスを作成することを推奨する。</p>
<p>リクエストパラメータからDomainオブジェクトを作成する場合は、一旦フォームオブジェクトにバインドしてからプロパティ値をDomainオブジェクトにコピーすること。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-method-argument-validation-label">
<span id="id23"></span><h4><a class="toc-backref" href="#id127" role="doc-backlink"><span class="section-number">3.4.1.4.5. </span>入力チェックを行う</a><a class="headerlink" href="#controller-method-argument-validation-label" title="Permalink to this heading">¶</a></h4>
<p>リクエストパラメータがバインドされているフォームオブジェクトに対して入力チェックを行う場合は、フォームオブジェクト引数に<code class="docutils literal notranslate"><span class="pre">&#64;Validated</span></code>アノテーションを付け、フォームオブジェクト引数の直後に<code class="docutils literal notranslate"><span class="pre">org.springframework.validation.BindingResult</span></code>(以降<code class="docutils literal notranslate"><span class="pre">BindingResult</span></code>と呼ぶ) を引数に指定する。</p>
<p>入力チェックの詳細については、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Validation.html"><span class="doc">入力チェック</span></a>を参照されたい。</p>
<p>フォームオブジェクトクラスのフィールドに入力チェックで必要となるアノテーションを付加する。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SampleForm</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">serialVersionUID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1477614498217715937L</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@NotNull</span>
<span class="w">    </span><span class="nd">@Size</span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@NotNull</span>
<span class="w">    </span><span class="nd">@Size</span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Min</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Max</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Size</span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">genderCode</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// omit setters and getters</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">フォームオブジェクト引数に<code class="docutils literal notranslate"><span class="pre">&#64;Validated</span></code>アノテーションを付与する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;Validated</span></code>アノテーションを付けた引数は、ハンドラメソッド実行前に入力チェックが行われ、チェック結果が直後の<code class="docutils literal notranslate"><span class="pre">BindingResult</span></code>引数に格納される。</div>
<div class="line">フォームオブジェクトにString型以外を指定した場合に発生する型変換エラーも <code class="docutils literal notranslate"><span class="pre">BindingResult</span></code>に格納されている。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;bindRequestParams&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">bindRequestParams</span><span class="p">(</span><span class="nd">@Validated</span><span class="w"> </span><span class="n">SampleForm</span><span class="w"> </span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">        </span><span class="n">BindingResult</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">        </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (3)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/input&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// back to the input view</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// do something</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// returns view name</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">SampleForm</span></code>オブジェクトに<code class="docutils literal notranslate"><span class="pre">&#64;Validated</span></code>アノテーションを付与し、入力チェック対象のオブジェクトにする。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>入力チェック結果が格納される<code class="docutils literal notranslate"><span class="pre">BindingResult</span></code>を引数に指定する。</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p>入力チェックエラーが存在するか判定する。エラーがある場合は、<code class="docutils literal notranslate"><span class="pre">true</span></code> が返却される。</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-method-argument-redirectattributes-label">
<span id="id24"></span><h4><a class="toc-backref" href="#id128" role="doc-backlink"><span class="section-number">3.4.1.4.6. </span>リダイレクト先にデータを渡す</a><a class="headerlink" href="#controller-method-argument-redirectattributes-label" title="Permalink to this heading">¶</a></h4>
<p>ハンドラメソッドを実行した後にリダイレクトする場合に、リダイレクト先で表示するデータを渡したい場合は、<code class="docutils literal notranslate"><span class="pre">org.springframework.web.servlet.mvc.support.RedirectAttributes</span></code>(以降<code class="docutils literal notranslate"><span class="pre">RedirectAttributes</span></code>と呼ぶ) をハンドラメソッドの引数として受け取り、<code class="docutils literal notranslate"><span class="pre">RedirectAttributes</span></code>オブジェクトに渡したいデータを追加する。</p>
<ul>
<li><p>SampleController.java</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span><span class="n">RedirectAttributes</span><span class="w"> </span><span class="n">redirectAttrs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="n">redirectAttrs</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello World!&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="n">redirectAttrs</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">HelloBean</span><span class="p">(</span><span class="s">&quot;Bean Hello World!&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// (3)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/sample/hello?complete&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// (4)</span>
<span class="p">}</span>

<span class="nd">@GetMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;complete&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">helloComplete</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/complete&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// (5)</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-4-SlNQ" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-4-SlNQ" name="SlNQ" role="tab" tabindex="0">JSP</button><button aria-controls="panel-4-VGh5bWVsZWFm" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-4-VGh5bWVsZWFm" name="VGh5bWVsZWFm" role="tab" tabindex="-1">Thymeleaf</button></div><div aria-labelledby="tab-4-SlNQ" class="sphinx-tabs-panel group-tab" id="panel-4-SlNQ" name="SlNQ" role="tabpanel" tabindex="0"><ul>
<li><p>complete.jsp</p>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span>Message<span class="w"> </span>:<span class="w"> </span>${f:h(hello)}<span class="nt">&lt;br&gt;</span><span class="w"> </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
Message<span class="w"> </span>:<span class="w"> </span>${f:h(helloBean.message)}<span class="nt">&lt;br&gt;</span><span class="w"> </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
</pre></div>
</div>
</li>
<li><p>HTML of created by View(complete.jsp)</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>Message : Hello World!<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (8) --&gt;</span>
Message : Bean Hello World!<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (8) --&gt;</span>
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><table class="longtable docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">RedirectAttributes</span></code>オブジェクトを引数として受け取る。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">RedirectAttributes</span></code>オブジェクトの<code class="docutils literal notranslate"><span class="pre">addFlashAttribute</span></code>メソッドを呼び出し、渡したいデータを <code class="docutils literal notranslate"><span class="pre">RedirectAttributes</span></code>オブジェクトに追加する。</div>
<div class="line">例では、 <code class="docutils literal notranslate"><span class="pre">hello</span></code> という属性名で <code class="docutils literal notranslate"><span class="pre">HelloWorld!</span></code> という文字列のデータを追加している。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">addFlashAttribute</span></code>メソッドの第一引数を省略すると<a class="reference external" href="https://docs.spring.io/spring-framework/docs/6.1.3/javadoc-api/org/springframework/core/Conventions.html#getVariableName(java.lang.Object)">Conventions#getVariableName</a>の仕様 に基づき、値のクラス名から属性名を決定する。</div>
<div class="line">例では、<code class="docutils literal notranslate"><span class="pre">model.addFlashAttribute(&quot;helloBean&quot;,</span> <span class="pre">new</span> <span class="pre">HelloBean());</span></code>を行ったのと同じ結果となる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">画面(View)を直接表示せず、次の画面を表示するためのリクエストにリダイレクトする。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">リダイレクト後のハンドラメソッドでは、(2)(3)で追加したデータを表示する画面のView名を返却する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">View(JSP)側では、「${属性名}」と記述することで<code class="docutils literal notranslate"><span class="pre">RedirectAttributes</span></code>を通じてflash scopeに追加したデータを取得することができる。</div>
<div class="line">例ではHTMLエスケープを行うEL式の関数を呼び出しているため、「${f:h(属性名)}」としている。</div>
<div class="line">HTMLエスケープを行うEL式の関数の詳細については、<a class="reference internal" href="../Security/XSS.html"><span class="doc">Cross Site Scripting</span></a>を参照されたい。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">「${属性名.JavaBeanのプロパティ名}」と記述することで<code class="docutils literal notranslate"><span class="pre">RedirectAttributes</span></code>に格納されているJavaBeanから値を取得することがで きる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">HTMLの出力例。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div><div aria-labelledby="tab-4-VGh5bWVsZWFm" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-4-VGh5bWVsZWFm" name="VGh5bWVsZWFm" role="tabpanel" tabindex="0"><ul>
<li><p>complete.html</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>Message : <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${hello}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (6) */--&gt;</span>
Message : <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${helloBean.message}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (7) */--&gt;</span>
</pre></div>
</div>
</li>
<li><p>HTML of created by View(complete.html)</p></li>
</ul>
<blockquote>
<div><div class="highlight-html notranslate"><div class="highlight"><pre><span></span>Message : <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>Hello World!<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (8) --&gt;</span>
Message : <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>Bean Hello World!<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (8) --&gt;</span>
</pre></div>
</div>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">RedirectAttributes</span></code>オブジェクトを引数として受け取る。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">RedirectAttributes</span></code>オブジェクトの<code class="docutils literal notranslate"><span class="pre">addFlashAttribute</span></code>メソッドを呼び出し、渡したいデータを<code class="docutils literal notranslate"><span class="pre">RedirectAttributes</span></code>オブジェクトに追加する。</div>
<div class="line">例では、<code class="docutils literal notranslate"><span class="pre">hello</span></code>という属性名で<code class="docutils literal notranslate"><span class="pre">Hello</span> <span class="pre">World!</span></code>という文字列のデータを追加している。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">addFlashAttribute</span></code>メソッドの第一引数を省略すると<a class="reference external" href="https://docs.spring.io/spring-framework/docs/6.1.3/javadoc-api/org/springframework/core/Conventions.html#getVariableName(java.lang.Object)">Conventions#getVariableName</a>の仕様に基づき、値のクラス名から属性名を決定する。</div>
<div class="line">例では、<code class="docutils literal notranslate"><span class="pre">model.addFlashAttribute(&quot;helloBean&quot;,</span> <span class="pre">new</span> <span class="pre">HelloBean());</span></code>を行ったのと同じ結果となる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">画面(View)を直接表示せず、次の画面を表示するためのリクエストにリダイレクトする。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">リダイレクト後のハンドラメソッドでは、(2)(3)で追加したデータを表示する画面のView名を返却する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">View(テンプレートHTML)側では、<code class="docutils literal notranslate"><span class="pre">th:text</span></code>などの属性において${属性名}のような式を記述することできる。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">${}</span></code>は変数式で、<code class="docutils literal notranslate"><span class="pre">Model</span></code>オブジェクトだけでなく<code class="docutils literal notranslate"><span class="pre">RedirectAttributes</span></code>を通じてflash scopeに追加したデータも取得することができる。</div>
<div class="line">例では、取得したデータをHTMLエスケープして出力するために<code class="docutils literal notranslate"><span class="pre">th:text</span></code>属性を利用し、「th:text=”${hello}”」としている。</div>
<div class="line">HTMLエスケープの詳細については、<a class="reference internal" href="../Security/XSS.html#xss-how-to-use-ouput-escaping"><span class="std std-ref">Output Escaping</span></a>を参照されたい。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">「${属性名.JavaBeanのプロパティ名}」と記述することで<code class="docutils literal notranslate"><span class="pre">RedirectAttributes</span></code>に格納されているJavaBeanから値を取得することができる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Thymeleafによって出力されるHTML。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="docutils literal notranslate"><span class="pre">Model</span></code>に追加してもリダイレクト先にデータを渡すことはできない。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">Model</span></code>の<code class="docutils literal notranslate"><span class="pre">addAttribute</span></code>メソッドに非常によく似ているが、データの生存期間が異なる。</p>
<p><code class="docutils literal notranslate"><span class="pre">RedirectAttributes</span></code>の<code class="docutils literal notranslate"><span class="pre">addFlashAttribute</span></code>ではflash scopeというスコープにデータが格納され、リダイレクト後の1リクエスト(PRGパターンのG)でのみ追加したデータを参照することができる。2回目以降のリクエストの時にはデータは消えている。</p>
</div>
<figure class="align-center" id="id100">
<a class="reference internal image-reference" href="../_images/applicationFlashscope.png"><img alt="Survival time of flush scope" src="../_images/applicationFlashscope.png" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Picture - Survival time of flush scope</strong></span><a class="headerlink" href="#id100" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-method-argument-redirectattributes-param-label">
<span id="id27"></span><h4><a class="toc-backref" href="#id129" role="doc-backlink"><span class="section-number">3.4.1.4.7. </span>リダイレクト先へリクエストパラメータを渡す</a><a class="headerlink" href="#controller-method-argument-redirectattributes-param-label" title="Permalink to this heading">¶</a></h4>
<p>リダイレクト先へ動的にリクエストパラメータを設定したい場合は、引数の<code class="docutils literal notranslate"><span class="pre">RedirectAttributes</span></code>オブジェクトに渡したい値を追加する。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span><span class="n">RedirectAttributes</span><span class="w"> </span><span class="n">redirectAttrs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;aaaa&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">redirectAttrs</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">);</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="c1">// must not return &quot;redirect:/sample/hello?complete&amp;id=&quot; + id;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/sample/hello?complete&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">属性名にリクエストパラメータ名、属性値にリクエストパラメータの値を指定して、<code class="docutils literal notranslate"><span class="pre">RedirectAttributes</span></code>オブジェクトの<code class="docutils literal notranslate"><span class="pre">addAttribute</span></code>メソッドを呼び出す。</div>
<div class="line">上記例では、<code class="docutils literal notranslate"><span class="pre">/sample/hello?complete&amp;id=aaaa</span></code>にリダイレクトされる。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>上記例ではコメント化しているが、<code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">&quot;redirect:/sample/hello?complete&amp;id=&quot;</span> <span class="pre">+</span> <span class="pre">id;</span></code>と結果は同じになる。ただし、<code class="docutils literal notranslate"><span class="pre">RedirectAttributes</span></code>オブジェクトの<code class="docutils literal notranslate"><span class="pre">addAttribute</span></code>メソッドを用いるとURIエンコーディングも行われるので、動的に埋め込むリクエストパラメータについては、<strong>返り値のリダイレクトURLとして組み立てるのではなく、必ずaddAttributeメソッドを使用してリクエストパラメータに設定すること。</strong></p>
<p>動的に埋め込まないリクエストパラメータ(上記例だと”complete”)については、返り値のリダイレクトURLに直接指定してよい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-method-argument-redirectattributes-path-label">
<span id="id28"></span><h4><a class="toc-backref" href="#id130" role="doc-backlink"><span class="section-number">3.4.1.4.8. </span>リダイレクト先URLのパスに値を埋め込む</a><a class="headerlink" href="#controller-method-argument-redirectattributes-path-label" title="Permalink to this heading">¶</a></h4>
<p>リダイレクト先URLのパスに動的に値を埋め込みたい場合は、リクエストパラメータの設定と同様引数の<code class="docutils literal notranslate"><span class="pre">RedirectAttributes</span></code>オブジェクトに埋め込みたい値を追加する。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span><span class="n">RedirectAttributes</span><span class="w"> </span><span class="n">redirectAttrs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;aaaa&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">redirectAttrs</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">);</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="c1">// must not return &quot;redirect:/sample/hello/&quot; + id + &quot;?complete&quot;;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;redirect:/sample/hello/{id}?complete&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">属性名とパスに埋め込みたい値を指定して、<code class="docutils literal notranslate"><span class="pre">RedirectAttributes</span></code>オブジェクトの<code class="docutils literal notranslate"><span class="pre">addAttribute</span></code>メソッドを呼び出す。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">リダイレクトURLの埋め込みたい箇所に「{属性名}」のパス変数を指定する。</div>
<div class="line">上記例では、<code class="docutils literal notranslate"><span class="pre">/sample/hello/aaaa?complete</span></code>にリダイレクトされる。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>上記例ではコメント化しているが、<code class="docutils literal notranslate"><span class="pre">&quot;redirect:/sample/hello/&quot;</span> <span class="pre">+</span> <span class="pre">id</span> <span class="pre">+</span> <span class="pre">&quot;?complete&quot;;</span></code>と結果は同じになる。ただし、<code class="docutils literal notranslate"><span class="pre">RedirectAttributes</span></code>オブジェクトの<code class="docutils literal notranslate"><span class="pre">addAttribute</span></code>メソッドを用いるとURLエンコーディングも行われるので、動的に埋め込むパス値については、<strong>返り値のリダイレクトURLとして記述せずに、必ずaddAttributeメソッドを使用し、パス変数を使って埋め込むこと。</strong></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="cookie">
<span id="controller-method-argument-cookievalue-label"></span><h4><a class="toc-backref" href="#id131" role="doc-backlink"><span class="section-number">3.4.1.4.9. </span>Cookieから値を取得する</a><a class="headerlink" href="#cookie" title="Permalink to this heading">¶</a></h4>
<p>Cookieから取得したい場合は、引数に<code class="docutils literal notranslate"><span class="pre">&#64;CookieValue</span></code>アノテーションを付与する。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;readCookie&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">readCookie</span><span class="p">(</span><span class="nd">@CookieValue</span><span class="p">(</span><span class="s">&quot;JSESSIONID&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="c1">// do something</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/readCookie&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// returns view name</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;CookieValue</span></code>アノテーションのvalue属性には、Cookie名を指定する。</div>
<div class="line">上記例では、Cookieから”JSESSIONID”というCookie名の値が引数sessionIdに渡る。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">&#64;RequestParam</span></code>同様、required属性、defaultValue属性があり、引数の型にはString型以外の指定も可能である。</p>
<p>詳細は、<a class="reference internal" href="#controller-method-argument-requestparam-label"><span class="std std-ref">リクエストパラメータを個別に取得する</span></a>を参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-method-argument-cookiewrite-label">
<span id="id29"></span><h4><a class="toc-backref" href="#id132" role="doc-backlink"><span class="section-number">3.4.1.4.10. </span>Cookieに値を書き込む</a><a class="headerlink" href="#controller-method-argument-cookiewrite-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">Cookieに値を書き込む場合は、<code class="docutils literal notranslate"><span class="pre">HttpServletResponse</span></code>オブジェクトの<code class="docutils literal notranslate"><span class="pre">Set-Cookie</span></code>ヘッダにCookieを追加する。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;writeCookie&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">writeCookie</span><span class="p">(</span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">,</span>
<span class="w">        </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="n">ResponseCookie</span><span class="w"> </span><span class="n">cookie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResponseCookie</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;HelloWorld!&quot;</span><span class="p">).</span><span class="na">build</span><span class="p">();</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="na">addHeader</span><span class="p">(</span><span class="s">&quot;Set-Cookie&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cookie</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/writeCookie&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>Cookieを書き込むために、<code class="docutils literal notranslate"><span class="pre">HttpServletResponse</span></code>オブジェクトを引数に指定する。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">ResponseCookie</span></code>オブジェクトを生成し、<code class="docutils literal notranslate"><span class="pre">HttpServletResponse</span></code>オブジェクトの<code class="docutils literal notranslate"><span class="pre">Set-Cookie</span></code>ヘッダに追加する。</div>
<div class="line">上記例では、<code class="docutils literal notranslate"><span class="pre">foo</span></code>というCookie名で<code class="docutils literal notranslate"><span class="pre">HelloWorld!</span></code>という値を設定している。</div>
<div class="line">詳しくは、<a class="reference external" href="https://docs.spring.io/spring-framework/docs/6.1.3/javadoc-api/org/springframework/http/ResponseCookie.html">ResponseCookie</a>及び<a class="reference external" href="https://docs.spring.io/spring-framework/docs/6.1.3/javadoc-api/org/springframework/http/ResponseCookie.ResponseCookieBuilder.html">ResponseCookieBuilder</a>を参照されたい。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>HTTP Cookieの処理を規定するRFC 6265では、Cookieの名前や値に一部使用できない文字があることに注意されたい。</p>
<p><a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc6265#section-4.1">RFC 6265(HTTP State Management Mechanism)の4.1 SetCookie</a>のSyntaxを参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-method-argument-pagination-label">
<span id="id30"></span><h4><a class="toc-backref" href="#id133" role="doc-backlink"><span class="section-number">3.4.1.4.11. </span>ページネーション情報を取得する</a><a class="headerlink" href="#controller-method-argument-pagination-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">一覧検索を行うリクエストでは、ページネーション情報が必要となる。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">org.springframework.data.domain.Pageable</span></code>(以降<code class="docutils literal notranslate"><span class="pre">Pageable</span></code>と呼ぶ) オブジェクトをハンドラメソッドの引数に取ることで、ページネーション情報(ページ数、取得件数)を容易に扱うことができる。</div>
</div>
<p>詳細については<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Pagination.html"><span class="doc">ページネーション</span></a>を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-method-argument-upload-label">
<span id="id31"></span><h4><a class="toc-backref" href="#id134" role="doc-backlink"><span class="section-number">3.4.1.4.12. </span>アップロードファイルを取得する</a><a class="headerlink" href="#controller-method-argument-upload-label" title="Permalink to this heading">¶</a></h4>
<p>アップロードされたファイルを取得する方法は大きく２つある。</p>
<ul class="simple">
<li><p>フォームオブジェクトに<code class="docutils literal notranslate"><span class="pre">MultipartFile</span></code>のプロパティを用意する。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;RequestParam</span></code>アノテーションを付与して<code class="docutils literal notranslate"><span class="pre">org.springframework.web.multipart.MultipartFile</span></code>をハンドラメソッドの引数とする。</p></li>
</ul>
<p>詳細については<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/FileUpload.html"><span class="doc">ファイルアップロード</span></a>を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-method-argument-message-label">
<span id="id32"></span><h4><a class="toc-backref" href="#id135" role="doc-backlink"><span class="section-number">3.4.1.4.13. </span>画面に結果メッセージを表示する</a><a class="headerlink" href="#controller-method-argument-message-label" title="Permalink to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Model</span></code>オブジェクト又は<code class="docutils literal notranslate"><span class="pre">RedirectAttributes</span></code>オブジェクトをハンドラメソッドの引数として受け取り、<code class="docutils literal notranslate"><span class="pre">ResultMessages</span></code>オブジェクトを追加することで処理の結果メッセージを表示できる。</p>
<p>詳細については<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/MessageManagement.html"><span class="doc">メッセージ管理</span></a>を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="controller-method-return-label">
<span id="id33"></span><h3><a class="toc-backref" href="#id136" role="doc-backlink"><span class="section-number">3.4.1.5. </span>ハンドラメソッドの返り値について</a><a class="headerlink" href="#controller-method-return-label" title="Permalink to this heading">¶</a></h3>
<p><a class="reference external" href="https://docs.spring.io/spring-framework/docs/6.1.3/reference/html/web.html#mvc-ann-return-types">ハンドラメソッドの返り値についても様々な値をとることができる</a>が、基本的には次に挙げるもののみを使用すること。</p>
<ul class="simple">
<li><p>String(View名)</p></li>
</ul>
<p>以下に、目的別に返り値の使用方法について説明する。</p>
<ul class="simple">
<li><p><a class="reference internal" href="#controller-method-return-html-label"><span class="std std-ref">HTMLを応答する</span></a></p></li>
<li><p><a class="reference internal" href="#controller-method-return-download-label"><span class="std std-ref">ダウンロードデータを応答する</span></a></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="html">
<span id="controller-method-return-html-label"></span><h4><a class="toc-backref" href="#id137" role="doc-backlink"><span class="section-number">3.4.1.5.1. </span>HTMLを応答する</a><a class="headerlink" href="#html" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">ハンドラメソッドの実行結果をHTMLとして応答する場合、ハンドラメソッドの返り値はView名を返却する。</div>
</div>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-5-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-5-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-5-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-5-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-5-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-5-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-6-SlNQ" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-6-SlNQ" name="SlNQ" role="tab" tabindex="0">JSP</button><button aria-controls="panel-6-VGh5bWVsZWFm" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-6-VGh5bWVsZWFm" name="VGh5bWVsZWFm" role="tab" tabindex="-1">Thymeleaf</button></div><div aria-labelledby="tab-6-SlNQ" class="sphinx-tabs-panel group-tab" id="panel-6-SlNQ" name="SlNQ" role="tabpanel" tabindex="0"><div class="line-block">
<div class="line">JSPを使ってHTMLを生成する場合の<code class="docutils literal notranslate"><span class="pre">ViewResolver</span></code>は、基本的には<code class="docutils literal notranslate"><span class="pre">UrlBasedViewResolver</span></code>の継承クラス(<code class="docutils literal notranslate"><span class="pre">InternalResourceViewResolver</span></code>や <code class="docutils literal notranslate"><span class="pre">TilesViewResolver</span></code>等)となる。</div>
</div>
<div class="line-block">
<div class="line">以下では、JSP用の<code class="docutils literal notranslate"><span class="pre">InternalResourceViewResolver</span></code>を使用する場合の例を記載する。</div>
</div>
<ul>
<li><p>SpringMvcConfig.java</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@EnableAspectJAutoProxy</span>
<span class="nd">@EnableWebMvc</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SpringMvcConfig</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">WebMvcConfigurer</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (1)</span>

<span class="w">    </span><span class="c1">// omitted</span>

<span class="w">    </span><span class="nd">@Override</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configureViewResolvers</span><span class="p">(</span><span class="n">ViewResolverRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">jsp</span><span class="p">(</span><span class="s">&quot;/WEB-INF/views/&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.jsp&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>SampleController.java</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// (3)</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">WebMvcConfigurer</span></code>を実装し、<code class="docutils literal notranslate"><span class="pre">configureViewResolvers</span></code>をOverrideする。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">ViewResolverRegistry</span></code>にJSP用の<code class="docutils literal notranslate"><span class="pre">InternalResourceViewResolver</span></code>を定義する。</p>
<ul class="simple">
<li><p>第一引数には<code class="docutils literal notranslate"><span class="pre">prefix</span></code>として、JSPファイルが格納されているベースディレクトリ(ファイルパスのプレフィックス)を指定する。</p></li>
<li><p>第二引数には<code class="docutils literal notranslate"><span class="pre">suffix</span></code>として、<code class="docutils literal notranslate"><span class="pre">.jsp</span></code>を適用する。</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p>ハンドラメソッドの返り値として<code class="docutils literal notranslate"><span class="pre">sample/hello</span></code>というView名を返却した場合、<code class="docutils literal notranslate"><span class="pre">/WEB-INF/views/sample/hello.jsp</span></code>が呼び出されてHTMLが応答される。</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div><div aria-labelledby="tab-6-VGh5bWVsZWFm" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-6-VGh5bWVsZWFm" name="VGh5bWVsZWFm" role="tabpanel" tabindex="0"><div class="line-block">
<div class="line">Thymeleafを使ってHTMLを生成する場合の<code class="docutils literal notranslate"><span class="pre">ViewResolver</span></code>には、<code class="docutils literal notranslate"><span class="pre">ThymeleafViewResolver</span></code>を用いる。</div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">ThymeleafViewResolver</span></code> の設定例については、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Thymeleaf.html#configuration-of-blank-project-label"><span class="std std-ref">ブランクプロジェクトの設定</span></a>を参照されたい。</div>
</div>
<ul>
<li><p>SampleController.java</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>ハンドラメソッドの返り値として<code class="docutils literal notranslate"><span class="pre">sample/hello</span></code>というView名を返却した場合、<code class="docutils literal notranslate"><span class="pre">ThymeleafViewResolver</span></code>の設定によりテンプレートHTMLとして<code class="docutils literal notranslate"><span class="pre">/WEB-INF/views/sample/hello.html</span></code>を利用して生成したHTMLが返される。</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></div>
</div><div aria-labelledby="tab-5-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-5-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-7-SlNQ" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-7-SlNQ" name="SlNQ" role="tab" tabindex="0">JSP</button><button aria-controls="panel-7-VGh5bWVsZWFm" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-7-VGh5bWVsZWFm" name="VGh5bWVsZWFm" role="tab" tabindex="-1">Thymeleaf</button></div><div aria-labelledby="tab-7-SlNQ" class="sphinx-tabs-panel group-tab" id="panel-7-SlNQ" name="SlNQ" role="tabpanel" tabindex="0"><div class="line-block">
<div class="line">JSPを使ってHTMLを生成する場合の<code class="docutils literal notranslate"><span class="pre">ViewResolver</span></code>は、基本的には<code class="docutils literal notranslate"><span class="pre">UrlBasedViewResolver</span></code>の継承クラス(<code class="docutils literal notranslate"><span class="pre">InternalResourceViewResolver</span></code>や <code class="docutils literal notranslate"><span class="pre">TilesViewResolver</span></code>等)となる。</div>
</div>
<div class="line-block">
<div class="line">以下では、JSP用の<code class="docutils literal notranslate"><span class="pre">InternalResourceViewResolver</span></code>を使用する場合の例を記載する。</div>
</div>
<ul>
<li><p>spring-mvc.xml</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;mvc:view-resolvers&gt;</span>
<span class="w">    </span><span class="nt">&lt;mvc:jsp</span><span class="w"> </span><span class="na">prefix=</span><span class="s">&quot;/WEB-INF/views/&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;/mvc:view-resolvers&gt;</span>
</pre></div>
</div>
</li>
<li><p>SampleController.java</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;mvc:jsp&gt;</span></code>要素を使用して、JSP用の<code class="docutils literal notranslate"><span class="pre">InternalResourceViewResolver</span></code>を定義する。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">prefix</span></code>属性には、JSPファイルが格納されているベースディレクトリ(ファイルパスのプレフィックス)を指定する。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">suffix</span></code>属性には、デフォルト値として<code class="docutils literal notranslate"><span class="pre">.jsp</span></code>が適用されているため、明示的に指定する必要はない。</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;mvc:view-resolvers&gt;</span></code>要素を使用すると、<code class="docutils literal notranslate"><span class="pre">ViewResolver</span></code>をシンプルに定義することが出来るため、本ガイドラインでは<code class="docutils literal notranslate"><span class="pre">&lt;mvc:view-resolvers&gt;</span></code>を使用することを推奨する。</p>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>ハンドラメソッドの返り値として<code class="docutils literal notranslate"><span class="pre">sample/hello</span></code>というView名を返却した場合、<code class="docutils literal notranslate"><span class="pre">/WEB-INF/views/sample/hello.jsp</span></code>が呼び出されてHTMLが応答される。</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div><div aria-labelledby="tab-7-VGh5bWVsZWFm" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-7-VGh5bWVsZWFm" name="VGh5bWVsZWFm" role="tabpanel" tabindex="0"><div class="line-block">
<div class="line">Thymeleafを使ってHTMLを生成する場合の<code class="docutils literal notranslate"><span class="pre">ViewResolver</span></code>には、<code class="docutils literal notranslate"><span class="pre">ThymeleafViewResolver</span></code>を用いる。</div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">ThymeleafViewResolver</span></code> の設定例については、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Thymeleaf.html#configuration-of-blank-project-label"><span class="std std-ref">ブランクプロジェクトの設定</span></a>を参照されたい。</div>
</div>
<ul>
<li><p>SampleController.java</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>ハンドラメソッドの返り値として<code class="docutils literal notranslate"><span class="pre">sample/hello</span></code>というView名を返却した場合、<code class="docutils literal notranslate"><span class="pre">ThymeleafViewResolver</span></code>の設定によりテンプレートHTMLとして<code class="docutils literal notranslate"><span class="pre">/WEB-INF/views/sample/hello.html</span></code>を利用して生成したHTMLが返される。</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></div>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>他のテンプレートエンジンを使用してHTMLを生成する場合でも、ハンドラメソッドの返り値は<code class="docutils literal notranslate"><span class="pre">sample/hello</span></code>のままでよい。使用するテンプレートエンジンでの差分は<code class="docutils literal notranslate"><span class="pre">ViewResolver</span></code>によって解決される。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>HTTPメソッドがGETまたはHEADであり、view 名を返すだけのメソッドを実装する場合は、<code class="docutils literal notranslate"><span class="pre">&lt;mvc:view-controller&gt;</span></code>を使用してControllerクラスの実装を代用することも可能である。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;mvc:view-controller&gt;</span></code>を使用したControllerの定義例。</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;mvc:view-controller</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;/hello&quot;</span><span class="w"> </span><span class="na">view-name=</span><span class="s">&quot;sample/hello&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>&lt;mvc:view-controller&gt;使用に関する留意点</strong></p>
<p>HTTPメソッドがGETとHEAD以外(POSTなど)でアクセスするページの場合、<code class="docutils literal notranslate"><span class="pre">&lt;mvc:view-controller&gt;</span></code>は使用できない。</p>
<p>GETとHEAD以外(POSTなど)からフォワードされた場合も同様となるため、エラーページへの遷移などフォワード元のHTTPメソッドが限定できない場合には<code class="docutils literal notranslate"><span class="pre">&lt;mvc:view-controller&gt;</span></code>を使用しないよう注意されたい。</p>
</div>
</li>
</ul>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-method-return-download-label">
<span id="id35"></span><h4><a class="toc-backref" href="#id138" role="doc-backlink"><span class="section-number">3.4.1.5.2. </span>ダウンロードデータを応答する</a><a class="headerlink" href="#controller-method-return-download-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">データベースなどに格納されているデータをダウンロードデータ(<code class="docutils literal notranslate"><span class="pre">application/octet-stream</span></code>等 )として応答する場合、レスポンスデータの生成(ダウンロード処理)を行うViewを作成し、処理を委譲することを推奨する。</div>
<div class="line">ハンドラメソッドでは、ダウンロード対象となるデータを <code class="docutils literal notranslate"><span class="pre">Model</span></code>に追加し、ダウンロード処理を行うViewのView名を返却する。</div>
</div>
<div class="line-block">
<div class="line">View名からViewを解決する方法としては、個別のViewResolverを作成する方法もあるが、ここではSpring Frameworkから提供されている<code class="docutils literal notranslate"><span class="pre">BeanNameViewResolver</span></code>を使用する。</div>
<div class="line">ダウンロード処理の詳細については、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/FileDownload.html"><span class="doc">ファイルダウンロード</span></a>を参照されたい。</div>
</div>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-8-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-8-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-8-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-8-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-8-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-8-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><ul>
<li><p>SpringMvcConfig.java</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@EnableAspectJAutoProxy</span>
<span class="nd">@EnableWebMvc</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SpringMvcConfig</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">WebMvcConfigurer</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// omitted</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configureViewResolvers</span><span class="p">(</span><span class="n">ViewResolverRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">beanName</span><span class="p">();</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">        </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">ViewResolverRegistry</span></code>にBean名をView名として解決する<code class="docutils literal notranslate"><span class="pre">BeanNameViewResolver</span></code>を定義する。</p>
<p><code class="docutils literal notranslate"><span class="pre">ViewResolverRegistry</span></code>のメソッド呼び出し順が<code class="docutils literal notranslate"><span class="pre">ViewResolver</span></code>の優先順位となる。</p>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div><div aria-labelledby="tab-8-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-8-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><ul>
<li><p>spring-mvc.xml</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;mvc:view-resolvers&gt;</span>
<span class="w">    </span><span class="nt">&lt;mvc:bean-name</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/mvc:view-resolvers&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;mvc:bean-name&gt;</span></code>要素を使用して、<code class="docutils literal notranslate"><span class="pre">BeanNameViewResolver</span></code>を定義する。</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;mvc:view-resolvers&gt;</span></code>要素を使用して<code class="docutils literal notranslate"><span class="pre">ViewResolver</span></code>を定義する場合は、子要素に指定する<code class="docutils literal notranslate"><span class="pre">ViewResolver</span></code>の定義順が優先順位となる。</p>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></div>
<ul>
<li><p>SampleController.java</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;report&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">report</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/report&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>XxxExcelView.java</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Component</span><span class="p">(</span><span class="s">&quot;sample/report&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (3)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">XxxExcelView</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractXlsxView</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (4)</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">buildExcelDocument</span><span class="p">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">model</span><span class="p">,</span>
<span class="w">            </span><span class="n">Workbook</span><span class="w"> </span><span class="n">workbook</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span>
<span class="w">            </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Sheet</span><span class="w"> </span><span class="n">sheet</span><span class="p">;</span>
<span class="w">        </span><span class="n">Cell</span><span class="w"> </span><span class="n">cell</span><span class="p">;</span>

<span class="w">        </span><span class="n">sheet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workbook</span><span class="p">.</span><span class="na">createSheet</span><span class="p">(</span><span class="s">&quot;Spring&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">sheet</span><span class="p">.</span><span class="na">setDefaultColumnWidth</span><span class="p">(</span><span class="mi">12</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// write a text at A1</span>
<span class="w">        </span><span class="n">cell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getCell</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="n">setText</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Spring-Excel test&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="n">cell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getCell</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="n">setText</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span><span class="w"> </span><span class="p">((</span><span class="n">Date</span><span class="p">)</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;serverTime&quot;</span><span class="p">)).</span><span class="na">toString</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>ハンドラメソッドの返り値として<code class="docutils literal notranslate"><span class="pre">sample/report</span></code>というView名を返却した場合、 (3)でBean登録されたViewインスタンスによって生成されたデータがダウンロードデータとして応答される。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p>コンポーネントの名前にView名を指定して、ViewオブジェクトをBeanとして登録する。</p>
<p>上記例では、<code class="docutils literal notranslate"><span class="pre">sample/report</span></code>というbean名(View名)で<code class="docutils literal notranslate"><span class="pre">x.y.z.app.views.XxxExcelView</span></code>のインスタンスがBean登録される。</p>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><p>Viewの実装例。</p>
<p>上記例では、<code class="docutils literal notranslate"><span class="pre">org.springframework.web.servlet.view.document.AbstractXlsxView</span></code>を継承し、Excelデータを生成するViewクラスの実装となる。</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="id36">
<h3><a class="toc-backref" href="#id139" role="doc-backlink"><span class="section-number">3.4.1.6. </span>処理の実装</a><a class="headerlink" href="#id36" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line"><strong>Controllerでは、業務処理の実装は行わない</strong>という点がポイントとなる。</div>
<div class="line">業務処理の実装はServiceで行い、Controllerでは業務処理が実装されているServiceのメソッドを呼び出す。</div>
<div class="line">業務処理の実装の詳細については<a class="reference internal" href="DomainLayer.html"><span class="doc">ドメイン層の実装</span></a>を参照されたい。</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Controllerは、基本的には画面遷移の決定などの処理のルーティングと<code class="docutils literal notranslate"><span class="pre">Model</span></code>の設定のみ実装することに徹し、可能な限りシンプルな状態に保つこと。</p>
<p>この方針で統一することにより、Controllerで実装すべき処理が明確になり、開発規模が大きくなった場合でもControllerのメンテナンス性を保つことができる。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Controllerで実装すべき処理を以下に4つ示す。</p>
<ul class="simple">
<li><p><a class="reference internal" href="#controller-logic-correlationcheck-label"><span class="std std-ref">入力値の相関チェック</span></a></p></li>
<li><p><a class="reference internal" href="#controller-logic-businesslogic-label"><span class="std std-ref">業務処理の呼び出し</span></a></p></li>
<li><p><a class="reference internal" href="#controller-logic-domainobject-label"><span class="std std-ref">ドメインオブジェクトへの値反映</span></a></p></li>
<li><p><a class="reference internal" href="#controller-logic-formobject-label"><span class="std std-ref">フォームオブジェクトへの値反映</span></a></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="controller-logic-correlationcheck-label">
<span id="id37"></span><h4><a class="toc-backref" href="#id140" role="doc-backlink"><span class="section-number">3.4.1.6.1. </span>入力値の相関チェック</a><a class="headerlink" href="#controller-logic-correlationcheck-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">入力値に対する相関チェックは、<code class="docutils literal notranslate"><span class="pre">org.springframework.validation.Validator</span></code>インタフェースを実装したValidationクラス、もしくは、Bean Validationで検証を行う。</div>
<div class="line">相関チェックの実装の詳細については、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Validation.html"><span class="doc">入力チェック</span></a>を参照されたい。</div>
</div>
<div class="line-block">
<div class="line">相関チェックの実装自体はControllerのハンドラメソッドで行うことはないが、相関チェックを行う<code class="docutils literal notranslate"><span class="pre">Validator</span></code>を<code class="docutils literal notranslate"><span class="pre">org.springframework.web.bind.WebDataBinder</span></code>に追加する必要がある。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Inject</span>
<span class="n">PasswordEqualsValidator</span><span class="w"> </span><span class="n">passwordEqualsValidator</span><span class="p">;</span><span class="w"> </span><span class="c1">// (1)</span>

<span class="nd">@InitBinder</span>
<span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initBinder</span><span class="p">(</span><span class="n">WebDataBinder</span><span class="w"> </span><span class="n">binder</span><span class="p">){</span>
<span class="w">    </span><span class="n">binder</span><span class="p">.</span><span class="na">addValidators</span><span class="p">(</span><span class="n">passwordEqualsValidator</span><span class="p">);</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>相関チェックを行う<code class="docutils literal notranslate"><span class="pre">Validator</span></code>をInjectする。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Injectした<code class="docutils literal notranslate"><span class="pre">Validator</span></code>を <code class="docutils literal notranslate"><span class="pre">WebDataBinder</span></code>に追加する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">WebDataBinder</span></code>に追加しておくことで、ハンドラメソッド呼び出し前に行われる入力チェック処理にて、(1)で追加した<code class="docutils literal notranslate"><span class="pre">Validator</span></code>が実行され、相関チェックを行うことが出来る。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-logic-businesslogic-label">
<span id="id38"></span><h4><a class="toc-backref" href="#id141" role="doc-backlink"><span class="section-number">3.4.1.6.2. </span>業務処理の呼び出し</a><a class="headerlink" href="#controller-logic-businesslogic-label" title="Permalink to this heading">¶</a></h4>
<p>業務処理が実装されているServiceをInjectし、InjectしたServiceのメソッドを呼び出すことで業務処理を実行する。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Inject</span>
<span class="n">SampleService</span><span class="w"> </span><span class="n">sampleService</span><span class="p">;</span><span class="w"> </span><span class="c1">// (1)</span>

<span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">){</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sampleService</span><span class="p">.</span><span class="na">hello</span><span class="p">();</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">業務処理が実装されている<code class="docutils literal notranslate"><span class="pre">Service</span></code>をInjectする。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>Injectした<code class="docutils literal notranslate"><span class="pre">Service</span></code>のメソッドを呼び出し、業務処理を実行する。</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-logic-domainobject-label">
<span id="id39"></span><h4><a class="toc-backref" href="#id142" role="doc-backlink"><span class="section-number">3.4.1.6.3. </span>ドメインオブジェクトへの値反映</a><a class="headerlink" href="#controller-logic-domainobject-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">本ガイドラインでは、HTML formから送信されたデータは直接ドメインオブジェクトにバインドするのではなく、フォームオブジェクトにバインドする方法を推奨している。</div>
<div class="line">そのため、ControllerではServiceのメソッドに渡すドメインオブジェクトにフォームオブジェクトの値を反映する処理を行う必要がある。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span><span class="nd">@Validated</span><span class="w"> </span><span class="n">SampleForm</span><span class="w"> </span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">BindingResult</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">){</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="n">Sample</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Sample</span><span class="p">();</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="n">sample</span><span class="p">.</span><span class="na">setField1</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getField1</span><span class="p">());</span>
<span class="w">    </span><span class="n">sample</span><span class="p">.</span><span class="na">setField2</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getField2</span><span class="p">());</span>
<span class="w">    </span><span class="n">sample</span><span class="p">.</span><span class="na">setField3</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getField3</span><span class="p">());</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sampleService</span><span class="p">.</span><span class="na">hello</span><span class="p">(</span><span class="n">sample</span><span class="p">);</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">);</span><span class="w"> </span><span class="c1">// (3)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Serviceの引数となるドメインオブジェクトを生成し、フォームオブジェクトにバインドされている値を反映する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>Serviceのメソッドを呼び出し、業務処理を実行する。</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p>業務処理から返却されたデータを <code class="docutils literal notranslate"><span class="pre">Model</span></code>に追加する。</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line">ドメインオブジェクトへ値を反映する処理は、Controllerのハンドラメソッド内で実装してもよいが、コード量が多くなる場合はハンドラメソッドの可読性を考慮してHelperクラスのメソッドに処理を委譲することを推奨する。</div>
<div class="line">以下にHelperメソッドに処理を委譲した場合の例を示す。</div>
</div>
<ul>
<li><p>SampleController.java</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Inject</span>
<span class="n">SampleHelper</span><span class="w"> </span><span class="n">sampleHelper</span><span class="p">;</span><span class="w"> </span><span class="c1">// (1)</span>

<span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span><span class="nd">@Validated</span><span class="w"> </span><span class="n">SampleForm</span><span class="w"> </span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">BindingResult</span><span class="w"> </span><span class="n">result</span><span class="p">){</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sampleHelper</span><span class="p">.</span><span class="na">hello</span><span class="p">(</span><span class="n">form</span><span class="p">);</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>SampleHelper.java</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SampleHelper</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Inject</span>
<span class="w">    </span><span class="n">SampleService</span><span class="w"> </span><span class="n">sampleService</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span><span class="n">SampleForm</span><span class="w"> </span><span class="n">form</span><span class="p">){</span><span class="w"> </span><span class="c1">// (3)</span>
<span class="w">        </span><span class="n">Sample</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Sample</span><span class="p">();</span>
<span class="w">        </span><span class="n">sample</span><span class="p">.</span><span class="na">setField1</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getField1</span><span class="p">());</span>
<span class="w">        </span><span class="n">sample</span><span class="p">.</span><span class="na">setField2</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getField2</span><span class="p">());</span>
<span class="w">        </span><span class="n">sample</span><span class="p">.</span><span class="na">setField3</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getField3</span><span class="p">());</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">        </span><span class="c1">// and more ...</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sampleService</span><span class="p">.</span><span class="na">hello</span><span class="p">(</span><span class="n">sample</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">message</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>ControllerにHelperクラスのオブジェクトをInjectする。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>InjectしたHelperクラスのメソッドを呼び出すことで、ドメインオブジェクトへの値の反映を行っている。
Helperクラスに処理を委譲することで、Controllerの実装をシンプルな状態に保つことができる。</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p>ドメインオブジェクトを生成した後にServiceクラスのメソッド呼び出し、業務処理を実行している。</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Helperクラスに処理を委譲する以外の方法として、Bean変換機能を使用する方法がある。</p>
<p>Bean変換機能の詳細は、<a class="reference internal" href="../ArchitectureInDetail/GeneralFuncDetail/BeanMapping.html"><span class="doc">Beanマッピング(MapStruct)</span></a>を参照されたい。</p>
</div>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controller-logic-formobject-label">
<span id="id40"></span><h4><a class="toc-backref" href="#id143" role="doc-backlink"><span class="section-number">3.4.1.6.4. </span>フォームオブジェクトへの値反映</a><a class="headerlink" href="#controller-logic-formobject-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">本ガイドラインでは、HTML formの項目にバインドするデータはドメインオブジェクトではなく、フォームオブジェクトを使用する方法を推奨している。</div>
<div class="line">そのため、ControllerではServiceのメソッドから返却されたドメインオブジェクトの値をフォームオブジェクトに反映する処理を行う必要がある。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span><span class="n">SampleForm</span><span class="w"> </span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">BindingResult</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">){</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="n">Sample</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sampleService</span><span class="p">.</span><span class="na">getSample</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="n">form</span><span class="p">.</span><span class="na">setField1</span><span class="p">(</span><span class="n">sample</span><span class="p">.</span><span class="na">getField1</span><span class="p">());</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="n">form</span><span class="p">.</span><span class="na">setField2</span><span class="p">(</span><span class="n">sample</span><span class="p">.</span><span class="na">getField2</span><span class="p">());</span>
<span class="w">    </span><span class="n">form</span><span class="p">.</span><span class="na">setField3</span><span class="p">(</span><span class="n">sample</span><span class="p">.</span><span class="na">getField3</span><span class="p">());</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">    </span><span class="c1">// and more ...</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">    </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">sample</span><span class="p">);</span><span class="w"> </span><span class="c1">// (3)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>業務処理が実装されているServiceのメソッドを呼び出し、ドメインオブジェクトを取得する。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>取得したドメインオブジェクトの値をフォームオブジェクトに反映する。</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p>表示のみ行う項目がある場合は、データを参照できるようにするために、<code class="docutils literal notranslate"><span class="pre">Model</span></code>にドメインオブジェクトを追加する。</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>画面に表示のみ行う項目については、フォームオブジェクトに項目をもつのではなく、Entityなどのドメインオブジェクトから直接値を参照することを推奨する。</p>
</div>
</div></blockquote>
<p>フォームオブジェクトへの値反映処理は、Controllerのハンドラメソッド内で実装してもよいが、コード量が多くなる場合はハンドラメソッドの可読性を考慮してHelperクラスのメソッドに委譲することを推奨する。</p>
<ul>
<li><p>SampleController.java</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span><span class="nd">@Validated</span><span class="w"> </span><span class="n">SampleForm</span><span class="w"> </span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="n">BindingResult</span><span class="w"> </span><span class="n">result</span><span class="p">){</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="n">Sample</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sampleService</span><span class="p">.</span><span class="na">getSample</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<span class="w">    </span><span class="n">sampleHelper</span><span class="p">.</span><span class="na">applyToForm</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span><span class="w"> </span><span class="n">form</span><span class="p">);</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">sample</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>SampleHelper.java</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">applyToForm</span><span class="p">(</span><span class="n">SampleForm</span><span class="w"> </span><span class="n">destForm</span><span class="p">,</span><span class="w"> </span><span class="n">Sample</span><span class="w"> </span><span class="n">srcSample</span><span class="p">){</span>
<span class="w">    </span><span class="n">destForm</span><span class="p">.</span><span class="na">setField1</span><span class="p">(</span><span class="n">srcSample</span><span class="p">.</span><span class="na">getField1</span><span class="p">());</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="n">destForm</span><span class="p">.</span><span class="na">setField2</span><span class="p">(</span><span class="n">srcSample</span><span class="p">.</span><span class="na">getField2</span><span class="p">());</span>
<span class="w">    </span><span class="n">destForm</span><span class="p">.</span><span class="na">setField3</span><span class="p">(</span><span class="n">srcSample</span><span class="p">.</span><span class="na">getField3</span><span class="p">());</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">    </span><span class="c1">// and more ...</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>ドメインオブジェクトの値をフォームオブジェクトに反映するためのメソッドを呼び出す。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>ドメインオブジェクトの値をフォームオブジェクトに反映するためのメソッドにて、ドメインオブジェクトの値をフォームオブジェクトに反映する。</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Helperクラスに処理を委譲する以外の方法として、Bean変換機能を使用する方法がある。</p>
<p>Bean変換機能の詳細は、<a class="reference internal" href="../ArchitectureInDetail/GeneralFuncDetail/BeanMapping.html"><span class="doc">Beanマッピング(MapStruct)</span></a>を参照されたい。</p>
</div>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
</section>
<section id="formobject">
<span id="id41"></span><h2><a class="toc-backref" href="#id144" role="doc-backlink"><span class="section-number">3.4.2. </span>フォームオブジェクトの実装</a><a class="headerlink" href="#formobject" title="Permalink to this heading">¶</a></h2>
<p>フォームオブジェクトはHTML上のformを表現するオブジェクト(JavaBean)であり、以下の役割を担う。</p>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>データベース等で保持している業務データを保持し、HTML formから参照できるようにする。</strong></div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>HTML formから送信されたリクエストパラメータを保持し、ハンドラメソッドで参照できるようにする。</strong></div>
</div>
</li>
</ol>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/applicationFormobject.png"><img alt="../_images/applicationFormobject.png" src="../_images/applicationFormobject.png" style="width: 80%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>フォームオブジェクトの実装について、以下4点に着目して説明する。</p>
<ul class="simple">
<li><p><a class="reference internal" href="#formobject-new-label"><span class="std std-ref">フォームオブジェクトの作成方法</span></a></p></li>
<li><p><a class="reference internal" href="#formobject-init-label"><span class="std std-ref">フォームオブジェクトの初期化方法</span></a></p></li>
<li><p><a class="reference internal" href="#formobject-bindhtmlform-label"><span class="std std-ref">HTMLへのバインディング方法</span></a></p></li>
<li><p><a class="reference internal" href="#formobject-bindrequestparam-label"><span class="std std-ref">リクエストパラメータのバインディング方法</span></a></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="formobject-new-label">
<span id="id42"></span><h3><a class="toc-backref" href="#id145" role="doc-backlink"><span class="section-number">3.4.2.1. </span>フォームオブジェクトの作成方法</a><a class="headerlink" href="#formobject-new-label" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line">フォームオブジェクトはJavaBeanとして作成する。</div>
<div class="line">Spring Frameworkでは、HTML formから送信されたリクエストパラメータ(文字列)を、フォームオブジェクトに定義されている型に変換してからバインドする機能を提供しているため、フォームオブジェクトに定義するフィールドの型は、<code class="docutils literal notranslate"><span class="pre">java.lang.String</span></code>だけではなく、任意の型で定義することができる。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SampleForm</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">genderCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="n">birthDate</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// ommitted getter/setter</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>フォームオブジェクトには画面に表示のみ行う項目は保持せず、HTML formの項目のみ保持することを推奨する。</p>
<p>フォームオブジェクトに画面表示のみ行う項目の値を設定した場合、フォームオブジェクトをHTTPセッションオブジェクトに格納する際にメモリを多く消費する事になり、メモリ枯渇の原因になる可能性がある。</p>
<p>画面表示のみの項目は、Entityなどのドメイン層のオブジェクトをリクエストスコープに追加(<code class="docutils literal notranslate"><span class="pre">Model.addAttribute</span></code>)することでHTMLにデータを渡すことを推奨する。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="id43">
<h4><a class="toc-backref" href="#id146" role="doc-backlink"><span class="section-number">3.4.2.1.1. </span>フィールド単位の数値型変換</a><a class="headerlink" href="#id43" title="Permalink to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">&#64;NumberFormat</span></code>アノテーションを使用することでフィールド毎に数値の形式を指定することが出来る。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SampleForm</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@NumberFormat</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;#,#&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">price</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// ommitted getter/setter</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>HTML formから送信されるリクエストパラメータの数値形式を指定する。例では、patternとして<code class="docutils literal notranslate"><span class="pre">#,#</span></code>形式を指定しているので、「,」でフォーマットされた値をバインドすることができる。
リクエストパラメータの値が<code class="docutils literal notranslate"><span class="pre">1,050</span></code>の場合、フォームオブジェクトのpriceには<code class="docutils literal notranslate"><span class="pre">1050</span></code>のIntegerオブジェクトがバインドされる。</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">&#64;NumberFormat</span></code>アノテーションで指定できる属性は以下の通り。</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 10.0%" />
<col style="width: 80.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>属性名</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ol class="arabic simple">
<li></li>
</ol>
</td>
<td><p>style</p></td>
<td><p>数値のスタイルを指定する。詳細は、<a class="reference external" href="https://docs.spring.io/spring-framework/docs/6.1.3/javadoc-api/org/springframework/format/annotation/NumberFormat.Style.html">NumberFormat.StyleのJavadoc</a>を参照されたい。</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p>pattern</p></td>
<td><p>Javaの数値形式を指定する。詳細は、<a class="reference external" href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/text/DecimalFormat.html">DecimalFormatのJavadoc</a>を参照されたい。</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="applicationlayer-datetimeformat">
<span id="id44"></span><h4><a class="toc-backref" href="#id147" role="doc-backlink"><span class="section-number">3.4.2.1.2. </span>フィールド単位の日時型変換</a><a class="headerlink" href="#applicationlayer-datetimeformat" title="Permalink to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">&#64;DateTimeFormat</span></code>アノテーションを使用することでフィールド毎に日時の形式を指定することが出来る。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SampleForm</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@DateTimeFormat</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;yyyyMMdd&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="n">birthDate</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// ommitted getter/setter</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>HTML formから送信されるリクエストパラメータの日時形式を指定する。例では、patternとして<code class="docutils literal notranslate"><span class="pre">yyyyMMdd</span></code>形式を指定している。
リクエストパラメータの値が<code class="docutils literal notranslate"><span class="pre">20131001</span></code>の場合、フォームオブジェクトのbirthDateには 2013年10月1日のDateオブジェクトがバインドされる。</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">&#64;DateTimeFormat</span></code>アノテーションで指定できる属性は以下の通り。</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 10.0%" />
<col style="width: 80.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>属性名</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ol class="arabic simple">
<li></li>
</ol>
</td>
<td><p>iso</p></td>
<td><p>ISOの日時形式を指定する。詳細は、<a class="reference external" href="https://docs.spring.io/spring-framework/docs/6.1.3/javadoc-api/org/springframework/format/annotation/DateTimeFormat.ISO.html">DateTimeFormat.ISOのJavadoc</a>を参照。</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p>pattern</p></td>
<td><p>Javaの日時形式を指定する。詳細は、<a class="reference external" href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/text/SimpleDateFormat.html">SimpleDateFormatのJavadoc</a>を参照されたい。</p></td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p>style</p></td>
<td><div class="line-block">
<div class="line">日付と時刻のスタイルを2桁の文字列として指定する。</div>
<div class="line">1桁目が日付のスタイル、2桁目が時刻のスタイルとなる。</div>
<div class="line">スタイルとして指定できる値は以下の値となる。</div>
<div class="line"><br /></div>
<div class="line">S : <code class="docutils literal notranslate"><span class="pre">java.text.DateFormat.SHORT</span></code>と同じ形式となる。</div>
<div class="line">M : <code class="docutils literal notranslate"><span class="pre">java.text.DateFormat.MEDIUM</span></code>と同じ形式となる。</div>
<div class="line">L : <code class="docutils literal notranslate"><span class="pre">java.text.DateFormat.LONG</span></code>と同じ形式となる。</div>
<div class="line">F : <code class="docutils literal notranslate"><span class="pre">java.text.DateFormat.FULL</span></code>と同じ形式となる。</div>
<div class="line">- : 省略を意味するスタイル。</div>
<div class="line"><br /></div>
<div class="line">指定例及び変換例)</div>
<div class="line">MM : Dec 9, 2013 3:37:47 AM</div>
<div class="line">M- : Dec 9, 2013</div>
<div class="line">-M : 3:41:45 AM</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">DateTimeFormat</span></code>では、<code class="docutils literal notranslate"><span class="pre">java.util.Date</span></code>、<code class="docutils literal notranslate"><span class="pre">java.util.Calendar</span></code>、<code class="docutils literal notranslate"><span class="pre">java.lang.Long</span></code>(タイムスタンプとしての<code class="docutils literal notranslate"><span class="pre">Long</span></code>) および<code class="docutils literal notranslate"><span class="pre">java.time.*</span></code>(JSR-310 Date And Time API) を型として指定できる。</p>
<p>TERASOLUNA Server Framework for Java (5.x)ではJSR-310 Date And Time APIの使用を推奨する。</p>
<p>詳しくは、<a class="reference internal" href="../ArchitectureInDetail/GeneralFuncDetail/DateAndTime.html"><span class="doc">日付操作(JSR-310 Date and Time API)</span></a>、<a class="reference internal" href="../ArchitectureInDetail/GeneralFuncDetail/SystemDate.html"><span class="doc">システム時刻</span></a>を参照されたい。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id45">
<h4><a class="toc-backref" href="#id148" role="doc-backlink"><span class="section-number">3.4.2.1.3. </span>Controller単位の型変換</a><a class="headerlink" href="#id45" title="Permalink to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">&#64;InitBinder</span></code>アノテーションを使用することでController毎に型変換の定義を指定する事も出来る。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@InitBinder</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initWebDataBinder</span><span class="p">(</span><span class="n">WebDataBinder</span><span class="w"> </span><span class="n">binder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">binder</span><span class="p">.</span><span class="na">registerCustomEditor</span><span class="p">(</span>
<span class="w">            </span><span class="n">Long</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">CustomNumberEditor</span><span class="p">(</span><span class="n">Long</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DecimalFormat</span><span class="p">(</span><span class="s">&quot;#,#&quot;</span><span class="p">),</span><span class="w"> </span><span class="kc">true</span><span class="p">));</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@InitBinder</span><span class="p">(</span><span class="s">&quot;sampleForm&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (3)</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initSampleFormWebDataBinder</span><span class="p">(</span><span class="n">WebDataBinder</span><span class="w"> </span><span class="n">binder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&#64;InitBinder</span></code>アノテーション を付与したメソッド用意すると、バインド処理が行われる前にこのメソッドが呼び出され、デフォルトの動作をカスタマイズすることができる。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>例では、Long型のフィールドの数値形式を<code class="docutils literal notranslate"><span class="pre">#,#</span></code>に指定しているので、「,」でフォーマットされた値をバインドすることができる。</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&#64;InitBinder</span></code>アノテーションのvalue属性にフォームオブジェクトの属性名を指定することで、フォームオブジェクト毎にデフォルトの動作をカスタマイズすることもできる。
例では、<code class="docutils literal notranslate"><span class="pre">sampleForm</span></code>という属性名のフォームオブジェクトに対するバインド処理が行われる前にメソッドが呼び出される。</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id46">
<h4><a class="toc-backref" href="#id149" role="doc-backlink"><span class="section-number">3.4.2.1.4. </span>入力チェック用のアノテーションの指定</a><a class="headerlink" href="#id46" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">フォームオブジェクトのバリデーションは、Bean Validationを使用して行うため、フィールドの制約条件を示すアノテーションを指定する必要がある。</div>
<div class="line">入力チェックの詳細は、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Validation.html"><span class="doc">入力チェック</span></a>を参照されたい。</div>
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="formobject-init-label">
<span id="id47"></span><h3><a class="toc-backref" href="#id150" role="doc-backlink"><span class="section-number">3.4.2.2. </span>フォームオブジェクトの初期化方法</a><a class="headerlink" href="#formobject-init-label" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line">HTMLのformにバインドするフォームオブジェクトの事をform-backing beanと呼び、<code class="docutils literal notranslate"><span class="pre">&#64;ModelAttribute</span></code>アノテーションを使うことで結びつけることができる。</div>
<div class="line">form-backing beanの初期化は、<code class="docutils literal notranslate"><span class="pre">&#64;ModelAttribute</span></code>アノテーションを付与したメソッドで行う。</div>
<div class="line">このようなメソッドのことを本ガイドラインではModelAttributeメソッドと呼び、<code class="docutils literal notranslate"><span class="pre">setUpXxxForm</span></code>というメソッド名で定義することを推奨する。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@ModelAttribute</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">SampleForm</span><span class="w"> </span><span class="nf">setUpSampleForm</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">SampleForm</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SampleForm</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// populate form</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">form</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@ModelAttribute</span><span class="p">(</span><span class="s">&quot;xxx&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">SampleForm</span><span class="w"> </span><span class="nf">setUpSampleForm</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">SampleForm</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SampleForm</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// populate form</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">form</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@ModelAttribute</span>
<span class="kd">public</span><span class="w"> </span><span class="n">SampleForm</span><span class="w"> </span><span class="nf">setUpSampleForm</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@CookieValue</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="c1">// (3)</span>
<span class="w">        </span><span class="nd">@CookieValue</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;age&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">age</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@CookieValue</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;birthDate&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="n">birthDate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">SampleForm</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SampleForm</span><span class="p">();</span>
<span class="w">    </span><span class="n">form</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="w">    </span><span class="n">form</span><span class="p">.</span><span class="na">setAge</span><span class="p">(</span><span class="n">age</span><span class="p">);</span>
<span class="w">    </span><span class="n">form</span><span class="p">.</span><span class="na">setBirthDate</span><span class="p">(</span><span class="n">birthDate</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">form</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">Model</span></code>に追加するための属性名は、クラス名の先頭を小文字にした値（デフォルト値）が設定される。この例では<code class="docutils literal notranslate"><span class="pre">sampleForm</span></code>が属性名になる。</div>
<div class="line">返却したオブジェクトは、<code class="docutils literal notranslate"><span class="pre">model.addAttribute(form)</span></code>相当の処理が実行され<code class="docutils literal notranslate"><span class="pre">Model</span></code>に追加される。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">Model</span></code>に追加するための属性名を指定したい場合は、<code class="docutils literal notranslate"><span class="pre">&#64;ModelAttribute</span></code>アノテーションのvalue属性に指定する。この例では <code class="docutils literal notranslate"><span class="pre">xxx</span></code>が属性名になる。</div>
<div class="line">返却したオブジェクトは、<code class="docutils literal notranslate"><span class="pre">model.addAttribute(&quot;xxx&quot;,</span> <span class="pre">form)</span></code>相当の処理が実行され<code class="docutils literal notranslate"><span class="pre">Model</span></code>に追加される。</div>
<div class="line">デフォルト値以外の属性名を指定した場合、ハンドラメソッドの引数としてフォームオブジェクトを受け取る時に<code class="docutils literal notranslate"><span class="pre">&#64;ModelAttribute(&quot;xxx&quot;)</span></code>の指定が必要になる。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ModelAttributeメソッドは、ハンドラメソッドと同様に初期化に必要なパラメータを渡すこともできる。例では、<code class="docutils literal notranslate"><span class="pre">&#64;CookieValue</span></code>アノテーションを使用してCookieの値をフォームオブジェクトに設定している。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>フォームオブジェクトにデフォルト値を設定したい場合はModelAttributeメソッドで値を設定すること。</p>
<p>例の(3)ではCookieから値を取得しているが、定数クラスなどに定義されている固定値を直接設定してもよい。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ModelAttributeメソッドはController内に複数定義することができる。各メソッドはControllerのハンドラメソッドが呼び出される前に毎回実行される。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>ModelAttributeメソッドはリクエストごとにメソッドが実行されるため、特定のリクエストの時のみに必要なオブジェクトについてModelAttributeメソッドを使って生成すると、無駄なオブジェクトの生成及び初期化処理が行われる点に注意すること。</p>
<p>特定のリクエストのみで必要なオブジェクトについては、ハンドラメソッド内で生成し<code class="docutils literal notranslate"><span class="pre">Model</span></code>に追加する方法にすること。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="formobject-bindhtmlform-label">
<span id="id48"></span><h3><a class="toc-backref" href="#id151" role="doc-backlink"><span class="section-number">3.4.2.3. </span>HTMLへのバインディング方法</a><a class="headerlink" href="#formobject-bindhtmlform-label" title="Permalink to this heading">¶</a></h3>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-9-SlNQ" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-9-SlNQ" name="SlNQ" role="tab" tabindex="0">JSP</button><button aria-controls="panel-9-VGh5bWVsZWFm" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-9-VGh5bWVsZWFm" name="VGh5bWVsZWFm" role="tab" tabindex="-1">Thymeleaf</button></div><div aria-labelledby="tab-9-SlNQ" class="sphinx-tabs-panel group-tab" id="panel-9-SlNQ" name="SlNQ" role="tabpanel" tabindex="0"><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">Model</span></code>に追加されたフォームオブジェクトは<code class="docutils literal notranslate"><span class="pre">&lt;form:xxx&gt;</span></code>タグを用いて、HTML(JSP)のformにバインドすることができる。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;form:xxx&gt;</span></code>タグの詳細は、<a class="reference external" href="https://docs.spring.io/spring-framework/docs/6.1.3/reference/html/web.html#mvc-view-jsp-formtaglib">Spring Framework Documentation -Spring’s form tag library-</a>を参照されたい。</div>
</div>
<blockquote>
<div><div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;%@</span><span class="w"> </span><span class="n">taglib</span><span class="w"> </span><span class="n">prefix</span><span class="o">=</span><span class="s">&quot;form&quot;</span><span class="w"> </span><span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/tags/form&quot;</span><span class="w"> </span><span class="k">%&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
</pre></div>
</div>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;form:form</span><span class="w"> </span><span class="na">modelAttribute=</span><span class="s">&quot;sampleForm&quot;</span>
<span class="w">           </span><span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/sample/hello&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">    </span>Id<span class="w">         </span>:<span class="w"> </span><span class="nt">&lt;form:input</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="nt">/&gt;&lt;form:errors</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="nt">/&gt;&lt;br</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (3) --&gt;</span>
<span class="w">    </span>Name<span class="w">       </span>:<span class="w"> </span><span class="nt">&lt;form:input</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;name&quot;</span><span class="w"> </span><span class="nt">/&gt;&lt;form:errors</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;name&quot;</span><span class="w"> </span><span class="nt">/&gt;&lt;br</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span>Age<span class="w">        </span>:<span class="w"> </span><span class="nt">&lt;form:input</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;age&quot;</span><span class="w"> </span><span class="nt">/&gt;&lt;form:errors</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;age&quot;</span><span class="w"> </span><span class="nt">/&gt;&lt;br</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span>Gender<span class="w">     </span>:<span class="w"> </span><span class="nt">&lt;form:input</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;genderCode&quot;</span><span class="w"> </span><span class="nt">/&gt;&lt;form:errors</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;genderCode&quot;</span><span class="w"> </span><span class="nt">/&gt;&lt;br</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span>Birth<span class="w"> </span>Date<span class="w"> </span>:<span class="w"> </span><span class="nt">&lt;form:input</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;birthDate&quot;</span><span class="w"> </span><span class="nt">/&gt;&lt;form:errors</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;birthDate&quot;</span><span class="w"> </span><span class="nt">/&gt;&lt;br</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/form:form&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;form:form&gt;</span></code>タグを使用するためのtaglibの定義を行う。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;form:form&gt;</span></code>タグのmodelAttribute属性には、<code class="docutils literal notranslate"><span class="pre">Model</span></code>に格納されているフォームオブジェクトの属性名を指定する。</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;form:input&gt;</span></code>タグのpath属性には、フォームオブジェクトのプロパティ名を指定する。</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</div><div aria-labelledby="tab-9-VGh5bWVsZWFm" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-9-VGh5bWVsZWFm" name="VGh5bWVsZWFm" role="tabpanel" tabindex="0"><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">Model</span></code>に追加されたフォームオブジェクトの各プロパティは、Thymeleaf + Springで提供される<code class="docutils literal notranslate"><span class="pre">th:field</span></code>属性で指定することで、HTMLのinput要素にバインドすることができる。</div>
<div class="line">JSPには<code class="docutils literal notranslate"><span class="pre">&lt;form:xxx&gt;</span></code>タグを利用してフォームオブジェクトをHTML formにバインドする機能があるが、Thymeleafでは<code class="docutils literal notranslate"><span class="pre">th:field</span></code>属性に<code class="docutils literal notranslate"><span class="pre">th:object</span></code>属性を併用することで同様の機能を実現することができる。</div>
</div>
<blockquote>
<div><div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (1) --&gt;</span>
</pre></div>
</div>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&quot;@{/sample/hello}&quot;</span> <span class="na">th:object</span><span class="o">=</span><span class="s">&quot;${sampleForm}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (2) --&gt;</span>
    Id         : <span class="p">&lt;</span><span class="nt">input</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{id}&quot;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">th:errors</span><span class="o">=</span><span class="s">&quot;*{id}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (3) --&gt;</span>
    Name       : <span class="p">&lt;</span><span class="nt">input</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{name}&quot;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">th:errors</span><span class="o">=</span><span class="s">&quot;*{name}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    Age        : <span class="p">&lt;</span><span class="nt">input</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{age}&quot;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">th:errors</span><span class="o">=</span><span class="s">&quot;*{age}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    Gender     : <span class="p">&lt;</span><span class="nt">input</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{genderCode}&quot;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">th:errors</span><span class="o">=</span><span class="s">&quot;*{genderCode}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    Birth Date : <span class="p">&lt;</span><span class="nt">input</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{birthDate}&quot;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">th:errors</span><span class="o">=</span><span class="s">&quot;*{birthDate}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>スタンダードダイアレクトが提供する属性を使用したとき、EclipseなどのIDEでの警告を抑止するため、ネームスペースを付与する。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;form&gt;</span></code>タグの<code class="docutils literal notranslate"><span class="pre">th:object</span></code>属性には、<code class="docutils literal notranslate"><span class="pre">Model</span></code>に格納されているフォームオブジェクトの属性名を指定する。
<code class="docutils literal notranslate"><span class="pre">th:object</span></code>属性については、<a class="reference internal" href="#view-thymeleaf-object-label"><span class="std std-ref">オブジェクトのプロパティを省略して指定する</span></a>も参照されたい。</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;input&gt;</span></code>タグの<code class="docutils literal notranslate"><span class="pre">th:field</span></code>属性には、フォームオブジェクトのプロパティ名を指定する。</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="formobject-bindrequestparam-label">
<span id="id49"></span><h3><a class="toc-backref" href="#id152" role="doc-backlink"><span class="section-number">3.4.2.4. </span>リクエストパラメータのバインディング方法</a><a class="headerlink" href="#formobject-bindrequestparam-label" title="Permalink to this heading">¶</a></h3>
<p>HTML formから送信されたリクエストパラメータは、フォームオブジェクトにバインドし、Controllerのハンドラメソッドの引数に渡すことができる。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@Validated</span><span class="w"> </span><span class="n">SampleForm</span><span class="w"> </span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">        </span><span class="n">BindingResult</span><span class="w"> </span><span class="n">result</span><span class="p">,</span>
<span class="w">        </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/input&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// process form...</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@ModelAttribute</span><span class="p">(</span><span class="s">&quot;xxx&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">SampleForm</span><span class="w"> </span><span class="nf">setUpSampleForm</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">SampleForm</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SampleForm</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// populate form</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">form</span><span class="p">;</span>
<span class="p">}</span>

<span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@ModelAttribute</span><span class="p">(</span><span class="s">&quot;xxx&quot;</span><span class="p">)</span><span class="w"> </span><span class="nd">@Validated</span><span class="w"> </span><span class="n">SampleForm</span><span class="w"> </span><span class="n">form</span><span class="p">,</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">        </span><span class="n">BindingResult</span><span class="w"> </span><span class="n">result</span><span class="p">,</span>
<span class="w">        </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>フォームオブジェクトにリクエストパラメータが反映された状態で、Controllerのハンドラメソッドの引数に渡される。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>ModelAttributeメソッドにて属性名を指定した場合、<code class="docutils literal notranslate"><span class="pre">&#64;ModelAttribute(&quot;xxx&quot;)</span></code>といった感じで、フォームオブジェクトの属性名を明示的に指定する必要がある。</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>ModelAttributeメソッドで指定した属性名とメソッドの引数で指定した属性名が異なる場合、ModelAttributeメソッドで生成したインスタンスとは別のインスタンスが生成されるので注意が必要。</p>
<p>ハンドラメソッドで属性名の指定を省略した場合、クラス名の先頭を小文字にした値が属性名として扱われる。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="id50">
<h4><a class="toc-backref" href="#id153" role="doc-backlink"><span class="section-number">3.4.2.4.1. </span>バインディング結果の判定</a><a class="headerlink" href="#id50" title="Permalink to this heading">¶</a></h4>
<p>HTML formから送信されたリクエストパラメータをフォームオブジェクトにバインドする際に発生したエラー（入力チェックエラーも含む）は、<code class="docutils literal notranslate"><span class="pre">org.springframework.validation.BindingResult</span></code>に格納される。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@Validated</span><span class="w"> </span><span class="n">SampleForm</span><span class="w"> </span><span class="n">form</span><span class="p">,</span>
<span class="w">        </span><span class="n">BindingResult</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">        </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/input&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>フォームオブジェクトの直後に<code class="docutils literal notranslate"><span class="pre">BindingResult</span></code>を宣言すると、フォームオブジェクトへのバインド時のエラーと入力チェックエラーを参照することができる。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">BindingResult.hasErrors()</span></code>を呼び出すことで、フォームオブジェクトの入力値のエラー有無を判定することができる。</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>フィールドエラーの有無、グローバルエラー(相関チェックエラーなどのクラスレベルのエラー)の有無を個別に判定することもできるので、要件に応じて使い分けること。</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 40.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>メソッド</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ol class="arabic simple">
<li></li>
</ol>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">hasGlobalErrors()</span></code></p></td>
<td><p>グローバルエラーの有無を判定するメソッド</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">hasFieldErrors()</span></code></p></td>
<td><p>フィールドエラーの有無を判定するメソッド</p></td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">hasFieldErrors(String</span> <span class="pre">field)</span></code></p></td>
<td><p>指定したフィールドのエラー有無を判定するメソッド</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
</section>
<section id="id51">
<span id="id52"></span><h2><a class="toc-backref" href="#id154" role="doc-backlink"><span class="section-number">3.4.3. </span>Viewの実装</a><a class="headerlink" href="#id51" title="Permalink to this heading">¶</a></h2>
<p>Viewは以下の役割を担う。</p>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>クライアントに応答するレスポンスデータ(HTML)を生成する。</strong></div>
<div class="line">Viewはモデル（フォームオブジェクトやドメインオブジェクトなど）から必要なデータを取得し、クライアントが描画するために必要な形式でレスポンスデータを生成する。</div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="jspthymeleafhtml">
<span id="applicationlayerimplementofjsp"></span><h3><a class="toc-backref" href="#id155" role="doc-backlink"><span class="section-number">3.4.3.1. </span>JSPおよびThymeleafのテンプレートHTMLの実装</a><a class="headerlink" href="#jspthymeleafhtml" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line">クライアントにHTMLを応答する場合は、JSPを使用してViewを実装する。</div>
<div class="line">JSPを呼び出すための<code class="docutils literal notranslate"><span class="pre">ViewResolver</span></code>は、Spring Frameworkより提供されているので、提供されているクラスを利用する。<code class="docutils literal notranslate"><span class="pre">ViewResolver</span></code>の設定方法は、<a class="reference internal" href="#controller-method-return-html-label"><span class="std std-ref">HTMLを応答する</span></a>を参照されたい。</div>
</div>
<p>以下に、基本的なJSPの実装方法について説明する。</p>
<ul class="simple">
<li><p><a class="reference internal" href="#view-jsp-include-label"><span class="std std-ref">インクルード用の共通JSPの作成</span></a></p></li>
<li><p><a class="reference internal" href="#view-jsp-out-label"><span class="std std-ref">モデルに格納されている値を表示する</span></a></p></li>
<li><p><a class="reference internal" href="#view-jsp-outnumber-label"><span class="std std-ref">モデルに格納されている数値を表示する</span></a></p></li>
<li><p><a class="reference internal" href="#view-jsp-outdate-label"><span class="std std-ref">モデルに格納されている日時を表示する</span></a></p></li>
<li><p><a class="reference internal" href="#view-jsp-requesturl-label"><span class="std std-ref">リクエストURLを生成する</span></a></p></li>
<li><p><a class="reference internal" href="#view-jsp-form-label"><span class="std std-ref">HTML formへフォームオブジェクトをバインドする</span></a></p></li>
<li><p><a class="reference internal" href="#view-jsp-errors-label"><span class="std std-ref">入力チェックエラーを表示する</span></a></p></li>
<li><p><a class="reference internal" href="#view-jsp-resultmessages-label"><span class="std std-ref">処理結果のメッセージを表示する</span></a></p></li>
<li><p><a class="reference internal" href="#view-jsp-codelist-label"><span class="std std-ref">コードリストを表示する</span></a></p></li>
<li><p><a class="reference internal" href="#view-jsp-message-label"><span class="std std-ref">固定文言を表示する</span></a></p></li>
<li><p><a class="reference internal" href="#view-jsp-if-label"><span class="std std-ref">条件によって表示を切り替える</span></a></p></li>
<li><p><a class="reference internal" href="#view-jsp-foreach-label"><span class="std std-ref">コレクションの要素に対して表示処理を繰り返す</span></a></p></li>
<li><p><a class="reference internal" href="#view-jsp-pagination-label"><span class="std std-ref">ページネーション用のリンクを表示する</span></a></p></li>
<li><p><a class="reference internal" href="#view-jsp-authorization-label"><span class="std std-ref">権限によって表示を切り替える</span></a></p></li>
</ul>
<p>本章では代表的なJSPタグライブラリの使い方は説明しているが、全てのJSPタグライブラリの説明はしていないので、詳細な使い方については、それぞれのドキュメントを参照すること。</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 30.0%" />
<col style="width: 60.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>JSPタグライブラリ名</p></th>
<th class="head"><p>ドキュメント</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ol class="arabic simple">
<li></li>
</ol>
</td>
<td><p>Spring’s form tag library</p></td>
<td><ul class="simple">
<li><p><a class="reference external" href="https://docs.spring.io/spring-framework/docs/6.1.3/reference/html/web.html#mvc-view-jsp-formtaglib">https://docs.spring.io/spring-framework/docs/6.1.3/reference/html/web.html#mvc-view-jsp-formtaglib</a></p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p>Spring’s JSP Tag Library</p></td>
<td><ul class="simple">
<li><p><a class="reference external" href="https://docs.spring.io/spring-framework/docs/6.1.3/reference/html/web.html#mvc-view-jsp-tags">https://docs.spring.io/spring-framework/docs/6.1.3/reference/html/web.html#mvc-view-jsp-tags</a></p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p>JSTL</p></td>
<td><ul class="simple">
<li><p><a class="reference external" href="https://jakarta.ee/specifications/tags/3.0/jakarta-tags-spec-3.0.html">https://jakarta.ee/specifications/tags/3.0/jakarta-tags-spec-3.0.html</a></p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="4">
<li></li>
</ol>
</td>
<td><p>Common library’s tags &amp; el functions</p></td>
<td><ul class="simple">
<li><p>本ガイドラインの「<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/TagLibAndELFunctions.html"><span class="doc">共通ライブラリが提供するJSP Tag Library と EL Functions</span></a>」</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="jsp">
<span id="view-jsp-include-label"></span><h4><a class="toc-backref" href="#id156" role="doc-backlink"><span class="section-number">3.4.3.1.1. </span>インクルード用の共通JSPの作成</a><a class="headerlink" href="#jsp" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">全てのJSPで必要となるディレクティブの宣言などを行うためのJSPを作成する。</div>
<div class="line">このJSPを<code class="docutils literal notranslate"><span class="pre">web.xml</span></code>の<code class="docutils literal notranslate"><span class="pre">&lt;jsp-config&gt;/&lt;jsp-property-group&gt;/&lt;include-prelude&gt;</span></code>要素に指定することで、個々のJSPで宣言する必要がなくなる。</div>
<div class="line">なお、このファイルはブランクプロジェクトで提供している。</div>
</div>
<ul>
<li><p>include.jsp</p>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;%@</span><span class="w"> </span><span class="n">taglib</span><span class="w"> </span><span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://java.sun.com/jsp/jstl/core&quot;</span><span class="w"> </span><span class="n">prefix</span><span class="o">=</span><span class="s">&quot;c&quot;</span><span class="k">%&gt;</span><span class="w"> </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span><span class="w"> </span><span class="n">taglib</span><span class="w"> </span><span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://java.sun.com/jsp/jstl/fmt&quot;</span><span class="w"> </span><span class="n">prefix</span><span class="o">=</span><span class="s">&quot;fmt&quot;</span><span class="k">%&gt;</span>

<span class="k">&lt;%@</span><span class="w"> </span><span class="n">taglib</span><span class="w"> </span><span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/tags&quot;</span><span class="w"> </span><span class="n">prefix</span><span class="o">=</span><span class="s">&quot;spring&quot;</span><span class="k">%&gt;</span><span class="w"> </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span><span class="w"> </span><span class="n">taglib</span><span class="w"> </span><span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/tags/form&quot;</span><span class="w"> </span><span class="n">prefix</span><span class="o">=</span><span class="s">&quot;form&quot;</span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span><span class="w"> </span><span class="n">taglib</span><span class="w"> </span><span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/security/tags&quot;</span><span class="w"> </span><span class="n">prefix</span><span class="o">=</span><span class="s">&quot;sec&quot;</span><span class="k">%&gt;</span>

<span class="k">&lt;%@</span><span class="w"> </span><span class="n">taglib</span><span class="w"> </span><span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://terasoluna.org/functions&quot;</span><span class="w"> </span><span class="n">prefix</span><span class="o">=</span><span class="s">&quot;f&quot;</span><span class="k">%&gt;</span><span class="w"> </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span><span class="w"> </span><span class="n">taglib</span><span class="w"> </span><span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://terasoluna.org/tags&quot;</span><span class="w"> </span><span class="n">prefix</span><span class="o">=</span><span class="s">&quot;t&quot;</span><span class="k">%&gt;</span>
</pre></div>
</div>
</li>
<li><p>web.xml</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;jsp-config&gt;</span>
<span class="w">    </span><span class="nt">&lt;jsp-property-group&gt;</span>
<span class="w">        </span><span class="nt">&lt;url-pattern&gt;</span>*.jsp<span class="nt">&lt;/url-pattern&gt;</span>
<span class="w">        </span><span class="nt">&lt;el-ignored&gt;</span>false<span class="nt">&lt;/el-ignored&gt;</span>
<span class="w">        </span><span class="nt">&lt;page-encoding&gt;</span>UTF-8<span class="nt">&lt;/page-encoding&gt;</span>
<span class="w">        </span><span class="nt">&lt;scripting-invalid&gt;</span>false<span class="nt">&lt;/scripting-invalid&gt;</span>
<span class="w">        </span><span class="nt">&lt;include-prelude&gt;</span>/WEB-INF/views/common/include.jsp<span class="nt">&lt;/include-prelude&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (4) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;/jsp-property-group&gt;</span>
<span class="nt">&lt;/jsp-config&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>JSTLのJSPタグライブラリを宣言している。 例では、<code class="docutils literal notranslate"><span class="pre">core</span></code>と<code class="docutils literal notranslate"><span class="pre">fmt</span></code>を利用している。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>Spring FrameworkのJSPタグライブラリを宣言している。 例では、<code class="docutils literal notranslate"><span class="pre">spring</span></code>と<code class="docutils literal notranslate"><span class="pre">form</span></code>と<code class="docutils literal notranslate"><span class="pre">sec</span></code>を利用している。</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p>共通ライブラリから提供しているJSPタグライブラリを宣言している。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><p>インクルード用のJSP(<code class="docutils literal notranslate"><span class="pre">/WEB-INF/views/common/include.jsp</span></code>)に指定した内容が、各JSP(<code class="docutils literal notranslate"><span class="pre">&lt;url-pattern&gt;</span></code>で指定されているファイル)の先頭にインクルードされる。</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ディレクティブの詳細は、<a class="reference external" href="https://jakarta.ee/specifications/pages/3.1/jakarta-server-pages-spec-3.1.html#directives">Jakarta Server Pages 3.1 Specification Document(1.10. Directives)</a>を参照されたい。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>&lt;jsp-property-group&gt;要素の詳細は、<a class="reference external" href="https://jakarta.ee/specifications/pages/3.1/jakarta-server-pages-spec-3.1.html#jsp-property-groups">Jakarta Server Pages 3.1 Specification Document(3.3. JSP Property Groups)</a>を参照されたい。</p>
</div>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-jsp-out-label">
<span id="id53"></span><h4><a class="toc-backref" href="#id157" role="doc-backlink"><span class="section-number">3.4.3.1.2. </span>モデルに格納されている値を表示する</a><a class="headerlink" href="#view-jsp-out-label" title="Permalink to this heading">¶</a></h4>
<p>モデル（フォームオブジェクトやドメインオブジェクトなど）に格納されている値をHTMLに表示する場合、EL式又はJSTLから提供されているJSPタグライブラリを使用する。</p>
<p>EL式を使用して表示する。</p>
<ul>
<li><p>SampleController.java</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">HelloBean</span><span class="p">(</span><span class="s">&quot;Bean Hello World!&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// returns view name</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>hello.jsp</p>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span>Message<span class="w"> </span>:<span class="w"> </span>${f:h(helloBean.message)}<span class="w"> </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">Model</span></code>オブジェクトに <code class="docutils literal notranslate"><span class="pre">HelloBean</span></code>オブジェクトを追加する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">View(JSP)側では、「${属性名.JavaBeanのプロパティ名}」と記述することで<code class="docutils literal notranslate"><span class="pre">Model</span></code>オブジェクトに追加したデータを取得することができる。</div>
<div class="line">例ではHTMLエスケープを行うEL式の関数を呼び出しているため、「${f:h(属性名.JavaBeanのプロパティ名)}」としている。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>共通部品よりEL式用のHTMLエスケープ関数(<code class="docutils literal notranslate"><span class="pre">f:h</span></code>)を提供しているので、EL式を使用してHTMLに値を出力する場合は、必ず使用すること。</p>
<p>HTMLエスケープを行うEL式の関数の詳細については、<a class="reference internal" href="../Security/XSS.html"><span class="doc">Cross Site Scripting</span></a>を参照されたい。</p>
</div>
</li>
</ul>
<p>JSTLのJSPタグライブラリから提供されている<code class="docutils literal notranslate"><span class="pre">&lt;c:out&gt;</span></code>タグを使用して表示する。</p>
<blockquote>
<div><div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span>Message<span class="w"> </span>:<span class="w"> </span><span class="nt">&lt;c:out</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${helloBean.message}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">EL式で取得した値を<code class="docutils literal notranslate"><span class="pre">&lt;c:out&gt;</span></code>タグのvalue属性に指定する。HTMLエスケープも行われる。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;c:out&gt;</span></code>の詳細は、<a class="reference external" href="https://jakarta.ee/specifications/tags/3.0/jakarta-tags-spec-3.0.html#general-purpose-actions-core-tag-library">Jakarta Standard Tag Library 3.0 Specification Document(4 General-Purpose Actions)</a>を参照されたい。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-jsp-outnumber-label">
<span id="id54"></span><h4><a class="toc-backref" href="#id158" role="doc-backlink"><span class="section-number">3.4.3.1.3. </span>モデルに格納されている数値を表示する</a><a class="headerlink" href="#view-jsp-outnumber-label" title="Permalink to this heading">¶</a></h4>
<p>数値型の値をフォーマットして出力する場合、JSTLから提供されているJSPタグライブラリを使用する。</p>
<div class="line-block">
<div class="line">JSTLのJSPタグライブラリから提供されている<code class="docutils literal notranslate"><span class="pre">&lt;fmt:formatNumber&gt;</span></code>タグを使用して表示する。</div>
</div>
<blockquote>
<div><div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span>Number<span class="w"> </span>Item<span class="w"> </span>:<span class="w"> </span><span class="nt">&lt;fmt:formatNumber</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${helloBean.numberItem}&quot;</span><span class="w"> </span><span class="na">pattern=</span><span class="s">&quot;0.00&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">EL式で取得した値を<code class="docutils literal notranslate"><span class="pre">&lt;fmt:formatNumber&gt;</span></code>タグのvalue属性に指定する。表示するフォーマットはpattern属性に指定する。例では、<code class="docutils literal notranslate"><span class="pre">0.00</span></code>を指定している。</div>
<div class="line">仮に<code class="docutils literal notranslate"><span class="pre">${helloBean.numberItem}</span></code>で取得した値が<code class="docutils literal notranslate"><span class="pre">1.2</span></code>の場合、画面には<code class="docutils literal notranslate"><span class="pre">1.20</span></code>が出力される。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;fmt:formatNumber&gt;</span></code>の詳細は、<a class="reference external" href="https://jakarta.ee/specifications/tags/3.0/jakarta-tags-spec-3.0.html#formatting-actions-i18n-capable-formatting-tag-library">Jakarta Standard Tag Library 3.0 Specification Document(9 Formatting Actions)</a>を参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-jsp-outdate-label">
<span id="id55"></span><h4><a class="toc-backref" href="#id159" role="doc-backlink"><span class="section-number">3.4.3.1.4. </span>モデルに格納されている日時を表示する</a><a class="headerlink" href="#view-jsp-outdate-label" title="Permalink to this heading">¶</a></h4>
<p>日時型の値をフォーマットして出力する場合、JSTLから提供されているJSPタグライブラリを使用する。</p>
<p>JSTLのJSPタグライブラリから提供されている<code class="docutils literal notranslate"><span class="pre">&lt;fmt:formatDate&gt;</span></code>タグを使用して表示する。</p>
<blockquote>
<div><div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span>Date<span class="w"> </span>Item<span class="w"> </span>:<span class="w"> </span><span class="nt">&lt;fmt:formatDate</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${helloBean.dateItem}&quot;</span><span class="w"> </span><span class="na">pattern=</span><span class="s">&quot;yyyy-MM-dd&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">EL式で取得した値を<code class="docutils literal notranslate"><span class="pre">&lt;fmt:formatDate&gt;</span></code>タグのvalue属性に指定する。表示するフォーマットはpattern属性に指定する。例では、<code class="docutils literal notranslate"><span class="pre">yyyy-MM-dd</span></code>を指定している。</div>
<div class="line">仮に<code class="docutils literal notranslate"><span class="pre">${helloBean.dateItem}</span></code>で取得した値が2013年3月2日の場合、画面には<code class="docutils literal notranslate"><span class="pre">2013-03-02</span></code>が出力される。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;fmt:formatNumber&gt;</span></code>の詳細は、<a class="reference external" href="https://jakarta.ee/specifications/tags/3.0/jakarta-tags-spec-3.0.html#formatting-actions-i18n-capable-formatting-tag-library">Jakarta Standard Tag Library 3.0 Specification Document(9 Formatting Actions)</a>を参照されたい。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>日時オブジェクトの型として、JSR-310 Date and Time APIから提供されている<code class="docutils literal notranslate"><span class="pre">java.time.LocalDateTime</span></code>などを利用する場合は、<a class="reference internal" href="../ArchitectureInDetail/GeneralFuncDetail/DateAndTime.html"><span class="doc">日付操作(JSR-310 Date and Time API)</span></a>を参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-jsp-requesturl-label">
<span id="id57"></span><h4><a class="toc-backref" href="#id160" role="doc-backlink"><span class="section-number">3.4.3.1.5. </span>リクエストURLを生成する</a><a class="headerlink" href="#view-jsp-requesturl-label" title="Permalink to this heading">¶</a></h4>
<p>HTMLの<code class="docutils literal notranslate"><span class="pre">&lt;form&gt;</span></code>要素(JSPタグライブラリの<code class="docutils literal notranslate"><span class="pre">&lt;form:form&gt;</span></code>要素)の<code class="docutils literal notranslate"><span class="pre">action</span></code>属性や<code class="docutils literal notranslate"><span class="pre">&lt;a&gt;</span></code>要素の<code class="docutils literal notranslate"><span class="pre">href</span></code>属性などに対してリクエストURL(Controllerのメソッドを呼び出すためのURL)を設定する場合は、
以下のいずれかの方法を使用してURLを生成する。</p>
<ul class="simple">
<li><p>文字列としてリクエストURLを組み立てる</p></li>
<li><p>Spring Framework 4.1から追加されたEL関数を使用してリクエストURLを組み立てる</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>どちらの方法を使用してもよいが、一つのアプリケーションの中で混在して使用することは、保守性を低下させる可能性があるので避けた方がよい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">以降の説明で使用するControllerのメソッドの実装サンプルを示す。</div>
<div class="line">以降の説明では、以下に示すメソッドを呼び出すためのリクエストURLを生成するための実装方法について説明する。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.app.hello</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>

<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="nd">@Controller</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">HelloController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="nd">@GetMapping</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;hello/home&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">このメソッドに割り当てられるリクエストURLは、<code class="docutils literal notranslate"><span class="pre">{コンテキストパス}/hello</span></code>となる。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>文字列としてリクエストURLを組み立てる</strong></p>
<p>まず、文字列としてリクエストURLを組み立てる方法について説明する。</p>
<blockquote>
<div><div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;form</span><span class="w"> </span><span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/hello&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">pageContext</span></code>(JSPの暗黙オブジェクト)からWebアプリケーションに割り振られているコンテキスパスを取得し(<code class="docutils literal notranslate"><span class="pre">${pageContext.request.contextPath}</span></code>)、コンテキストパスの後ろに呼び出すControllerのメソッドに割り振られているサーブレットパス(上記例では、<code class="docutils literal notranslate"><span class="pre">/hello</span></code>)を加える。</p></td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>URLを組み立てるJSPタグライブラリとして、</p>
<ul class="simple">
<li><p>JSTLから提供されている<code class="docutils literal notranslate"><span class="pre">&lt;c:url&gt;</span></code></p></li>
<li><p>Spring Frameworkから提供されている<code class="docutils literal notranslate"><span class="pre">&lt;spring:url&gt;</span></code></p></li>
</ul>
<p>が存在する。これらのJSPタグライブラリを使用して、リクエストURLを組み立ててもよい。</p>
<p>リクエストURLを動的に組み立てる必要がある場合は、これらのJSPタグライブラリを使用してURLを組み立てた方がよいケースがある。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Spring Framework 4.1から追加されたEL関数を使用してリクエストURLを組み立てる</strong></p>
<p>つぎに、Spring Framework 4.1から追加されたEL関数(<code class="docutils literal notranslate"><span class="pre">spring:mvcUrl</span></code>)を使用してリクエストURLを組み立てる方法について説明する。</p>
<p><code class="docutils literal notranslate"><span class="pre">spring:mvcUrl</span></code>関数を使用すると、Controllerのメソッドのメタ情報(メソッドシグネチャやアノテーションなど)と連携して、リクエストURLを組み立てる事ができる。</p>
<blockquote>
<div><div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;form</span><span class="w"> </span><span class="na">action=</span><span class="s">&quot;${spring:mvcUrl(&#39;HC#hello&#39;).build()}&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (3) --&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">spring:mvcUrl</span></code>関数の引数には、呼び出すControllerのメソッドに割り振られているリクエストマッピング名を指定する。</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">spring:mvcUrl</span></code>関数からは、リクエストURLを組み立てるクラス(<code class="docutils literal notranslate"><span class="pre">MvcUriComponentsBuilder.MethodArgumentBuilder</span></code>)のオブジェクトが返却される。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">MvcUriComponentsBuilder.MethodArgumentBuilder</span></code>クラスには、</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">arg</span></code>メソッド</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">build</span></code>メソッド</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buildAndExpand</span></code>メソッド</p></li>
</ul>
<p>が用意されており、それぞれ、以下の役割を持つ。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">arg</span></code>メソッドは、Controllerのメソッドの引数に渡す値を指定するためのメソッドである。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">build</span></code>メソッドは、リクエストURLを生成するためのメソッドである。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buildAndExpand</span></code>メソッドは、Controllerのメソッドの引数として宣言されていない動的な部分(パス変数など)に埋め込む値を指定した上で、リクエストURLを生成するためのメソッドである。</p></li>
</ul>
<div class="line-block">
<div class="line">上記例では、リクエストURLが静的なURLであるため、<code class="docutils literal notranslate"><span class="pre">build</span></code>メソッドのみを呼び出してリクエストURLを生成している。</div>
<div class="line">リクエストURLが動的なURL(パス変数やクエリ文字列が存在するURL)の場合は、<code class="docutils literal notranslate"><span class="pre">arg</span></code>メソッドや<code class="docutils literal notranslate"><span class="pre">buildAndExpand</span></code>メソッドを呼び出す必要がある。</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">arg</span></code>メソッドと<code class="docutils literal notranslate"><span class="pre">buildAndExpand</span></code>メソッドの具体的な使用例については、<a class="reference external" href="https://docs.spring.io/spring-framework/docs/6.1.3/reference/html/web.html#mvc-links-to-controllers-from-views">Spring Framework Documentation -Links in Views-</a>を参照されたい。</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>リクエストマッピング名について</strong></p>
<p>リクエストマッピング名は、デフォルト実装(<code class="docutils literal notranslate"><span class="pre">org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMethodMappingNamingStrategy</span></code>の実装)では、「クラス名の大文字部分(クラスの短縮名) + “<code class="docutils literal notranslate"><span class="pre">#</span></code>“ + メソッド名」となる。</p>
<p>リクエストマッピング名は重複しないようにする必要がある。名前が重複してしまった場合は、<code class="docutils literal notranslate"><span class="pre">&#64;RequestMapping</span></code>合成アノテーションの<code class="docutils literal notranslate"><span class="pre">name</span></code>属性に一意となる名前を指定する必要がある。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-jsp-form-label">
<span id="id58"></span><h4><a class="toc-backref" href="#id161" role="doc-backlink"><span class="section-number">3.4.3.1.6. </span>HTML formへフォームオブジェクトをバインドする</a><a class="headerlink" href="#view-jsp-form-label" title="Permalink to this heading">¶</a></h4>
<p>HTML formへフォームオブジェクトをバインドし、フォームオブジェクトで保持している値を表示する場合、Spring Frameworkから提供されているJSPタグライブラリを使用する。</p>
<p>Spring Frameworkから提供されている<code class="docutils literal notranslate"><span class="pre">&lt;form:form&gt;</span></code>タグを使用してバインドする。</p>
<blockquote>
<div><div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;form:form</span><span class="w"> </span><span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/sample/hello&quot;</span>
<span class="w">           </span><span class="na">modelAttribute=</span><span class="s">&quot;sampleForm&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
<span class="w">    </span>Id<span class="w"> </span>:<span class="w"> </span><span class="nt">&lt;form:input</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
<span class="nt">&lt;/form:form&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;form:form&gt;</span></code>タグのmodelAttribute属性に、<code class="docutils literal notranslate"><span class="pre">Model</span></code>に格納されているフォームオブジェクトの属性名を指定する。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;form:xxx&gt;</span></code>タグのpath属性に、バインドしたいプロパティのプロパティ名を指定する。<code class="docutils literal notranslate"><span class="pre">xxx</span></code>の部分は、入力項目のタイプによってかわる。</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;form:form&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;form:xxx&gt;</span></code>タグの詳細は、<a class="reference external" href="https://docs.spring.io/spring-framework/docs/6.1.3/reference/html/web.html#mvc-view-jsp-formtaglib">Spring Framework Documentation -Spring’s form tag library-</a>を参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-jsp-errors-label">
<span id="id60"></span><h4><a class="toc-backref" href="#id162" role="doc-backlink"><span class="section-number">3.4.3.1.7. </span>入力チェックエラーを表示する</a><a class="headerlink" href="#view-jsp-errors-label" title="Permalink to this heading">¶</a></h4>
<p>入力チェックエラーの内容を表示する場合、Spring Frameworkから提供されているJSPタグライブラリを使用する。</p>
<div class="line-block">
<div class="line">Spring Frameworkから提供されている<code class="docutils literal notranslate"><span class="pre">&lt;form:errors&gt;</span></code>タグを使用して表示する。</div>
<div class="line">詳細は、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Validation.html"><span class="doc">入力チェック</span></a>を参照されたい。</div>
</div>
<blockquote>
<div><div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;form:form</span><span class="w"> </span><span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/sample/hello&quot;</span>
<span class="w">           </span><span class="na">modelAttribute=</span><span class="s">&quot;sampleForm&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>Id<span class="w"> </span>:<span class="w"> </span><span class="nt">&lt;form:input</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="nt">/&gt;&lt;form:errors</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
<span class="nt">&lt;/form:form&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;form:errors&gt;</span></code>タグのpath属性に、エラー表示したいプロパティのプロパティ名を指定する。</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-jsp-resultmessages-label">
<span id="id61"></span><h4><a class="toc-backref" href="#id163" role="doc-backlink"><span class="section-number">3.4.3.1.8. </span>処理結果のメッセージを表示する</a><a class="headerlink" href="#view-jsp-resultmessages-label" title="Permalink to this heading">¶</a></h4>
<p>処理結果を通知するメッセージを表示する場合、共通部品から提供しているJSPタグライブラリを使用する。</p>
<div class="line-block">
<div class="line">共通部品から提供している<code class="docutils literal notranslate"><span class="pre">&lt;t:messagesPanel&gt;</span></code>タグを使用する。</div>
<div class="line">詳細は、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/MessageManagement.html"><span class="doc">メッセージ管理</span></a>を参照されたい。</div>
</div>
<blockquote>
<div><div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;messages&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;h2&gt;</span>Message<span class="w"> </span>pattern<span class="nt">&lt;/h2&gt;</span>
<span class="w">    </span><span class="nt">&lt;t:messagesPanel</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">resultMessages</span></code>という属性名で格納されているメッセージを出力する。</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-jsp-codelist-label">
<span id="id62"></span><h4><a class="toc-backref" href="#id164" role="doc-backlink"><span class="section-number">3.4.3.1.9. </span>コードリストを表示する</a><a class="headerlink" href="#view-jsp-codelist-label" title="Permalink to this heading">¶</a></h4>
<p>共通部品から提供されているコードリストを表示する場合は、Spring Frameworkから提供されているJSPタグライブラリを使用する。</p>
<div class="line-block">
<div class="line">JSPからコードリストを参照する場合は、<code class="docutils literal notranslate"><span class="pre">java.util.Map</span></code>インタフェースと同じ方法で参照することができる。</div>
<div class="line">詳細は、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Codelist.html"><span class="doc">コードリスト</span></a>を参照されたい。</div>
</div>
<p>コードリストをセレクトボックスに表示する。</p>
<blockquote>
<div><div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;form:select</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;orderStatus&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;form:option</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="na">label=</span><span class="s">&quot;--Select--&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;form:options</span><span class="w"> </span><span class="na">items=</span><span class="s">&quot;${CL_ORDERSTATUS}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
<span class="nt">&lt;/form:select&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">コードリスト名(<code class="docutils literal notranslate"><span class="pre">CL_ORDERSTATUS</span></code>) を属性名として、コードリスト(<code class="docutils literal notranslate"><span class="pre">java.util.Map</span></code>インタフェース)が格納されている。</div>
<div class="line">そのためJSPでは、EL式を使ってコードリスト(<code class="docutils literal notranslate"><span class="pre">java.util.Map</span></code>インタフェース)にアクセスすることができる。</div>
<div class="line">取得した<code class="docutils literal notranslate"><span class="pre">Map</span></code>インタフェースを<code class="docutils literal notranslate"><span class="pre">&lt;form:options&gt;</span></code>のitems属性に渡すことで、コードリストをセレクトボックスに表示することができる。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>セレクトボックスで選択した値のコード名を表示する。</p>
<blockquote>
<div><div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span>Order<span class="w"> </span>Status<span class="w"> </span>:<span class="w"> </span>${f:h(CL_ORDERSTATUS[orderForm.orderStatus])}
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">セレクトボックス作成時と同様に、コードリスト名(<code class="docutils literal notranslate"><span class="pre">CL_ORDERSTATUS</span></code>) を属性名として、コードリスト(<code class="docutils literal notranslate"><span class="pre">java.util.Map</span></code>インタフェース)を取得する。</div>
<div class="line">取得した<code class="docutils literal notranslate"><span class="pre">Map</span></code>インタフェースのキー値として、セレクトボックスで選択した値を指定することで、コード名を表示することができる。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-jsp-message-label">
<span id="id63"></span><h4><a class="toc-backref" href="#id165" role="doc-backlink"><span class="section-number">3.4.3.1.10. </span>固定文言を表示する</a><a class="headerlink" href="#view-jsp-message-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">画面名、項目名、ガイダンス用のメッセージなどについては、国際化の必要がない場合はJSPに直接記載してもよい。</div>
<div class="line">ただし、国際化の必要がある場合はSpring Frameworkから提供されているJSPタグライブラリを使用して、プロパティファイルから取得した値を表示する。</div>
</div>
<div class="line-block">
<div class="line">Spring Frameworkから提供されている<code class="docutils literal notranslate"><span class="pre">&lt;spring:message&gt;</span></code>タグを使用して表示する。</div>
<div class="line">詳細は、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Internationalization.html"><span class="doc">国際化</span></a>を参照されたい。</div>
</div>
<ul>
<li><p>properties</p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="c1"># (1)</span>
<span class="na">label.orderStatus</span><span class="o">=</span><span class="s">注文ステータス</span>
</pre></div>
</div>
</li>
<li><p>jsp</p>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;spring:message</span><span class="w"> </span><span class="na">code=</span><span class="s">&quot;label.orderStatus&quot;</span><span class="w"> </span><span class="na">text=</span><span class="s">&quot;Order Status&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span>:<span class="w"> </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
<span class="w">    </span>${f:h(CL_ORDERSTATUS[orderForm.orderStatus])}
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>プロパティファイルにラベルの値を定義する。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;spring:message&gt;</span></code>のcode属性にプロパティファイルのキー名を指定するとキー名に一致するプロパティ値が表示される。</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>text属性に指定した値は、プロパティ値が取得できなかった場合に表示される。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-jsp-if-label">
<span id="id64"></span><h4><a class="toc-backref" href="#id166" role="doc-backlink"><span class="section-number">3.4.3.1.11. </span>条件によって表示を切り替える</a><a class="headerlink" href="#view-jsp-if-label" title="Permalink to this heading">¶</a></h4>
<p>モデルが保持する値によって表示を切り替えたい場合は、JSTLから提供されているJSPタグライブラリを使用する。</p>
<p>JSTLのJSPタグライブラリから提供されている<code class="docutils literal notranslate"><span class="pre">&lt;c:if&gt;</span></code>タグ又は<code class="docutils literal notranslate"><span class="pre">&lt;c:choose&gt;</span></code>を使用して、表示の切り替えを行う。</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;c:if&gt;</span></code>を使用して表示を切り替える。</p>
<blockquote>
<div><div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;c:if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;${orderForm.orderStatus != &#39;complete&#39;}&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
<span class="w">    </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="n">omitted</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
<span class="nt">&lt;/c:if&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;c:if&gt;</span></code>のtest属性に分岐に入る条件を実装する。例では注文ステータスが<code class="docutils literal notranslate"><span class="pre">'complete'</span></code>ではない場合に分岐内の表示処理が実行される。</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">&lt;c:choose&gt;</span></code>を使用して表示を切り替える。</p>
<blockquote>
<div><div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;c:choose&gt;</span>
<span class="w">    </span><span class="nt">&lt;c:when</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;${customer.type == &#39;premium&#39;}&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
<span class="w">        </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="n">omitted</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
<span class="w">    </span><span class="nt">&lt;/c:when&gt;</span>
<span class="w">    </span><span class="nt">&lt;c:when</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;${customer.type == &#39;general&#39;}&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="n">omitted</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
<span class="w">    </span><span class="nt">&lt;/c:when&gt;</span>
<span class="w">    </span><span class="nt">&lt;c:otherwise&gt;</span><span class="w"> </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
<span class="w">        </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="n">omitted</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
<span class="w">    </span><span class="nt">&lt;/c:otherwise&gt;</span>
<span class="nt">&lt;/c:choose&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;c:when&gt;</span></code>タグのtest属性に分岐に入る条件を実装する。例では顧客の種別が<code class="docutils literal notranslate"><span class="pre">'premium'</span></code>の場合に分岐内の表示処理が実行される。</div>
<div class="line">test属性で指定した条件が<code class="docutils literal notranslate"><span class="pre">false</span></code>の場合は、次の<code class="docutils literal notranslate"><span class="pre">&lt;c:when&gt;</span></code>タグの処理が実行される。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">全ての<code class="docutils literal notranslate"><span class="pre">&lt;c:when&gt;</span></code>タグのtest属性の結果が<code class="docutils literal notranslate"><span class="pre">false</span></code>の場合、<code class="docutils literal notranslate"><span class="pre">&lt;c:otherwise&gt;</span></code>タグ内の表示処理が実行される。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>詳細は、<a class="reference external" href="https://jakarta.ee/specifications/tags/3.0/jakarta-tags-spec-3.0.html#conditional-actions-core-tag-library">Jakarta Standard Tag Library 3.0 Specification Document(5. Conditional Actions)</a>を参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-jsp-foreach-label">
<span id="id65"></span><h4><a class="toc-backref" href="#id167" role="doc-backlink"><span class="section-number">3.4.3.1.12. </span>コレクションの要素に対して表示処理を繰り返す</a><a class="headerlink" href="#view-jsp-foreach-label" title="Permalink to this heading">¶</a></h4>
<p>モデルが保持するコレクションに対して表示処理を繰り返したい場合は、JSTLから提供されているJSPタグライブラリを使用する。</p>
<p>JSTLのJSPタグライブラリから提供されている<code class="docutils literal notranslate"><span class="pre">&lt;c:forEach&gt;</span></code>を使用して表示処理を繰り返す。</p>
<blockquote>
<div><div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;table&gt;</span>
<span class="w">    </span><span class="nt">&lt;tr&gt;</span>
<span class="w">        </span><span class="nt">&lt;th&gt;</span>No<span class="nt">&lt;/th&gt;</span>
<span class="w">        </span><span class="nt">&lt;th&gt;</span>Name<span class="nt">&lt;/th&gt;</span>
<span class="w">    </span><span class="nt">&lt;/tr&gt;</span>
<span class="w">    </span><span class="nt">&lt;c:forEach</span><span class="w"> </span><span class="na">var=</span><span class="s">&quot;customer&quot;</span><span class="w"> </span><span class="na">items=</span><span class="s">&quot;${customers}&quot;</span><span class="w"> </span><span class="na">varStatus=</span><span class="s">&quot;status&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
<span class="w">        </span><span class="nt">&lt;tr&gt;</span>
<span class="w">            </span><span class="nt">&lt;td&gt;</span>${status.count}<span class="nt">&lt;/td&gt;</span><span class="w"> </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
<span class="w">            </span><span class="nt">&lt;td&gt;</span>${f:h(customer.name)}<span class="nt">&lt;/td&gt;</span><span class="w"> </span><span class="k">&lt;%-</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="k">%&gt;</span>
<span class="w">        </span><span class="nt">&lt;/tr&gt;</span>
<span class="w">    </span><span class="nt">&lt;/c:forEach&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;c:forEach&gt;</span></code>タグのitems属性にコレクションを指定する事で、<code class="docutils literal notranslate"><span class="pre">&lt;c:forEach&gt;</span></code>タグ内の表示処理が繰り返し実行される。</div>
<div class="line">処理対象となっている要素のオブジェクトを参照する場合は、var属性にオブジェクトを格納するための変数名を指定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;c:forEach&gt;</span></code>タグのvarStatus属性で指定した変数から現在処理を行っている要素位置(count)を取得している。</div>
<div class="line">count以外の属性については、<a class="reference external" href="https://tomee.apache.org/jakartaee-10.0/javadoc/jakarta/servlet/jsp/jstl/core/LoopTagStatus.html">jakarta.servlet.jsp.jstl.core.LoopTagStatusのJavaDoc</a>を参照されたい。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;c:forEach&gt;</span></code>タグのvar属性で指定した変数に格納されているオブジェクトから値を取得している。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>詳細は、<a class="reference external" href="https://jakarta.ee/specifications/pages/3.1/jakarta-server-pages-spec-3.1.html#JSP_Documents">Jakarta Standard Tag Library 3.0 Specification Document(6. JSP Documents)</a>を参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-jsp-pagination-label">
<span id="id66"></span><h4><a class="toc-backref" href="#id168" role="doc-backlink"><span class="section-number">3.4.3.1.13. </span>ページネーション用のリンクを表示する</a><a class="headerlink" href="#view-jsp-pagination-label" title="Permalink to this heading">¶</a></h4>
<p>一覧表示を行う画面にてページネーション用のリンクを表示する場合は、共通部品から提供しているJSPタグライブラリを使用する。</p>
<div class="line-block">
<div class="line">共通部品から提供している<code class="docutils literal notranslate"><span class="pre">&lt;t:pagination&gt;</span></code>を使用してページネーション用のリンクを表示する。</div>
<div class="line">詳細は、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Pagination.html"><span class="doc">ページネーション</span></a>を参照されたい。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-jsp-authorization-label">
<span id="id67"></span><h4><a class="toc-backref" href="#id169" role="doc-backlink"><span class="section-number">3.4.3.1.14. </span>権限によって表示を切り替える</a><a class="headerlink" href="#view-jsp-authorization-label" title="Permalink to this heading">¶</a></h4>
<p>ログインしているユーザの権限によって表示を切り替える場合は、Spring Securityから提供されているJSPタグライブラリを使用する。</p>
<div class="line-block">
<div class="line">Spring Securityから提供されている<code class="docutils literal notranslate"><span class="pre">&lt;sec:authorize&gt;</span></code>を使用して表示の切り替えを行う。</div>
<div class="line">詳細は、<a class="reference internal" href="../Security/Authorization.html"><span class="doc">認可</span></a>を参照されたい。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="thymeleafhtml">
<span id="applicationlayerimplementofthymeleaf"></span><h3><a class="toc-backref" href="#id170" role="doc-backlink"><span class="section-number">3.4.3.2. </span>ThymeleafのテンプレートHTMLの実装</a><a class="headerlink" href="#thymeleafhtml" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line">クライアントにHTMLを応答する場合はThymeleafを使用する。そのために、ViewはHTML形式で実装する。</div>
<div class="line">Thymeleafによって生成されたHTMLを呼び出すための<code class="docutils literal notranslate"><span class="pre">ViewResolver</span></code>は、Thymeleaf + Springより提供されている<code class="docutils literal notranslate"><span class="pre">ThymeleafViewResolver</span></code>を使用する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ViewResolver</span></code>の設定方法については、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Thymeleaf.html#configuration-of-blank-project-label"><span class="std std-ref">ブランクプロジェクトの設定</span></a>を参照されたい。</div>
</div>
<p>以下に、基本的なテンプレートHTMLの実装方法について説明する。</p>
<ul class="simple">
<li><p><a class="reference internal" href="#view-thymeleaf-namespace-label"><span class="std std-ref">Thymeleafのネームスペースを設定する</span></a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-text-label"><span class="std std-ref">モデルに格納されている値を表示する</span></a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-numbers-label"><span class="std std-ref">モデルに格納されている数値を表示する</span></a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-dates-label"><span class="std std-ref">モデルに格納されている日時を表示する</span></a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-requesturl-label"><span class="std std-ref">リクエストURLを生成する</span></a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-message-label"><span class="std std-ref">メッセージを表示する</span></a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-textcombine-label"><span class="std std-ref">文字列を組み立てる</span></a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-conditional-label"><span class="std std-ref">条件を判定する</span></a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-if-label"><span class="std std-ref">条件によって表示を切り替える</span></a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-each-label"><span class="std std-ref">コレクションの要素に対して表示処理を繰り返す</span></a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-object-label"><span class="std std-ref">オブジェクトのプロパティを省略して指定する</span></a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-with-label"><span class="std std-ref">ローカル変数を定義する</span></a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-preprocessing-label"><span class="std std-ref">プリプロセッシング</span></a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-form-label"><span class="std std-ref">フォームオブジェクトのプロパティをバインドする</span></a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-errors-label"><span class="std std-ref">入力チェックエラーを表示する</span></a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-resultmessages-label"><span class="std std-ref">処理結果のメッセージを表示する</span></a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-codelist-label"><span class="std std-ref">コードリストを表示する</span></a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-pagination-label"><span class="std std-ref">ページネーション用のリンクを表示する</span></a></p></li>
<li><p><a class="reference internal" href="#view-thymeleaf-authorization-label"><span class="std std-ref">権限によって表示を切り替える</span></a></p></li>
</ul>
<p>本章では、ThymeleafおよびThymeleaf + Springのダイアレクト、ならびにThymeleafのSpring Security連携用ダイアレクトで提供されている代表的な属性やオブジェクトの使い方を説明しているが、全てについて説明はしていないので、詳細な使い方については、それぞれのドキュメントを参照すること。</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 30.0%" />
<col style="width: 60.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>ドキュメント</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ol class="arabic simple">
<li></li>
</ol>
</td>
<td><p>Thymeleafのダイアレクト</p></td>
<td><ul class="simple">
<li><p><a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.1/usingthymeleaf.html">https://www.thymeleaf.org/doc/tutorials/3.1/usingthymeleaf.html</a></p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p>Thymeleaf + Springのダイアレクト</p></td>
<td><ul class="simple">
<li><p><a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.1/thymeleafspring.html#the-springstandard-dialect">https://www.thymeleaf.org/doc/tutorials/3.1/thymeleafspring.html#the-springstandard-dialect</a></p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p>ThymeleafのSpring Security連携用ダイアレクト</p></td>
<td><ul class="simple">
<li><p><a class="reference external" href="https://github.com/thymeleaf/thymeleaf-extras-springsecurity">https://github.com/thymeleaf/thymeleaf-extras-springsecurity</a></p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="thymeleaf">
<span id="view-thymeleaf-namespace-label"></span><h4><a class="toc-backref" href="#id171" role="doc-backlink"><span class="section-number">3.4.3.2.1. </span>Thymeleafのネームスペースを設定する</a><a class="headerlink" href="#thymeleaf" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">Thymeleafを使用してテンプレートHTMLを作成する場合は、<code class="docutils literal notranslate"><span class="pre">th:text</span></code>のようなThymeleaf独自の属性を使用する必要があるため、Thymeleafのネームスペースを付与する。</div>
<div class="line">通常は、テンプレートHTMLのどこでもThymeleaf独自の属性を使用できるように、<code class="docutils literal notranslate"><span class="pre">&lt;html&gt;</span></code>要素にネームスペースを付与することを推奨する。</div>
</div>
<blockquote>
<div><div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ネームスペースはXHTMLの標準で定義された以外の要素・属性を使用する場合に付与するものであり、HTML5では本来不要なものである。（事実、ネームスペースを付与しなくとも、テンプレートの解釈に問題は生じない。）</p>
<p>ただし、HTML5であっても標準で定義された以外の要素・属性を使用すると、EclipseなどのIDEで警告が出力されるため、これを抑止するためにネームスペースを付与すべきである。</p>
<p>なお、テンプレートを解釈して出力されるHTMLからは、ネームスペース（<code class="docutils literal notranslate"><span class="pre">xmlns:th</span></code>）は削除される。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>本ガイドラインでは解説しないが、HTML5に準拠する形でThymeleafを使用することも可能である。</p>
<p>具体的には、HTML5で独自の属性を使用する場合は属性名に<code class="docutils literal notranslate"><span class="pre">data-</span></code>をつけるが、Thymeleafでもこれを使用して<code class="docutils literal notranslate"><span class="pre">data-th-text</span></code>のように属性を記述することができる。</p>
<p>詳細については、<a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.1/usingthymeleaf.html#a-multi-language-welcome">Tutorial: Using Thymeleaf -A multi-language welcome-</a>を参照されたい。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-thymeleaf-text-label">
<span id="id68"></span><h4><a class="toc-backref" href="#id172" role="doc-backlink"><span class="section-number">3.4.3.2.2. </span>モデルに格納されている値を表示する</a><a class="headerlink" href="#view-thymeleaf-text-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">Thymeleafで動的な値をHTMLに表示するには、<code class="docutils literal notranslate"><span class="pre">th:text</span></code>属性を使用する。</div>
<div class="line">モデル（フォームオブジェクトやドメインオブジェクトなど）に格納されている値をHTMLに表示する場合、<code class="docutils literal notranslate"><span class="pre">th:text</span></code>属性に変数式<code class="docutils literal notranslate"><span class="pre">${}</span></code>を使用すれば良い。</div>
<div class="line">なお、式にはThymeleaf Standard Expressionと呼ばれるEL式を利用して、オブジェクトやプロパティを指定することができる。</div>
</div>
<ul>
<li><p>SampleController.java</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">HelloBean</span><span class="p">(</span><span class="s">&quot;Bean Hello World!&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// returns view name</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>hello.html</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${helloBean.message}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (2) */--&gt;</span>
</pre></div>
</div>
</li>
<li><p>HTML created by View(hello.html)</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>Bean Hello World!<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">Model</span></code>オブジェクトに<code class="docutils literal notranslate"><span class="pre">HelloBean</span></code>オブジェクトを追加する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">View(テンプレートHTML)側では、<code class="docutils literal notranslate"><span class="pre">th:text</span></code>などの属性において${属性名}のような式を記述することできる。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">${}</span></code>は変数式で、<code class="docutils literal notranslate"><span class="pre">Model</span></code>オブジェクトに追加したデータを取得することができる。</div>
<div class="line">例では、取得したデータをHTMLエスケープして出力するために<code class="docutils literal notranslate"><span class="pre">th:text</span></code>属性を利用し、「<code class="docutils literal notranslate"><span class="pre">th:text=&quot;${helloBean.message}&quot;</span></code>」としている。</div>
<div class="line">XSS対策のため必ずHTMLエスケープを行うことを推奨する。詳細については、<a class="reference internal" href="../Security/XSS.html#xss-how-to-use-ouput-escaping"><span class="std std-ref">Output Escaping</span></a>を参照されたい。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-thymeleaf-numbers-label">
<span id="id69"></span><h4><a class="toc-backref" href="#id173" role="doc-backlink"><span class="section-number">3.4.3.2.3. </span>モデルに格納されている数値を表示する</a><a class="headerlink" href="#view-thymeleaf-numbers-label" title="Permalink to this heading">¶</a></h4>
<p>数値型の値をフォーマットして出力する場合、Thymeleafの<code class="docutils literal notranslate"><span class="pre">#numbers</span></code>を使用する。</p>
<p><code class="docutils literal notranslate"><span class="pre">#numbers</span></code>は、数値のフォーマットを行う以下のようなメソッドをもつ。</p>
<blockquote>
<div><table class="longtable docutils align-default">
<colgroup>
<col style="width: 5.0%" />
<col style="width: 15.0%" />
<col style="width: 40.0%" />
<col style="width: 40.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>メソッド名</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>使用例</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ol class="arabic simple">
<li></li>
</ol>
</td>
<td><p>formatInteger</p></td>
<td><p>整数値にフォーマットする。</p>
<p>引数として、以下のパターンをとる。</p>
<ul class="simple">
<li><p>整数型、最小桁数</p></li>
<li><p>整数型、最小桁数、千の位の区切り文字</p></li>
</ul>
</td>
<td><div class="highlight-text notranslate"><div class="highlight"><pre><span></span>${#numbers.formatInteger(num, 1, &#39;COMMA&#39;)}
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p>formatDecimal</p></td>
<td><p>小数値にフォーマットする。</p>
<p>引数として、以下のパターンをとる。</p>
<ul class="simple">
<li><p>浮動小数点型、最小桁数、小数桁数</p></li>
<li><p>浮動小数点型、最小桁数、小数桁数、小数点の文字</p></li>
<li><p>浮動小数点型、最小桁数、千の位の区切り文字、小数桁数、小数点の文字</p></li>
</ul>
</td>
<td><div class="highlight-text notranslate"><div class="highlight"><pre><span></span>${#numbers.formatDecimal(num, 1, &#39;COMMA&#39;, 2, &#39;POINT&#39;)}
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p>formatPercent</p></td>
<td><p>パーセント表示にフォーマットする。</p>
<p>引数として、以下のパターンをとる。</p>
<ul class="simple">
<li><p>浮動小数点型</p></li>
<li><p>浮動小数点型、最小桁数、小数桁数</p></li>
</ul>
</td>
<td><div class="highlight-text notranslate"><div class="highlight"><pre><span></span>${#numbers.formatPercent(num, 1, 2)}
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>千の位の区切り文字、小数点の文字としては、以下のものが指定できる。</p>
<ul class="simple">
<li><p>‘POINT’ - ピリオド “<code class="docutils literal notranslate"><span class="pre">.</span></code>“</p></li>
<li><p>‘COMMA’ - カンマ “<code class="docutils literal notranslate"><span class="pre">,</span></code>“</p></li>
<li><p>‘WHITESPACE’ - 半角スペース</p></li>
<li><p>‘NONE’ - 区切り文字なし</p></li>
<li><p>‘DEFAULT’ - ロケールに依存</p></li>
</ul>
<p>指定しなかった場合、千の位の区切り文字には’NONE’が、小数点には’POINT’が設定される。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><p>例えば小数を表示する際には、<code class="docutils literal notranslate"><span class="pre">#numbers.formatDecimal</span></code>メソッドを使用してフォーマットする。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${#numbers.formatDecimal(helloBean.numberItem,1,2,&#39;POINT&#39;)}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (1) */--&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">取得した値を<code class="docutils literal notranslate"><span class="pre">#numbers.formatDecimal</span></code>メソッドでフォーマットし、変数式<code class="docutils literal notranslate"><span class="pre">${}</span></code>に指定する。</div>
<div class="line">例では、最小桁数に1を、小数桁数に2を、小数点に<code class="docutils literal notranslate"><span class="pre">POINT</span></code>(ピリオド)を、表示するフォーマットに設定している。</div>
<div class="line">仮に<code class="docutils literal notranslate"><span class="pre">helloBean.numberItem</span></code>の値が<code class="docutils literal notranslate"><span class="pre">1.2</span></code>の場合、画面には<code class="docutils literal notranslate"><span class="pre">1.20</span></code>が出力される。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">#numbers</span></code>は、配列やリストなどを対象にフォーマットを行うことも可能である。</p>
<p>詳細については、<a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.1/usingthymeleaf.html#numbers">Tutorial: Using Thymeleaf -Numbers-</a>を参照されたい。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-thymeleaf-dates-label">
<span id="id70"></span><h4><a class="toc-backref" href="#id174" role="doc-backlink"><span class="section-number">3.4.3.2.4. </span>モデルに格納されている日時を表示する</a><a class="headerlink" href="#view-thymeleaf-dates-label" title="Permalink to this heading">¶</a></h4>
<p>日時型の値をフォーマットして出力する場合、Thymeleafの<code class="docutils literal notranslate"><span class="pre">#dates</span></code>、あるいは<code class="docutils literal notranslate"><span class="pre">#calendars</span></code>を使用する。</p>
<p><code class="docutils literal notranslate"><span class="pre">java.util.Date</span></code>オブジェクトのフォーマットを行う場合は、<code class="docutils literal notranslate"><span class="pre">#dates.format</span></code>メソッドを利用する。</p>
<blockquote>
<div><div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${#dates.format(helloBean.dateItem,&#39;yyyy-MM-dd&#39;)}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (1) */--&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">取得した値を<code class="docutils literal notranslate"><span class="pre">#dates.format</span></code>メソッドでフォーマットし、変数式<code class="docutils literal notranslate"><span class="pre">${}</span></code>に指定する。</div>
<div class="line">例では、日付を<code class="docutils literal notranslate"><span class="pre">yyyy-MM-dd</span></code>形式でフォーマットしている。</div>
<div class="line">仮に<code class="docutils literal notranslate"><span class="pre">helloBean.dateItem</span></code>の値が2013年3月2日の場合、画面には<code class="docutils literal notranslate"><span class="pre">2013-03-02</span></code>が出力される。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">#dates</span></code>は、配列やリストを対象にフォーマットを行うことも可能である。</p>
<p>詳細については、<a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.1/usingthymeleaf.html#dates">Tutorial: Using Thymeleaf -Dates-</a>を参照されたい。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">java.util.Calendar</span></code>オブジェクトのフォーマットを行う場合は、<code class="docutils literal notranslate"><span class="pre">#calendars.format</span></code>メソッドを利用する。</p>
<blockquote>
<div><div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${#calendars.format(helloBean.calendarItem,&#39;yyyy-MM-dd&#39;)}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (1) */--&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">取得した値を<code class="docutils literal notranslate"><span class="pre">#calendars.format</span></code>メソッドでフォーマットし、変数式<code class="docutils literal notranslate"><span class="pre">${}</span></code>に指定する。</div>
<div class="line">例では、日付を<code class="docutils literal notranslate"><span class="pre">yyyy-MM-dd</span></code>形式でフォーマットしている。</div>
<div class="line">仮に<code class="docutils literal notranslate"><span class="pre">helloBean.calendarItem</span></code>の値が2013年3月2日の場合、画面には<code class="docutils literal notranslate"><span class="pre">2013-03-02</span></code>が出力される。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">#calendars</span></code>は、配列やリストを対象にフォーマットを行うことも可能である。</p>
<p>詳細については、<a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.1/usingthymeleaf.html#calendars">Tutorial: Using Thymeleaf -Calendars-</a>を参照されたい。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-thymeleaf-requesturl-label">
<span id="id71"></span><h4><a class="toc-backref" href="#id175" role="doc-backlink"><span class="section-number">3.4.3.2.5. </span>リクエストURLを生成する</a><a class="headerlink" href="#view-thymeleaf-requesturl-label" title="Permalink to this heading">¶</a></h4>
<p>HTMLの<code class="docutils literal notranslate"><span class="pre">&lt;form&gt;</span></code>要素の<code class="docutils literal notranslate"><span class="pre">action</span></code>属性や<code class="docutils literal notranslate"><span class="pre">&lt;a&gt;</span></code>要素の<code class="docutils literal notranslate"><span class="pre">href</span></code>属性、<code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code>要素の<code class="docutils literal notranslate"><span class="pre">src</span></code>属性などに対してURLを出力する場合は、Thymeleafの<code class="docutils literal notranslate"><span class="pre">th:action</span></code>属性、<code class="docutils literal notranslate"><span class="pre">th:href</span></code>属性、<code class="docutils literal notranslate"><span class="pre">th:src</span></code>属性を使用する。</p>
<p>これらの属性では、以下のいずれかの方法によって生成されたリクエストURL(Controllerのメソッドを呼び出すためのURL)を設定する。</p>
<ul>
<li><p>ThymeleafのリンクURL式<code class="docutils literal notranslate"><span class="pre">&#64;{}</span></code>を使用してリクエストURLを組み立てる</p></li>
<li><p>Thymeleaf + Springの<code class="docutils literal notranslate"><span class="pre">#mvc.url</span></code>メソッドを使用してリクエストURLを組み立てる</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>どちらの方法を使用してもよいが、一つのアプリケーションの中で混在して使用することは、保守性を低下させる可能性があるので避けた方がよい。</p>
</div>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">以降の説明で使用するControllerのメソッドの実装サンプルを示す。</div>
<div class="line">以降の説明では、以下に示すメソッドを呼び出すためのリクエストURLを生成するための実装方法について説明する。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.app.hello</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>

<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="nd">@Controller</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">HelloController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="nd">@GetMapping</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;hello/home&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">このメソッドに割り当てられるリクエストURLは、<code class="docutils literal notranslate"><span class="pre">{コンテキストパス}/hello</span></code>となる。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>ThymeleafのリンクURL式を使用してリクエストURLを組み立てる</strong></p>
<p>まず、ThymeleafのリンクURL式<code class="docutils literal notranslate"><span class="pre">&#64;{}</span></code>を使用してリクエストURLを組み立てる方法について説明する。</p>
<ul>
<li><p>コンテキストルートからの相対パスを指定する</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&quot;@{/hello}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (2) --&gt;</span>
    <span class="cm">&lt;!-- omitted --&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">リンクURL式<code class="docutils literal notranslate"><span class="pre">&#64;{}</span></code>に”<code class="docutils literal notranslate"><span class="pre">/</span></code>“から始まるパスを記述すると、記述したパスをコンテキストルートに付与したURLが生成される。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
<li><p>現在のパスからの相対パスを指定する</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{user/top}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (3) --&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">リンクURL式<code class="docutils literal notranslate"><span class="pre">&#64;{}</span></code>にパスを記述すると、現在のパスから見た相対的なURLが生成される。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>リンクURL式<code class="docutils literal notranslate"><span class="pre">&#64;{}</span></code>は、コンテキストルートからの相対パスやページ現在のパスからの相対パスを生成するほか、サーバールートからの相対パス、プロトコルからの相対パスも生成できる。</p>
<p>詳細については、<a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.1/usingthymeleaf.html#link-urls">Tutorial: Using Thymeleaf -Link URLs-</a>を参照されたい。</p>
</div>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>リンクURL式には、パスの一部またはパラメータとして変数を埋め込むことが可能である。</p>
<ul>
<li><p>パスの一部に変数を埋め込む</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&quot;@{/user/{userId}/details(userId=${user.id})}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (4) --&gt;</span>
    <span class="cm">&lt;!-- omitted --&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">リンクURL式<code class="docutils literal notranslate"><span class="pre">&#64;{}</span></code>のパス内で変数式を使うこともできる。</div>
<div class="line">例では、パスの<code class="docutils literal notranslate"><span class="pre">{userId}</span></code>の部分に変数<code class="docutils literal notranslate"><span class="pre">${user.id}</span></code>の値が代入され、<code class="docutils literal notranslate"><span class="pre">/user/3/details</span></code>といったパスが生成される。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>パスの一部に変数を埋め込む際の注意点について</strong></p>
<p>上記コード例のようにパスの一部に変数を埋め込む場合、変数<code class="docutils literal notranslate"><span class="pre">${user.id}</span></code>の値が<code class="docutils literal notranslate"><span class="pre">null</span></code>の場合は、URLが<code class="docutils literal notranslate"><span class="pre">/コンテキストルート/user//details</span></code>のようにスラッシュが重複した状態で生成される。</p>
<p>スラッシュの重複を無視された場合には、予期せぬコンテンツにアクセスされる恐れがある為、パスの一部に埋め込む変数は<code class="docutils literal notranslate"><span class="pre">null</span></code>とならない事が保証された値を用いるか、後述するデフォルト式<code class="docutils literal notranslate"><span class="pre">?:</span></code>を使用して、テンプレートHTML側で<code class="docutils literal notranslate"><span class="pre">null</span></code>の代替文字列を指定することで回避すること。</p>
</div>
</li>
<li><p>パラメータとして変数を埋め込む</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&quot;@{/user/details(userId=${user.id})}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (4) --&gt;</span>
    <span class="cm">&lt;!-- omitted --&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">リンクURL式<code class="docutils literal notranslate"><span class="pre">&#64;{}</span></code>のパス内にパラメータを指定することができる。</div>
<div class="line">例では、変数<code class="docutils literal notranslate"><span class="pre">${user.id}</span></code>の値が代入され、<code class="docutils literal notranslate"><span class="pre">/user/details?userId=3</span></code>といったパスが生成される。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Thymeleaf + Springの#mvc.urlメソッドを使用してリクエストURLを組み立てる</strong></p>
<p>つぎに、Thymeleaf + Springの<code class="docutils literal notranslate"><span class="pre">#mvc.url</span></code>メソッドを使用してリクエストURLを組み立てる方法について説明する。</p>
<p><code class="docutils literal notranslate"><span class="pre">#mvc.url</span></code>メソッドを使用すると、Controllerのメソッドのメタ情報(メソッドシグネチャやアノテーションなど)と連携して、リクエストURLを組み立てる事ができる。</p>
<blockquote>
<div><div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&quot;${(#mvc.url(&#39;HC#hello&#39;)).build()}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (3) --&gt;</span>
    <span class="cm">&lt;!-- omitted --&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">#mvc.url</span></code>メソッドの引数には、呼び出すControllerのメソッドに割り振られているリクエストマッピング名を指定する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">#mvc.url</span></code>メソッドからは、リクエストURLを組み立てるクラス(<code class="docutils literal notranslate"><span class="pre">Mvc.MethodArgumentBuilderWrapper</span></code>)のオブジェクトが返却される。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Mvc.MethodArgumentBuilderWrapper</span></code>クラスは、ラップしている<code class="docutils literal notranslate"><span class="pre">MvcUriComponentsBuilder.MethodArgumentBuilder</span></code>オブジェクトと同等の機能をもつ。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">MvcUriComponentsBuilder.MethodArgumentBuilder</span></code>クラスには、</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">arg</span></code>メソッド</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">build</span></code>メソッド</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buildAndExpand</span></code>メソッド</p></li>
</ul>
<div class="line-block">
<div class="line">が用意されており、それぞれ、以下の役割を持つ。</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">arg</span></code>メソッドは、Controllerのメソッドの引数に渡す値を指定するためのメソッドである。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">build</span></code>メソッドは、リクエストURLを生成するためのメソッドである。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buildAndExpand</span></code>メソッドは、Controllerのメソッドの引数として宣言されていない動的な部分(パス変数など)に埋め込む値を指定した上で、リクエストURLを生成するためのメソッドである。</p></li>
</ul>
<div class="line-block">
<div class="line">上記例では、リクエストURLが静的なURLであるため、<code class="docutils literal notranslate"><span class="pre">build</span></code>メソッドのみを呼び出してリクエストURLを生成している。</div>
<div class="line">リクエストURLが動的なURL(パス変数やクエリ文字列が存在するURL)の場合は、<code class="docutils literal notranslate"><span class="pre">arg</span></code>メソッドや<code class="docutils literal notranslate"><span class="pre">buildAndExpand</span></code>メソッドを呼び出す必要がある。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">arg</span></code>メソッドと<code class="docutils literal notranslate"><span class="pre">buildAndExpand</span></code>メソッドの具体的な使用例については、</div>
<div class="line">「<a class="reference external" href="https://docs.spring.io/spring-framework/docs/6.1.3/reference/html/web.html#mvc-links-to-controllers-from-views">Spring Framework Documentation -Links in Views-</a>」を参照されたい。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>リクエストマッピング名について</strong></p>
<p>リクエストマッピング名は、デフォルト実装(<code class="docutils literal notranslate"><span class="pre">org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMethodMappingNamingStrategy</span></code>の実装)では、「クラス名の大文字部分(クラスの短縮名) + “<code class="docutils literal notranslate"><span class="pre">#</span></code>“  + メソッド名」となる。</p>
<p>リクエストマッピング名は重複しないようにする必要がある。名前が重複してしまった場合は、<code class="docutils literal notranslate"><span class="pre">&#64;RequestMapping</span></code>合成アノテーションの<code class="docutils literal notranslate"><span class="pre">name</span></code>属性に一意となる名前を指定する必要がある。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-thymeleaf-message-label">
<span id="id73"></span><h4><a class="toc-backref" href="#id176" role="doc-backlink"><span class="section-number">3.4.3.2.6. </span>メッセージを表示する</a><a class="headerlink" href="#view-thymeleaf-message-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">プロパティファイルからメッセージを取得し表示する場合、Thymeleafのメッセージ式<code class="docutils literal notranslate"><span class="pre">#{}</span></code>または変数式で<code class="docutils literal notranslate"><span class="pre">#messages</span></code>を使用する。</div>
<div class="line">単純なメッセージの表示にはメッセージ式を使用することを推奨する。</div>
</div>
<div class="line-block">
<div class="line">なお、画面名、項目名、ガイダンス用のメッセージなどについては、国際化の必要がない場合はHTMLに直接記載してもよい。</div>
<div class="line">ただし、国際化の必要がある場合はプロパティファイルからメッセージを取得し表示することを推奨する。</div>
<div class="line">詳細は、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Internationalization.html"><span class="doc">国際化</span></a>を参照されたい。</div>
</div>
<ul>
<li><p>properties</p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="c1"># (1)</span>
<span class="na">label.orderStatus</span><span class="o">=</span><span class="s">注文ステータス</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">プロパティファイルにラベルの値を定義する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
<li><p>テンプレートHTML</p>
<ul class="simple">
<li><p>メッセージ式<code class="docutils literal notranslate"><span class="pre">#{}</span></code>を使う場合</p></li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;#{label.orderStatus}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (2) */--&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">メッセージ式にプロパティファイルのキー名を指定するとキー名に一致するプロパティ値が表示される。</div>
</div>
</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>変数式で<code class="docutils literal notranslate"><span class="pre">#messages</span></code>を使う場合</p></li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${#messages.msg(label.orderStatus)&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (3) */--&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">変数式で<code class="docutils literal notranslate"><span class="pre">#messages.msg</span></code>メソッドにプロパティファイルのキー名を指定するとキー名に一致するプロパティ値が表示される。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>メッセージ式で指定したキーに該当するメッセージが存在しない場合は、<code class="docutils literal notranslate"><span class="pre">??label.orderStatus??</span></code>のようにメッセージキーが返却される。</p>
<p>しかし、例えばメッセージが存在しない場合にはデフォルトメッセージを表示したい場合など、メッセージキーが返却されると判定が複雑になってしまう。このような場合は、<code class="docutils literal notranslate"><span class="pre">#messages.msgOrNull</span></code>メソッドと、後述するデフォルト式を利用することで、簡潔に記述することができる。</p>
<p>以下にコード例を示す。</p>
<blockquote>
<div><div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${#messages.msgOrNull(label.orderStatus) ?: &#39;不明なステータス&#39;}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p>デフォルト式については、<a class="reference internal" href="#view-thymeleaf-conditional-label"><span class="std std-ref">条件を判定する</span></a>も参照されたい。</p>
</div>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-thymeleaf-textcombine-label">
<span id="id74"></span><h4><a class="toc-backref" href="#id177" role="doc-backlink"><span class="section-number">3.4.3.2.7. </span>文字列を組み立てる</a><a class="headerlink" href="#view-thymeleaf-textcombine-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">リテラルやモデルに格納されている値などを組み合わせた文字列を出力したい場合、 “<code class="docutils literal notranslate"><span class="pre">+</span></code>“ 演算子やパイプ( “<code class="docutils literal notranslate"><span class="pre">|</span></code>“ )を使用する。</div>
</div>
<div class="line-block">
<div class="line">単純に文字列を結合するのであれば、可読性の高いパイプの使用を推奨する。</div>
<div class="line">ただしパイプ内では計算や条件判定ができないため、これらが必要な場合は “<code class="docutils literal notranslate"><span class="pre">+</span></code>“ 演算子を使用すると良い。</div>
</div>
<ul>
<li><p>hello.html</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;|Message : ${helloBean.message}|&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (1) */--&gt;</span>
<span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;&#39;Message : &#39; + ${helloBean.message}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (2) */--&gt;</span>
</pre></div>
</div>
</li>
<li><p>HTML created by View(hello.html)</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>Message : Bean Hello World!<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (3) --&gt;</span>
<span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>Message : Bean Hello World!<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (3) --&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">パイプ( “<code class="docutils literal notranslate"><span class="pre">|</span></code>“ )で囲むことにより、結合された文字列を生成できる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">“<code class="docutils literal notranslate"><span class="pre">+</span></code>“ 演算子を利用すると、変数式やシングルクォート<code class="docutils literal notranslate"><span class="pre">''</span></code>で囲んだテキストを結合できる。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">HTMLの出力例。出力されるHTMLは2行とも同じになる。</div>
<div class="line">テキストの結合方法の混在は可読性を低下させるため、ここでは、パイプによる結合を推奨する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>文字列を結合する際の注意点について</strong></p>
<p>文字列を結合する場合、結合対象の変数値が<code class="docutils literal notranslate"><span class="pre">null</span></code>の場合には画面に”null”が表示されてしまう。</p>
<p>文字列を結合する際には、結合対象の変数値が<code class="docutils literal notranslate"><span class="pre">null</span></code>とならない事を確認するか、後述するデフォルト式<code class="docutils literal notranslate"><span class="pre">?:</span></code>を使用して、テンプレートHTML側で<code class="docutils literal notranslate"><span class="pre">null</span></code>の代替文字列を指定することで回避すること。</p>
<p>例えば以下の実装例において、<code class="docutils literal notranslate"><span class="pre">helloBean.message</span></code>の値が<code class="docutils literal notranslate"><span class="pre">null</span></code>の場合は、以下のようなHTMLが生成される。</p>
<ul>
<li><p>実装例</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;|Message : ${helloBean.message}|&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;&#39;Message : &#39; + ${helloBean.message}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
Message : <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${helloBean.message}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="cm">&lt;!-- 文字列を結合しない例 --&gt;</span>
</pre></div>
</div>
</li>
<li><p>生成されたHTML</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>Message : null<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>Message : null<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
Message : <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="cm">&lt;!-- 文字列を結合しない例 --&gt;</span>
</pre></div>
</div>
</li>
</ul>
</div>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-thymeleaf-conditional-label">
<span id="id75"></span><h4><a class="toc-backref" href="#id178" role="doc-backlink"><span class="section-number">3.4.3.2.8. </span>条件を判定する</a><a class="headerlink" href="#view-thymeleaf-conditional-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">ThymeleafのテンプレートHTMLでは、式内で条件を判定し、その結果によって異なる動作をさせることができる。</div>
<div class="line">判定された結果は、<code class="docutils literal notranslate"><span class="pre">true</span></code>または<code class="docutils literal notranslate"><span class="pre">false</span></code>で返却される。</div>
<div class="line">演算子の詳細については、<a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.1/usingthymeleaf.html#standard-expression-syntax">Tutorial: Using Thymeleaf -Standard Expression Syntax-</a>を参照されたい。</div>
</div>
<p>演算子を用いた条件の判定の結果によって、2つの式のどちらかを選択する式を条件式という。</p>
<blockquote>
<div><div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${user.age} != null ? ${user.age} : &#39;no age specified&#39;&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (1) */--&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">${user.age}</span> <span class="pre">!=</span> <span class="pre">null</span></code>という条件の判定が<code class="docutils literal notranslate"><span class="pre">true</span></code>であった場合、<code class="docutils literal notranslate"><span class="pre">${user.age}</span></code>を表示する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">false</span></code>であった場合は、”no age specified”という文字列を表示する。</div>
<div class="line">このように、条件式は「条件 ? 式 : 式」と表されるため、3項演算子とも呼ばれる。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>条件式には、等価演算子のほかに、算術演算子や比較演算子も利用できる。</p>
<blockquote>
<div><div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${user.age} &gt;= 12 ? &#39;adult&#39; : &#39;child&#39;&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (1) */--&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">${user.age}</span></code>が12以上であった場合’adult’を、12未満であった場合’child’を表示する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>数値の配列やリストに対して、合計値や平均値を取得したい場合、<code class="docutils literal notranslate"><span class="pre">#aggregates</span></code>を利用できる。</p>
<p>詳細については、<a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.1/usingthymeleaf.html#aggregates">Tutorial: Using Thymeleaf -Aggregates-</a>を参照されたい。</p>
</div>
</div></blockquote>
<p>条件の判定の結果によって処理が変わる式としては、条件式のほかに、デフォルト式と呼ばれるものもある。</p>
<blockquote>
<div><div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${user.age} ?: &#39;no age specified&#39;&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (2) */--&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">?:</span></code>演算子は、左式 (例では<code class="docutils literal notranslate"><span class="pre">${user.age}</span></code>)が<code class="docutils literal notranslate"><span class="pre">null</span></code>であったときに限って右式(例では”no age specified”)を選択し、それ以外の場合は左式を選択する。</div>
<div class="line">これは上の3項演算子と同じ機能をもっており、このようにデフォルト式は簡単にnullチェックを行うことができる。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>No Operation Token( “<code class="docutils literal notranslate"><span class="pre">_</span></code>“ )は、記述した属性で何もしないことを指示するものである。</p>
<p>以下のコード例において、<code class="docutils literal notranslate"><span class="pre">user.age</span></code>が<code class="docutils literal notranslate"><span class="pre">null</span></code>だった場合、<code class="docutils literal notranslate"><span class="pre">th:text</span></code>属性は処理されず、’no age specified’が表示される。</p>
<blockquote>
<div><div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${user.age} ?: _&quot;</span><span class="p">&gt;</span>no age specified<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-thymeleaf-if-label">
<span id="id76"></span><h4><a class="toc-backref" href="#id179" role="doc-backlink"><span class="section-number">3.4.3.2.9. </span>条件によって表示を切り替える</a><a class="headerlink" href="#view-thymeleaf-if-label" title="Permalink to this heading">¶</a></h4>
<p>モデルが保持する値によって表示を切り替えたい場合は、Thymeleafの<code class="docutils literal notranslate"><span class="pre">th:if</span></code>属性または<code class="docutils literal notranslate"><span class="pre">th:switch</span></code>属性を使用する。</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">th:if</span></code>属性の逆の機能として<code class="docutils literal notranslate"><span class="pre">th:unless</span></code>属性があるが、<code class="docutils literal notranslate"><span class="pre">th:if</span></code>と<code class="docutils literal notranslate"><span class="pre">th:unless</span></code>の混在は可読性を低下させる場合があるため、いずれかへの統一を推奨する。</p>
<p>本ガイドラインにおいては、<code class="docutils literal notranslate"><span class="pre">th:if</span></code>に統一している。</p>
</div>
</div></blockquote>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">th:if</span></code>属性を使用して表示を切り替える。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${orderForm.orderStatus} != &#39;complete&#39;&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (1) */--&gt;</span>
        <span class="cm">&lt;!--/* ... */--&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:if</span></code>属性に条件を指定する。</div>
<div class="line">条件式が<code class="docutils literal notranslate"><span class="pre">true</span></code>の場合は<code class="docutils literal notranslate"><span class="pre">th:if</span></code>を記述した要素の表示処理が実行され、<code class="docutils literal notranslate"><span class="pre">false</span></code>の場合は要素ごと削除され、表示処理は実行されない。</div>
<div class="line">例では、注文ステータスが<code class="docutils literal notranslate"><span class="pre">'complete'</span></code>ではない場合に<code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>要素の表示処理が実行され、</div>
<div class="line">注文ステータスが<code class="docutils literal notranslate"><span class="pre">'complete'</span></code>であった場合には<code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>要素が削除され、表示処理は実行されない。</div>
<div class="line">また、<code class="docutils literal notranslate"><span class="pre">th:if</span></code>属性の逆の機能として<code class="docutils literal notranslate"><span class="pre">th:unless</span></code>属性があるが、<code class="docutils literal notranslate"><span class="pre">th:if</span></code>属性と<code class="docutils literal notranslate"><span class="pre">th:unless</span></code>属性の混在は可読性を低下させる場合があるため、いずれかへの統一を推奨する。</div>
<div class="line">本ガイドラインにおいては、<code class="docutils literal notranslate"><span class="pre">th:if</span></code>属性に統一している。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">th:switch</span></code>属性を使用して表示を切り替える。</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:switch</span><span class="o">=</span><span class="s">&quot;${customer.type}&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (1) */--&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:case</span><span class="o">=</span><span class="s">&quot;premium&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (2) */--&gt;</span>
        <span class="cm">&lt;!--/* ... */--&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:case</span><span class="o">=</span><span class="s">&quot;general&quot;</span><span class="p">&gt;</span>
        <span class="cm">&lt;!--/* ... */--&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:case</span><span class="o">=</span><span class="s">&quot;*&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (3) */--&gt;</span>
        <span class="cm">&lt;!--/* ... */--&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default" id="id101">
<caption><span class="caption-text">:header-rows: 1
 :widths: 10 90</span><a class="headerlink" href="#id101" title="Permalink to this table">¶</a></caption>
<tbody>
<tr class="row-odd"><td><p>項番</p></td>
<td><p>説明</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:switch</span></code>属性に変数値を指定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:case</span></code>属性に条件を指定する。<code class="docutils literal notranslate"><span class="pre">th:case</span></code>属性で指定した値が<code class="docutils literal notranslate"><span class="pre">th:switch</span></code>属性で指定した変数値と等しかった場合、その要素の表示処理が実行される。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:case</span></code>属性は上から順に評価され、最初に合致した条件における表示処理が実行される。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">いずれの条件にも合致しなかった場合に実行したい表示処理は、<code class="docutils literal notranslate"><span class="pre">th:case=&quot;*&quot;</span></code>を最後に指定して記述する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-thymeleaf-each-label">
<span id="id77"></span><h4><a class="toc-backref" href="#id180" role="doc-backlink"><span class="section-number">3.4.3.2.10. </span>コレクションの要素に対して表示処理を繰り返す</a><a class="headerlink" href="#view-thymeleaf-each-label" title="Permalink to this heading">¶</a></h4>
<p>モデルが保持するコレクションや配列、Map等に対して表示処理を繰り返したい場合は、Thymeleafの<code class="docutils literal notranslate"><span class="pre">th:each</span></code>属性を使用する。</p>
<blockquote>
<div><div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Name<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Address<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;customer : ${customers}&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (1) */--&gt;</span>
        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${customer.name}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (2) */--&gt;</span>
        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${customer.address}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (2) */--&gt;</span>
    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:each</span></code>属性の右項にコレクションを指定し、左項にはコレクション内の各オブジェクトを格納する変数名を指定する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;tr&gt;</span></code>要素は、コレクション内のオブジェクトごとに繰り返し処理される。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:each</span></code>属性の左項に指定した変数に格納されているオブジェクトから変数値を取得している。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>コレクション内のオブジェクトに対してインデックスなどを取りたい場合は、次のようにテンプレートHTMLを実装する。</p>
<blockquote>
<div><div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>No<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Name<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Address<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;customer, status : ${customers}&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (1) */--&gt;</span>
        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${status.count}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (2) */--&gt;</span>
        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${customer.name}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${customer.address}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:each</span></code>属性の左項に、要素の番号を格納する変数を2つ目に指定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:each</span></code>属性の左項で2つ目に指定した変数から、現在処理を行っている要素の位置を取得している。countは、要素の位置を1始まりで取得している。</div>
<div class="line">count以外の属性については、<a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.1/usingthymeleaf.html#keeping-iteration-status">Tutorial: Using Thymeleaf -Keeping iteration status-</a>を参照されたい。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">th:each</span></code>属性の詳細は、<a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.1/usingthymeleaf.html#iteration">Tutorial: Using Thymeleaf -Iteration-</a>を参照されたい。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-thymeleaf-object-label">
<span id="id78"></span><h4><a class="toc-backref" href="#id181" role="doc-backlink"><span class="section-number">3.4.3.2.11. </span>オブジェクトのプロパティを省略して指定する</a><a class="headerlink" href="#view-thymeleaf-object-label" title="Permalink to this heading">¶</a></h4>
<p>Thymeleafの<code class="docutils literal notranslate"><span class="pre">th:object</span></code>属性を用いると、オブジェクト名を省略してプロパティを指定することができる。</p>
<blockquote>
<div><div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:object</span><span class="o">=</span><span class="s">&quot;${helloBean}&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (1) */--&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;*{message}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (2) */--&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:object</span></code>属性にオブジェクトを変数式<code class="docutils literal notranslate"><span class="pre">${}</span></code>で指定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">オブジェクトのプロパティを選択変数式<code class="docutils literal notranslate"><span class="pre">*{}</span></code>で指定する。これは、変数式を用いて<code class="docutils literal notranslate"><span class="pre">th:text=&quot;${helloBean.message}</span></code>と指定するのと同じ結果になる。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>テンプレートレイアウトにより部品化する際に、後述する<a class="reference internal" href="#view-thymeleaf-preprocessing-label"><span class="std std-ref">プリプロセッシング</span></a>を利用すると、フラグメント（部品）に引数として式を与えることが可能になるが、</p>
<p>この場合、引数に渡す式は部品を呼び出す側に記述され、式の評価は部品側で行われることになる。</p>
<p>選択変数式<code class="docutils literal notranslate"><span class="pre">*{}</span></code>は、記述された位置で有効な<code class="docutils literal notranslate"><span class="pre">th:object</span></code>ではなく、評価時に有効な<code class="docutils literal notranslate"><span class="pre">th:object</span></code>(部品で<code class="docutils literal notranslate"><span class="pre">th:object</span></code>が使用され、その有効範囲内で引数に渡された式が評価される場合は、部品側に記載された<code class="docutils literal notranslate"><span class="pre">th:object</span></code>)が使用されるため、</p>
<p>フラグメント（部品）に引数として式を与える場合には、式を<code class="docutils literal notranslate"><span class="pre">th:object</span></code>と選択変数式<code class="docutils literal notranslate"><span class="pre">*{}</span></code>ではなく、変数式<code class="docutils literal notranslate"><span class="pre">${}</span></code>で組み立てなければならない。</p>
<p>これは、部品内で<code class="docutils literal notranslate"><span class="pre">th:object</span></code>と選択変数式<code class="docutils literal notranslate"><span class="pre">*{}</span></code>を使用していても、部品を呼び出す側が与えた式の意味(参照するもの)が変わらないようにするための(裏を返せば、部品内での<code class="docutils literal notranslate"><span class="pre">th:object</span></code>と選択変数式<code class="docutils literal notranslate"><span class="pre">*{}</span></code>の使用を制限せずに済むための)ルールである。</p>
<p>テンプレートHTMLの実装については<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/TemplateLayout.html#templatelayoutnotefragment"><span class="std std-ref">こちらのNote</span></a>も参考にされたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-thymeleaf-with-label">
<span id="id79"></span><h4><a class="toc-backref" href="#id182" role="doc-backlink"><span class="section-number">3.4.3.2.12. </span>ローカル変数を定義する</a><a class="headerlink" href="#view-thymeleaf-with-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">Thymeleafでは、テンプレートHTMLの特定の要素に定義され、その要素と要素配下のみで評価可能な変数のことをローカル変数と呼ぶ。</div>
<div class="line">このローカル変数を定義する場合、<code class="docutils literal notranslate"><span class="pre">th:with</span></code>属性を使用する。</div>
</div>
<blockquote>
<div><div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:with</span><span class="o">=</span><span class="s">&quot;localvar=|Hello, ${user.name}|&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (1) */--&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${localvar}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (2) */--&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:with</span></code>属性に”変数名=値”の形式で設定すると、指定した値をもつローカル変数を定義できる。</div>
<div class="line">例では、<code class="docutils literal notranslate"><span class="pre">localvar</span></code>という名の変数を定義し、<code class="docutils literal notranslate"><span class="pre">Hello,</span> <span class="pre">(ユーザー名)</span></code>という文字列を代入している。</div>
<div class="line">このローカル変数は、<code class="docutils literal notranslate"><span class="pre">th:with</span></code>属性を指定した<code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>要素とその要素配下でのみ有効となる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">変数式<code class="docutils literal notranslate"><span class="pre">${}</span></code>にローカル変数<code class="docutils literal notranslate"><span class="pre">localvar</span></code>を指定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-thymeleaf-preprocessing-label">
<span id="id80"></span><h4><a class="toc-backref" href="#id183" role="doc-backlink"><span class="section-number">3.4.3.2.13. </span>プリプロセッシング</a><a class="headerlink" href="#view-thymeleaf-preprocessing-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">プリプロセッシングを利用することで、式の一部を事前に評価し動的に式を構築することができる。</div>
<div class="line">事前に評価する式は<code class="docutils literal notranslate"><span class="pre">__</span></code>で囲み<code class="docutils literal notranslate"><span class="pre">__${val}__</span></code>のように記述する。</div>
<div class="line">式を構築する仕組みであるため、利用には細心の注意が必要となる。<strong>必ず</strong><a class="reference internal" href="#applicationlayerwarningpreprocessing"><span class="std std-ref">Warning</span></a><strong>を参照されたい。</strong></div>
</div>
<blockquote>
<div><div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&quot;@{/sample/app/sampleModel}&quot;</span>
  <span class="na">th:object</span><span class="o">=</span><span class="s">&quot;${userManagementForm}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-horizontal&quot;</span><span class="p">&gt;</span>
  <span class="cm">&lt;!-- ... --&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;userForm, status : *{userFormList}&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col col-md-2&quot;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;|氏名${status.count}|&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col col-md-3&quot;</span><span class="p">&gt;</span>
        <span class="cm">&lt;!--/* (1) */--&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{userFormList[__${status.index}__].userName}&quot;</span>
          <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control input-sm&quot;</span> <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="cm">&lt;!--/* (2) */--&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col col-md-4&quot;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${userForm.userAge}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="cm">&lt;!-- ... --&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:field</span></code>属性には選択変数式でフォームオブジェクト直下からプロパティを指定する必要があり、ここでは<code class="docutils literal notranslate"><span class="pre">th:field=&quot;*{userFormList[1].userName}&quot;</span></code>のように指定する。</div>
<div class="line">配列インデックスの指定に<code class="docutils literal notranslate"><span class="pre">th:each</span></code>のインデックスを利用したいが、<code class="docutils literal notranslate"><span class="pre">th:field</span></code>属性や<code class="docutils literal notranslate"><span class="pre">th:errors</span></code>属性ではSpELは配列インデックスに指定した式を評価しないため、 <code class="docutils literal notranslate"><span class="pre">userFormList[status.index]</span></code> のように指定するとインデックスが文字列”status.index”となってしまう。</div>
<div class="line">このため、式”status.index”をプリプロセッシングで先に評価する必要がある。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:text</span></code>属性ではフォームオブジェクト直下からプロパティを指定する必要はなく、<code class="docutils literal notranslate"><span class="pre">th:each</span></code>属性で定義した変数<code class="docutils literal notranslate"><span class="pre">userForm</span></code>を利用し、<code class="docutils literal notranslate"><span class="pre">${userForm.userAge}</span></code>のように指定できる。</div>
<div class="line">また、<code class="docutils literal notranslate"><span class="pre">th:text</span></code>属性ではSpELは配列インデックスに指定した式を評価するため、フォームオブジェクト直下からプロパティを取得する場合でも<code class="docutils literal notranslate"><span class="pre">th:text=&quot;${userManagementForm.userFormList[status.index].userAge}&quot;</span></code>または<code class="docutils literal notranslate"><span class="pre">th:text=&quot;*{userFormList[#ctx.status.index].userAge}&quot;</span></code>と書くことができ、プリプロセッシングは不要である。</div>
<div class="line">(2つ目の例でインデックスに<code class="docutils literal notranslate"><span class="pre">#ctx</span></code>を使用しているのは、<code class="docutils literal notranslate"><span class="pre">#ctx</span></code>を使用しない場合<code class="docutils literal notranslate"><span class="pre">th:obejct</span></code>で指定したものの<code class="docutils literal notranslate"><span class="pre">status</span></code>プロパティを参照してしまうためである。)</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition warning" id="applicationlayerwarningpreprocessing">
<p class="admonition-title">Warning</p>
<p>プリプロセッシングは式を動的に構築するためのものであるため、ユーザの入力値(リクエストから入力するものであれば、画面上に入力欄が存在しないものも含む)をプリプロセッシングした場合、サーバーで任意のコードを実行されてしまう可能性がある。アプリケーションの実装次第では入力チェック後にもTOCTOUで不正な値が紛れ込む余地があり、開発者が問題を認識することが難しく、問題を見逃した場合の影響が甚大であるため、入力チェック対象の項目である場合でも、入力値をプリプロセッシングしないことを推奨する。</p>
<p>TOCTOU（Time of check to time of use）とは、ある値がチェックされてから使用されるまでの間に変更されることにより発生する問題である。</p>
<p>例えば、半角英数字のみという条件で入力チェックを行ったのち、何らかの原因によって入力値が変更され、記号などの不正な値が混入した状態で使用されてしまうなどである。</p>
<p>TOCTOUが発生する典型的なケースとしては以下のようなものがある。</p>
<ul>
<li><div class="line-block">
<div class="line">入力画面で入力チェックを行った後、確認画面を表示し画面の操作(確定ボタン押下等)によって処理を実行するアプリにて、確定ボタン押下時に再チェックを行っていないことで実質任意の値が入力可能になっている。(入力チェックの実装漏れ)</div>
</div>
</li>
<li><div class="line-block">
<div class="line">セッションスコープにフォームオブジェクトを格納している場合、入力チェックを通過したフォーム内の値が、ハンドラメソッド実行中に別スレッドから書き換えられ、不正な値で処理を実行してしまう。Springの機能(<code class="docutils literal notranslate"><span class="pre">RequestMappingHandlerAdapter</span></code>の<code class="docutils literal notranslate"><span class="pre">synchronizeOnSession</span></code>)で対策可能であり、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/SessionManagement.html#session-management-how-to-extend-synchronizeonsession"><span class="std std-ref">同一セッション内のリクエストの同期化</span></a>でも案内している。</div>
</div>
</li>
</ul>
<p>上記の典型的なケースの対策が行われていても、Springの機能(<code class="docutils literal notranslate"><span class="pre">RequestMappingHandlerAdapter</span></code>の<code class="docutils literal notranslate"><span class="pre">synchronizeOnSession</span></code>)により同期化が行われるのはControllerの範囲であるため、ViewであるThymeleafのテンプレートHTMLでセッションスコープのフォームオブジェクトから値を取得している場合は、別スレッドから書き換えられた不正な値が得られる可能性がある。</p>
<p><strong>当ガイドラインのプリプロセッシングに対する推奨事項としては以下の通りになる。</strong></p>
<ol class="arabic">
<li><div class="line-block">
<div class="line">プリプロセッシングを利用せずとも実装できないか検討を行う。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">プリプロセッシングを利用しなければならない場合は、サーバ上の安全なデータを用いる。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">どうしてもユーザの入力値などの安全でないデータをプリプロセッシングする必要がある場合は、入力値を利用する直前に入力チェックを行っていること、及びその値が状態により変更されないことを十分に確認した上で利用する。</div>
<div class="line">(ただし、上述の通り、開発者が問題を認識することが難しい上、問題を見逃した場合の影響が甚大であるため、安易に採用しないこと。)</div>
</div>
</li>
</ol>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-thymeleaf-form-label">
<span id="id81"></span><h4><a class="toc-backref" href="#id184" role="doc-backlink"><span class="section-number">3.4.3.2.14. </span>フォームオブジェクトのプロパティをバインドする</a><a class="headerlink" href="#view-thymeleaf-form-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">Thymeleaf + Springの<code class="docutils literal notranslate"><span class="pre">th:object</span></code>属性と<code class="docutils literal notranslate"><span class="pre">th:field</span></code>属性を使用すると、フォームオブジェクトのプロパティをバインドすることができる。</div>
</div>
<blockquote>
<div><div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&quot;@{/sample/hello}&quot;</span> <span class="na">th:object</span><span class="o">=</span><span class="s">&quot;${sampleForm}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (1) */--&gt;</span>
    Id : <span class="p">&lt;</span><span class="nt">input</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{id}&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (2) */--&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;form&gt;</span></code>タグの<code class="docutils literal notranslate"><span class="pre">th:object</span></code>属性に、<code class="docutils literal notranslate"><span class="pre">Model</span></code>に格納されているフォームオブジェクトを指定する。
<code class="docutils literal notranslate"><span class="pre">&lt;form&gt;</span></code>タグの<code class="docutils literal notranslate"><span class="pre">th:object</span></code>では以下の点に注意されたい。</p>
<ul class="simple">
<li><p>変数式に<code class="docutils literal notranslate"><span class="pre">${sample.sampleForm}</span></code>のようにネストしたプロパティを指定することはできない。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;form&gt;</span></code>タグ内でさらに<code class="docutils literal notranslate"><span class="pre">th:object</span></code>を使用することはできない。</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;input&gt;</span></code>タグの<code class="docutils literal notranslate"><span class="pre">th:field</span></code>属性に、バインドするプロパティ名を指定する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:field</span></code>では以下の点に注意されたい。</div>
</div>
<ul class="simple">
<li><p>変数式<code class="docutils literal notranslate"><span class="pre">${}</span></code>は使用できず、必ず選択変数式<code class="docutils literal notranslate"><span class="pre">*{}</span></code>を使用する必要がある。</p></li>
<li><p>選択変数式に<code class="docutils literal notranslate"><span class="pre">*{receiverAddress.postcode}</span></code>のようにネストしたプロパティを指定することはできる。</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-thymeleaf-errors-label">
<span id="id82"></span><h4><a class="toc-backref" href="#id185" role="doc-backlink"><span class="section-number">3.4.3.2.15. </span>入力チェックエラーを表示する</a><a class="headerlink" href="#view-thymeleaf-errors-label" title="Permalink to this heading">¶</a></h4>
<p>入力チェックエラーの内容を表示する場合、Thymeleaf + Springの<code class="docutils literal notranslate"><span class="pre">th:errors</span></code>属性を使用する。詳細は、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Validation.html"><span class="doc">入力チェック</span></a>を参照されたい。</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>入力チェックそのものは<code class="docutils literal notranslate"><span class="pre">th:errors</span></code>属性を使用することで可能となるが、<code class="docutils literal notranslate"><span class="pre">th:object</span></code>属性と併用することで簡潔な記述となり、可読性が高まるため、これを推奨する。</p>
</div>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&quot;@{/sample/hello}&quot;</span> <span class="na">th:object</span><span class="o">=</span><span class="s">&quot;${sampleForm}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
    Id : <span class="p">&lt;</span><span class="nt">input</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{id}&quot;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">th:errors</span><span class="o">=</span><span class="s">&quot;*{id}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span><span class="cm">&lt;!--/* (1) */--&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:errors</span></code>属性に、エラー表示したいプロパティのプロパティ名を指定する。</div>
<div class="line">なお、指定したプロパティに入力チェックエラーがなかった場合、出力されるHTMLにおいて、<code class="docutils literal notranslate"><span class="pre">th:errors</span></code>属性を含む要素(ここでは<code class="docutils literal notranslate"><span class="pre">&lt;span&gt;</span></code>)は削除される。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-thymeleaf-resultmessages-label">
<span id="id83"></span><h4><a class="toc-backref" href="#id186" role="doc-backlink"><span class="section-number">3.4.3.2.16. </span>処理結果のメッセージを表示する</a><a class="headerlink" href="#view-thymeleaf-resultmessages-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">処理結果を通知するメッセージを表示する場合、<code class="docutils literal notranslate"><span class="pre">ResultMessages</span></code>オブジェクトから結果メッセージを取り出して表示する必要がある。</div>
<div class="line">結果メッセージはコードまたはメッセージ文字列として格納されており、前者はコードをキーにプロパティファイルからメッセージを取得して表示する必要がある。</div>
<div class="line">詳細は、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/MessageManagement.html"><span class="doc">メッセージ管理</span></a>を参照されたい。</div>
</div>
<p>以下では、TERASOLUNAのJSPタグである<code class="docutils literal notranslate"><span class="pre">&lt;t:messagesPanel&gt;</span></code>のデフォルト設定で出力するHTMLを生成する例として、以下のようにソースコードを記述している。</p>
<blockquote>
<div><div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;messages&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Message pattern<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${resultMessages} != null&quot;</span> <span class="na">th:class</span><span class="o">=</span><span class="s">&quot;|alert alert-${resultMessages.type}|&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (1) */--&gt;</span>
        <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;message : ${resultMessages}&quot;</span>
                <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${message.code} != null ? ${#messages.msgWithParams(message.code, message.args)} : ${message.text}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span> <span class="cm">&lt;!--/* (2) */--&gt;</span>
        <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">resultMessages</span></code>オブジェクトが<code class="docutils literal notranslate"><span class="pre">null</span></code>でないとき、<code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>とその配下の要素が実行される。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">resultMessages</span></code>オブジェクトに格納された<code class="docutils literal notranslate"><span class="pre">message</span></code>プロパティを、Thymeleafの<code class="docutils literal notranslate"><span class="pre">#messages</span></code>を使用して繰り返し取得し、出力する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-thymeleaf-codelist-label">
<span id="id84"></span><h4><a class="toc-backref" href="#id187" role="doc-backlink"><span class="section-number">3.4.3.2.17. </span>コードリストを表示する</a><a class="headerlink" href="#view-thymeleaf-codelist-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">コードリストは、<code class="docutils literal notranslate"><span class="pre">java.util.Map</span></code>型として取得することができ、<code class="docutils literal notranslate"><span class="pre">Map</span></code>インタフェースと同じ方法で参照することができる。</div>
<div class="line">詳細は、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Codelist.html"><span class="doc">コードリスト</span></a>を参照されたい。</div>
</div>
<p>コードリストをセレクトボックスに表示する。</p>
<blockquote>
<div><div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">select</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;${orderForm.orderStatus}&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>--Select--<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">option</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;var : ${CL_ORDERSTATUS}&quot;</span> <span class="na">th:value</span><span class="o">=</span><span class="s">&quot;${var.key}&quot;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${var.value}&quot;</span> <span class="p">/&gt;</span> <span class="cm">&lt;!--/* (1) */--&gt;</span>
<span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">コードリスト名(<code class="docutils literal notranslate"><span class="pre">CL_ORDERSTATUS</span></code>)を属性名として、コードリスト(<code class="docutils literal notranslate"><span class="pre">java.util.Map</span></code>インタフェース)が格納されている。</div>
<div class="line">コードリストから、セレクトボックスに各コードのキー値を表示し、選択されたコード名を<code class="docutils literal notranslate"><span class="pre">th:field</span></code>属性で指定されたオブジェクトに代入している。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">th:each</span></code>属性については、<a class="reference internal" href="#view-thymeleaf-each-label"><span class="std std-ref">コレクションの要素に対して表示処理を繰り返す</span></a>も参照されたい。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>セレクトボックスで選択した値のコード名を表示する。</p>
<blockquote>
<div><div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${orderForm.orderStatus} != null ? |Order Status : ${CL_ORDERSTATUS.get(orderForm.orderStatus)}|&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="cm">&lt;!-- (1) --&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">セレクトボックス作成時と同様に、コードリスト名(<code class="docutils literal notranslate"><span class="pre">CL_ORDERSTATUS</span></code>) を属性名として格納されたコードリスト(<code class="docutils literal notranslate"><span class="pre">java.util.Map</span></code>インタフェース)を取得する。</div>
<div class="line">取得したコードリストのキー値として、セレクトボックスで選択した値を指定することで、コード名を表示することができる。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="docutils literal notranslate"><span class="pre">Map.get(key)</span></code>は<code class="docutils literal notranslate"><span class="pre">Map[key]</span></code>と書くこともできる。ただし、<code class="docutils literal notranslate"><span class="pre">Map[key]</span></code>でキーに式を指定する場合、式に「.」を含む場合は式として評価されるが、含まない場合はキーに指定した式を式ではなく文字列として評価してしまい、「<a class="reference external" href="https://github.com/spring-projects/spring-framework/issues/20447">意図したキーを指定できないバグ</a>」の影響を受ける。</p>
<p>バグの影響を回避するために、キーに指定する式に「.」が含まれていない場合は、以下のいずれかの実装を行う必要がある。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Map.get(key)</span></code>: EL式のブラケットを利用せず、getメソッドを利用する。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Map[#ctx.key]</span></code>: コンテキストオブジェクトから変数を指定することで、強制的に「.」を付与する。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Map['__${key}__']</span></code>: プリプロセッシングで先にキー値を解決する。（<strong>非推奨</strong>）</p></li>
</ul>
<p>「.」を含むか含まないかで実装を変えるとバグを引き起こしやすいため、いずれかの方法で統一することを推奨する。本ガイドラインでは<code class="docutils literal notranslate"><span class="pre">Map.get(key)</span></code>で実装を統一している。</p>
<blockquote>
<div><p>プリプロセッシングはセキュリティ上の問題を引き起こす危険性が高いため推奨しない。詳細は<a class="reference internal" href="#view-thymeleaf-preprocessing-label"><span class="std std-ref">プリプロセッシング</span></a>のWarningを参照されたい。</p>
</div></blockquote>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-thymeleaf-pagination-label">
<span id="id86"></span><h4><a class="toc-backref" href="#id188" role="doc-backlink"><span class="section-number">3.4.3.2.18. </span>ページネーション用のリンクを表示する</a><a class="headerlink" href="#view-thymeleaf-pagination-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">一覧表示を行う画面にてページネーション用のリンクを表示する場合、モデルから<code class="docutils literal notranslate"><span class="pre">Page</span></code>インタフェースを取得し、ページネーション用のリンクを生成する。</div>
<div class="line">詳細は、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/Pagination.html"><span class="doc">ページネーション</span></a>を参照されたい。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="view-thymeleaf-authorization-label">
<span id="id87"></span><h4><a class="toc-backref" href="#id189" role="doc-backlink"><span class="section-number">3.4.3.2.19. </span>権限によって表示を切り替える</a><a class="headerlink" href="#view-thymeleaf-authorization-label" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">ログインしているユーザの権限によって表示を切り替える場合は、ThymeleafのSpring Security連携用ダイアレクトで提供されている<code class="docutils literal notranslate"><span class="pre">sec:authorize</span></code>属性や <code class="docutils literal notranslate"><span class="pre">#authorization</span></code>を使用する。</div>
<div class="line">詳細は、<a class="reference internal" href="../Security/Authorization.html"><span class="doc">認可</span></a>を参照されたい。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="javascript">
<h3><a class="toc-backref" href="#id190" role="doc-backlink"><span class="section-number">3.4.3.3. </span>JavaScriptの実装</a><a class="headerlink" href="#javascript" title="Permalink to this heading">¶</a></h3>
<p>画面描画後に画面項目の制御(表示/非表示、活性/非活性などの制御)を行う必要がある場合は、JavaScriptを使用して、項目の制御を行う。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id88">
<h3><a class="toc-backref" href="#id191" role="doc-backlink"><span class="section-number">3.4.3.4. </span>スタイルシートの実装</a><a class="headerlink" href="#id88" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line">画面のデザインに関わる属性値の指定はJSP(HTML)またはテンプレートHTMLに直接指定するのではなく、スタイルシート(cssファイル)に指定することを推奨する。</div>
<div class="line">JSP(HTML)またはテンプレートHTMLでは、項目を一意に特定するためのid属性の指定と項目の分類を示すclass属性の指定を行い、実際の項目の配置や見た目にかかわる属性値の指定はスタイルシート(cssファイル)で指定する。</div>
<div class="line">このような構成にすることで、JSPまたはHTMLの実装からデザインに関わる処理を減らすことができる。</div>
<div class="line">同時にちょっとしたデザイン変更であれば、JSPまたはテンプレートHTMLを修正せずにスタイルシート(cssファイル)の修正のみで対応可能となる。</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>JSPで<code class="docutils literal notranslate"><span class="pre">&lt;form:xxx&gt;</span></code>タグを使ってフォームを生成した場合、id属性は自動で設定される。class属性については、アプリケーション開発者による指定が必要。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="id89">
<h2><a class="toc-backref" href="#id192" role="doc-backlink"><span class="section-number">3.4.4. </span>共通処理の実装</a><a class="headerlink" href="#id89" title="Permalink to this heading">¶</a></h2>
<section id="controller-common-process">
<span id="id90"></span><h3><a class="toc-backref" href="#id193" role="doc-backlink"><span class="section-number">3.4.4.1. </span>Controllerの呼び出し前後で行う共通処理の実装</a><a class="headerlink" href="#controller-common-process" title="Permalink to this heading">¶</a></h3>
<p>本項でいう共通処理とは、Controllerを呼び出し前後に行う必要がある共通的な処理のことを指す。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="servlet-filter">
<h4><a class="toc-backref" href="#id194" role="doc-backlink"><span class="section-number">3.4.4.1.1. </span>Servlet Filterの実装</a><a class="headerlink" href="#servlet-filter" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">Spring MVCに依存しない共通処理については、Servlet Filterで実装する。</div>
<div class="line">ただし、Controllerのハンドラメソッドにマッピングされるリクエストに対してのみ共通処理を行いたい場合は、Servlet FilterではなくHandlerInterceptorで実装すること。</div>
</div>
<div class="line-block">
<div class="line">以下に、Servlet Filterのサンプルを示す。</div>
<div class="line">サンプルコードでは、クライアントのIPアドレスをログ出力するために<code class="docutils literal notranslate"><span class="pre">MDC</span></code>に値を格納している。</div>
</div>
<ul>
<li><p>java</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ClientInfoPutFilter</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">OncePerRequestFilter</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (1)</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">ATTRIBUTE_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;X-Forwarded-For&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doFilterInternal</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span>
<span class="w">            </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">FilterChain</span><span class="w"> </span><span class="n">filterChain</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">remoteIp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getHeader</span><span class="p">(</span><span class="n">ATTRIBUTE_NAME</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">remoteIp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">remoteIp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getRemoteAddr</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">MDC</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ATTRIBUTE_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">remoteIp</span><span class="p">);</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">filterChain</span><span class="p">.</span><span class="na">doFilter</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">MDC</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">ATTRIBUTE_NAME</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>web.xml</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;filter&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter-name&gt;</span>clientInfoPutFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter-class&gt;</span>x.y.z.ClientInfoPutFilter<span class="nt">&lt;/filter-class&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;filter-mapping&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (3) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter-name&gt;</span>clientInfoPutFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">    </span><span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>サンプルではSpring Frameworkから提供されている<code class="docutils literal notranslate"><span class="pre">org.springframework.web.filter.OncePerRequestFilter</span></code>の子クラスとしてServlet Filterを作成することで、同一リクエスト内で1回だけ実行されることを保証している。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>作成したServlet Filterを<code class="docutils literal notranslate"><span class="pre">web.xml</span></code>に登録する。</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p>登録したServlet Filterを適用するURLのパターンを指定する。</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
<p>Servlet FilterをSpring FrameworkのBeanとして定義することもできる。</p>
<ul>
<li><p>web.xml</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;filter&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter-name&gt;</span>clientInfoPutFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="nt">&lt;/filter-class&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;filter-mapping&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter-name&gt;</span>clientInfoPutFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">    </span><span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">サンプルではSpring Frameworkから提供されている<code class="docutils literal notranslate"><span class="pre">org.springframework.web.filter.DelegatingFilterProxy</span></code>をServlet Filterのクラスに指定することで、(2)で定義したServlet Filterに処理が委譲される。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-10-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-10-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-10-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-10-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-10-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-10-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><ul>
<li><p>ApplicationContextConfig.java</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// (2)</span>
<span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;clientInfoPutFilter&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">ClientInfoPutFilter</span><span class="w"> </span><span class="nf">clientInfoPutFilter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ClientInfoPutFilter</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">作成したServlet FilterのクラスをBean定義ファイル(<code class="docutils literal notranslate"><span class="pre">ApplicationContextConfig.java</span></code>)に追加する。</div>
<div class="line">その際に、id属性には<code class="docutils literal notranslate"><span class="pre">web.xml</span></code>で指定したフィルター名(<code class="docutils literal notranslate"><span class="pre">&lt;filter-name&gt;</span></code>タグで指定した値)にすること。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div><div aria-labelledby="tab-10-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-10-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><ul>
<li><p>applicationContext.xml</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;clientInfoPutFilter&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;x.y.z.ClientInfoPutFilter&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (2) --&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">作成したServlet FilterのクラスをBean定義ファイル(<code class="docutils literal notranslate"><span class="pre">applicationContext.xml</span></code>)に追加する。</div>
<div class="line">その際に、id属性には<code class="docutils literal notranslate"><span class="pre">web.xml</span></code>で指定したフィルター名(<code class="docutils literal notranslate"><span class="pre">&lt;filter-name&gt;</span></code>タグで指定した値)にすること。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="handlerinterceptor">
<h4><a class="toc-backref" href="#id195" role="doc-backlink"><span class="section-number">3.4.4.1.2. </span>HandlerInterceptorの実装</a><a class="headerlink" href="#handlerinterceptor" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">Spring MVCに依存する共通処理については、 HandlerInterceptorで実装する。</div>
<div class="line">HandlerInterceptorは、リクエストにマッピングされたハンドラメソッドが決定した後に呼び出されるので、アプリケーションが許可しているリクエストに対してのみ共通処理を行うことができる。</div>
</div>
<p>HandlerInterceptorでは以下の3つのポイントで処理を実行することが出来る。</p>
<ul>
<li><div class="line-block">
<div class="line">Controllerのハンドラメソッドを実行する前</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">HandlerInterceptor#preHandle</span></code>メソッドとして実装する。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Controllerのハンドラメソッドが正常終了した後</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">HandlerInterceptor#postHandle</span></code>メソッドとして実装する。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Controllerのハンドラメソッドの処理が完了した後(正常/異常に関係なく実行される)</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">HandlerInterceptor#afterCompletion</span></code>メソッドとして実装する。</div>
</div>
</li>
</ul>
<div class="line-block">
<div class="line">以下に、HandlerInterceptorのサンプルを示す。</div>
<div class="line">サンプルコードでは、Controllerの処理が正常終了した後にinfoレベルのログを出力している。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SuccessLoggingInterceptor</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">HandlerInterceptor</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (1)</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span>
<span class="w">            </span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">SuccessLoggingInterceptor</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">postHandle</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span>
<span class="w">            </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">handler</span><span class="p">,</span>
<span class="w">            </span><span class="n">ModelAndView</span><span class="w"> </span><span class="n">modelAndView</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">HandlerMethod</span><span class="w"> </span><span class="n">handlerMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">HandlerMethod</span><span class="p">)</span><span class="w"> </span><span class="n">handler</span><span class="p">;</span>
<span class="w">        </span><span class="n">Method</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handlerMethod</span><span class="p">.</span><span class="na">getMethod</span><span class="p">();</span>
<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;[SUCCESS CONTROLLER] {}.{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">m</span><span class="p">.</span><span class="na">getDeclaringClass</span><span class="p">().</span><span class="na">getSimpleName</span><span class="p">(),</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="na">getName</span><span class="p">()});</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>サンプルではSpring Frameworkから提供されている<code class="docutils literal notranslate"><span class="pre">org.springframework.web.servlet.HandlerInterceptor</span></code>の実装クラスとしてHandlerInterceptorを作成している。</p></td>
</tr>
</tbody>
</table>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-11-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-11-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-11-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-11-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-11-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-11-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><ul>
<li><p>SpringMvcConfig.java</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@EnableAspectJAutoProxy</span>
<span class="nd">@EnableWebMvc</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SpringMvcConfig</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">WebMvcConfigurer</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// omitted</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addInterceptors</span><span class="p">(</span><span class="n">InterceptorRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">registry</span>
<span class="w">            </span><span class="p">.</span><span class="na">addInterceptor</span><span class="p">(</span><span class="n">successLoggingInterceptor</span><span class="p">())</span><span class="w"> </span><span class="c1">// (4)</span>
<span class="w">            </span><span class="p">.</span><span class="na">addPathPatterns</span><span class="p">(</span><span class="s">&quot;/**&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">            </span><span class="p">.</span><span class="na">excludePathPatterns</span><span class="p">(</span><span class="s">&quot;/resources/**&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// (3)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// (4)</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">SuccessLoggingInterceptor</span><span class="w"> </span><span class="nf">successLoggingInterceptor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SuccessLoggingInterceptor</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>作成したHandlerInterceptorを適用するパスのパターンを指定する。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p>作成したHandlerInterceptorを適用しないパスのパターンを指定する。</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><p>作成したHandlerInterceptorを<code class="docutils literal notranslate"><span class="pre">InterceptorRegistry</span></code>に追加する。</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div><div aria-labelledby="tab-11-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-11-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><ul>
<li><p>spring-mvc.xml</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;mvc:interceptors&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- omitted --&gt;</span>
<span class="w">    </span><span class="nt">&lt;mvc:interceptor&gt;</span>
<span class="w">        </span><span class="nt">&lt;mvc:mapping</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;/**&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">        </span><span class="nt">&lt;mvc:exclude-mapping</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;/resources/**&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (3) --&gt;</span>
<span class="w">        </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;x.y.z.SuccessLoggingInterceptor&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (4) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;/mvc:interceptor&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/mvc:interceptors&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>作成したHandlerInterceptorを適用するパスのパターンを指定する。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p>作成したHandlerInterceptorを適用しないパスのパターンを指定する。</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><p>作成したHandlerInterceptorを<code class="docutils literal notranslate"><span class="pre">spring-mvc.xml</span></code>の<code class="docutils literal notranslate"><span class="pre">&lt;mvc:interceptors&gt;</span></code>タグ内に追加する。</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></div>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>非同期リクエストを処理する<code class="docutils literal notranslate"><span class="pre">org.springframework.web.servlet.AsyncHandlerInterceptor</span></code>も提供されている。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>HandlerInterceptorのパス指定においてはワイルドカード（<code class="docutils literal notranslate"><span class="pre">*</span></code>や<code class="docutils literal notranslate"><span class="pre">**</span></code>）を使用することができる。このうち<code class="docutils literal notranslate"><span class="pre">**</span></code>はSpring Framework 5.3.0よりパスの最後にしか使用できなくなった。最後以外に使用した場合は起動時やアクセス時にエラーとなる。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="id91">
<h3><a class="toc-backref" href="#id196" role="doc-backlink"><span class="section-number">3.4.4.2. </span>Controllerの共通処理の実装</a><a class="headerlink" href="#id91" title="Permalink to this heading">¶</a></h3>
<p>ここでいう共通処理とは、すべてのControllerで共通的に実装する必要がある処理のことを指す。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="handlermethodargumentresolver">
<span id="methodargumentresolver"></span><h4><a class="toc-backref" href="#id197" role="doc-backlink"><span class="section-number">3.4.4.2.1. </span>HandlerMethodArgumentResolverの実装</a><a class="headerlink" href="#handlermethodargumentresolver" title="Permalink to this heading">¶</a></h4>
<p>Spring FrameworkのデフォルトでサポートされていないオブジェクトをControllerの引数として渡したい場合は、HandlerMethodArgumentResolverを実装してControllerの引数として受け取れるようにする。</p>
<div class="line-block">
<div class="line">以下に、HandlerMethodArgumentResolverのサンプルを示す。</div>
<div class="line">サンプルコードでは、 共通的なリクエストパラメータをJavaBeanに変換してControllerのメソッドで受け取れるようにしている。</div>
</div>
<ul>
<li><p>JavaBean</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CommonParameters</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (1)</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">param1</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">param2</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">param3</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// omitted</span>

<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>HandlerMethodArgumentResolver</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CommonParametersMethodArgumentResolver</span><span class="w"> </span><span class="kd">implements</span>
<span class="w">                                                   </span><span class="n">HandlerMethodArgumentResolver</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (2)</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">supportsParameter</span><span class="p">(</span><span class="n">MethodParameter</span><span class="w"> </span><span class="n">parameter</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">CommonParameters</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">parameter</span><span class="p">.</span><span class="na">getParameterType</span><span class="p">());</span><span class="w"> </span><span class="c1">// (3)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">resolveArgument</span><span class="p">(</span><span class="n">MethodParameter</span><span class="w"> </span><span class="n">parameter</span><span class="p">,</span>
<span class="w">            </span><span class="n">ModelAndViewContainer</span><span class="w"> </span><span class="n">mavContainer</span><span class="p">,</span><span class="w"> </span><span class="n">NativeWebRequest</span><span class="w"> </span><span class="n">webRequest</span><span class="p">,</span>
<span class="w">            </span><span class="n">WebDataBinderFactory</span><span class="w"> </span><span class="n">binderFactory</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">CommonParameters</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CommonParameters</span><span class="p">();</span><span class="w"> </span><span class="c1">// (4)</span>
<span class="w">        </span><span class="n">params</span><span class="p">.</span><span class="na">setParam1</span><span class="p">(</span><span class="n">webRequest</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;param1&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">params</span><span class="p">.</span><span class="na">setParam2</span><span class="p">(</span><span class="n">webRequest</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;param2&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">params</span><span class="p">.</span><span class="na">setParam3</span><span class="p">(</span><span class="n">webRequest</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;param3&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">params</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Controller</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;home&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">home</span><span class="p">(</span><span class="n">CommonParameters</span><span class="w"> </span><span class="n">commonParams</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (5)</span>
<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;param1 : {}&quot;</span><span class="p">,</span><span class="n">commonParams</span><span class="p">.</span><span class="na">getParam1</span><span class="p">());</span>
<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;param2 : {}&quot;</span><span class="p">,</span><span class="n">commonParams</span><span class="p">.</span><span class="na">getParam2</span><span class="p">());</span>
<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;param3 : {}&quot;</span><span class="p">,</span><span class="n">commonParams</span><span class="p">.</span><span class="na">getParam3</span><span class="p">());</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/home&quot;</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">共通パラメータを保持するJavaBean。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">org.springframework.web.method.support.HandlerMethodArgumentResolver</span></code>インタフェースを実装する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">処理対象とする型を判定する。例では、共通パラメータを保持するJavaBeanの型がControllerの引数として指定されていた場合に、このクラスのresolveArgumentメソッドが呼び出される。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">リクエストパラメータから値を取得し、共通パラメータを保持するJavaBeanに設定し返却する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Controllerのハンドラメソッドの引数に共通パラメータを保持するJavaBeanを指定する。</div>
<div class="line">(4)で返却されるオブジェクトが渡される。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-12-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-12-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-12-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-12-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-12-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-12-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><ul>
<li><p>SpringMvcConfig.java</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@EnableAspectJAutoProxy</span>
<span class="nd">@EnableWebMvc</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SpringMvcConfig</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">WebMvcConfigurer</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// omitted</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addArgumentResolvers</span><span class="p">(</span>
<span class="w">            </span><span class="n">List</span><span class="o">&lt;</span><span class="n">HandlerMethodArgumentResolver</span><span class="o">&gt;</span><span class="w"> </span><span class="n">argumentResolvers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">argumentResolvers</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">commonParametersMethodArgumentResolver</span><span class="p">());</span><span class="w"> </span><span class="c1">// (6)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// (6)</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CommonParametersMethodArgumentResolver</span><span class="w"> </span><span class="nf">commonParametersMethodArgumentResolver</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CommonParametersMethodArgumentResolver</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><p>作成したHandlerMethodArgumentResolverを<code class="docutils literal notranslate"><span class="pre">List&lt;HandlerMethodArgumentResolver&gt;</span></code>に追加する。</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div><div aria-labelledby="tab-12-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-12-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><ul>
<li><p>spring-mvc.xml</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;mvc:annotation-driven&gt;</span>
<span class="w">    </span><span class="nt">&lt;mvc:argument-resolvers&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- omitted --&gt;</span>
<span class="w">        </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;x.y.z.CommonParametersMethodArgumentResolver&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (6) --&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- omitted --&gt;</span>
<span class="w">    </span><span class="nt">&lt;/mvc:argument-resolvers&gt;</span>
<span class="nt">&lt;/mvc:annotation-driven&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><p>作成したHandlerMethodArgumentResolverを<code class="docutils literal notranslate"><span class="pre">spring-mvc.xml</span></code>の<code class="docutils literal notranslate"><span class="pre">&lt;mvc:argument-resolvers&gt;</span></code>タグ内に追加する。</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>全てのControllerのハンドラメソッドで共通的に渡すパラメータがある場合は、HandlerMethodArgumentResolverを使ってJavaBeanに変換してから渡す方法が有効的である。ここでいうパラメータとは、リクエストパラメータに限らない。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="controlleradvice">
<span id="application-layer-controller-advice"></span><h4><a class="toc-backref" href="#id198" role="doc-backlink"><span class="section-number">3.4.4.2.2. </span><code class="docutils literal notranslate"><span class="pre">&#64;ControllerAdvice</span></code>の実装</a><a class="headerlink" href="#controlleradvice" title="Permalink to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">&#64;ControllerAdvice</span></code>アノテーションを付与したクラスでは、複数のControllerで実行したい共通的な処理を実装する。</p>
<p><code class="docutils literal notranslate"><span class="pre">&#64;ControllerAdvice</span></code>アノテーションを付与したクラスを作成すると、</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;InitBinder</span></code>を付与したメソッド</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;ExceptionHandler</span></code>を付与したメソッド</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;ModelAttribute</span></code>を付与したメソッド</p></li>
</ul>
<p>で実装した処理を、複数のControllerに適用する事ができる。</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><code class="docutils literal notranslate"><span class="pre">&#64;ControllerAdvice</span></code>アノテーションは、Spring Framework 3.2 から追加された仕組みだが、全てのControllerに処理が適用される仕組みになっていたため、アプリケーション全体の共通処理しか実装できなかった。</p>
<p>Spring Framework 4.0 からは、共通処理を適用するControllerを柔軟に指定する事ができるように改善されている。</p>
<p>この改善により、様々な粒度で共通処理を実装する事ができるようになった。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p id="application-layer-controller-advice-attribute">以下に、共通処理を適用するControllerを指定する方法(属性の指定方法)について説明する。</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 15.0%" />
<col style="width: 75.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>属性</p></th>
<th class="head"><p>説明と指定例</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">annotations</span></code></p></td>
<td><p>アノテーションを指定する。</p>
<div class="line-block">
<div class="line">指定したアノテーションが付与されたControllerに対して共通処理が適用される。</div>
<div class="line">以下に指定例を示す。</div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@ControllerAdvice</span><span class="p">(</span><span class="n">annotations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoginFormModelAttributeSetter</span><span class="p">.</span><span class="na">LoginFormModelAttribute</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">LoginFormModelAttributeSetter</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Target</span><span class="p">(</span><span class="n">TYPE</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Retention</span><span class="p">(</span><span class="n">RUNTIME</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="nd">@interface</span><span class="w"> </span><span class="n">LoginFormModelAttribute</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@LoginFormModelAttribute</span>
<span class="nd">@Controller</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WelcomeController</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@LoginFormModelAttribute</span>
<span class="nd">@Controller</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">LoginController</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上記例では、<code class="docutils literal notranslate"><span class="pre">WelcomeController</span></code>と<code class="docutils literal notranslate"><span class="pre">LoginController</span></code>に<code class="docutils literal notranslate"><span class="pre">&#64;LoginFormModelAttribute</span></code>アノテーションを付与しているため、<code class="docutils literal notranslate"><span class="pre">WelcomeController</span></code>と<code class="docutils literal notranslate"><span class="pre">LoginController</span></code>に共通処理が適用される。</p>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">assignableTypes</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">クラス又はインタフェースを指定する。</div>
<div class="line"><br /></div>
<div class="line">指定したクラス又はインタフェースに割り当て可能(キャスト可能)なControllerに対して共通処理が適用される。</div>
<div class="line">本属性を使用する場合は、共通処理を適用するControllerであることを示すためのマーカーインタフェースを属性値に指定するスタイルを採用することを推奨する。</div>
<div class="line">このスタイルを採用した場合、Controller側では、適用したい共通処理用のマーカーインタフェースを実装するだけでよい。</div>
<div class="line">以下の指定例を示す。</div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@ControllerAdvice</span><span class="p">(</span><span class="n">assignableTypes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ISODateInitBinder</span><span class="p">.</span><span class="na">ISODateApplicable</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ISODateInitBinder</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ISODateApplicable</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SampleController</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ISODateApplicable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上記例では、<code class="docutils literal notranslate"><span class="pre">SampleController</span></code>が<code class="docutils literal notranslate"><span class="pre">&#64;ISODateApplicable</span></code>インタフェース(マーカーインタフェース)を実装しているため、<code class="docutils literal notranslate"><span class="pre">SampleController</span></code>に共通処理が適用される。</p>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">basePackageClasses</span></code></p></td>
<td><p>クラス又はインタフェースを指定する。</p>
<p>指定したクラス又はインタフェースのパッケージ配下のControllerに対して共通処理が適用される。</p>
<p>本属性を使用する場合は、</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;ControllerAdvice</span></code>を付与したクラス</p></li>
<li><p>パッケージを識別するためのマーカーインタフェース</p></li>
</ul>
<div class="line-block">
<div class="line">を属性値に指定するスタイルを採用することを推奨する。</div>
<div class="line">以下に指定例を示す。</div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.app</span>

<span class="nd">@ControllerAdvice</span><span class="p">(</span><span class="n">basePackageClasses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AppGlobalExceptionHandler</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AppGlobalExceptionHandler</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.app.sample</span>

<span class="nd">@Controller</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SampleController</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上記例では、<code class="docutils literal notranslate"><span class="pre">SampleController</span></code>が<code class="docutils literal notranslate"><span class="pre">&#64;ControllerAdvice</span></code>を付与したクラス(<code class="docutils literal notranslate"><span class="pre">AppGlobalExceptionHandler</span></code>)が格納されているパッケージ(<code class="docutils literal notranslate"><span class="pre">com.example.app</span></code>)配下に格納されているため、<code class="docutils literal notranslate"><span class="pre">SampleController</span></code>に共通処理が適用される。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.app.common</span>

<span class="nd">@ControllerAdvice</span><span class="p">(</span><span class="n">basePackageClasses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AppPackage</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AppGlobalExceptionHandler</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.app</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">AppPackage</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&#64;ControllerAdvice</span></code>が付与されているクラスとControllerが格納されているクラスのパッケージ階層が異なる場合や、複数のベースパッケージに共通処理を適用したい場合は、パッケージを識別するためのマーカインタフェースを用意すればよい。</p>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">basePackages</span></code></p></td>
<td><p>パッケージ名を指定する。</p>
<div class="line-block">
<div class="line">指定したパッケージ配下のControllerに対して共通処理が適用される。</div>
<div class="line">以下に指定例を示す。</div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@ControllerAdvice</span><span class="p">(</span><span class="n">basePackages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;com.example.app&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AppGlobalExceptionHandler</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">value</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">basePackages</span></code>へのエイリアス。</p>
<p><code class="docutils literal notranslate"><span class="pre">basePackages</span></code>属性を指定した際と同じ動作となる。
以下に指定例を示す。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@ControllerAdvice</span><span class="p">(</span><span class="s">&quot;com.example.app&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AppGlobalExceptionHandler</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><code class="docutils literal notranslate"><span class="pre">basePackageClasses</span></code>属性 / <code class="docutils literal notranslate"><span class="pre">basePackages</span></code>属性 / <code class="docutils literal notranslate"><span class="pre">value</span></code>属性は、共通処理を適用したいControllerが格納されているベースパッケージを指定するための属性であるが、<code class="docutils literal notranslate"><span class="pre">basePackageClasses</span></code>属性を使用した場合、</p>
<ul class="simple">
<li><p>存在しないパッケージを指定してしまう事を防ぐことが出来る</p></li>
<li><p>IDE上で行ったパッケージ名変更と連動することが出来る</p></li>
</ul>
<p>ため、タイプセーフな指定方法と言える。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">以下に、<code class="docutils literal notranslate"><span class="pre">&#64;InitBinder</span></code>メソッドの実装サンプルを示す。</div>
<div class="line">サンプルコードでは、 リクエストパラメータで指定できる日付型で形式を<code class="docutils literal notranslate"><span class="pre">yyyy/MM/dd</span></code>に設定している。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@ControllerAdvice</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="nd">@Order</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SampleControllerAdvice</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// (3)</span>
<span class="w">    </span><span class="nd">@InitBinder</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initBinder</span><span class="p">(</span><span class="n">WebDataBinder</span><span class="w"> </span><span class="n">binder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SimpleDateFormat</span><span class="w"> </span><span class="n">dateFormat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleDateFormat</span><span class="p">(</span><span class="s">&quot;yyyy/MM/dd&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">dateFormat</span><span class="p">.</span><span class="na">setLenient</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">        </span><span class="n">binder</span><span class="p">.</span><span class="na">registerCustomEditor</span><span class="p">(</span><span class="n">Date</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
<span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">CustomDateEditor</span><span class="p">(</span><span class="n">dateFormat</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&#64;ControllerAdvice</span></code>アノテーションを付与することで、ControllerAdviceのBeanであることを示している。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&#64;Order</span></code>アノテーションを付与することで、共通処理が適用される優先度を指定する。複数のControllerAdviceに依存関係があるなど、ControllerAdviceに順序性を持たせたい場合は必ず指定すること。順序性を持たせる必要がなければ指定しなくてもよい。</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&#64;InitBinder</span></code>メソッドを実装する。全てのControllerに対して<code class="docutils literal notranslate"><span class="pre">&#64;InitBinder</span></code>メソッドが適用される。</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">以下に、<code class="docutils literal notranslate"><span class="pre">&#64;ExceptionHandler</span></code>メソッドの実装サンプルを示す。</div>
<div class="line">サンプルコードでは、<code class="docutils literal notranslate"><span class="pre">org.springframework.dao.PessimisticLockingFailureException</span></code>をハンドリングしてロックエラー画面のViewを返却している。</div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// (1)</span>
<span class="nd">@ExceptionHandler</span><span class="p">(</span><span class="n">PessimisticLockingFailureException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">handlePessimisticLockingFailureException</span><span class="p">(</span>
<span class="w">        </span><span class="n">PessimisticLockingFailureException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;error/lockError&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&#64;ExceptionHandler</span></code>メソッドを実装する。全てのControllerに対して<code class="docutils literal notranslate"><span class="pre">&#64;ExceptionHandler</span></code>メソッドが適用される。</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">以下に、<code class="docutils literal notranslate"><span class="pre">&#64;ModelAttribute</span></code>メソッドの実装サンプルを示す。</div>
<div class="line">サンプルコードでは、 共通的なリクエストパラメータをJavaBeanに変換して<code class="docutils literal notranslate"><span class="pre">Model</span></code>に格納している。</div>
</div>
<ul>
<li><p>ControllerAdvice</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// (1)</span>
<span class="nd">@ModelAttribute</span>
<span class="kd">public</span><span class="w"> </span><span class="n">CommonParameters</span><span class="w"> </span><span class="nf">setUpCommonParameters</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;param1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">defaultValue</span><span class="o">=</span><span class="s">&quot;def1&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">param1</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;param2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">defaultValue</span><span class="o">=</span><span class="s">&quot;def2&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">param2</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;param3&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">defaultValue</span><span class="o">=</span><span class="s">&quot;def3&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">param3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">CommonParameters</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CommonParameters</span><span class="p">();</span>
<span class="w">    </span><span class="n">params</span><span class="p">.</span><span class="na">setParam1</span><span class="p">(</span><span class="n">param1</span><span class="p">);</span>
<span class="w">    </span><span class="n">params</span><span class="p">.</span><span class="na">setParam2</span><span class="p">(</span><span class="n">param2</span><span class="p">);</span>
<span class="w">    </span><span class="n">params</span><span class="p">.</span><span class="na">setParam3</span><span class="p">(</span><span class="n">param3</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">params</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Controller</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;home&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">home</span><span class="p">(</span><span class="nd">@ModelAttribute</span><span class="w"> </span><span class="n">CommonParameters</span><span class="w"> </span><span class="n">commonParams</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;param1 : {}&quot;</span><span class="p">,</span><span class="n">commonParams</span><span class="p">.</span><span class="na">getParam1</span><span class="p">());</span>
<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;param2 : {}&quot;</span><span class="p">,</span><span class="n">commonParams</span><span class="p">.</span><span class="na">getParam2</span><span class="p">());</span>
<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;param3 : {}&quot;</span><span class="p">,</span><span class="n">commonParams</span><span class="p">.</span><span class="na">getParam3</span><span class="p">());</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/home&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&#64;ModelAttribute</span></code>メソッドを実装する。全てのControllerに対して<code class="docutils literal notranslate"><span class="pre">&#64;ModelAttribute</span></code>メソッドが適用される。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&#64;ModelAttribute</span></code>メソッドで生成されたオブジェクトが渡る。</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
</section>
<section id="id92">
<h2><a class="toc-backref" href="#id199" role="doc-backlink"><span class="section-number">3.4.5. </span>二重送信防止について</a><a class="headerlink" href="#id92" title="Permalink to this heading">¶</a></h2>
<p>送信ボタンの複数回押下や完了画面の再読み込み(F5ボタンによる再読み込み)などで、 同じ処理が複数回実行されてしまう可能性があるため、二重送信を防止するための対策は必ず行うこと。</p>
<p>対策を行わない場合に発生する問題点や対策方法の詳細は、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/DoubleSubmitProtection.html"><span class="doc">二重送信防止</span></a>を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id93">
<h2><a class="toc-backref" href="#id200" role="doc-backlink"><span class="section-number">3.4.6. </span>セッションの使用について</a><a class="headerlink" href="#id93" title="Permalink to this heading">¶</a></h2>
<div class="line-block">
<div class="line">Spring MVCのデフォルトの動作では、モデル（フォームオブジェクトやドメインオブジェクトなど）はセッションには格納されない。</div>
<div class="line">セッションに格納したい場合は、<code class="docutils literal notranslate"><span class="pre">&#64;SessionAttributes</span></code>アノテーションをControllerクラスに付与する必要がある。</div>
<div class="line">入力フォームが複数の画面にわかれている場合は、 一連の画面遷移を行うリクエストでモデル（フォームオブジェクトやドメインオブジェクトなど）を共有できるため、 <code class="docutils literal notranslate"><span class="pre">&#64;SessionAttributes</span></code>アノテーションの利用を検討すること。</div>
<div class="line">ただし、セッションを使用する際の注意点があるので、そちらを確認した上で<code class="docutils literal notranslate"><span class="pre">&#64;SessionAttributes</span></code>アノテーションの利用有無を判断すること。</div>
</div>
<p>セッションの利用指針及びセッション使用時の実装方法の詳細は、<a class="reference internal" href="../ArchitectureInDetail/WebApplicationDetail/SessionManagement.html"><span class="doc">セッション管理</span></a>を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="appendix">
<h2><a class="toc-backref" href="#id201" role="doc-backlink"><span class="section-number">3.4.7. </span>Appendix</a><a class="headerlink" href="#appendix" title="Permalink to this heading">¶</a></h2>
<section id="value">
<span id="omission-of-value-attribute"></span><h3><a class="toc-backref" href="#id202" role="doc-backlink"><span class="section-number">3.4.7.1. </span>引数に付与するアノテーションのvalue属性の省略</a><a class="headerlink" href="#value" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line"><a class="reference internal" href="#controller-method-argument-label"><span class="std std-ref">ハンドラメソッドの引数について</span></a>にて紹介した<code class="docutils literal notranslate"><span class="pre">&#64;PathVariable</span></code>アノテーションと<code class="docutils literal notranslate"><span class="pre">&#64;RequestParam</span></code>アノテーションのvalue属性は省略可能である。</div>
<div class="line">ただしこの方法は、</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-g</span></code>オプション(デバッグ情報を出力するモード)</p></li>
<li><p>Java8から追加された<code class="docutils literal notranslate"><span class="pre">-parameters</span></code>オプション(メソッド・パラメータにリフレクション用のメタデータを生成するモード)</p></li>
</ul>
<div class="line-block">
<div class="line">のどちらかを指定してコンパイルする必要がある。</div>
<div class="line">ブランクプロジェクトから作成したプロジェクトの場合、デフォルトで<code class="docutils literal notranslate"><span class="pre">-parameters</span></code>を設定している。</div>
<div class="line">詳しくは<a class="reference internal" href="CreateWebApplicationProject.html#createwebapplicationprojectmavencompilerplugin"><span class="std std-ref">maven-compiler-plugin</span></a>を参照されたい。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;hello/{id}/{version}&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">        </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// do something</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// returns view name</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;PathVariable</span></code>アノテーションのvalue属性は省略可能で、省略した場合は引数名がリクエストパラメータ名となる。</div>
<div class="line">上記例では、<code class="docutils literal notranslate"><span class="pre">sample/hello/aaaa/1</span></code>というURLにアクセスした場合、引数versionに数値”<code class="docutils literal notranslate"><span class="pre">1</span></code>“が渡る。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;bindRequestParams&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">bindRequestParams</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@RequestParam</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">        </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// do something</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// returns view name</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;RequestParam</span></code>アノテーションのvalue属性は省略可能で、省略した場合は引数名がリクエストパラメータ名となる。</div>
<div class="line">上記例では、<code class="docutils literal notranslate"><span class="pre">sample/hello?name=bbbb&amp;....</span></code>というURLにアクセスした場合、引数nameに文字列<code class="docutils literal notranslate"><span class="pre">bbbb</span></code>が渡る。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="spring-mvc">
<span id="applicationlayer-expansion-of-path-pattern-match"></span><h3><a class="toc-backref" href="#id203" role="doc-backlink"><span class="section-number">3.4.7.2. </span>Spring MVCのパスパターンマッチングにおける拡張子および末尾<code class="docutils literal notranslate"><span class="pre">/</span></code>の考慮</a><a class="headerlink" href="#spring-mvc" title="Permalink to this heading">¶</a></h3>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>当節で説明しているSuffix MatchやTrailing Slashの使用は、Spring MVCでは<a class="reference external" href="https://github.com/spring-projects/spring-framework/blob/v6.1.3/spring-webmvc/src/main/resources/org/springframework/web/servlet/config/spring-mvc.xsd#L63-L76">registered-suffixes-only</a>や<a class="reference external" href="https://github.com/spring-projects/spring-framework/blob/v6.1.3/spring-webmvc/src/main/resources/org/springframework/web/servlet/config/spring-mvc.xsd#L52-L58">trailing-slash</a>に記載されている通り非推奨となっており、パスマッチングのデフォルト設定を変更する方法(<code class="docutils literal notranslate"><span class="pre">registered-suffixes-only</span></code>や<code class="docutils literal notranslate"><span class="pre">trailing-slash</span></code>)はいずれ削除される可能性がある。</p>
<p>Suffix MatchやTrailing Slashは、業務要件等によりやむなく使用する場合を除き可能な限り使用を避けたほうが良い。</p>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">mvc:annotation-driven</span></code>の<code class="docutils literal notranslate"><span class="pre">mvc:path-matching</span></code>に属性を設定する、またはハンドラメソッドで拡張子や末尾”<code class="docutils literal notranslate"><span class="pre">/</span></code>“を<code class="docutils literal notranslate"><span class="pre">&#64;RequestMapping</span></code>の<code class="docutils literal notranslate"><span class="pre">value</span></code>に明記することでリクエストの末尾に拡張子や”<code class="docutils literal notranslate"><span class="pre">/</span></code>“が設定されていてもマッピングが可能となる。なお、これらのパターンを用いる場合、認可処理の<code class="docutils literal notranslate"><span class="pre">url-pattern</span></code>も考慮する必要がある。</div>
</div>
<div class="line-block">
<div class="line">詳細は、<a class="reference internal" href="../Security/Authorization.html#authoziation-expansion-of-path-pattern-match"><span class="std std-ref">Spring Securityのパスパターンマッチングにおける拡張子および末尾/の考慮</span></a>を参照されたい。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="suffix-match">
<h4><a class="toc-backref" href="#id204" role="doc-backlink"><span class="section-number">3.4.7.2.1. </span>Suffix Match</a><a class="headerlink" href="#suffix-match" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">Spring MVCのデフォルト設定では、サフィックスパターンは無効となっている。</div>
<div class="line">業務要件等によりやむなくサフィックスパターンマッチングを使う必要がある場合は、以下の方法でサフィックスパターンを有効にすることができる。</div>
<div class="line">ここでは、<a class="reference external" href="https://docs.spring.io/spring-framework/docs/6.1.3/reference/html/web.html#mvc-ann-requestmapping-suffix-pattern-match">Spring Framework Documentation -Suffix Match-</a>に記載されている通り、登録された特定の拡張子のみを有効にする方法を記載している。</div>
</div>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-13-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-13-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-13-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-13-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-13-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-13-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">WebMvcConfigurer#configurePathMatch</span></code>をOverrideし、<code class="docutils literal notranslate"><span class="pre">RegisteredSuffixPatternMatch</span></code>を有効にする（全体）</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@EnableAspectJAutoProxy</span>
<span class="nd">@EnableWebMvc</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SpringMvcConfig</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">WebMvcConfigurer</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configurePathMatch</span><span class="p">(</span><span class="n">PathMatchConfigurer</span><span class="w"> </span><span class="n">configurer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">configurer</span><span class="p">.</span><span class="na">setUseRegisteredSuffixPatternMatch</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configureContentNegotiation</span><span class="p">(</span><span class="n">ContentNegotiationConfigurer</span><span class="w"> </span><span class="n">configurer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">MediaType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LinkedHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;xml&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_RSS_XML</span><span class="p">);</span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">);</span>
<span class="w">        </span><span class="n">configurer</span><span class="p">.</span><span class="na">mediaTypes</span><span class="p">(</span><span class="n">map</span><span class="p">);</span><span class="w"> </span><span class="c1">// (3)</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Spring MVCがコンテンツネゴシエーションの際に使用する、<code class="docutils literal notranslate"><span class="pre">ContentNegotiationManager</span></code>を設定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">UseRegisteredSuffixPatternMatch</span></code>を<code class="docutils literal notranslate"><span class="pre">true</span></code>に設定し、(3)で登録した拡張子のみをサフィックスパターンとして有効にする。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">コンテンツネゴシエーションの際に<code class="docutils literal notranslate"><span class="pre">ContentNegotiationManager</span></code>で許可する拡張子と、レスポンス時の<code class="docutils literal notranslate"><span class="pre">Content-Type</span></code>のペアを指定する。この例ではXMLとJSONを許可している。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div><div aria-labelledby="tab-13-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-13-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">mvc:annotation-driven</span></code>の設定で<code class="docutils literal notranslate"><span class="pre">mvc:path-matching</span></code>の<code class="docutils literal notranslate"><span class="pre">registered-suffixes-only</span></code>を有効にする（全体）</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;mvc:annotation-driven</span><span class="w"> </span><span class="na">content-negotiation-manager=</span><span class="s">&quot;contentNegotiationManager&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- ommitted --&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;mvc:path-matching</span><span class="w"> </span><span class="na">registered-suffixes-only=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/mvc:annotation-driven&gt;</span>

<span class="cm">&lt;!-- (3) --&gt;</span>
<span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;contentNegotiationManager&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.springframework.web.accept.ContentNegotiationManagerFactoryBean&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;mediaTypes&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;value&gt;</span>
<span class="w">            </span>xml=application/rss+xml
<span class="w">            </span>json=application/json
<span class="w">        </span><span class="nt">&lt;/value&gt;</span>
<span class="w">    </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Spring MVCがコンテンツネゴシエーションの際に使用する、<code class="docutils literal notranslate"><span class="pre">ContentNegotiationManager</span></code>のBean名を指定する</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">registered-suffixes-only</span></code>を<code class="docutils literal notranslate"><span class="pre">true</span></code>に設定し、(3)で登録した拡張子のみをサフィックスパターンとして有効にする。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">コンテンツネゴシエーションの際に<code class="docutils literal notranslate"><span class="pre">ContentNegotiationManager</span></code>で許可する拡張子と、レスポンス時の<code class="docutils literal notranslate"><span class="pre">Content-Type</span></code>のペアを指定する。この例ではXMLとJSONを許可している。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>サフィックスパターンが有効な場合、パス変数には拡張子は含まれない。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;hello/{id}/{version}&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&quot;version&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">version</span><span class="p">,</span>
<span class="w">        </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>上記のようなハンドラメソッドに<code class="docutils literal notranslate"><span class="pre">helllo/001/1.json</span></code>のようなパスでアクセスすると</p>
<ul class="simple">
<li><p>サフィックスパターンが有効な場合、<code class="docutils literal notranslate"><span class="pre">{verson}</span></code>は”<code class="docutils literal notranslate"><span class="pre">1</span></code>“となる。</p></li>
<li><p>サフィックスパターンが無効な場合、<code class="docutils literal notranslate"><span class="pre">{verson}</span></code>は”<code class="docutils literal notranslate"><span class="pre">1.json</span></code>“となり、<code class="docutils literal notranslate"><span class="pre">java.lang.NumberFormatException</span></code>が発生する。</p></li>
</ul>
<p>また、<code class="docutils literal notranslate"><span class="pre">registered-suffixes-only=&quot;true&quot;</span></code>であっても、登録されていない拡張子に対してアクセスした場合はサフィックスパターンが無効な場合と同様な挙動となる。</p>
</div>
<ul>
<li><p>ハンドラメソッドで拡張子無しと有りの両方のパスにマッピングする（個別）</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// (1)</span>
<span class="nd">@GetMapping</span><span class="p">({</span><span class="w"> </span><span class="s">&quot;hello/{id}/{version}&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hello/{id}/{version}.json&quot;</span><span class="w"> </span><span class="p">})</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&quot;version&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">version</span><span class="p">,</span>
<span class="w">        </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ハンドラメソッドの<code class="docutils literal notranslate"><span class="pre">path</span></code>に拡張子を含んだパスを設定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id94">
<h4><a class="toc-backref" href="#id205" role="doc-backlink"><span class="section-number">3.4.7.2.2. </span>Trailing Slash</a><a class="headerlink" href="#id94" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">Spring MVCのデフォルト設定では、パスマッピングとして明示的に末尾に”<code class="docutils literal notranslate"><span class="pre">/</span></code>“をつけていない限り、末尾に”<code class="docutils literal notranslate"><span class="pre">/</span></code>“をつけてのアクセスは出来ないように設定されている。</div>
<div class="line">業務要件等によりやむなく末尾に”<code class="docutils literal notranslate"><span class="pre">/</span></code>“を付けたリクエストパスを末尾に”<code class="docutils literal notranslate"><span class="pre">/</span></code>“無しのパスパターンに一致させたい場合(末尾の”<code class="docutils literal notranslate"><span class="pre">/</span></code>“を区別しない場合)は、以下の方法で一致させることが出来る。</div>
</div>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-14-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-14-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-14-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-14-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-14-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-14-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">WebMvcConfigurer#configurePathMatch</span></code>をOverrideし、<code class="docutils literal notranslate"><span class="pre">UseTrailingSlashMatch</span></code>を有効にする（アプリケーション全体で、末尾の”<code class="docutils literal notranslate"><span class="pre">/</span></code>“を区別しない）</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@EnableAspectJAutoProxy</span>
<span class="nd">@EnableWebMvc</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SpringMvcConfig</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">WebMvcConfigurer</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configurePathMatch</span><span class="p">(</span><span class="n">PathMatchConfigurer</span><span class="w"> </span><span class="n">configurer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">configurer</span><span class="p">.</span><span class="na">setUseTrailingSlashMatch</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">UseTrailingSlashMatch</span></code>を<code class="docutils literal notranslate"><span class="pre">true</span></code>に設定し、末尾”<code class="docutils literal notranslate"><span class="pre">/</span></code>“を末尾”<code class="docutils literal notranslate"><span class="pre">/</span></code>“無しのパスに紐づけるようにする。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div><div aria-labelledby="tab-14-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-14-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">mvc:annotation-driven</span></code>の設定で<code class="docutils literal notranslate"><span class="pre">trailing-slash</span></code>を有効にする（アプリケーション全体で、末尾の”<code class="docutils literal notranslate"><span class="pre">/</span></code>“を区別しない）</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;mvc:annotation-driven&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- omitted --&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;mvc:path-matching</span><span class="w"> </span><span class="na">trailing-slash=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/mvc:annotation-driven&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">trailing-slash</span></code>を<code class="docutils literal notranslate"><span class="pre">true</span></code>に設定し、末尾”<code class="docutils literal notranslate"><span class="pre">/</span></code>“を末尾”<code class="docutils literal notranslate"><span class="pre">/</span></code>“無しのパスに紐づけるようにする。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></div>
<ul>
<li><p>ハンドラメソッドで末尾”<code class="docutils literal notranslate"><span class="pre">/</span></code>“無しと有りの両方のパスにマッピングする（ハンドラメソッドごとに末尾の”<code class="docutils literal notranslate"><span class="pre">/</span></code>“ を区別しない）</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// (1)</span>
<span class="nd">@GetMapping</span><span class="p">({</span><span class="w"> </span><span class="s">&quot;hello/{id}/{version}&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hello/{id}/{version}/&quot;</span><span class="w"> </span><span class="p">})</span>
<span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&quot;version&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">version</span><span class="p">,</span>
<span class="w">        </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;sample/hello&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ハンドラメソッドの<code class="docutils literal notranslate"><span class="pre">path</span></code>に末尾に”<code class="docutils literal notranslate"><span class="pre">/</span></code>“を含んだパスを設定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="CreateProject.html" title="3.5. 開発プロジェクトのビルド"
             >next</a> |</li>
        <li class="right" >
          <a href="InfrastructureLayer.html" title="3.3. インフラストラクチャ層の実装"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.9.0.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" ><span class="section-number">3. </span>アプリケーション開発</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">3.4. </span>アプリケーション層の実装</a></li> 
      </ul>
    </div>
    <div class="footer">
      © Copyright 2024, NTT DATA Group Corporation. © Copyright 2013, NTT Corporation.
      Created using <a href="https://www.sphinx-doc.org/en/master/">Sphinx</a> 7.0.1.Theme is <a href="https://pypi.org/project/solar-theme/">Solar</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    </script>
  </body>
</html>