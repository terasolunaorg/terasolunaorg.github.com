<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>4.1. Webアプリケーション向け開発プロジェクトの作成 &#8212; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.0.2.RELEASE documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/solar.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4.2. ドメイン層の実装" href="DomainLayer.html" />
    <link rel="prev" title="4. TERASOLUNA Server Framework for Java (5.x)によるアプリケーション開発" href="index.html" /><script async src="https://www.googletagmanager.com/gtag/js?id=G-847V2Q99G8"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date()); gtag('config', 'G-847V2Q99G8');
</script>
<script src="../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../_static/solarized-dark.css" rel="stylesheet">
<link href="../_static/jquery.treeview.css" rel="stylesheet">
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="DomainLayer.html" title="4.2. ドメイン層の実装"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="4. TERASOLUNA Server Framework for Java (5.x)によるアプリケーション開発"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.0.2.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U"><span class="section-number">4. </span>TERASOLUNA Server Framework for Java (5.x)によるアプリケーション開発</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">4.1. </span>Webアプリケーション向け開発プロジェクトの作成</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">4.1. Webアプリケーション向け開発プロジェクトの作成</a><ul>
<li><a class="reference internal" href="#id2">4.1.1. 開発プロジェクトの作成</a></li>
<li><a class="reference internal" href="#createwebapplicationprojectbuild">4.1.2. 開発プロジェクトのビルド</a><ul>
<li><a class="reference internal" href="#envjarwar">4.1.2.1. envモジュールのjarファイルをwarファイルに含めないビルド方法</a><ul>
<li><a class="reference internal" href="#war">4.1.2.1.1. warファイルの作成</a></li>
<li><a class="reference internal" href="#envjar">4.1.2.1.2. envモジュールのjarファイルの作成</a></li>
<li><a class="reference internal" href="#tomcat">4.1.2.1.3. Tomcatへのデプロイ</a></li>
<li><a class="reference internal" href="#createwebapplicationprojectbuildwarexcludeenvjarstepdeploytootherserver">4.1.2.1.4. Tomcat以外のアプリケーションサーバへのデプロイ</a></li>
</ul>
</li>
<li><a class="reference internal" href="#createwebapplicationprojectbuildwarincludeenvjar">4.1.2.2. envモジュールのjarファイルをwarファイルに含めるビルド方法</a><ul>
<li><a class="reference internal" href="#createwebapplicationprojectbuildwarincludeenvjarwar">4.1.2.2.1. warファイルの作成</a></li>
<li><a class="reference internal" href="#createwebapplicationprojectbuildwarincludeenvjardeploy">4.1.2.2.2. デプロイ</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#createwebapplicationprojectcustomize">4.1.3. 開発プロジェクトのカスタマイズ</a><ul>
<li><a class="reference internal" href="#pom">4.1.3.1. POMファイルのプロジェクト情報</a></li>
<li><a class="reference internal" href="#x-xx-fw-9999id">4.1.3.2. x.xx.fw.9999形式のメッセージID</a></li>
<li><a class="reference internal" href="#createwebapplicationprojectcustomizemessagewording">4.1.3.3. メッセージ文言</a></li>
<li><a class="reference internal" href="#createwebapplicationprojectcustomizeerrorscreen">4.1.3.4. エラー画面</a></li>
<li><a class="reference internal" href="#createwebapplicationprojectcustomizecopyrightonscreenfooter">4.1.3.5. 画面フッターの著作権</a></li>
<li><a class="reference internal" href="#h2-database">4.1.3.6. インメモリデータベース(H2 Database)</a></li>
<li><a class="reference internal" href="#createwebapplicationprojectcustomizedatasource">4.1.3.7. データソース設定</a></li>
</ul>
</li>
<li><a class="reference internal" href="#createwebapplicationprojectconfiguration">4.1.4. 開発プロジェクトの構成</a><ul>
<li><a class="reference internal" href="#createwebapplicationprojectconfigurationmulti">4.1.4.1. マルチプロジェクトの構成</a></li>
<li><a class="reference internal" href="#createwebapplicationprojectconfigurationweb">4.1.4.2. webモジュールの構成</a></li>
<li><a class="reference internal" href="#domain">4.1.4.3. domainモジュールの構成</a></li>
<li><a class="reference internal" href="#env">4.1.4.4. envモジュールの構成</a></li>
<li><a class="reference internal" href="#initdb">4.1.4.5. initdbモジュールの構成</a></li>
<li><a class="reference internal" href="#selenium">4.1.4.6. seleniumモジュールの構成</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendix">4.1.5. Appendix</a><ul>
<li><a class="reference internal" href="#createwebapplicationprojectappendixprojecthierarchicalstructure">4.1.5.1. プロジェクトの階層構造</a></li>
<li><a class="reference internal" href="#bean">4.1.5.2. アプリケーションコンテキストの構成とBean定義ファイルの関係</a></li>
<li><a class="reference internal" href="#createwebapplicationprojectappendixdescribeconfigurationfile">4.1.5.3. 設定ファイルの解説</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="index.html"
                          title="previous chapter"><span class="section-number">4. </span>TERASOLUNA Server Framework for Java (5.x)によるアプリケーション開発</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="DomainLayer.html"
                          title="next chapter"><span class="section-number">4.2. </span>ドメイン層の実装</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/ImplementationAtEachLayer/CreateWebApplicationProject.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="web">
<h1><span class="section-number">4.1. </span>Webアプリケーション向け開発プロジェクトの作成<a class="headerlink" href="#web" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="id1">
<p class="topic-title">目次</p>
<ul class="simple">
<li><p><a class="reference internal" href="#id2" id="id25">開発プロジェクトの作成</a></p></li>
<li><p><a class="reference internal" href="#createwebapplicationprojectbuild" id="id26">開発プロジェクトのビルド</a></p>
<ul>
<li><p><a class="reference internal" href="#envjarwar" id="id27">envモジュールのjarファイルをwarファイルに含めないビルド方法</a></p>
<ul>
<li><p><a class="reference internal" href="#war" id="id28">warファイルの作成</a></p></li>
<li><p><a class="reference internal" href="#envjar" id="id29">envモジュールのjarファイルの作成</a></p></li>
<li><p><a class="reference internal" href="#tomcat" id="id30">Tomcatへのデプロイ</a></p></li>
<li><p><a class="reference internal" href="#createwebapplicationprojectbuildwarexcludeenvjarstepdeploytootherserver" id="id31">Tomcat以外のアプリケーションサーバへのデプロイ</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#createwebapplicationprojectbuildwarincludeenvjar" id="id32">envモジュールのjarファイルをwarファイルに含めるビルド方法</a></p>
<ul>
<li><p><a class="reference internal" href="#createwebapplicationprojectbuildwarincludeenvjarwar" id="id33">warファイルの作成</a></p></li>
<li><p><a class="reference internal" href="#createwebapplicationprojectbuildwarincludeenvjardeploy" id="id34">デプロイ</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#createwebapplicationprojectcustomize" id="id35">開発プロジェクトのカスタマイズ</a></p>
<ul>
<li><p><a class="reference internal" href="#pom" id="id36">POMファイルのプロジェクト情報</a></p></li>
<li><p><a class="reference internal" href="#x-xx-fw-9999id" id="id37">x.xx.fw.9999形式のメッセージID</a></p></li>
<li><p><a class="reference internal" href="#createwebapplicationprojectcustomizemessagewording" id="id38">メッセージ文言</a></p></li>
<li><p><a class="reference internal" href="#createwebapplicationprojectcustomizeerrorscreen" id="id39">エラー画面</a></p></li>
<li><p><a class="reference internal" href="#createwebapplicationprojectcustomizecopyrightonscreenfooter" id="id40">画面フッターの著作権</a></p></li>
<li><p><a class="reference internal" href="#h2-database" id="id41">インメモリデータベース(H2 Database)</a></p></li>
<li><p><a class="reference internal" href="#createwebapplicationprojectcustomizedatasource" id="id42">データソース設定</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#createwebapplicationprojectconfiguration" id="id43">開発プロジェクトの構成</a></p>
<ul>
<li><p><a class="reference internal" href="#createwebapplicationprojectconfigurationmulti" id="id44">マルチプロジェクトの構成</a></p></li>
<li><p><a class="reference internal" href="#createwebapplicationprojectconfigurationweb" id="id45">webモジュールの構成</a></p></li>
<li><p><a class="reference internal" href="#domain" id="id46">domainモジュールの構成</a></p></li>
<li><p><a class="reference internal" href="#env" id="id47">envモジュールの構成</a></p></li>
<li><p><a class="reference internal" href="#initdb" id="id48">initdbモジュールの構成</a></p></li>
<li><p><a class="reference internal" href="#selenium" id="id49">seleniumモジュールの構成</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#appendix" id="id50">Appendix</a></p>
<ul>
<li><p><a class="reference internal" href="#createwebapplicationprojectappendixprojecthierarchicalstructure" id="id51">プロジェクトの階層構造</a></p></li>
<li><p><a class="reference internal" href="#bean" id="id52">アプリケーションコンテキストの構成とBean定義ファイルの関係</a></p></li>
<li><p><a class="reference internal" href="#createwebapplicationprojectappendixdescribeconfigurationfile" id="id53">設定ファイルの解説</a></p></li>
</ul>
</li>
</ul>
</nav>
<p>本節では、Webアプリケーション向けの開発プロジェクトを作成する方法について説明する。</p>
<p>本ガイドラインでは、マルチプロジェクト構成を採用することを推奨している。
推奨するマルチプロジェクト構成の説明については、「<a class="reference internal" href="../Overview/ApplicationLayering.html#application-layering-project-structure"><span class="std std-ref">プロジェクト構成</span></a>」を参照されたい。</p>
<section id="id2">
<h2><a class="toc-backref" href="#id25" role="doc-backlink"><span class="section-number">4.1.1. </span>開発プロジェクトの作成</a><a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h2>
<p>マルチプロジェクト構成の開発プロジェクトを、
<a class="reference external" href="http://maven.apache.org/archetype/maven-archetype-plugin/">Maven Archetype Plugin</a> の <a class="reference external" href="http://maven.apache.org/archetype/maven-archetype-plugin/generate-mojo.html">archetype:generate</a> を使用して作成する。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>前提条件</strong></p>
<p>以降の説明では、</p>
<ul class="simple">
<li><p><a class="reference external" href="http://maven.apache.org/">Maven</a> (<code class="docutils literal notranslate"><span class="pre">mvn</span></code>コマンド)が使用可能であること</p></li>
<li><p>インターネットに繋がっていること</p></li>
<li><p>インターネットにプロキシ経由で繋ぐ場合は、<a class="reference external" href="http://maven.apache.org/guides/mini/guide-proxies.html">Mavenのプロキシ設定</a>  が行われていること</p></li>
</ul>
<p>を前提としている。</p>
<p>前提条件が整っていない場合は、まずこれらのセットアップを行ってほしい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>マルチプロジェクトを作成するためのArchetypeとして、以下の2種類を用意している。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 30%" />
<col style="width: 65%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>Archetype(ArtifactId)</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ol class="arabic simple">
<li></li>
</ol>
</td>
<td><p>terasoluna-gfw-multi-web-blank-mybatis3-archetype</p></td>
<td><p>O/R MapperとしてMyBatis3を使用するためのプロジェクトを生成するためのArchetype。</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p>terasoluna-gfw-multi-web-blank-jpa-archetype</p></td>
<td><p>O/R MapperとしてJPA(with Spring Data JPA and Hibernate)を使用するためのプロジェクトを生成するためのArchetype。</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>プロジェクトを作成するフォルダに移動する。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd C:\work</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><a class="reference external" href="http://maven.apache.org/archetype/maven-archetype-plugin/">Maven Archetype Plugin</a> の <a class="reference external" href="http://maven.apache.org/archetype/maven-archetype-plugin/generate-mojo.html">archetype:generate</a> を使用して、プロジェクトを作成する。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mvn archetype:generate -B^</span>
<span class="go"> -DarchetypeCatalog=http://repo.terasoluna.org/nexus/content/repositories/terasoluna-gfw-releases^</span>
<span class="go"> -DarchetypeGroupId=org.terasoluna.gfw.blank^</span>
<span class="go"> -DarchetypeArtifactId=terasoluna-gfw-multi-web-blank-mybatis3-archetype^</span>
<span class="go"> -DarchetypeVersion=5.0.2.RELEASE^</span>
<span class="go"> -DgroupId=com.example.todo^</span>
<span class="go"> -DartifactId=todo^</span>
<span class="go"> -Dversion=1.0.0-SNAPSHOT</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">-B</div>
</div>
</td>
<td><p>batch mode (対話を省略)</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">-DarchetypeCatalog</div>
</div>
</td>
<td><p>TERASOLUNA Server Framework for Java (5.x)のレポジトリを指定する。(固定)</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">-DarchetypeGroupId</div>
</div>
</td>
<td><p>ブランクプロジェクトのgroupIdを指定する。(固定)</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">-DarchetypeArtifactId</div>
</div>
</td>
<td><p>ブランクプロジェクトのarchetypeId(雛形を特定するためのID)を指定する。<strong>(カスタマイズが必要)</strong></p>
<p>以下の何れかのarchetypeIdを指定する。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">terasoluna-gfw-multi-web-blank-mybatis3-archetype</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">terasoluna-gfw-multi-web-blank-jpa-archetype</span></code></p></li>
</ul>
<p>上記例では、<code class="docutils literal notranslate"><span class="pre">terasoluna-gfw-multi-web-blank-mybatis3-archetype</span></code>を指定している。</p>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">-DarchetypeVersion</div>
</div>
</td>
<td><p>ブランクプロジェクトのバージョンを指定する。(固定)</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">-DgroupId</div>
</div>
</td>
<td><p>作成するプロジェクトのgroupIdを指定する。<strong>(カスタマイズが必要)</strong></p>
<p>上記例では、<code class="docutils literal notranslate"><span class="pre">&quot;com.example.todo&quot;</span></code>を指定している。</p>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">-DartifactId</div>
</div>
</td>
<td><p>作成するプロジェクトのartifactIdを指定する。<strong>(カスタマイズが必要)</strong></p>
<p>上記例では、<code class="docutils literal notranslate"><span class="pre">&quot;todo&quot;</span></code>を指定している。</p>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">-Dversion</div>
</div>
</td>
<td><p>作成するプロジェクトのバージョンを指定する。<strong>(カスタマイズが必要)</strong></p>
<p>上記例では、<code class="docutils literal notranslate"><span class="pre">&quot;1.0.0-SNAPSHOT&quot;</span></code>を指定している。</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>プロジェクトの作成が成功した場合、以下のようなログが出力される。
(以下は、MyBatis3用のArchetypeを使用して作成した場合の出力例)</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(... omit)</span>
<span class="go">[INFO] ----------------------------------------------------------------------------</span>
<span class="go">[INFO] Using following parameters for creating project from Archetype: terasoluna-gfw-multi-web-blank-mybatis3-archetype:5.0.2.RELEASE</span>
<span class="go">[INFO] ----------------------------------------------------------------------------</span>
<span class="go">[INFO] Parameter: groupId, Value: com.example.todo</span>
<span class="go">[INFO] Parameter: artifactId, Value: todo</span>
<span class="go">[INFO] Parameter: version, Value: 1.0.0-SNAPSHOT</span>
<span class="go">[INFO] Parameter: package, Value: com.example.todo</span>
<span class="go">[INFO] Parameter: packageInPathFormat, Value: com/example/todo</span>
<span class="go">[INFO] Parameter: package, Value: com.example.todo</span>
<span class="go">[INFO] Parameter: version, Value: 1.0.0-SNAPSHOT</span>
<span class="go">[INFO] Parameter: groupId, Value: com.example.todo</span>
<span class="go">[INFO] Parameter: artifactId, Value: todo</span>
<span class="go">[INFO] Parent element not overwritten in C:\work\todo\todo-env\pom.xml</span>
<span class="go">[INFO] Parent element not overwritten in C:\work\todo\todo-domain\pom.xml</span>
<span class="go">[INFO] Parent element not overwritten in C:\work\todo\todo-web\pom.xml</span>
<span class="go">[INFO] Parent element not overwritten in C:\work\todo\todo-initdb\pom.xml</span>
<span class="go">[INFO] Parent element not overwritten in C:\work\todo\todo-selenium\pom.xml</span>
<span class="go">[INFO] project created from Archetype in dir: C:\work\todo</span>
<span class="go">[INFO] ------------------------------------------------------------------------</span>
<span class="go">[INFO] BUILD SUCCESS</span>
<span class="go">[INFO] ------------------------------------------------------------------------</span>
<span class="go">[INFO] Total time: 9.929 s</span>
<span class="go">[INFO] Finished at: 2015-07-31T12:03:21+00:00</span>
<span class="go">[INFO] Final Memory: 10M/26M</span>
<span class="go">[INFO] ------------------------------------------------------------------------</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>プロジェクトの作成が成功した場合、Mavenのマルチプロジェクトが作成される。
Maven Archetypeで作成したプロジェクトの詳細な説明については、「<a class="reference internal" href="#createwebapplicationprojectconfiguration"><span class="std std-ref">開発プロジェクトの構成</span></a>」を参照されたい。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">todo</span>
<span class="go">├── pom.xml</span>
<span class="go">├── todo-domain</span>
<span class="go">├── todo-env</span>
<span class="go">├── todo-initdb</span>
<span class="go">├── todo-selenium</span>
<span class="go">└── todo-web</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="createwebapplicationprojectbuild">
<span id="id6"></span><h2><a class="toc-backref" href="#id26" role="doc-backlink"><span class="section-number">4.1.2. </span>開発プロジェクトのビルド</a><a class="headerlink" href="#createwebapplicationprojectbuild" title="Permalink to this heading">¶</a></h2>
<p>アプリケーションサーバにデプロイするためのwarファイル、envモジュール(ファイル環境依存ファイルを格納するモジュール)のjarファイルを作成する方法を紹介する。</p>
<p>Maven Archetypeで作成したプロジェクトでは、warファイルを作成する方法として以下の２つの方法を提供している。</p>
<ul class="simple">
<li><p><a class="reference internal" href="#createwebapplicationprojectbuildwarexcludeenvjar"><span class="std std-ref">envモジュールのjarファイルをwarファイルに含めないビルド方法</span></a> (<strong>推奨</strong>)</p></li>
<li><p><a class="reference internal" href="#createwebapplicationprojectbuildwarincludeenvjar"><span class="std std-ref">envモジュールのjarファイルをwarファイルに含めるビルド方法</span></a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>推奨するビルド方法について</strong></p>
<p>本ガイドラインでは、<a class="reference internal" href="#createwebapplicationprojectbuildwarexcludeenvjar"><span class="std std-ref">envモジュールのjarファイルをwarファイルに含めないビルド方法</span></a> を推奨している。
推奨理由は、<a class="reference internal" href="../Appendix/EnvironmentIndependency.html"><span class="doc">環境依存性の排除</span></a> を参照されたい。
なお、ここで紹介するビルド方法は選択肢の一つであり、他のビルド方法を採用してもよい。</p>
<p>ただし、<strong>試験環境や商用環境にリリースするwarファイルとjarファイルは、EclipseなどのIDEが提供している機能を使って作成しないようにすること。</strong>
Eclipseなどの一部のIDEでは、開発用に最適化された独自のコンパイラを使ってクラスファイルを作成しており、
コンパイラの違いが原因でアプリケーション実行時に予期しないエラーが発生するリスクが生まれる。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>ビルド環境について</strong></p>
<p>ここではWindows環境でビルドする例になっているが、Windows環境でビルドすることを推奨しているわけではない。
本ガイドラインでは、<strong>アプリケーションの実行環境と同じOSとJDKのバージョンを使ってビルドすることを推奨する。</strong></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">Mavenを使ってビルドする場合は、環境変数「JAVA_HOME」にコンパイル時に使用するJDKのホームディレクトリが指定されていることを確認されたい。</div>
<div class="line">環境変数が設定されていない場合や異なるバージョンのJDKのホームディレクトリが指定されている場合は、環境変数に適切なホームディレクトリを指定すること。</div>
</div>
<p><strong>[Windowsの場合]</strong></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">echo %JAVA_HOME%</span>
<span class="go">set JAVA_HOME={Please set home directory of JDK}</span>
</pre></div>
</div>
<p><strong>[Linux系の場合]</strong></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">echo $JAVA_HOME</span>
<span class="go">JAVA_HOME={Please set home directory of JDK}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>環境変数「JAVA_HOME」は、ビルドを実行するOSユーザーのユーザー環境変数に設定しておくとよい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="envjarwar">
<span id="createwebapplicationprojectbuildwarexcludeenvjar"></span><h3><a class="toc-backref" href="#id27" role="doc-backlink"><span class="section-number">4.1.2.1. </span>envモジュールのjarファイルをwarファイルに含めないビルド方法</a><a class="headerlink" href="#envjarwar" title="Permalink to this heading">¶</a></h3>
<section id="war">
<span id="createwebapplicationprojectbuildwarexcludeenvjarstepwar"></span><h4><a class="toc-backref" href="#id28" role="doc-backlink"><span class="section-number">4.1.2.1.1. </span>warファイルの作成</a><a class="headerlink" href="#war" title="Permalink to this heading">¶</a></h4>
<p>開発プロジェクトのルートディレクトリへ移動する。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd C:\work\todo</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">Mavenのプロファイル(<code class="docutils literal notranslate"><span class="pre">-P</span></code>パラメータ)に<code class="docutils literal notranslate"><span class="pre">warpack</span></code>を指定して、Maven installを実行する。</div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mvn -P warpack clean install</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Maven packageの実行が成功すると、webモジュールのtargetディレクトリの中に、envモジュールのjarファイルが含まれていないwarファイルが作成される。</div>
<div class="line">(例：<code class="docutils literal notranslate"><span class="pre">C:\work\todo\todo-web\target\todo-web.war</span></code>)</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>指定するゴールについて</strong></p>
<p>上記例ではゴールに<code class="docutils literal notranslate"><span class="pre">install</span></code>を指定してwarファイルをローカルリポジトリへインストールしているが、</p>
<blockquote>
<div><ul class="simple">
<li><p>warファイルの作成のみ行う場合はゴールに<code class="docutils literal notranslate"><span class="pre">package</span></code></p></li>
<li><p>Nexusなどのリモートリポジトリへデプロイする場合はゴールに<code class="docutils literal notranslate"><span class="pre">deploy</span></code></p></li>
</ul>
</div></blockquote>
<p>を指定すればよい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="envjar">
<span id="createwebapplicationprojectbuildwarexcludeenvjarstepenvjar"></span><h4><a class="toc-backref" href="#id29" role="doc-backlink"><span class="section-number">4.1.2.1.2. </span>envモジュールのjarファイルの作成</a><a class="headerlink" href="#envjar" title="Permalink to this heading">¶</a></h4>
<p>envモジュールのディレクトリへ移動する。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd C:\work\todo\todo-env</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Mavenのプロファイル(<code class="docutils literal notranslate"><span class="pre">-P</span></code>パラメータ)に<strong>環境を識別するプロファイルID</strong>を指定して、Maven packageを実行する。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mvn -P test-server clean package</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Maven packageの実行が成功すると、envモジュールのtargetディレクトリの中に、指定した環境用のjarファイルが作成される。</div>
<div class="line">(例：<code class="docutils literal notranslate"><span class="pre">C:\work\todo\todo-env\target\todo-env-1.0.0-SNAPSHOT-test-server.jar</span></code>)</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>環境を識別するプロファイルIDについて</strong></p>
<p>Maven Archetypeで作成したプロジェクトでは、以下のプロファイルIDがデフォルトで定義されている。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">local</span></code> : 開発者のローカル環境向け(IDE開発環境向け)のプロファイル (デフォルトのプロファイル)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test-server</span></code> : 試験環境向けのプロファイル</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">production-server</span></code> : 商用環境向けのプロファイル</p></li>
</ul>
</div></blockquote>
<p>デフォルトで用意しているプロファイルは上記の3つだが、開発するシステムの環境構成にあわせて追加及び修正されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="tomcat">
<span id="createwebapplicationprojectbuildwarexcludeenvjarstepdeploytotomcat"></span><h4><a class="toc-backref" href="#id30" role="doc-backlink"><span class="section-number">4.1.2.1.3. </span>Tomcatへのデプロイ</a><a class="headerlink" href="#tomcat" title="Permalink to this heading">¶</a></h4>
<p>アプリケーションサーバとしてTomcatを使用する際のデプロイ方法(手順)を紹介する。</p>
<ul class="simple">
<li><p>envモジュールのjarファイルを所定の外部ディレクトリへコピーする。</p></li>
<li><p>warファイルをTomcatへデプロイする。</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>envモジュールのjarファイルを外部ディレクトリで管理する方法は、Appendixの <a class="reference internal" href="../Appendix/EnvironmentIndependency.html#environmentindependencydeploytomcat"><span class="std std-ref">Tomcatへのデプロイ</span></a> を参照されたい。</p></li>
<li><p>warファイルをTomcatへデプロイする方法は、Tomcatのマニュアルを参照されたい。</p></li>
</ul>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="createwebapplicationprojectbuildwarexcludeenvjarstepdeploytootherserver">
<span id="id7"></span><h4><a class="toc-backref" href="#id31" role="doc-backlink"><span class="section-number">4.1.2.1.4. </span>Tomcat以外のアプリケーションサーバへのデプロイ</a><a class="headerlink" href="#createwebapplicationprojectbuildwarexcludeenvjarstepdeploytootherserver" title="Permalink to this heading">¶</a></h4>
<p>アプリケーションサーバとしてTomcat以外のサーバを使用する際のデプロイ方法(手順)を紹介する。</p>
<ul class="simple">
<li><p>envモジュールのjarファイルをwarファイルに組み込む。</p></li>
<li><p>envモジュールのjarファイルを組み込んだwarファイルをアプリケーションサーバへデプロイする。</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>warファイルをアプリケーションサーバへデプロイする方法は、使用するアプリケーションサーバのマニュアルを参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>ここでは、jarコマンドを使用して、envモジュールのjarファイルをwarファイルに組み込む方法(手順)を紹介する。</p>
<div class="line-block">
<div class="line">作業ディレクトリへ移動する。</div>
<div class="line">ここでは、envプロジェクトで作業を行う例になっている。</div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd C:\work\todo\todo-env</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">作成したwarファイルを作業ディレクトリへコピーする。</div>
<div class="line">ここでは、Mavenリポジトリからwarファイルを取得する例になっている。(warファイルを<code class="docutils literal notranslate"><span class="pre">install</span></code>または<code class="docutils literal notranslate"><span class="pre">deploy</span></code>している前提とする)</div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mvn org.apache.maven.plugins:maven-dependency-plugin:2.5:get^</span>
<span class="go"> -DgroupId=com.example.todo^</span>
<span class="go"> -DartifactId=todo-web^</span>
<span class="go"> -Dversion=1.0.0-SNAPSHOT^</span>
<span class="go"> -Dpackaging=war^</span>
<span class="go"> -Ddest=target/todo-web.war</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">コマンドの実行が成功すると、envモジュールのtargetディレクトリの中に、指定したwarファイルがコピーされる。</div>
<div class="line">(例：<code class="docutils literal notranslate"><span class="pre">C:\work\todo\todo-env\target\todo-web.war</span></code>)</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-DgroupId</span></code>、<code class="docutils literal notranslate"><span class="pre">-DartifactId</span></code>、<code class="docutils literal notranslate"><span class="pre">-Dversion</span></code>、<code class="docutils literal notranslate"><span class="pre">-Ddest</span></code>には、適切な値を指定すること。</p></li>
<li><p>Linux系で実行する場合は、行末の <code class="docutils literal notranslate"><span class="pre">^</span></code> を <code class="docutils literal notranslate"><span class="pre">\</span></code> に読み替えること。</p></li>
</ul>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>作成したjarファイルを作業ディレクト(<code class="docutils literal notranslate"><span class="pre">target\WEB-INF\lib</span></code>)へ一旦コピーし、warファイルの中に追加する。</p>
<p><strong>[Windowsの場合]</strong></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir target\WEB-INF\lib</span>
<span class="go">copy target\todo-env-1.0.0-SNAPSHOT-test-server.jar target\WEB-INF\lib\.</span>
<span class="go">cd target</span>
<span class="go">jar -uvf todo-web.war WEB-INF\lib</span>
</pre></div>
</div>
<p><strong>[Linux系の場合]</strong></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir -p target/WEB-INF/lib</span>
<span class="go">cp target/todo-env-1.0.0-SNAPSHOT-test-server.jar target/WEB-INF/lib/.</span>
<span class="go">cd target</span>
<span class="go">jar -uvf todo-web.war WEB-INF/lib</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>jarコマンドが見つからない場合の対処</strong></p>
<p>jarコマンドが見つからない場合は、以下のいずれかの対処を行うことで解決することができる。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">JAVA_HOME/bin</span></code>を環境変数「PATH」に追加する。</p></li>
<li><p>jarコマンドをフルパスで指定する。Windowの場合は<code class="docutils literal notranslate"><span class="pre">%JAVA_HOME%\bin\jar</span></code>、Linux系の場合は<code class="docutils literal notranslate"><span class="pre">${JAVA_HOME}/bin/jar</span></code>を指定すればよい。</p></li>
</ul>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="createwebapplicationprojectbuildwarincludeenvjar">
<span id="id8"></span><h3><a class="toc-backref" href="#id32" role="doc-backlink"><span class="section-number">4.1.2.2. </span>envモジュールのjarファイルをwarファイルに含めるビルド方法</a><a class="headerlink" href="#createwebapplicationprojectbuildwarincludeenvjar" title="Permalink to this heading">¶</a></h3>
<section id="createwebapplicationprojectbuildwarincludeenvjarwar">
<span id="id9"></span><h4><a class="toc-backref" href="#id33" role="doc-backlink"><span class="section-number">4.1.2.2.1. </span>warファイルの作成</a><a class="headerlink" href="#createwebapplicationprojectbuildwarincludeenvjarwar" title="Permalink to this heading">¶</a></h4>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>envモジュールのjarファイルをwarファイルに含める場合の注意点</strong></p>
<p>envモジュールのjarファイルをwarファイルに含めた場合、warファイルを他の環境にデプロイすることができないため、
間違って他の環境(特に商用環境)にデプロイされないようにwarファイルを管理すること。</p>
<p>また、環境毎にwarファイルを作成して各環境へリリースする方法を採用した場合、
商用環境へリリースされるwarファイルが厳密にいうとテスト済みのwarファイルではないという点を意識してほしい。
これは、商用環境用のwarファイルを作成する際にコンパイルをしなおすためである。
warファイルを環境毎に作成してリリースする場合は、GitやSubversionなどのVCS(Version Control System)の機能(タグ機能など)を活用し、
テスト済みのソースファイルを使用して商用環境や各種テスト環境へリリースするwarファイルを作成する仕組みを確立することが特に重要である。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>開発プロジェクトのルートディレクトリへ移動する。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd C:\work\todo</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">Mavenのプロファイル(<code class="docutils literal notranslate"><span class="pre">-P</span></code>パラメータ)に<code class="docutils literal notranslate"><span class="pre">warpack-with-env</span></code>とenvモジュールの中で定義している<strong>環境を識別するプロファイルID</strong>を指定して、Maven packageを実行する。</div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mvn -P warpack-with-env,test-server clean package</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Maven packageの実行が成功すると、webモジュールのtargetディレクトリの中に、envモジュールのjarファイルを含んだwarファイルが作成される。</div>
<div class="line">(例：<code class="docutils literal notranslate"><span class="pre">C:\work\todo\todo-web\target\todo-web.war</span></code>)</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="createwebapplicationprojectbuildwarincludeenvjardeploy">
<span id="id10"></span><h4><a class="toc-backref" href="#id34" role="doc-backlink"><span class="section-number">4.1.2.2.2. </span>デプロイ</a><a class="headerlink" href="#createwebapplicationprojectbuildwarincludeenvjardeploy" title="Permalink to this heading">¶</a></h4>
<p>作成したwarファイルをアプリケーションサーバへデプロイする。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>warファイルをアプリケーションサーバへデプロイする方法は、使用するアプリケーションサーバのマニュアルを参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
</section>
<section id="createwebapplicationprojectcustomize">
<span id="id11"></span><h2><a class="toc-backref" href="#id35" role="doc-backlink"><span class="section-number">4.1.3. </span>開発プロジェクトのカスタマイズ</a><a class="headerlink" href="#createwebapplicationprojectcustomize" title="Permalink to this heading">¶</a></h2>
<p>Maven Archetypeで作成したプロジェクトには、アプリケーション毎にカスタマイズが必要な箇所がいくつか存在する。</p>
<p>カスタマイズが必要な箇所を以下に示す。</p>
<ul class="simple">
<li><p><a class="reference internal" href="#createwebapplicationprojectcustomizeprojectinformation"><span class="std std-ref">POMファイルのプロジェクト情報</span></a></p></li>
<li><p><a class="reference internal" href="#createwebapplicationprojectcustomizemessageid"><span class="std std-ref">x.xx.fw.9999形式のメッセージID</span></a></p></li>
<li><p><a class="reference internal" href="#createwebapplicationprojectcustomizemessagewording"><span class="std std-ref">メッセージ文言</span></a></p></li>
<li><p><a class="reference internal" href="#createwebapplicationprojectcustomizeerrorscreen"><span class="std std-ref">エラー画面</span></a></p></li>
<li><p><a class="reference internal" href="#createwebapplicationprojectcustomizecopyrightonscreenfooter"><span class="std std-ref">画面フッターの著作権</span></a></p></li>
<li><p><a class="reference internal" href="#createwebapplicationprojectcustomizeinmemorydatabase"><span class="std std-ref">インメモリデータベース(H2 Database)</span></a></p></li>
<li><p><a class="reference internal" href="#createwebapplicationprojectcustomizedatasource"><span class="std std-ref">データソース設定</span></a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>上記以外のカスタマイズポイントとしては、</p>
<ul class="simple">
<li><p><a class="reference internal" href="../Security/Authentication.html"><span class="doc">認証</span></a>・<a class="reference internal" href="../Security/Authorization.html"><span class="doc">認可</span></a> の設定</p></li>
<li><p><a class="reference internal" href="../ArchitectureInDetail/FileUpload.html"><span class="doc">ファイルアップロード</span></a> を有効化するための設定</p></li>
<li><p><a class="reference internal" href="../ArchitectureInDetail/Internationalization.html"><span class="doc">国際化</span></a> を有効化するための設定</p></li>
<li><p><a class="reference internal" href="../ArchitectureInDetail/Logging.html"><span class="doc">ロギング</span></a> の定義</p></li>
<li><p><a class="reference internal" href="../ArchitectureInDetail/ExceptionHandling.html"><span class="doc">例外ハンドリング</span></a> の定義</p></li>
<li><p><a class="reference internal" href="../ArchitectureInDetail/REST.html"><span class="doc">RESTful Web Service</span></a> 向けの設定の適用</p></li>
</ul>
<p>などがある。</p>
<p>これらのカスタマイズについては、各節のHow to useを参照し、必要に応じてカスタマイズしてほしい。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>以降の説明で<code class="docutils literal notranslate"><span class="pre">artifactId</span></code>と表現している部分は、
プロジェクト作成時に指定した<code class="docutils literal notranslate"><span class="pre">artifactId</span></code>に置き換えて読み進めてほしい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="pom">
<span id="createwebapplicationprojectcustomizeprojectinformation"></span><h3><a class="toc-backref" href="#id36" role="doc-backlink"><span class="section-number">4.1.3.1. </span>POMファイルのプロジェクト情報</a><a class="headerlink" href="#pom" title="Permalink to this heading">¶</a></h3>
<p>Maven Archetypeで作成したプロジェクトのPOMファイルでは、</p>
<ul class="simple">
<li><p>プロジェクト名(<code class="docutils literal notranslate"><span class="pre">name</span></code>要素)</p></li>
<li><p>プロジェクト説明(<code class="docutils literal notranslate"><span class="pre">description</span></code>要素)</p></li>
<li><p>プロジェクトURL(<code class="docutils literal notranslate"><span class="pre">url</span></code>要素)</p></li>
<li><p>プロジェクト創設年(<code class="docutils literal notranslate"><span class="pre">inceptionYear</span></code>要素)</p></li>
<li><p>プロジェクトライセンス(<code class="docutils literal notranslate"><span class="pre">licenses</span></code>要素)</p></li>
<li><p>プロジェクト組織(<code class="docutils literal notranslate"><span class="pre">organization</span></code>要素)</p></li>
</ul>
<p>といったプロジェクト情報が、Archetype自身のプロジェクト情報が設定されている状態となっている。
実際の設定内容を以下に示す。</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- ... --&gt;</span>

<span class="nt">&lt;name&gt;</span>TERASOLUNA<span class="w"> </span>Server<span class="w"> </span>Framework<span class="w"> </span>for<span class="w"> </span>Java<span class="w"> </span>(5.x)<span class="w"> </span>Web<span class="w"> </span>Blank<span class="w"> </span>Multi<span class="w"> </span>Project<span class="nt">&lt;/name&gt;</span>
<span class="nt">&lt;description&gt;</span>Web<span class="w"> </span>Blank<span class="w"> </span>Multi<span class="w"> </span>Project<span class="w"> </span>using<span class="w"> </span>TERASOLUNA<span class="w"> </span>Server<span class="w"> </span>Framework<span class="w"> </span>for<span class="w"> </span>Java<span class="w"> </span>(5.x)<span class="nt">&lt;/description&gt;</span>
<span class="nt">&lt;url&gt;</span>http://terasoluna.org<span class="nt">&lt;/url&gt;</span>
<span class="nt">&lt;inceptionYear&gt;</span>2014<span class="nt">&lt;/inceptionYear&gt;</span>
<span class="nt">&lt;licenses&gt;</span>
<span class="w">    </span><span class="nt">&lt;license&gt;</span>
<span class="w">        </span><span class="nt">&lt;name&gt;</span>Apache<span class="w"> </span>License,<span class="w"> </span>Version<span class="w"> </span>2.0<span class="nt">&lt;/name&gt;</span>
<span class="w">        </span><span class="nt">&lt;url&gt;</span>http://www.apache.org/licenses/LICENSE-2.0.txt<span class="nt">&lt;/url&gt;</span>
<span class="w">        </span><span class="nt">&lt;distribution&gt;</span>manual<span class="nt">&lt;/distribution&gt;</span>
<span class="w">    </span><span class="nt">&lt;/license&gt;</span>
<span class="nt">&lt;/licenses&gt;</span>
<span class="nt">&lt;organization&gt;</span>
<span class="w">    </span><span class="nt">&lt;name&gt;</span>TERASOLUNA<span class="w"> </span>Framework<span class="w"> </span>Team<span class="nt">&lt;/name&gt;</span>
<span class="w">    </span><span class="nt">&lt;url&gt;</span>http://terasoluna.org<span class="nt">&lt;/url&gt;</span>
<span class="nt">&lt;/organization&gt;</span>

<span class="cm">&lt;!-- ... --&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>プロジェクト情報には、適切な値を設定すること。</strong></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>カスタマイズ対象のファイルとカスタマイズ方法を以下に示す。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 45%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>対象ファイル</p></th>
<th class="head"><p>カスタマイズ方法</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ol class="arabic simple">
<li></li>
</ol>
</td>
<td><p>マルチプロジェクト全体の構成を定義するPOM(Project Object Model)ファイル</p>
<p><code class="docutils literal notranslate"><span class="pre">artifactId/pom.xml</span></code></p>
</td>
<td><p>プロジェクト情報に適切な値を指定する。</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="x-xx-fw-9999id">
<span id="createwebapplicationprojectcustomizemessageid"></span><h3><a class="toc-backref" href="#id37" role="doc-backlink"><span class="section-number">4.1.3.2. </span>x.xx.fw.9999形式のメッセージID</a><a class="headerlink" href="#x-xx-fw-9999id" title="Permalink to this heading">¶</a></h3>
<p>Maven Archetypeで作成したプロジェクトでは、<code class="docutils literal notranslate"><span class="pre">x.xx.fw.9999</span></code>形式のメッセージIDを、</p>
<ul class="simple">
<li><p>エラー画面に表示するメッセージ</p></li>
<li><p>例外発生時に出力するエラーログ</p></li>
</ul>
<p>を生成する際に使用している。実際の使用箇所(サンプリング)を以下に示す。</p>
<p><strong>[application-messages.properties]</strong></p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="na">e.xx.fw.5001</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">Resource not found.</span>
</pre></div>
</div>
<p><strong>[JSP]</strong></p>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;error&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;c:if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;${!empty exceptionCode}&quot;</span><span class="nt">&gt;</span>[${f:h(exceptionCode)}]<span class="nt">&lt;/c:if&gt;</span>
<span class="w">    </span><span class="nt">&lt;spring:message</span><span class="w"> </span><span class="na">code=</span><span class="s">&quot;e.xx.fw.5001&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p><strong>[applicationContext.xml]</strong></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;exceptionCodeResolver&quot;</span>
<span class="w">    </span><span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.exception.SimpleMappingExceptionCodeResolver&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- ... --&gt;</span>
<span class="w">            </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;ResourceNotFoundException&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;e.xx.fw.5001&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">x.xx.fw.9999</span></code>形式のメッセージIDは、
本ガイドラインの「<a class="reference internal" href="../ArchitectureInDetail/MessageManagement.html"><span class="doc">メッセージ管理</span></a>」で紹介しているメッセージID体系であるが、
プロジェクト区分の値が暫定値「<code class="docutils literal notranslate"><span class="pre">xx</span></code>」の状態になっている。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p><strong>本ガイドラインで紹介しているメッセージID体系を利用する場合は、プロジェクト区分に適切な値を指定すること。</strong> 本ガイドラインで紹介しているメッセージID体系については、「<a class="reference internal" href="../ArchitectureInDetail/MessageManagement.html#message-management-result-rule"><span class="std std-ref">結果メッセージ</span></a>」を参照されたい。</p></li>
<li><p>本ガイドラインで紹介しているメッセージID体系を利用しない場合は、以下に示す修正対象ファイル内で使用しているメッセージIDを全て置き換える必要がある。</p></li>
</ul>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>カスタマイズ対象のファイルとカスタマイズ方法を以下に示す。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 45%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>対象ファイル</p></th>
<th class="head"><p>カスタマイズ方法</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ol class="arabic simple">
<li></li>
</ol>
</td>
<td><p>メッセージ定義ファイル</p>
<p><code class="docutils literal notranslate"><span class="pre">artifactId/artifactId-web/src/main/resources/i18n/application-messages.properties</span></code></p>
</td>
<td><p>プロパティキーに指定しているメッセージIDのプロジェクト区分の暫定値「<code class="docutils literal notranslate"><span class="pre">xx</span></code>」を、適切な値に修正する。</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p>エラー画面用のJSP</p>
<p><code class="docutils literal notranslate"><span class="pre">artifactId/artifactId-web/src/main/webapp/WEB-INF/views/common/error/*.jsp</span></code></p>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;spring:message&gt;</span></code>要素の<code class="docutils literal notranslate"><span class="pre">code</span></code>属性に指定しているメッセージIDのプロジェクト区分の暫定値「<code class="docutils literal notranslate"><span class="pre">xx</span></code>」を、適切な値に修正する。</p></td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p>Webアプリケーション用のアプリケーションコンテキストを作成するためのBean定義ファイル</p>
<p><code class="docutils literal notranslate"><span class="pre">artifactId/artifactId-web/src/main/resources/META-INF/spring/applicationContext.xml</span></code></p>
</td>
<td><p>BeanIDが<code class="docutils literal notranslate"><span class="pre">&quot;exceptionCodeResolver&quot;</span></code>のBean定義内で指定している例外コード(メッセージID)のプロジェクト区分の暫定値「<code class="docutils literal notranslate"><span class="pre">xx</span></code>」を、適切な値に修正する。</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="createwebapplicationprojectcustomizemessagewording">
<span id="id12"></span><h3><a class="toc-backref" href="#id38" role="doc-backlink"><span class="section-number">4.1.3.3. </span>メッセージ文言</a><a class="headerlink" href="#createwebapplicationprojectcustomizemessagewording" title="Permalink to this heading">¶</a></h3>
<p>Maven Archetypeで作成したプロジェクトでは、いくつかのメッセージ定義を提供しているが、
メッセージ文言は簡易的なメッセージになっている。
実際のメッセージ(サンプリング)を以下に示す。</p>
<p><strong>[application-messages.properties]</strong></p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="na">e.xx.fw.5001</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">Resource not found.</span>

<span class="c1"># ...</span>

<span class="c1"># typemismatch</span>
<span class="na">typeMismatch</span><span class="o">=</span><span class="s">&quot;{0}&quot; is invalid.</span>

<span class="c1"># ...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>メッセージ文言については、アプリケーション要件(メッセージ規約など)に合わせて修正すること。</strong></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>カスタマイズ対象のファイルとカスタマイズ方法を以下に示す。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 45%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>対象ファイル</p></th>
<th class="head"><p>カスタマイズ方法</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ol class="arabic simple">
<li></li>
</ol>
</td>
<td><p>メッセージ定義ファイル</p>
<p><code class="docutils literal notranslate"><span class="pre">artifactId/artifactId-web/src/main/resources/i18n/application-messages.properties</span></code></p>
</td>
<td><p>アプリケーション要件に応じたメッセージに修正する。</p>
<p>入力チェックでエラーとなった際に表示するメッセージ(Bean Validationのメッセージ)についても、
アプリケーション要件に応じて修正(デフォルトメッセージの上書き)が必要になる。
デフォルトメッセージの上書き方法については、「<a class="reference internal" href="../ArchitectureInDetail/Validation.html#validation-message-def"><span class="std std-ref">エラーメッセージの定義</span></a>」を参照されたい。</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="createwebapplicationprojectcustomizeerrorscreen">
<span id="id13"></span><h3><a class="toc-backref" href="#id39" role="doc-backlink"><span class="section-number">4.1.3.4. </span>エラー画面</a><a class="headerlink" href="#createwebapplicationprojectcustomizeerrorscreen" title="Permalink to this heading">¶</a></h3>
<p>Maven Archetypeで作成したプロジェクトでは、エラーの種類毎にエラー画面を表示するためのJSP及びHTMLを提供しているが、</p>
<ul class="simple">
<li><p>画面レイアウト</p></li>
<li><p>画面タイトル</p></li>
<li><p>メッセージの文言</p></li>
</ul>
<p>などが簡易的な実装になっている。実際のJSPの実装(サンプリング)を以下に示す。</p>
<p><strong>[JSP]</strong></p>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span><span class="w"> </span><span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>Resource<span class="w"> </span>Not<span class="w"> </span>Found<span class="w"> </span>Error!<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;link</span><span class="w"> </span><span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span>
<span class="w">    </span><span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/resources/app/css/styles.css&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="w">    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;wrapper&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;h1&gt;</span>Resource<span class="w"> </span>Not<span class="w"> </span>Found<span class="w"> </span>Error!<span class="nt">&lt;/h1&gt;</span>
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;error&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;c:if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;${!empty exceptionCode}&quot;</span><span class="nt">&gt;</span>[${f:h(exceptionCode)}]<span class="nt">&lt;/c:if&gt;</span>
<span class="w">            </span><span class="nt">&lt;spring:message</span><span class="w"> </span><span class="na">code=</span><span class="s">&quot;e.xx.fw.5001&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/div&gt;</span>
<span class="w">        </span><span class="nt">&lt;t:messagesPanel</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;br&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- ... --&gt;</span>
<span class="w">    </span><span class="nt">&lt;br&gt;</span>
<span class="w">    </span><span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>エラー画面を表示するためのJSPとHTMLについては、アプリケーション要件(UI規約など)に合わせて修正すること。</strong></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>カスタマイズ対象のファイルとカスタマイズ方法を以下に示す。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 45%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>対象ファイル</p></th>
<th class="head"><p>カスタマイズ方法</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ol class="arabic simple">
<li></li>
</ol>
</td>
<td><p>エラー画面用のJSP</p>
<p><code class="docutils literal notranslate"><span class="pre">artifactId/artifactId-web/src/main/webapp/WEB-INF/views/common/error/*.jsp</span></code></p>
</td>
<td><p>アプリケーション要件(UI規約など)に合わせて修正する。</p>
<p>エラー画面を表示するJSPをカスタマイズする際は、「<a class="reference internal" href="../ArchitectureInDetail/ExceptionHandling.html"><span class="doc">例外ハンドリング</span></a> の <a class="reference internal" href="../ArchitectureInDetail/ExceptionHandling.html#exception-handling-how-to-use-codingpoint-jsp-label"><span class="std std-ref">コーディングポイント（JSP編）</span></a>」を参照されたい。</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p>エラー画面用のHTML</p>
<p><code class="docutils literal notranslate"><span class="pre">artifactId/artifactId-web/src/main/webapp/WEB-INF/views/common/error/unhandledSystemError.html</span></code></p>
</td>
<td><p>アプリケーション要件(UI規約など)に合わせて修正する。</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="createwebapplicationprojectcustomizecopyrightonscreenfooter">
<span id="id14"></span><h3><a class="toc-backref" href="#id40" role="doc-backlink"><span class="section-number">4.1.3.5. </span>画面フッターの著作権</a><a class="headerlink" href="#createwebapplicationprojectcustomizecopyrightonscreenfooter" title="Permalink to this heading">¶</a></h3>
<p>Maven Archetypeで作成したプロジェクトでは、Tilesを使用して画面レイアウトを構成しているが、
画面フッター部の著作権が暫定値「<code class="docutils literal notranslate"><span class="pre">Copyright</span> <span class="pre">&amp;copy;</span> <span class="pre">20XX</span> <span class="pre">CompanyName</span></code>」の状態になっている。
実際のJSPの実装(サンプリング)を以下に示す。</p>
<p><strong>[template.jsp]</strong></p>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;tiles:insertAttribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;header&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;tiles:insertAttribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;body&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;hr&gt;</span>
<span class="w">  </span><span class="nt">&lt;p</span><span class="w"> </span><span class="na">style=</span><span class="s">&quot;text-align: center; background: #e5eCf9;&quot;</span><span class="nt">&gt;</span>Copyright
<span class="w">    </span><span class="ni">&amp;copy;</span><span class="w"> </span>20XX<span class="w"> </span>CompanyName<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Tilesを使用して画面レイアウトを構成する場合は、著作権に適切な値を指定すること。</strong></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>カスタマイズ対象のファイルとカスタマイズ方法を以下に示す。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 45%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>対象ファイル</p></th>
<th class="head"><p>カスタマイズ方法</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ol class="arabic simple">
<li></li>
</ol>
</td>
<td><p>Tiles用のテンプレートJSP</p>
<p><code class="docutils literal notranslate"><span class="pre">artifactId/artifactId-web/src/main/webapp/WEB-INF/views/layout/template.jsp</span></code></p>
</td>
<td><p>著作権の暫定値「<code class="docutils literal notranslate"><span class="pre">Copyright</span> <span class="pre">&amp;copy;</span> <span class="pre">20XX</span> <span class="pre">CompanyName</span></code>」を適切な値に修正する。</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="h2-database">
<span id="createwebapplicationprojectcustomizeinmemorydatabase"></span><h3><a class="toc-backref" href="#id41" role="doc-backlink"><span class="section-number">4.1.3.6. </span>インメモリデータベース(H2 Database)</a><a class="headerlink" href="#h2-database" title="Permalink to this heading">¶</a></h3>
<p>Maven Archetypeで作成したプロジェクトには、インメモリデータベース(H2 Database)をセットアップするための設定が行われているが、
これはちょっとした動作検証(プロトタイプ作成やPOC(Proof Of Concept))を行うための設定である。
そのため、本格的なアプリケーション開発を行う場合は、不要な設定になる。</p>
<p><strong>[artifactId-env.xml]</strong></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;jdbc:initialize-database</span><span class="w"> </span><span class="na">data-source=</span><span class="s">&quot;dataSource&quot;</span>
<span class="w">    </span><span class="na">ignore-failures=</span><span class="s">&quot;ALL&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;jdbc:script</span><span class="w"> </span><span class="na">location=</span><span class="s">&quot;classpath:/database/${database}-schema.sql&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;jdbc:script</span><span class="w"> </span><span class="na">location=</span><span class="s">&quot;classpath:/database/${database}-dataload.sql&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/jdbc:initialize-database&gt;</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">└── src</span>
<span class="go">    └── main</span>
<span class="go">        └── resources</span>
<span class="go">            ├── META-INF</span>
<span class="go">          (...)</span>
<span class="go">            ├── database</span>
<span class="go">            │   ├── H2-dataload.sql</span>
<span class="go">            │   └── H2-schema.sql</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>本格的なアプリケーション開発を行う場合は、インメモリデータベース(H2 Database)をセットアップするための定義とSQLを管理するためのディレクトリを削除すること。</strong></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>カスタマイズ対象のファイルとカスタマイズ方法を以下に示す。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 45%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>対象ファイル</p></th>
<th class="head"><p>カスタマイズ方法</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ol class="arabic simple">
<li></li>
</ol>
</td>
<td><p>環境依存するコンポーネントを定義するBean定義ファイル</p>
<p><code class="docutils literal notranslate"><span class="pre">artifactId-env/src/main/resources/META-INF/spring/artifactId-env.xml</span></code></p>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;jdbc:initialize-database&gt;</span></code>要素を削除する。</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p>インメモリデータベース(H2 Database)をセットアップするためのSQLを格納するディレクトリ</p>
<p><code class="docutils literal notranslate"><span class="pre">artifactId/artifactId-env/src/main/resources/database/</span></code></p>
</td>
<td><p>ディレクトリを削除する。</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="createwebapplicationprojectcustomizedatasource">
<span id="id15"></span><h3><a class="toc-backref" href="#id42" role="doc-backlink"><span class="section-number">4.1.3.7. </span>データソース設定</a><a class="headerlink" href="#createwebapplicationprojectcustomizedatasource" title="Permalink to this heading">¶</a></h3>
<p>Maven Archetypeで作成したプロジェクトでは、インメモリデータベース(H2 Database)にアクセスするためのデータソース設定が行われているが、
これはちょっとした動作検証(プロトタイプ作成やPOC(Proof Of Concept))を行うための設定である。
そのため、本格的なアプリケーション開発を行う場合は、
アプリケーション稼働時に利用するデータベースにアクセスするためのデータソース設定に変更する必要がある。</p>
<p><strong>[artifactId/artifactId-domain/pom.xml]</strong></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>com.h2database<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>h2<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<p><strong>[artifactId-infra.properties]</strong></p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="na">database</span><span class="o">=</span><span class="s">H2</span>
<span class="na">database.url</span><span class="o">=</span><span class="s">jdbc:h2:mem:todo;DB_CLOSE_DELAY=-1</span>
<span class="na">database.username</span><span class="o">=</span><span class="s">sa</span>
<span class="na">database.password</span><span class="o">=</span>
<span class="na">database.driverClassName</span><span class="o">=</span><span class="s">org.h2.Driver</span>
<span class="c1"># connection pool</span>
<span class="na">cp.maxActive</span><span class="o">=</span><span class="s">96</span>
<span class="na">cp.maxIdle</span><span class="o">=</span><span class="s">16</span>
<span class="na">cp.minIdle</span><span class="o">=</span><span class="s">0</span>
<span class="na">cp.maxWait</span><span class="o">=</span><span class="s">60000</span>
</pre></div>
</div>
<p><strong>[artifactId-env.xml]</strong></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;realDataSource&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.apache.commons.dbcp2.BasicDataSource&quot;</span>
<span class="w">    </span><span class="na">destroy-method=</span><span class="s">&quot;close&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;driverClassName&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${database.driverClassName}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;url&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${database.url}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;username&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${database.username}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;password&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${database.password}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;defaultAutoCommit&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;maxTotal&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${cp.maxActive}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;maxIdle&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${cp.maxIdle}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;minIdle&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${cp.minIdle}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;maxWaitMillis&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${cp.maxWait}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>本格的なアプリケーション開発を行う場合は、アプリケーション稼働時に利用するデータベースにアクセスするためのデータソース設定に変更すること。</strong></p>
<p>Maven Archetypeで作成したプロジェクトでは、Apache Commons DBCPを使用する設定となっているが、
アプリケーションサーバから提供されているデータソースを使用して、
JNDI(Java Naming and Directory Interface)経由でデータソースにアクセスする方法を採用するケースも多い。</p>
<p>開発環境ではApache Commons DBCPのデータソースを使用して、
テスト環境及び商用環境ではアプリケーションサーバから提供されているデータソースを使用するといった使い分けを行うケースもある。</p>
<p>データソースの設定方法については、「<a class="reference internal" href="../ArchitectureInDetail/DataAccessCommon.html"><span class="doc">データベースアクセス（共通編）</span></a> の <a class="reference internal" href="../ArchitectureInDetail/DataAccessCommon.html#data-access-common-howtouse-datasource"><span class="std std-ref">データソースの設定</span></a>」を参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>カスタマイズ対象のファイルとカスタマイズ方法を以下に示す。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 45%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>対象ファイル</p></th>
<th class="head"><p>カスタマイズ方法</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ol class="arabic simple">
<li></li>
</ol>
</td>
<td><p>POMファイル</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">artifactId/pom.xml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">artifactId/artifactId-domain/pom.xml</span></code></p></li>
</ul>
</td>
<td><p>インメモリデータベース(H2 Database)のJDBCドライバを依存ライブラリから削除する。</p>
<p>アプリケーション稼働時に利用するデータベースにアクセスするためのJDBCドライバを依存ライブラリに追加する。</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p>環境依存する設定値を定義するプロパティファイル</p>
<p><code class="docutils literal notranslate"><span class="pre">artifactId/artifactId-env/src/main/resources/META-INF/spring/artifactId-infra.properties</span></code></p>
</td>
<td><p>データソースとしてApache Commons DBCPを使用する場合は、以下のプロパティにアプリケーション稼働時に利用するデータベースにアクセスするための接続情報を指定する。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">database</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">database.url</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">database.username</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">database.password</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">database.driverClassName</span></code></p></li>
</ul>
<p>アプリケーションサーバから提供されているデータソースを使用する場合は、以下のプロパティ以外は不要なプロパティになるので削除する。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">database</span></code></p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p>環境依存するコンポーネントを定義するBean定義ファイル</p>
<p><code class="docutils literal notranslate"><span class="pre">artifactId/artifactId-env/src/main/resources/META-INF/spring/artifactId-env.xml</span></code></p>
</td>
<td><p>アプリケーションサーバから提供されているデータソースを使用する場合は、JNDI経由で取得したデータソースを使用するように設定を変更する。</p>
<p>データソースの設定方法については、「<a class="reference internal" href="../ArchitectureInDetail/DataAccessCommon.html"><span class="doc">データベースアクセス（共通編）</span></a> の <a class="reference internal" href="../ArchitectureInDetail/DataAccessCommon.html#data-access-common-howtouse-datasource"><span class="std std-ref">データソースの設定</span></a>」を参照されたい。</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>環境依存する設定値を定義するプロパティファイルのdatabaseプロパティについて</strong></p>
<p>O/R MapperとしてMyBatisを使用する場合は、<code class="docutils literal notranslate"><span class="pre">database</span></code>プロパティは不要なプロパティである。
削除してもよいが、使用しているデータベースを明示するために設定を残しておいてもよい。</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><strong>JDBCドライバの追加方法について</strong></p>
<p>使用するデータベースがPostgreSQLとOracleの場合は、POMファイル内のコメントアウトを外せばよい。
JDBCドライバのバージョンについては、使用するデータベースのバージョンに対応するバージョンに修正すること。</p>
<p>ただしOracleを使用する場合は、コメントを外す前に、
MavenのローカルリポジトリにOracleのJDBCドライバをインストールしておく必要がある。</p>
<p>以下は、PostgreSQLを使用する場合の設定例である。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">artifactId/pom.xml</span></code></p></li>
</ul>
<blockquote>
<div><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w">                 </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">                     </span><span class="nt">&lt;groupId&gt;</span>org.postgresql<span class="nt">&lt;/groupId&gt;</span>
<span class="w">                     </span><span class="nt">&lt;artifactId&gt;</span>postgresql<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">                     </span><span class="nt">&lt;version&gt;</span>${postgresql.version}<span class="nt">&lt;/version&gt;</span>
<span class="w">                 </span><span class="nt">&lt;/dependency&gt;</span>
<span class="cm">&lt;!--             &lt;dependency&gt; --&gt;</span>
<span class="cm">&lt;!--                 &lt;groupId&gt;com.oracle&lt;/groupId&gt; --&gt;</span>
<span class="cm">&lt;!--                 &lt;artifactId&gt;ojdbc7&lt;/artifactId&gt; --&gt;</span>
<span class="cm">&lt;!--                 &lt;version&gt;${ojdbc.version}&lt;/version&gt; --&gt;</span>
<span class="cm">&lt;!--             &lt;/dependency&gt; --&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- ... --&gt;</span>

<span class="w">    </span><span class="nt">&lt;postgresql.version&gt;</span>9.3-1102-jdbc41<span class="nt">&lt;/postgresql.version&gt;</span>
<span class="w">    </span><span class="nt">&lt;ojdbc.version&gt;</span>12.1.0.2<span class="nt">&lt;/ojdbc.version&gt;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">artifactId/artifactId-domain/pom.xml</span></code></p></li>
</ul>
<blockquote>
<div><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w">             </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">                 </span><span class="nt">&lt;groupId&gt;</span>org.postgresql<span class="nt">&lt;/groupId&gt;</span>
<span class="w">                 </span><span class="nt">&lt;artifactId&gt;</span>postgresql<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">                 </span><span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span><span class="w"> </span>--&gt;
<span class="w">             </span><span class="nt">&lt;/dependency&gt;</span><span class="w"> </span>--&gt;
<span class="cm">&lt;!--         &lt;dependency&gt; --&gt;</span>
<span class="cm">&lt;!--             &lt;groupId&gt;com.oracle&lt;/groupId&gt; --&gt;</span>
<span class="cm">&lt;!--             &lt;artifactId&gt;ojdbc7&lt;/artifactId&gt; --&gt;</span>
<span class="cm">&lt;!--             &lt;scope&gt;provided&lt;/scope&gt; --&gt;</span>
<span class="cm">&lt;!--         &lt;/dependency&gt; --&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="createwebapplicationprojectconfiguration">
<span id="id16"></span><h2><a class="toc-backref" href="#id43" role="doc-backlink"><span class="section-number">4.1.4. </span>開発プロジェクトの構成</a><a class="headerlink" href="#createwebapplicationprojectconfiguration" title="Permalink to this heading">¶</a></h2>
<p>Maven Archetypeで作成したプロジェクトの構成について説明する。</p>
<p>Maven Archetypeで作成したプロジェクトは、以下の構成になっている。</p>
<ul class="simple">
<li><p>本ガイドラインで推奨しているレイヤ毎のプロジェクト構成</p></li>
<li><p>本ガイドラインで紹介している環境依存性の排除を考慮したプロジェクト構成</p></li>
<li><p>CI(Continuous Integration)を意識したプロジェクト構成</p></li>
</ul>
<p>また、本ガイドラインで推奨している各種設定が盛り込まれた、</p>
<ul class="simple">
<li><p>Webアプリケーションの構成定義ファイル(web.xml)</p></li>
<li><p>Spring FrameworkのBean定義ファイル</p></li>
<li><p>Spring MVC用のBean定義ファイル</p></li>
<li><p>Spring Security用のBean定義ファイル</p></li>
<li><p>O/R Mapperの設定ファイル</p></li>
<li><p>Tiles用の設定ファイル</p></li>
<li><p>プロパティファイル(メッセージ定義ファイルなど)</p></li>
</ul>
<p>と、アプリケーション要件との依存度が低い(=どんなアプリケーションでも作成する必要がある)コンポーネントの簡易実装として、</p>
<ul class="simple">
<li><p>Welcomeページを表示するためのControllerとJSP</p></li>
<li><p>エラー画面を表示するためのJSP(HTML)</p></li>
<li><p>Tiles用のテンプレートJSP</p></li>
<li><p>JSPタグライブラリの読み込み設定などが定義されているインクルード用JSP</p></li>
<li><p>アプリケーション全体の画面スタイルを定義するCSSファイル</p></li>
</ul>
<p>などが提供されている。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>簡易実装として提供しているコンポーネントの扱いについて</strong></p>
<p>簡易実装として提供しているコンポーネントは、以下のいずれかの対応を行うこと。</p>
<ul class="simple">
<li><p>アプリケーション要件にあわせて修正</p></li>
<li><p>不要なコンポーネントは削除</p></li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>REST API用のプロジェクトを作成する場合の手順について</strong></p>
<p>Maven Archetypeで作成したプロジェクトは、
伝統的なWebアプリケーション(リクエストパラメータを受け取ってHTMLを応答するアプリケーション)を構築する際に必要となる推奨設定が行われている。</p>
<p>そのため、JSONやXMLを扱うREST APIを構築する際には不要な設定が存在する。
REST APIを構築するためのプロジェクトを作成する場合は、「<a class="reference internal" href="../ArchitectureInDetail/REST.html"><span class="doc">RESTful Web Service</span></a> の <a class="reference internal" href="../ArchitectureInDetail/REST.html#resthowtouseapplicationsettings"><span class="std std-ref">アプリケーションの設定</span></a>」を参照し、
REST API向けの設定を適用してほしい。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>以降の説明で<code class="docutils literal notranslate"><span class="pre">artifactId</span></code>と表現している部分は、
プロジェクト作成時に指定した<code class="docutils literal notranslate"><span class="pre">artifactId</span></code>に置き換えて読み進めてほしい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="createwebapplicationprojectconfigurationmulti">
<span id="id17"></span><h3><a class="toc-backref" href="#id44" role="doc-backlink"><span class="section-number">4.1.4.1. </span>マルチプロジェクトの構成</a><a class="headerlink" href="#createwebapplicationprojectconfigurationmulti" title="Permalink to this heading">¶</a></h3>
<p>まず、マルチプロジェクト全体の構成について説明する。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">artifactId</span>
<span class="go">    ├── pom.xml  ... (1)</span>
<span class="go">    ├── artifactId-web  ... (2)</span>
<span class="go">    ├── artifactId-domain  ... (3)</span>
<span class="go">    ├── artifactId-env  ... (4)</span>
<span class="go">    ├── artifactId-initdb  ... (5)</span>
<span class="go">    └── artifactId-selenium  ... (6)</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">項番</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">説明</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>マルチプロジェクト全体の構成を定義するPOM(Project Object Model)ファイル。</p>
<p>このファイルでは、主に以下の定義を行う。</p>
<ul class="simple">
<li><p>依存ライブラリのバージョン</p></li>
<li><p>ビルド用のプラグインの設定(ビルド方法の設定)</p></li>
</ul>
<p>マルチプロジェクトの階層関係については、「<a class="reference internal" href="#createwebapplicationprojectappendixprojecthierarchicalstructure"><span class="std std-ref">プロジェクトの階層構造</span></a>」を参照されたい。</p>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>アプリケーション層(Web層)のコンポーネントを管理するモジュール。</p>
<p>このモジュールでは、主に以下のコンポーネントやファイルを管理する。</p>
<ul class="simple">
<li><p>Controllerクラス</p></li>
<li><p>相関チェック用のValidatorクラス</p></li>
<li><p>Formクラス(REST APIの場合はResourceクラス)</p></li>
<li><p>View(JSP)</p></li>
<li><p>CSSファイル</p></li>
<li><p>JavaScriptファイル</p></li>
<li><p>アプリケーション層のコンポーネント用のJUnit</p></li>
<li><p>アプリケーション層のコンポーネントを定義するためのBean定義ファイル</p></li>
<li><p>Webアプリケーションの構成定義ファイル(web.xml)</p></li>
<li><p>メッセージ定義ファイル</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p>ドメイン層のコンポーネントを管理するモジュール。</p>
<p>このモジュールでは、主に以下のコンポーネントやファイルを管理する。</p>
<ul class="simple">
<li><p>Entityなどのドメインオブジェクト</p></li>
<li><p>Repository</p></li>
<li><p>Service</p></li>
<li><p>DTO</p></li>
<li><p>ドメイン層のコンポーネント用のJUnit</p></li>
<li><p>ドメイン層のコンポーネントを定義するためのBean定義ファイル</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><p>環境依存性をもつ設定ファイルを管理するモジュール。</p>
<p>このモジュールでは、主に以下のファイルを管理する。</p>
<ul class="simple">
<li><p>環境依存するコンポーネントを定義するためのBean定義ファイル</p></li>
<li><p>環境依存するプロパティ値を定義するプロパティファイル</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><p>データベースを初期化するためのSQLファイルを管理するモジュール</p>
<p>このモジュールでは、主に以下のファイルを管理する。</p>
<ul class="simple">
<li><p>テーブルなどのデータベースオブジェクトを作成するためのSQLファイル</p></li>
<li><p>マスタデータなどの初期データを投入するためのSQLファイル</p></li>
<li><p>E2E(End To End)テストで使用するテストデータを投入するためのSQLファイル</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><p>Seleniumを使用したE2Eテスト用のコンポーネントを管理するモジュール。</p>
<p>このモジュールでは、主に以下のファイルを管理する。</p>
<ul class="simple">
<li><p>Seleniumを操作してテストを行うJUnit</p></li>
<li><p>Assert時に使用する期待値ファイル(必要に応じて)</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>本ガイドラインにおける「マルチプロジェクト」の用語定義について</strong></p>
<p>Maven Archetypeで作成したプロジェクトは、正確にはマルチモジュール構成のプロジェクトとなる。</p>
<p>本ガイドラインでは、マルチモジュールとマルチプロジェクトを同じ意味で使用していることを補足しておく。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="createwebapplicationprojectconfigurationweb">
<span id="id18"></span><h3><a class="toc-backref" href="#id45" role="doc-backlink"><span class="section-number">4.1.4.2. </span>webモジュールの構成</a><a class="headerlink" href="#createwebapplicationprojectconfigurationweb" title="Permalink to this heading">¶</a></h3>
<p>アプリケーション層(Web層)のコンポーネントを管理するモジュールの構成について説明する。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">artifactId-web</span>
<span class="go">    ├── pom.xml  ... (1)</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">項番</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">説明</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>webモジュールの構成を定義するPOM(Project Object Model)ファイル。
このファイルでは、以下の定義を行う。</p>
<ul class="simple">
<li><p>依存ライブラリとビルド用プラグインの定義</p></li>
<li><p>warファイルを作成するための定義</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>REST API用のプロジェクトを作成する際のwebモジュールのモジュール名について</strong></p>
<p>REST APIを構築する場合は、モジュール名を<code class="docutils literal notranslate"><span class="pre">artifactId-api</span></code>といった感じの名前にしておくと、
アプリケーションの種類が識別しやすくなる。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">└── src</span>
<span class="go">    ├── main</span>
<span class="go">    │   ├── java</span>
<span class="go">    │   │   └── com</span>
<span class="go">    │   │       └── example</span>
<span class="go">    │   │           └── project</span>
<span class="go">    │   │               └── app  ... (2)</span>
<span class="go">    │   │                   └── welcome</span>
<span class="go">    │   │                       └── HelloController.java  ... (3)</span>
<span class="go">    │   ├── resources</span>
<span class="go">    │   │   ├── META-INF</span>
<span class="go">    │   │   │   ├── dozer  ... (4)</span>
<span class="go">    │   │   │   └── spring  ... (5)</span>
<span class="go">    │   │   │       ├── application.properties  ... (6)</span>
<span class="go">    │   │   │       ├── applicationContext.xml  ... (7)</span>
<span class="go">    │   │   │       ├── spring-mvc.xml  ... (8)</span>
<span class="go">    │   │   │       └── spring-security.xml  ... (9)</span>
<span class="go">    │   │   └── i18n  ... (10)</span>
<span class="go">    │   │       └── application-messages.properties  ... (11)</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">項番</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">説明</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>アプリケーション層のクラスを格納するためのパッケージ。</p>
<p>REST APIを構築する場合は、パッケージ名を<code class="docutils literal notranslate"><span class="pre">api</span></code>といった感じの名前にしておくと、
コンポーネントの種類が識別しやすくなる。</p>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p>Welcomeページを表示するためのリクエストを受け取るためのControllerクラス。</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><p>Dozer(Bean Mapper)のマッピング定義ファイルを格納するディレクトリ。
Dozerについては、「<a class="reference internal" href="../ArchitectureInDetail/Utilities/Dozer.html"><span class="doc">Beanマッピング(Dozer)</span></a>」を参照されたい。</p>
<p>作成時点では空のディレクトリである。
マッピングファイルが必要になった場合(高度なマッピングが必要になった場合)は、
このディレクトリ配下に格納すると、自動的にマッピングファイルが読み込まれる。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>このディレクトリには、以下のファイルを格納する。</p>
<ul class="simple">
<li><p>アプリケーション層のJavaBeanとドメイン層のJavaBeanをマッピングするための定義ファイル</p></li>
<li><p>アプリケーション層のJavaBean同士をマッピングするための定義ファイル</p></li>
</ul>
<p>ドメイン層のJavaBean同士のマッピングはドメイン層のディレクトリに格納することを推奨している。</p>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><p>Spring FrameworkのBean定義ファイルとプロパティファイルを格納するディレクトリ。</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><p>アプリケーション層で使用する設定値を定義するプロパティファイル。</p>
<p>作成時点では、空のファイルである。</p>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(7)</div>
</div>
</td>
<td><p>Webアプリケーション用のアプリケーションコンテキストを作成するためのBean定義ファイル。</p>
<p>このファイルには、以下のBeanを定義する。</p>
<ul class="simple">
<li><p>Webアプリケーション全体で使用するコンポーネント</p></li>
<li><p>ドメイン層のコンポーネント(ドメイン層のコンポーネントが定義されているBean定義ファイルをimportする)</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(8)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">DispatcherServlet</span></code>用のアプリケーションコンテキストを作成するためのBean定義ファイル。</p>
<p>このファイルには、以下のBeanを定義する。</p>
<ul class="simple">
<li><p>Spring MVCのコンポーネント</p></li>
<li><p>アプリケーション層のコンポーネント</p></li>
</ul>
<p>REST APIを構築する場合は、ファイル名を<code class="docutils literal notranslate"><span class="pre">spring-mvc-api.xml</span></code>といった感じの名前にしておくと、 アプリケーションの種類が識別しやすくなる。</p>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(9)</div>
</div>
</td>
<td><p>Spring Securityのコンポーネントを定義するためのBean定義ファイル。</p>
<p>このファイルは、Webアプリケーション用のアプリケーションコンテキストを作成する際に読み込む。</p>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(10)</div>
</div>
</td>
<td><p>アプリケーション層で使用するメッセージ定義ファイルを格納するディレクトリ。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(11)</div>
</div>
</td>
<td><p>アプリケーション層で使用するメッセージを定義するプロパティファイル。</p>
<p>作成時点では、いくつかの汎用的なメッセージが定義されている。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>メッセージについては、アプリケーションの要件(メッセージ規約など)にあわせて必ず修正すること。</strong>
メッセージ定義については、「<a class="reference internal" href="../ArchitectureInDetail/MessageManagement.html"><span class="doc">メッセージ管理</span></a>」を参照されたい。</p>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>アプリケーションコンテキストとBean定義ファイルの関連については、
「<a class="reference internal" href="#createwebapplicationprojectappendixapplicationcontext"><span class="std std-ref">アプリケーションコンテキストの構成とBean定義ファイルの関係</span></a>」を参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">│   └── webapp</span>
<span class="go">│       ├── WEB-INF</span>
<span class="go">│       │   ├── tiles  ... (12)</span>
<span class="go">│       │   │   └── tiles-definitions.xml</span>
<span class="go">│       │   ├── views  ... (13)</span>
<span class="go">│       │   │   ├── common</span>
<span class="go">│       │   │   │   ├── error  ... (14)</span>
<span class="go">│       │   │   │   │   ├── accessDeniedError.jsp</span>
<span class="go">│       │   │   │   │   ├── businessError.jsp</span>
<span class="go">│       │   │   │   │   ├── dataAccessError.jsp</span>
<span class="go">│       │   │   │   │   ├── invalidCsrfTokenError.jsp</span>
<span class="go">│       │   │   │   │   ├── missingCsrfTokenError.jsp</span>
<span class="go">│       │   │   │   │   ├── resourceNotFoundError.jsp</span>
<span class="go">│       │   │   │   │   ├── systemError.jsp</span>
<span class="go">│       │   │   │   │   ├── transactionTokenError.jsp</span>
<span class="go">│       │   │   │   │   └── unhandledSystemError.html</span>
<span class="go">│       │   │   │   └── include.jsp  ... (15)</span>
<span class="go">│       │   │   ├── layout  ... (16)</span>
<span class="go">│       │   │   │   ├── header.jsp</span>
<span class="go">│       │   │   │   └── template.jsp</span>
<span class="go">│       │   │   └── welcome</span>
<span class="go">│       │   │       └── home.jsp  ... (17)</span>
<span class="go">│       │   └── web.xml  ... (18)</span>
<span class="go">│       └── resources  ... (19)</span>
<span class="go">│           └── app</span>
<span class="go">│               └── css</span>
<span class="go">│                   └── styles.css  ... (20)</span>
<span class="go">└── test</span>
<span class="go">    ├── java</span>
<span class="go">    └── resources</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">項番</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">説明</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(12)</div>
</div>
</td>
<td><p>Tilesの設定ファイルを格納するディレクトリ。
Tilesの設定ファイルについては、「<a class="reference internal" href="../ArchitectureInDetail/TilesLayout.html"><span class="doc">Tilesによる画面レイアウト</span></a>」を参照されたい。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(13)</div>
</div>
</td>
<td><p>Viewを構築するテンプレートファイル(JSPなど)を格納するディレクトリ。</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(14)</div>
</div>
</td>
<td><p>エラー画面を表示するためのJSP及びHTMLを格納するディレクトリ。</p>
<p>作成時点では、アプリケーション実行時に発生する可能性があるエラーに対応するJSP(HTML)が格納されている。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>エラー画面用のJSP及びHTMLについては、アプリケーションの要件(UI規約など)にあわせて必ず修正すること。</strong></p>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(15)</div>
</div>
</td>
<td><p>インクルード用の共通JSPファイル。</p>
<p>このファイルは、全てのJSPファイルの先頭にインクルードされる。
インクルード用の共通JSPファイルについては、「<a class="reference internal" href="ApplicationLayer.html#view-jsp-include-label"><span class="std std-ref">インクルード用の共通JSPの作成</span></a>」を参照されたい。</p>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(16)</div>
</div>
</td>
<td><p>Tilesのレイアウト用のJSPファイルを格納するディレクトリ。
Tilesのレイアウト用のJSPファイルについては、「<a class="reference internal" href="../ArchitectureInDetail/TilesLayout.html"><span class="doc">Tilesによる画面レイアウト</span></a>」を参照されたい。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(17)</div>
</div>
</td>
<td><p>Welcomeページを表示するJSPファイル。</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(18)</div>
</div>
</td>
<td><p>Webアプリケーションの構成定義ファイル。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(19)</div>
</div>
</td>
<td><p>静的なリソースファイルを格納するディレクトリ。</p>
<p>このディレクトリは、リクエストの内容によって応答する内容がかわらないファイルを格納する。
具体的には以下のファイルを格納する。</p>
<ul class="simple">
<li><p>JavaScriptファイル</p></li>
<li><p>CSSファイル</p></li>
<li><p>画像ファイル</p></li>
<li><p>HTMLファイル</p></li>
</ul>
<p>Spring MVCが提供する静的リソースの管理メカニズムを適用しやすくするために、
専用のディレクトリを設ける構成を採用している。</p>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(20)</div>
</div>
</td>
<td><p>アプリケーション全体に適用する画面スタイルを定義するCSSファイル。</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="domain">
<span id="createwebapplicationprojectconfigurationdomain"></span><h3><a class="toc-backref" href="#id46" role="doc-backlink"><span class="section-number">4.1.4.3. </span>domainモジュールの構成</a><a class="headerlink" href="#domain" title="Permalink to this heading">¶</a></h3>
<p>ドメイン層のコンポーネントを管理するモジュールの構成について説明する。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">artifactId-domain</span>
<span class="go">    ├── pom.xml  ... (1)</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">項番</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">説明</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>domainモジュールの構成を定義するPOM(Project Object Model)ファイル。
このファイルでは、以下の定義を行う。</p>
<ul class="simple">
<li><p>依存ライブラリとビルド用プラグインの定義</p></li>
<li><p>jarファイルを作成するための定義</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">└── src</span>
<span class="go">    ├── main</span>
<span class="go">    │   ├── java</span>
<span class="go">    │   │   └── com</span>
<span class="go">    │   │       └── example</span>
<span class="go">    │   │           └── project</span>
<span class="go">    │   │               └── domain  ... (2)</span>
<span class="go">    │   │                   ├── model</span>
<span class="go">    │   │                   ├── repository</span>
<span class="go">    │   │                   └── service</span>
<span class="go">    │   └── resources</span>
<span class="go">    │       └── META-INF</span>
<span class="go">    │           ├── dozer  ... (3)</span>
<span class="go">    │           └── spring  ... (4)</span>
<span class="go">    │               ├── artifactId-codelist.xml  ... (5)</span>
<span class="go">    │               ├── artifactId-domain.xml  ... (6)</span>
<span class="go">    │               └── artifactId-infra.xml  ... (7)</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">項番</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">説明</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>ドメイン層のクラスを格納するためのパッケージ。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p>Dozer(Bean Mapper)のマッピング定義ファイルを格納するディレクトリ。
Dozerについては、「<a class="reference internal" href="../ArchitectureInDetail/Utilities/Dozer.html"><span class="doc">Beanマッピング(Dozer)</span></a>」を参照されたい。</p>
<p>作成時点では空のディレクトリである。
マッピングファイルが必要になった場合(高度なマッピングが必要になった場合)は、
このディレクトリ配下に格納すると、自動的にマッピングファイルが読み込まれる。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>このディレクトリには、以下のファイルを格納する。</p>
<ul class="simple">
<li><p>ドメイン層のJavaBean同士をマッピングするための定義ファイル</p></li>
</ul>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><p>Spring FrameworkのBean定義ファイルとプロパティファイルを格納するディレクトリ。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><p>コードリストを定義するためのBean定義ファイル。</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><p>ドメイン層のコンポーネントを定義するためのBean定義ファイル。</p>
<p>このファイルには、以下のBeanを定義する。</p>
<ul class="simple">
<li><p>ドメイン層のコンポーネント(Service, Repositoryなど)</p></li>
<li><p>インフラストラクチャ層のコンポーネント(インフラストラクチャ層のコンポーネントが定義されているBean定義ファイルをimportする)</p></li>
<li><p>Spring Frameworkから提供されているトランザクション管理用のコンポーネント</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(7)</div>
</div>
</td>
<td><p>インフラストラクチャ層のコンポーネントを定義するためのBean定義ファイル。</p>
<p>このファイルには、O/R MapperなどのBean定義を行う。</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">└── test</span>
<span class="go">    ├── java</span>
<span class="go">    │   └── com</span>
<span class="go">    │       └── example</span>
<span class="go">    │           └── project</span>
<span class="go">    │               └── domain</span>
<span class="go">    │                   ├── repository</span>
<span class="go">    │                   └── service</span>
<span class="go">    └── resources</span>
<span class="go">        └── test-context.xml  ... (8)</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">項番</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">説明</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(8)</div>
</div>
</td>
<td><p>ドメイン層のユニットテスト用のコンポーネントを定義するためのBean定義ファイル。</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>MyBatis3用のプロジェクトを作成した場合</strong></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">└── src</span>
<span class="go">    ├── main</span>
<span class="go">    │   ├── java</span>
<span class="go">   (...)</span>
<span class="go">    │   └── resources</span>
<span class="go">    │       ├── META-INF</span>
<span class="go">    │       │   ├── dozer</span>
<span class="go">    │       │   ├── mybatis  ... (9)</span>
<span class="go">    │       │   │   └── mybatis-config.xml  ... (10)</span>
<span class="go">    │       │   └── spring</span>
<span class="go">   (...)</span>
<span class="go">    │       └── com</span>
<span class="go">    │           └── example</span>
<span class="go">    │               └── project</span>
<span class="go">    │                   └── domain</span>
<span class="go">    │                       └── repository  ... (11)</span>
<span class="go">    │                           └── sample</span>
<span class="go">    │                               └── SampleRepository.xml  ... (12)</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">項番</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">説明</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(9)</div>
</div>
</td>
<td><p>MyBatis3の設定ファイルを格納するディレクトリ。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(10)</div>
</div>
</td>
<td><p>MyBatis3の設定ファイル。</p>
<p>作成時点では、いくつかの推奨設定が定義されている。</p>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(11)</div>
</div>
</td>
<td><p>MyBatis3のMapperファイルを格納するディレクトリ。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(12)</div>
</div>
</td>
<td><p>MyBatis3のMapperファイルのサンプルファイル。</p>
<p>作成時点では、サンプル実装がコメントアウトされた状態になっている。
<strong>このファイルは最終的には不要なファイルである。</strong></p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="env">
<span id="createwebapplicationprojectconfigurationenv"></span><h3><a class="toc-backref" href="#id47" role="doc-backlink"><span class="section-number">4.1.4.4. </span>envモジュールの構成</a><a class="headerlink" href="#env" title="Permalink to this heading">¶</a></h3>
<p>環境依存性をもつ設定ファイルを管理するモジュールの構成について説明する。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">artifactId-env</span>
<span class="go">    ├── configs  ... (1)</span>
<span class="go">    │   ├── production-server  ... (2)</span>
<span class="go">    │   │   └── resources</span>
<span class="go">    │   └── test-server</span>
<span class="go">    │       └── resources</span>
<span class="go">    ├── pom.xml  ... (3)</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">項番</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">説明</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>環境依存する設定ファイルを管理するためのディレクトリ。</p>
<p>環境毎にサブディレクトリを作成し、環境依存する設定ファイルを管理する。</p>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>環境毎の設定ファイルを管理するためのディレクトリ。</p>
<p>作成時点では、最もシンプルな構成として、以下のディレクトリ(雛形のディレクトリ)が用意されている。</p>
<ul class="simple">
<li><p>production-server (商用環境向けの設定ファイルを格納するディレクトリ)</p></li>
<li><p>test-server (テスト環境向けの設定ファイルを格納するディレクトリ)</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p>envモジュールの構成を定義するPOM(Project Object Model)ファイル。
このファイルでは、以下の定義を行う。</p>
<ul class="simple">
<li><p>依存ライブラリとビルド用プラグインの定義</p></li>
<li><p>環境毎のjarファイルを作成するためのProfileの定義</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">└── src</span>
<span class="go">    └── main</span>
<span class="go">        └── resources  ... (4)</span>
<span class="go">            ├── META-INF</span>
<span class="go">            │   └── spring</span>
<span class="go">            │       ├── artifactId-env.xml  ... (5)</span>
<span class="go">            │       └── artifactId-infra.properties  ... (6)</span>
<span class="go">            ├── database  ... (7)</span>
<span class="go">            │   ├── H2-dataload.sql</span>
<span class="go">            │   └── H2-schema.sql</span>
<span class="go">            ├── dozer.properties  ... (8)</span>
<span class="go">            ├── log4jdbc.properties  ... (9)</span>
<span class="go">            └── logback.xml  ... (10)</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">項番</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">説明</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><p>開発用の設定ファイルを管理するためのディレクトリ。</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><p>環境依存するコンポーネントを定義するBean定義ファイル。</p>
<p>このファイルには、以下のBeanを定義する。</p>
<ul class="simple">
<li><p>データソース</p></li>
<li><p>共通ライブラリから提供している<code class="docutils literal notranslate"><span class="pre">JodaTimeDateFactory</span></code>(環境によって異なる実装を使用する場合)</p></li>
<li><p>Spring Frameworkから提供されているトランザクション管理用のコンポーネント (環境によって異なる実装を使用する場合)</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><p>環境依存する設定値を定義するプロパティファイル。</p>
<p>作成時点では、データソースの設定値(接続情報とコネクションプールの設定値)が定義されている。</p>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(7)</div>
</div>
</td>
<td><p>インメモリデータベース(H2 Database)をセットアップするためのSQLを格納するディレクトリ。</p>
<p>このディレクトリは、ちょっとした動作検証を行う時のために用意しているディレクトリである。
<strong>実際のアプリケーション開発で使用することは想定していないので、基本的にはこのディレクトリは削除すること。</strong></p>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(8)</div>
</div>
</td>
<td><p>Dozer(Bean Mapper)のグローバル設定を行うためのプロパティファイル。
Dozerについては、「<a class="reference internal" href="../ArchitectureInDetail/Utilities/Dozer.html"><span class="doc">Beanマッピング(Dozer)</span></a>」を参照されたい。</p>
<p>作成時点では、空のファイルである。(ファイルがないと起動時に警告ログが出力されるため、これを防ぐために空のファイルを用意している)</p>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(9)</div>
</div>
</td>
<td><p>Log4jdbc-remix(JDBC関連のログ出力を行うライブラリ)のグローバル設定を行うためのプロパティファイル。
Log4jdbc-remixについては、「<a class="reference internal" href="../ArchitectureInDetail/DataAccessCommon.html#dataaccesscommondatasourcedebug"><span class="std std-ref">JDBCのDebug用ログの設定</span></a>」を参照されたい。</p>
<p>作成時点では、ログに出力するSQLの改行に関する設定のみ指定されている。</p>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(10)</div>
</div>
</td>
<td><p>Logback(ログ出力)の設定ファイル。
ログ出力については、「<a class="reference internal" href="../ArchitectureInDetail/Logging.html"><span class="doc">ロギング</span></a>」を参照されたい。</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="initdb">
<span id="createwebapplicationprojectconfigurationinitdb"></span><h3><a class="toc-backref" href="#id48" role="doc-backlink"><span class="section-number">4.1.4.5. </span>initdbモジュールの構成</a><a class="headerlink" href="#initdb" title="Permalink to this heading">¶</a></h3>
<p>データベースを初期化するためのSQLファイルを管理するモジュールの構成について説明する。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">artifactId-initdb</span>
<span class="go">    ├── pom.xml  ... (1)</span>
<span class="go">    └── src</span>
<span class="go">        └── main</span>
<span class="go">            └── sqls  ... (2)</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">項番</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">説明</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>initdbモジュールの構成を定義するPOM(Project Object Model)ファイル。
このファイルでは、以下の定義を行う。</p>
<ul class="simple">
<li><p>ビルド用プラグイン(<a class="reference external" href="http://www.mojohaus.org/sql-maven-plugin/">SQL Maven Plugin</a>)の定義</p></li>
</ul>
<p>作成時点では、PostgreSQL用の雛形設定が定義されている。</p>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>データベースを初期化するためのSQLファイルを格納するためのディレクトリ。</p>
<p>作成時点では、空のディレクトリである。
作成例については、<a class="reference external" href="https://github.com/terasolunaorg/terasoluna-tourreservation-mybatis3/tree/master/terasoluna-tourreservation-initdb/src/main/sqls/">サンプルアプリケーションのinitdbプロジェクト</a> を参照されたい。</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="http://www.mojohaus.org/sql-maven-plugin/">SQL Maven Plugin</a> の <a class="reference external" href="http://www.mojohaus.org/sql-maven-plugin/execute-mojo.html">sql:execute</a> を使用して、SQLを実行できる。</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mvn sql:execute</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="selenium">
<span id="createwebapplicationprojectconfigurationselenium"></span><h3><a class="toc-backref" href="#id49" role="doc-backlink"><span class="section-number">4.1.4.6. </span>seleniumモジュールの構成</a><a class="headerlink" href="#selenium" title="Permalink to this heading">¶</a></h3>
<p>Seleniumを使用したE2E(End To End)テスト用のコンポーネントを管理するモジュールの構成について説明する。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">artifactId-selenium</span>
<span class="go">    ├── pom.xml  ... (1)</span>
<span class="go">    └── src</span>
<span class="go">        └── test  ... (2)</span>
<span class="go">            ├── java</span>
<span class="go">            └── resources</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">項番</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">説明</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>seleniumモジュールの構成を定義するPOM(Project Object Model)ファイル。</p>
<p>このファイルでは、以下の定義を行う。</p>
<ul class="simple">
<li><p>依存ライブラリとビルド用プラグインの定義</p></li>
<li><p>jarファイルを作成するための定義</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>テスト用のコンポーネントと設定ファイルを格納するディレクトリ。</p>
<p>作成例については、<a class="reference external" href="https://github.com/terasolunaorg/terasoluna-tourreservation-mybatis3/tree/master/terasoluna-tourreservation-selenium">サンプルアプリケーションのseleniumプロジェクト</a> を参照されたい。</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="appendix">
<span id="createwebapplicationprojectappendix"></span><h2><a class="toc-backref" href="#id50" role="doc-backlink"><span class="section-number">4.1.5. </span>Appendix</a><a class="headerlink" href="#appendix" title="Permalink to this heading">¶</a></h2>
<section id="createwebapplicationprojectappendixprojecthierarchicalstructure">
<span id="id22"></span><h3><a class="toc-backref" href="#id51" role="doc-backlink"><span class="section-number">4.1.5.1. </span>プロジェクトの階層構造</a><a class="headerlink" href="#createwebapplicationprojectappendixprojecthierarchicalstructure" title="Permalink to this heading">¶</a></h3>
<p>Maven Archetypeで作成したプロジェクトのプロジェクト階層の構造を以下に示す。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/CreateWebApplicationProjectHierarchicalStructure.png"><img alt="../_images/CreateWebApplicationProjectHierarchicalStructure.png" src="../_images/CreateWebApplicationProjectHierarchicalStructure.png" style="width: 100%;" /></a>
</figure>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">項番</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">説明</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>Maven Archetypeで作成したプロジェクト。</p>
<p>Maven Archetypeで作成したプロジェクトはマルチモジュール構成となっており、
親プロジェクトと各サブモジュールは相互参照の関係になっている。</p>
<p>version 5.0.2.RELEASE用のMaven Archetypeで作成したプロジェクトでは、
親プロジェクトとして「org.terasoluna.gfw:terasoluna-gfw-parent:5.0.2.RELEASE」を指定している。</p>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p>TERASOLUNA Server Framework for Java (5.x) Parentプロジェクト。</p>
<p>TERASOLUNA Server Framework for Java (5.x) Parentプロジェクトでは、</p>
<ul class="simple">
<li><p>ビルド用のプラグインの設定</p></li>
<li><p>Spring IO Platform経由で管理されているライブラリのカスタマイズ(バージョンの調整)</p></li>
<li><p>Spring IO Platformで管理されていない推奨ライブラリのバージョン管理</p></li>
</ul>
<p>を行っている。</p>
<p>なお、Spring IO Platform経由で依存ライブラリのバージョンを管理するために、本プロジェクトの<code class="docutils literal notranslate"><span class="pre">&lt;dependencyManagement&gt;</span></code>に「io.spring.platform:platform-bom:1.1.3.RELEASE」をインポートしている。</p>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p>Spring IO Platformプロジェクト。</p>
<p>親プロジェクトとして「org.springframework.boot:spring-boot-starter-parent:1.2.5.RELEASE」が指定されているため、spring-boot-starter-parentのpomファイルに定義されている<code class="docutils literal notranslate"><span class="pre">&lt;dependencyManagement&gt;</span></code>の定義も、terasoluna-gfw-parentのpomファイルにインポートされる。</p>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><p>Spring Boot Starter Parentプロジェクト。</p>
<p>親プロジェクトとして「org.springframework.boot:spring-boot-dependencies:1.2.5.RELEASE」が指定されているため、spring-boot-dependenciesのpomファイルに定義されている<code class="docutils literal notranslate"><span class="pre">&lt;dependencyManagement&gt;</span></code>の定義も、terasoluna-gfw-parentのpomファイルにインポートされる。</p>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><p>Spring Boot Dependenciesプロジェクト。</p></td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>version 5.0.0.RELEASEより、Spring IO Platformの<code class="docutils literal notranslate"><span class="pre">&lt;dependencyManagement&gt;</span></code>をインポートする構成に変更しており、
推奨ライブラリのバージョン管理をSpring IO Platformに委譲するスタイルを採用している。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>version 5.0.0.RELEASEより、Spring IO Platformの<code class="docutils literal notranslate"><span class="pre">&lt;dependencyManagement&gt;</span></code>をインポートする構成に変更したため、
子プロジェクトからライブラリのバージョンを管理するためのプロパティにアクセスする事が出来なくなっている。</p>
<p>そのため、子プロジェクト側でプロパティ値を参照又は上書きしている場合は、version 1.0.xからバージョンアップする際にpomファイルの修正が必要になる。</p>
<p>なお、Spring IO Platformで管理していない推奨ライブラリ(TERASOLUNA Server Framework for Java (5.x)独自の推奨ライブラリ)については、
従来通りバージョンを管理するためのプロパティにアクセスする事ができる。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="bean">
<span id="createwebapplicationprojectappendixapplicationcontext"></span><h3><a class="toc-backref" href="#id52" role="doc-backlink"><span class="section-number">4.1.5.2. </span>アプリケーションコンテキストの構成とBean定義ファイルの関係</a><a class="headerlink" href="#bean" title="Permalink to this heading">¶</a></h3>
<p>Spring Frameworkのアプリケーションコンテキスト(DIコンテナ)の構成とBean定義ファイルの関係を以下に示す。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/CreateWebApplicationProjectApplicationContext.png"><img alt="../_images/CreateWebApplicationProjectApplicationContext.png" src="../_images/CreateWebApplicationProjectApplicationContext.png" style="width: 100%;" /></a>
</figure>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">項番</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">説明</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>Webアプリケーション用のアプリケーションコンテキスト。</p>
<p>上記図で示す通り、</p>
<ul class="simple">
<li><p>artifactId-web/src/main/resource/META-INF/spring/applicationContext.xml</p></li>
<li><p>artifactId-domain/src/main/resource/META-INF/spring/artifactId-domain.xml</p></li>
<li><p>artifactId-domain/src/main/resource/META-INF/spring/artifactId-infra.xml</p></li>
<li><p>artifactId-env/src/main/resource/META-INF/spring/artifactId-env.xml</p></li>
<li><p>artifactId-domain/src/main/resource/META-INF/spring/artifactId-codelist.xml</p></li>
<li><p>artifactId-web/src/main/resource/META-INF/spring/spring-security.xml</p></li>
</ul>
<p>で定義したコンポーネントがWebアプリケーション用のアプリケーションコンテキスト(DIコンテナ)に登録される。</p>
<p>Webアプリケーション用のアプリケーションコンテキストに登録されているコンポーネントは、
各<code class="docutils literal notranslate"><span class="pre">DispatcherServlet</span></code>用のアプリケーションコンテキストから参照する事ができる仕組みとなっている。</p>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">DispatcherServlet</span></code>用のアプリケーションコンテキスト。</p>
<p>上記図で示す通り、</p>
<ul class="simple">
<li><p>artifactId-web/src/main/resource/META-INF/spring/spring-mvc.xml</p></li>
</ul>
<p>で定義したコンポーネントが<code class="docutils literal notranslate"><span class="pre">DispatcherServlet</span></code>用のアプリケーションコンテキスト(DIコンテナ)に登録される。</p>
<p><code class="docutils literal notranslate"><span class="pre">DispatcherServlet</span></code>用のアプリケーションコンテキストに存在しないコンポーネントは、
Webアプリケーション用のアプリケーションコンテキスト(親コンテキスト)を参照して取得する仕組みになっているため、
ドメイン層のコンポーネントをアプリケーション層のコンポーネントに対してインジェクションする事ができる。</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>同じコンポーネントを両方のアプリケーションコンテキストに登録した時の動作について</strong></p>
<p>Webアプリケーション用のアプリケーションコンテキストと<code class="docutils literal notranslate"><span class="pre">DispatcherServlet</span></code>用のアプリケーションコンテキストの両方に同じコンポーネントが登録されている場合は、
同じアプリケーションコンテキスト(<code class="docutils literal notranslate"><span class="pre">DispatcherServlet</span></code>用のアプリケーションコンテキスト)内に登録されているコンポーネントがインジェクションされる点を補足しておく。</p>
<p>特に、ドメイン層のコンポーネント(ServiceやRepositoryなど)を<code class="docutils literal notranslate"><span class="pre">DispatcherServlet</span></code>用のアプリケーションコンテキストに登録しないように注意する必要である。</p>
<p>ドメイン層のコンポーネントを<code class="docutils literal notranslate"><span class="pre">DispatcherServlet</span></code>用のアプリケーションコンテキストに登録してしまうと、
トランザクション制御を行うコンポーネント(AOP)が有効にならないため、データベースへの操作がコミットされない不具合が発生してしまう。</p>
<p>なお、Maven Archetypeで作成したプロジェクトでは、上記のような現象は発生しないように設定が行われている。
設定の追加又は変更を行う場合は、注意してほしい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="createwebapplicationprojectappendixdescribeconfigurationfile">
<span id="id23"></span><h3><a class="toc-backref" href="#id53" role="doc-backlink"><span class="section-number">4.1.5.3. </span>設定ファイルの解説</a><a class="headerlink" href="#createwebapplicationprojectappendixdescribeconfigurationfile" title="Permalink to this heading">¶</a></h3>
<div class="admonition-todo admonition" id="id24">
<p class="admonition-title">Todo</p>
<p>各種設定が意味することの理解度を高めるために、設定ファイルの解説を追加する予定である。</p>
<ul class="simple">
<li><p>機能詳細に説明があるものについては、機能詳細への参照を記載する。</p></li>
<li><p>機能詳細に記載がないものについては、ここに説明を記載する。</p></li>
</ul>
<p>具体的な対応時期は未定。</p>
</div>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="DomainLayer.html" title="4.2. ドメイン層の実装"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="4. TERASOLUNA Server Framework for Java (5.x)によるアプリケーション開発"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.0.2.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" ><span class="section-number">4. </span>TERASOLUNA Server Framework for Java (5.x)によるアプリケーション開発</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">4.1. </span>Webアプリケーション向け開発プロジェクトの作成</a></li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013-2016, NTT DATA.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 5.3.0.Theme by <a href="http://github.com/vkvn">vkvn</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>