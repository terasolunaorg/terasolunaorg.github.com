<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>5.7. Exception Handling &mdash; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.0.2.RELEASE documentation</title>
    
    <link rel="stylesheet" href="../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.0.2.RELEASE',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.0.2.RELEASE documentation" href="../index.html" />
    <link rel="up" title="5. Architecture in Detail - TERASOLUNA Server Framework for Java (5.x)" href="index.html" />
    <link rel="next" title="5.8. Session Management" href="SessionManagement.html" />
    <link rel="prev" title="5.6. Logging" href="Logging.html" /><script src="../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../_static/solarized-dark.css" rel="stylesheet">
<link href="../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="SessionManagement.html" title="5.8. Session Management"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Logging.html" title="5.6. Logging"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.0.2.RELEASE documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">5. Architecture in Detail - TERASOLUNA Server Framework for Java (5.x)</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">5.7. Exception Handling</a><ul>
<li><a class="reference internal" href="#overview">5.7.1. Overview</a><ul>
<li><a class="reference internal" href="#classification-of-exceptions">5.7.1.1. Classification of exceptions</a></li>
<li><a class="reference internal" href="#exception-handling-methods">5.7.1.2. Exception handling methods</a></li>
</ul>
</li>
<li><a class="reference internal" href="#detail">5.7.2. Detail</a><ul>
<li><a class="reference internal" href="#types-of-exceptions">5.7.2.1. Types of exceptions</a><ul>
<li><a class="reference internal" href="#business-exception">5.7.2.1.1. Business exception</a></li>
<li><a class="reference internal" href="#library-exceptions-that-occurs-during-normal-operation">5.7.2.1.2. Library exceptions that occurs during normal operation</a></li>
<li><a class="reference internal" href="#system-exception">5.7.2.1.3. System Exception</a></li>
<li><a class="reference internal" href="#unexpected-system-exception">5.7.2.1.4. Unexpected System Exception</a></li>
<li><a class="reference internal" href="#fatal-errors">5.7.2.1.5. Fatal Errors</a></li>
<li><a class="reference internal" href="#framework-exception-in-case-of-invalid-requests">5.7.2.1.6. Framework exception in case of invalid requests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exception-handling-patterns">5.7.2.2. Exception Handling Patterns</a><ul>
<li><a class="reference internal" href="#when-notifying-partial-redo-of-a-use-case-from-middle">5.7.2.2.1. When notifying partial redo of a use case (from middle)</a></li>
<li><a class="reference internal" href="#when-notifying-redo-of-a-use-case-from-beginning">5.7.2.2.2. When notifying redo of a use case (from beginning)</a></li>
<li><a class="reference internal" href="#when-notifying-that-the-system-or-application-is-not-in-a-normal-state">5.7.2.2.3. When notifying that the system or application is not in a normal state</a></li>
<li><a class="reference internal" href="#when-notifying-that-the-request-contents-are-invalid">5.7.2.2.4. When notifying that the request contents are invalid</a></li>
<li><a class="reference internal" href="#when-a-fatal-error-has-been-detected">5.7.2.2.5. When a fatal error has been detected</a></li>
<li><a class="reference internal" href="#when-notifying-that-an-exception-has-occurred-in-the-presentation-layer-jsp-etc">5.7.2.2.6. When notifying that an exception has occurred in the presentation layer (JSP etc.)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#basic-flow-of-exception-handling">5.7.2.3. Basic Flow of Exception Handling</a><ul>
<li><a class="reference internal" href="#basic-flow-when-the-controller-class-handles-the-exception-at-request-level">5.7.2.3.1. Basic flow when the Controller class handles the exception at request level</a></li>
<li><a class="reference internal" href="#basic-flow-when-the-controller-class-handles-the-exception-at-use-case-level">5.7.2.3.2. Basic flow when the Controller class handles the exception at use case level</a></li>
<li><a class="reference internal" href="#basic-flow-when-the-framework-handles-the-exception-at-servlet-level">5.7.2.3.3. Basic flow when the framework handles the exception at servlet level</a></li>
<li><a class="reference internal" href="#basic-flow-when-the-servlet-container-handles-the-exception-at-web-application-level">5.7.2.3.4. Basic flow when the servlet container handles the exception at web application level</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use">5.7.3. How to use</a><ul>
<li><a class="reference internal" href="#application-settings">5.7.3.1. Application Settings</a><ul>
<li><a class="reference internal" href="#common-settings">5.7.3.1.1. Common Settings</a></li>
<li><a class="reference internal" href="#domain-layer-settings">5.7.3.1.2. Domain Layer Settings</a></li>
<li><a class="reference internal" href="#application-layer-settings">5.7.3.1.3. Application Layer Settings</a></li>
<li><a class="reference internal" href="#servlet-container-settings">5.7.3.1.4. Servlet Container Settings</a></li>
</ul>
</li>
<li><a class="reference internal" href="#coding-points-service">5.7.3.2. Coding Points (Service)</a><ul>
<li><a class="reference internal" href="#generating-business-exception">5.7.3.2.1. Generating Business Exception</a></li>
<li><a class="reference internal" href="#generating-system-exception">5.7.3.2.2. Generating System Exception</a></li>
<li><a class="reference internal" href="#catch-the-exception-to-continue-the-execution">5.7.3.2.3. Catch the exception to continue the execution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#coding-points-controller">5.7.3.3. Coding Points (Controller)</a><ul>
<li><a class="reference internal" href="#method-to-handle-exceptions-at-request-level">5.7.3.3.1. Method to handle exceptions at request level</a></li>
<li><a class="reference internal" href="#method-to-handle-exception-at-use-case-level">5.7.3.3.2. Method to handle exception at use case level</a></li>
</ul>
</li>
<li><a class="reference internal" href="#coding-points-jsp">5.7.3.4. Coding points (JSP)</a><ul>
<li><a class="reference internal" href="#method-to-display-messages-on-screen-using-messagespaneltag">5.7.3.4.1. Method to display messages on screen using MessagesPanelTag</a></li>
<li><a class="reference internal" href="#method-to-display-system-exception-code-on-screen">5.7.3.4.2. Method to display system exception code on screen</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use-ajax">5.7.4. How to use (Ajax)</a></li>
<li><a class="reference internal" href="#appendix">5.7.5. Appendix</a><ul>
<li><a class="reference internal" href="#exception-handling-classes-provided-by-the-common-library">5.7.5.1. Exception handling classes provided by the common library</a></li>
<li><a class="reference internal" href="#about-systemexceptionresolver-settings">5.7.5.2. About SystemExceptionResolver settings</a><ul>
<li><a class="reference internal" href="#attribute-name-of-result-message">5.7.5.2.1. Attribute name of result message</a></li>
<li><a class="reference internal" href="#attribute-name-of-exception-code-message-id">5.7.5.2.2. Attribute name of exception code (message ID)</a></li>
<li><a class="reference internal" href="#header-name-of-exception-code-message-id">5.7.5.2.3. Header name of exception code (message ID)</a></li>
<li><a class="reference internal" href="#attribute-name-of-exception-object">5.7.5.2.4. Attribute name of exception object</a></li>
<li><a class="reference internal" href="#cache-control-flag-of-http-response">5.7.5.2.5. Cache control flag of HTTP response</a></li>
</ul>
</li>
<li><a class="reference internal" href="#about-handlerexceptionresolverlogginginterceptor-settings">5.7.5.3. About HandlerExceptionResolverLoggingInterceptor settings</a><ul>
<li><a class="reference internal" href="#list-of-exception-classes-to-be-excluded-from-scope-of-logging">5.7.5.3.1. List of exception classes to be excluded from scope of logging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#http-response-code-set-by-defaulthandlerexceptionresolver">5.7.5.4. HTTP response code set by DefaultHandlerExceptionResolver</a></li>
</ul>
</li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="Logging.html"
                        title="previous chapter">5.6. Logging</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="SessionManagement.html"
                        title="next chapter">5.8. Session Management</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/ArchitectureInDetail/ExceptionHandling.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="exception-handling">
<h1>5.7. Exception Handling<a class="headerlink" href="#exception-handling" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id21">Overview</a><ul>
<li><a class="reference internal" href="#classification-of-exceptions" id="id22">Classification of exceptions</a></li>
<li><a class="reference internal" href="#exception-handling-methods" id="id23">Exception handling methods</a></li>
</ul>
</li>
<li><a class="reference internal" href="#detail" id="id24">Detail</a><ul>
<li><a class="reference internal" href="#types-of-exceptions" id="id25">Types of exceptions</a><ul>
<li><a class="reference internal" href="#business-exception" id="id26">Business exception</a></li>
<li><a class="reference internal" href="#library-exceptions-that-occurs-during-normal-operation" id="id27">Library exceptions that occurs during normal operation</a></li>
<li><a class="reference internal" href="#system-exception" id="id28">System Exception</a></li>
<li><a class="reference internal" href="#unexpected-system-exception" id="id29">Unexpected System Exception</a></li>
<li><a class="reference internal" href="#fatal-errors" id="id30">Fatal Errors</a></li>
<li><a class="reference internal" href="#framework-exception-in-case-of-invalid-requests" id="id31">Framework exception in case of invalid requests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exception-handling-patterns" id="id32">Exception Handling Patterns</a><ul>
<li><a class="reference internal" href="#when-notifying-partial-redo-of-a-use-case-from-middle" id="id33">When notifying partial redo of a use case (from middle)</a></li>
<li><a class="reference internal" href="#when-notifying-redo-of-a-use-case-from-beginning" id="id34">When notifying redo of a use case (from beginning)</a></li>
<li><a class="reference internal" href="#when-notifying-that-the-system-or-application-is-not-in-a-normal-state" id="id35">When notifying that the system or application is not in a normal state</a></li>
<li><a class="reference internal" href="#when-notifying-that-the-request-contents-are-invalid" id="id36">When notifying that the request contents are invalid</a></li>
<li><a class="reference internal" href="#when-a-fatal-error-has-been-detected" id="id37">When a fatal error has been detected</a></li>
<li><a class="reference internal" href="#when-notifying-that-an-exception-has-occurred-in-the-presentation-layer-jsp-etc" id="id38">When notifying that an exception has occurred in the presentation layer (JSP etc.)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#basic-flow-of-exception-handling" id="id39">Basic Flow of Exception Handling</a><ul>
<li><a class="reference internal" href="#basic-flow-when-the-controller-class-handles-the-exception-at-request-level" id="id40">Basic flow when the Controller class handles the exception at request level</a></li>
<li><a class="reference internal" href="#basic-flow-when-the-controller-class-handles-the-exception-at-use-case-level" id="id41">Basic flow when the Controller class handles the exception at use case level</a></li>
<li><a class="reference internal" href="#basic-flow-when-the-framework-handles-the-exception-at-servlet-level" id="id42">Basic flow when the framework handles the exception at servlet level</a></li>
<li><a class="reference internal" href="#basic-flow-when-the-servlet-container-handles-the-exception-at-web-application-level" id="id43">Basic flow when the servlet container handles the exception at web application level</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use" id="id44">How to use</a><ul>
<li><a class="reference internal" href="#application-settings" id="id45">Application Settings</a><ul>
<li><a class="reference internal" href="#common-settings" id="id46">Common Settings</a></li>
<li><a class="reference internal" href="#domain-layer-settings" id="id47">Domain Layer Settings</a></li>
<li><a class="reference internal" href="#application-layer-settings" id="id48">Application Layer Settings</a></li>
<li><a class="reference internal" href="#servlet-container-settings" id="id49">Servlet Container Settings</a></li>
</ul>
</li>
<li><a class="reference internal" href="#coding-points-service" id="id50">Coding Points (Service)</a><ul>
<li><a class="reference internal" href="#generating-business-exception" id="id51">Generating Business Exception</a></li>
<li><a class="reference internal" href="#generating-system-exception" id="id52">Generating System Exception</a></li>
<li><a class="reference internal" href="#catch-the-exception-to-continue-the-execution" id="id53">Catch the exception to continue the execution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#coding-points-controller" id="id54">Coding Points (Controller)</a><ul>
<li><a class="reference internal" href="#method-to-handle-exceptions-at-request-level" id="id55">Method to handle exceptions at request level</a></li>
<li><a class="reference internal" href="#method-to-handle-exception-at-use-case-level" id="id56">Method to handle exception at use case level</a></li>
</ul>
</li>
<li><a class="reference internal" href="#coding-points-jsp" id="id57">Coding points (JSP)</a><ul>
<li><a class="reference internal" href="#method-to-display-messages-on-screen-using-messagespaneltag" id="id58">Method to display messages on screen using MessagesPanelTag</a></li>
<li><a class="reference internal" href="#method-to-display-system-exception-code-on-screen" id="id59">Method to display system exception code on screen</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use-ajax" id="id60">How to use (Ajax)</a></li>
<li><a class="reference internal" href="#appendix" id="id61">Appendix</a><ul>
<li><a class="reference internal" href="#exception-handling-classes-provided-by-the-common-library" id="id62">Exception handling classes provided by the common library</a></li>
<li><a class="reference internal" href="#about-systemexceptionresolver-settings" id="id63">About SystemExceptionResolver settings</a><ul>
<li><a class="reference internal" href="#attribute-name-of-result-message" id="id64">Attribute name of result message</a></li>
<li><a class="reference internal" href="#attribute-name-of-exception-code-message-id" id="id65">Attribute name of exception code (message ID)</a></li>
<li><a class="reference internal" href="#header-name-of-exception-code-message-id" id="id66">Header name of exception code (message ID)</a></li>
<li><a class="reference internal" href="#attribute-name-of-exception-object" id="id67">Attribute name of exception object</a></li>
<li><a class="reference internal" href="#cache-control-flag-of-http-response" id="id68">Cache control flag of HTTP response</a></li>
</ul>
</li>
<li><a class="reference internal" href="#about-handlerexceptionresolverlogginginterceptor-settings" id="id69">About HandlerExceptionResolverLoggingInterceptor settings</a><ul>
<li><a class="reference internal" href="#list-of-exception-classes-to-be-excluded-from-scope-of-logging" id="id70">List of exception classes to be excluded from scope of logging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#http-response-code-set-by-defaulthandlerexceptionresolver" id="id71">HTTP response code set by DefaultHandlerExceptionResolver</a></li>
</ul>
</li>
</ul>
</div>
<p>This chapter describes exception handling mechanism for web applications created using this guideline.</p>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id21">5.7.1. Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This section illustrates handling of exceptions occurring within the boundary of Spring MVC. The scope of description is as follows:</p>
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="../_images/exception-handling-description-target.png"><img alt="description target" src="../_images/exception-handling-description-target.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text"><strong>Figure - Description Targets</strong></span></p>
</div>
<ol class="arabic simple">
<li><a class="reference internal" href="#exception-handling-class-label"><span>Classification of exceptions</span></a></li>
<li><a class="reference internal" href="#exception-handling-method-label"><span>Exception handling methods</span></a></li>
</ol>
<div class="section" id="classification-of-exceptions">
<span id="exception-handling-class-label"></span><h3><a class="toc-backref" href="#id22">5.7.1.1. Classification of exceptions</a><a class="headerlink" href="#classification-of-exceptions" title="Permalink to this headline">¶</a></h3>
<p>The exceptions that occur when an application is running, can be broadly classified into following 3 categories.</p>
<table border="1" class="docutils" id="id2">
<caption><span class="caption-text"><strong>Table - Types of exceptions that occur when an application is running</strong></span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="10%" />
<col width="30%" />
<col width="30%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Classification</th>
<th class="head">Description</th>
<th class="head"><a class="reference internal" href="#exception-handling-exception-type-label"><span>Types of exceptions</span></a></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Exceptions wherein cause can be resolved if the user re-executes the operation (by changing input values etc.)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The exceptions wherein cause can be resolved if the user re-executes the operation, are handled in application code.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1. <a class="reference internal" href="#exception-handling-exception-type-businessexception-label"><span>Business exception</span></a></div>
<div class="line">2. <a class="reference internal" href="#exception-handling-exception-type-libraryexception-label"><span>Library exceptions that occurs during normal operation</span></a></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Exceptions wherein cause cannot be resolved even if the user re-executes the operation</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The exceptions wherein cause cannot be resolved even if the user re-executes the operation, are handled using the framework.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1. <a class="reference internal" href="#exception-handling-exception-type-systemexception-label"><span>System Exception</span></a></div>
<div class="line">2. <a class="reference internal" href="#exception-handling-exception-type-unexpectedexception-label"><span>Unexpected System Exception</span></a></div>
<div class="line">3. <a class="reference internal" href="#exception-handling-exception-type-error-label"><span>Fatal Errors</span></a></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Exceptions due to invalid requests from the client</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The exceptions which occur due to invalid requests from the client, are handled using the framework.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1. <a class="reference internal" href="#exception-handling-exception-type-request-label"><span>Framework exception in case of invalid requests</span></a></div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Who is a target audience for exceptions?</strong></p>
<ul class="last simple">
<li>Application Developer should be aware of exception (1).</li>
<li>Application Architect should be aware of exceptions (2) and (3).</li>
</ul>
</div>
</div>
<div class="section" id="exception-handling-methods">
<span id="exception-handling-method-label"></span><h3><a class="toc-backref" href="#id23">5.7.1.2. Exception handling methods</a><a class="headerlink" href="#exception-handling-methods" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">The exceptions which occur when the application is running, are handled using following 4 methods.</div>
<div class="line">For details on flow of each handling method, refer to <a class="reference internal" href="#exception-handling-basic-flow-label"><span>Basic Flow of Exception Handling</span></a>.</div>
</div>
<table border="1" class="docutils" id="id3">
<caption><span class="caption-text"><strong>Table - Exception Handling Methods</strong></span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="10%" />
<col width="30%" />
<col width="35%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Handling Method</th>
<th class="head">Description</th>
<th class="head"><a class="reference internal" href="#exception-handling-pattern-label"><span>Exception Handling Patterns</span></a></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use <code class="docutils literal"><span class="pre">try-catch</span></code> in the application code to carry out exception handling.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use this in order to handle exceptions at request (Controller method) level.</div>
<div class="line">For details, refer to <a class="reference internal" href="#exception-handling-basic-flow-catch-label"><span>Basic flow when the Controller class handles the exception at request level</span></a>.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1. <a class="reference internal" href="#exception-handling-class-from-middle-label"><span>When notifying partial redo of a use case (from middle)</span></a></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use <code class="docutils literal"><span class="pre">&#64;ExceptionHandler</span></code> annotation to carry out exception handling in application code.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use this when exceptions are to be handled at use case (Controller) level.</div>
<div class="line">For details, refer to <a class="reference internal" href="#exception-handling-basic-flow-annotation-label"><span>Basic flow when the Controller class handles the exception at use case level</span></a>.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1. <a class="reference internal" href="#exception-handling-class-from-first-label"><span>When notifying redo of a use case (from beginning)</span></a></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use HandlerExceptionResolver mechanism provided by the framework to carry out exception handling.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use this in order to handle exceptions at servlet level.</div>
<div class="line">When <code class="docutils literal"><span class="pre">&lt;mvc:annotation-driven&gt;</span></code> is specified, HandlerExceptionResolver uses <a class="reference internal" href="#exceptionhandling-annotation-driven"><span>automatically registered class</span></a>, and <code class="docutils literal"><span class="pre">SystemExceptionResolver</span></code> provided by common library.</div>
<div class="line">For details, refer to <a class="reference internal" href="#exception-handling-basic-flow-resolver-label"><span>Basic flow when the framework handles the exception at servlet level</span></a>.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1. <a class="reference internal" href="#exception-handling-class-systemerror-label"><span>When notifying that the system or application is not in a normal state</span></a></div>
<div class="line"><br /></div>
<div class="line">2. <a class="reference internal" href="#exception-handling-class-requesterror-label"><span>When notifying that the request contents are invalid</span></a></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use the error-page function of the servlet container to carry out exception handling.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use this in order to handle fatal errors and exceptions which are out of the boundary of Spring MVC.</div>
<div class="line">For details, refer to <a class="reference internal" href="#exception-handling-basic-flow-container-label"><span>Basic flow when the servlet container handles the exception at web application level</span></a>.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1. <a class="reference internal" href="#exception-handling-class-fatalerror-label"><span>When a fatal error has been detected</span></a></div>
<div class="line"><br /></div>
<div class="line">2. <a class="reference internal" href="#exception-handling-class-viewerror-label"><span>When notifying that an exception has occurred in the presentation layer (JSP etc.)</span></a></div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="figure align-center" id="id4">
<a class="reference internal image-reference" href="../_images/exception-handling-method.png"><img alt="handling method" src="../_images/exception-handling-method.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text"><strong>Figure - Exception Handling Methods</strong></span></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Who will carry out exception handling?</strong></p>
<ul class="last simple">
<li>Application Developer should design and implement (1) and (2).</li>
<li>Application Architect should design and configure (3) and (4).</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>About automatically registered HandlerExceptionResolver</strong></p>
<p>When &lt;mvc:annotation-driven&gt; is specified, the roles of HandlerExceptionResolver, which is registered automatically, are as follows:</p>
<p>The priority order will be as given below.</p>
<blockquote class="last" id="exceptionhandling-annotation-driven">
<div><table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="32%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Class (Priority order)</th>
<th class="head">Role</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ExceptionHandlerExceptionResolver</div>
<div class="line">(order=0)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">This is a class for handling the exceptions by calling the methods of Controller class with <code class="docutils literal"><span class="pre">&#64;ExceptionHandler</span></code> annotation.</div>
<div class="line">This class is necessary for implementing the handling method No. 2.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ResponseStatusExceptionResolver</div>
<div class="line">(order=1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">This is a class for handling the exceptions wherein <code class="docutils literal"><span class="pre">&#64;ResponseStatus</span></code> is applied as class level annotation.</div>
<div class="line"><code class="docutils literal"><span class="pre">HttpServletResponse#sendError(int</span> <span class="pre">sc,</span> <span class="pre">String</span> <span class="pre">msg)</span></code> is called with the value specified in <code class="docutils literal"><span class="pre">&#64;ResponseStatus</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">DefaultHandlerExceptionResolver</div>
<div class="line">(order=2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">This is a class for handling framework exceptions in Spring MVC.</div>
<div class="line"><code class="docutils literal"><span class="pre">HttpServletResponse#sendError(int</span> <span class="pre">sc)</span></code> is called using the value of HTTP response code corresponding to framework exception.</div>
<div class="line">For details on HTTP response code to be set, refer to <a class="reference internal" href="#exception-handling-appendix-defaulthandlerexceptionresolver-label"><span>HTTP response code set by DefaultHandlerExceptionResolver</span></a>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>What is a role of SystemExceptionResolver provided by common library?</strong></p>
<p class="last">This is a class for handling exceptions which are not handled by HandlerExceptionResolver
which is registered automatically when &lt;mvc:annotation-driven&gt; is specified.
Therefore, the order of priority of this class should be set after DefaultHandlerExceptionResolver.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>About &#64;ControllerAdvice annotation added from Spring Framework 3.2</strong></p>
<blockquote>
<div><code class="docutils literal"><span class="pre">&#64;ControllerAdvice</span></code> made exception handling possible using <code class="docutils literal"><span class="pre">&#64;ExceptionHandler</span></code> at servlet level.
If methods with <code class="docutils literal"><span class="pre">&#64;ExceptionHandler</span></code> annotation are defined in a class with <code class="docutils literal"><span class="pre">&#64;ControllerAdvice</span></code> annotation, then exception handling carried out in the methods with <code class="docutils literal"><span class="pre">&#64;ExceptionHandler</span></code> annotation can be applied to all the Controllers in Servlet.
When implementing the above in earlier versions, it was necessary to define methods with <code class="docutils literal"><span class="pre">&#64;ExceptionHandler</span></code> annotation in Controller base class
and inherit each Controller from the base class.</div></blockquote>
<p><strong>About attribute of &#64;ControllerAdvice annotation added from Spring Framework 4.0</strong></p>
<blockquote class="last">
<div>By specifying attribute of <code class="docutils literal"><span class="pre">&#64;ControllerAdvice</span></code> annotation,
it has been improved in such a way that Controller that applies a method implemented in class with <code class="docutils literal"><span class="pre">&#64;ControllerAdvice</span></code>, can be specified flexibly.
For details on attribute, refer to <a class="reference internal" href="../ImplementationAtEachLayer/ApplicationLayer.html#application-layer-controller-advice-attribute"><span>attribute of &#64;ControllerAdvice</span></a>.</div></blockquote>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Where to use &#64;ControllerAdvice annotation?</strong></p>
<ol class="last arabic simple">
<li>When logic other than determining the View name and HTTP response code is necessary for exception handling to be carried out at servlet level,
(If only determining View name and HTTP response code is sufficient, it can be implemented using <code class="docutils literal"><span class="pre">SystemExceptionResolver</span></code>)</li>
<li>In case of exception handling carried out at servlet level, when response data is to be created by serializing the error model (JavaBeans) in JSON or XML formats
without using template engines such as JSP.
(Used for error handling at the time of creating Controller for AJAX or REST).</li>
</ol>
</div>
</div>
</div>
<div class="section" id="detail">
<h2><a class="toc-backref" href="#id24">5.7.2. Detail</a><a class="headerlink" href="#detail" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><a class="reference internal" href="#exception-handling-exception-type-label"><span>Types of exceptions</span></a></li>
<li><a class="reference internal" href="#exception-handling-pattern-label"><span>Exception Handling Patterns</span></a></li>
<li><a class="reference internal" href="#exception-handling-basic-flow-label"><span>Basic Flow of Exception Handling</span></a></li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="types-of-exceptions">
<span id="exception-handling-exception-type-label"></span><h3><a class="toc-backref" href="#id25">5.7.2.1. Types of exceptions</a><a class="headerlink" href="#types-of-exceptions" title="Permalink to this headline">¶</a></h3>
<p>There are 6 types of exceptions that occur in a running application.</p>
<table border="1" class="docutils" id="id5">
<caption><span class="caption-text"><strong>Table - Types of Exceptions</strong></span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="17%" />
<col width="33%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Types of Exceptions</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><a class="reference internal" href="#exception-handling-exception-type-businessexception-label"><span>Business exception</span></a></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Exception to notify a violation of a business rule</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><a class="reference internal" href="#exception-handling-exception-type-libraryexception-label"><span>Library exceptions that occurs during normal operation</span></a></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Amongst the exceptions that occur in framework and libraries, the exception which is likely to occur when the system is operating normally.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><a class="reference internal" href="#exception-handling-exception-type-systemexception-label"><span>System Exception</span></a></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Exception to notify detection of a state which should not occur when the system is operating normally</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><a class="reference internal" href="#exception-handling-exception-type-unexpectedexception-label"><span>Unexpected System Exception</span></a></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Unchecked exception that does not occur when the system is operating normally</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><a class="reference internal" href="#exception-handling-exception-type-error-label"><span>Fatal Errors</span></a></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Error to notify an occurrence of a fatal error impacting the entire system (application)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><a class="reference internal" href="#exception-handling-exception-type-request-label"><span>Framework exception in case of invalid requests</span></a></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Exception to notify that the framework has detected invalid request contents</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="section" id="business-exception">
<span id="exception-handling-exception-type-businessexception-label"></span><h4><a class="toc-backref" href="#id26">5.7.2.1.1. Business exception</a><a class="headerlink" href="#business-exception" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line"><strong>Exception to notify a violation of a business rule</strong></div>
<div class="line">This exception is generated in domain layer.</div>
<div class="line">The situations in the system such as below are pre-defined and hence need not be dealt by the system administrator.</div>
</div>
<ul class="simple">
<li>If the reservation date is past the deadline when making travel reservations</li>
<li>If a product is out of stock when it is ordered</li>
<li>etc ...</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Corresponding Exception Class</strong></p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.exception.BusinessException</span></code> (Class provided by common library).</li>
<li>When handling is to be carried out at detailed level, exception class that inherits BusinessException should be created.</li>
<li>If the requirements cannot be met by the  exception class provided by common library, a business exception class should be created for each project.</li>
</ul>
</div>
</div>
<div class="section" id="library-exceptions-that-occurs-during-normal-operation">
<span id="exception-handling-exception-type-libraryexception-label"></span><h4><a class="toc-backref" href="#id27">5.7.2.1.2. Library exceptions that occurs during normal operation</a><a class="headerlink" href="#library-exceptions-that-occurs-during-normal-operation" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Amongst the exceptions that occur in the framework and libraries, <strong>the exception which is likely to occur when the system is operating normally.</strong></div>
<div class="line">The exceptions that occur in the framework and libraries cover the exception classes in Spring Framework or other libraries.</div>
<div class="line">Situations such are below are pre-defined and hence need not be dealt by the system administrator.</div>
</div>
<ul class="simple">
<li>Optimistic locking exception and pessimistic locking exception that occur if multiple users attempt to update same data simultaneously.</li>
<li>Unique constraint violation exception that occurs if multiple users attempt to register same data simultaneously.</li>
<li>etc ...</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Examples of corresponding Exception Classes</strong></p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">org.springframework.dao.OptimisticLockingFailureException</span></code> (Exception that occurs if there is an error due to optimistic locking).</li>
<li><code class="docutils literal"><span class="pre">org.springframework.dao.PessimisticLockingFailureException</span></code> (Exception that occurs if there is an error due to pessimistic locking).</li>
<li><code class="docutils literal"><span class="pre">org.springframework.dao.DuplicateKeyException</span></code> (Exception that occurs if there is a unique constraint violation).</li>
<li>etc ...</li>
</ul>
</div>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p><strong>Currently it has been found that unexpected errors occur if JPA(Hibernate) is used.</strong></p>
<ul class="last simple">
<li>In case of unique constraint violation, <code class="docutils literal"><span class="pre">org.springframework.dao.DataIntegrityViolationException</span></code> occurs and not <code class="docutils literal"><span class="pre">DuplicateKeyException</span></code>.</li>
</ul>
</div>
</div>
<div class="section" id="system-exception">
<span id="exception-handling-exception-type-systemexception-label"></span><h4><a class="toc-backref" href="#id28">5.7.2.1.3. System Exception</a><a class="headerlink" href="#system-exception" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line"><strong>Exception to notify that a state which should not occur when the system is operating normally has been detected</strong>.</div>
<div class="line">This exception should be generated in application layer and domain layer.</div>
<div class="line">The exception needs to be dealt by the system administrator.</div>
</div>
<ul class="simple">
<li>If the master data, directories, files, etc. those should have pre-existed, do not exist</li>
<li>Amongst the checked exceptions that occur in the framework, libraries, if exceptions classified as system errors are caught (IOException during file operations etc.).</li>
<li>etc ...</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Corresponding Exception Class</strong></p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.exception.SystemException</span></code> (Class provided by common library).</li>
<li>When the error screen of View and HTTP response code need to be switched on the basis of the cause of each error, SystemException should be inherited for each error cause and the mapping between the inherited exception class and the error screen should be defined in the bean definition of SystemExceptionResolver.</li>
<li>If the requirements are not met by the system exception class provided in the common library, a system exception class should be created in each respective project.</li>
</ul>
</div>
</div>
<div class="section" id="unexpected-system-exception">
<span id="exception-handling-exception-type-unexpectedexception-label"></span><h4><a class="toc-backref" href="#id29">5.7.2.1.4. Unexpected System Exception</a><a class="headerlink" href="#unexpected-system-exception" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line"><strong>Unchecked exception that does not occur when the system is operating normally.</strong></div>
<div class="line">Action by system administrator or analysis by system developer is necessary.</div>
<div class="line"><strong>Unexpected system exceptions should not be handled (try-catch) in the application code.</strong></div>
</div>
<ul class="simple">
<li>When bugs are hidden in the application, framework or libraries</li>
<li>When DB Server etc. is down</li>
<li>etc ...</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Example of Corresponding Exception Class</strong></p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">java.lang.NullPointerException</span></code> (Exception caused due to bugs).</li>
<li><code class="docutils literal"><span class="pre">org.springframework.dao.DataAccessResourceFailureException</span></code> (Exception that occurs when DB server is down).</li>
<li>etc ...</li>
</ul>
</div>
</div>
<div class="section" id="fatal-errors">
<span id="exception-handling-exception-type-error-label"></span><h4><a class="toc-backref" href="#id30">5.7.2.1.5. Fatal Errors</a><a class="headerlink" href="#fatal-errors" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line"><strong>Error to notify that a fatal problem impacting the entire system (application), has occurred</strong>.</div>
<div class="line">Action/recovery by system administrator or system developer is necessary.</div>
<div class="line"><strong>Fatal Errors (error that inherits java.lang.Error) must not be handled (try-catch) in the application code.</strong></div>
</div>
<ul class="simple">
<li>If the memory available in Java virtual machine is inadequate</li>
<li>etc ...</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Example of corresponding Error Class</strong></p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">java.lang.OutOfMemoryError</span></code> (Error due to inadequate memory).</li>
<li>etc ...</li>
</ul>
</div>
</div>
<div class="section" id="framework-exception-in-case-of-invalid-requests">
<span id="exception-handling-exception-type-request-label"></span><h4><a class="toc-backref" href="#id31">5.7.2.1.6. Framework exception in case of invalid requests</a><a class="headerlink" href="#framework-exception-in-case-of-invalid-requests" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line"><strong>Exception to notify that the framework has detected invalid request contents</strong>.</div>
<div class="line">This exception occurs in the framework (Spring MVC).</div>
<div class="line">The cause lies at client side; hence it need not be dealt by the system administrator.</div>
</div>
<ul class="simple">
<li>Exception that occurs when a request path for which only POST method is permitted, is accessed using GET method.</li>
<li>Exception that occurs when type-conversion fails for the values extracted from URI using &#64;PathVariable annotation.</li>
<li>etc ...</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Example of corresponding Exception Class</strong></p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">org.springframework.web.HttpRequestMethodNotSupportedException</span></code> (Exception that occurs when the access is made through a HTTP method which is not supported).</li>
<li><code class="docutils literal"><span class="pre">org.springframework.beans.TypeMismatchException</span></code> (Exception that occurs if the specified value cannot be converted to URI).</li>
<li>etc ...</li>
</ul>
</div></blockquote>
<p class="last">Class for which HTTP status code is &#8220;4XX&#8221; in the list given at <a class="reference internal" href="#exception-handling-appendix-defaulthandlerexceptionresolver-label"><span>HTTP response code set by DefaultHandlerExceptionResolver</span></a>.</p>
</div>
</div>
</div>
<div class="section" id="exception-handling-patterns">
<span id="exception-handling-pattern-label"></span><h3><a class="toc-backref" href="#id32">5.7.2.2. Exception Handling Patterns</a><a class="headerlink" href="#exception-handling-patterns" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">There are 6 types of exception handling patterns based on the purpose of handling.</div>
<div class="line">(1)-(2) should be handled at use case level and (3)-(6) should be handled at the entire system (application) level.</div>
</div>
<table border="1" class="docutils" id="id6">
<caption><span class="caption-text"><strong>Table - Exception Handling Patterns</strong></span><a class="headerlink" href="#id6" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="10%" />
<col width="40%" />
<col width="25%" />
<col width="10%" />
<col width="15%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Purpose of handling</th>
<th class="head">Types of exceptions</th>
<th class="head">Handling method</th>
<th class="head">Handling location</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><a class="reference internal" href="#exception-handling-class-from-middle-label"><span>When notifying partial redo of a use case (from middle)</span></a></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1. <a class="reference internal" href="#exception-handling-exception-type-businessexception-label"><span>Business exception</span></a></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Application code</div>
<div class="line">(try-catch)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Request</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><a class="reference internal" href="#exception-handling-class-from-first-label"><span>When notifying redo of a use case (from beginning)</span></a></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1. <a class="reference internal" href="#exception-handling-exception-type-businessexception-label"><span>Business exception</span></a></div>
<div class="line">2. <a class="reference internal" href="#exception-handling-exception-type-libraryexception-label"><span>Library exceptions that occurs during normal operation</span></a></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Application code</div>
<div class="line">(&#64;ExceptionHandler)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Use case</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><a class="reference internal" href="#exception-handling-class-systemerror-label"><span>When notifying that the system or application is not in a normal state</span></a></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1. <a class="reference internal" href="#exception-handling-exception-type-systemexception-label"><span>System Exception</span></a></div>
<div class="line">2. <a class="reference internal" href="#exception-handling-exception-type-unexpectedexception-label"><span>Unexpected System Exception</span></a></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Framework</div>
<div class="line">(Handling rules are specified in <code class="docutils literal"><span class="pre">spring-mvc.xml</span></code>)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Servlet</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><a class="reference internal" href="#exception-handling-class-requesterror-label"><span>When notifying that the request contents are invalid</span></a></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1. <a class="reference internal" href="#exception-handling-exception-type-request-label"><span>Framework exception in case of invalid requests</span></a></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Framework</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Servlet</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><a class="reference internal" href="#exception-handling-class-fatalerror-label"><span>When a fatal error has been detected</span></a></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1. <a class="reference internal" href="#exception-handling-exception-type-error-label"><span>Fatal Errors</span></a></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Servlet container</div>
<div class="line">(Handling rules are specified in <code class="docutils literal"><span class="pre">web.xml</span></code>)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Web application</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><a class="reference internal" href="#exception-handling-class-viewerror-label"><span>When notifying that an exception has occurred in the presentation layer (JSP etc.)</span></a></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">1. All the exceptions and errors that occur in the presentation layer</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Servlet container</div>
<div class="line">(Handling rules are specified in <code class="docutils literal"><span class="pre">web.xml</span></code>)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Web application</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="section" id="when-notifying-partial-redo-of-a-use-case-from-middle">
<span id="exception-handling-class-from-middle-label"></span><h4><a class="toc-backref" href="#id33">5.7.2.2.1. When notifying partial redo of a use case (from middle)</a><a class="headerlink" href="#when-notifying-partial-redo-of-a-use-case-from-middle" title="Permalink to this headline">¶</a></h4>
<p>When partial redo (from middle) of a use case is to be notified, catch (try-catch) the exception in the application code of Controller class and carry out exception handling at request level.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Example of notifying partial redo of a use case</strong></p>
<ul class="last">
<li><div class="first line-block">
<div class="line">When an order is placed through a shopping site, if business exception notifying stock shortage occurs.</div>
<div class="line">In such a case, order can be placed if the no. of items to be ordered is reduced; hence display a screen on which no. of items can be changed and prompt a message asking to change the same.</div>
</div>
</li>
</ul>
</div>
<div class="figure align-center" id="id7">
<a class="reference internal image-reference" href="../_images/exception-handling-class-again-from-middle.png"><img alt="class of exception handling for again from middle" src="../_images/exception-handling-class-again-from-middle.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text"><strong>Figure - Handling method when notifying partial redo of a use case (from middle)</strong></span></p>
</div>
</div>
<div class="section" id="when-notifying-redo-of-a-use-case-from-beginning">
<span id="exception-handling-class-from-first-label"></span><h4><a class="toc-backref" href="#id34">5.7.2.2.2. When notifying redo of a use case (from beginning)</a><a class="headerlink" href="#when-notifying-redo-of-a-use-case-from-beginning" title="Permalink to this headline">¶</a></h4>
<p>When redo of a use case (from beginning) is to be notified, catch the exception using <code class="docutils literal"><span class="pre">&#64;ExceptionHandler</span></code>, and carry out exception handling at use case level.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Example when notifying redo of a use case (from beginning)</strong></p>
<ul class="last">
<li><div class="first line-block">
<div class="line">At the time of changing the product master on shopping site (site for administrator), it has been changed by other operator (in case of optimistic locking exception).</div>
<div class="line">In such a case, the operation needs to be carried out after verifying the changes made by the other user; hence display the front screen of the use case (for example: search screen of product master) and prompt a message asking the user to perform the operation again.</div>
</div>
</li>
</ul>
</div>
<div class="figure align-center" id="id8">
<a class="reference internal image-reference" href="../_images/exception-handling-class-again-from-first.png"><img alt="class of exception handling for again from first" src="../_images/exception-handling-class-again-from-first.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text"><strong>Figure - Handling method when notifying redo of a use case (from beginning)</strong></span></p>
</div>
</div>
<div class="section" id="when-notifying-that-the-system-or-application-is-not-in-a-normal-state">
<span id="exception-handling-class-systemerror-label"></span><h4><a class="toc-backref" href="#id35">5.7.2.2.3. When notifying that the system or application is not in a normal state</a><a class="headerlink" href="#when-notifying-that-the-system-or-application-is-not-in-a-normal-state" title="Permalink to this headline">¶</a></h4>
<p>When an exception to notify that system or application is not in a normal state is detected, catch the exception using SystemExceptionResolver and carry out exception handling at servlet level.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Examples for notifying that the system or application is not in a normal state</strong></p>
<ul class="last">
<li><div class="first line-block">
<div class="line">In case of a use case for connecting to an external system, if an exception occurs notifying that the external system is blocked.</div>
<div class="line">In such a case, since use case cannot be executed until external system resumes service, display the error screen, and notify that the use case cannot be executed till the external system resumes service.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">When searching master information with the value specified in the application, if the corresponding master information does not exist.</div>
<div class="line">In such a case, there is a possibility of bug in master maintenance function or of error (release error) in data input by the system administrator; hence display the system error screen and notify that a system error has occurred.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">When IOException occurs from the API during file operations.</div>
<div class="line">This could be a case of disk failure etc.; hence display the system error screen and notify that system error has occurred.</div>
</div>
</li>
<li><p class="first">etc ...</p>
</li>
</ul>
</div>
<div class="figure align-center" id="id9">
<a class="reference internal image-reference" href="../_images/exception-handling-class-systemerror.png"><img alt="class of exception handling for system error" src="../_images/exception-handling-class-systemerror.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text"><strong>Figure - Handling method when an exception to notify that system or application is not in a normal state is detected</strong></span></p>
</div>
</div>
<div class="section" id="when-notifying-that-the-request-contents-are-invalid">
<span id="exception-handling-class-requesterror-label"></span><h4><a class="toc-backref" href="#id36">5.7.2.2.4. When notifying that the request contents are invalid</a><a class="headerlink" href="#when-notifying-that-the-request-contents-are-invalid" title="Permalink to this headline">¶</a></h4>
<p>When notifying that an invalid request is detected by the framework, catch the exception using DefaultHandlerExceptionResolver, and carry out exception handling at servlet level.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Example when notifying that the request contents are invalid</strong></p>
<ul class="last">
<li><div class="first line-block">
<div class="line">When a URI is accessed using GET method, while only POST method is permitted.</div>
<div class="line">In such a case, it is likely that the access has been made directly using the Favorites feature etc. of the browser; hence display the error screen and notify that the request contents are invalid.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">When value cannot be extracted from URI using <code class="docutils literal"><span class="pre">&#64;PathVariable</span></code> annotation</div>
<div class="line">In such a case, it is likely that the access has been made directly by replacing the value of the address bar on the browser; hence display the error screen and notify that the request contents are invalid.</div>
</div>
</li>
<li><p class="first">etc ...</p>
</li>
</ul>
</div>
<div class="figure align-center" id="id10">
<a class="reference internal image-reference" href="../_images/exception-handling-class-requesterror.png"><img alt="class of exception handling for request error" src="../_images/exception-handling-class-requesterror.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text"><strong>Figure - Handling method when notifying that the request contents are invalid</strong></span></p>
</div>
</div>
<div class="section" id="when-a-fatal-error-has-been-detected">
<span id="exception-handling-class-fatalerror-label"></span><h4><a class="toc-backref" href="#id37">5.7.2.2.5. When a fatal error has been detected</a><a class="headerlink" href="#when-a-fatal-error-has-been-detected" title="Permalink to this headline">¶</a></h4>
<p>When a fatal error has been detected, catch the exception using servlet container and carry out exception handling at web application level.</p>
<div class="figure align-center" id="id11">
<a class="reference internal image-reference" href="../_images/exception-handling-class-fatalerror.png"><img alt="class of exception handling for fatal error" src="../_images/exception-handling-class-fatalerror.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text"><strong>Figure - Handling method when a fatal error has been detected</strong></span></p>
</div>
</div>
<div class="section" id="when-notifying-that-an-exception-has-occurred-in-the-presentation-layer-jsp-etc">
<span id="exception-handling-class-viewerror-label"></span><h4><a class="toc-backref" href="#id38">5.7.2.2.6. When notifying that an exception has occurred in the presentation layer (JSP etc.)</a><a class="headerlink" href="#when-notifying-that-an-exception-has-occurred-in-the-presentation-layer-jsp-etc" title="Permalink to this headline">¶</a></h4>
<p>When notifying that an exception has occurred in the presentation layer (JSP etc.), catch the exception using servlet container and carry out exception handling at web application level.</p>
<div class="figure align-center" id="id12">
<a class="reference internal image-reference" href="../_images/exception-handling-class-jsperror.png"><img alt="class of exception handling for fatal error" src="../_images/exception-handling-class-jsperror.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text"><strong>Figure - Handling method when notifying an occurrence of exception in the presentation layer (JSP etc.)</strong></span></p>
</div>
</div>
</div>
<div class="section" id="basic-flow-of-exception-handling">
<span id="exception-handling-basic-flow-label"></span><h3><a class="toc-backref" href="#id39">5.7.2.3. Basic Flow of Exception Handling</a><a class="headerlink" href="#basic-flow-of-exception-handling" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">The basic flow of exception handling is shown below.</div>
<div class="line">For an overview of classes provided by common library, refer to <a class="reference internal" href="#exception-handling-about-classes-of-library-label"><span>Exception handling classes provided by the common library</span></a>.</div>
<div class="line"><strong>The processing to be implemented in the application code is indicated in Bold.</strong></div>
<div class="line">The log of stack trace and exception messages is output by the classes (Filter and Interceptor class) provided by the common library.</div>
<div class="line">When any information other than exception messages and stack trace needs to be logged, it should be implemented separately in each of the logic.</div>
<div class="line">This section describes the flow of exception handling; hence the description related to flow till the calling of Service class is omitted.</div>
</div>
<ol class="arabic simple">
<li><a class="reference internal" href="#exception-handling-basic-flow-catch-label"><span>Basic flow when the Controller class handles the exception at request level</span></a></li>
<li><a class="reference internal" href="#exception-handling-basic-flow-annotation-label"><span>Basic flow when the Controller class handles the exception at use case level</span></a></li>
<li><a class="reference internal" href="#exception-handling-basic-flow-resolver-label"><span>Basic flow when the framework handles the exception at servlet level</span></a></li>
<li><a class="reference internal" href="#exception-handling-basic-flow-container-label"><span>Basic flow when the servlet container handles the exception at web application level</span></a></li>
</ol>
<div class="section" id="basic-flow-when-the-controller-class-handles-the-exception-at-request-level">
<span id="exception-handling-basic-flow-catch-label"></span><h4><a class="toc-backref" href="#id40">5.7.2.3.1. Basic flow when the Controller class handles the exception at request level</a><a class="headerlink" href="#basic-flow-when-the-controller-class-handles-the-exception-at-request-level" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">In order to handle the exception at request level, catch (try-catch) the exception in the application code of the Controller class.</div>
<div class="line">Refer to the figure below:</div>
<div class="line">It illustrates the basic flow at the time of handling a business exception (<code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.exception.BusinessException</span></code>) provided by common library.</div>
<div class="line">Log is output using interceptor (<code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.exception.ResultMessagesLoggingInterceptor</span></code>) which records that an exception holding the result message has occurred.</div>
</div>
<div class="figure align-center" id="id13">
<a class="reference internal image-reference" href="../_images/exception-handling-flow-catch.png"><img alt="flow of exception handling using catch" src="../_images/exception-handling-flow-catch.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text"><strong>Figure - Basic flow when the Controller class handles the exception at request level</strong></span></p>
</div>
<ol class="arabic simple" start="4">
<li>In Service class, BusinessException is generated and thrown.</li>
<li>ResultMessagesLoggingInterceptor calls ExceptionLogger, and outputs log of warn level (monitoring log and application log).
ResultMessagesLoggingInterceptor class outputs logs only when sub exception (BusinessException/ResourceNotFoundException) of ResultMessagesNotificationException occurs.</li>
<li><strong>Controller class catches BusinessException, extracts the message information (ResultMessage) from BusinessException and sets it to Model for screen display(6&#8217;).</strong></li>
<li><strong>Controller class returns the View name.</strong></li>
<li>DispatcherServlet calls JSP corresponding to the returned View name.</li>
<li><strong>JSP acquires message information (ResultMessage) using MessagesPanelTag and generates HTML code for message display.</strong></li>
<li>The response generated by JSP is displayed.</li>
</ol>
</div>
<div class="section" id="basic-flow-when-the-controller-class-handles-the-exception-at-use-case-level">
<span id="exception-handling-basic-flow-annotation-label"></span><h4><a class="toc-backref" href="#id41">5.7.2.3.2. Basic flow when the Controller class handles the exception at use case level</a><a class="headerlink" href="#basic-flow-when-the-controller-class-handles-the-exception-at-use-case-level" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">In order to handle the exception at use case level, catch the exception using  <code class="docutils literal"><span class="pre">&#64;ExceptionHandler</span></code> of Controller class.</div>
<div class="line">Refer to the figure below.</div>
<div class="line">It illustrates the basic flow at the time of handling an arbitrary exception (<code class="docutils literal"><span class="pre">XxxException</span></code>).</div>
<div class="line">Log is output using interceptor (<code class="docutils literal"><span class="pre">org.terasoluna.gfw.web.exception.HandlerExceptionResolverLoggingInterceptor</span></code>). This interceptor records that the exception is handled using HandlerExceptionResolver.</div>
</div>
<div class="figure align-center" id="id14">
<a class="reference internal image-reference" href="../_images/exception-handling-flow-annotation.png"><img alt="flow of exception handling using annotation" src="../_images/exception-handling-flow-annotation.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text"><strong>Figure - Basic flow when the Controller class handles the exception at use case level</strong></span></p>
</div>
<ol class="arabic simple" start="3">
<li>Exception (XxxException) is generated in the Service class called from Controller class.</li>
<li>DispatcherServlet catches XxxException and calls ExceptionHandlerExceptionResolver.</li>
<li>ExceptionHandlerExceptionResolver calls exception handling method provided in Controller class.</li>
<li><strong>Controller class generates message information (ResultMessage) and sets it to the Model for screen display.</strong></li>
<li><strong>Controller class returns the View name.</strong></li>
<li>ExceptionHandlerExceptionResolver returns the View name returned by the Controller.</li>
<li>HandlerExceptionResolverLoggingInterceptor calls ExceptionLogger and outputs logs (monitoring log and application log) (at info, warn, error levels) corresponding to the exception code.</li>
<li>HandlerExceptionResolverLoggingInterceptor returns View name returned by ExceptionHandlerExceptionResolver.</li>
<li>DispatcherServlet calls JSP that corresponds to the returned View name.</li>
<li><strong>JSP acquires the message information (ResultMessage) using MessagesPanelTag and generates HTML code for message display.</strong></li>
<li>The response generated by JSP is displayed.</li>
</ol>
</div>
<div class="section" id="basic-flow-when-the-framework-handles-the-exception-at-servlet-level">
<span id="exception-handling-basic-flow-resolver-label"></span><h4><a class="toc-backref" href="#id42">5.7.2.3.3. Basic flow when the framework handles the exception at servlet level</a><a class="headerlink" href="#basic-flow-when-the-framework-handles-the-exception-at-servlet-level" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">In order to handle the exception using the framework (at servlet level), catch the exception using SystemExceptionResolver.</div>
<div class="line">Refer to the figure below.</div>
<div class="line">It illustrates the basic flow at the time of handling the system exception (<code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.exception.SystemException</span></code>) provided by common library using <code class="docutils literal"><span class="pre">org.terasoluna.gfw.web.exception.SystemExceptionResolver</span></code> .</div>
<div class="line">Log is output using interceptor (<code class="docutils literal"><span class="pre">org.terasoluna.gfw.web.exception.HandlerExceptionResolverLoggingInterceptor</span></code>) which records the exception specified in the argument of exception handling method.</div>
</div>
<div class="figure align-center" id="id15">
<a class="reference internal image-reference" href="../_images/exception-handling-flow-resolver.png"><img alt="flow of exception handling using resolver" src="../_images/exception-handling-flow-resolver.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text"><strong>Figure - Basic flow when the framework handles the exception at servlet level</strong></span></p>
</div>
<ol class="arabic simple" start="4">
<li>A state equivalent to the system exception is detected in Service class; hence throw a SystemException.</li>
<li>DispatcherServlet catches SystemException, and calls SystemExceptionResolver.</li>
<li>SystemExceptionResolver acquires exception code from SystemException and sets it to HttpServletRequest for screen display (6&#8217;).</li>
<li>SystemExceptionResolver returns the View name corresponding to SystemException.</li>
<li>HandlerExceptionResolverLoggingInterceptor calls ExceptionLogger and outputs logs (monitoring log and application log) (at info, warn, error levels) corresponding to the exception code.</li>
<li>HandlerExceptionResolverLoggingInterceptor returns the View name returned by SystemExceptionResolver.</li>
<li>DispatcherServlet calls the JSP corresponding to the returned View name.</li>
<li><strong>JSP acquires the exception code from HttpServletRequest and  inserts it in HTML code for message display.</strong></li>
<li>The response generated by JSP is displayed.</li>
</ol>
</div>
<div class="section" id="basic-flow-when-the-servlet-container-handles-the-exception-at-web-application-level">
<span id="exception-handling-basic-flow-container-label"></span><h4><a class="toc-backref" href="#id43">5.7.2.3.4. Basic flow when the servlet container handles the exception at web application level</a><a class="headerlink" href="#basic-flow-when-the-servlet-container-handles-the-exception-at-web-application-level" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">In order to handle exceptions at web application level, catch the exception using servlet container.</div>
<div class="line">Fatal errors, exceptions which are not handled using the framework (exceptions in JSP etc.) and exceptions occurred in Filter are to be handled using this flow.</div>
<div class="line">Refer to the figure below.</div>
<div class="line">It illustrates the basic flow at the time of handling java.lang.Exception by &#8220;error page&#8221;.</div>
<div class="line">Log is output using servlet filter (<code class="docutils literal"><span class="pre">org.terasoluna.gfw.web.exception.ExceptionLoggingFilter</span></code>) which records that an unhandled exception has occurred.</div>
</div>
<div class="figure align-center" id="id16">
<a class="reference internal image-reference" href="../_images/exception-handling-flow-container.png"><img alt="flow of exception handling using container" src="../_images/exception-handling-flow-container.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text"><strong>Figure - Basic flow when servlet container handles the exception at web application level</strong></span></p>
</div>
<ol class="arabic simple" start="4">
<li>DispatcherServlet catches XxxError, wraps it in ServletException and then throws it.</li>
<li>ExceptionLoggingFilter catches ServletException and calls ExceptionLogger. ExceptionLogger outputs logs (monitoring log and application log) (at info, warn, error levels) corresponding to the exception code. ExceptionLoggingFilter re-throws ServletException.</li>
<li>ServletContainer catches ServletException and outputs logs to server log. Log level varies depending on the application server.</li>
<li>ServletContainer calls the View (HTML etc.) defined in <code class="docutils literal"><span class="pre">web.xml</span></code>.</li>
<li>The response generated by the View which is called by the ServletContainer, is displayed.</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="how-to-use">
<span id="exception-handling-how-to-use-label"></span><h2><a class="toc-backref" href="#id44">5.7.3. How to use</a><a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h2>
<p>The usage of exception handling functionality is described below.</p>
<p>For exception handling classes provided by common library, refer to <a class="reference internal" href="#exception-handling-about-classes-of-library-label"><span>Exception handling classes provided by the common library</span></a>.</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#exception-handling-how-to-use-application-configuration-label"><span>Application Settings</span></a></li>
<li><a class="reference internal" href="#exception-handling-how-to-use-codingpoint-service-label"><span>Coding Points (Service)</span></a></li>
<li><a class="reference internal" href="#exception-handling-how-to-use-codingpoint-controller-label"><span>Coding Points (Controller)</span></a></li>
<li><a class="reference internal" href="#exception-handling-how-to-use-codingpoint-jsp-label"><span>Coding points (JSP)</span></a></li>
</ol>
<div class="section" id="application-settings">
<span id="exception-handling-how-to-use-application-configuration-label"></span><h3><a class="toc-backref" href="#id45">5.7.3.1. Application Settings</a><a class="headerlink" href="#application-settings" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">The application settings required for using exception handling are shown below.</div>
<div class="line">Further, these settings are already done in blank project. Hence, it will work only by doing changes given in <strong>[Location to be customized for each project]</strong>section.</div>
</div>
<ol class="arabic simple">
<li><a class="reference internal" href="#exception-handling-how-to-use-application-configuration-common-label"><span>Common Settings</span></a></li>
<li><a class="reference internal" href="#exception-handling-how-to-use-application-configuration-domain-label"><span>Domain Layer Settings</span></a></li>
<li><a class="reference internal" href="#exception-handling-how-to-use-application-configuration-app-label"><span>Application Layer Settings</span></a></li>
<li><a class="reference internal" href="#exception-handling-how-to-use-application-configuration-container-label"><span>Servlet Container Settings</span></a></li>
</ol>
<div class="section" id="common-settings">
<span id="exception-handling-how-to-use-application-configuration-common-label"></span><h4><a class="toc-backref" href="#id46">5.7.3.1.1. Common Settings</a><a class="headerlink" href="#common-settings" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Add bean definition of logger class (<code class="docutils literal"><span class="pre">ExceptionLogger</span></code>) which will output exception log.</li>
</ol>
<ul class="simple">
<li><strong>applicationContext.xml</strong></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- Exception Code Resolver. --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;exceptionCodeResolver&quot;</span>
<span class="hll">    <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.exception.SimpleMappingExceptionCodeResolver&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</span>    <span class="c">&lt;!-- Setting and Customization by project. --&gt;</span>
<span class="hll">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionMappings&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
</span>        <span class="nt">&lt;map&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;ResourceNotFoundException&quot;</span> <span class="na">value=</span><span class="s">&quot;e.xx.fw.5001&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;BusinessException&quot;</span> <span class="na">value=</span><span class="s">&quot;e.xx.fw.8001&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/map&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="hll">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultExceptionCode&quot;</span> <span class="na">value=</span><span class="s">&quot;e.xx.fw.9001&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="nt">&lt;/bean&gt;</span>

<span class="c">&lt;!-- Exception Logger. --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;exceptionLogger&quot;</span>
<span class="hll">    <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.exception.ExceptionLogger&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (4) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionCodeResolver&quot;</span> <span class="na">ref=</span><span class="s">&quot;exceptionCodeResolver&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (5) --&gt;</span>
</span><span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add <code class="docutils literal"><span class="pre">ExceptionCodeResolver</span></code> to bean definition.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">Specify mapping between name of the exception to be handled and applicable &#8220;Exception Code (Message ID)&#8221;.</div>
<div class="line">In the above example, if the &#8220;BusinessException&#8221; is included in the class name of exception class (or parent class), &#8220;w.xx.fw.8001&#8221; will be the &#8220;Exception code (Message ID)&#8221; and if &#8220;ResourceNotFoundException&#8221; is included in the class name of exception class (or parent class), &#8220;w.xx.fw.5001&#8221; will be the &#8220;Exception code (Message ID)&#8221;.</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>About the Exception Code (Message ID)</strong></p>
<p class="last">The exception code is defined here for taking into account the case wherein message ID is not specified in generated &#8220;BusinessException&#8221;,
however, it is recommended that you specify the &#8220;Exception Code (Message ID)&#8221; at the implementation side which generates the &#8220;BusinessException&#8221; (this point is explained later).
Specification of &#8220;Exception Code (Message ID)&#8221; for &#8220;BusinessException&#8221; is an alternative measure in case it is not specified when &#8220;BusinessException&#8221; occurs.</p>
</div>
<div class="last line-block">
<div class="line"><strong>[Location to be customized for each project]</strong></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">Specify default &#8220;Exception Code (Message ID)&#8221;.</div>
<div class="line">In the above example, if &#8220;BusinessException&#8221; or &#8220;ResourceNotFoundException&#8221; is not included in the class names of exception class (or parent class), &#8221; e.xx.fw.9001&#8221; will be &#8220;Exception code (Message ID)&#8221;.</div>
<div class="line"><strong>[Location to be customized for each project]</strong></div>
</div>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Exception Code (Message ID)</strong></p>
<p class="last">Exception code is only to be output to log (It can also be fetched on screen).
It is also possible to create an ID which need not be in the format usually used to define IDs in Properties file, but can be identified in the application.
For example, MA7001 etc.</p>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add <code class="docutils literal"><span class="pre">ExceptionLogger</span></code> to bean definition.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Inject <code class="docutils literal"><span class="pre">ExceptionCodeResolver</span></code> into the bean definition of <code class="docutils literal"><span class="pre">ExceptionLogger</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>Add log definition.</li>
</ol>
<ul class="simple">
<li><strong>logback.xml</strong></li>
</ul>
<blockquote>
<div><p>Add log definition for monitoring log.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="hll"><span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;MONITORING_LOG_FILE&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</span>    <span class="nt">&lt;file&gt;</span>${app.log.dir:-log}/projectName-monitoring.log<span class="nt">&lt;/file&gt;</span>
    <span class="nt">&lt;rollingPolicy</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;fileNamePattern&gt;</span>${app.log.dir:-log}/projectName-monitoring-%d{yyyyMMdd}.log<span class="nt">&lt;/fileNamePattern&gt;</span>
        <span class="nt">&lt;maxHistory&gt;</span>7<span class="nt">&lt;/maxHistory&gt;</span>
    <span class="nt">&lt;/rollingPolicy&gt;</span>
    <span class="nt">&lt;encoder&gt;</span>
        <span class="nt">&lt;charset&gt;</span>UTF-8<span class="nt">&lt;/charset&gt;</span>
        <span class="nt">&lt;pattern&gt;</span><span class="cp">&lt;![CDATA[date:%d{yyyy-MM-dd HH:mm:ss}\tX-Track:%X{X-Track}\tlevel:%-5level\tmessage:%msg%n]]&gt;</span><span class="nt">&lt;/pattern&gt;</span>
    <span class="nt">&lt;/encoder&gt;</span>
<span class="nt">&lt;/appender&gt;</span>

<span class="hll"><span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.terasoluna.gfw.common.exception.ExceptionLogger.Monitoring&quot;</span> <span class="na">additivity=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;error&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;MONITORING_LOG_FILE&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (4) --&gt;</span>
</span><span class="nt">&lt;/logger&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify appender definition used for outputting monitoring log. In the above example, an appender to be output to a file has been specified, however the appender used should be consider as per the system requirements.</div>
<div class="line"><strong>[Location to be customized for each project]</strong></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">Specify logger definition for monitoring log. When creating ExceptionLogger, if any logger name is not specified, the above settings can be used as is.</div>
</div>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>About additivity setting value</strong></p>
<p class="last">Specify <code class="docutils literal"><span class="pre">false</span></code>. If <code class="docutils literal"><span class="pre">true</span></code> is specified, the same log will be output by upper level logger (for example, root).</p>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify output level. In ExceptionLogger, 3 types of logs of info, warn, error are output; however, the level specified should be as per the system requirements. The guideline recommends Error level.</div>
<div class="line"><strong>[Location to be customized for each project]</strong></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the appender which will act as output destination.</div>
<div class="line"><strong>[Location to be customized for each project]</strong></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Add log definition for application log.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="hll"><span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;APPLICATION_LOG_FILE&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</span>    <span class="nt">&lt;file&gt;</span>${app.log.dir:-log}/projectName-application.log<span class="nt">&lt;/file&gt;</span>
    <span class="nt">&lt;rollingPolicy</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;fileNamePattern&gt;</span>${app.log.dir:-log}/projectName-application-%d{yyyyMMdd}.log<span class="nt">&lt;/fileNamePattern&gt;</span>
        <span class="nt">&lt;maxHistory&gt;</span>7<span class="nt">&lt;/maxHistory&gt;</span>
    <span class="nt">&lt;/rollingPolicy&gt;</span>
    <span class="nt">&lt;encoder&gt;</span>
        <span class="nt">&lt;charset&gt;</span>UTF-8<span class="nt">&lt;/charset&gt;</span>
        <span class="nt">&lt;pattern&gt;</span><span class="cp">&lt;![CDATA[date:%d{yyyy-MM-dd HH:mm:ss}\tthread:%thread\tX-Track:%X{X-Track}\tlevel:%-5level\tlogger:%-48logger{48}\tmessage:%msg%n]]&gt;</span><span class="nt">&lt;/pattern&gt;</span>
    <span class="nt">&lt;/encoder&gt;</span>
<span class="nt">&lt;/appender&gt;</span>

<span class="hll"><span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.terasoluna.gfw.common.exception.ExceptionLogger&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
</span>    <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;info&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
<span class="nt">&lt;/logger&gt;</span>

<span class="nt">&lt;root</span> <span class="na">level=</span><span class="s">&quot;warn&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;STDOUT&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;APPLICATION_LOG_FILE&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (4) --&gt;</span>
<span class="nt">&lt;/root&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify appender definition used for outputting application log. In the above example, an appender to be output to a file has been specified, however the appender used should be consider as per the system requirements.</div>
<div class="line"><strong>[Location to be customized for each project]</strong></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">Specify logger definition for application log. When creating ExceptionLogger, if any logger name is not specified, the above settings can be used as is.</div>
</div>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Appender definition for outputting application log</strong></p>
<p class="last">Rather than defining a separate appender for logging exceptions, it is recommended to use the same appender which is used for logging in application code or framework.
By using same output destination, it becomes easier to track the process until an exception occurs.</p>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the output level. In ExceptionLogger, 3 types of logs of info, warn, error are output; however, the level specified should be as per the system requirements. This guideline recommends info level.</div>
<div class="line"><strong>[Location to be customized for each project]</strong></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Log is transmitted to root since appender is not specified for the logger set in (2). Therefore, specify an appender which will act as output destination. Here, it will be output to &#8220;STDOUT&#8221; and &#8220;APPLICATION_LOG_FILE&#8221;.</div>
<div class="line"><strong>[Location to be customized for each project]</strong></div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="domain-layer-settings">
<span id="exception-handling-how-to-use-application-configuration-domain-label"></span><h4><a class="toc-backref" href="#id47">5.7.3.1.2. Domain Layer Settings</a><a class="headerlink" href="#domain-layer-settings" title="Permalink to this headline">¶</a></h4>
<p>When exceptions (BusinessException,ResourceNotFoundException) holding ResultMessages occur, add AOP settings and bean definition of interceptor class (<code class="docutils literal"><span class="pre">ResultMessagesLoggingInterceptor</span></code>) for log output.</p>
<ul class="simple">
<li><strong>xxx-domain.xml</strong></li>
</ul>
<blockquote id="exception-handling-how-to-use-service-pointcut-aop-label">
<div><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- interceptor bean. --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;resultMessagesLoggingInterceptor&quot;</span>
<span class="hll">      <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.exception.ResultMessagesLoggingInterceptor&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionLogger&quot;</span> <span class="na">ref=</span><span class="s">&quot;exceptionLogger&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="nt">&lt;/bean&gt;</span>

<span class="c">&lt;!-- setting AOP. --&gt;</span>
<span class="nt">&lt;aop:config&gt;</span>
    <span class="nt">&lt;aop:advisor</span> <span class="na">advice-ref=</span><span class="s">&quot;resultMessagesLoggingInterceptor&quot;</span>
<span class="hll">                 <span class="na">pointcut=</span><span class="s">&quot;@within(org.springframework.stereotype.Service)&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="nt">&lt;/aop:config&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add bean definition of <code class="docutils literal"><span class="pre">ResultMessagesLoggingInterceptor</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Inject the logger which outputs exception log. Specify &#8220;exceptionLogger&#8221; defined in <code class="docutils literal"><span class="pre">applicationContext.xml</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Apply ResultMessagesLoggingInterceptor for the method of the Service class (with <code class="docutils literal"><span class="pre">&#64;Service</span></code> annotation).</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="application-layer-settings">
<span id="exception-handling-how-to-use-application-configuration-app-label"></span><h4><a class="toc-backref" href="#id48">5.7.3.1.3. Application Layer Settings</a><a class="headerlink" href="#application-layer-settings" title="Permalink to this headline">¶</a></h4>
<p>Add to bean definition, the class (<code class="docutils literal"><span class="pre">SystemExceptionResolver</span></code>)  used for handling the exceptions which are not handled by HandlerExceptionResolver registered automatically when &lt;mvc:annotation-driven&gt; is specified. .</p>
<ul class="simple">
<li><strong>spring-mvc.xml</strong></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- Setting Exception Handling. --&gt;</span>
<span class="c">&lt;!-- Exception Resolver. --&gt;</span>
<span class="hll"><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.exception.SystemExceptionResolver&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionCodeResolver&quot;</span> <span class="na">ref=</span><span class="s">&quot;exceptionCodeResolver&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
</span>    <span class="c">&lt;!-- Setting and Customization by project. --&gt;</span>
<span class="hll">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;order&quot;</span> <span class="na">value=</span><span class="s">&quot;3&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionMappings&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (4) --&gt;</span>
</span>        <span class="nt">&lt;map&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;ResourceNotFoundException&quot;</span> <span class="na">value=</span><span class="s">&quot;common/error/resourceNotFoundError&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;BusinessException&quot;</span> <span class="na">value=</span><span class="s">&quot;common/error/businessError&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;InvalidTransactionTokenException&quot;</span> <span class="na">value=</span><span class="s">&quot;common/error/transactionTokenError&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;.DataAccessException&quot;</span> <span class="na">value=</span><span class="s">&quot;common/error/dataAccessError&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/map&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="hll">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;statusCodes&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (5) --&gt;</span>
</span>        <span class="nt">&lt;map&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;common/error/resourceNotFoundError&quot;</span> <span class="na">value=</span><span class="s">&quot;404&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;common/error/businessError&quot;</span> <span class="na">value=</span><span class="s">&quot;409&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;common/error/transactionTokenError&quot;</span> <span class="na">value=</span><span class="s">&quot;409&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;common/error/dataAccessError&quot;</span> <span class="na">value=</span><span class="s">&quot;500&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/map&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="hll">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultErrorView&quot;</span> <span class="na">value=</span><span class="s">&quot;common/error/systemError&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (6) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultStatusCode&quot;</span> <span class="na">value=</span><span class="s">&quot;500&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (7) --&gt;</span>
</span><span class="nt">&lt;/bean&gt;</span>

<span class="c">&lt;!-- Settings View Resolver. --&gt;</span>
<span class="nt">&lt;mvc:view-resolvers&gt;</span>
<span class="hll">    <span class="nt">&lt;mvc:jsp</span> <span class="na">prefix=</span><span class="s">&quot;/WEB-INF/views/&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (8) --&gt;</span>
</span><span class="nt">&lt;/mvc:view-resolvers&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add <code class="docutils literal"><span class="pre">SystemExceptionResolver</span></code> to bean definition.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Inject the object that resolves exception code (Message ID). Specify &#8220;exceptionCodeResolver&#8221; defined in <code class="docutils literal"><span class="pre">applicationContext.xml</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">Specify the order of priority for handling. The value can be &#8220;3&#8221;. When <code class="docutils literal"><span class="pre">&lt;mvc:annotation-driven&gt;</span></code> is specified, automatically <a class="reference internal" href="#exceptionhandling-annotation-driven"><span>registered class</span></a> is given higher priority.</div>
</div>
<div class="last admonition hint">
<p class="first admonition-title">Hint</p>
<p><strong>Method to disable exception handling carried out by DefaultHandlerExceptionResolver</strong></p>
<p class="last">When exception handling is carried out by <code class="docutils literal"><span class="pre">DefaultHandlerExceptionResolver</span></code>, HTTP response code is set; however since View is not resolved, it needs to be resolved using Error Page element of <code class="docutils literal"><span class="pre">web.xml</span></code>.
When it is required to resolve the View using <code class="docutils literal"><span class="pre">HandlerExceptionResolver</span></code> and not in <code class="docutils literal"><span class="pre">web.xml</span></code>, then priority order of <code class="docutils literal"><span class="pre">SystemExceptionResolver</span></code> should be set to &#8220;1&#8221;. By doing this, the handling process can be executed before <code class="docutils literal"><span class="pre">DefaultHandlerExceptionResolver</span></code>.
For mapping of HTTP response codes when handling is done by <code class="docutils literal"><span class="pre">DefaultHandlerExceptionResolver</span></code>, refer to <a class="reference internal" href="#exception-handling-appendix-defaulthandlerexceptionresolver-label"><span>HTTP response code set by DefaultHandlerExceptionResolver</span></a>.</p>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the mapping between name of the exception to be handled and View name.</div>
<div class="line">In the above settings, if class name of the exception class (or parent class) includes &#8221;.DataAccessException&#8221;, &#8220;common/error/dataAccessError&#8221; will be treated as View name.</div>
<div class="line">If the exception class is &#8220;ResourceNotFoundException&#8221;, &#8220;common/error/resourceNotFoundError&#8221; will be treated as View name.</div>
<div class="line"><strong>[Location to be customized for each project]</strong></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the mapping between View name and HTTP status code.</div>
<div class="line">In the above settings, when View name is &#8220;common/error/resourceNotFoundError&#8221;, &#8220;404(Not Found)&#8221; becomes HTTP status code.</div>
<div class="line"><strong>[Location to be customized for each project]</strong></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the default View name.</div>
<div class="line">In the above settings, if exception class does not include &#8220;ResourceNotFoundException&#8221;, &#8220;BusinessException&#8221; and &#8220;InvalidTransactionTokenException&#8221;, and if exception class (or parent class) name does not include &#8221;.DataAccessException&#8221;, &#8220;common/error/systemError&#8221; becomes the destination View name.</div>
<div class="line"><strong>[Location to be customized for each project]</strong></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">Specify default value of HTTP status code to be set in response header. It is recommended that you set <strong>&#8220;500&#8221;(Internal Server Error)</strong>.</div>
</div>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Behavior when nothing is specified</strong></p>
<p class="last">Please note that it will be handled as <strong>&#8220;200&#8221;(OK)</strong>.</p>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><p class="first">Actual <code class="docutils literal"><span class="pre">View</span></code> depends on <code class="docutils literal"><span class="pre">ViewResolver</span></code> settings.</p>
<p>In above settings, destination pages will be as given below.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">/WEB-INF/views/common/error/systemError.jsp</span></code></li>
<li><code class="docutils literal"><span class="pre">/WEB-INF/views/common/error/resourceNotFoundError.jsp</span></code></li>
<li><code class="docutils literal"><span class="pre">/WEB-INF/views/common/error/businessError.jsp</span></code></li>
<li><code class="docutils literal"><span class="pre">/WEB-INF/views/common/error/transactionTokenError.jsp</span></code></li>
<li><code class="docutils literal"><span class="pre">/WEB-INF/views/common/error/dataAccessError.jsp</span></code></li>
</ul>
<div class="last admonition tip">
<p class="first admonition-title">Tip</p>
<p><code class="docutils literal"><span class="pre">&lt;mvc:view-resolvers&gt;</span></code> is an XML element added from Spring Framework 4.1.
If <code class="docutils literal"><span class="pre">&lt;mvc:view-resolvers&gt;</span></code> element is used, it is possible to define <code class="docutils literal"><span class="pre">ViewResolver</span></code> in simple manner.</p>
<p>Example of definition when <code class="docutils literal"><span class="pre">&lt;bean&gt;</span></code> element is used in a conventional manner is given below.</p>
<blockquote class="last">
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;viewResolver&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;prefix&quot;</span> <span class="na">value=</span><span class="s">&quot;/WEB-INF/views/&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;suffix&quot;</span> <span class="na">value=</span><span class="s">&quot;.jsp&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>AOP settings and interceptor class (<code class="docutils literal"><span class="pre">HandlerExceptionResolverLoggingInterceptor</span></code>) in order to output the log of exceptions handled by <code class="docutils literal"><span class="pre">HandlerExceptionResolver</span></code> should be added to bean definition.</p>
<ul class="simple">
<li><strong>spring-mvc.xml</strong></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- Setting AOP. --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;handlerExceptionResolverLoggingInterceptor&quot;</span>
<span class="hll">    <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.exception.HandlerExceptionResolverLoggingInterceptor&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionLogger&quot;</span> <span class="na">ref=</span><span class="s">&quot;exceptionLogger&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;aop:config&gt;</span>
    <span class="nt">&lt;aop:advisor</span> <span class="na">advice-ref=</span><span class="s">&quot;handlerExceptionResolverLoggingInterceptor&quot;</span>
<span class="hll">        <span class="na">pointcut=</span><span class="s">&quot;execution(* org.springframework.web.servlet.HandlerExceptionResolver.resolveException(..))&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="nt">&lt;/aop:config&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add <code class="docutils literal"><span class="pre">HandlerExceptionResolverLoggingInterceptor</span></code> to bean definition.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Inject the logger object which outputs exception log. Specify the &#8220;exceptionLogger&#8221; defined in <code class="docutils literal"><span class="pre">applicationContext.xml</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Apply <code class="docutils literal"><span class="pre">HandlerExceptionResolverLoggingInterceptor</span></code> to resolveException method of <code class="docutils literal"><span class="pre">HandlerExceptionResolver</span></code> interface.</div>
<div class="line"><br /></div>
<div class="line">As per default settings, this class will not output the log for common library provided <code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.exception.ResultMessagesNotificationException</span></code> class and its subclasses.</div>
<div class="line">The reason the exceptions of the sub class of <code class="docutils literal"><span class="pre">ResultMessagesNotificationException</span></code> are excluded from the log output is because their log output is carried out by <code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.exception.ResultMessagesLoggingInterceptor</span></code>.</div>
<div class="line">If default settings need to be changed, refer to <a class="reference internal" href="#exception-handling-about-handlerexceptionresolverlogginginterceptor"><span>About HandlerExceptionResolverLoggingInterceptor settings</span></a>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Filter class (<code class="docutils literal"><span class="pre">ExceptionLoggingFilter</span></code>) used to output log of fatal errors and exceptions that are out of the boundary of Spring MVC should be added to bean definition and <code class="docutils literal"><span class="pre">web.xml</span></code>.</p>
</div></blockquote>
<ul class="simple">
<li><strong>applicationContext.xml</strong></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- Filter. --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;exceptionLoggingFilter&quot;</span>
<span class="hll">    <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.exception.ExceptionLoggingFilter&quot;</span> <span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionLogger&quot;</span> <span class="na">ref=</span><span class="s">&quot;exceptionLogger&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add <code class="docutils literal"><span class="pre">ExceptionLoggingFilter</span></code> to bean definition.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Inject the logger object which outputs exception log. Specify the &#8220;exceptionLogger&#8221; defined in <code class="docutils literal"><span class="pre">applicationContext.xml</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li><strong>web.xml</strong></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;filter&gt;</span>
<span class="hll">    <span class="nt">&lt;filter-name&gt;</span>exceptionLoggingFilter<span class="nt">&lt;/filter-name&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="nt">&lt;/filter-class&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;filter-mapping&gt;</span>
<span class="hll">    <span class="nt">&lt;filter-name&gt;</span>exceptionLoggingFilter<span class="nt">&lt;/filter-name&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span> <span class="c">&lt;!-- (4) --&gt;</span>
</span><span class="nt">&lt;/filter-mapping&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the filter name. Match it with the bean name of <code class="docutils literal"><span class="pre">ExceptionLoggingFilter</span></code> defined in <code class="docutils literal"><span class="pre">applicationContext.xml</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the filter class. The value should be fixed to <code class="docutils literal"><span class="pre">org.springframework.web.filter.DelegatingFilterProxy</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the name of the filter to be mapped. The value specified in (1).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the URL pattern to which the filter must be applied. It is recommended that you use <code class="docutils literal"><span class="pre">/*</span></code> for outputting log of fatal errors and exceptions that are out of the boundary of Spring MVC.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>Output Log</li>
</ul>
<blockquote>
<div><div class="highlight-guess"><div class="highlight"><pre><span class="n">date</span><span class="o">:</span><span class="mi">2013</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">25</span> <span class="mi">19</span><span class="o">:</span><span class="mi">51</span><span class="o">:</span><span class="mi">52</span>    <span class="n">thread</span><span class="o">:</span><span class="n">tomcat</span><span class="o">-</span><span class="n">http</span><span class="o">--</span><span class="mi">3</span>   <span class="n">X</span><span class="o">-</span><span class="n">Track</span><span class="o">:</span><span class="n">f94de92148f1489b9ceeac3b2f17c969</span>        <span class="n">level</span><span class="o">:</span><span class="n">ERROR</span>     <span class="n">logger</span><span class="o">:</span><span class="n">o</span><span class="o">.</span><span class="na">t</span><span class="o">.</span><span class="na">gfw</span><span class="o">.</span><span class="na">common</span><span class="o">.</span><span class="na">exception</span><span class="o">.</span><span class="na">ExceptionLogger</span>         <span class="n">message</span><span class="o">:[</span><span class="n">e</span><span class="o">.</span><span class="na">xx</span><span class="o">.</span><span class="na">fw</span><span class="o">.</span><span class="mi">9001</span><span class="o">]</span> <span class="n">An</span> <span class="n">exception</span> <span class="n">occurred</span> <span class="n">processing</span> <span class="n">JSP</span> <span class="n">page</span> <span class="sr">/WEB-INF/views/</span><span class="n">exampleJSPException</span><span class="o">.</span><span class="na">jsp</span> <span class="n">at</span> <span class="n">line</span> <span class="mi">13</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="servlet-container-settings">
<span id="exception-handling-how-to-use-application-configuration-container-label"></span><h4><a class="toc-backref" href="#id49">5.7.3.1.4. Servlet Container Settings</a><a class="headerlink" href="#servlet-container-settings" title="Permalink to this headline">¶</a></h4>
<p>Add error-page definition for Servlet Container in order to handle error response (HttpServletResponse#sendError) received through default exception handling functionality of Spring MVC, fatal errors and the exceptions that are out of the boundary of Spring MVC.</p>
<ul class="simple">
<li><strong>web.xml</strong></li>
</ul>
<blockquote>
<div><p>Add definitions in order to handle error response (HttpServletResponse#sendError) received through default exception handling functionality of Spring MVC.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;error-page&gt;</span>
    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;error-code&gt;</span>404<span class="nt">&lt;/error-code&gt;</span>
    <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;location&gt;</span>/WEB-INF/views/common/error/resourceNotFoundError.jsp<span class="nt">&lt;/location&gt;</span>
<span class="nt">&lt;/error-page&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the <strong>HTTP Response Code</strong> to be handled.</div>
<div class="line"><strong>[Location to be customized for each project]</strong></div>
<div class="line">For HTTP response code for which response is sent using the default exception handling function of Spring MVC, refer to <a class="reference internal" href="#exception-handling-appendix-defaulthandlerexceptionresolver-label"><span>HTTP response code set by DefaultHandlerExceptionResolver</span></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the file name. It should be specified with the path from Web application root. In the above settings, &#8220;${WebAppRoot}/WEB-INF/views/common/error/resourceNotFoundError.jsp&#8221; will be the View file.</div>
<div class="line"><strong>[Location to be customized for each project]</strong></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Add definitions in order to handle fatal errors and exceptions that are out of the boundary of Spring MVC.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;error-page&gt;</span>
    <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;location&gt;</span>/WEB-INF/views/common/error/unhandledSystemError.html<span class="nt">&lt;/location&gt;</span>
<span class="nt">&lt;/error-page&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the file name. Specify with a path from web application root. In the above settings, &#8220;${WebAppRoot}/WEB-INF/views/common/error/unhandledSystemError.html&#8221; will be the View file.</div>
<div class="line"><strong>[Location to be customized for each project]</strong></div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>About the path specified in location tag</strong></p>
<p class="last">If a fatal error occurs, there is high possibility of getting another error if the path of dynamic contents is specified.; hence
in location tag, <strong>it is recommended that you specify a path of static contents such as HTML</strong> and not dynamic contents such as JSP.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>If untraceable error occurs during development</strong></p>
<p>If an unexpected error response (HttpServletResponse#sendError) occurs after carrying out the above settings, there may be cases wherein it cannot be determined what kind of error response occurred.</p>
<p>Error screen specified in location tag is displayed; however if the cause of error cannot be identified from logs,
it is possible to verify the error response (HTTP response code) on screen by commenting out the above settings.</p>
<p>When it is necessary to individually handle the exceptions that are out of the boundary of Spring MVC, definition of each exception should be added.</p>
<blockquote class="last">
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;error-page&gt;</span>
    <span class="c">&lt;!-- (4) --&gt;</span>
    <span class="nt">&lt;exception-type&gt;</span>java.io.IOException<span class="nt">&lt;/exception-type&gt;</span>
    <span class="c">&lt;!-- (5) --&gt;</span>
    <span class="nt">&lt;location&gt;</span>/WEB-INF/views/common/error/systemError.jsp<span class="nt">&lt;/location&gt;</span>
<span class="nt">&lt;/error-page&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the <strong>Exception Class Name (FQCN)</strong> to be handled.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the file name. Specify it using a path from web application root. In above case, &#8220;${WebAppRoot}/WEB-INF/views/common/error/systemError.jsp&#8221; will be the View file.</div>
<div class="line"><strong>[Location to be customized for each project]</strong></div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="coding-points-service">
<span id="exception-handling-how-to-use-codingpoint-service-label"></span><h3><a class="toc-backref" href="#id50">5.7.3.2. Coding Points (Service)</a><a class="headerlink" href="#coding-points-service" title="Permalink to this headline">¶</a></h3>
<p>The coding points in Service when handling the exceptions are given below.</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#exception-handling-how-to-use-codingpoint-service-business-label"><span>Generating Business Exception</span></a></li>
<li><a class="reference internal" href="#exception-handling-how-to-use-codingpoint-service-system-label"><span>Generating System Exception</span></a></li>
<li><a class="reference internal" href="#exception-handling-how-to-use-codingpoint-service-continue-label"><span>Catch the exception to continue the execution</span></a></li>
</ol>
<div class="section" id="generating-business-exception">
<span id="exception-handling-how-to-use-codingpoint-service-business-label"></span><h4><a class="toc-backref" href="#id51">5.7.3.2.1. Generating Business Exception</a><a class="headerlink" href="#generating-business-exception" title="Permalink to this headline">¶</a></h4>
<p>The method of generating Business Exception is given below.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Notes related to the method of generating business exception</strong></p>
<ul class="last">
<li><div class="first line-block">
<div class="line">It is recommended that you generate the business exception by detecting violation of business rules in logic.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">When it is required by the API specification of underlying base framework or existing layer of application, that violation of business rule be notified through an exception, then it is OK to catch the exception and throw it as business exception.</div>
<div class="line">Use of an exception to control the processing flow lowers the readability of overall logic and thus may reduce maintainability.</div>
</div>
</li>
</ul>
</div>
<div class="line-block">
<div class="line">Generate business exceptions by detecting violation of business rules in logic.</div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<ul class="last simple">
<li>It is assumed that business exception is generated in Service by default. In <a class="reference internal" href="#exception-handling-how-to-use-service-pointcut-aop-label"><span>AOP settings</span></a>,
log of business exception occurred in class with <code class="docutils literal"><span class="pre">&#64;Service</span></code> annotation, is being output.
Business exceptions should not be logged in Controller etc. This rule can be changed if needed in the project.</li>
</ul>
</div>
<ul class="simple">
<li>xxxService.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="o">...</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExampleExceptionServiceImpl</span> <span class="kd">implements</span> <span class="n">ExampleExceptionService</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">throwBusinessException</span><span class="o">(</span><span class="n">String</span> <span class="n">test</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">...</span>
        <span class="c1">// int stockQuantity = 5;</span>
        <span class="c1">// int orderQuantity = 6;</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">stockQuantity</span> <span class="o">&lt;</span> <span class="n">orderQuantity</span><span class="o">)</span> <span class="o">{</span>                  <span class="c1">// (1)</span>
            <span class="n">ResultMessages</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">ResultMessages</span><span class="o">.</span><span class="na">error</span><span class="o">();</span> <span class="c1">// (2)</span>
            <span class="n">messages</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;e.ad.od.5001&quot;</span><span class="o">,</span> <span class="n">stockQuantity</span><span class="o">);</span>      <span class="c1">// (3)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">BusinessException</span><span class="o">(</span><span class="n">messages</span><span class="o">);</span>            <span class="c1">// (4)</span>
        <span class="o">}</span>
        <span class="o">...</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Check whether there is any violation of a business rule.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">If there is a violation, generate ResultMessages. In the above example, ResultMessages of error level are being generated.</div>
<div class="line">For the details on method of generating ResultMessages, refer to <a class="reference internal" href="MessageManagement.html"><em>Message Management</em></a>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add ResultMessage to ResultMessages. Specify message ID as 1st argument (mandatory) and value to be inserted in message as 2nd argument (optional).</div>
<div class="line">The value to be inserted in message is a variable-length parameter; hence multiple values can be specified.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify ResultMessages and generate BusinessException.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>For the purpose of explanation, <code class="docutils literal"><span class="pre">xxxService.java</span></code> logic is written in steps (2)-(4) as shown above, however it can also be written in a single step.</p>
<blockquote class="last">
<div><div class="highlight-java"><div class="highlight"><pre><span class="k">throw</span> <span class="k">new</span> <span class="n">BusinessException</span><span class="o">(</span><span class="n">ResultMessages</span><span class="o">.</span><span class="na">error</span><span class="o">().</span><span class="na">add</span><span class="o">(</span>
     <span class="s">&quot;e.ad.od.5001&quot;</span><span class="o">,</span> <span class="n">stockQuantity</span><span class="o">));</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div></blockquote>
<ul>
<li><p class="first">xxx.properties</p>
<p>Add the below settings to the properties file.</p>
<div class="highlight-properties"><div class="highlight"><pre><span class="na">e.ad.od.5001</span> <span class="o">=</span> <span class="s">Order number is higher than the stock quantity={0}. Change the order number.</span>
</pre></div>
</div>
</li>
</ul>
<p>An application log as shown below is output.</p>
<blockquote>
<div><div class="highlight-console"><div class="highlight"><pre><span class="go">date:2013-09-17 22:25:55    thread:tomcat-http--8   X-Track:6cfb0b378c124b918e40ac0c32a1fac7        level:WARN      logger:o.t.gfw.common.exception.ExceptionLogger         message:[e.xx.fw.8001] ResultMessages [type=error, list=[ResultMessage [code=e.ad.od.5001, args=[5], text=null]]]</span>
<span class="go">org.terasoluna.gfw.common.exception.BusinessException: ResultMessages [type=error, list=[ResultMessage [code=e.ad.od.5001, args=[5], text=null]]]</span>

<span class="go">// stackTrace omitted</span>
<span class="go">...</span>

<span class="go">date:2013-09-17 22:25:55    thread:tomcat-http--8   X-Track:6cfb0b378c124b918e40ac0c32a1fac7        level:DEBUG     logger:o.t.gfw.web.exception.SystemExceptionResolver    message:Resolving exception from handler [public java.lang.String org.terasoluna.exception.app.example.ExampleExceptionController.home(java.util.Locale,org.springframework.ui.Model)]: org.terasoluna.gfw.common.exception.BusinessException: ResultMessages [type=error, list=[ResultMessage [code=e.ad.od.5001, args=[5], text=null]]]</span>
<span class="go">date:2013-09-17 22:25:55    thread:tomcat-http--8   X-Track:6cfb0b378c124b918e40ac0c32a1fac7        level:DEBUG     logger:o.t.gfw.web.exception.SystemExceptionResolver    message:Resolving to view &#39;common/error/businessError&#39; for exception of type [org.terasoluna.gfw.common.exception.BusinessException], based on exception mapping [BusinessException]</span>
<span class="go">date:2013-09-17 22:25:55    thread:tomcat-http--8   X-Track:6cfb0b378c124b918e40ac0c32a1fac7        level:DEBUG     logger:o.t.gfw.web.exception.SystemExceptionResolver    message:Applying HTTP status code 409</span>
<span class="go">date:2013-09-17 22:25:55    thread:tomcat-http--8   X-Track:6cfb0b378c124b918e40ac0c32a1fac7        level:DEBUG     logger:o.t.gfw.web.exception.SystemExceptionResolver    message:Exposing Exception as model attribute &#39;exception&#39;</span>
</pre></div>
</div>
</div></blockquote>
<p>Displayed screen</p>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../_images/exception-handling-screen-businessexception.png"><img alt="screen business exception" src="../_images/exception-handling-screen-businessexception.png" style="width: 50%;" /></a>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It is recommended that you handle business exception in Controller and display a message on each business screen.
The above example illustrates a screen which is displayed when the exception is not handled in Controller.</p>
</div>
</div></blockquote>
<p>Catch an exception to generate a business exception</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="k">try</span> <span class="o">{</span>
    <span class="n">order</span><span class="o">(</span><span class="n">orderQuantity</span><span class="o">,</span> <span class="n">itemId</span> <span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">StockNotEnoughException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>                  <span class="c1">// (1)</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">BusinessException</span><span class="o">(</span><span class="n">ResultMessages</span><span class="o">.</span><span class="na">error</span><span class="o">().</span><span class="na">add</span><span class="o">(</span>
            <span class="s">&quot;e.ad.od.5001&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getStockQuantity</span><span class="o">()),</span> <span class="n">e</span><span class="o">);</span> <span class="c1">// (2)</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Catch the exception that occurs when a business rule is violated.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify ResultMessages and <strong>Cause Exception (e)</strong> to generate BusinessException.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="generating-system-exception">
<span id="exception-handling-how-to-use-codingpoint-service-system-label"></span><h4><a class="toc-backref" href="#id52">5.7.3.2.2. Generating System Exception</a><a class="headerlink" href="#generating-system-exception" title="Permalink to this headline">¶</a></h4>
<p>The method of generating SystemException is given below.</p>
<p>Generate a system exception by detecting a system error in logic.</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="k">if</span> <span class="o">(</span><span class="n">itemEntity</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>                                      <span class="c1">// (1)</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">SystemException</span><span class="o">(</span><span class="s">&quot;e.ad.od.9012&quot;</span><span class="o">,</span>
        <span class="s">&quot;not found item entity. item code [&quot;</span> <span class="o">+</span> <span class="n">itemId</span> <span class="o">+</span> <span class="s">&quot;].&quot;</span><span class="o">);</span> <span class="c1">// (2)</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Check whether the system is in normal state.</div>
<div class="line">In this example, it is checked whether the requested product code (itemId) exists in the product master (Item Master).</div>
<div class="line">If it does not exist in the product master, it would be considered that a resource which should have been available in the system, does not exist and hence it is treated as system error.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">If the system is in an abnormal state, specify the exception code (message ID) as 1st argument. Specify exception message as 2nd argument to generate SystemException.</div>
<div class="line">In the above example, the value of variable &#8220;itemId&#8221; is inserted in message text.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Application log as shown below is output.</p>
<blockquote>
<div><div class="highlight-console"><div class="highlight"><pre><span class="go">date:2013-09-19 21:03:06      thread:tomcat-http--3   X-Track:c19eec546b054d54a13658f94292b24f        level:DEBUG     logger:o.t.gfw.web.exception.SystemExceptionResolver    message:Resolving exception from handler [public java.lang.String org.terasoluna.exception.app.example.ExampleExceptionController.home(java.util.Locale,org.springframework.ui.Model)]: org.terasoluna.gfw.common.exception.SystemException: not found item entity. item code [10-123456].</span>
<span class="go">date:2013-09-19 21:03:06      thread:tomcat-http--3   X-Track:c19eec546b054d54a13658f94292b24f        level:DEBUG     logger:o.t.gfw.web.exception.SystemExceptionResolver    message:Resolving to default view &#39;common/error/systemError&#39; for exception of type [org.terasoluna.gfw.common.exception.SystemException]</span>
<span class="go">date:2013-09-19 21:03:06      thread:tomcat-http--3   X-Track:c19eec546b054d54a13658f94292b24f        level:DEBUG     logger:o.t.gfw.web.exception.SystemExceptionResolver    message:Applying HTTP status code 500</span>
<span class="go">date:2013-09-19 21:03:06      thread:tomcat-http--3   X-Track:c19eec546b054d54a13658f94292b24f        level:DEBUG     logger:o.t.gfw.web.exception.SystemExceptionResolver    message:Exposing Exception as model attribute &#39;exception&#39;</span>
<span class="go">date:2013-09-19 21:03:06      thread:tomcat-http--3   X-Track:c19eec546b054d54a13658f94292b24f        level:ERROR     logger:o.t.gfw.common.exception.ExceptionLogger         message:[e.ad.od.9012] not found item entity. item code [10-123456].</span>
<span class="go">org.terasoluna.gfw.common.exception.SystemException: not found item entity. item code [10-123456].</span>
<span class="go">      at org.terasoluna.exception.domain.service.ExampleExceptionServiceImpl.throwSystemException(ExampleExceptionServiceImpl.java:14) ~[ExampleExceptionServiceImpl.class:na]</span>
<span class="go">...</span>
<span class="go">// stackTrace omitted</span>
</pre></div>
</div>
</div></blockquote>
<p>Displayed screen</p>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../_images/exception-handling-screen-systemexception.png"><img alt="screen system exception" src="../_images/exception-handling-screen-systemexception.png" style="width: 60%;" /></a>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>It is recommended to have a common system error screen rather than creating multiple screens for system errors.</p>
<p class="last">The screen mentioned in this guideline displays a (business-wise) message ID for system errors and has a fixed message.
This is because there is no need to inform the details of error to the operator and it is sufficient to only convey that the system error has occurred.
Therefore, in order to enhance the response for inquiry against system errors, the Message ID which acts as a key for the message text is displayed on the screen,
in order to make the analysis easier for the development side.
Displayed error screens should be designed in accordance with the UI standards of each project.</p>
</div>
</div></blockquote>
<p>Catch an exception to generate system exception.</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="k">try</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">preUploadDir</span><span class="o">.</span><span class="na">getFile</span><span class="o">(),</span> <span class="n">key</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">FileNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// (1)</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">SystemException</span><span class="o">(</span><span class="s">&quot;e.ad.od.9007&quot;</span><span class="o">,</span>
        <span class="s">&quot;not found upload file. file is [&quot;</span> <span class="o">+</span> <span class="n">preUploadDir</span><span class="o">.</span><span class="na">getDescription</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;].&quot;</span>
        <span class="n">e</span><span class="o">);</span> <span class="c1">// (2)</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Catch the checked exception classified as system error.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the exception code (message ID), message, <strong>Cause Exception (e)</strong> to generate SystemException.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="catch-the-exception-to-continue-the-execution">
<span id="exception-handling-how-to-use-codingpoint-service-continue-label"></span><h4><a class="toc-backref" href="#id53">5.7.3.2.3. Catch the exception to continue the execution</a><a class="headerlink" href="#catch-the-exception-to-continue-the-execution" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">When it is necessary to catch the exception to continue the execution, the exception should be logged before continuing the execution.</div>
</div>
<div class="line-block">
<div class="line">When fetching customer interaction history from external system fails, the process of fetching information other than customer history can still be continued. This is illustrated in the following example.</div>
<div class="line">In this example, although fetching of customer history fails, business process does not have to be stopped and hence the execution continues.</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="nd">@Inject</span>
<span class="n">ExceptionLogger</span> <span class="n">exceptionLogger</span><span class="o">;</span> <span class="c1">// (1)</span>

<span class="c1">// ...</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span class="n">InteractionHistory</span> <span class="n">interactionHistory</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">interactionHistory</span> <span class="o">=</span> <span class="n">restTemplete</span><span class="o">.</span><span class="na">getForObject</span><span class="o">(</span><span class="n">uri</span><span class="o">,</span> <span class="n">InteractionHistory</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">customerId</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">RestClientException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// (2)</span>
    <span class="n">exceptionLogger</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">e</span><span class="o">);</span> <span class="c1">// (3)</span>
<span class="o">}</span>

<span class="c1">// (4)</span>
<span class="n">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">customerRepository</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">customerId</span><span class="o">);</span>

<span class="c1">// ...</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Inject the object of <code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.exception.ExceptionLogger</span></code> provided by the common library for log output.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Catch the exception to be handled.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Output the handled exception to log. In the example, log method is being called; however if the output level is known in advance</div>
<div class="line">and if there is no possibility of any change in output level, it is ok to call info, warn, error methods directly.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Continue the execution just by outputting the log in (3).</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>An application log as shown below is output.</p>
<blockquote>
<div><div class="highlight-console"><div class="highlight"><pre><span class="go">date:2013-09-19 21:31:47      thread:tomcat-http--3   X-Track:df5271ece2304b12a2c59ff494806397        level:ERROR     logger:o.t.gfw.common.exception.ExceptionLogger         message:[e.xx.fw.9001] Test example exception</span>
<span class="go">org.springframework.web.client.RestClientException: Test example exception</span>
<span class="go">...</span>
<span class="go">// stackTrace omitted</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">When log() is used in <code class="docutils literal"><span class="pre">exceptionLogger</span></code>, since it will be output at error level; by default, it will be output in monitoring log also.</p>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="go">date:2013-09-19 21:31:47  X-Track:df5271ece2304b12a2c59ff494806397        level:ERROR     message:[e.xx.fw.9001] Test example exception</span>
</pre></div>
</div>
</div></blockquote>
<p>As shown in following example, if there is no problem in continuing the execution, and if monitoring log is being monitored through application monitoring, it should be set to a level such that it will not get monitored at log output level or defined such that it does not get monitored from the log content (log message).</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">RestClientException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">exceptionLogger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">As per default settings, monitoring log other than error level will not be output. It is output in application log as follows:</div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="go">date:2013-09-19 22:17:53    thread:tomcat-http--3   X-Track:999725b111b4445b8d10b4ea44639c61        level:INFO      logger:o.t.gfw.common.exception.ExceptionLogger         message:[e.xx.fw.9001] Test example exception</span>
<span class="go">org.springframework.web.client.RestClientException: Test example exception</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="coding-points-controller">
<span id="exception-handling-how-to-use-codingpoint-controller-label"></span><h3><a class="toc-backref" href="#id54">5.7.3.3. Coding Points (Controller)</a><a class="headerlink" href="#coding-points-controller" title="Permalink to this headline">¶</a></h3>
<p>The coding points in Controller while handling the exceptions are given below.</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#exception-handling-how-to-use-codingpoint-controller-request-label"><span>Method to handle exceptions at request level</span></a></li>
<li><a class="reference internal" href="#exception-handling-how-to-use-codingpoint-controller-usecase-label"><span>Method to handle exception at use case level</span></a></li>
</ol>
<div class="section" id="method-to-handle-exceptions-at-request-level">
<span id="exception-handling-how-to-use-codingpoint-controller-request-label"></span><h4><a class="toc-backref" href="#id55">5.7.3.3.1. Method to handle exceptions at request level</a><a class="headerlink" href="#method-to-handle-exceptions-at-request-level" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Handle the exception at request level and set the message related information to Model.</div>
<div class="line">Then, by calling the method for displaying the View, generate the model required by the View and determine the View name.</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;change&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">change</span><span class="o">(</span><span class="nd">@Validated</span> <span class="n">UserForm</span> <span class="n">userForm</span><span class="o">,</span>
                     <span class="n">BindingResult</span> <span class="n">result</span><span class="o">,</span>
                     <span class="n">RedirectAttributes</span> <span class="n">redirectAttributes</span><span class="o">,</span>
                     <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>         <span class="c1">// (1)</span>

    <span class="c1">// omitted</span>

    <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userHelper</span><span class="o">.</span><span class="na">convertToUser</span><span class="o">(</span><span class="n">userForm</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">change</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">BusinessException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>                                   <span class="c1">// (2)</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getResultMessages</span><span class="o">());</span>                    <span class="c1">// (3)</span>
        <span class="k">return</span> <span class="n">viewChangeForm</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getUserId</span><span class="o">(),</span> <span class="n">model</span><span class="o">);</span>               <span class="c1">// (4)</span>
    <span class="o">}</span>

    <span class="c1">// omitted</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">As of the parameters of the method, define Model in argument as an object which will be used to link the error information with View.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Exceptions which need to be handled should be caught in application code.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add ResultMessages object to Model.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Call the method for displaying the View at the time of error. Fetch the model and View name required for View display and then return the View name to be displayed.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="method-to-handle-exception-at-use-case-level">
<span id="exception-handling-how-to-use-codingpoint-controller-usecase-label"></span><h4><a class="toc-backref" href="#id56">5.7.3.3.2. Method to handle exception at use case level</a><a class="headerlink" href="#method-to-handle-exception-at-use-case-level" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Handle the exception at use case level and generate ModelMap (ExtendedModelMap) wherein message related information etc. is stored.</div>
<div class="line">Then, by calling the method for displaying the View, generate the model required by the View and determine the View name.</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">BusinessException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="c1">// (1)</span>
<span class="nd">@ResponseStatus</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">CONFLICT</span><span class="o">)</span> <span class="c1">// (2)</span>
<span class="kd">public</span> <span class="n">ModelAndView</span> <span class="nf">handleBusinessException</span><span class="o">(</span><span class="n">BusinessException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ExtendedModelMap</span> <span class="n">modelMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ExtendedModelMap</span><span class="o">();</span>                 <span class="c1">// (3)</span>
    <span class="n">modelMap</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getResultMessages</span><span class="o">());</span>                       <span class="c1">// (4)</span>
    <span class="n">String</span> <span class="n">viewName</span> <span class="o">=</span> <span class="n">top</span><span class="o">(</span><span class="n">modelMap</span><span class="o">);</span>                                    <span class="c1">// (5)</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">ModelAndView</span><span class="o">(</span><span class="n">viewName</span><span class="o">,</span> <span class="n">modelMap</span><span class="o">);</span>                        <span class="c1">// (6)</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">The exception class which need to be handled should be specified in the value attribute of <code class="docutils literal"><span class="pre">&#64;ExceptionHandler</span></code> annotation. You can also specify multiple exceptions which are in the scope of handling.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the HTTP status code to be returned to value attribute of <code class="docutils literal"><span class="pre">&#64;ResponseStatus</span></code> annotation. In the example, &#8220;409: Conflict&#8221; is specified.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Generate ExtendedModelMap as an object to link the error information and model information with View.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add ResultMessages object to ExtendedModelMap.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Call the method to display the View at the time of error and fetch model and View name necessary for View display.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Generate ModelAndView wherein View name and Model acquired in steps (3)-(5) are stored and then return the same.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="coding-points-jsp">
<span id="exception-handling-how-to-use-codingpoint-jsp-label"></span><h3><a class="toc-backref" href="#id57">5.7.3.4. Coding points (JSP)</a><a class="headerlink" href="#coding-points-jsp" title="Permalink to this headline">¶</a></h3>
<p>The coding points in JSP while handling the exceptions are given below.</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#exception-handling-how-to-use-codingpoint-jsp-panel-label"><span>Method to display messages on screen using MessagesPanelTag</span></a></li>
<li><a class="reference internal" href="#exception-handling-how-to-use-codingpoint-jsp-exceptioncode-label"><span>Method to display system exception code on screen</span></a></li>
</ol>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>When Internet Explorer is a support browser,
implementation should be such that size of the HTML responded as error screen should be 513 bytes or more.</p>
<p>This is because in case of Internet Explorer,
if the following three conditions such as</p>
<ul class="simple">
<li>Response status code is Error (4xx and 5xx)</li>
<li>Response HTML is 512 bytes or less</li>
<li>Browser setting &#8220;Show Friendly HTTP Error Messages&#8221; is valid</li>
</ul>
<p class="last">are satisfied, the mechanism is such that friendly messages created by Internet Explorer will be displayed.</p>
</div>
<div class="section" id="method-to-display-messages-on-screen-using-messagespaneltag">
<span id="exception-handling-how-to-use-codingpoint-jsp-panel-label"></span><h4><a class="toc-backref" href="#id58">5.7.3.4.1. Method to display messages on screen using MessagesPanelTag</a><a class="headerlink" href="#method-to-display-messages-on-screen-using-messagespaneltag" title="Permalink to this headline">¶</a></h4>
<p>The example below illustrates implementation at the time of outputting ResultMessages to an arbitrary location.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;t:messagesPanel</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>&lt;t:messagesPanel&gt; tag should be specified at a location where the message is to be output. For details on usage of &lt;t:messagesPanel&gt; tag, refer to <a class="reference internal" href="MessageManagement.html"><em>Message Management</em></a>.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="method-to-display-system-exception-code-on-screen">
<span id="exception-handling-how-to-use-codingpoint-jsp-exceptioncode-label"></span><h4><a class="toc-backref" href="#id59">5.7.3.4.2. Method to display system exception code on screen</a><a class="headerlink" href="#method-to-display-system-exception-code-on-screen" title="Permalink to this headline">¶</a></h4>
<p>The example below illustrates implementation at the time of displaying exception code (message ID) and fixed message at an arbitrary location.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">&quot;${!empty exceptionCode}&quot;</span><span class="nt">&gt;</span>  <span class="c">&lt;!-- (1) --&gt;</span>
        [${f:h(exceptionCode)}]            <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;/c:if&gt;</span>
    <span class="nt">&lt;spring:message</span> <span class="na">code=</span><span class="s">&quot;e.cm.fw.9999&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Check whether exception code (message ID) exists. Perform existence check when the exception code (message ID) is enclosed with symbols as shown in the above example.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Output exception code (message ID).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Output fixed message acquired from message definition.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>Output Screen (With exceptionCode)</li>
</ul>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../_images/exception-handling-screen-systemexception-messagecode.png"><img alt="screen system exception messagecode" src="../_images/exception-handling-screen-systemexception-messagecode.png" style="width: 40%;" /></a>
</div>
</div></blockquote>
<ul class="simple">
<li>Output Screen (Without exceptionCode)</li>
</ul>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../_images/exception-handling-screen-systemexceptionbyjspexception.png"><img alt="screen system exception no messagecode" src="../_images/exception-handling-screen-systemexceptionbyjspexception.png" style="width: 40%;" /></a>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Messages to be output at the time of system exception</strong></p>
<ul class="last simple">
<li>When a system exception occurs, it is recommended that you display a message which would only convey that a system exception has occurred, without outputting a detailed message from which cause of error can be identified or guessed.</li>
<li>On displaying a detailed message from which cause of error can be identified or guessed, the vulnerabilities of system are likely to get exposed.</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Exception code (message ID)</strong></p>
<ul class="last simple">
<li>When a system exception occurs, it is desirable to output an exception code (message ID) instead of a detailed message.</li>
<li>By outputting the exception code (message ID), it is possible for development team to respond quickly to the inquiries from system user.</li>
<li>Only a system administrator can identify the cause of error from exception code (message ID); hence the risk of exposing the vulnerabilities of system is lowered.</li>
</ul>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="how-to-use-ajax">
<h2><a class="toc-backref" href="#id60">5.7.4. How to use (Ajax)</a><a class="headerlink" href="#how-to-use-ajax" title="Permalink to this headline">¶</a></h2>
<p>For the exception handling of Ajax, refer to <a class="reference internal" href="Ajax.html"><em>Ajax</em></a>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="appendix">
<h2><a class="toc-backref" href="#id61">5.7.5. Appendix</a><a class="headerlink" href="#appendix" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><a class="reference internal" href="#exception-handling-about-classes-of-library-label"><span>Exception handling classes provided by the common library</span></a></li>
<li><a class="reference internal" href="#exception-handling-about-systemexceptionresolver-label"><span>About SystemExceptionResolver settings</span></a></li>
<li><a class="reference internal" href="#exception-handling-appendix-defaulthandlerexceptionresolver-label"><span>HTTP response code set by DefaultHandlerExceptionResolver</span></a></li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="exception-handling-classes-provided-by-the-common-library">
<span id="exception-handling-about-classes-of-library-label"></span><h3><a class="toc-backref" href="#id62">5.7.5.1. Exception handling classes provided by the common library</a><a class="headerlink" href="#exception-handling-classes-provided-by-the-common-library" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">In addition to the classes provided by Spring MVC, the classes for carrying out exception handling are being provided by the common library.</div>
<div class="line">The roles of classes are as follows:</div>
</div>
<table border="1" class="docutils" id="id17">
<caption><span class="caption-text"><strong>Table - Classes under org.terasoluna.gfw.common.exception package</strong></span><a class="headerlink" href="#id17" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="11%" />
<col width="21%" />
<col width="68%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Class</th>
<th class="head">Role</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ExceptionCode</div>
<div class="line">Resolver</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">An interface for resolving exception code (message ID) of exception class.</div>
<div class="line">An exception code is used for identifying the exception type and is expected to be output to system error screen and log.</div>
<div class="line">It is referenced from <code class="docutils literal"><span class="pre">ExceptionLogger</span></code>, <code class="docutils literal"><span class="pre">SystemExceptionResolver</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">SimpleMapping</div>
<div class="line">ExceptionCode</div>
<div class="line">Resolver</div>
</div>
</td>
<td><div class="first line-block">
<div class="line">Implementation class of <code class="docutils literal"><span class="pre">ExceptionCodeResolver</span></code> contains the mapping of exception class name and exception code, through which the exception code is resolved.</div>
<div class="line">The name of exception class need not be FQCN, it can be a part of FQCN or parent class name.</div>
</div>
<blockquote class="last">
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<ul class="last simple">
<li>Note that when a part of FQCN is specified, it may be matched with classes which were not assumed.</li>
<li>Note that when the name of parent class is specified, all the child classes will also be matched.</li>
</ul>
</div>
</div></blockquote>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">enums.</div>
<div class="line">ExceptionLevel</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">enum indicating exception level corresponding to exception class.</div>
<div class="line">INFO, WARN, ERROR are defined.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ExceptionLevel</div>
<div class="line">Resolver</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Interface for resolving exception level (log level) of exception class.</div>
<div class="line">Exception level is a code for identifying the level of exception and is used to switch the output level of log.</div>
<div class="line">It is referenced from <code class="docutils literal"><span class="pre">ExceptionLogger</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">DefaultException</div>
<div class="line">LevelResolver</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">This is an implementation class of <code class="docutils literal"><span class="pre">ExceptionLevelResolver</span></code> which resolves the exception level by first character of exception code.</div>
<div class="line">If the first character (case insensitive) is,</div>
<div class="line-block">
<div class="line">1. &#8220;i&#8221;, treat it as <code class="docutils literal"><span class="pre">ExceptionLevel.INFO</span></code></div>
<div class="line">2. &#8220;w&#8221;, treat it as <code class="docutils literal"><span class="pre">ExceptionLevel.WARN</span></code></div>
<div class="line">3. &#8220;e&#8221;, treat it as <code class="docutils literal"><span class="pre">ExceptionLevel.ERROR</span></code></div>
<div class="line">4. a character other than the above, treat as <code class="docutils literal"><span class="pre">ExceptionLevel.ERROR</span></code> level.</div>
</div>
<div class="line">This class is implemented in accordance with the rules of the message ID described in <a class="reference internal" href="MessageManagement.html"><em>Message</em></a> guidelines.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ExceptionLogger</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">A class to output log of exceptions.</div>
<div class="line">Monitoring log (only messages) and application log (both messages and stack trace) can be output.</div>
<div class="line">This class is used from Filter or Interceptor classes provided by the framework.</div>
<div class="line">When the execution is to be continued by handling the exceptions in application code, log should be output by using this class.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ResultMessages</div>
<div class="line">LoggingInterceptor</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">This is an interceptor class for logging an occurrence of exception which stores <code class="docutils literal"><span class="pre">ResultMessages</span></code> (sub exception of <code class="docutils literal"><span class="pre">ResultMessagesNotificationException</span></code>).</div>
<div class="line">Output all the logs at WARN level.</div>
<div class="line">It is assumed that this Interceptor will be applied to the methods of class with <code class="docutils literal"><span class="pre">&#64;Service</span></code> annotation.</div>
<div class="line">Log is output using <code class="docutils literal"><span class="pre">ExceptionLogger</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">BusinessException</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">This is an exception class to notify violation of business rules. This exception should be generated in the logic of domain layer.</div>
<div class="line">It inherits <code class="docutils literal"><span class="pre">java.lang.RuntimeException</span></code>; hence the transactions are rolled back as per default behavior.</div>
<div class="line">If you want to commit the transactions, this exception class needs to be specified in noRollbackFor or noRollbackForClassName of <code class="docutils literal"><span class="pre">&#64;Transactional</span></code> annotation.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Resource</div>
<div class="line">NotFoundException</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">This is an exception class to notify that the specified resource (data) does not exist in the system. This exception should mainly be generated in the logic of domain layer.</div>
<div class="line">It inherits <code class="docutils literal"><span class="pre">java.lang.RuntimeException</span></code>; hence the transactions are rolled back as per default behavior.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ResultMessages</div>
<div class="line">Notification</div>
<div class="line">Exception</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">This is an abstract exception class to notify that the exception holds the result messages (<code class="docutils literal"><span class="pre">ResultMessages</span></code>), and <code class="docutils literal"><span class="pre">BusinessException</span></code> and <code class="docutils literal"><span class="pre">ResourceNotFoundException</span></code> inherit it in the common library.</div>
<div class="line">It inherits <code class="docutils literal"><span class="pre">java.lang.RuntimeException</span></code>; hence the transactions are rolled back as per default behavior.</div>
<div class="line">If this exception class is inherited, log of warn level will be output by <code class="docutils literal"><span class="pre">ResultMessagesLoggingInterceptor</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(11)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">SystemException</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">This is an exception class to notify a system or application error. This exception should be generated in the logic of application layer or domain layer.</div>
<div class="line">It inherits <code class="docutils literal"><span class="pre">java.lang.RuntimeException</span></code>; hence the transactions are rolled back as per default behavior.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(12)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ExceptionCodeProvider</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">This is an interface indicating that it has a role to hold the exception code; it is implemented by <code class="docutils literal"><span class="pre">SystemException</span></code> in the common library.</div>
<div class="line">If an exception class that implements this interface is created, it can be used with the exception handling mechanism of ExceptionCodeResolver, to use the exception code of this exception class as it is.</div>
</div>
</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id18">
<caption><span class="caption-text"><strong>Table - Classes under org.terasoluna.gfw.web.exception package</strong></span><a class="headerlink" href="#id18" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="11%" />
<col width="21%" />
<col width="68%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Class</th>
<th class="head">Role</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(13)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">SystemException</div>
<div class="line">Resolver</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">This is a class for handling the exceptions that will not be handled by <code class="docutils literal"><span class="pre">HandlerExceptionResolver</span></code>, which is registered automatically when <code class="docutils literal"><span class="pre">&lt;mvc:annotation-driven&gt;</span></code> is specified.</div>
<div class="line">It inherits <code class="docutils literal"><span class="pre">SimpleMappingExceptionResolver</span></code> provided by Spring MVC and adds the functionality of referencing ResultMessages of exception code from View.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(14)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">HandlerException</div>
<div class="line">ResolverLogging</div>
<div class="line">Interceptor</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">This is an Interceptor class to output the log of exceptions handled by <code class="docutils literal"><span class="pre">HandlerExceptionResolver</span></code>.</div>
<div class="line">In this Interceptor class, the output level of log is switched based on the classification of HTTP response code resolved by <code class="docutils literal"><span class="pre">HandlerExceptionResolver</span></code>.</div>
<div class="line-block">
<div class="line">1. When it is &#8220;100-399&#8221;, log is output at INFO level.</div>
<div class="line">2. When it is &#8220;400-499&#8221;, log is output at WARN level.</div>
<div class="line">3. When it is &#8220;500-&#8221;, log is output at ERROR level.</div>
<div class="line">4. When it is &#8220;-99&#8221;, log is not output.</div>
</div>
<div class="line">By using this Interceptor, it is possible to output the log of all exceptions which are within the boundary of Spring MVC.</div>
<div class="line">Log is output using <code class="docutils literal"><span class="pre">ExceptionLogger</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(15)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ExceptionLogging</div>
<div class="line">Filter</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">This is a Filter class to output the log of fatal errors and exceptions that are out of the boundary of Spring MVC.</div>
<div class="line">All logs are output at ERROR level.</div>
<div class="line">When this Filter is used, fatal errors and all exceptions that are out of the boundary of Spring MVC can be output to log.</div>
<div class="line">Log is output using <code class="docutils literal"><span class="pre">ExceptionLogger</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="about-systemexceptionresolver-settings">
<span id="exception-handling-about-systemexceptionresolver-label"></span><h3><a class="toc-backref" href="#id63">5.7.5.2. About SystemExceptionResolver settings</a><a class="headerlink" href="#about-systemexceptionresolver-settings" title="Permalink to this headline">¶</a></h3>
<p>This section describes the settings which are not explained above.
The settings should be performed depending on the requirements.</p>
<table border="1" class="docutils" id="id19">
<caption><span class="caption-text"><strong>List of settings not explained above</strong></span><a class="headerlink" href="#id19" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="5%" />
<col width="15%" />
<col width="15%" />
<col width="45%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Field Name</th>
<th class="head">Property Name</th>
<th class="head">Description</th>
<th class="head">Default Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Attribute name of result message</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">resultMessagesAttribute</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the attribute name (String) used for setting message of businessException to Model.</div>
<div class="line">This attribute name is used for accessing result message in View(JSP).</div>
</div>
</td>
<td>resultMessages</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Attribute name of exception code (message ID)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">exceptionCode</div>
<div class="line">Attribute</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the attribute name (String) used for setting the exception code (message ID) to HttpServletRequest.</div>
<div class="line">This attribute name is used for accessing the exception code (message ID) in View(JSP).</div>
</div>
</td>
<td>exceptionCode</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Header name of exception code (message ID)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">exceptionCode</div>
<div class="line">Header</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the header name (String) used for setting the exception code (message ID) to response header of HttpServletResponse.</div>
</div>
</td>
<td>X-Exception-Code</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Attribute name of exception object</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">exceptionAttribute</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the attribute name (String) used for setting the handled exception object to Model.</div>
<div class="line">This attribute name is used for accessing the exception object in View(JSP).</div>
</div>
</td>
<td>exception</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">List of handler (Controller) objects to be used as this ExceptionResolver</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">mappedHandlers</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the object list (Set) of handlers that use this ExceptionResolver.</div>
<div class="line">Only the exceptions in the specified handler objects will be handled.</div>
<div class="line"><strong>This setting should not be specified.</strong></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Not specified</div>
<div class="line"><br /></div>
<div class="line"><strong>When specified, the operation is not guaranteed.</strong></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">List of handler (Controller) classes that use this ExceptionResolver</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">mappedHandlerClasses</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the class list (Class[]) of handlers that use this ExceptionResolver.</div>
<div class="line">Only the exceptions that occur in the specified handler classes are handled.</div>
<div class="line"><strong>This setting should not be specified</strong></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Not specified</div>
<div class="line"><br /></div>
<div class="line"><strong>When specified, the operation is not guaranteed.</strong></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Cache control flag of HTTP response</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">preventResponseCaching</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set the flag (true: Yes, false: No) for cache control at the time of HTTP response.</div>
<div class="line">If true: Yes is specified, HTTP response header to disable cache is added.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">false: No</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">(1)-(3) are the settings of <code class="docutils literal"><span class="pre">org.terasoluna.gfw.web.exception.SystemExceptionResolver</span></code>.</div>
<div class="line">(4) is the setting of <code class="docutils literal"><span class="pre">org.springframework.web.servlet.handler.SimpleMappingExceptionResolver</span></code>.</div>
<div class="line">(5)-(7) are the settings of <code class="docutils literal"><span class="pre">org.springframework.web.servlet.handler.AbstractHandlerExceptionResolver</span></code>.</div>
</div>
<div class="section" id="attribute-name-of-result-message">
<h4><a class="toc-backref" href="#id64">5.7.5.2.1. Attribute name of result message</a><a class="headerlink" href="#attribute-name-of-result-message" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">If the message set by handling the exception using SystemExceptionResolver and the message set by handling the exception in application code, both are to be output in separate messagesPanel tags in View(JSP), then specify an attribute name exclusive to SystemExceptionResolver.</div>
<div class="line">The example below illustrates settings and implementation when changing the default value to &#8220;resultMessagesForExceptionResolver&#8221;.</div>
</div>
<ul>
<li><p class="first"><strong>spring-mvc.xml</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.exception.SystemExceptionResolver&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- omitted --&gt;</span>

    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;resultMessagesAttribute&quot;</span> <span class="na">value=</span><span class="s">&quot;resultMessagesForExceptionResolver&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>

    <span class="c">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>jsp</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;t:messagesPanel</span> <span class="na">messagesAttributeName=</span><span class="s">&quot;resultMessagesForExceptionResolver&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify &#8220;resultMessagesForExceptionResolver&#8221; in result message attribute name (resultMessagesAttribute).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify attribute name that was set in SystemExceptionResolver, in message attribute name (messagesAttributeName).</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="attribute-name-of-exception-code-message-id">
<h4><a class="toc-backref" href="#id65">5.7.5.2.2. Attribute name of exception code (message ID)</a><a class="headerlink" href="#attribute-name-of-exception-code-message-id" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">When default attribute name is being used in the application code, a different value should be set in order to avoid duplication. When there is no duplication, there is no need to change the default value.</div>
<div class="line">The example below illustrates settings and implementation when changing the default value to &#8220;exceptionCodeForExceptionResolver&#8221;.</div>
</div>
<ul>
<li><p class="first"><strong>spring-mvc.xml</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.exception.SystemExceptionResolver&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- omitted --&gt;</span>

    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionCodeAttribute&quot;</span> <span class="na">value=</span><span class="s">&quot;exceptionCodeForExceptionResolver&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>

    <span class="c">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>jsp</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">&quot;${!empty exceptionCodeForExceptionResolver}&quot;</span><span class="nt">&gt;</span>  <span class="c">&lt;!-- (2) --&gt;</span>
        [${f:h(exceptionCodeForExceptionResolver)}]            <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;/c:if&gt;</span>
    <span class="nt">&lt;spring:message</span> <span class="na">code=</span><span class="s">&quot;e.cm.fw.9999&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify &#8220;exceptionCodeForExceptionResolver&#8221; in attribute name (exceptionCodeAttribute) of exception code (message ID).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the value (exceptionCodeForExceptionResolver) set in SystemExceptionResolver as a variable name (for Empty check) to be tested.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the value (exceptionCodeForExceptionResolver) set in SystemExceptionResolver as a variable name to be output.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="header-name-of-exception-code-message-id">
<h4><a class="toc-backref" href="#id66">5.7.5.2.3. Header name of exception code (message ID)</a><a class="headerlink" href="#header-name-of-exception-code-message-id" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">When default header name is being used, set a different value in order to avoid duplication. When there is no duplication, there is no need to change the default value.</div>
<div class="line">The example below illustrates settings and implementation when changing the default value to &#8220;X-Exception-Code-ForExceptionResolver&#8221;.</div>
</div>
<ul>
<li><p class="first"><strong>spring-mvc.xml</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.exception.SystemExceptionResolver&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- omitted --&gt;</span>

    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionCodeHeader&quot;</span> <span class="na">value=</span><span class="s">&quot;X-Exception-Code-ForExceptionResolver&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>

    <span class="c">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify &#8220;X-Exception-Code-ForExceptionResolver&#8221; in the header name (exceptionCodeHeader) of the exception code (message ID).</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="attribute-name-of-exception-object">
<h4><a class="toc-backref" href="#id67">5.7.5.2.4. Attribute name of exception object</a><a class="headerlink" href="#attribute-name-of-exception-object" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">When default attribute name is being used in the application code, set a different value in order to avoid duplication. When there is no duplication, there is no need to change the default value.</div>
<div class="line">The example below illustrates settings and implementation when changing the default value to &#8220;exceptionForExceptionResolver&#8221;.</div>
</div>
<ul>
<li><p class="first"><strong>spring-mvc.xml</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.exception.SystemExceptionResolver&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- omitted --&gt;</span>

    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionAttribute&quot;</span> <span class="na">value=</span><span class="s">&quot;exceptionForExceptionResolver&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>

    <span class="c">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>jsp</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;p&gt;</span>[Exception Message]<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;p&gt;</span>${f:h(exceptionForExceptionResolver.message)}<span class="nt">&lt;/p&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify &#8220;exceptionForExceptionResolver&#8221; in attribute name (exceptionAttribute) of exception object.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the value (exceptionForExceptionResolver) set in SystemExceptionResolver as a variable name for fetching message from exception object.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="cache-control-flag-of-http-response">
<h4><a class="toc-backref" href="#id68">5.7.5.2.5. Cache control flag of HTTP response</a><a class="headerlink" href="#cache-control-flag-of-http-response" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">When header for cache control is to be added to HTTP response, specify true: Yes.</div>
</div>
<ul>
<li><p class="first"><strong>spring-mvc.xml</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.exception.SystemExceptionResolver&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- omitted --&gt;</span>

    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;preventResponseCaching&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>

    <span class="c">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set the cache control flag (preventResponseCaching) of HTTP response to true: Yes.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>HTTP response header when Yes is specified</strong></p>
<p>If cache control flag of HTTP response is set to Yes, the following HTTP response header is output.</p>
<blockquote class="last">
<div><div class="line-block">
<div class="line">Cache-Control:no-store</div>
<div class="line">Cache-Control:no-cache</div>
<div class="line">Expires:Thu, 01 Jan 1970 00:00:00 GMT</div>
<div class="line">Pragma:no-cache</div>
</div>
</div></blockquote>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="about-handlerexceptionresolverlogginginterceptor-settings">
<span id="exception-handling-about-handlerexceptionresolverlogginginterceptor"></span><h3><a class="toc-backref" href="#id69">5.7.5.3. About HandlerExceptionResolverLoggingInterceptor settings</a><a class="headerlink" href="#about-handlerexceptionresolverlogginginterceptor-settings" title="Permalink to this headline">¶</a></h3>
<p>This section describes the settings which are not explained above.
The settings should be performed depending on the requirements.</p>
<table border="1" class="docutils" id="id20">
<caption><span class="caption-text"><strong>List of settings not described above</strong></span><a class="headerlink" href="#id20" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="5%" />
<col width="15%" />
<col width="15%" />
<col width="45%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Field Name</th>
<th class="head">Property Name</th>
<th class="head">Description</th>
<th class="head">Default Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">List of exception classes to be excluded from scope of logging</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ignoreExceptions</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Amongst the exceptions handled by <code class="docutils literal"><span class="pre">HandlerExceptionResolver</span></code>, the exception classes which are not to be logged should be specified in list format.</div>
<div class="line">When an exception of the specified exception class and sub class occurs, the same is not logged in this class.</div>
<div class="line">Only the exceptions which are logged at a different location (using different mechanism) should be specified here.</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">ResultMessagesNotificationException.class</span></code></div>
<div class="line"><br /></div>
<div class="line">Exceptions of <code class="docutils literal"><span class="pre">ResultMessagesNotificationException.class</span></code> and its sub classes are logged by <code class="docutils literal"><span class="pre">ResultMessagesLoggingInterceptor</span></code>; hence, as default settings, they are being excluded.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="section" id="list-of-exception-classes-to-be-excluded-from-scope-of-logging">
<h4><a class="toc-backref" href="#id70">5.7.5.3.1. List of exception classes to be excluded from scope of logging</a><a class="headerlink" href="#list-of-exception-classes-to-be-excluded-from-scope-of-logging" title="Permalink to this headline">¶</a></h4>
<p>The settings when exception classes provided in the project are to be excluded from the scope of logging, are as follows:</p>
<ul class="simple">
<li><strong>spring-mvc.xml</strong></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;handlerExceptionResolverLoggingInterceptor&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.exception.HandlerExceptionResolverLoggingInterceptor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionLogger&quot;</span> <span class="na">ref=</span><span class="s">&quot;exceptionLogger&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;ignoreExceptions&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;set&gt;</span>
            <span class="c">&lt;!-- (1) --&gt;</span>
            <span class="nt">&lt;value&gt;</span>org.terasoluna.gfw.common.exception.ResultMessagesNotificationException<span class="nt">&lt;/value&gt;</span>
            <span class="c">&lt;!-- (2) --&gt;</span>
            <span class="nt">&lt;value&gt;</span>com.example.common.XxxException<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;/set&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">ResultMessagesNotificationException</span></code> specified in the default settings of common library, should be specified under exception to be excluded.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the exception classes created in the project.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The settings when all the exception classes are to be logged are as follows:</p>
<ul class="simple">
<li><strong>spring-mvc.xml</strong></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;handlerExceptionResolverLoggingInterceptor&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.exception.HandlerExceptionResolverLoggingInterceptor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionLogger&quot;</span> <span class="na">ref=</span><span class="s">&quot;exceptionLogger&quot;</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;ignoreExceptions&quot;</span><span class="nt">&gt;&lt;null</span> <span class="nt">/&gt;&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify <code class="docutils literal"><span class="pre">null</span></code> in ignoreExceptions properties.</div>
<div class="line">If <code class="docutils literal"><span class="pre">null</span></code> is specified, all the exception classes will become target for logging.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="http-response-code-set-by-defaulthandlerexceptionresolver">
<span id="exception-handling-appendix-defaulthandlerexceptionresolver-label"></span><h3><a class="toc-backref" href="#id71">5.7.5.4. HTTP response code set by DefaultHandlerExceptionResolver</a><a class="headerlink" href="#http-response-code-set-by-defaulthandlerexceptionresolver" title="Permalink to this headline">¶</a></h3>
<p>The mapping between framework exceptions handled using DefaultHandlerExceptionResolver and HTTP status code is shown below.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="67%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Handled framework exceptions</th>
<th class="head">HTTP Status Code</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.web.servlet.mvc.multiaction.NoSuchRequestHandlingMethodException</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">404</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.web.HttpRequestMethodNotSupportedException</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">405</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.web.HttpMediaTypeNotSupportedException</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">415</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.web.HttpMediaTypeNotAcceptableException</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">406</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.web.bind.MissingServletRequestParameterException</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">400</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.web.bind.ServletRequestBindingException</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">400</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.beans.ConversionNotSupportedException</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">500</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.beans.TypeMismatchException</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">400</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.http.converter.HttpMessageNotReadableException</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">400</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.http.converter.HttpMessageNotWritableException</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">500</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(11).</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.web.bind.MethodArgumentNotValidException</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">400</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(12)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.web.multipart.support.MissingServletRequestPartException</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">400</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(13)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">org.springframework.validation.BindException</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">400</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="SessionManagement.html" title="5.8. Session Management"
             >next</a> |</li>
        <li class="right" >
          <a href="Logging.html" title="5.6. Logging"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.0.2.RELEASE documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >5. Architecture in Detail - TERASOLUNA Server Framework for Java (5.x)</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013-2016, NTT DATA.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.4.Theme by <a href="http://github.com/vkvn">vkvn</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>