<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>5.2. Database Access (MyBatis3) &mdash; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.0.2.RELEASE documentation</title>
    
    <link rel="stylesheet" href="../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.0.2.RELEASE',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.0.2.RELEASE documentation" href="../index.html" />
    <link rel="up" title="5. Architecture in Detail - TERASOLUNA Server Framework for Java (5.x)" href="index.html" />
    <link rel="next" title="5.3. Database Access (JPA)" href="DataAccessJpa.html" />
    <link rel="prev" title="5.1. Database Access (Common)" href="DataAccessCommon.html" /><script src="../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../_static/solarized-dark.css" rel="stylesheet">
<link href="../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="DataAccessJpa.html" title="5.3. Database Access (JPA)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="DataAccessCommon.html" title="5.1. Database Access (Common)"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.0.2.RELEASE documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">5. Architecture in Detail - TERASOLUNA Server Framework for Java (5.x)</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">5.2. Database Access (MyBatis3)</a><ul>
<li><a class="reference internal" href="#overview">5.2.1. Overview</a><ul>
<li><a class="reference internal" href="#about-mybatis3">5.2.1.1. About MyBatis3</a><ul>
<li><a class="reference internal" href="#component-structure-of-mybatis3">5.2.1.1.1. Component structure of MyBatis3</a></li>
</ul>
</li>
<li><a class="reference internal" href="#regarding-mybatis3-and-spring-integration">5.2.1.2. Regarding MyBatis3 and Spring integration</a><ul>
<li><a class="reference internal" href="#component-structure-of-mybatis-spring">5.2.1.2.1. Component structure of MyBatis-Spring</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use">5.2.2. How to use</a><ul>
<li><a class="reference internal" href="#pom-xml-settings">5.2.2.1. pom.xml settings</a></li>
<li><a class="reference internal" href="#settings-for-integration-of-mybatis3-and-spring">5.2.2.2. Settings for integration of MyBatis3 and Spring</a><ul>
<li><a class="reference internal" href="#datasource-settings">5.2.2.2.1. Datasource settings</a></li>
<li><a class="reference internal" href="#transaction-control-settings">5.2.2.2.2. Transaction control settings</a></li>
<li><a class="reference internal" href="#mybatis-spring-settings">5.2.2.2.3. MyBatis-Spring settings</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mybatis3-settings">5.2.2.3. MyBatis3 settings</a><ul>
<li><a class="reference internal" href="#sql-execution-mode-settings">5.2.2.3.1. SQL execution mode settings</a></li>
<li><a class="reference internal" href="#typealias-settings">5.2.2.3.2. TypeAlias settings</a></li>
<li><a class="reference internal" href="#mapping-settings-of-null-value-and-jdbc-type">5.2.2.3.3. Mapping settings of NULL value and JDBC type</a></li>
<li><a class="reference internal" href="#typehandler-settings">5.2.2.3.4. TypeHandler settings</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation-of-database-access-process">5.2.2.4. Implementation of database access process</a><ul>
<li><a class="reference internal" href="#creating-repository-interface">5.2.2.4.1. Creating Repository interface</a></li>
<li><a class="reference internal" href="#creating-mapping-file">5.2.2.4.2. Creating Mapping file</a></li>
<li><a class="reference internal" href="#crud-process-implementation">5.2.2.4.3. CRUD process implementation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-map-a-javabean-in-search-results">5.2.2.5. How to map a JavaBean in Search results</a><ul>
<li><a class="reference internal" href="#automatic-mapping-for-search-results">5.2.2.5.1. Automatic mapping for search results</a></li>
<li><a class="reference internal" href="#manual-mapping-of-search-results">5.2.2.5.2. Manual mapping of search results</a></li>
</ul>
</li>
<li><a class="reference internal" href="#search-process-for-entity">5.2.2.6. Search process for Entity</a><ul>
<li><a class="reference internal" href="#fetching-a-single-key-entity">5.2.2.6.1. Fetching a single key Entity</a></li>
<li><a class="reference internal" href="#fetching-entity-of-composite-key">5.2.2.6.2. Fetching Entity of composite key</a></li>
<li><a class="reference internal" href="#entity-search">5.2.2.6.3. Entity search</a></li>
<li><a class="reference internal" href="#fetching-entity-records">5.2.2.6.4. Fetching Entity records</a></li>
<li><a class="reference internal" href="#pagination-search-of-entity-mybatis3-standard-method">5.2.2.6.5. Pagination search of Entity (MyBatis3 standard method)</a></li>
<li><a class="reference internal" href="#pagination-search-for-entity-sql-refinement-method">5.2.2.6.6. Pagination search for Entity (SQL refinement method)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#entity-registration-process">5.2.2.7. Entity registration process</a><ul>
<li><a class="reference internal" href="#registering-a-single-entity-record">5.2.2.7.1. Registering a single Entity record</a></li>
<li><a class="reference internal" href="#generating-key">5.2.2.7.2. Generating key</a></li>
<li><a class="reference internal" href="#batch-registration-of-entity">5.2.2.7.3. Batch registration of Entity</a></li>
</ul>
</li>
<li><a class="reference internal" href="#update-process-of-entity">5.2.2.8. Update process of Entity</a><ul>
<li><a class="reference internal" href="#updating-a-single-entity">5.2.2.8.1. Updating a single Entity</a></li>
<li><a class="reference internal" href="#batch-update-of-entity">5.2.2.8.2. Batch update of Entity</a></li>
</ul>
</li>
<li><a class="reference internal" href="#delete-process-for-entity">5.2.2.9. Delete process for Entity</a><ul>
<li><a class="reference internal" href="#deleting-a-single-entity">5.2.2.9.1. Deleting a single Entity</a></li>
<li><a class="reference internal" href="#batch-deletion-of-entity">5.2.2.9.2. Batch deletion of Entity</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementing-dynamic-sql">5.2.2.10. Implementing dynamic SQL</a><ul>
<li><a class="reference internal" href="#implementation-of-if-element">5.2.2.10.1. Implementation of if element</a></li>
<li><a class="reference internal" href="#implementation-of-choose-element">5.2.2.10.2. Implementation of choose element</a></li>
<li><a class="reference internal" href="#implementation-of-where-element">5.2.2.10.3. Implementation of where element</a></li>
<li><a class="reference internal" href="#implementation-example-for-set-element">5.2.2.10.4. Implementation example for set element</a></li>
<li><a class="reference internal" href="#implementation-example-of-foreach-element">5.2.2.10.5. Implementation example of foreach element</a></li>
<li><a class="reference internal" href="#implementation-example-for-bind-element">5.2.2.10.6. Implementation example for bind element</a></li>
</ul>
</li>
<li><a class="reference internal" href="#escape-during-like-search">5.2.2.11. Escape during LIKE search</a></li>
<li><a class="reference internal" href="#sql-injection-countermeasures">5.2.2.12. SQL Injection countermeasures</a><ul>
<li><a class="reference internal" href="#how-to-embed-using-a-bind-variable">5.2.2.12.1. How to embed using a bind variable</a></li>
<li><a class="reference internal" href="#how-to-embed-using-a-substitution-variable">5.2.2.12.2. How to embed using a substitution variable</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-extend">5.2.3. How to extend</a><ul>
<li><a class="reference internal" href="#sharing-sql-statement">5.2.3.1. Sharing SQL statement</a></li>
<li><a class="reference internal" href="#implementation-of-typehandler">5.2.3.2. Implementation of TypeHandler</a><ul>
<li><a class="reference internal" href="#implementing-the-typehandler-for-blob">5.2.3.2.1. Implementing the TypeHandler for BLOB</a></li>
<li><a class="reference internal" href="#implementing-the-typehandler-for-clob">5.2.3.2.2. Implementing the TypeHandler for CLOB</a></li>
<li><a class="reference internal" href="#implementing-typehandler-for-joda-time">5.2.3.2.3. Implementing TypeHandler for Joda-Time</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation-of-resulthandler">5.2.3.3. Implementation of ResultHandler</a></li>
<li><a class="reference internal" href="#using-sql-execution-mode">5.2.3.4. Using SQL execution mode</a><ul>
<li><a class="reference internal" href="#using-preparedstatement-reuse-mode">5.2.3.4.1. Using PreparedStatement reuse mode</a></li>
<li><a class="reference internal" href="#using-batch-mode">5.2.3.4.2. Using batch mode</a><ul>
<li><a class="reference internal" href="#settings-for-creating-an-individual-batch-mode-repository">5.2.3.4.2.1. Settings for creating an individual batch mode Repository</a></li>
<li><a class="reference internal" href="#settings-for-creating-batch-mode-repository-in-batch">5.2.3.4.2.2. Settings for creating Batch mode Repository in batch</a></li>
<li><a class="reference internal" href="#how-to-use-the-repository-of-batch-mode">5.2.3.4.2.3. How to use the Repository of batch mode</a></li>
</ul>
</li>
<li><a class="reference internal" href="#precautions-when-using-batch-mode-repository">5.2.3.4.3. Precautions when using batch mode Repository</a><ul>
<li><a class="reference internal" href="#determination-of-update-results">5.2.3.4.3.1. Determination of update results</a></li>
<li><a class="reference internal" href="#how-to-detect-the-unique-constraint-violation">5.2.3.4.3.2. How to detect the unique constraint violation</a></li>
<li><a class="reference internal" href="#sequence-of-calling-repository-method">5.2.3.4.3.3. Sequence of calling Repository method</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#implementation-of-a-stored-procedure">5.2.3.5. Implementation of a stored procedure</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendix">5.2.4. Appendix</a><ul>
<li><a class="reference internal" href="#mapper-interface-mechanism">5.2.4.1. Mapper interface mechanism</a></li>
<li><a class="reference internal" href="#dataaccessmybatis3appendixsettingstypealias">5.2.4.2. TypeAlias settings</a><ul>
<li><a class="reference internal" href="#configuring-typealias-per-class">5.2.4.2.1. Configuring TypeAlias per class</a></li>
<li><a class="reference internal" href="#overwriting-alias-name-assigned-as-default">5.2.4.2.2. Overwriting alias name assigned as default</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sql-switching-by-the-database">5.2.4.3. SQL switching by the database</a></li>
<li><a class="reference internal" href="#how-to-fetch-a-related-entity-by-a-single-sql">5.2.4.4. How to fetch a related Entity by a single SQL</a><ul>
<li><a class="reference internal" href="#table-layout-and-data">5.2.4.4.1. Table layout and data</a></li>
<li><a class="reference internal" href="#entity-class-diagram">5.2.4.4.2. Entity class diagram</a></li>
<li><a class="reference internal" href="#implementation-of-repository-interface">5.2.4.4.3. Implementation of Repository interface</a></li>
<li><a class="reference internal" href="#sql-implementation">5.2.4.4.4. SQL implementation</a></li>
<li><a class="reference internal" href="#implementation-of-mapping">5.2.4.4.5. Implementation of mapping</a><ul>
<li><a class="reference internal" href="#mapping-to-order-object">5.2.4.4.5.1. Mapping to Order object</a></li>
<li><a class="reference internal" href="#mapping-to-orderstatus-object">5.2.4.4.5.2. Mapping to OrderStatus object</a></li>
<li><a class="reference internal" href="#mapping-to-orderitem-object">5.2.4.4.5.3. Mapping to OrderItem object</a></li>
<li><a class="reference internal" href="#mapping-to-item-object">5.2.4.4.5.4. Mapping to Item object</a></li>
<li><a class="reference internal" href="#mapping-to-category-object">5.2.4.4.5.5. Mapping to Category object</a></li>
<li><a class="reference internal" href="#mapping-to-ordercoupon-object">5.2.4.4.5.6. Mapping to OrderCoupon object</a></li>
<li><a class="reference internal" href="#mapping-to-coupon-object">5.2.4.4.5.7. Mapping to Coupon object</a></li>
<li><a class="reference internal" href="#object-diagram-after-mapping">5.2.4.4.5.8. Object diagram after mapping</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-fetch-a-related-entity-using-a-nested-sql">5.2.4.5. How to fetch a related Entity using a nested SQL</a><ul>
<li><a class="reference internal" href="#dataaccessmybatis3appendixnestedselectmapping">5.2.4.5.1. How to fetch a related Entity using a nested SQL</a></li>
<li><a class="reference internal" href="#settings-to-apply-lazy-load-for-related-entity">5.2.4.5.2. Settings to apply Lazy Load for related Entity</a><ul>
<li><a class="reference internal" href="#adding-a-bytecode-manipulation-library">5.2.4.5.2.1. Adding a Bytecode Manipulation Library</a></li>
<li><a class="reference internal" href="#mybatis-settings-for-using-lazy-load">5.2.4.5.2.2. MyBatis settings for using Lazy Load</a></li>
<li><a class="reference internal" href="#settings-for-controlling-execution-timing-of-lazy-load">5.2.4.5.2.3. Settings for controlling execution timing of Lazy Load</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="DataAccessCommon.html"
                        title="previous chapter">5.1. Database Access (Common)</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="DataAccessJpa.html"
                        title="next chapter">5.3. Database Access (JPA)</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/ArchitectureInDetail/DataAccessMyBatis3.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="database-access-mybatis3">
<h1>5.2. Database Access (MyBatis3)<a class="headerlink" href="#database-access-mybatis3" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id28">Overview</a><ul>
<li><a class="reference internal" href="#about-mybatis3" id="id29">About MyBatis3</a><ul>
<li><a class="reference internal" href="#component-structure-of-mybatis3" id="id30">Component structure of MyBatis3</a></li>
</ul>
</li>
<li><a class="reference internal" href="#regarding-mybatis3-and-spring-integration" id="id31">Regarding MyBatis3 and Spring integration</a><ul>
<li><a class="reference internal" href="#component-structure-of-mybatis-spring" id="id32">Component structure of MyBatis-Spring</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use" id="id33">How to use</a><ul>
<li><a class="reference internal" href="#pom-xml-settings" id="id34">pom.xml settings</a></li>
<li><a class="reference internal" href="#settings-for-integration-of-mybatis3-and-spring" id="id35">Settings for integration of MyBatis3 and Spring</a><ul>
<li><a class="reference internal" href="#datasource-settings" id="id36">Datasource settings</a></li>
<li><a class="reference internal" href="#transaction-control-settings" id="id37">Transaction control settings</a></li>
<li><a class="reference internal" href="#mybatis-spring-settings" id="id38">MyBatis-Spring settings</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mybatis3-settings" id="id39">MyBatis3 settings</a><ul>
<li><a class="reference internal" href="#sql-execution-mode-settings" id="id40">SQL execution mode settings</a></li>
<li><a class="reference internal" href="#typealias-settings" id="id41">TypeAlias settings</a></li>
<li><a class="reference internal" href="#mapping-settings-of-null-value-and-jdbc-type" id="id42">Mapping settings of NULL value and JDBC type</a></li>
<li><a class="reference internal" href="#typehandler-settings" id="id43">TypeHandler settings</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation-of-database-access-process" id="id44">Implementation of database access process</a><ul>
<li><a class="reference internal" href="#creating-repository-interface" id="id45">Creating Repository interface</a></li>
<li><a class="reference internal" href="#creating-mapping-file" id="id46">Creating Mapping file</a></li>
<li><a class="reference internal" href="#crud-process-implementation" id="id47">CRUD process implementation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-map-a-javabean-in-search-results" id="id48">How to map a JavaBean in Search results</a><ul>
<li><a class="reference internal" href="#automatic-mapping-for-search-results" id="id49">Automatic mapping for search results</a></li>
<li><a class="reference internal" href="#manual-mapping-of-search-results" id="id50">Manual mapping of search results</a></li>
</ul>
</li>
<li><a class="reference internal" href="#search-process-for-entity" id="id51">Search process for Entity</a><ul>
<li><a class="reference internal" href="#fetching-a-single-key-entity" id="id52">Fetching a single key Entity</a></li>
<li><a class="reference internal" href="#fetching-entity-of-composite-key" id="id53">Fetching Entity of composite key</a></li>
<li><a class="reference internal" href="#entity-search" id="id54">Entity search</a></li>
<li><a class="reference internal" href="#fetching-entity-records" id="id55">Fetching Entity records</a></li>
<li><a class="reference internal" href="#pagination-search-of-entity-mybatis3-standard-method" id="id56">Pagination search of Entity (MyBatis3 standard method)</a></li>
<li><a class="reference internal" href="#pagination-search-for-entity-sql-refinement-method" id="id57">Pagination search for Entity (SQL refinement method)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#entity-registration-process" id="id58">Entity registration process</a><ul>
<li><a class="reference internal" href="#registering-a-single-entity-record" id="id59">Registering a single Entity record</a></li>
<li><a class="reference internal" href="#generating-key" id="id60">Generating key</a></li>
<li><a class="reference internal" href="#batch-registration-of-entity" id="id61">Batch registration of Entity</a></li>
</ul>
</li>
<li><a class="reference internal" href="#update-process-of-entity" id="id62">Update process of Entity</a><ul>
<li><a class="reference internal" href="#updating-a-single-entity" id="id63">Updating a single Entity</a></li>
<li><a class="reference internal" href="#batch-update-of-entity" id="id64">Batch update of Entity</a></li>
</ul>
</li>
<li><a class="reference internal" href="#delete-process-for-entity" id="id65">Delete process for Entity</a><ul>
<li><a class="reference internal" href="#deleting-a-single-entity" id="id66">Deleting a single Entity</a></li>
<li><a class="reference internal" href="#batch-deletion-of-entity" id="id67">Batch deletion of Entity</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementing-dynamic-sql" id="id68">Implementing dynamic SQL</a><ul>
<li><a class="reference internal" href="#implementation-of-if-element" id="id69">Implementation of if element</a></li>
<li><a class="reference internal" href="#implementation-of-choose-element" id="id70">Implementation of choose element</a></li>
<li><a class="reference internal" href="#implementation-of-where-element" id="id71">Implementation of where element</a></li>
<li><a class="reference internal" href="#implementation-example-for-set-element" id="id72">Implementation example for set element</a></li>
<li><a class="reference internal" href="#implementation-example-of-foreach-element" id="id73">Implementation example of foreach element</a></li>
<li><a class="reference internal" href="#implementation-example-for-bind-element" id="id74">Implementation example for bind element</a></li>
</ul>
</li>
<li><a class="reference internal" href="#escape-during-like-search" id="id75">Escape during LIKE search</a></li>
<li><a class="reference internal" href="#sql-injection-countermeasures" id="id76">SQL Injection countermeasures</a><ul>
<li><a class="reference internal" href="#how-to-embed-using-a-bind-variable" id="id77">How to embed using a bind variable</a></li>
<li><a class="reference internal" href="#how-to-embed-using-a-substitution-variable" id="id78">How to embed using a substitution variable</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-extend" id="id79">How to extend</a><ul>
<li><a class="reference internal" href="#sharing-sql-statement" id="id80">Sharing SQL statement</a></li>
<li><a class="reference internal" href="#implementation-of-typehandler" id="id81">Implementation of TypeHandler</a><ul>
<li><a class="reference internal" href="#implementing-the-typehandler-for-blob" id="id82">Implementing the TypeHandler for BLOB</a></li>
<li><a class="reference internal" href="#implementing-the-typehandler-for-clob" id="id83">Implementing the TypeHandler for CLOB</a></li>
<li><a class="reference internal" href="#implementing-typehandler-for-joda-time" id="id84">Implementing TypeHandler for Joda-Time</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation-of-resulthandler" id="id85">Implementation of ResultHandler</a></li>
<li><a class="reference internal" href="#using-sql-execution-mode" id="id86">Using SQL execution mode</a><ul>
<li><a class="reference internal" href="#using-preparedstatement-reuse-mode" id="id87">Using PreparedStatement reuse mode</a></li>
<li><a class="reference internal" href="#using-batch-mode" id="id88">Using batch mode</a></li>
<li><a class="reference internal" href="#precautions-when-using-batch-mode-repository" id="id89">Precautions when using batch mode Repository</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation-of-a-stored-procedure" id="id90">Implementation of a stored procedure</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendix" id="id91">Appendix</a><ul>
<li><a class="reference internal" href="#mapper-interface-mechanism" id="id92">Mapper interface mechanism</a></li>
<li><a class="reference internal" href="#dataaccessmybatis3appendixsettingstypealias" id="id93">TypeAlias settings</a><ul>
<li><a class="reference internal" href="#configuring-typealias-per-class" id="id94">Configuring TypeAlias per class</a></li>
<li><a class="reference internal" href="#overwriting-alias-name-assigned-as-default" id="id95">Overwriting alias name assigned as default</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sql-switching-by-the-database" id="id96">SQL switching by the database</a></li>
<li><a class="reference internal" href="#how-to-fetch-a-related-entity-by-a-single-sql" id="id97">How to fetch a related Entity by a single SQL</a><ul>
<li><a class="reference internal" href="#table-layout-and-data" id="id98">Table layout and data</a></li>
<li><a class="reference internal" href="#entity-class-diagram" id="id99">Entity class diagram</a></li>
<li><a class="reference internal" href="#implementation-of-repository-interface" id="id100">Implementation of Repository interface</a></li>
<li><a class="reference internal" href="#sql-implementation" id="id101">SQL implementation</a></li>
<li><a class="reference internal" href="#implementation-of-mapping" id="id102">Implementation of mapping</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-fetch-a-related-entity-using-a-nested-sql" id="id103">How to fetch a related Entity using a nested SQL</a><ul>
<li><a class="reference internal" href="#dataaccessmybatis3appendixnestedselectmapping" id="id104">How to fetch a related Entity using a nested SQL</a></li>
<li><a class="reference internal" href="#settings-to-apply-lazy-load-for-related-entity" id="id105">Settings to apply Lazy Load for related Entity</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<span id="dataaccessmybatis3overview"></span><h2><a class="toc-backref" href="#id28">5.2.1. Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This chapter describes how to access database using <a class="reference external" href="http://mybatis.org">MyBatis3</a>.</p>
<p>This guideline presumes the use of Mapper interface of MyBatis3 as a Repository interface.
Refer to &#8220;<a class="reference internal" href="../ImplementationAtEachLayer/DomainLayer.html#repository-label"><span>Implementation of Repository</span></a>&#8221; for Repository interface.</p>
<div class="line-block">
<div class="line">The architecture to access database by using MyBatis3 and MyBatis-Spring is explained in the Overview.</div>
<div class="line">For more information, refer &#8220;<a class="reference internal" href="#dataaccessmybatis3howtouse"><span>How to use</span></a>&#8221;.</div>
</div>
<blockquote>
<div><div class="figure align-center" id="id12">
<a class="reference internal image-reference" href="../_images/DataAccessMyBatis3Scope.png"><img alt="Scope of description" src="../_images/DataAccessMyBatis3Scope.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - Scope of description</strong></span></p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="about-mybatis3">
<span id="dataaccessmybatis3overviewaboutmybatis3"></span><h3><a class="toc-backref" href="#id29">5.2.1.1. About MyBatis3</a><a class="headerlink" href="#about-mybatis3" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">MyBatis3 is a type of O/R mapper which is developed for mapping SQL to objects.
and not for mapping the records stored in database to objects.</div>
<div class="line">Thus, it is an effective O/R mapper to access denormalized databases or to obtain full control of SQL execution in an application
without entrusting the SQL statement execution to the O/R mapper.</div>
</div>
<p>In this guideline, CRUD operation of Entity is performed by using Mapper interface added from MyBatis3.
Refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3appendixaboutmappermechanism"><span>Mapper interface mechanism</span></a>&#8221; for details of Mapper interface.</p>
<p>This guideline does not cover explanation of all the functionalities of MyBatis3,
Hence, it is recommended to refer &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/">MyBatis 3 REFERENCE DOCUMENTATION</a> &#8221; .</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="component-structure-of-mybatis3">
<span id="dataaccessmybatis3overviewaboutcomponentconstitutionofmybatis3"></span><h4><a class="toc-backref" href="#id30">5.2.1.1.1. Component structure of MyBatis3</a><a class="headerlink" href="#component-structure-of-mybatis3" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">The explanation about main components of MyBatis3 (configuration file) is given below.</div>
<div class="line">In MyBatis3, SQL execution and O/R mapping is implemented by integrating the following components with each other based on the definition of configuration file.</div>
</div>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="22%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Component/Configuration file</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>MyBatis configuration file</td>
<td><p class="first">XML file that explains operation settings of MyBatis3.</p>
<p class="last">It is a file that explains details such as connecting destination for database, path of mapping file, operation settings of MyBatis and so on.
It is not necessary to specify connecting destination of database and mapping file path settings in the configuration file, when using it by integrating with Spring.
However, settings are performed when changing or extending default operations of MyBatis3.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">org.apache.ibatis.session.</span></code>
<code class="docutils literal"><span class="pre">SqlSessionFactoryBuilder</span></code></td>
<td><p class="first">A component to read MyBatis configuration file and generate <code class="docutils literal"><span class="pre">SqlSessionFactory</span></code> .</p>
<p class="last">This component is not directly handled by the application class when used by integrating with Spring.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">org.apache.ibatis.session.</span></code>
<code class="docutils literal"><span class="pre">SqlSessionFactory</span></code></td>
<td><p class="first">A component to generate <code class="docutils literal"><span class="pre">SqlSession</span></code> .</p>
<p class="last">This component is not directly handled by the application class when used by integrating with Spring.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">org.apache.ibatis.session.</span></code>
<code class="docutils literal"><span class="pre">SqlSession</span></code></td>
<td><p class="first">A component to provide API for SQL execution and transaction control.</p>
<p>It is the component that plays the most important role when accessing database using MyBatis3.</p>
<p class="last">When this component is used by integrating with Spring, it is not directly handled by the application class.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td>Mapper interface</td>
<td><p class="first">An interface to call the SQL defined in mapping file in typesafe.</p>
<p class="last">Developer needs to create only the interface, as MyBatis3 automatically generates an implementation class for the Mapper interface.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td>Mapping file</td>
<td>XML file that explains SQL and O/R mapping settings.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">Flow by which main components of MyBatis3 access the database, is explained below.</div>
<div class="line">Process for accessing database can be broadly divided into 2 types.</div>
</div>
<ul class="simple">
<li>Processes that are performed at the start of the application. Processes (1) to (3) mentioned below correspond to this type.</li>
<li>Processes that are performed for each request from the client. Processes (4) to (10) mentioned below correspond to this type.</li>
</ul>
<blockquote>
<div><div class="figure align-center" id="id13">
<a class="reference internal image-reference" href="../_images/DataAccessMyBatis3RelationshipOfComponents.png"><img alt="Relationship of MyBatis3 components" src="../_images/DataAccessMyBatis3RelationshipOfComponents.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - Relationship of MyBatis3 components</strong></span></p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">Processes that are performed at the start of the application are executed with following flow.</div>
<div class="line">Refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3overviewaboutcomponentconstitutionofmybatisspring"><span>Component structure of MyBatis-Spring</span></a>&#8221; for the flow when integrating with Spring.</div>
</div>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Application requests building <code class="docutils literal"><span class="pre">SqlSessionFactory</span></code>  for <code class="docutils literal"><span class="pre">SqlSessionFactoryBuilder</span></code> .</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">SqlSessionFactoryBuilder</span></code>  reads MyBatis configuration file for generating <code class="docutils literal"><span class="pre">SqlSessionFactory</span></code> .</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">SqlSessionFactoryBuilder</span></code>  generates <code class="docutils literal"><span class="pre">SqlSessionFactory</span></code>  based on the definition of MyBatis configuration file.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">Processes that are performed for each request from the client are executed with the following flow.</div>
<div class="line">Refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3overviewaboutcomponentconstitutionofmybatisspring"><span>Component structure of MyBatis-Spring</span></a>&#8221; for the flow when integrating with Spring.</div>
</div>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>Client requests a process for the application.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td>Application fetches <code class="docutils literal"><span class="pre">SqlSession</span></code>  from <code class="docutils literal"><span class="pre">SqlSessionFactory</span></code>  that is built by using <code class="docutils literal"><span class="pre">SqlSessionFactoryBuilder</span></code> .</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">SqlSessionFactory</span></code>  generates <code class="docutils literal"><span class="pre">SqlSession</span></code>  and returns it to the application.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="7">
<li></li>
</ol>
</td>
<td>Application fetches the implementation object of Mapper interface from <code class="docutils literal"><span class="pre">SqlSession</span></code> .</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="8">
<li></li>
</ol>
</td>
<td><p class="first">Application calls Mapper interface method.</p>
<p class="last">Refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3appendixaboutmappermechanism"><span>Mapper interface mechanism</span></a>&#8221; for mechanism of Mapper interface.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="9">
<li></li>
</ol>
</td>
<td>Implementation object of Mapper interface calls <code class="docutils literal"><span class="pre">SqlSession</span></code>  method and requests SQL execution.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="10">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">SqlSession</span></code> fetches the SQL to be executed from mapping file and executes SQL.</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>Transaction control</strong></p>
<p>Commit and rollback for the transaction are performed by calling <code class="docutils literal"><span class="pre">SqlSession</span></code>  API from application code.
However, it is not described in the above flow.</p>
<p class="last">When integrated with Spring, Spring transaction control functionality performs commit and rollback.
As a result, the API controlling <code class="docutils literal"><span class="pre">SqlSession</span></code>  is not called directly from application class.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="regarding-mybatis3-and-spring-integration">
<span id="dataaccessmybatis3overviewaboutmybatisspring"></span><h3><a class="toc-backref" href="#id31">5.2.1.2. Regarding MyBatis3 and Spring integration</a><a class="headerlink" href="#regarding-mybatis3-and-spring-integration" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><a class="reference external" href="http://mybatis.github.io/spring/">MyBatis-Spring</a>  is provided by MyBatis as the library to integrate MyBatis3 and Spring.</div>
<div class="line">MyBatis3 components can be stored on Spring DI container by using this library.</div>
</div>
<p>There are following advantages of using MyBatis-Spring.</p>
<ul class="simple">
<li>MyBatis3 SQL can be executed in the transactions managed by Spring. Hence, it is not necessary to control the transactions that are dependent on MyBatis3 API.</li>
<li>MyBatis3 exception is converted to a generic exception (``org.springframework.dao.DataAccessException``) provided by Spring. Hence, exception process that is not dependent on MyBatis3 API can be implemented.</li>
<li>The overall initialization process for using MyBatis3 is performed by MyBatis-Spring API. Hence, MyBatis3 API need not be used directly.</li>
<li>Mapper object can be injected in Singleton Service class to generate a thread safe Mapper object.</li>
</ul>
<p>This guideline presumes the use of MyBatis-Spring.</p>
<p>This guideline does not cover explanation of all the functionalities of MyBatis-Spring,
Hence, it is recommended to refer &#8220;<a class="reference external" href="http://mybatis.github.io/spring/">Mybatis-Spring REFERENCE DOCUMENTATION</a> &#8221; .</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="component-structure-of-mybatis-spring">
<span id="dataaccessmybatis3overviewaboutcomponentconstitutionofmybatisspring"></span><h4><a class="toc-backref" href="#id32">5.2.1.2.1. Component structure of MyBatis-Spring</a><a class="headerlink" href="#component-structure-of-mybatis-spring" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Main components of MyBatis-Spring are explained here.</div>
<div class="line">In MyBatis-Spring, MyBatis3 and Spring are integrated by integrating the following components.</div>
</div>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="22%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Component/Configuration file</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">org.mybatis.spring.</span></code>
<code class="docutils literal"><span class="pre">SqlSessionFactoryBean</span></code></td>
<td><p class="first">Component that builds <code class="docutils literal"><span class="pre">SqlSessionFactory</span></code>  and stores objects on Spring DI container.</p>
<p class="last">In standard MyBatis3, <code class="docutils literal"><span class="pre">SqlSessionFactory</span></code>  is built based on the information defined in MyBatis configuration file. However,
By using <code class="docutils literal"><span class="pre">SqlSessionFactoryBean</span></code> , <code class="docutils literal"><span class="pre">SqlSessionFactory</span></code>  can be built even in the absence of MyBatis configuration file.
It can also be used in combination.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">org.mybatis.spring.mapper.</span></code>
<code class="docutils literal"><span class="pre">MapperFactoryBean</span></code></td>
<td><p class="first">Component that builds Singleton Mapper object and stores objects on Spring DI container.</p>
<p class="last">Mapper object generated by MyBatis3 standard mechanism is not thread safe.
Hence, it was necessary to assign an instance for each thread.
Mapper object created by MyBatis-Spring component can generate a thread safe Mapper object.
As a result, DI can be applied to Singleton components like Service etc.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">org.mybatis.spring.</span></code>
<code class="docutils literal"><span class="pre">SqlSessionTemplate</span></code></td>
<td><p class="first"><code class="docutils literal"><span class="pre">SqlSession</span></code>  component of Singleton version that implements <code class="docutils literal"><span class="pre">SqlSession</span></code>  interface.</p>
<p><code class="docutils literal"><span class="pre">SqlSession</span></code>  object generated by MyBatis3 standard mechanism is not thread safe.
Hence, it was necessary to assign an instance for each thread.
<code class="docutils literal"><span class="pre">SqlSession</span></code>  object generated by MyBatis-Spring component can generate a thread safe <code class="docutils literal"><span class="pre">SqlSession</span></code>  object.
As a result, DI can be applied to Singleton components like Service etc.</p>
<p class="last">However, this guideline does not assume handling <code class="docutils literal"><span class="pre">SqlSession</span></code>  directly.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The flow by which the main components of MyBatis-Spring access the database is explained below.
Processes to access database can be broadly divided into two types.</p>
<ul class="simple">
<li>Processes that are performed at the start of the application. Processes (1) to (4) mentioned below correspond to this type.</li>
<li>Processes that are performed for each request from the client. Processes (5) to (11) mentioned below correspond to this type.</li>
</ul>
<blockquote>
<div><div class="figure align-center" id="id14">
<a class="reference internal image-reference" href="../_images/DataAccessMyBatisSpringRelationshipOfComponents.png"><img alt="Relationship of MyBatis-Spring components" src="../_images/DataAccessMyBatisSpringRelationshipOfComponents.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - Relationship of MyBatis-Spring components</strong></span></p>
</div>
</div></blockquote>
<p>Processes that are performed at the start of the application are executed by the following flow.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">SqlSessionFactoryBean</span></code>  requests building <code class="docutils literal"><span class="pre">SqlSessionFactory</span></code>  for <code class="docutils literal"><span class="pre">SqlSessionFactoryBuilder</span></code> .</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">SqlSessionFactoryBuilder</span></code>  reads MyBatis configuration file for generating <code class="docutils literal"><span class="pre">SqlSessionFactory</span></code> .</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p class="first"><code class="docutils literal"><span class="pre">SqlSessionFactoryBuilder</span></code>  generates <code class="docutils literal"><span class="pre">SqlSessionFactory</span></code>  based on the definition of MyBatis configuration file.</p>
<p class="last"><code class="docutils literal"><span class="pre">SqlSessionFactory</span></code>  thus generated is stored by the Spring DI container.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td><p class="first"><code class="docutils literal"><span class="pre">MapperFactoryBean</span></code>  generates a thread safe <code class="docutils literal"><span class="pre">SqlSession</span></code>  (<code class="docutils literal"><span class="pre">SqlSessionTemplate</span></code> ) and
a thread safe Mapper object (Proxy object of Mapper interface).</p>
<p class="last">Mapper object thus generated is stored by Spring DI container and DI is applied for Service class etc.
Mapper object provides a thread safe implementation by using thread safe <code class="docutils literal"><span class="pre">SqlSession</span></code>  (<code class="docutils literal"><span class="pre">SqlSessionTemplate</span></code> ).</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Processes that are performed for each request from client are executed by the following flow.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td>Client requests a process for the application.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td><p class="first">Application (Service) calls the method of Mapper object (Proxy object that implements Mapper interface) injected by DI container.</p>
<p class="last">Refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3appendixaboutmappermechanism"><span>Mapper interface mechanism</span></a>&#8221; for Mapper interface mechanism.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="7">
<li></li>
</ol>
</td>
<td>Mapper object calls <code class="docutils literal"><span class="pre">SqlSession</span></code>  (<code class="docutils literal"><span class="pre">SqlSessionTemplate</span></code> ) method corresponding to the called method.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="8">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">SqlSession</span></code>  (<code class="docutils literal"><span class="pre">SqlSessionTemplate</span></code> ) calls the proxy enabled and thread safe <code class="docutils literal"><span class="pre">SqlSession</span></code>  method.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="9">
<li></li>
</ol>
</td>
<td><p class="first">Proxy enabled and thread safe <code class="docutils literal"><span class="pre">SqlSession</span></code>  uses MyBatis3 standard <code class="docutils literal"><span class="pre">SqlSession</span></code>  assigned to the transaction.</p>
<p class="last">When <code class="docutils literal"><span class="pre">SqlSession</span></code>  assigned to the transaction does not exist, <code class="docutils literal"><span class="pre">SqlSessionFactory</span></code>  method is called
to fetch <code class="docutils literal"><span class="pre">SqlSession</span></code>  of standard MyBatis3.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="10">
<li></li>
</ol>
</td>
<td><p class="first"><code class="docutils literal"><span class="pre">SqlSessionFactory</span></code>  returns MyBatis3 standard <code class="docutils literal"><span class="pre">SqlSession</span></code> .</p>
<p class="last">Since the returned MyBatis3 standard <code class="docutils literal"><span class="pre">SqlSession</span></code>  is assigned to the transaction, if it is within the same transaction, same <code class="docutils literal"><span class="pre">SqlSession</span></code>  is used
without creating a new one.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="11">
<li></li>
</ol>
</td>
<td>MyBatis3 standard <code class="docutils literal"><span class="pre">SqlSession</span></code>  fetches SQL to be executed from mapping file and executes the SQL.</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>Transaction control</strong></p>
<p>Although it is not explained in the flow, the commit and rollback of transaction is performed by Spring transaction control function.</p>
<p class="last">Refer to &#8220;<a class="reference internal" href="../ImplementationAtEachLayer/DomainLayer.html#service-transaction-management"><span>Regarding transaction management</span></a>&#8221; for how to control transaction using Spring transaction control function.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="how-to-use">
<span id="dataaccessmybatis3howtouse"></span><h2><a class="toc-backref" href="#id33">5.2.2. How to use</a><a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h2>
<p>Actual configuration and implementation methods for accessing database using MyBatis3 are explained below.</p>
<p>The explanation hereafter can be broadly classified as below.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="22%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Classification</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Overall application settings</td>
<td><p class="first">Settings for using MyBatis3 in an application and
for changing MyBatis3 operations, are explained below.</p>
<p>The contents explained here <strong>are required when application architecture performs settings at the time of project start-up.</strong>Therefore, application developers need not be aware of these contents separately.</p>
<p>Following sections correspond to this classification.</p>
<ul class="simple">
<li><a class="reference internal" href="#dataaccessmybatis3howtousesettingspomxml"><span>pom.xml settings</span></a></li>
<li><a class="reference internal" href="#dataaccessmybatis3howtousesettingscooperatewithmybatis3andspring"><span>Settings for integration of MyBatis3 and Spring</span></a></li>
<li><a class="reference internal" href="#dataaccessmybatis3howtousesettingsmybatis3"><span>MyBatis3 settings</span></a></li>
</ul>
<p class="last">When a project is generated from a blank project &lt;<a class="reference external" href="https://github.com/terasolunaorg/terasoluna-gfw-web-multi-blank#multi-blank-project-with-mybatis3">https://github.com/terasolunaorg/terasoluna-gfw-web-multi-blank#multi-blank-project-with-mybatis3</a>&gt;`_  for MyBatis3,
a major part of the configuration explained above is already configured. Hence, the application architect
determines the project characteristics and adds or changes the configuration as required.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>How to implement data access process</td>
<td><p class="first">How to implement basic data access process using MyBatis3 is explained.</p>
<p>The contents explained here <strong>are necessary for the application developers at the time of implementation.</strong></p>
<p>Following sections correspond to this classification.</p>
<ul class="last simple">
<li><a class="reference internal" href="#dataaccessmybatis3howtodababaseaccess"><span>Implementation of database access process</span></a></li>
<li><a class="reference internal" href="#dataaccessmybatis3howtouseresultsetmapping"><span>How to map a JavaBean in Search results</span></a></li>
<li><a class="reference internal" href="#dataaccessmybatis3howtousefind"><span>Search process for Entity</span></a></li>
<li><a class="reference internal" href="#dataaccessmybatis3howtousecreate"><span>Entity registration process</span></a></li>
<li><a class="reference internal" href="#dataaccessmybatis3howtouseupdate"><span>Update process of Entity</span></a></li>
<li><a class="reference internal" href="#dataaccessmybatis3howtousedelete"><span>Delete process for Entity</span></a></li>
<li><a class="reference internal" href="#dataaccessmybatis3howtousedynamicsql"><span>Implementing dynamic SQL</span></a></li>
<li><a class="reference internal" href="#dataaccessmybatis3howtouselikeescape"><span>Escape during LIKE search</span></a></li>
<li><a class="reference internal" href="#dataaccessmybatis3howtousesqlinjectioncountermeasure"><span>SQL Injection countermeasures</span></a></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="pom-xml-settings">
<span id="dataaccessmybatis3howtousesettingspomxml"></span><h3><a class="toc-backref" href="#id34">5.2.2.1. pom.xml settings</a><a class="headerlink" href="#pom-xml-settings" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">When MyBatis3 is used in the infrastructure layer, dependency relation with terasoluna-gfw-mybatis3 is added to <code class="file docutils literal"><span class="pre">pom.xml</span></code>.</div>
<div class="line">In case of multi project configuration, it is added to <code class="file docutils literal"><span class="pre">pom.xml</span></code> (<code class="file docutils literal"><span class="pre">projectName-domain/pom.xml</span></code>) of domain project.</div>
</div>
<div class="line-block">
<div class="line">When a project is generated from a blank project &lt;<a class="reference external" href="https://github.com/terasolunaorg/terasoluna-gfw-web-multi-blank#multi-blank-project-with-mybatis3">https://github.com/terasolunaorg/terasoluna-gfw-web-multi-blank#multi-blank-project-with-mybatis3</a>&gt;`_  for MyBatis3, dependency relation with terasoluna-gfw-mybatis3 is already configured.</div>
</div>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0</span>
<span class="s">        http://maven.apache.org/maven-v4_0_0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>projectName-domain<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>

    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.example<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>mybatis3-example-app<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;relativePath&gt;</span>../pom.xml<span class="nt">&lt;/relativePath&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>

        <span class="c">&lt;!-- omitted --&gt;</span>

<span class="hll">        <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;dependency&gt;</span>
</span><span class="hll">            <span class="nt">&lt;groupId&gt;</span>org.terasoluna.gfw<span class="nt">&lt;/groupId&gt;</span>
</span><span class="hll">            <span class="nt">&lt;artifactId&gt;</span>terasoluna-gfw-mybatis3<span class="nt">&lt;/artifactId&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/dependency&gt;</span>
</span>
        <span class="c">&lt;!-- omitted --&gt;</span>

    <span class="nt">&lt;/dependencies&gt;</span>

    <span class="c">&lt;!-- omitted --&gt;</span>

<span class="nt">&lt;/project&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Add terasoluna-gfw-mybatis3 to dependencies.
Dependency relation with MyBatis3 and MyBatis-Spring is defined in terasoluna-gfw-mybatis3.</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>How to configure when terasoluna-gfw-parent is not used as a Parent project</strong></p>
<p>When terasoluna-gfw-parent project is not specified as a parent project, it becomes necessary to specify individual version as well.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.terasoluna.gfw<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>terasoluna-gfw-mybatis3<span class="nt">&lt;/artifactId&gt;</span>
<span class="hll">    <span class="nt">&lt;version&gt;</span>5.0.2.RELEASE<span class="nt">&lt;/version&gt;</span>
</span><span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p class="last">In the above example, 5.0.2.RELEASE is specified. However, version used in the project should be specified.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="settings-for-integration-of-mybatis3-and-spring">
<span id="dataaccessmybatis3howtousesettingscooperatewithmybatis3andspring"></span><h3><a class="toc-backref" href="#id35">5.2.2.2. Settings for integration of MyBatis3 and Spring</a><a class="headerlink" href="#settings-for-integration-of-mybatis3-and-spring" title="Permalink to this headline">¶</a></h3>
<div class="section" id="datasource-settings">
<span id="dataaccessmybatis3howtousesettingsdatasource"></span><h4><a class="toc-backref" href="#id36">5.2.2.2.1. Datasource settings</a><a class="headerlink" href="#datasource-settings" title="Permalink to this headline">¶</a></h4>
<p>When MyBatis3 and Spring are integrated, the datasource managed by Spring DI container should be used.</p>
<p>When a project is generated from a blank project &lt;<a class="reference external" href="https://github.com/terasolunaorg/terasoluna-gfw-web-multi-blank#multi-blank-project-with-mybatis3">https://github.com/terasolunaorg/terasoluna-gfw-web-multi-blank#multi-blank-project-with-mybatis3</a>&gt;`_  for MyBatis3, datasource of Apache Commons DBCP is already configured.
Hence the settings should be changed in accordance with project requirements.</p>
<p>Refer to &#8220;<a class="reference internal" href="DataAccessCommon.html#data-access-common-howtouse-datasource"><span>Datasource settings</span></a> &#8221; for the details on how to configure datasource.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="transaction-control-settings">
<span id="dataaccessmybatis3howtousesettingstransactionmanager"></span><h4><a class="toc-backref" href="#id37">5.2.2.2.2. Transaction control settings</a><a class="headerlink" href="#transaction-control-settings" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">When MyBatis3 and Spring are integrated,
<code class="docutils literal"><span class="pre">PlatformTransactionManager</span></code>  managed by Spring DI container should be used for transaction control.</div>
</div>
<div class="line-block">
<div class="line">When using local transaction, <code class="docutils literal"><span class="pre">DataSourceTransactionManager</span></code>  that performs transaction control by calling JDBC API, is used.</div>
</div>
<div class="line-block">
<div class="line">When a project is generated from a blank project &lt;<a class="reference external" href="https://github.com/terasolunaorg/terasoluna-gfw-web-multi-blank#multi-blank-project-with-mybatis3">https://github.com/terasolunaorg/terasoluna-gfw-web-multi-blank#multi-blank-project-with-mybatis3</a>&gt;`_  for MyBatis3, <code class="docutils literal"><span class="pre">DataSourceTransactionManager</span></code>  is already configured.</div>
</div>
<p>Configuration example is as given below.</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">projectName-env/src/main/resources/META-INF/spring/projectName-env.xml</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:jee=</span><span class="s">&quot;http://www.springframework.org/schema/jee&quot;</span>
    <span class="na">xmlns:jdbc=</span><span class="s">&quot;http://www.springframework.org/schema/jdbc&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/jdbc</span>
<span class="s">        http://www.springframework.org/schema/jdbc/spring-jdbc.xsd</span>
<span class="s">        http://www.springframework.org/schema/jee</span>
<span class="s">        http://www.springframework.org/schema/jee/spring-jee.xsd</span>
<span class="s">        http://www.springframework.org/schema/beans</span>
<span class="s">        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- omitted --&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;transactionManager&quot;</span>
</span><span class="hll">        <span class="na">class=</span><span class="s">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/bean&gt;</span>
</span>
    <span class="c">&lt;!-- omitted --&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Specify <code class="docutils literal"><span class="pre">org.springframework.jdbc.datasource.DataSourceTransactionManager</span></code>  as <code class="docutils literal"><span class="pre">PlatformTransactionManager</span></code> .</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Specify configured datasource bean in <code class="docutils literal"><span class="pre">dataSource</span></code>  property.</p>
<p class="last">When SQL is executed in the transaction, connection is fetched from datasource specified here.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>bean ID of PlatformTransactionManager</strong></p>
<p>It is recommended to specify <code class="docutils literal"><span class="pre">transactionManager</span></code>  in id attribute.</p>
<p class="last">If a value other than <code class="docutils literal"><span class="pre">transactionManager</span></code>  is specified,
the same value must be specified in transaction-manager attribute of <code class="docutils literal"><span class="pre">&lt;tx:annotation-driven&gt;</span></code>  tag.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>When a transaction manager provided by application server is used, use <code class="docutils literal"><span class="pre">org.springframework.transaction.jta.JtaTransactionManager</span></code> that performs transaction control by calling JTA API.</p>
<p>Configuration example is as given below.</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">projectName-env/src/main/resources/META-INF/spring/projectName-env.xml</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:jee=</span><span class="s">&quot;http://www.springframework.org/schema/jee&quot;</span>
    <span class="na">xmlns:jdbc=</span><span class="s">&quot;http://www.springframework.org/schema/jdbc&quot;</span>
<span class="hll">    <span class="na">xmlns:tx=</span><span class="s">&quot;http://www.springframework.org/schema/tx&quot;</span>
</span>    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/jdbc</span>
<span class="s">        http://www.springframework.org/schema/jdbc/spring-jdbc.xsd</span>
<span class="s">        http://www.springframework.org/schema/jee</span>
<span class="s">        http://www.springframework.org/schema/jee/spring-jee.xsd</span>
<span class="s">        http://www.springframework.org/schema/beans</span>
<span class="s">        http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="hll"><span class="s">        http://www.springframework.org/schema/tx</span>
</span><span class="hll"><span class="s">        http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span><span class="nt">&gt;</span>
</span>
    <span class="c">&lt;!-- omitted --&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;tx:jta-transaction-manager</span> <span class="nt">/&gt;</span>
</span>
    <span class="c">&lt;!-- omitted --&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>If <code class="docutils literal"><span class="pre">&lt;tx:jta-transaction-manager</span> <span class="pre">/&gt;</span></code>  is specified,
bean definition of optimum <code class="docutils literal"><span class="pre">JtaTransactionManager</span></code>  is performed for the application server.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="mybatis-spring-settings">
<span id="dataaccessmybatis3howtousesettingsmybatis-spring"></span><h4><a class="toc-backref" href="#id38">5.2.2.2.3. MyBatis-Spring settings</a><a class="headerlink" href="#mybatis-spring-settings" title="Permalink to this headline">¶</a></h4>
<p>When MyBatis3 and Spring are integrated, it is necessary to carry out following</p>
<ul class="simple">
<li>Generation of <code class="docutils literal"><span class="pre">SqlSessionFactory</span></code> that customizes the processes necessary for integrating MyBatis3 and Spring</li>
<li>Generation of thread safe Mapper object (Proxy object of Mapped interface)</li>
</ul>
<p>by using MyBatis-Spring components.</p>
<p>When a project is generated from a blank project &lt;<a class="reference external" href="https://github.com/terasolunaorg/terasoluna-gfw-web-multi-blank#multi-blank-project-with-mybatis3">https://github.com/terasolunaorg/terasoluna-gfw-web-multi-blank#multi-blank-project-with-mybatis3</a>&gt;`_  of MyBatis3, the settings for integration of MyBatis3 and Spring
are already configured.</p>
<p>Configuration example is as given below.</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">projectName-domain/src/main/resources/META-INF/spring/projectName-infra.xml</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="hll">    <span class="na">xmlns:mybatis=</span><span class="s">&quot;http://mybatis.org/schema/mybatis-spring&quot;</span>
</span>    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans</span>
<span class="s">        http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="hll"><span class="s">        http://mybatis.org/schema/mybatis-spring</span>
</span><span class="hll"><span class="s">        http://mybatis.org/schema/mybatis-spring.xsd&quot;</span><span class="nt">&gt;</span>
</span>
    <span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&quot;classpath:/META-INF/spring/projectName-env.xml&quot;</span> <span class="nt">/&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;sqlSessionFactory&quot;</span>
</span><span class="hll">        <span class="na">class=</span><span class="s">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;configLocation&quot;</span>
</span><span class="hll">            <span class="na">value=</span><span class="s">&quot;classpath:/META-INF/mybatis/mybatis-config.xml&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/bean&gt;</span>
</span>
<span class="hll">    <span class="c">&lt;!-- (4) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;mybatis:scan</span> <span class="na">base-package=</span><span class="s">&quot;com.example.domain.repository&quot;</span> <span class="nt">/&gt;</span>
</span>
<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Define the bean for <code class="docutils literal"><span class="pre">SqlSessionFactoryBean</span></code>  as the component for generating <code class="docutils literal"><span class="pre">SqlSessionFactory</span></code> .</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Specify a bean of configured datasource in <code class="docutils literal"><span class="pre">dataSource</span></code>  property.</p>
<p class="last">When SQL is executed in MyBatis3 process, the connection is fetched from the datasource specified here.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p class="first">Specify MyBatis configuration file path in <code class="docutils literal"><span class="pre">configLocation</span></code>  property.</p>
<p class="last">The file specified is read when generating <code class="docutils literal"><span class="pre">SqlSessionFactory</span></code> .</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td><p class="first">Define <code class="docutils literal"><span class="pre">&lt;mybatis:scan&gt;</span></code>  for scanning Mapper interface and specify the base package that stores the Mapper interface
in <code class="docutils literal"><span class="pre">base-package</span></code>  attribute.</p>
<p>The Mapper interface stored under specified package is scanned and
a thread safe Mapper object (Proxy object of Mapper interface) is automatically generated.</p>
<p class="last"><strong>[Package decided for each project should be the specified package]</strong></p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>How to configure MyBatis3</strong></p>
<p class="last">When <code class="docutils literal"><span class="pre">SqlSessionFactoryBean</span></code>  is used, MyBatis3 configuration can be specified directly
in the bean property rather than MyBatis configuration file.
However, in this guideline, it is recommended to specify MyBatis3 settings in the MyBatis standard configuration file.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="mybatis3-settings">
<span id="dataaccessmybatis3howtousesettingsmybatis3"></span><h3><a class="toc-backref" href="#id39">5.2.2.3. MyBatis3 settings</a><a class="headerlink" href="#mybatis3-settings" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">A mechanism to customize MyBatis3 operations is provided in MyBatis3.</div>
<div class="line">MyBatis3 operations can be customized by adding a configuration value in MyBatis configuration file.</div>
</div>
<div class="line-block">
<div class="line">Only those configuration fields that are not dependent on application characteristics are explained here.</div>
<div class="line">For other configuration fields,
refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/configuration.html">MyBatis 3 REFERENCE DOCUMENTATION(Configuration XML)</a> &#8221;
and configure in accordance with application characteristics.</div>
<div class="line">Default configuration can be maintained, however it should be changed when required in accordance with application characteristics.</div>
</div>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Storage location for MyBatis configuration file</strong></p>
<p>In this guideline, it is recommended to store MyBatis configuration file
in <code class="file docutils literal"><span class="pre">projectName-domain/src/main/resources/META-INF/mybatis/mybatis-config.xml</span></code>.</p>
<p class="last">When a project is generated from a blank project &lt;<a class="reference external" href="https://github.com/terasolunaorg/terasoluna-gfw-web-multi-blank#multi-blank-project-with-mybatis3">https://github.com/terasolunaorg/terasoluna-gfw-web-multi-blank#multi-blank-project-with-mybatis3</a>&gt;`_  of MyBatis3, the file described above is already stored.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="sql-execution-mode-settings">
<span id="dataaccessmybatis3howtousesettingsexecutortype"></span><h4><a class="toc-backref" href="#id40">5.2.2.3.1. SQL execution mode settings</a><a class="headerlink" href="#sql-execution-mode-settings" title="Permalink to this headline">¶</a></h4>
<p>MyBatis3 provides following three modes to execute SQL.</p>
<div class="line-block">
<div class="line">The mode to be used should be determined based on characteristics and constraints of each mode, and performance requirements.</div>
<div class="line">Refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3howtoextendexecutortype"><span>Using SQL execution mode</span></a>&#8221; for how to configure an execution mode.</div>
</div>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="17%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Mode</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>SIMPLE</td>
<td><p class="first">Creates a new ``java.sql.PreparedStatement`` for each SQL execution.</p>
<p class="last">It is a default behavior for MyBatis wherein a blank project &lt;<a class="reference external" href="https://github.com/terasolunaorg/terasoluna-gfw-web-multi-blank#multi-blank-project-with-mybatis3">https://github.com/terasolunaorg/terasoluna-gfw-web-multi-blank#multi-blank-project-with-mybatis3</a>&gt;`_  also operates in a <code class="docutils literal"><span class="pre">SIMPLE</span></code> mode.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>REUSE</td>
<td><p class="first">Caches and reuses <code class="docutils literal"><span class="pre">PreparedStatement</span></code>.</p>
<p>If <code class="docutils literal"><span class="pre">REUSE</span></code> mode is used when same SQL is to be executed for multiple times in the same transaction,
enhanced performance can be expected as compared to <code class="docutils literal"><span class="pre">SIMPLE</span></code> mode.</p>
<p class="last">This is because it analyses SQL and reduces number of executions for the process that generates <code class="docutils literal"><span class="pre">PreparedStatement</span></code>.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>BATCH</td>
<td><p class="first">Performs batch execution for Update SQL. (Executes SQL by using <code class="docutils literal"><span class="pre">java.sql.Statement#executeBatch()</span></code>)</p>
<p>If <code class="docutils literal"><span class="pre">BATCH</span></code> mode is used to execute a large number of Update SQLs in succession, in the same transaction,
improved performance can be expected as compared to <code class="docutils literal"><span class="pre">SIMPLE</span></code> mode or <code class="docutils literal"><span class="pre">REUSE</span></code> mode.</p>
<p>This is because it reduces</p>
<ul class="simple">
<li>Number of executions for the process that generates <code class="docutils literal"><span class="pre">PreparedStatement</span></code> by analyzing the SQL</li>
<li>Number of communications with the server</li>
</ul>
<p class="last">However, when <code class="docutils literal"><span class="pre">BATCH</span></code> mode is used, MyBatis behavior operates in <code class="docutils literal"><span class="pre">SIMPLE</span></code>mode or in a mode different from <code class="docutils literal"><span class="pre">SIMPLE</span></code> mode.
Refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3howtoextendexecutortypebatchnotes"><span>Precautions when using batch mode Repository</span></a>&#8221; for basic differences and precautions.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="typealias-settings">
<span id="dataaccessmybatis3howtousesettingstypealias"></span><h4><a class="toc-backref" href="#id41">5.2.2.3.2. TypeAlias settings</a><a class="headerlink" href="#typealias-settings" title="Permalink to this headline">¶</a></h4>
<p>When TypeAlias is used, an alias (short name) can be assigned for the Java class specified in mapping file.</p>
<p>When TypeAlias is not used, it is necessary to specify the fully qualified class name (FQCN) of Java class in <code class="docutils literal"><span class="pre">type</span></code>  attribute, <code class="docutils literal"><span class="pre">parameterType</span></code>  attribute and <code class="docutils literal"><span class="pre">resultType</span></code>  attribute specified in a mapping file
As a result, decrease in description efficiency and increase in typographical errors of mapping file are the areas of concern.</p>
<p>In this guideline, it is recommended to use TypeAlias to improve description efficiency, reduce typographical errors and improve readability.</p>
<p>When project is generated from a blank project &lt;<a class="reference external" href="https://github.com/terasolunaorg/terasoluna-gfw-web-multi-blank#multi-blank-project-with-mybatis3">https://github.com/terasolunaorg/terasoluna-gfw-web-multi-blank#multi-blank-project-with-mybatis3</a>&gt;`_  for MyBatis3,
the class stored under the package (<code class="docutils literal"><span class="pre">${projectPackage}.domain.model</span></code>) that stores Entity is considered as a target for TypeAlias.
Settings should be added as and when required.</p>
<p>How to configure a TypeAlias is given below.</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">projectName-domain/src/main/resources/META-INF/mybatis/mybatis-config.xml</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE configuration</span>
<span class="cp">  PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span>
<span class="cp">  &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;typeAliases&gt;</span>
<span class="hll">        <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;package</span> <span class="na">name=</span><span class="s">&quot;com.example.domain.model&quot;</span> <span class="nt">/&gt;</span>
</span>    <span class="nt">&lt;/typeAliases&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">In <code class="docutils literal"><span class="pre">name</span></code>  attribute of <code class="docutils literal"><span class="pre">package</span></code>  element, specify the package name in which the class that sets alias is stored.</p>
<p>The part from which package is removed acts as an alias for the class that is stored under the specified package.
In the above example, the alias for <code class="docutils literal"><span class="pre">com.example.domain.model.Account</span></code>  class is <code class="docutils literal"><span class="pre">Account</span></code> .</p>
<p class="last"><strong>[Package decided for each project should be the specified package]</strong></p>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>** How to configure Type Alias in class unit**</p>
<p class="last">A method to configure TypeAlias in class unit and a method to clearly specify an alias are provided in Type Alias settings.
Refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3appendixsettingstypealias"><span>TypeAlias settings</span></a>&#8221; of Appendix for details.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The description example of mapping file when using TypeAlias is as below.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>

<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.account.AccountRepository&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;accountResultMap&quot;</span>
<span class="hll">        <span class="na">type=</span><span class="s">&quot;Account&quot;</span><span class="nt">&gt;</span>
</span>        <span class="c">&lt;!-- omitted --&gt;</span>
    <span class="nt">&lt;/resultMap&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span>
<span class="hll">        <span class="na">parameterType=</span><span class="s">&quot;string&quot;</span>
</span>        <span class="na">resultMap=</span><span class="s">&quot;accountResultMap&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- omitted --&gt;</span>
    <span class="nt">&lt;/select&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findByCriteria&quot;</span>
<span class="hll">        <span class="na">parameterType=</span><span class="s">&quot;AccountSearchCriteria&quot;</span>
</span>        <span class="na">resultMap=</span><span class="s">&quot;accountResultMap&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- omitted --&gt;</span>
    <span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>MyBatis3 standard Alias name</strong></p>
<p>An alias name is already configured for general Java classes like primitive type and primitive wrapper type.</p>
<p class="last">Refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/configuration.html#typeAliases">MyBatis 3 REFERENCE DOCUMENTATION(Configuration XML-typeAliases-)</a> &#8221; for the alias names which are already configured.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="mapping-settings-of-null-value-and-jdbc-type">
<span id="dataaccessmybatis3howtousesettingsmappingnullandjdbctype"></span><h4><a class="toc-backref" href="#id42">5.2.2.3.3. Mapping settings of NULL value and JDBC type</a><a class="headerlink" href="#mapping-settings-of-null-value-and-jdbc-type" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">An error may occur when setting the column value to null for a database that is being used (JDBC driver).</div>
<div class="line">This issue can be resolved by the JDBC driver by configuring <code class="docutils literal"><span class="pre">null</span></code> value and specifying a recognizable JDBC type.</div>
</div>
<div class="line-block">
<div class="line">When setting <code class="docutils literal"><span class="pre">null</span></code> value, if an error accompanied by following stack traces occurs, mapping of <code class="docutils literal"><span class="pre">null</span></code> value and JDBC type becomes necessary.</div>
<div class="line">By default, a generic JDBC type called <code class="docutils literal"><span class="pre">OTHER</span></code> is specified in MyBatis3. However, however an error may occur in JDBC driver due to <code class="docutils literal"><span class="pre">OTHER</span></code>.</div>
</div>
<blockquote>
<div><div class="highlight-guess"><div class="highlight"><pre><span class="hll">java.sql.SQLException: Invalid column type: 1111
</span>    at oracle.jdbc.driver.OracleStatement.getInternalType(OracleStatement.java:3916) ~[ojdbc6-11.2.0.2.0.jar:11.2.0.2.0]
    at oracle.jdbc.driver.OraclePreparedStatement.setNullCritical(OraclePreparedStatement.java:4541) ~[ojdbc6-11.2.0.2.0.jar:11.2.0.2.0]
    at oracle.jdbc.driver.OraclePreparedStatement.setNull(OraclePreparedStatement.java:4523) ~[ojdbc6-11.2.0.2.0.jar:11.2.0.2.0]
    ...
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Operations when using Oracle</strong></p>
<p>When Oracle is used as a database and if default settings is used as is, it has been confirmed that errors occur.
Although behavior may change depending on the version, it should be described as &#8216;change in the settings may be required when Oracle is used&#8217;.</p>
<p class="last">The version wherein error is confirmed to occur in Oracle 11g R1. The error can be resolved by changing the settings
wherein <code class="docutils literal"><span class="pre">NULL</span></code> type of JDBC type is mapped.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>How to change the default behavior of MyBatis3 is given below.</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">projectName-domain/src/main/resources/META-INF/mybatis/mybatis-config.xml</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE configuration PUBLIC &quot;-//mybatis.org/DTD Config 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span>
<span class="nt">&lt;configuration&gt;</span>

    <span class="nt">&lt;settings&gt;</span>
        <span class="c">&lt;!-- (1) --&gt;</span>
        <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;jdbcTypeForNull&quot;</span> <span class="na">value=</span><span class="s">&quot;NULL&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/settings&gt;</span>

<span class="nt">&lt;/configuration&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Specify JDBC type in jdbcTypeForNull.</p>
<p class="last">In the above example, <code class="docutils literal"><span class="pre">NULL</span></code>type is specified as JDBC type of <code class="docutils literal"><span class="pre">null</span></code> value.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>How to resolve at item level</strong></p>
<p>As an alternate method of resolving the error, an appropriate JDBC type supporting the Java type is set
in the inline parameters of property wherein  <code class="docutils literal"><span class="pre">null</span></code> value may be set.</p>
<p class="last">However, when JDBC type is individually set in inline parameter, description content of mapping file and occurrence of specified mistakes may increase.
Hence, in this guideline, it is recommended to resolve the errors in the overall configuration.
If errors are not resolved even after changing the overall configuration, individual setting can be applied only for the property wherein an error has occurred.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="typehandler-settings">
<span id="dataaccessmybatis3howtousesettingstypehandler"></span><h4><a class="toc-backref" href="#id43">5.2.2.3.4. TypeHandler settings</a><a class="headerlink" href="#typehandler-settings" title="Permalink to this headline">¶</a></h4>
<p>TypeHandler is used when mapping Java class and JDBC type.</p>
<p>Basically, it is used when</p>
<ul class="simple">
<li>A Java class object is set as a bind parameter of <code class="docutils literal"><span class="pre">java.sql.PreparedStatement</span></code>  while executing an SQL.</li>
<li>A value is fetched from <code class="docutils literal"><span class="pre">java.sql.ResultSet</span></code>  that is obtained as SQL execution result.</li>
</ul>
<p>A TypeHandler is provided by MyBatis3 for general Java classes like primitive type and primitive wrapper type class.
Specific settings are not required.</p>
<blockquote>
<div><div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/configuration.html#typeHandlers">MyBatis 3 REFERENCE DOCUMENTATION(Configuration XML-typeHandlers-)</a> &#8221;  for a TypeHandler provided by MyBatis3.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>Enum type mapping</strong></p>
<p>Enum type is mapped with a constant identifier (string) of Enum in the default behavior of MyBatis3.</p>
<p>In case of Enum type shown below,
it is mapped with strings like <code class="docutils literal"><span class="pre">&quot;WAITING_FOR_ACTIVE&quot;</span></code> , <code class="docutils literal"><span class="pre">&quot;ACTIVE&quot;</span></code> , <code class="docutils literal"><span class="pre">&quot;EXPIRED&quot;</span></code> , <code class="docutils literal"><span class="pre">&quot;LOCKED&quot;</span></code> and stored in the table.</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.model</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">AccountStatus</span> <span class="o">{</span>
    <span class="n">WAITING_FOR_ACTIVE</span><span class="o">,</span> <span class="n">ACTIVE</span><span class="o">,</span> <span class="n">EXPIRED</span><span class="o">,</span> <span class="n">LOCKED</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
<p class="last">In MyBatis, Enum type can be mapped with the numeric value (order in which the constants are defined). For how to map Enum type with a numeric value,
refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/configuration.html#Handling_Enums">MyBatis 3 REFERENCE DOCUMENTATION(Configuration XML-Handling Enums-)</a> &#8221;.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Creating a TypeHandler is required while mapping a Java class and JDBC type not supported by MyBatis3.</p>
<p>Basically, it is necessary to create a TypeHandler in the following cases</p>
<ul class="simple">
<li>A file data with large capacity (binary data) is retained in <code class="docutils literal"><span class="pre">java.io.InputStream</span></code>  type and mapped in <code class="docutils literal"><span class="pre">BLOB</span></code>  type of JDBC type.</li>
<li>A large capacity text data is retained as <code class="docutils literal"><span class="pre">java.io.Reader</span></code>  type and mapped in <code class="docutils literal"><span class="pre">CLOB</span></code>  type of JDBC type.</li>
<li><code class="docutils literal"><span class="pre">org.joda.time.DateTime</span></code>  type of &#8220;<a class="reference internal" href="Utilities/JodaTime.html"><em>Date Operations (Joda Time)</em></a>&#8221; that is recommended to be used in this guideline is mapped with <code class="docutils literal"><span class="pre">TIMESTAMP</span></code>  type of JDBC type.</li>
<li>etc ...</li>
</ul>
<p>Refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3howtoextendtypehandler"><span>Implementation of TypeHandler</span></a>&#8221; for creating the three types of TypeHandler described above.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>How to apply a TypeHandler thus created in MyBatis is explained below.</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">projectName-domain/src/main/resources/META-INF/mybatis/mybatis-config.xml</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE configuration PUBLIC &quot;-//mybatis.org/DTD Config 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span>
<span class="nt">&lt;configuration&gt;</span>

    <span class="nt">&lt;typeHandlers&gt;</span>
        <span class="c">&lt;!-- (1) --&gt;</span>
        <span class="nt">&lt;package</span> <span class="na">name=</span><span class="s">&quot;com.example.infra.mybatis.typehandler&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/typeHandlers&gt;</span>

<span class="nt">&lt;/configuration&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Configure TypeHandler in MyBatis configuration file.</p>
<p class="last">Specify a package name wherein the created TypeHandler is stored, in the name attribute of <code class="docutils literal"><span class="pre">package</span></code> element.
The TypeHandler stored under specified package is automatically detected by MyBatis.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>In the above example, although TypeHandler stored under specified package is automatically detected by MyBatis,
it can also be configured in class unit.</p>
<p><code class="docutils literal"><span class="pre">typeHandler</span></code> element is used when setting TypeHandler in class unit.</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">projectName-domain/src/main/resources/META-INF/mybatis/mybatis-config.xml</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;typeHandlers&gt;</span>
<span class="hll">    <span class="nt">&lt;typeHandler</span> <span class="na">handler=</span><span class="s">&quot;xxx.yyy.zzz.CustomTypeHandler&quot;</span> <span class="nt">/&gt;</span>
</span>    <span class="nt">&lt;package</span> <span class="na">name=</span><span class="s">&quot;com.example.infra.mybatis.typehandler&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/typeHandlers&gt;</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Further, when a bean stored by DI container is to be used in TypeHandler,
TypeHandler can be specified in bean definition file.</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">projectName-domain/src/main/resources/META-INF/spring/projectName-infra.xml</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="na">xmlns:tx=</span><span class="s">&quot;http://www.springframework.org/schema/tx&quot;</span> <span class="na">xmlns:mybatis=</span><span class="s">&quot;http://mybatis.org/schema/mybatis-spring&quot;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans</span>
<span class="s">    http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">    http://www.springframework.org/schema/tx</span>
<span class="s">    http://www.springframework.org/schema/tx/spring-tx.xsd</span>
<span class="s">    http://mybatis.org/schema/mybatis-spring</span>
<span class="s">    http://mybatis.org/schema/mybatis-spring.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;sqlSessionFactory&quot;</span> <span class="na">class=</span><span class="s">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">ref=</span><span class="s">&quot;oracleDataSource&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;configLocation&quot;</span>
            <span class="na">value=</span><span class="s">&quot;classpath:/META-INF/mybatis/mybatis-config.xml&quot;</span> <span class="nt">/&gt;</span>
<span class="hll">        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;typeHandlers&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;list&gt;</span>
</span><span class="hll">                <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;xxx.yyy.zzz.CustomTypeHandler&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/list&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/property&gt;</span>
</span>    <span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The mapping of Java class wherein TypeHandler is applied and JDBC type is specified as below.</p>
<ul class="simple">
<li>Specify as an attribute value of <code class="docutils literal"><span class="pre">typeHandler</span></code> element in MyBatis configuration file</li>
<li>Specify in <code class="docutils literal"><span class="pre">&#64;org.apache.ibatis.type.MappedTypes</span></code> annotation and <code class="docutils literal"><span class="pre">&#64;org.apache.ibatis.type.MappedJdbcTypes</span></code> annotation</li>
<li>Specify by inheriting a base class (<code class="docutils literal"><span class="pre">org.apache.ibatis.type.BaseTypeHandler</span></code>) of TypeHandler provided by MyBatis3</li>
</ul>
<p class="last">For details, refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/configuration.html#typeHandlers">MyBatis 3 REFERENCE DOCUMENTATION(Configuration XML-typeHandlers-)</a> &#8221;.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Although each of the above example is a configuration method to be applied to overall application,
an individual TypeHandler can also be specified for each field.
It is used while overwriting a TypeHandler that is applicable for overall application.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot; &gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.image.ImageRepository&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;resultMapImage&quot;</span> <span class="na">type=</span><span class="s">&quot;Image&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;id&quot;</span> <span class="na">column=</span><span class="s">&quot;id&quot;</span> <span class="nt">/&gt;</span>
<span class="hll">        <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;imageData&quot;</span> <span class="na">column=</span><span class="s">&quot;image_data&quot;</span> <span class="na">typeHandler=</span><span class="s">&quot;XxxBlobInputStreamTypeHandler&quot;</span> <span class="nt">/&gt;</span>
</span>        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;createdAt&quot;</span> <span class="na">column=</span><span class="s">&quot;created_at&quot;</span>  <span class="nt">/&gt;</span>
    <span class="nt">&lt;/resultMap&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;string&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;resultMapImage&quot;</span><span class="nt">&gt;</span>
        SELECT
            id
            ,image_data
            ,created_at
        FROM
            t_image
        WHERE
            id = #{id}
    <span class="nt">&lt;/select&gt;</span>
    <span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&quot;create&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;Image&quot;</span><span class="nt">&gt;</span>
        INSERT INTO
            t_image
        (
            id
            ,image_data
            ,created_at
        )
        VALUES
        (
            #{id}
<span class="hll">            /* (3) */
</span><span class="hll">            ,#{imageData,typeHandler=XxxBlobInputStreamTypeHandler}
</span>            ,#{createdAt}
        )
    <span class="nt">&lt;/insert&gt;</span>
<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>Specify a TypeHandler that is applicable to <code class="docutils literal"><span class="pre">typeHandler</span></code> attribute of <code class="docutils literal"><span class="pre">id</span></code> or <code class="docutils literal"><span class="pre">result</span></code> element
while fetching the value from search result (<code class="docutils literal"><span class="pre">ResultSet</span></code>).</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>Specify a TypeHandler that is applicable to <code class="docutils literal"><span class="pre">typeHandler</span></code> attribute of inline parameters
while configuring a value in the <code class="docutils literal"><span class="pre">PreparedStatement</span></code>.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p class="last">It is recommended to set TypeAlias in TypeHandler class when TypeHandler is to be individually specified for each field.
Refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3howtousesettingstypealias"><span>TypeAlias settings</span></a>&#8221; for how to configure TypeAlias.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="implementation-of-database-access-process">
<span id="dataaccessmybatis3howtodababaseaccess"></span><h3><a class="toc-backref" href="#id44">5.2.2.4. Implementation of database access process</a><a class="headerlink" href="#implementation-of-database-access-process" title="Permalink to this headline">¶</a></h3>
<p>A basic implementation method for accessing a database by using MyBatis3 function is explained below.</p>
<div class="section" id="creating-repository-interface">
<span id="dataaccessmybatis3howtodababaseaccesscreaterepository"></span><h4><a class="toc-backref" href="#id45">5.2.2.4.1. Creating Repository interface</a><a class="headerlink" href="#creating-repository-interface" title="Permalink to this headline">¶</a></h4>
<p>A Repository interface is created for each Entity.</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.repository.todo</span><span class="o">;</span>

<span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoRepository</span> <span class="o">{</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Create a Repository interface as an interface for Java.</p>
<p class="last">In the above example, a Repository interface is created for an Entity called <code class="docutils literal"><span class="pre">Todo</span></code>.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="creating-mapping-file">
<span id="dataaccessmybatis3howtodababaseaccesscreatemappingfile"></span><h4><a class="toc-backref" href="#id46">5.2.2.4.2. Creating Mapping file</a><a class="headerlink" href="#creating-mapping-file" title="Permalink to this headline">¶</a></h4>
<p>A mapping file is created for Repository interface.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="c">&lt;!-- (1)  --&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.todo.TodoRepository&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Specify a fully qualified class name (FQCN) of Repository interface in <code class="docutils literal"><span class="pre">namespace</span></code> attribute of <code class="docutils literal"><span class="pre">mapper</span></code> element.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Destination to store a mapping file</strong></p>
<p>The mapping file can be stored at either of the locations given below.</p>
<ul class="simple">
<li>A directory that conforms to the determined rules to enable MyBatis3 to automatically read the mapping file</li>
<li>An arbitrary directory</li>
</ul>
<p><strong>In this guideline, it is recommended to use a mechanism wherein  mapping file is stored in the directory conforming to the rules determined by MyBatis3 thus enabling automatic reading of file.</strong></p>
<p>It is necessary to store the mapping file on the class path at a level same as the package hierarchy of Repository interface
to enable automatic reading of mapping file.</p>
<p class="last">In particular,
a mapping file (<code class="file docutils literal"><span class="pre">TodoRepository.xml</span></code>) for Repository interface called <code class="docutils literal"><span class="pre">com.example.domain.repository.todo.TodoRepository</span></code>should be stored in <code class="docutils literal"><span class="pre">projectName-domain/src/main/resources/com/example/domain/repository/todo</span></code> directory.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="crud-process-implementation">
<span id="dataaccessmybatis3howtodababaseaccesscrud"></span><h4><a class="toc-backref" href="#id47">5.2.2.4.3. CRUD process implementation</a><a class="headerlink" href="#crud-process-implementation" title="Permalink to this headline">¶</a></h4>
<p>How to implement a CRUD process and considerations when implementing SQL are explained here.</p>
<p>How to implement following processes for the basic CRUD operation is explained.</p>
<ul class="simple">
<li><a class="reference internal" href="#dataaccessmybatis3howtouseresultsetmapping"><span>How to map a JavaBean in Search results</span></a></li>
<li><a class="reference internal" href="#dataaccessmybatis3howtousefind"><span>Search process for Entity</span></a></li>
<li><a class="reference internal" href="#dataaccessmybatis3howtousecreate"><span>Entity registration process</span></a></li>
<li><a class="reference internal" href="#dataaccessmybatis3howtouseupdate"><span>Update process of Entity</span></a></li>
<li><a class="reference internal" href="#dataaccessmybatis3howtousedelete"><span>Delete process for Entity</span></a></li>
<li><a class="reference internal" href="#dataaccessmybatis3howtousedynamicsql"><span>Implementing dynamic SQL</span></a></li>
</ul>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p>It is important to note that the searched Entity is
cached in the area called as local cache while implementing CRUD process by using MyBatis3.</p>
<p>Default behavior of local cache provided by MyBatis3 is as given below.</p>
<ul class="simple">
<li>Local cache is managed in a transaction unit.</li>
<li>Entity is cached for each &#8220;statement ID + pattern of built SQL + parameter value bound to the built SQL + page position (fetch range)&#8221;.</li>
</ul>
<p>In other words, when all the search APIs provided by MyBatis3 are called by the same parameter in a process within the same transaction,
the instance of cached Entity is returned without executing the SQL from 2nd time onwards.</p>
<p class="last">Here, it should be noted that <strong>Entity returned by MyBatis API and Entity managed by local cache consist of the same instance</strong>.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Local cache can also be changed so as to be managed in statement unit.
When the local cache is to be managed in statement unit, MyBatis executes SQL each time and fetches the latest Entity.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The considerations while implementing SQL are explained below.</p>
<ul class="simple">
<li><a class="reference internal" href="#dataaccessmybatis3howtouselikeescape"><span>Escape during LIKE search</span></a></li>
<li><a class="reference internal" href="#dataaccessmybatis3howtousesqlinjectioncountermeasure"><span>SQL Injection countermeasures</span></a></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Before explaining the basic implementation, the components to be registered are explained below.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="28%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Component</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Entity</td>
<td><p class="first">A JavaBean class that retains business process data handled by the application.</p>
<p class="last">Refer to &#8220;<a class="reference internal" href="../ImplementationAtEachLayer/DomainLayer.html#domainlayer-entity"><span>Implementation of Entity</span></a>&#8221; for details of Entity.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>Repository interface</td>
<td><p class="first">An interface that defines the method to perform CRUD operation of Entity.</p>
<p class="last">Refer to &#8220;<a class="reference internal" href="../ImplementationAtEachLayer/DomainLayer.html#repository-label"><span>Implementation of Repository</span></a>&#8221; for details of Repository.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>Service class</td>
<td><p class="first">A class for executing business process logic.</p>
<p class="last">Refer to &#8220;<a class="reference internal" href="../ImplementationAtEachLayer/DomainLayer.html#service-label"><span>Implementation of Service</span></a>&#8221; for details of Service.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In this guideline, Mapper interface of MyBatis3 is called as Repository interface in order to standardize the architecture terminology</p>
</div>
</div></blockquote>
<p>The explanation hereafter is given presuming that the user has read &#8220;<a class="reference internal" href="../ImplementationAtEachLayer/DomainLayer.html#domainlayer-entity"><span>Implementation of Entity</span></a>&#8221; &#8220;<a class="reference internal" href="../ImplementationAtEachLayer/DomainLayer.html#repository-label"><span>Implementation of Repository</span></a>&#8221; and &#8220;<a class="reference internal" href="../ImplementationAtEachLayer/DomainLayer.html#service-label"><span>Implementation of Service</span></a>&#8221;.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="how-to-map-a-javabean-in-search-results">
<span id="dataaccessmybatis3howtouseresultsetmapping"></span><h3><a class="toc-backref" href="#id48">5.2.2.5. How to map a JavaBean in Search results</a><a class="headerlink" href="#how-to-map-a-javabean-in-search-results" title="Permalink to this headline">¶</a></h3>
<p>How to map a JavaBean in the search results is explained before explaining the search process of Entity.</p>
<p>Two methods of automatic and manual, are provided in MyBatis3
to map JavaBean (Entity) in the search results (<code class="docutils literal"><span class="pre">ResultSet</span></code>).
Since both the methods have distinct features, <strong>a mapping method to be used should be determined by considering the project features and features of SQL to be executed by the application.</strong></p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Mapping method to be used</strong></p>
<p>The guideline provides two proposals such as</p>
<ul class="simple">
<li>Automatic mapping is used for simple mapping (mapping to a single object) whereas manual mapping is used in case of advanced mapping (mapping to related objects) is necessary.</li>
<li>A uniform manual mapping is used</li>
</ul>
<p>It is not mandatory to use any one of the two methods proposed above and they can be considered as one of the alternatives.</p>
<p class="last"><strong>Architect should clearly identify the criteria for selecting manual mapping and automatic mapping for the programmers
and look for a uniform mapping method for the entire application.</strong></p>
</div>
</div></blockquote>
<p>The respective features and examples for automatic mapping and manual mapping are explained below.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="automatic-mapping-for-search-results">
<span id="dataaccessmybatis3howtouseresultmappingbyauto"></span><h4><a class="toc-backref" href="#id49">5.2.2.5.1. Automatic mapping for search results</a><a class="headerlink" href="#automatic-mapping-for-search-results" title="Permalink to this headline">¶</a></h4>
<p>In MyBatis3, a mechanism which automatically performs the mapping by matching column name and property name is provided
as a method to map search result (<code class="docutils literal"><span class="pre">ResultSet</span></code>) column and JavaBean property.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Features of automatic mapping</strong></p>
<p>When automatic mapping is used, only SQL to be executed is described in the mapping file
thus reducing the description content of mapping file.</p>
<p>By reducing the description, simple mistakes and modification locations while changing a column name or a property name can be reduced as well.</p>
<p class="last">However, automatic mapping can only be used for single object.
Manual mapping is required when mapping for the nested related objects.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>Column names</strong></p>
<p class="last">Column name mentioned here does not signify the physical column name of a table
but refers to the column which contains the search result (<code class="docutils literal"><span class="pre">ResultSet</span></code>) fetched by executing the SQL.
Therefore, by using AS clause, matching a physical column name and a JavaBean property name is comparatively easier.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>How to map search results in JavaBean using automatic mapping is shown below.</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">projectName-domain/src/main/resources/com/example/domain/repository/todo/TodoRepository.xml</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.todo.TodoRepository&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;string&quot;</span> <span class="na">resultType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
        SELECT
<span class="hll">            todo_id AS &quot;todoId&quot;, /* (1) */
</span>            todo_title AS &quot;todoTitle&quot;,
<span class="hll">            finished, /* (2) */
</span>            created_at AS &quot;createdAt&quot;,
            version
        FROM
            t_todo
        WHERE
            todo_id = #{todoId}
    <span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>When physical column name of table and JavaBean property name are different, automatic mapping can be applied by using AS clause for matching.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>When physical column name of table and JavaBean property name match, there is no need to specify the AS clause.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>JavaBean</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Todo</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">todoId</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">todoTitle</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">finished</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Date</span> <span class="n">createdAt</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kt">long</span> <span class="n">version</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTodoId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">todoId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTodoId</span><span class="o">(</span><span class="n">String</span> <span class="n">todoId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">todoId</span> <span class="o">=</span> <span class="n">todoId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTodoTitle</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">todoTitle</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTodoTitle</span><span class="o">(</span><span class="n">String</span> <span class="n">todoTitle</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">todoTitle</span> <span class="o">=</span> <span class="n">todoTitle</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isFinished</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">finished</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFinished</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">finished</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">finished</span> <span class="o">=</span> <span class="n">finished</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getCreatedAt</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">createdAt</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCreatedAt</span><span class="o">(</span><span class="n">Date</span> <span class="n">createdAt</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">createdAt</span> <span class="o">=</span> <span class="n">createdAt</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getVersion</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">version</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setVersion</span><span class="o">(</span><span class="kt">long</span> <span class="n">version</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">version</span> <span class="o">=</span> <span class="n">version</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>How to map a column name separated by an underscore and a property name in camel case format</strong></p>
<p class="last">In the above example, the difference between a column name separated by an underscore and a property name in camel case format is resolved by using AS clause.
However, it can be implemented by changing MyBatis3 configuration
if only the difference between a column name separated by an underscore and a property name in camel case format is to be resolved.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>When the physical column name of a table is separated by an underscore,
automatic mapping can be performed in JavaBean property in the camel case format
by adding following settings to MyBatis configuration file (<code class="file docutils literal"><span class="pre">mybatis-config.xml</span></code>).</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">projectName-domain/src/main/resources/META-INF/mybatis/mybatis-config.xml</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE configuration</span>
<span class="cp">  PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span>
<span class="cp">  &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span>
<span class="nt">&lt;configuration&gt;</span>

    <span class="nt">&lt;settings&gt;</span>
<span class="hll">        <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
</span>    <span class="nt">&lt;/settings&gt;</span>

<span class="nt">&lt;/configuration&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p class="first">Add the settings to set <code class="docutils literal"><span class="pre">mapUnderscoreToCamelCase</span></code>  to <cite>true</cite>.</p>
<p class="last">When it is set to <cite>true</cite>, the column name separated by an underscore is automatically converted to camel case format.
As a typical example, when column name is <code class="docutils literal"><span class="pre">&quot;todo_id&quot;</span></code>, it is converted to <code class="docutils literal"><span class="pre">&quot;todoId&quot;</span></code> and mapping is performed.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">projectName-domain/src/main/resources/com/example/domain/repository/todo/TodoRepository.xml</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.todo.TodoRepository&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;string&quot;</span> <span class="na">resultType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
        SELECT
<span class="hll">            todo_id, /* (4) */
</span><span class="hll">            todo_title,
</span><span class="hll">            finished,
</span><span class="hll">            created_at,
</span><span class="hll">            version
</span>        FROM
            t_todo
        WHERE
            todo_id = #{todoId}
    <span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>A simple SQL can be fetched since AS clause is not required to resolve the difference between the column name separated by an underscore and the property name in the camel case format.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="manual-mapping-of-search-results">
<span id="dataaccessmybatis3howtouseresultmappingbymanual"></span><h4><a class="toc-backref" href="#id50">5.2.2.5.2. Manual mapping of search results</a><a class="headerlink" href="#manual-mapping-of-search-results" title="Permalink to this headline">¶</a></h4>
<p>MyBatis3 provides a mechanism to manually map search result (<code class="docutils literal"><span class="pre">ResultSet</span></code>) column and JavaBean property
by defining their association in the mapping file.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Features of manual mapping</strong></p>
<p>When manual mapping is used, the association between search result (<code class="docutils literal"><span class="pre">ResultSet</span></code>) column and JavaBean property
is defined for each item one by one in the mapping file.
Therefore, mapping with extremely high flexibility and complexity can be achieved.</p>
<p>Manual mapping is a method to effectively map the search results (<code class="docutils literal"><span class="pre">ResultSet</span></code>) column and JavaBean property for the cases given below.</p>
<blockquote>
<div><ul class="simple">
<li>When data model (JavaBean) that handles the application and physical table layout do not match</li>
<li>When JavaBean has a nested structure (separate JavaBean is nested)</li>
</ul>
</div></blockquote>
<p class="last">Also, manual mapping can be mapped efficiently compared with automatic mapping.
If prevail efficiency of processing, it is desirable to use manual mapping instead of automatic mapping.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">How to map search results in JavaBean using manual mapping is given below.</div>
<div class="line">Since the idea is to explain how to use manual mapping, a simple example wherein automatic mapping can also be performed, is used for the explanation.</div>
</div>
<p>For a hands-on implementation example, refer to</p>
<ul class="simple">
<li>&#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/sqlmap-xml.html#Advanced_Result_Maps">MyBatis 3 REFERENCE DOCUMENTATION(Mapper XML Files-Advanced Result Maps-)</a> &#8220;</li>
<li>&#8220;<a class="reference internal" href="#dataaccessmybatis3appendixacquirerelatedobjectsatonce"><span>How to fetch a related Entity by a single SQL</span></a>&#8220;</li>
<li>&#8220;<a class="reference internal" href="#dataaccessmybatis3appendixnestedselect"><span>How to fetch a related Entity using a nested SQL</span></a>&#8220;</li>
</ul>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">projectName-domain/src/main/resources/com/example/domain/repository/todo/TodoRepository.xml</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.todo.TodoRepository&quot;</span><span class="nt">&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;todoResultMap&quot;</span> <span class="na">type=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;id</span> <span class="na">column=</span><span class="s">&quot;todo_id&quot;</span> <span class="na">property=</span><span class="s">&quot;todoId&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&quot;todo_title&quot;</span> <span class="na">property=</span><span class="s">&quot;todoTitle&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">        <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&quot;finished&quot;</span> <span class="na">property=</span><span class="s">&quot;finished&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">        <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&quot;created_at&quot;</span> <span class="na">property=</span><span class="s">&quot;createdAt&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">        <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&quot;version&quot;</span> <span class="na">property=</span><span class="s">&quot;version&quot;</span> <span class="nt">/&gt;</span>
</span>    <span class="nt">&lt;/resultMap&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (4) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;string&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;todoResultMap&quot;</span><span class="nt">&gt;</span>
</span>        SELECT
            todo_id,
            todo_title,
            finished,
            created_at,
            version
        FROM
            t_todo
        WHERE
            todo_id = #{todoId}
    <span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Define the mapping of search results (<code class="docutils literal"><span class="pre">ResultSet</span></code>) and JavaBean, in <code class="docutils literal"><span class="pre">&lt;resultMap&gt;</span></code> element.</p>
<p>Specify the ID to identify mapping in <code class="docutils literal"><span class="pre">id</span></code> attribute and the JavaBean class name (or alias) to be mapped, in <code class="docutils literal"><span class="pre">type</span></code> attribute.</p>
<p class="last">Refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/sqlmap-xml.html#resultMap">MyBatis 3 REFERENCE DOCUMENTATION(Mapper XML Files-resultMap-)</a> &#8221; for details of <code class="docutils literal"><span class="pre">&lt;resultMap&gt;</span></code> element, .</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Map search results (<code class="docutils literal"><span class="pre">ResultSet</span></code>) ID (PK) column and JavaBean property.</p>
<p>Specify mapping of ID (PK) by using <code class="docutils literal"><span class="pre">&lt;id&gt;</span></code> element.
Specify search result (<code class="docutils literal"><span class="pre">ResultSet</span></code>) column name in <code class="docutils literal"><span class="pre">column</span></code> attribute and JavaBean property name in <code class="docutils literal"><span class="pre">property</span></code> attribute.</p>
<p class="last">Refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/sqlmap-xml.html#id__result">MyBatis 3 REFERENCE DOCUMENTATION(Mapper XML Files-id &amp; result-)</a> &#8221; for details of <code class="docutils literal"><span class="pre">&lt;id&gt;</span></code> element.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p class="first">Map a column other than ID (PK) column of search results (<code class="docutils literal"><span class="pre">ResultSet</span></code>) and JavaBean property.</p>
<p>Specify mapping for column other than ID (PK) using <code class="docutils literal"><span class="pre">&lt;result&gt;</span></code> element.
Specify search result (<code class="docutils literal"><span class="pre">ResultSet</span></code>) column name in <code class="docutils literal"><span class="pre">column</span></code> attribute and JavaBean property name in <code class="docutils literal"><span class="pre">property</span></code> attribute.</p>
<p class="last">Refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/sqlmap-xml.html#id__result">MyBatis 3 REFERENCE DOCUMENTATION(Mapper XML Files-id &amp; result-)</a> &#8221; for details of <code class="docutils literal"><span class="pre">&lt;result&gt;</span></code> element.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>Specify mapping definition ID to be applied, in <code class="docutils literal"><span class="pre">resultMap</span></code> attribute of <code class="docutils literal"><span class="pre">&lt;select&gt;</span></code> element.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>How to use id element and result element</strong></p>
<p><code class="docutils literal"><span class="pre">&lt;id&gt;</span></code> element and <code class="docutils literal"><span class="pre">&lt;result&gt;</span></code> element can both be used
for mapping search results (<code class="docutils literal"><span class="pre">ResultSet</span></code>) column and JavaBean property.
However, it is recommended to use <code class="docutils literal"><span class="pre">&lt;id&gt;</span></code> element for mapping of ID (PK) column.</p>
<p class="last">This is because, when <code class="docutils literal"><span class="pre">&lt;id&gt;</span></code> element is used for the mapping of ID (PK) column, the performance of mapping process for related objects and the cache control process of objects provided by MyBatis3
can show overall improvement.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="search-process-for-entity">
<span id="dataaccessmybatis3howtousefind"></span><h3><a class="toc-backref" href="#id51">5.2.2.6. Search process for Entity</a><a class="headerlink" href="#search-process-for-entity" title="Permalink to this headline">¶</a></h3>
<p>How to implement a search process of Entity for different purposes, is explained below.</p>
<p>Read &#8220;<a class="reference internal" href="#dataaccessmybatis3howtouseresultsetmapping"><span>How to map a JavaBean in Search results</span></a>&#8221; before reading how to implement the search process for Entity.</p>
<p>The explanation below is the example wherein a setting is enabled to automatically map column name separated by an underscore in property name with camel case.</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">projectName-domain/src/main/resources/META-INF/mybatis/mybatis-config.xml</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE configuration</span>
<span class="cp">  PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span>
<span class="cp">  &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span>
<span class="nt">&lt;configuration&gt;</span>

    <span class="nt">&lt;settings&gt;</span>
        <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/settings&gt;</span>

<span class="nt">&lt;/configuration&gt;</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="fetching-a-single-key-entity">
<span id="dataaccessmybatis3howtousefindone"></span><h4><a class="toc-backref" href="#id52">5.2.2.6.1. Fetching a single key Entity</a><a class="headerlink" href="#fetching-a-single-key-entity" title="Permalink to this headline">¶</a></h4>
<p>Implementation example wherein, a single Entity is fetched by specifying PK rather than configuring PK in a single column, is given below.</p>
<ul class="simple">
<li>Define method in Repository interface.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.repository.todo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoRepository</span> <span class="o">{</span>

    <span class="c1">// (1)</span>
    <span class="n">Todo</span> <span class="nf">findOne</span><span class="o">(</span><span class="n">String</span> <span class="n">todoId</span><span class="o">);</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>In the above example, <code class="docutils literal"><span class="pre">findOne</span></code> method is defined as the method to fetch a single Todo object matching with <code class="docutils literal"><span class="pre">todoId</span></code> (PK) specified in the argument.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Define SQL in the mapping file.</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.todo.TodoRepository&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;string&quot;</span> <span class="na">resultType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
        /* (3) */
        SELECT
            todo_id,
            todo_title,
            finished,
            created_at,
            version
        FROM
            t_todo
        /* (4) */
        WHERE
            todo_id = #{todoId}
    <span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="11%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>-</td>
<td><p class="first">Implements SQL in <code class="docutils literal"><span class="pre">select</span></code> element with search result  0 to 1 record.</p>
<p>In the above example, the SQL fetching a record that matches with ID (PK) is implemented.</p>
<p class="last">For details of <code class="docutils literal"><span class="pre">select</span></code> element,
refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/sqlmap-xml.html#select">MyBatis3 REFERENCE DOCUMENTATION (Mapper XML Files-select-)</a>&#8221;.</p>
</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>id</td>
<td>Specifies method name of the method defined in Repository interface.</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>parameterType</td>
<td>Specifies parameter fully qualified class name (or alias name).</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>resultType</td>
<td><p class="first">Specifies the fully qualified class name (or alias) of JavaBean that maps the search results (<code class="docutils literal"><span class="pre">ResultSet</span></code>).</p>
<p>When manual mapping is used, specify mapping definition to be applied, by using <code class="docutils literal"><span class="pre">resultMap</span></code> attribute in place of <code class="docutils literal"><span class="pre">resultType</span></code> attribute.</p>
<p class="last">Refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3howtouseresultmappingbymanual"><span>Manual mapping of search results</span></a>&#8221; for manual mapping.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>-</td>
<td><p class="first">Specify the column to be fetched.</p>
<p class="last">In the above example, automatic mapping is used as the method to map search results (<code class="docutils literal"><span class="pre">ResultSet</span></code>) to JavaBean.
Refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3howtouseresultmappingbyauto"><span>Automatic mapping for search results</span></a>&#8221; for automatic mapping.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>-</td>
<td><p class="first">Specify search conditions in WHERE clause.</p>
<p>Specify the value to be bound in search condition as the bind value of <code class="docutils literal"><span class="pre">#{variableName}</span></code> format. In the above example,
<code class="docutils literal"><span class="pre">#{todoId}</span></code> acts as the bind variable.</p>
<p class="last">When argument type of Repository interface is of simple type like <code class="docutils literal"><span class="pre">String</span></code>, any name can be specified
as the bind variable name, however when the argument type is JavaBean,
JavaBean property name must be specified in the bind variable name.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Simple type bind variable name</strong></p>
<p class="last">In case of a simple type like <code class="docutils literal"><span class="pre">String</span></code>, there is no restriction for the bind variable name, however, it is recommended to use the value same as the argument name of the method.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Apply DI to Repository in Service class and call the interface method of Repository.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.service.todo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.domain.repository.todo.TodoRepository</span><span class="o">;</span>

<span class="nd">@Transactional</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoServiceImpl</span> <span class="kd">implements</span> <span class="n">TodoService</span> <span class="o">{</span>

    <span class="c1">// (5)</span>
    <span class="nd">@Inject</span>
    <span class="n">TodoRepository</span> <span class="n">todoRepository</span><span class="o">;</span>

    <span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Todo</span> <span class="nf">getTodo</span><span class="o">(</span><span class="n">String</span> <span class="n">todoId</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// (6)</span>
        <span class="n">Todo</span> <span class="n">todo</span> <span class="o">=</span> <span class="n">todoRepository</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">todoId</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">todo</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// (7)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">ResourceNotFoundException</span><span class="o">(</span><span class="n">ResultMessages</span><span class="o">.</span><span class="na">error</span><span class="o">().</span><span class="na">add</span><span class="o">(</span>
                    <span class="s">&quot;e.ex.td.5001&quot;</span><span class="o">,</span> <span class="n">todoId</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">todo</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td>Apply DI to Repository interface in Service class.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td>Call Repository interface method and fetch 1 Entity.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="7">
<li></li>
</ol>
</td>
<td><p class="first">Since <code class="docutils literal"><span class="pre">null</span></code> is returned when the search result shows 0 records,
if required, implement the process when Entity cannot be fetched.</p>
<p class="last">In the above example, when Entity cannot be fetched, &#8220;resource not detected&#8221; error is generated.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="fetching-entity-of-composite-key">
<h4><a class="toc-backref" href="#id53">5.2.2.6.2. Fetching Entity of composite key</a><a class="headerlink" href="#fetching-entity-of-composite-key" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">The implementation example of fetching a single Entity by specifying PK rather than configuring PK in multiple columns, is given below.</div>
<div class="line">Basic settings are same as while configuring PK in a single column, however the way to specify a method argument for Repository interface is different.</div>
</div>
<ul class="simple">
<li>Defining the method in Repository interface.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.repository.order</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.ibatis.annotations.Param</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.OrderHistory</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">OrderHistoryRepository</span> <span class="o">{</span>

   <span class="c1">// (1)</span>
   <span class="n">OrderHistory</span> <span class="nf">findOne</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;orderId&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">orderId</span><span class="o">,</span>
           <span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;historyId&quot;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">historyId</span><span class="o">);</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Define an argument corresponding to the column that configures PK, in the method.</p>
<p class="last">In the above example, <code class="docutils literal"><span class="pre">orderId</span></code> and <code class="docutils literal"><span class="pre">historyId</span></code> are defined in the argument as PK for the table that manages change history of orders received.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>Bind variable name while specifying multiple method arguments</strong></p>
<p>When multiple method arguments of Repository interface are specified, it is recommended to specify <code class="docutils literal"><span class="pre">&#64;org.apache.ibatis.annotations.Param</span></code> annotation in the argument.
&#8220;Bind variable name&#8221; specified while selecting the value from mapping file is specified in the <code class="docutils literal"><span class="pre">value</span></code> attribute of <code class="docutils literal"><span class="pre">&#64;Param</span></code> annotation.</p>
<p>As shown in the above example, the value specified in the argument can be bound in SQL by specifying <code class="docutils literal"><span class="pre">#{orderId}</span></code> and <code class="docutils literal"><span class="pre">#{historyId}</span></code> from mapping file.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.order.OrderHistoryRepository&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span> <span class="na">resultType=</span><span class="s">&quot;OrderHistory&quot;</span><span class="nt">&gt;</span>
        SELECT
            order_id,
            history_id,
            order_name,
            operation_type,
            created_at&quot;
        FROM
            t_order_history
        WHERE
            order_id = #{orderId}
        AND
            history_id = #{historyId}
    <span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p>Although it is not mandatory to specify <code class="docutils literal"><span class="pre">&#64;Param</span></code> annotation,
if it is not specified, a mechanical bind variable name needs to be specified as given below.
The bind variable name when  <code class="docutils literal"><span class="pre">&#64;Param</span></code> annotation is not specified is formed as, &#8221; &#8220;param&#8221; + declared position of the argument(start from 1)&#8221;,
and thus can hamper maintainability and readability of the source code.</p>
<blockquote class="last">
<div><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- omitted --&gt;</span>

WHERE
    order_id = #{param1}
AND
    history_id = #{param2}

<span class="c">&lt;!-- omitted --&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="entity-search">
<span id="dataaccessmybatis3howtousefindmultiple"></span><h4><a class="toc-backref" href="#id54">5.2.2.6.3. Entity search</a><a class="headerlink" href="#entity-search" title="Permalink to this headline">¶</a></h4>
<p>Implementation example is given below wherein a SQL with search results 0 to N records is executed and multiple records of Entity are fetched.</p>
<blockquote>
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If the search results data is in a large quantity, using &#8220;<a class="reference internal" href="#dataaccessmybatis3howtoextendresulthandler"><span>Implementation of ResultHandler</span></a>&#8221; should be considered.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Defining the method for fetching multiple records of Entity.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.repository.todo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoRepository</span> <span class="o">{</span>

    <span class="c1">// (1)</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="nf">findAllByCriteria</span><span class="o">(</span><span class="n">TodoCriteria</span> <span class="n">criteria</span><span class="o">);</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>In the above example, <code class="docutils literal"><span class="pre">findAllByCriteria</span></code> is defined as the method to fetch multiple records of Todo object in a list format that matches with
the JavaBean (<code class="docutils literal"><span class="pre">TodoCriteria</span></code>) retaining the search conditions.</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>In the above example, the return value of method is specified as <code class="docutils literal"><span class="pre">java.util.List</span></code> however,
search results can also be received as <code class="docutils literal"><span class="pre">java.util.Map</span></code>.</p>
<p>When the results are received in <code class="docutils literal"><span class="pre">Map</span></code>,</p>
<ul class="simple">
<li>PK value is stored in <code class="docutils literal"><span class="pre">key</span></code> of <code class="docutils literal"><span class="pre">Map</span></code></li>
<li>Entity object is stored in <code class="docutils literal"><span class="pre">value</span></code> of <code class="docutils literal"><span class="pre">Map</span></code>.</li>
</ul>
<p>When search results are received by <code class="docutils literal"><span class="pre">Map</span></code>, <code class="docutils literal"><span class="pre">java.util.HashMap</span></code> instance is returned.
Hence, it should be noted that the alignment sequence of <code class="docutils literal"><span class="pre">Map</span></code>is not guaranteed.</p>
<p>Implementation example is given below.</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.repository.todo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.ibatis.annotations.MapKey</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoRepository</span> <span class="o">{</span>

    <span class="nd">@MapKey</span><span class="o">(</span><span class="s">&quot;todoId&quot;</span><span class="o">)</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Todo</span><span class="o">&gt;</span> <span class="nf">findAllByCriteria</span><span class="o">(</span><span class="n">TodoCriteria</span> <span class="n">criteria</span><span class="o">);</span>

<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
<p class="last">When search results are received by <code class="docutils literal"><span class="pre">Map</span></code>, <code class="docutils literal"><span class="pre">&#64;org.apache.ibatis.annotations.MapKey</span></code> annotation is specified in the method.
Property name that is handled as <code class="docutils literal"><span class="pre">key</span></code> of <code class="docutils literal"><span class="pre">Map</span></code> is specified in the <code class="docutils literal"><span class="pre">value</span></code> attribute of annotation.
In the above example, PK of Todo object (<code class="docutils literal"><span class="pre">todoId</span></code>) is specified.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Create JavaBean that retains the search conditions.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.repository.todo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoCriteria</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Date</span> <span class="n">createdAt</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">title</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTitle</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getCreatedAt</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">createdAt</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCreatedAt</span><span class="o">(</span><span class="n">Date</span> <span class="n">createdAt</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">createdAt</span> <span class="o">=</span> <span class="n">createdAt</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Creating a JavaBean for retaining search conditions</strong></p>
<p>Although it is not mandatory to create a JavaBean for retaining search conditions, it is recommended to create one,
to clearly identify the role of the stored value. However, implementation can also be performed without creating a JavaBean.</p>
<p><strong>The decision standards of the cases for which JavaBean is created and those for which it is not created should be clearly stated to the programmers by the Architect,
so that an overall uniform application can be created.</strong></p>
<p>Implementation example when JavaBean is not created is given below.</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.repository.todo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoRepository</span> <span class="o">{</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="nf">findAllByCriteria</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;title&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">title</span><span class="o">,</span>
            <span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;createdAt&quot;</span><span class="o">)</span> <span class="n">Date</span> <span class="n">createdAt</span><span class="o">);</span>

<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
<p class="last">When JavaBean is not created, the search conditions are declared one by one in an argument
and &#8220;bind variable name&#8221; is specified in <code class="docutils literal"><span class="pre">value</span></code> attribute of <code class="docutils literal"><span class="pre">&#64;Param</span></code> annotation.
Multiple search conditions can be passed to SQL by defining the method described above.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Define SQL in the mapping file.</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.todo.TodoRepository&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findAllByCriteria&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;TodoCriteria&quot;</span> <span class="na">resultType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
        <span class="cp">&lt;![CDATA[</span>
<span class="cp">        SELECT</span>
<span class="cp">            todo_id,</span>
<span class="cp">            todo_title,</span>
<span class="cp">            finished,</span>
<span class="cp">            created_at,</span>
<span class="cp">            version</span>
<span class="cp">        FROM</span>
<span class="cp">            t_todo</span>
<span class="cp">        WHERE</span>
<span class="cp">            todo_title LIKE #{title} || &#39;%&#39; ESCAPE &#39;~&#39;</span>
<span class="cp">        AND</span>
<span class="cp">            created_at &lt; #{createdAt}</span>
<span class="cp">        /* (3) */</span>
<span class="cp">        ORDER BY</span>
<span class="cp">            todo_id</span>
<span class="cp">        ]]&gt;</span>
    <span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Implement the SQL with search results 0 to N records in <code class="docutils literal"><span class="pre">select</span></code> element.</p>
<p class="last">In the above example, Todo records that match with the conditions specified in <code class="docutils literal"><span class="pre">todo_title</span></code> and <code class="docutils literal"><span class="pre">created_at</span></code> are fetched.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p class="first">Specify sort condition.</p>
<p class="last">When multiple records are to be fetched, sort condition is specified.
Particularly, sort condition must be specified in the SQL that fetches the record displayed on the screen.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>How to use CDATA section</strong></p>
<p>When a XML character (<code class="docutils literal"><span class="pre">&quot;&lt;&quot;</span></code> or <code class="docutils literal"><span class="pre">&quot;&gt;&quot;</span></code> etc.) that needs to be escaped in SQL is specified,
the readability of SQL can be maintained by using CDATA section.
When CDATA section is not used, entity reference characters such as <code class="docutils literal"><span class="pre">&quot;&amp;lt;&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;&amp;gt;&quot;</span></code> need to be specified,
and may lead to reduced SQL readability.</p>
<p class="last">In the above example, CDATA section is specified since <code class="docutils literal"><span class="pre">&quot;&lt;&quot;</span></code> is used as the condition for <code class="docutils literal"><span class="pre">created_at</span></code>.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="fetching-entity-records">
<span id="dataaccessmybatis3howtousecount"></span><h4><a class="toc-backref" href="#id55">5.2.2.6.4. Fetching Entity records</a><a class="headerlink" href="#fetching-entity-records" title="Permalink to this headline">¶</a></h4>
<p>The implementation example of fetching Entity records matching with search conditions is given below.</p>
<ul class="simple">
<li>Defining the method for fetching Entity records matching with search conditions.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.repository.todo</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoRepository</span> <span class="o">{</span>

    <span class="c1">// (1)</span>
    <span class="kt">long</span> <span class="nf">countByFinished</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">finished</span><span class="o">);</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Specify numeric type (<code class="docutils literal"><span class="pre">int</span></code> or <code class="docutils literal"><span class="pre">long</span></code> etc.) for the return value of method used to fetch records.</p>
<p class="last">In the above example, <code class="docutils literal"><span class="pre">long</span></code> is specified.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Define SQL in the mapping file.</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.todo.TodoRepository&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;countByFinished&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;_boolean&quot;</span> <span class="na">resultType=</span><span class="s">&quot;_long&quot;</span><span class="nt">&gt;</span>
        SELECT
            COUNT(*)
        FROM
            t_todo
        WHERE
            finished = #{finished}
    <span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Execute the SQL that fetches the records.</p>
<p>Type of return value is specified in <code class="docutils literal"><span class="pre">resultType</span></code> attribute.</p>
<p class="last">In the above example, primitive type alias name for specifying   <code class="docutils literal"><span class="pre">long</span></code> is specified.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>Primitive type alias name</strong></p>
<p class="last"><code class="docutils literal"><span class="pre">&quot;_&quot;</span></code> (underscore) should be specified at the beginning of the primitive type alias name.
When <code class="docutils literal"><span class="pre">&quot;_&quot;</span></code>(underscore) is not specified, it is handled as primitive wrapper type (<code class="docutils literal"><span class="pre">java.lang.Long</span></code> etc.) alias.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="pagination-search-of-entity-mybatis3-standard-method">
<span id="dataaccessmybatis3howtousefindpageusingmybatisfunction"></span><h4><a class="toc-backref" href="#id56">5.2.2.6.5. Pagination search of Entity (MyBatis3 standard method)</a><a class="headerlink" href="#pagination-search-of-entity-mybatis3-standard-method" title="Permalink to this headline">¶</a></h4>
<p>Implementation example to search an Entity by using MyBatis3 functionality for specifying the fetching scope, is given below.</p>
<p><code class="docutils literal"><span class="pre">org.apache.ibatis.session.RowBounds</span></code> class is provided in MyBatis as the class to specify the fetch range.
and in SQL, it is not necessary to describe the conditions for fetch range.</p>
<blockquote>
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Precautions when large number of data records match the search conditions</strong></p>
<p>Standard MyBatis method is to move the cursor and skip the data which is outside the fetch range of search results (<code class="docutils literal"><span class="pre">ResultSet</span></code>).
Hence, in proportion to the data records that match with search conditions, issues like memory exhaustion or performance degradation of cursor movement are more likely to occur.</p>
<p>According to JDBC result set type, the cursor movement processing supports following 2 types. Default behavior is
dependent on the default result set type of JDBC driver.</p>
<ul class="simple">
<li>When result set type is <code class="docutils literal"><span class="pre">FORWARD_ONLY</span></code>, <code class="docutils literal"><span class="pre">ResultSet#next()</span></code> is repeatedly called and data outside the fetching range is skipped.</li>
<li>When result set type is <code class="docutils literal"><span class="pre">SCROLL_SENSITIVE</span></code> or <code class="docutils literal"><span class="pre">SCROLL_INSENSITIVE</span></code>, <code class="docutils literal"><span class="pre">ResultSet#absolute(int)</span></code> is called and data outside the scope of fetching range is skipped.</li>
</ul>
<p>Performance degradation can be restricted to a minimum by using <code class="docutils literal"><span class="pre">ResultSet#absolute(int)</span></code> however,
it is dependent on the implementation of JDBC driver. If process same as <code class="docutils literal"><span class="pre">ResultSet#next()</span></code> is performed internally,
it is not possible to prevent memory exhaustion or performance deterioration.</p>
<p class="last"><strong>When there is a possibility of large number of data records matching the search conditions, SQL refine method should be adopted
instead of pagination search which is a MyBatis3 standard method.</strong></p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Defining the method for performing Entity pagination search.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="n">ackage</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">domain</span><span class="o">.</span><span class="na">repository</span><span class="o">.</span><span class="na">todo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.ibatis.session.RowBounds</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoRepository</span> <span class="o">{</span>

    <span class="c1">// (1)</span>
    <span class="kt">long</span> <span class="nf">countByCriteria</span><span class="o">(</span><span class="n">TodoCriteria</span> <span class="n">criteria</span><span class="o">);</span>

    <span class="c1">// (2)</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="nf">findPageByCriteria</span><span class="o">(</span><span class="n">TodoCriteria</span> <span class="n">criteria</span><span class="o">,</span>
        <span class="n">RowBounds</span> <span class="n">rowBounds</span><span class="o">);</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Define the method that fetches total records of Entity matching with search conditions.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Define the method that extracts those Entities that fall in the fetching range from the Entities matching with search conditions.</p>
<p class="last"><code class="docutils literal"><span class="pre">RowBounds</span></code> that retains the information of fetch range (offset and limit) is specified as the argument of defined method.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul>
<li><p class="first">Define SQL in the mapping file.</p>
<p>Since MyBatis3 performs the process to extract records of corresponding range from the search results, it is not necessary to filter the records within the fetch range using SQL.</p>
</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.todo.TodoRepository&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;countByCriteria&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;TodoCriteria&quot;</span> <span class="na">resultType=</span><span class="s">&quot;_long&quot;</span><span class="nt">&gt;</span>
        <span class="cp">&lt;![CDATA[</span>
<span class="cp">        SELECT</span>
<span class="cp">            COUNT(*)</span>
<span class="cp">        FROM</span>
<span class="cp">            t_todo</span>
<span class="cp">        WHERE</span>
<span class="cp">            todo_title LIKE #{title} || &#39;%&#39; ESCAPE &#39;~&#39;</span>
<span class="cp">        AND</span>
<span class="cp">            created_at &lt; #{createdAt}</span>
<span class="cp">        ]]&gt;</span>
    <span class="nt">&lt;/select&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findPageByCriteria&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;TodoCriteria&quot;</span> <span class="na">resultType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
        <span class="cp">&lt;![CDATA[</span>
<span class="cp">        SELECT</span>
<span class="cp">            todo_id,</span>
<span class="cp">            todo_title,</span>
<span class="cp">            finished,</span>
<span class="cp">            created_at,</span>
<span class="cp">            version</span>
<span class="cp">        FROM</span>
<span class="cp">            t_todo</span>
<span class="cp">        WHERE</span>
<span class="cp">            todo_title LIKE #{title} || &#39;%&#39; ESCAPE &#39;~&#39;</span>
<span class="cp">        AND</span>
<span class="cp">            created_at &lt; #{createdAt}</span>
<span class="cp">        ORDER BY</span>
<span class="cp">            todo_id</span>
<span class="cp">        ]]&gt;</span>
    <span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Standardization of WHERE clause</strong></p>
<p>When pagination search is performed, it is recommended to standardize the WHERE clause specified in &#8220;SQL that fetches total number of records for Entities matching with search condition&#8221;
and &#8220;SQL that fetches the list of the Entities matching with search conditions&#8221;, using include function of MyBatis3.</p>
<p>A standardized WHERE clause of above SQL is defined as below.
Refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3howtoextendsqlshare"><span>Sharing SQL statement</span></a>&#8221; for details.</p>
<blockquote class="last">
<div><div class="highlight-xml"><div class="highlight"><pre><span class="hll"><span class="nt">&lt;sql</span> <span class="na">id=</span><span class="s">&quot;findPageByCriteriaWherePhrase&quot;</span><span class="nt">&gt;</span>
</span>    <span class="cp">&lt;![CDATA[</span>
<span class="cp">    WHERE</span>
<span class="cp">        todo_title LIKE #{title} || &#39;%&#39; ESCAPE &#39;~&#39;</span>
<span class="cp">    AND</span>
<span class="cp">        created_at &lt; #{createdAt}</span>
<span class="cp">    ]]&gt;</span>
<span class="nt">&lt;/sql&gt;</span>

<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;countByCriteria&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;TodoCriteria&quot;</span> <span class="na">resultType=</span><span class="s">&quot;_long&quot;</span><span class="nt">&gt;</span>
    SELECT
        COUNT(*)
    FROM
        t_todo
<span class="hll">    <span class="nt">&lt;include</span> <span class="na">refid=</span><span class="s">&quot;findPageByCriteriaWherePhrase&quot;</span><span class="nt">/&gt;</span>
</span><span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findPageByCriteria&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;TodoCriteria&quot;</span> <span class="na">resultType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
    SELECT
        todo_id,
        todo_title,
        finished,
        created_at,
        version
    FROM
        t_todo
<span class="hll">    <span class="nt">&lt;include</span> <span class="na">refid=</span><span class="s">&quot;findPageByCriteriaWherePhrase&quot;</span><span class="nt">/&gt;</span>
</span>    ORDER BY
        todo_id
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>How to explicitly specify a result set type</strong></p>
<p>Result set type is specified in <code class="docutils literal"><span class="pre">resultType</span></code> attribute when it is to be specified explicitly.
When the default result set type of JDBC driver is <code class="docutils literal"><span class="pre">FORWARD_ONLY</span></code>, it is recommended to specify <code class="docutils literal"><span class="pre">SCROLL_INSENSITIVE</span></code>.</p>
<blockquote class="last">
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findPageByCriteria&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;TodoCriteria&quot;</span> <span class="na">resultType=</span><span class="s">&quot;Todo&quot;</span>
<span class="hll">    <span class="na">resultSetType=</span><span class="s">&quot;SCROLL_INSENSITIVE&quot;</span><span class="nt">&gt;</span>
</span>    <span class="c">&lt;!-- omitted --&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Implementing pagination search process in Service class.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="c1">// omitted</span>

<span class="nd">@Transactional</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoServiceImpl</span> <span class="kd">implements</span> <span class="n">TodoService</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">TodoRepository</span> <span class="n">todoRepository</span><span class="o">;</span>

    <span class="c1">// omitted</span>

    <span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Page</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="nf">searchTodos</span><span class="o">(</span><span class="n">TodoCriteria</span> <span class="n">criteria</span><span class="o">,</span> <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// (3)</span>
        <span class="kt">long</span> <span class="n">total</span> <span class="o">=</span> <span class="n">todoRepository</span><span class="o">.</span><span class="na">countByCriteria</span><span class="o">(</span><span class="n">criteria</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">todos</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="n">total</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// (4)</span>
            <span class="n">RowBounds</span> <span class="n">rowBounds</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RowBounds</span><span class="o">(</span><span class="n">pageable</span><span class="o">.</span><span class="na">getOffset</span><span class="o">(),</span>
                <span class="n">pageable</span><span class="o">.</span><span class="na">getPageSize</span><span class="o">());</span>
            <span class="c1">// (5)</span>
            <span class="n">todos</span> <span class="o">=</span> <span class="n">todoRepository</span><span class="o">.</span><span class="na">findPageByCriteria</span><span class="o">(</span><span class="n">criteria</span><span class="o">,</span> <span class="n">rowBounds</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="c1">// (6)</span>
            <span class="n">todos</span> <span class="o">=</span> <span class="n">Collections</span><span class="o">.</span><span class="na">emptyList</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="c1">// (7)</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">PageImpl</span><span class="o">&lt;&gt;(</span><span class="n">todos</span><span class="o">,</span> <span class="n">pageable</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// omitted</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>First, fetch the total Entity records matching with search condition.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td><p class="first">Generate <code class="docutils literal"><span class="pre">RowBounds</span></code> object that specifies fetch range of pagination search when Entities matching with search conditions exist.</p>
<p>Specify &#8220;skip record&#8221; in the first argument (<code class="docutils literal"><span class="pre">offset</span></code>) and
&#8220;maximum fetch records&#8221; in the second argument (<code class="docutils literal"><span class="pre">limit</span></code>) of <code class="docutils literal"><span class="pre">RowBounds</span></code>.
For the values to be specified as argument, it is advisable to specify the values fetched by calling <code class="docutils literal"><span class="pre">getOffset</span></code> method and <code class="docutils literal"><span class="pre">getPageSize</span></code> method of <code class="docutils literal"><span class="pre">Pageable</span></code> object
provided by Spring Data Commons.</p>
<p>Basically, the fetch range is</p>
<ul class="last simple">
<li>Records 1st to 20th when <code class="docutils literal"><span class="pre">0</span></code> is specified in offset and <code class="docutils literal"><span class="pre">20</span></code> is specified in limit</li>
<li>Records 21st to 40th when <code class="docutils literal"><span class="pre">20</span></code>is specified in offset and <code class="docutils literal"><span class="pre">20</span></code> is specified in limit</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td>Call Repository method and fetch Entities in the fetch range that match with search conditions.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td>When the Entities that match with search conditions do not exist, set empty list in the search results.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="7">
<li></li>
</ol>
</td>
<td>Create and return page information (<code class="docutils literal"><span class="pre">org.springframework.data.domain.PageImpl</span></code>).</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="pagination-search-for-entity-sql-refinement-method">
<span id="dataaccessmybatis3howtousefindpageusingsqlfilter"></span><h4><a class="toc-backref" href="#id57">5.2.2.6.6. Pagination search for Entity (SQL refinement method)</a><a class="headerlink" href="#pagination-search-for-entity-sql-refinement-method" title="Permalink to this headline">¶</a></h4>
<p>Implementation example to search an Entity by using range search mechanism provided by database, is given below.</p>
<p>Since SQL refinement method uses range search mechanism provided by database,
Entity of fetch range can be fetched efficiently as compared to standard method of MyBatis3.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>It is recommended to adopt the SQL refining method when a large volume of data matching with search condition exists.</strong></p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Defining the method for performing Entity pagination search.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.repository.todo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.ibatis.annotations.Param</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Pageable</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoRepository</span> <span class="o">{</span>

    <span class="c1">// (1)</span>
    <span class="kt">long</span> <span class="nf">countByCriteria</span><span class="o">(</span>
            <span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;criteria&quot;</span><span class="o">)</span> <span class="n">TodoCriteria</span> <span class="n">criteria</span><span class="o">);</span>

    <span class="c1">// (2)</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="nf">findPageByCriteria</span><span class="o">(</span>
            <span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;criteria&quot;</span><span class="o">)</span> <span class="n">TodoCriteria</span> <span class="n">criteria</span><span class="o">,</span>
            <span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;pageable&quot;</span><span class="o">)</span> <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Define a method that fetches total Entity records matching with search conditions.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Define a method to extract entities that can be fetched from the Entities matching with search conditions.</p>
<p class="last"><code class="docutils literal"><span class="pre">org.springframework.data.domain.Pageable</span></code> that retains the information within the fetch range (offset and limit) is specified as an argument for defined method.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Reason why the argument specifies &#64;Param annotation for a single method</strong></p>
<p>In the above example, the argument specifies <code class="docutils literal"><span class="pre">&#64;Param</span></code> annotation for a single method (<code class="docutils literal"><span class="pre">countByCriteria</span></code>).
This is to standardize WHERE clause and the SQL executed when <code class="docutils literal"><span class="pre">findPageByCriteria</span></code> method is called.</p>
<p>By specifying bind variable name in the argument using <code class="docutils literal"><span class="pre">&#64;Param</span></code>annotation, nested structure of bind variable name specified in SQL is combined.</p>
<p class="last">A typical SQL implementation example is given below.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul>
<li><p class="first">Define SQL in the mapping file.</p>
<p>Fetch range records are refined by SQL.</p>
</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.todo.TodoRepository&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;sql</span> <span class="na">id=</span><span class="s">&quot;findPageByCriteriaWherePhrase&quot;</span><span class="nt">&gt;</span>
        <span class="cp">&lt;![CDATA[</span>
<span class="hll"><span class="cp">        /* (3) */</span>
</span><span class="cp">        WHERE</span>
<span class="cp">            todo_title LIKE #{criteria.title} || &#39;%&#39; ESCAPE &#39;~&#39;</span>
<span class="cp">        AND</span>
<span class="cp">            created_at &lt; #{criteria.createdAt}</span>
<span class="cp">        ]]&gt;</span>
    <span class="nt">&lt;/sql&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;countByCriteria&quot;</span> <span class="na">resultType=</span><span class="s">&quot;_long&quot;</span><span class="nt">&gt;</span>
        SELECT
            COUNT(*)
        FROM
            t_todo
        <span class="nt">&lt;include</span> <span class="na">refid=</span><span class="s">&quot;findPageByCriteriaWherePhrase&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/select&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findPageByCriteria&quot;</span> <span class="na">resultType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
        SELECT
            todo_id,
            todo_title,
            finished,
            created_at,
            version
        FROM
            t_todo
        <span class="nt">&lt;include</span> <span class="na">refid=</span><span class="s">&quot;findPageByCriteriaWherePhrase&quot;</span> <span class="nt">/&gt;</span>
        ORDER BY
            todo_id
<span class="hll">        LIMIT
</span><span class="hll">            #{pageable.pageSize} /* (4) */
</span><span class="hll">        OFFSET
</span><span class="hll">            #{pageable.offset}  /* (4) */
</span>    <span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">&#64;Param(&quot;criteria&quot;)</span></code> is specified in the arguments of <code class="docutils literal"><span class="pre">countByCriteria</span></code> and <code class="docutils literal"><span class="pre">findPageByCriteria</span></code> methods,
Hence, the bind variable name specified in SQL is in <code class="docutils literal"><span class="pre">criteria.field</span> <span class="pre">name</span></code> format.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td><p class="first">Extract only necessary records by using the fetch range mechanism provided by database.</p>
<p>&#8220;Skip record&#8221; is stored in <code class="docutils literal"><span class="pre">offset</span></code> of <code class="docutils literal"><span class="pre">Pageable</span></code> object whereas
&#8220;maximum fetch records&#8221; is stored in <code class="docutils literal"><span class="pre">pageSize</span></code>.</p>
<p class="last">Above example is the implementation example with H2 Database.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Implement a pagination search process in the Service class.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="c1">// omitted</span>

<span class="nd">@Transactional</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoServiceImpl</span> <span class="kd">implements</span> <span class="n">TodoService</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">TodoRepository</span> <span class="n">todoRepository</span><span class="o">;</span>

    <span class="c1">// omitted</span>

    <span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Page</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="nf">searchTodos</span><span class="o">(</span><span class="n">TodoCriteria</span> <span class="n">criteria</span><span class="o">,</span>
            <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">long</span> <span class="n">total</span> <span class="o">=</span> <span class="n">todoRepository</span><span class="o">.</span><span class="na">countByCriteria</span><span class="o">(</span><span class="n">criteria</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">todos</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="n">total</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// (5)</span>
            <span class="n">todos</span> <span class="o">=</span> <span class="n">todoRepository</span><span class="o">.</span><span class="na">findPageByCriteria</span><span class="o">(</span><span class="n">criteria</span><span class="o">,</span>
                    <span class="n">pageable</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">todos</span> <span class="o">=</span> <span class="n">Collections</span><span class="o">.</span><span class="na">emptyList</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">PageImpl</span><span class="o">&lt;&gt;(</span><span class="n">todos</span><span class="o">,</span> <span class="n">pageable</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// omitted</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td><p class="first">Call Repository method and fetch Entity within the fetch range matching with search condition.</p>
<p class="last"><code class="docutils literal"><span class="pre">Pageable</span></code> object received by the argument can be passed as it is when calling Repository method.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="entity-registration-process">
<span id="dataaccessmybatis3howtousecreate"></span><h3><a class="toc-backref" href="#id58">5.2.2.7. Entity registration process</a><a class="headerlink" href="#entity-registration-process" title="Permalink to this headline">¶</a></h3>
<p>how to register an Entity for different purposes is explained with implementation example.</p>
<div class="section" id="registering-a-single-entity-record">
<span id="dataaccessmybatis3howtousecreateone"></span><h4><a class="toc-backref" href="#id59">5.2.2.7.1. Registering a single Entity record</a><a class="headerlink" href="#registering-a-single-entity-record" title="Permalink to this headline">¶</a></h4>
<p>Implementation example for registering a single Entity record is given below.</p>
<ul class="simple">
<li>Defining the method in Repository interface.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.repository.todo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoRepository</span> <span class="o">{</span>

    <span class="c1">// (1)</span>
    <span class="kt">void</span> <span class="nf">create</span><span class="o">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="o">);</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>In the above example, <code class="docutils literal"><span class="pre">create</span></code> method is defined as the method for registering a single Todo object specified in the argument.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p></p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Return value of the method that registers Entity</strong></p>
<p>Return value for the method that registers Entity can be <code class="docutils literal"><span class="pre">void</span></code>.</p>
<p>However, when SQL that inserts selected results is executed,
<code class="docutils literal"><span class="pre">boolean</span></code> or numeric value type (<code class="docutils literal"><span class="pre">int</span></code> or <code class="docutils literal"><span class="pre">long</span></code>) should be set as the return value based on application requirements.</p>
<ul class="last simple">
<li>When <code class="docutils literal"><span class="pre">boolean</span></code> is specified as return value, <code class="docutils literal"><span class="pre">false</span></code> is returned when 0 records are registered and <code class="docutils literal"><span class="pre">true</span></code> is returned when 1 or more records are registered.</li>
<li>When numeric value type is specified as return value, number of registered records is returned.</li>
</ul>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Define SQL in the mapping file.</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.todo.TodoRepository&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&quot;create&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
        INSERT INTO
            t_todo
        (
            todo_id,
            todo_title,
            finished,
            created_at,
            version
        )
        /* (3) */
        VALUES
        (
            #{todoId},
            #{todoTitle},
            #{finished},
            #{createdAt},
            #{version}
        )
    <span class="nt">&lt;/insert&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Implement the INSERT SQL in the insert element.</p>
<p>Specify name of the method defined in Repository interface, in <code class="docutils literal"><span class="pre">id</span></code> attribute.</p>
<p class="last">For details of <code class="docutils literal"><span class="pre">insert</span></code> element,
refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/sqlmap-xml.html#insert_update_and_delete">MyBatis3 REFERENCE DOCUMENTATION (Mapper XML Files-insert, update and delete-)</a>&#8221;.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p class="first">Specify configuration value at the time of record registration in VALUE clause.</p>
<p class="last">The value to be bound in VALUE clause is specified as the bind variable of #{variableName} format.
In the above example, since JavaBean (<code class="docutils literal"><span class="pre">Todo`</span></code>) is specified as an argument of Repository interface,
JavaBean property name is specified in the bind variable name.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Apply DI to Repository in Service class and call Repository interface method.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.service.todo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.UUID</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.date.jodatime.JodaTimeDateFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.domain.repository.todo.TodoRepository</span><span class="o">;</span>

<span class="nd">@Transactional</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoServiceImpl</span> <span class="kd">implements</span> <span class="n">TodoService</span> <span class="o">{</span>

    <span class="c1">// (4)</span>
    <span class="nd">@Inject</span>
    <span class="n">TodoRepository</span> <span class="n">todoRepository</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="n">JodaTimeDateFactory</span> <span class="n">dateFactory</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Todo</span> <span class="nf">create</span><span class="o">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// (5)</span>
        <span class="n">todo</span><span class="o">.</span><span class="na">setTodoId</span><span class="o">(</span><span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
        <span class="n">todo</span><span class="o">.</span><span class="na">setCreatedAt</span><span class="o">(</span><span class="n">dateFactory</span><span class="o">.</span><span class="na">newDate</span><span class="o">());</span>
        <span class="n">todo</span><span class="o">.</span><span class="na">setFinished</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="n">todo</span><span class="o">.</span><span class="na">setVersion</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="c1">// (6)</span>
        <span class="n">todoRepository</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">todo</span><span class="o">);</span>
        <span class="c1">// (7)</span>
        <span class="k">return</span> <span class="n">todo</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>Apply DI to Repository interface in Service class.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td><p class="first">Set the value for Entity object passed in the argument based on the application requirements.</p>
<p>In the above example,</p>
<ul class="simple">
<li>&#8220;UUID&#8221; as an ID</li>
<li>&#8220;System date and time&#8221; as registration date and time&#8221;</li>
<li>&#8220;<code class="docutils literal"><span class="pre">false</span></code> : Incomplete&#8221; in the completion flag</li>
<li>&#8220;<code class="docutils literal"><span class="pre">1</span></code>&#8221; in the version</li>
</ul>
<p class="last">are set.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td>Call Repository interface method and register the single Entity record.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="7">
<li></li>
</ol>
</td>
<td><p class="first">Return registered Entity.</p>
<p class="last">When registration value is set in the Service class process, it is recommended to return the registered Entity object as return value.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="generating-key">
<span id="dataaccessmybatis3howtousegenid"></span><h4><a class="toc-backref" href="#id60">5.2.2.7.2. Generating key</a><a class="headerlink" href="#generating-key" title="Permalink to this headline">¶</a></h4>
<p>An implementation example is given in &#8220;<a class="reference internal" href="#dataaccessmybatis3howtousecreateone"><span>Registering a single Entity record</span></a>&#8221; for generating key (ID) in Service class.</p>
<p>However, MyBatis3 provides a mechanism for generating key in mapping file.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Cases wherein key generation functionality of MyBatis3 is used</strong></p>
<p class="last">When a database function (function or ID column etc.) is used for generating key,
it is recommended to use the mechanism of MyBatis3 key generation functionality.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>There are two kinds of methods for generating key.</p>
<ul class="simple">
<li>A method wherein the result obtained by calling the function etc. provided by database, is handled as the key</li>
<li>A method wherein the result obtained by calling ID column provided by database (IDENTITY type, AUTO_INCREMENT type etc.) + <code class="docutils literal"><span class="pre">Statement#getGeneratedKeys()</span></code> added by JDBC3.0 is handled as the key.</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Method wherein result obtained by calling the function etc. provided by database is handled as a key, is explained first.
In the example given below, H2 Database is used as the database.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.todo.TodoRepository&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&quot;create&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
<span class="hll">        <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;selectKey</span> <span class="na">keyProperty=</span><span class="s">&quot;todoId&quot;</span> <span class="na">resultType=</span><span class="s">&quot;string&quot;</span> <span class="na">order=</span><span class="s">&quot;BEFORE&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            /* (2) */
</span><span class="hll">            SELECT RANDOM_UUID()
</span><span class="hll">        <span class="nt">&lt;/selectKey&gt;</span>
</span>        INSERT INTO
            t_todo
        (
            todo_id,
            todo_title,
            finished,
            created_at,
            version
        )
        VALUES
        (
            #{todoId},
            #{todoTitle},
            #{finished},
            #{createdAt},
            #{version}
        )
    <span class="nt">&lt;/insert&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="11%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>-</td>
<td><p class="first">Implements the SQL to generate key in <code class="docutils literal"><span class="pre">selectKey</span></code> element.</p>
<p>In the above example, UUID is fetched by using the function provided by database.</p>
<p class="last">For details of <code class="docutils literal"><span class="pre">selectKey</span></code>,
refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/sqlmap-xml.html#insert_update_and_delete">MyBatis3 REFERENCE DOCUMENTATION (Mapper XML Files-insert, update and delete-)</a>&#8221;.</p>
</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>keyProperty</td>
<td><p class="first">Specifies the property name of Entity that stores fetched key value.</p>
<p class="last">In the above example, key that is generated in <code class="docutils literal"><span class="pre">todoId</span></code> property of Entity, is set.</p>
</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>resultType</td>
<td>Specifies the type of key value to be fetched by executing the SQL.</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>order</td>
<td><p class="first">Specifies the timing when the SQL for key generation (<code class="docutils literal"><span class="pre">BEFORE</span></code>or <code class="docutils literal"><span class="pre">AFTER</span></code>) is executed.</p>
<ul class="last simple">
<li>When <code class="docutils literal"><span class="pre">BEFORE</span></code> is specified, INSERT statement is executed after the results obtained by executing SQL specified in <code class="docutils literal"><span class="pre">selectKey</span></code> element are reflected in Entity.</li>
<li>When <code class="docutils literal"><span class="pre">AFTER</span></code> is specified, SQL specified in <code class="docutils literal"><span class="pre">selectKey</span></code> element is executed after executing INSERT statement and fetched value is reflected in Entity.</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>-</td>
<td><p class="first">Implement the SQL for generating key.</p>
<p class="last">In the above example, the function that generates UUID of H2 Database is called and key is generated.
Implementation wherein value fetched from sequence object is formatted in a string can be cited as the typical example of key generation.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Next, the method wherein result obtained by calling ID column provided by database + <code class="docutils literal"><span class="pre">Statement#getGeneratedKeys()</span></code> added by JDBC3.0ratedKeys() is handled as a key, is explained.
In the example given below, H2 Database is used as the database.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.audit.AuditLogRepository&quot;</span><span class="nt">&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&quot;create&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;Todo&quot;</span> <span class="na">useGeneratedKeys=</span><span class="s">&quot;true&quot;</span> <span class="na">keyProperty=</span><span class="s">&quot;logId&quot;</span><span class="nt">&gt;</span>
</span>        INSERT INTO
            t_audit_log
        (
            level,
            message,
            created_at,
        )
        VALUES
        (
            #{level},
            #{message},
            #{createdAt},
        )
    <span class="nt">&lt;/insert&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="11%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>useGeneratedKeys</td>
<td><p class="first">When <code class="docutils literal"><span class="pre">true</span></code> is specified, function that fetches key by calling ID column + <code class="docutils literal"><span class="pre">Statement#getGeneratedKeys()</span></code> can be used.</p>
<p class="last">For details of <code class="docutils literal"><span class="pre">useGeneratedKeys</span></code>,
refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/sqlmap-xml.html#insert_update_and_delete">MyBatis3 REFERENCE DOCUMENTATION (Mapper XML Files-insert, update and delete-)</a>&#8221;.</p>
</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>keyProperty</td>
<td><p class="first">Specify property name of the Entity that stores the key value which is automatically incremented in the database.</p>
<p class="last">In the above example, key value fetched by <code class="docutils literal"><span class="pre">Statement#getGeneratedKeys()</span></code> in <code class="docutils literal"><span class="pre">logId</span></code> property of Entity, is set after executing INSERT statement.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="batch-registration-of-entity">
<span id="dataaccessmybatis3howtousecreatemultiple"></span><h4><a class="toc-backref" href="#id61">5.2.2.7.3. Batch registration of Entity</a><a class="headerlink" href="#batch-registration-of-entity" title="Permalink to this headline">¶</a></h4>
<p>Implementation example for registering Entity in a batch is shown below.</p>
<p>The methods to perform batch registration of Entity are as given below.</p>
<ul class="simple">
<li>Execute INSERT statement that registers multiple records at the same time.</li>
<li>There is a method to use the JDBC batch update functionality</li>
</ul>
<p>Refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3howtoextendexecutortypebatch"><span>Using batch mode</span></a>&#8221; for details on how to use the JDBC batch update functionality.</p>
<p>How to execute the INSERT statement that registers multiple records at the same time, is explained below.
In the example below, H2 Database is used as the database.</p>
<ul class="simple">
<li>Defining the method in Repository interface.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.repository.todo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoRepository</span> <span class="o">{</span>

    <span class="c1">// (1)</span>
    <span class="kt">void</span> <span class="nf">createAll</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">todos</span><span class="o">);</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>In the above example, <code class="docutils literal"><span class="pre">createAll</span></code> method is defined as the method to perform batch registration for a list of Todo objects specified in the argument.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Define the SQL in mapping file.</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.todo.TodoRepository&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&quot;createAll&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;list&quot;</span><span class="nt">&gt;</span>
        INSERT INTO
            t_todo
        (
            todo_id,
            todo_title,
            finished,
            created_at,
            version
        )
        /* (2) */
        VALUES
        /* (3) */
        <span class="nt">&lt;foreach</span> <span class="na">collection=</span><span class="s">&quot;list&quot;</span> <span class="na">item=</span><span class="s">&quot;todo&quot;</span> <span class="na">separator=</span><span class="s">&quot;,&quot;</span><span class="nt">&gt;</span>
        (
            #{todo.todoId},
            #{todo.todoTitle},
            #{todo.finished},
            #{todo.createdAt},
            #{todo.version}
        )
        <span class="nt">&lt;/foreach&gt;</span>
    <span class="nt">&lt;/insert&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="11%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>-</td>
<td>Specifies the configuration value at the time of registering records in VALUE clause.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>-</td>
<td><p class="first">Repeats the process for the list of Todo objects passed as argument, by using <code class="docutils literal"><span class="pre">foreach</span></code> element.</p>
<p class="last">For details of <code class="docutils literal"><span class="pre">foreach</span></code> details,
refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/dynamic-sql.html#foreach">MyBatis3 REFERENCE DOCUMENTATION (Dynamic SQL-foreach-)</a>&#8221;.</p>
</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>collection</td>
<td><p class="first">Specifies the collection for processing.</p>
<p class="last">In the example given above, the process is repeated for the list of Repository method arguments.
When <code class="docutils literal"><span class="pre">&#64;Param</span></code> is not specified in the argument of Repository method, <code class="docutils literal"><span class="pre">&quot;list&quot;</span></code> is specified.
When <code class="docutils literal"><span class="pre">&#64;Param</span></code> is specified, the value specified in <code class="docutils literal"><span class="pre">value</span></code> attribute of <code class="docutils literal"><span class="pre">&#64;Param</span></code> is specified.</p>
</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>item</td>
<td><p class="first">Specifies the local variable name that retains one element from the list.</p>
<p class="last">JavaBean property can be accessed from the SQL in <code class="docutils literal"><span class="pre">foreach</span></code> element, in #{Local variable name.Property name} format.</p>
</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>separator</td>
<td><p class="first">Specifies the string to separate elements in the list.</p>
<p class="last">In the above example, by specifying <code class="docutils literal"><span class="pre">&quot;,&quot;</span></code>, the VALUE clause for each element is separated with <code class="docutils literal"><span class="pre">&quot;,&quot;</span></code>.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p></p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p>** Precautions when using SQL that registers multiple records at the same time**</p>
<p class="last">When SQL that registers multiple records concurrently is executed, &#8220;<a class="reference internal" href="#dataaccessmybatis3howtousegenid"><span>Generating key</span></a>&#8221; described earlier cannot be used.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Following SQL is generated and executed.</li>
</ul>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="k">INSERT</span> <span class="k">INTO</span>
    <span class="n">t_todo</span>
<span class="p">(</span>
    <span class="n">todo_id</span><span class="p">,</span>
    <span class="n">todo_title</span><span class="p">,</span>
    <span class="n">finished</span><span class="p">,</span>
    <span class="n">created_at</span><span class="p">,</span>
    <span class="k">version</span>
<span class="p">)</span>
<span class="k">VALUES</span>
<span class="p">(</span>
    <span class="s1">&#39;99243507-1b02-45b6-bfb6-d9b89f044e2d&#39;</span><span class="p">,</span>
    <span class="s1">&#39;todo title 1&#39;</span><span class="p">,</span>
    <span class="k">false</span><span class="p">,</span>
    <span class="s1">&#39;09/17/2014 23:59:59.999&#39;</span><span class="p">,</span>
    <span class="mi">1</span>
<span class="p">)</span>
<span class="p">,</span>
<span class="p">(</span>
    <span class="s1">&#39;66b096f1-791f-412f-9a0a-ee4a3a9186c2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;todo title 2&#39;</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;09/17/2014 23:59:59.999&#39;</span><span class="p">,</span>
    <span class="mi">1</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>The support status and syntax for the SQL that performs batch registration differ depending on database and version.
The links for reference pages of major databases are given below.</p>
<ul class="last simple">
<li><a class="reference external" href="http://docs.oracle.com/database/121/SQLRF/statements_9014.htm">Oracle 12c</a></li>
<li><a class="reference external" href="http://www-01.ibm.com/support/knowledgecenter/SSEPGG_10.5.0/com.ibm.db2.luw.sql.ref.doc/doc/r0000970.html">DB2 10.5</a></li>
<li><a class="reference external" href="http://www.postgresql.org/docs/9.3/static/sql-insert.html">PostgreSQL 9.3</a></li>
<li><a class="reference external" href="http://dev.mysql.com/doc/refman/5.7/en/insert.html">MySQL 5.7</a></li>
</ul>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="update-process-of-entity">
<span id="dataaccessmybatis3howtouseupdate"></span><h3><a class="toc-backref" href="#id62">5.2.2.8. Update process of Entity</a><a class="headerlink" href="#update-process-of-entity" title="Permalink to this headline">¶</a></h3>
<p>Entity update method for different purposes is explained with implementation example.</p>
<div class="section" id="updating-a-single-entity">
<span id="dataaccessmybatis3howtouseupdateone"></span><h4><a class="toc-backref" href="#id63">5.2.2.8.1. Updating a single Entity</a><a class="headerlink" href="#updating-a-single-entity" title="Permalink to this headline">¶</a></h4>
<p>Implementation example for updating a single Entity is given below.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Hereafter, an implementation example is explained wherein optimistic locking is performed by using version column.
However, process related to optimistic locking need not be performed when optimistic locking is not required.</p>
<p class="last">Refer to &#8220;<a class="reference internal" href="ExclusionControl.html"><em>Exclusive Control</em></a> for details of exclusive control.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Defining the method in Repository interface.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.repository.todo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoRepository</span> <span class="o">{</span>

    <span class="c1">// (1)</span>
    <span class="kt">boolean</span> <span class="nf">update</span><span class="o">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="o">);</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>In the above example, <code class="docutils literal"><span class="pre">update</span></code> method is defined as the method to update single Todo object specified in the argument.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p></p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Return value of the method that updates a single Entity</strong></p>
<p>The return value of the method that updates single Entity can be <code class="docutils literal"><span class="pre">boolean</span></code>.</p>
<p>However, when multiple records are obtained as update result and it is necessary to handle it as data mismatch error,
numeric value type (<code class="docutils literal"><span class="pre">int</span></code> or <code class="docutils literal"><span class="pre">long</span></code>) needs to be specified as return value and it needs to be checked that a single update record exists.
When main key is used as the update condition, return value can be set as <code class="docutils literal"><span class="pre">boolean</span></code> since multiple records are not obtained as update result.</p>
<ul class="last simple">
<li>When <code class="docutils literal"><span class="pre">boolean</span></code> is specified as return value, <code class="docutils literal"><span class="pre">false</span></code> is returned when update records are 0 and <code class="docutils literal"><span class="pre">true</span></code>is returned when update records are 1 or more.</li>
<li>When numeric value is specified as return value, number of update records is returned.</li>
</ul>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Defining SQL in mapping file.</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.todo.TodoRepository&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;update</span> <span class="na">id=</span><span class="s">&quot;update&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
        UPDATE
            t_todo
        SET
            todo_title = #{todoTitle},
            finished = #{finished},
            version = version + 1
        WHERE
            todo_id = #{todoId}
        AND
            version = #{version}
    <span class="nt">&lt;/update&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Implement the UPDATE SQL in <code class="docutils literal"><span class="pre">update</span></code> element.</p>
<p>Specify the method name defined in Repository interface, in <code class="docutils literal"><span class="pre">id</span></code> attribute.</p>
<p>For details of <code class="docutils literal"><span class="pre">update</span></code> element,
refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/sqlmap-xml.html#insert_update_and_delete">MyBatis3 REFERENCE DOCUMENTATION (Mapper XML Files-insert, update and delete-)</a>&#8221;.</p>
<p class="last">The value to be bound in SET clause and WHERE clause is specified as the bind variable with #{variableName} format.
In the above example, since a JavaBean (<code class="docutils literal"><span class="pre">Todo</span></code>) is specified as argument of Repository interface,
JavaBean property name is specified in the bind variable name.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Apply DI to Repository in Service class and call Repository interface method.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.service.todo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.domain.repository.todo.TodoRepository</span><span class="o">;</span>

<span class="nd">@Transactional</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoServiceImpl</span> <span class="kd">implements</span> <span class="n">TodoService</span> <span class="o">{</span>

    <span class="c1">// (3)</span>
    <span class="nd">@Inject</span>
    <span class="n">TodoRepository</span> <span class="n">todoRepository</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Todo</span> <span class="nf">update</span><span class="o">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// (4)</span>
        <span class="n">Todo</span> <span class="n">currentTodo</span> <span class="o">=</span> <span class="n">todoRepository</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">todo</span><span class="o">.</span><span class="na">getTodoId</span><span class="o">());</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">currentTodo</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">currentTodo</span><span class="o">.</span><span class="na">getVersion</span><span class="o">()</span> <span class="o">!=</span> <span class="n">todo</span><span class="o">.</span><span class="na">getVersion</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">ObjectOptimisticLockingFailureException</span><span class="o">(</span><span class="n">Todo</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">todo</span>
                    <span class="o">.</span><span class="na">getTodoId</span><span class="o">());</span>
        <span class="o">}</span>

        <span class="c1">// (5)</span>
        <span class="n">currentTodo</span><span class="o">.</span><span class="na">setTodoTitle</span><span class="o">(</span><span class="n">todo</span><span class="o">.</span><span class="na">getTodoTitle</span><span class="o">());</span>
        <span class="n">currentTodo</span><span class="o">.</span><span class="na">setFinished</span><span class="o">(</span><span class="n">todo</span><span class="o">.</span><span class="na">isFinished</span><span class="o">());</span>

        <span class="c1">// (6)</span>
        <span class="kt">boolean</span> <span class="n">updated</span> <span class="o">=</span> <span class="n">todoRepository</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">currentTodo</span><span class="o">);</span>
        <span class="c1">// (7)</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">updated</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">ObjectOptimisticLockingFailureException</span><span class="o">(</span><span class="n">Todo</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
                    <span class="n">currentTodo</span><span class="o">.</span><span class="na">getTodoId</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="n">currentTodo</span><span class="o">.</span><span class="na">setVersion</span><span class="o">(</span><span class="n">todo</span><span class="o">.</span><span class="na">getVersion</span><span class="o">()</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">currentTodo</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>Apply DI to Repository interface in Service class.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td><p class="first">Fetch the Entity to be updated from database.</p>
<p class="last">In the above example, when Entity is updated (records are deleted or version is updated),
optimistic locking exception (<code class="docutils literal"><span class="pre">org.springframework.orm.ObjectOptimisticLockingFailureException</span></code>) provided by Spring Framework is generated.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td><p class="first">Reflect update details for the Entity to be updated.</p>
<p class="last">In the above example, &#8220;Title&#8221; and &#8220;Complete flag&#8221; are reflected. When there are few update items, the process can be performed as per the implementation example given above.
However, when update items are more in number, it is recommended to use &#8220;<a class="reference internal" href="Utilities/Dozer.html"><em>Bean Mapping (Dozer)</em></a>&#8221;.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td>Call the Repository interface method and update single Entity record.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="7">
<li></li>
</ol>
</td>
<td><p class="first">Determine update results of Entity.</p>
<p class="last">In the above example, when Entity is not updated (records are deleted or version is updated),
optimistic locking exception (<code class="docutils literal"><span class="pre">org.springframework.orm.ObjectOptimisticLockingFailureException</span></code>) provided by Spring Framework is generated.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>In the above example, when update process is successful,</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="n">currentTodo</span><span class="o">.</span><span class="na">setVersion</span><span class="o">(</span><span class="n">todo</span><span class="o">.</span><span class="na">getVersion</span><span class="o">()</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
</pre></div>
</div>
</div></blockquote>
<p>is obtained.</p>
<p>It is a process to combine the version updated in database and the version that stores an Entity.</p>
<p class="last">If database status and Entity status are not matched when referring a version in the call source (Controller or JSP etc.) process,
data mismatch may occur and application is not executed as anticipated.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="batch-update-of-entity">
<span id="dataaccessmybatis3howtouseupdatemultiple"></span><h4><a class="toc-backref" href="#id64">5.2.2.8.2. Batch update of Entity</a><a class="headerlink" href="#batch-update-of-entity" title="Permalink to this headline">¶</a></h4>
<p>Implementation example wherein Entity is updated in batch is given below.</p>
<p>The methods to update Entity in batch are as below.</p>
<ul class="simple">
<li>Execute UPDATE statement that updates multiple records simultaneously</li>
<li>Use JDBC batch update functionality</li>
</ul>
<p>Refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3howtoextendexecutortypebatch"><span>Using batch mode</span></a>&#8221; for the details on how to use the JDBC batch update functionality.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>How to execute UPDATE statement that concurrently updates multiple records is explained here.</p>
<ul class="simple">
<li>Defining the method in Repository interface.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.repository.todo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.ibatis.annotations.Param</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoRepository</span> <span class="o">{</span>

    <span class="c1">// (1)</span>
    <span class="kt">int</span> <span class="nf">updateFinishedByTodIds</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;finished&quot;</span><span class="o">)</span> <span class="kt">boolean</span> <span class="n">finished</span><span class="o">,</span>
                               <span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;todoIds&quot;</span><span class="o">)</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">todoIds</span><span class="o">);</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>In the above example, <code class="docutils literal"><span class="pre">updateFinishedByTodIds</span></code> method is defined as the method to update <code class="docutils literal"><span class="pre">finished</span></code> column of the records corresponding to list of IDs specified in the argument.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Return value for the method that updates Entity in batch</strong></p>
<p class="last">Return value of the method that updates Entity in batch should preferably be of numeric type (<code class="docutils literal"><span class="pre">int</span></code> or <code class="docutils literal"><span class="pre">long</span></code>).
When it is set as numeric type return value, number of updated records can be fetched.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Defining the SQL in mapping file.</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.todo.TodoRepository&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;update</span> <span class="na">id=</span><span class="s">&quot;updateFinishedByTodIds&quot;</span><span class="nt">&gt;</span>
        UPDATE
            t_todo
        SET
            finished = #{finished},
            /* (2) */
            version = version + 1
        WHERE
            /* (3) */
            <span class="nt">&lt;foreach</span> <span class="na">item=</span><span class="s">&quot;todoId&quot;</span> <span class="na">collection=</span><span class="s">&quot;todoIds&quot;</span>
                     <span class="na">open=</span><span class="s">&quot;todo_id IN (&quot;</span> <span class="na">separator=</span><span class="s">&quot;,&quot;</span> <span class="na">close=</span><span class="s">&quot;)&quot;</span><span class="nt">&gt;</span>
                #{todoId}
            <span class="nt">&lt;/foreach&gt;</span>
    <span class="nt">&lt;/update&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="11%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>-</td>
<td><p class="first">Updates version column when an optimistic locking is applied using a version column.</p>
<p class="last">If the version is not updated, optimistic locking control does not operate properly.
Refer to &#8220;<a class="reference internal" href="ExclusionControl.html"><em>Exclusive Control</em></a>&#8221; for details of exclusive control.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>-</td>
<td>Specifies the update conditions for updating multiple records in WHERE clause.</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>-</td>
<td><p class="first">Repeats process for the list of IDs passed by argument, using <code class="docutils literal"><span class="pre">foreach</span></code> element.</p>
<p>In the above example, IN clause is generated from the list of IDs passed by argument.</p>
<p class="last">Refer &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/dynamic-sql.html#foreach">MyBatis3 REFERENCE DOCUMENTATION (Dynamic SQL-foreach-)</a>&#8221;  for details of <code class="docutils literal"><span class="pre">foreach</span></code>.</p>
</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>collection</td>
<td><p class="first">Specify collection for a process.</p>
<p class="last">In the above example, the process is repeated for a list of IDs (<code class="docutils literal"><span class="pre">todoIds</span></code>) of Repository method arguments.</p>
</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>item</td>
<td>Specify local variable name that retains 1 element in the list.</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>separator</td>
<td><p class="first">Specify the string for separating elements in the list.</p>
<p class="last">In the above example, <code class="docutils literal"><span class="pre">&quot;,&quot;</span></code>,  which is the separator character of IN clause, is specified.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="delete-process-for-entity">
<span id="dataaccessmybatis3howtousedelete"></span><h3><a class="toc-backref" href="#id65">5.2.2.9. Delete process for Entity</a><a class="headerlink" href="#delete-process-for-entity" title="Permalink to this headline">¶</a></h3>
<div class="section" id="deleting-a-single-entity">
<span id="dataaccessmybatis3howtousedeleteone"></span><h4><a class="toc-backref" href="#id66">5.2.2.9.1. Deleting a single Entity</a><a class="headerlink" href="#deleting-a-single-entity" title="Permalink to this headline">¶</a></h4>
<p>Implementation example for deleting a single Entity is given below.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Explanation hereafter shows an implementation example wherein an optimistic locking is performed by using version column.
However, it is not necessary to perform the processes related to optimistic locking when optimistic locking is not required.</p>
<p class="last">Refer to &#8220;<a class="reference internal" href="ExclusionControl.html"><em>Exclusive Control</em></a>&#8221; for details of exclusive control.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Defining method in Repository interface.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.repository.todo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoRepository</span> <span class="o">{</span>

    <span class="c1">// (1)</span>
    <span class="kt">boolean</span> <span class="nf">delete</span><span class="o">(</span><span class="n">Todo</span> <span class="n">todo</span><span class="o">);</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>In the above example, <code class="docutils literal"><span class="pre">delete</span></code> method is defined as the method to delete single Todo object specified in the argument.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>** Return value for the method that deletes a single Entity**</p>
<p>The return value of the method that deletes a single Entity can be <code class="docutils literal"><span class="pre">boolean</span></code>.</p>
<p>However, when the return value is to be handled as a data mismatch error due to multiple deletion results,
it is necessary to set numeric value type (<code class="docutils literal"><span class="pre">int</span></code> or <code class="docutils literal"><span class="pre">long</span></code>) as the return value and to check whether a single deletion record exists.
When main key is used as the delete condition, return value can be set to <code class="docutils literal"><span class="pre">boolean</span></code> since, multiple deleted records are not obtained.</p>
<ul class="last simple">
<li>When <code class="docutils literal"><span class="pre">boolean</span></code> is specified as return value, <code class="docutils literal"><span class="pre">false</span></code>is returned when deleted records are 0 and <code class="docutils literal"><span class="pre">true</span></code> is returned when deleted records are 1 or more.</li>
<li>When numeric value type is specified as a return value, the number of deleted records is returned.</li>
</ul>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Defining a SQL in mapping file.</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.todo.TodoRepository&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;delete</span> <span class="na">id=</span><span class="s">&quot;delete&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
        DELETE FROM
            t_todo
        WHERE
            todo_id = #{todoId}
        AND
            version = #{version}
    <span class="nt">&lt;/delete&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Implement DELETE SQL in <code class="docutils literal"><span class="pre">delete</span></code> element.</p>
<p>Specify method name for the method defined in Repository interface, in <code class="docutils literal"><span class="pre">id</span></code> attribute.</p>
<p>Refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/sqlmap-xml.html#insert_update_and_delete">MyBatis3 REFERENCE DOCUMENTATION (Mapper XML Files-insert, update and delete-)</a>&#8221; for details of <code class="docutils literal"><span class="pre">delete</span></code> element.</p>
<p class="last">The value to be bound in WHERE clause is specified as a bind variable of #{variableName} format.
In the above example, JavaBean property name is specified in the bind variable name since a JavaBean (<code class="docutils literal"><span class="pre">Todo</span></code>) is specified as argument of Repository interface.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Apply DI to the Repository in Service class and call the method for Repository interface.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.service.todo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.domain.repository.todo.TodoRepository</span><span class="o">;</span>

<span class="nd">@Transactional</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoServiceImpl</span> <span class="kd">implements</span> <span class="n">TodoService</span> <span class="o">{</span>

    <span class="c1">// (3)</span>
    <span class="nd">@Inject</span>
    <span class="n">TodoRepository</span> <span class="n">todoRepository</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Todo</span> <span class="nf">delete</span><span class="o">(</span><span class="n">String</span> <span class="n">todoId</span><span class="o">,</span> <span class="kt">long</span> <span class="n">version</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// (4)</span>
        <span class="n">Todo</span> <span class="n">currentTodo</span> <span class="o">=</span> <span class="n">todoRepository</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">todoId</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">currentTodo</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">currentTodo</span><span class="o">.</span><span class="na">getVersion</span><span class="o">()</span> <span class="o">!=</span> <span class="n">version</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">ObjectOptimisticLockingFailureException</span><span class="o">(</span><span class="n">Todo</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">todoId</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// (5)</span>
        <span class="kt">boolean</span> <span class="n">deleted</span> <span class="o">=</span> <span class="n">todoRepository</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">currentTodo</span><span class="o">);</span>
        <span class="c1">// (6)</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">deleted</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">ObjectOptimisticLockingFailureException</span><span class="o">(</span><span class="n">Todo</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
                    <span class="n">currentTodo</span><span class="o">.</span><span class="na">getTodoId</span><span class="o">());</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">currentTodo</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>Apply DI to Repository interface in Service class.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td><p class="first">Fetch the Entity to be deleted from database.</p>
<p class="last">In the above example, when Entity is updated (records are deleted or version is updated),
optimistic locking exception (<code class="docutils literal"><span class="pre">org.springframework.orm.ObjectOptimisticLockingFailureException</span></code>) provided by Spring Framework is generated.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td>Call Repository interface method and delete a single Entity.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td><p class="first">Determine the deletion result of Entity.</p>
<p class="last">In the above example, when Entity is not deleted (records are deleted or version is updated)
optimistic locking exception (<code class="docutils literal"><span class="pre">org.springframework.orm.ObjectOptimisticLockingFailureException</span></code>) provided by Spring Framework is generated.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="batch-deletion-of-entity">
<span id="dataaccessmybatis3howtousedeletemultiple"></span><h4><a class="toc-backref" href="#id67">5.2.2.9.2. Batch deletion of Entity</a><a class="headerlink" href="#batch-deletion-of-entity" title="Permalink to this headline">¶</a></h4>
<p>Implementation example wherein Entity is deleted in batch is given below.</p>
<p>The methods to delete Entity in batch are as given below.</p>
<ul class="simple">
<li>Execute a DELETE statement that concurrently deletes multiple records</li>
<li>Use JDBC batch update functionality</li>
</ul>
<p>Refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3howtoextendexecutortypebatch"><span>Using batch mode</span></a>&#8221; for how to use JDBC batch update functionality.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The method to execute DELETE statement that concurrently deletes multiple records, is explained below.</p>
<ul class="simple">
<li>Defining method in Repository interface.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.repository.todo</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoRepository</span> <span class="o">{</span>

    <span class="c1">// (1)</span>
    <span class="kt">int</span> <span class="nf">deleteOlderFinishedTodo</span><span class="o">(</span><span class="n">Date</span> <span class="n">criteriaDate</span><span class="o">);</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>In the above example, <code class="docutils literal"><span class="pre">deleteOlderFinishedTodo</span></code> method is defined as the method to delete finished records that were created prior to the standard date.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Return value for the method that deletes Entity in batch</strong></p>
<p class="last">Return value for the method that deletes Entity in batch can be numeric value type (<code class="docutils literal"><span class="pre">int</span></code>or <code class="docutils literal"><span class="pre">long</span></code>).
When the return value is of numeric type, number of deleted records can be fetched.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Defining SQL in mapping file.</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.todo.TodoRepository&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;delete</span> <span class="na">id=</span><span class="s">&quot;deleteOlderFinishedTodo&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;date&quot;</span><span class="nt">&gt;</span>
        <span class="cp">&lt;![CDATA[</span>
<span class="cp">        DELETE FROM</span>
<span class="cp">            t_todo</span>
<span class="cp">        /* (2) */</span>
<span class="cp">        WHERE</span>
<span class="cp">            finished = TRUE</span>
<span class="cp">        AND</span>
<span class="cp">            created_at  &lt; #{criteriaDate}</span>
<span class="cp">        ]]&gt;</span>
    <span class="nt">&lt;/delete&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p class="first">Specify delete conditions for updating multiple records in WHERE clause.</p>
<p>In the above example,</p>
<ul class="simple">
<li>Finished (<code class="docutils literal"><span class="pre">finished</span></code> is <code class="docutils literal"><span class="pre">TRUE</span></code>)</li>
<li>Created before standard date (<code class="docutils literal"><span class="pre">created_at</span></code> before standard date)</li>
</ul>
<p class="last">are specified as delete conditions.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="implementing-dynamic-sql">
<span id="dataaccessmybatis3howtousedynamicsql"></span><h3><a class="toc-backref" href="#id68">5.2.2.10. Implementing dynamic SQL</a><a class="headerlink" href="#implementing-dynamic-sql" title="Permalink to this headline">¶</a></h3>
<p>An implementation example wherein dynamic SQL is built, is given below.</p>
<p>MyBatis3 provides a mechanism through which dynamic SQL is built by using OGNL base expression (Expression language) and XML elements for building dynamic SQL.</p>
<p>Refer to &#8220;MyBatis3 REFERENCE DOCUMENTATION (Dynamic SQL) &lt;<a class="reference external" href="http://mybatis.github.io/mybatis-3/dynamic-sql.html">http://mybatis.github.io/mybatis-3/dynamic-sql.html</a>&gt;`_&#8221; for details of dynamic SQL.</p>
<p>MyBatis3 provides following XML elements for building a dynamic SQL.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="11%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Element name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">if</span></code></td>
<td>Element that builds SQL only when it matches with the condition.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">choose</span></code></td>
<td>Element that builds SQL by selecting one of the options from multiple options, that matches with the condition.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">where</span></code></td>
<td>Element that assigns or removes prefix and suffix for the built WHERE clause.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">set</span></code></td>
<td>Element that assigns or removes prefix or suffix for the built SET clause.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">foreach</span></code></td>
<td>Element that repeats a process for a collection or an array</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">bind</span></code></td>
<td><p class="first">Element that stores the results of OGNL expression in the variable.</p>
<p class="last">Variable stored by using <code class="docutils literal"><span class="pre">bind</span></code> variable can be referred in SQL.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Although it is not given in the list, <code class="docutils literal"><span class="pre">trim</span></code> element is provided as the XML element for building dynamic SQL.</p>
<p><code class="docutils literal"><span class="pre">trim</span></code> element is a more generalized XML element as compared to <code class="docutils literal"><span class="pre">where</span></code> element and <code class="docutils literal"><span class="pre">set</span></code> element.</p>
<p class="last">In most of the cases, <code class="docutils literal"><span class="pre">where</span></code> element and <code class="docutils literal"><span class="pre">set</span></code> element can meet the requirements. Hence, description of <code class="docutils literal"><span class="pre">trim</span></code> element is omitted in this guideline.
Refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/dynamic-sql.html#trim_where_set">MyBatis3 REFERENCE DOCUMENTATION (Dynamic SQL-trim, where, set-)</a>&#8221; when it is necessary to use <code class="docutils literal"><span class="pre">trim</span></code> element.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="implementation-of-if-element">
<h4><a class="toc-backref" href="#id69">5.2.2.10.1. Implementation of if element</a><a class="headerlink" href="#implementation-of-if-element" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">if</span></code> element is the XML element that builds SQL only when it matches with specified conditions.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findAllByCriteria&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;TodoCriteria&quot;</span> <span class="na">resultType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
    SELECT
        todo_id,
        todo_title,
        finished,
        created_at,
        version
    FROM
        t_todo
    WHERE
        todo_title LIKE #{todoTitle} || &#39;%&#39; ESCAPE &#39;~&#39;
    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&quot;finished != null&quot;</span><span class="nt">&gt;</span>
        AND
            finished = #{finished}
    <span class="nt">&lt;/if&gt;</span>
    ORDER BY
        todo_id
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Specify the condition in <code class="docutils literal"><span class="pre">test</span></code> attribute of <code class="docutils literal"><span class="pre">if</span></code> element.</p>
<p class="last">In the above example, when <code class="docutils literal"><span class="pre">finished</span></code> is specified as the search condition, conditions for <code class="docutils literal"><span class="pre">finished</span></code> column are added to SQL.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>SQL (WHERE clause) generated by dynamic SQL described above consists of 2 patterns.</p>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- (1) finished == null</span>
<span class="p">...</span>
<span class="k">WHERE</span>
    <span class="n">todo_title</span> <span class="k">LIKE</span> <span class="o">?</span> <span class="o">||</span> <span class="s1">&#39;%&#39;</span> <span class="k">ESCAPE</span> <span class="s1">&#39;~&#39;</span>
<span class="k">ORDER</span> <span class="k">BY</span>
    <span class="n">todo_id</span>
</pre></div>
</div>
<div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- (2) finished != null</span>
<span class="p">...</span>
<span class="k">WHERE</span>
    <span class="n">todo_title</span> <span class="k">LIKE</span> <span class="o">?</span> <span class="o">||</span> <span class="s1">&#39;%&#39;</span> <span class="k">ESCAPE</span> <span class="s1">&#39;~&#39;</span>
<span class="k">AND</span>
    <span class="n">finished</span> <span class="o">=</span> <span class="o">?</span>
<span class="k">ORDER</span> <span class="k">BY</span>
    <span class="n">todo_id</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="implementation-of-choose-element">
<h4><a class="toc-backref" href="#id70">5.2.2.10.2. Implementation of choose element</a><a class="headerlink" href="#implementation-of-choose-element" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">choose</span></code> element is the XML element for building SQL by selecting one option that matches the condition from a set of conditions.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findAllByCriteria&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;TodoCriteria&quot;</span> <span class="na">resultType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
    SELECT
        todo_id,
        todo_title,
        finished,
        created_at,
        version
    FROM
        t_todo
    WHERE
        todo_title LIKE #{todoTitle} || &#39;%&#39; ESCAPE &#39;~&#39;
    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;choose&gt;</span>
        <span class="c">&lt;!-- (2) --&gt;</span>
        <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">&quot;createdAt != null&quot;</span><span class="nt">&gt;</span>
            AND
                created_at <span class="cp">&lt;![CDATA[ &gt; ]]&gt;</span> #{createdAt}
        <span class="nt">&lt;/when&gt;</span>
        <span class="c">&lt;!-- (3) --&gt;</span>
        <span class="nt">&lt;otherwise&gt;</span>
            AND
                created_at <span class="cp">&lt;![CDATA[ &gt; ]]&gt;</span> CURRENT_DATE
        <span class="nt">&lt;/otherwise&gt;</span>
    <span class="nt">&lt;/choose&gt;</span>
    ORDER BY
        todo_id
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Specify the condition to build SQL by specifying <code class="docutils literal"><span class="pre">when</span></code> element and <code class="docutils literal"><span class="pre">otherwise</span></code> element in <code class="docutils literal"><span class="pre">choose</span></code> element.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Specify the condition in <code class="docutils literal"><span class="pre">test</span></code> attribute of <code class="docutils literal"><span class="pre">when</span></code> element.</p>
<p class="last">In the above example, when <code class="docutils literal"><span class="pre">createdAt</span></code> is specified as a search condition,
a condition wherein, values of <code class="docutils literal"><span class="pre">create_at</span></code>column extract the records after the specified date, is added to SQL.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p class="first">Specify all the SQLs in ``otherwise`` element that are built when the conditions do not match with <code class="docutils literal"><span class="pre">when</span></code> element .</p>
<p class="last">In the above example, the condition wherein <code class="docutils literal"><span class="pre">create_at</span></code> column values extract the records after the current date (records that are created on that day) is added to SQL.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>SQL (WHERE clause) that is generated by dynamic SQL described above consists of 2 patterns.</p>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- (1) createdAt!=null</span>
<span class="p">...</span>
<span class="k">WHERE</span>
    <span class="n">todo_title</span> <span class="k">LIKE</span> <span class="o">?</span> <span class="o">||</span> <span class="s1">&#39;%&#39;</span> <span class="k">ESCAPE</span> <span class="s1">&#39;~&#39;</span>
<span class="k">AND</span>
    <span class="n">created_at</span>   <span class="o">&gt;</span>   <span class="o">?</span>
<span class="k">ORDER</span> <span class="k">BY</span>
    <span class="n">todo_id</span>
</pre></div>
</div>
<div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- (2) createdAt==null</span>
<span class="p">...</span>
<span class="k">WHERE</span>
    <span class="n">todo_title</span> <span class="k">LIKE</span> <span class="o">?</span> <span class="o">||</span> <span class="s1">&#39;%&#39;</span> <span class="k">ESCAPE</span> <span class="s1">&#39;~&#39;</span>
<span class="k">AND</span>
    <span class="n">created_at</span> <span class="o">&gt;</span> <span class="k">CURRENT_DATE</span>
<span class="k">ORDER</span> <span class="k">BY</span>
    <span class="n">todo_id</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="implementation-of-where-element">
<h4><a class="toc-backref" href="#id71">5.2.2.10.3. Implementation of where element</a><a class="headerlink" href="#implementation-of-where-element" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">where</span></code> element is the XML element for dynamically generating WHERE clause.</p>
<p>When <code class="docutils literal"><span class="pre">where</span></code> element is used,</p>
<ul class="simple">
<li>Assigning WHERE clause</li>
<li>Removal of AND clause and OR clause</li>
</ul>
<p>are performed. Hence, WHERE clause can be built easily.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findAllByCriteria2&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;TodoCriteria&quot;</span> <span class="na">resultType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
    SELECT
        todo_id,
        todo_title,
        finished,
        created_at,
        version
    FROM
        t_todo
    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;where&gt;</span>
        <span class="c">&lt;!-- (2) --&gt;</span>
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&quot;finished != null&quot;</span><span class="nt">&gt;</span>
            AND
                finished = #{finished}
        <span class="nt">&lt;/if&gt;</span>
        <span class="c">&lt;!-- (3) --&gt;</span>
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&quot;createdAt != null&quot;</span><span class="nt">&gt;</span>
            AND
                created_at <span class="cp">&lt;![CDATA[ &gt; ]]&gt;</span> #{createdAt}
        <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;/where&gt;</span>
    ORDER BY
        todo_id
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Implement the dynamic SQL for building WHERE clause in <code class="docutils literal"><span class="pre">where</span></code> element.</p>
<p class="last">According to the SQL built in <code class="docutils literal"><span class="pre">where</span></code> element, processes such as assigning WHERE clause, removing AND clause and OR clause etc. can be performed.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Build dynamic SQL.</p>
<p class="last">In the above example, when <code class="docutils literal"><span class="pre">finished</span></code> is specified as a search condition,
the condition for <code class="docutils literal"><span class="pre">finished</span></code> column is added to SQL.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p class="first">Build dynamic SQL.</p>
<p class="last">In the above example, when <code class="docutils literal"><span class="pre">createdAt</span></code> is specified as a search condition,
the condition for <code class="docutils literal"><span class="pre">created_at</span></code> column is added to SQL.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The SQL (WHERE clause) that is generated by dynamic SQL described above consists of 4 patterns as given below.</p>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- (1) finished != null &amp;&amp; createdAt != null</span>
<span class="p">...</span>
<span class="k">FROM</span>
    <span class="n">t_todo</span>
<span class="k">WHERE</span>
    <span class="n">finished</span> <span class="o">=</span> <span class="o">?</span>
<span class="k">AND</span>
    <span class="n">created_at</span>  <span class="o">&gt;</span>  <span class="o">?</span>
<span class="k">ORDER</span> <span class="k">BY</span>
    <span class="n">todo_id</span>
</pre></div>
</div>
<div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- (2) finished != null &amp;&amp; createdAt == null</span>
<span class="p">...</span>
<span class="k">FROM</span>
    <span class="n">t_todo</span>
<span class="k">WHERE</span>
    <span class="n">finished</span> <span class="o">=</span> <span class="o">?</span>
<span class="k">ORDER</span> <span class="k">BY</span>
    <span class="n">todo_id</span>
</pre></div>
</div>
<div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- (3) finished == null &amp;&amp; createdAt != null</span>
<span class="p">...</span>
<span class="k">FROM</span>
    <span class="n">t_todo</span>
<span class="k">WHERE</span>
    <span class="n">created_at</span>  <span class="o">&gt;</span>  <span class="o">?</span>
<span class="k">ORDER</span> <span class="k">BY</span>
    <span class="n">todo_id</span>
</pre></div>
</div>
<div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- (4) finished == null &amp;&amp; createdAt == null</span>
<span class="p">...</span>
<span class="k">FROM</span>
    <span class="n">t_todo</span>
<span class="k">ORDER</span> <span class="k">BY</span>
    <span class="n">todo_id</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="implementation-example-for-set-element">
<h4><a class="toc-backref" href="#id72">5.2.2.10.4. Implementation example for set element</a><a class="headerlink" href="#implementation-example-for-set-element" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">set</span></code> element is the XML element for automatically generating SET clause.</p>
<p>When <code class="docutils literal"><span class="pre">set</span></code> element is used,</p>
<ul class="simple">
<li>Assigning SET clause</li>
<li>Removal of comma at the end</li>
</ul>
<p>are performed. Hence SET clause can be easily built.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;update</span> <span class="na">id=</span><span class="s">&quot;update&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
    UPDATE
        t_todo
    <span class="c">&lt;!-- (1)  --&gt;</span>
    <span class="nt">&lt;set&gt;</span>
        version = version + 1,
        <span class="c">&lt;!-- (2) --&gt;</span>
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&quot;todoTitle != null&quot;</span><span class="nt">&gt;</span>
            todo_title = #{todoTitle}
        <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;/set&gt;</span>
    WHERE
        todo_id = #{todoId}
<span class="nt">&lt;/update&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Implement the dynamic SQL to build SET clause in <code class="docutils literal"><span class="pre">set</span></code> element.</p>
<p class="last">Assigning SET clause and removal of comma at the end is performed according to the SQL that is built in <code class="docutils literal"><span class="pre">set</span></code> element.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Build a dynamic SQL.</p>
<p class="last">In the above example, when <code class="docutils literal"><span class="pre">todoTitle</span></code> is specified as an update item,
<code class="docutils literal"><span class="pre">todo_title</span></code> column is added to SQL as an update column.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>SQL generated by dynamic SQL described above consists of 2 patterns as below.</p>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- (1) todoTitle != null</span>
<span class="k">UPDATE</span>
    <span class="n">t_todo</span>
<span class="k">SET</span>
    <span class="k">version</span> <span class="o">=</span> <span class="k">version</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">todo_title</span> <span class="o">=</span> <span class="o">?</span>
<span class="k">WHERE</span>
    <span class="n">todo_id</span> <span class="o">=</span> <span class="o">?</span>
</pre></div>
</div>
<div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- (2) todoTitle == null</span>
<span class="k">UPDATE</span>
    <span class="n">t_todo</span>
<span class="k">SET</span>
   <span class="k">version</span> <span class="o">=</span> <span class="k">version</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">WHERE</span>
    <span class="n">todo_id</span> <span class="o">=</span> <span class="o">?</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="implementation-example-of-foreach-element">
<h4><a class="toc-backref" href="#id73">5.2.2.10.5. Implementation example of foreach element</a><a class="headerlink" href="#implementation-example-of-foreach-element" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">foreach</span></code> element is the XML element for repeating a process for a collection or an array.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findAllByCreatedAtList&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;list&quot;</span> <span class="na">resultType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
    SELECT
        todo_id,
        todo_title,
        finished,
        created_at,
        version
    FROM
        t_todo
    <span class="nt">&lt;where&gt;</span>
        <span class="c">&lt;!-- (1) --&gt;</span>
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&quot;list != null&quot;</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- (2) --&gt;</span>
            <span class="nt">&lt;foreach</span> <span class="na">collection=</span><span class="s">&quot;list&quot;</span> <span class="na">item=</span><span class="s">&quot;date&quot;</span> <span class="na">separator=</span><span class="s">&quot;OR&quot;</span><span class="nt">&gt;</span>
            <span class="cp">&lt;![CDATA[</span>
<span class="cp">                (created_at &gt;= #{date} AND created_at &lt; DATEADD(&#39;DAY&#39;, 1, #{date}))</span>
<span class="cp">            ]]&gt;</span>
            <span class="nt">&lt;/foreach&gt;</span>
        <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;/where&gt;</span>
    ORDER BY
        todo_id
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="17%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>-</td>
<td><p class="first">Performs <code class="docutils literal"><span class="pre">null</span></code> check for the collection or array for which process is repeated.</p>
<p class="last">Null check is not necessary when <code class="docutils literal"><span class="pre">null</span></code> value is not obtained.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>-</td>
<td><p class="first">Repeat the process for the collection or array and build the dynamic SQL, by using <code class="docutils literal"><span class="pre">foreach</span></code> element.</p>
<p class="last">In the above example, WHERE clause is built for searching the record wherein date of record creation matches with any of the specified dates (date list).</p>
</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>collection</td>
<td><p class="first">Specify the collection or array for which a process is repeated, in <code class="docutils literal"><span class="pre">collection</span></code> attribute.</p>
<p class="last">In the above example, collection specified in the Repository method argument is specified.</p>
</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>item</td>
<td><p class="first">Specify the local variable name that retains one element in the list, in <code class="docutils literal"><span class="pre">item</span></code> attribute.</p>
<p class="last">In the above example, since the date list is specified in <code class="docutils literal"><span class="pre">collection</span></code> attribute,
variable name called <code class="docutils literal"><span class="pre">date</span></code> is specified.</p>
</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>separator</td>
<td><p class="first">Specify the separator string between elements in <code class="docutils literal"><span class="pre">separator</span></code> attribute.</p>
<p class="last">In the above example, WHERE clause of OR condition is built.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><code class="docutils literal"><span class="pre">foreach</span></code> element consists of following attributes although they are not used in the above example.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="17%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>open</td>
<td>Specify the string that is set before processing the elements that are at the beginning of the collection.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>close</td>
<td>Specify the string that is set after processing the elements at the end of the collection.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>index</td>
<td>Specify the variable name that stores the loop number.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>There are only a few cases that use <code class="docutils literal"><span class="pre">index</span></code> attribute, however <code class="docutils literal"><span class="pre">open</span></code> attribute and <code class="docutils literal"><span class="pre">close</span></code> attribute are used to generate IN clause etc. dynamically.</p>
<p>How to use <code class="docutils literal"><span class="pre">foreach</span></code>element while creating an IN clause is explained.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;foreach</span> <span class="na">collection=</span><span class="s">&quot;list&quot;</span> <span class="na">item=</span><span class="s">&quot;statusCode&quot;</span>
        <span class="na">open=</span><span class="s">&quot;AND order_status IN (&quot;</span>
        <span class="na">separator=</span><span class="s">&quot;,&quot;</span>
        <span class="na">close=</span><span class="s">&quot;)&quot;</span><span class="nt">&gt;</span>
    #{statusCode}
<span class="nt">&lt;/foreach&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p>Following SQL is built.</p>
<blockquote class="last">
<div><div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- list=[&#39;accepted&#39;,&#39;checking&#39;]</span>
<span class="p">...</span>
<span class="k">AND</span> <span class="n">order_status</span> <span class="k">IN</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">SQL (WHERE clause) generated by dynamic SQL described above consists of following 3 patterns.</div>
</div>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- (1) list=null or statusCodes=[]</span>
<span class="p">...</span>
<span class="k">FROM</span>
    <span class="n">t_todo</span>
<span class="k">ORDER</span> <span class="k">BY</span>
    <span class="n">todo_id</span>
</pre></div>
</div>
<div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- (2) list=[&#39;2014-01-01&#39;]</span>
<span class="p">...</span>
<span class="k">FROM</span>
    <span class="n">t_todo</span>
<span class="k">WHERE</span>
    <span class="p">(</span><span class="n">created_at</span> <span class="o">&gt;=</span> <span class="o">?</span> <span class="k">AND</span> <span class="n">created_at</span> <span class="o">&lt;</span> <span class="n">DATEADD</span><span class="p">(</span><span class="s1">&#39;DAY&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">?</span><span class="p">))</span>
<span class="k">ORDER</span> <span class="k">BY</span>
    <span class="n">todo_id</span>
</pre></div>
</div>
<div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- (3) list=[&#39;2014-01-01&#39;,&#39;2014-01-02&#39;]</span>
<span class="p">...</span>
<span class="k">FROM</span>
    <span class="n">t_todo</span>
<span class="k">WHERE</span>
    <span class="p">(</span><span class="n">created_at</span> <span class="o">&gt;=</span> <span class="o">?</span> <span class="k">AND</span> <span class="n">created_at</span> <span class="o">&lt;</span> <span class="n">DATEADD</span><span class="p">(</span><span class="s1">&#39;DAY&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">?</span><span class="p">))</span>
<span class="k">OR</span>
    <span class="p">(</span><span class="n">created_at</span> <span class="o">&gt;=</span> <span class="o">?</span> <span class="k">AND</span> <span class="n">created_at</span> <span class="o">&lt;</span> <span class="n">DATEADD</span><span class="p">(</span><span class="s1">&#39;DAY&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">?</span><span class="p">))</span>
<span class="k">ORDER</span> <span class="k">BY</span>
    <span class="n">todo_id</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="implementation-example-for-bind-element">
<h4><a class="toc-backref" href="#id74">5.2.2.10.6. Implementation example for bind element</a><a class="headerlink" href="#implementation-example-for-bind-element" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">bind</span></code> element is the XML element for storing OGNL expression result in the variable.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findAllByCriteria&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;TodoCriteria&quot;</span> <span class="na">resultType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;bind</span> <span class="na">name=</span><span class="s">&quot;escapedTodoTitle&quot;</span>
          <span class="na">value=</span><span class="s">&quot;@org.terasoluna.gfw.common.query.QueryEscapeUtils@toLikeCondition(todoTitle)&quot;</span> <span class="nt">/&gt;</span>
    SELECT
        todo_id,
        todo_title,
        finished,
        created_at,
        version
    FROM
        t_todo
    WHERE
        /* (2) */
        todo_title LIKE #{escapedTodoTitle} || &#39;%&#39; ESCAPE &#39;~&#39;
    ORDER BY
        todo_id
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="17%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>-</td>
<td><p class="first">Store results of OGNL expression in the variable, using <code class="docutils literal"><span class="pre">bind</span></code> element.</p>
<p class="last">In the above example, the results obtained by calling the method using OGNL expression, are stored in the variable.</p>
</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>name</td>
<td><p class="first">Specify variable name in <code class="docutils literal"><span class="pre">name</span></code> attribute.</p>
<p class="last">The variable specified here can be used as SQL bind variable.</p>
</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>value</td>
<td><p class="first">Specify OGNL expression in <code class="docutils literal"><span class="pre">value</span></code> attribute.</p>
<p>Results obtained by executing OGNL expression are stored in the variable specified by <code class="docutils literal"><span class="pre">name</span></code> attribute.</p>
<p class="last">In the above example, the results obtained by calling method (<code class="docutils literal"><span class="pre">QueryEscapeUtils#toLikeCondition(String)</span></code>) provided by common library
are stored in the variable <code class="docutils literal"><span class="pre">escapedTodoTitle</span></code>.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>-</td>
<td><p class="first">Specify the variable created by using <code class="docutils literal"><span class="pre">bind</span></code> element as the bind variable.</p>
<p class="last">In the above example, the variable created by using <code class="docutils literal"><span class="pre">bind</span></code> element (<code class="docutils literal"><span class="pre">escapedTodoTitle</span></code>) is specified as the bind variable.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>In the above example, although the variable created by using <code class="docutils literal"><span class="pre">bind</span></code> variable is specified as the bind variable,
it can also be used as substitution variable.</p>
<p class="last">Refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3howtousesqlinjectioncountermeasure"><span>SQL Injection countermeasures</span></a>&#8221; for bind variable and substitution variable.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="escape-during-like-search">
<span id="dataaccessmybatis3howtouselikeescape"></span><h3><a class="toc-backref" href="#id75">5.2.2.11. Escape during LIKE search</a><a class="headerlink" href="#escape-during-like-search" title="Permalink to this headline">¶</a></h3>
<p>When performing LIKE search, the value to be used as search condition should be escaped for LIKE search.</p>
<p>The escape process for LIKE search
can be implemented by using the method of <code class="docutils literal"><span class="pre">org.terasoluna.gfw.common.query.QueryEscapeUtils</span></code>  class provided by common library.</p>
<p>Refer to &#8220;<a class="reference internal" href="DataAccessCommon.html#data-access-common-appendix-like-escape"><span>Escaping during LIKE search</span></a>&#8221; for specifications of the escape process provided by common library.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findAllByCriteria&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;TodoCriteria&quot;</span> <span class="na">resultType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;bind</span> <span class="na">name=</span><span class="s">&quot;todoTitleContainingCondition&quot;</span>
          <span class="na">value=</span><span class="s">&quot;@org.terasoluna.gfw.common.query.QueryEscapeUtils@toContainingCondition(todoTitle)&quot;</span> <span class="nt">/&gt;</span>
    SELECT
        todo_id,
        todo_title,
        finished,
        created_at,
        version
    FROM
        t_todo
    WHERE
        /* (2) (3) */
        todo_title LIKE #{todoTitleContainingCondition} ESCAPE &#39;~&#39;
    ORDER BY
        todo_id
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Call the Escape process method for LIKE search provided by common library, by using <code class="docutils literal"><span class="pre">bind</span></code> element (OGNL expression).</p>
<p class="last">In the above example, escape process is performed for partial match and is stored in <code class="docutils literal"><span class="pre">todoTitleContainingCondition</span></code> variable.
<code class="docutils literal"><span class="pre">QueryEscapeUtils&#64;toContainingCondition(String)</span></code> is the method that assigns &#8220;<code class="docutils literal"><span class="pre">%</span></code>&#8221; before and after the escaped string.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>Specify the string that performs escape process for partial match, as bind variable of LIKE clause.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p class="first">Specify escape character in ESCAPE clause.</p>
<p class="last">Since <code class="docutils literal"><span class="pre">&quot;~&quot;</span></code> is used as an escape character in the Escape process provided by common library,
<code class="docutils literal"><span class="pre">'~'</span></code>is specified in ESCAPE clause.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>In the above example, a method that performs the Escape process for partial match is called. However, methods that perform the following processes are also provided.</p>
<ul class="simple">
<li>Escape for starting-with match (<code class="docutils literal"><span class="pre">QueryEscapeUtils&#64;toStartingWithCondition(String)</span></code>)</li>
<li>Escape for ends-with match (<code class="docutils literal"><span class="pre">QueryEscapeUtils&#64;toEndingWithCondition(String)</span></code>)</li>
<li>Escape only (<code class="docutils literal"><span class="pre">QueryEscapeUtils&#64;toLikeCondition(String)</span></code>)</li>
</ul>
<p class="last">Refer to &#8220;<a class="reference internal" href="DataAccessCommon.html#data-access-common-appendix-like-escape"><span>Escaping during LIKE search</span></a>&#8221; for details.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In the above example, the method that performs Escape process in the mapping file is called, however
Escape process can also be called as a Service process before calling the Repository method.</p>
<p class="last">As role of component, it is appropriate that Escape process is performed in mapping file.
Hence, in this guideline, it is recommended to perform Escape process in mapping file.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="sql-injection-countermeasures">
<span id="dataaccessmybatis3howtousesqlinjectioncountermeasure"></span><h3><a class="toc-backref" href="#id76">5.2.2.12. SQL Injection countermeasures</a><a class="headerlink" href="#sql-injection-countermeasures" title="Permalink to this headline">¶</a></h3>
<p>It is important to take precautions when building SQL to avoid occurrence of SQL Injection.</p>
<p>MyBatis3 provides following two methods as the mechanism to embed values in SQL.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="22%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Method</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Embedding value by using bind variable</td>
<td><p class="first">When this method is used, the value is embedded after building SQL by using <code class="docutils literal"><span class="pre">java.sql.PreparedStatement</span></code> .
Hence, <strong>the value can be safely embedded.</strong></p>
<p class="last"><strong>When the value entered by user is to be embedded in SQL, as a rule, bind variable should be used.</strong></p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>Embedding value by using substitution variable</td>
<td>When this method is used, the value is substituted as a string while building SQL.
Hence <strong>Safe embedding of value cannot be guaranteed.</strong></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>When the value entered by the user is embedded by using substitution variable,
it should be noted that the risk of SQL Injection is high.</p>
<p>When the value entered by the user needs to be embedded by using a substitution variable,
the input check must be performed in order to ensure that SQL Injection has not occurred.</p>
<p class="last">Basically, <strong>it is strongly recommended not to use the value entered by the user as it is.</strong></p>
</div>
</div></blockquote>
<div class="section" id="how-to-embed-using-a-bind-variable">
<h4><a class="toc-backref" href="#id77">5.2.2.12.1. How to embed using a bind variable</a><a class="headerlink" href="#how-to-embed-using-a-bind-variable" title="Permalink to this headline">¶</a></h4>
<p>How to use a bind variable is shown below.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&quot;create&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
    INSERT INTO
        t_todo
    (
        todo_id,
        todo_title,
        finished,
        created_at,
        version
    )
    VALUES
    (
        /* (1) */
        #{todoId},
        #{todoTitle},
        #{finished},
        #{createdAt},
        #{version}
    )
<span class="nt">&lt;/insert&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Enclose the property name of the property that stores bind value using  <code class="docutils literal"><span class="pre">#{</span></code>  and <code class="docutils literal"><span class="pre">}</span></code>  and specify it as bind variable.</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>A number of attributes can be specified in the bind variable.</p>
<p>The attributes that can be specified are as below.</p>
<ul class="simple">
<li>javaType</li>
<li>jdbcType</li>
<li>typeHandler</li>
<li>numericScale</li>
<li>mode</li>
<li>resultMap</li>
<li>jdbcTypeName</li>
</ul>
<p>Basically, MyBatis simply selects an appropriate behavior just by specifying the property name.
The attributes described above can be specified when MyBatis does not select an appropriate behavior.</p>
<p class="last">Refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/sqlmap-xml.html#Parameters">MyBatis3 REFERENCE DOCUMENTATION(Mapper XML Files-Parameters-)</a> &#8221; for how to use attributes.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="how-to-embed-using-a-substitution-variable">
<h4><a class="toc-backref" href="#id78">5.2.2.12.2. How to embed using a substitution variable</a><a class="headerlink" href="#how-to-embed-using-a-substitution-variable" title="Permalink to this headline">¶</a></h4>
<p>How to use a substitution variable is described below.</p>
<ul class="simple">
<li>Defining the method in Repository interface.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoRepository</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="nf">findAllByCriteria</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;criteria&quot;</span><span class="o">)</span> <span class="n">TodoCriteria</span> <span class="n">criteria</span><span class="o">,</span>
                                 <span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;direction&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">direction</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Implementing SQL in mapping file.</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findAllByCriteria&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;TodoCriteria&quot;</span> <span class="na">resultType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;bind</span> <span class="na">name=</span><span class="s">&quot;todoTitleContainingCondition&quot;</span>
          <span class="na">value=</span><span class="s">&quot;@org.terasoluna.gfw.common.query.QueryEscapeUtils@toContainingCondition(criteria.todoTitle)&quot;</span> <span class="nt">/&gt;</span>
    SELECT
        todo_id,
        todo_title,
        finished,
        created_at,
        version
    FROM
        t_todo
    WHERE
        todo_title LIKE #{todoTitleContainingCondition} ESCAPE &#39;~&#39;
    ORDER BY
        /* (1) */
        todo_id ${direction}
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Enclose the property name of the property that stores the value to be substituted by <code class="docutils literal"><span class="pre">${</span></code>  and <code class="docutils literal"><span class="pre">}</span></code> and specify as substitution variable. In the above example, <code class="docutils literal"><span class="pre">${direction}</span></code>  part is substituted
by <code class="docutils literal"><span class="pre">&quot;DESC&quot;</span></code>  or <code class="docutils literal"><span class="pre">&quot;ASC&quot;</span></code> .</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<blockquote>
<div><strong>Embedding value by a substitution variable must be used only after ensuring that the value is safe for the application</strong>
<strong>and by restricting its use to table name, column name and sort conditions.</strong></div></blockquote>
<p>For example, the pair of code value and value to be embedded in SQL is stored in <code class="docutils literal"><span class="pre">Map</span></code> as shown below.</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">directionMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
<span class="n">directionMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;1&quot;</span><span class="o">,</span> <span class="s">&quot;ASC&quot;</span><span class="o">);</span>
<span class="n">directionMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;2&quot;</span><span class="o">,</span> <span class="s">&quot;DESC&quot;</span><span class="o">);</span>
</pre></div>
</div>
</div></blockquote>
<p>The value entered should be handled as code value and is expected to be converted to a safe value inside the process executing the SQL.</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="n">String</span> <span class="n">direction</span> <span class="o">=</span> <span class="n">directionMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">directionCode</span><span class="o">);</span>
<span class="n">todoRepository</span><span class="o">.</span><span class="na">findAllByCriteria</span><span class="o">(</span><span class="n">criteria</span><span class="o">,</span> <span class="n">direction</span><span class="o">);</span>
</pre></div>
</div>
</div></blockquote>
<p>In the above example, <code class="docutils literal"><span class="pre">Map</span></code> is used.
However, &#8220;<a class="reference internal" href="Codelist.html"><em>Codelist</em></a> &#8221;  provided by common library can also be used.
If &#8220;<a class="reference internal" href="Codelist.html"><em>Codelist</em></a> &#8221; is used, the value entered can be checked.
Hence, the value can be safely embedded.</p>
<ul class="last">
<li><p class="first"><code class="file docutils literal"><span class="pre">projectName-domain/src/main/resources/META-INF/spring/projectName-codelist.xml</span></code></p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans</span>
<span class="s">    http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;CL_DIRECTION&quot;</span> <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.codelist.SimpleMapCodeList&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;map&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;map&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;ASC&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;2&quot;</span> <span class="na">value=</span><span class="s">&quot;DESC&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/map&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">Service class</p>
<div class="highlight-java"><div class="highlight"><pre><span class="nd">@Inject</span>
<span class="nd">@Named</span><span class="o">(</span><span class="s">&quot;CL_DIRECTION&quot;</span><span class="o">)</span>
<span class="n">CodeList</span> <span class="n">directionCodeList</span><span class="o">;</span>

<span class="c1">// ...</span>

<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="nf">searchTodos</span><span class="o">(</span><span class="n">TodoCriteria</span> <span class="n">criteria</span><span class="o">,</span> <span class="n">String</span> <span class="n">directionCode</span><span class="o">){</span>
    <span class="n">String</span> <span class="n">direction</span> <span class="o">=</span> <span class="n">directionCodeList</span><span class="o">.</span><span class="na">asMap</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">directionCode</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">todos</span> <span class="o">=</span> <span class="n">todoRepository</span><span class="o">.</span><span class="na">findAllByCriteria</span><span class="o">(</span><span class="n">criteria</span><span class="o">,</span> <span class="n">direction</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">todos</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="how-to-extend">
<span id="dataaccessmybatis3howtoextend"></span><h2><a class="toc-backref" href="#id79">5.2.3. How to extend</a><a class="headerlink" href="#how-to-extend" title="Permalink to this headline">¶</a></h2>
<div class="section" id="sharing-sql-statement">
<span id="dataaccessmybatis3howtoextendsqlshare"></span><h3><a class="toc-backref" href="#id80">5.2.3.1. Sharing SQL statement</a><a class="headerlink" href="#sharing-sql-statement" title="Permalink to this headline">¶</a></h3>
<p>How to share a SQL statement in multiple SQLs is explained.</p>
<p>In MyBatis3, SQL statement (or a part of SQL statement) can be shared by using <code class="docutils literal"><span class="pre">sql</span></code> element and <code class="docutils literal"><span class="pre">include</span></code> element.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>How to use a shared SQL statement</strong></p>
<p class="last">When pagination search is to be performed, WHERE clause of &#8220;SQL that fetches total records of Entity matching with search conditions&#8221; and
&#8220;SQL that fetches a list of Entities matching with search conditions&#8221; should be shared.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Implementation example of mapping file is as given below.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="hll"><span class="c">&lt;!-- (1)  --&gt;</span>
</span><span class="hll"><span class="nt">&lt;sql</span> <span class="na">id=</span><span class="s">&quot;findPageByCriteriaWherePhrase&quot;</span><span class="nt">&gt;</span>
</span>    <span class="cp">&lt;![CDATA[</span>
<span class="cp">    WHERE</span>
<span class="cp">        todo_title LIKE #{title} || &#39;%&#39; ESCAPE &#39;~&#39;</span>
<span class="cp">    AND</span>
<span class="cp">        created_at &lt; #{createdAt}</span>
<span class="cp">    ]]&gt;</span>
<span class="nt">&lt;/sql&gt;</span>

<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;countByCriteria&quot;</span> <span class="na">resultType=</span><span class="s">&quot;_long&quot;</span><span class="nt">&gt;</span>
    SELECT
        COUNT(*)
    FROM
        t_todo
<span class="hll">    <span class="c">&lt;!-- (2)  --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;include</span> <span class="na">refid=</span><span class="s">&quot;findPageByCriteriaWherePhrase&quot;</span><span class="nt">/&gt;</span>
</span><span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findPageByCriteria&quot;</span> <span class="na">resultType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
    SELECT
        todo_id,
        todo_title,
        finished,
        created_at,
        version
    FROM
        t_todo
<span class="hll">    <span class="c">&lt;!-- (2)  --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;include</span> <span class="na">refid=</span><span class="s">&quot;findPageByCriteriaWherePhrase&quot;</span><span class="nt">/&gt;</span>
</span>    ORDER BY
        todo_id
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Implement SQL statement to be shared by multiple SQLs, in <code class="docutils literal"><span class="pre">sql</span></code> element.</p>
<p class="last">Specify an ID unique to the mapping file, in <code class="docutils literal"><span class="pre">id</span></code> attribute.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Specify the INCLUDE SQL by using <code class="docutils literal"><span class="pre">include</span></code> element.</p>
<p class="last">Specify the INCLUDE SQL ID (value specified in <code class="docutils literal"><span class="pre">id</span></code> attribute of <code class="docutils literal"><span class="pre">sql</span></code> element), in <code class="docutils literal"><span class="pre">refid</span></code> attribute.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="implementation-of-typehandler">
<span id="dataaccessmybatis3howtoextendtypehandler"></span><h3><a class="toc-backref" href="#id81">5.2.3.2. Implementation of TypeHandler</a><a class="headerlink" href="#implementation-of-typehandler" title="Permalink to this headline">¶</a></h3>
<p>When it is necessary to perform mapping with the Java class not supported by MyBatis3 standard
and when it is necessary to change the standard behavior of MyBatis3, a unique TypeHandler should be created.</p>
<p>How to implement the TypeHandler is explained using the examples given below.</p>
<ul class="simple">
<li><a class="reference internal" href="#dataaccessmybatis3howtoextendtypehandlerblob"><span>Implementing the TypeHandler for BLOB</span></a></li>
<li><a class="reference internal" href="#dataaccessmybatis3howtoextendtypehandlerclob"><span>Implementing the TypeHandler for CLOB</span></a></li>
<li><a class="reference internal" href="#dataaccessmybatis3howtoextendtypehandlerjoda"><span>Implementing TypeHandler for Joda-Time</span></a></li>
</ul>
<p>Refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3howtousesettingstypehandler"><span>TypeHandler settings</span></a>&#8221; for how to apply a created TypeHandler in an application.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Preconditions for implementation of BLOB and CLOB</strong></p>
<p>A method added from JDBC 4.0 is used for the implementation of BLOB and CLOB.</p>
<p>When using a JDBC driver that is not compatible with JDBC 4.0 or a 3rd party wrapper class,
it must be noted that the operation may not work in the implementation example explained below.
When the operation is to be performed in an environment wherein the driver is not compatible with JDBC 4.0,
the implementation must be changed to suit the compatible version of JDBC driver to be used.</p>
<p class="last">For example, a lot of methods added by JDBC 4.0 are not implemented in JDBC driver for PostgreSQL9.3 (<code class="docutils literal"><span class="pre">postgresql-9.3-1102-jdbc41.jar</span></code>).</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="implementing-the-typehandler-for-blob">
<span id="dataaccessmybatis3howtoextendtypehandlerblob"></span><h4><a class="toc-backref" href="#id82">5.2.3.2.1. Implementing the TypeHandler for BLOB</a><a class="headerlink" href="#implementing-the-typehandler-for-blob" title="Permalink to this headline">¶</a></h4>
<p>MyBatis3 provides a TypeHandler for mapping BLOB in <code class="docutils literal"><span class="pre">byte[]</span></code>.
However, when the data to be handled is very large, it is necessary to map in <code class="docutils literal"><span class="pre">java.io.InputStream</span></code>.</p>
<p>How to implement a TypeHandler for mapping BLOB in <code class="docutils literal"><span class="pre">java.io.InputStream</span></code> is given below.</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.infra.mybatis.typehandler</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.ibatis.type.BaseTypeHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.ibatis.type.JdbcType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.ibatis.type.MappedTypes</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.*</span><span class="o">;</span>

<span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BlobInputStreamTypeHandler</span> <span class="kd">extends</span> <span class="n">BaseTypeHandler</span><span class="o">&lt;</span><span class="n">InputStream</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="c1">// (2)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNonNullParameter</span><span class="o">(</span><span class="n">PreparedStatement</span> <span class="n">ps</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">,</span> <span class="n">InputStream</span> <span class="n">parameter</span><span class="o">,</span>
                                    <span class="n">JdbcType</span> <span class="n">jdbcType</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
        <span class="n">ps</span><span class="o">.</span><span class="na">setBlob</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">parameter</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// (3)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">InputStream</span> <span class="nf">getNullableResult</span><span class="o">(</span><span class="n">ResultSet</span> <span class="n">rs</span><span class="o">,</span> <span class="n">String</span> <span class="n">columnName</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">toInputStream</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getBlob</span><span class="o">(</span><span class="n">columnName</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="c1">// (3)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">InputStream</span> <span class="nf">getNullableResult</span><span class="o">(</span><span class="n">ResultSet</span> <span class="n">rs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">columnIndex</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">toInputStream</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getBlob</span><span class="o">(</span><span class="n">columnIndex</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="c1">// (3)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">InputStream</span> <span class="nf">getNullableResult</span><span class="o">(</span><span class="n">CallableStatement</span> <span class="n">cs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">columnIndex</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">toInputStream</span><span class="o">(</span><span class="n">cs</span><span class="o">.</span><span class="na">getBlob</span><span class="o">(</span><span class="n">columnIndex</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">InputStream</span> <span class="nf">toInputStream</span><span class="o">(</span><span class="n">Blob</span> <span class="n">blob</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
        <span class="c1">// (4)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">blob</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">blob</span><span class="o">.</span><span class="na">getBinaryStream</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Specify <code class="docutils literal"><span class="pre">BaseTypeHandler</span></code> provided by MyBatis3 in parent class.</p>
<p class="last">In such cases, specify <code class="docutils literal"><span class="pre">InputStream</span></code> in the generic type of <code class="docutils literal"><span class="pre">BaseTypeHandler</span></code>.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>Implement the process that configures <code class="docutils literal"><span class="pre">InputStream</span></code> in <code class="docutils literal"><span class="pre">PreparedStatement</span></code>.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>Fetch <code class="docutils literal"><span class="pre">InputStream</span></code> from <code class="docutils literal"><span class="pre">Blob</span></code> that is fetched from <code class="docutils literal"><span class="pre">ResultSet</span></code> or <code class="docutils literal"><span class="pre">CallableStatement</span></code> and return as a return value.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td><p class="first">Since the fetched <code class="docutils literal"><span class="pre">Blob</span></code> can become <code class="docutils literal"><span class="pre">null</span></code> in case of the column which allows <code class="docutils literal"><span class="pre">null</span></code>, <code class="docutils literal"><span class="pre">InputStream</span></code> must be fetched only after performing <code class="docutils literal"><span class="pre">null</span></code> check.</p>
<p class="last">In the implementation example described above, a private method is created since same process is required for all three methods.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="implementing-the-typehandler-for-clob">
<span id="dataaccessmybatis3howtoextendtypehandlerclob"></span><h4><a class="toc-backref" href="#id83">5.2.3.2.2. Implementing the TypeHandler for CLOB</a><a class="headerlink" href="#implementing-the-typehandler-for-clob" title="Permalink to this headline">¶</a></h4>
<p>MyBatis3 provides a TypeHandler for mapping CLOB in <code class="docutils literal"><span class="pre">java.lang.String</span></code>.
However, when the data to be handled is very large, it is necessary to map it in <code class="docutils literal"><span class="pre">java.io.Reader</span></code>.</p>
<p>How to implement the TypeHandler for mapping CLOB in <code class="docutils literal"><span class="pre">java.io.Reader</span></code>is given below.</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.infra.mybatis.typehandler</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.ibatis.type.BaseTypeHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.ibatis.type.JdbcType</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Reader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.*</span><span class="o">;</span>

<span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClobReaderTypeHandler</span> <span class="kd">extends</span> <span class="n">BaseTypeHandler</span><span class="o">&lt;</span><span class="n">Reader</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="c1">// (2)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNonNullParameter</span><span class="o">(</span><span class="n">PreparedStatement</span> <span class="n">ps</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">,</span> <span class="n">Reader</span> <span class="n">parameter</span><span class="o">,</span>
                                    <span class="n">JdbcType</span> <span class="n">jdbcType</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
        <span class="n">ps</span><span class="o">.</span><span class="na">setClob</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">parameter</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// (3)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Reader</span> <span class="nf">getNullableResult</span><span class="o">(</span><span class="n">ResultSet</span> <span class="n">rs</span><span class="o">,</span> <span class="n">String</span> <span class="n">columnName</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">toReader</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getClob</span><span class="o">(</span><span class="n">columnName</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="c1">// (3)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Reader</span> <span class="nf">getNullableResult</span><span class="o">(</span><span class="n">ResultSet</span> <span class="n">rs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">columnIndex</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">toReader</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getClob</span><span class="o">(</span><span class="n">columnIndex</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="c1">// (3)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Reader</span> <span class="nf">getNullableResult</span><span class="o">(</span><span class="n">CallableStatement</span> <span class="n">cs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">columnIndex</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">toReader</span><span class="o">(</span><span class="n">cs</span><span class="o">.</span><span class="na">getClob</span><span class="o">(</span><span class="n">columnIndex</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">Reader</span> <span class="nf">toReader</span><span class="o">(</span><span class="n">Clob</span> <span class="n">clob</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
        <span class="c1">// (4)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">clob</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">clob</span><span class="o">.</span><span class="na">getCharacterStream</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Specify <code class="docutils literal"><span class="pre">BaseTypeHandler</span></code> provided by MyBatis3 in parent class.</p>
<p class="last">In such cases, specify <code class="docutils literal"><span class="pre">Reader</span></code> in generic type of <code class="docutils literal"><span class="pre">BaseTypeHandler</span></code>.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>Implement a process that sets <code class="docutils literal"><span class="pre">Reader</span></code> in <code class="docutils literal"><span class="pre">PreparedStatement</span></code>.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>Fetch <code class="docutils literal"><span class="pre">Reader</span></code> from <code class="docutils literal"><span class="pre">Clob</span></code> that is fetched from <code class="docutils literal"><span class="pre">ResultSet</span></code> or <code class="docutils literal"><span class="pre">CallableStatement</span></code> and return it as the return value.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td><p class="first">Since fetched <code class="docutils literal"><span class="pre">Clob</span></code> can become <code class="docutils literal"><span class="pre">null</span></code> in the column that allows <code class="docutils literal"><span class="pre">null</span></code>, <code class="docutils literal"><span class="pre">Reader</span></code> needs to be fetched only after performing <code class="docutils literal"><span class="pre">null</span></code> check.</p>
<p class="last">In the implementation example described above, a private method is created since same process is required for all three methods.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="implementing-typehandler-for-joda-time">
<span id="dataaccessmybatis3howtoextendtypehandlerjoda"></span><h4><a class="toc-backref" href="#id84">5.2.3.2.3. Implementing TypeHandler for Joda-Time</a><a class="headerlink" href="#implementing-typehandler-for-joda-time" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">MyBatis3 does not support Joda-time classes (<code class="docutils literal"><span class="pre">org.joda.time.DateTime</span></code>, <code class="docutils literal"><span class="pre">org.joda.time.LocalDateTime</span></code>, <code class="docutils literal"><span class="pre">org.joda.time.LocalDate</span></code>etc.).</div>
<div class="line">Hence, when Joda-Time class is used in the field of Entity class, it is necessary to provide a TypeHandler for Joda-Time.</div>
</div>
<p>How to implement a TypeHandler for mapping <code class="docutils literal"><span class="pre">org.joda.time.DateTime</span></code> and <code class="docutils literal"><span class="pre">java.sql.Timestamp</span></code> is shown below.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Other classes provided by Joda-Time (<code class="docutils literal"><span class="pre">LocalDateTime</span></code>, <code class="docutils literal"><span class="pre">LocalDate</span></code>, <code class="docutils literal"><span class="pre">LocalTime</span></code> etc.) can also be implemented in the same way.</p>
</div>
<div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.infra.mybatis.typehandler</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.sql.CallableStatement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.PreparedStatement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.ResultSet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.SQLException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Timestamp</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.ibatis.type.BaseTypeHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.ibatis.type.JdbcType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.joda.time.DateTime</span><span class="o">;</span>

<span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DateTimeTypeHandler</span> <span class="kd">extends</span> <span class="n">BaseTypeHandler</span><span class="o">&lt;</span><span class="n">DateTime</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="c1">// (2)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNonNullParameter</span><span class="o">(</span><span class="n">PreparedStatement</span> <span class="n">ps</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">,</span>
            <span class="n">DateTime</span> <span class="n">parameter</span><span class="o">,</span> <span class="n">JdbcType</span> <span class="n">jdbcType</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
        <span class="n">ps</span><span class="o">.</span><span class="na">setTimestamp</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="k">new</span> <span class="n">Timestamp</span><span class="o">(</span><span class="n">parameter</span><span class="o">.</span><span class="na">getMillis</span><span class="o">()));</span>
    <span class="o">}</span>

    <span class="c1">// (3)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">DateTime</span> <span class="nf">getNullableResult</span><span class="o">(</span><span class="n">ResultSet</span> <span class="n">rs</span><span class="o">,</span> <span class="n">String</span> <span class="n">columnName</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">toDateTime</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getTimestamp</span><span class="o">(</span><span class="n">columnName</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="c1">// (3)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">DateTime</span> <span class="nf">getNullableResult</span><span class="o">(</span><span class="n">ResultSet</span> <span class="n">rs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">columnIndex</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">toDateTime</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getTimestamp</span><span class="o">(</span><span class="n">columnIndex</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="c1">// (3)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">DateTime</span> <span class="nf">getNullableResult</span><span class="o">(</span><span class="n">CallableStatement</span> <span class="n">cs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">columnIndex</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">toDateTime</span><span class="o">(</span><span class="n">cs</span><span class="o">.</span><span class="na">getTimestamp</span><span class="o">(</span><span class="n">columnIndex</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">DateTime</span> <span class="nf">toDateTime</span><span class="o">(</span><span class="n">Timestamp</span> <span class="n">timestamp</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// (4)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">timestamp</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">DateTime</span><span class="o">(</span><span class="n">timestamp</span><span class="o">.</span><span class="na">getTime</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Specify the <code class="docutils literal"><span class="pre">BaseTypeHandler</span></code> provided by MyBatis3 in parent class.</p>
<p class="last">In such cases, specify <code class="docutils literal"><span class="pre">DateTime</span></code> in the generic type of <code class="docutils literal"><span class="pre">BaseTypeHandler</span></code>.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>Convert <code class="docutils literal"><span class="pre">DateTime</span></code> to <code class="docutils literal"><span class="pre">Timestamp</span></code> and implement the process configured in ``PreparedStatement``.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>Convert <code class="docutils literal"><span class="pre">Timestamp</span></code> fetched from <code class="docutils literal"><span class="pre">ResultSet</span></code> or <code class="docutils literal"><span class="pre">CallableStatement</span></code> to <code class="docutils literal"><span class="pre">DateTime</span></code> and return as a return value.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td><p class="first">Since <code class="docutils literal"><span class="pre">Timestamp</span></code>can become <code class="docutils literal"><span class="pre">null</span></code> in the column that allows <code class="docutils literal"><span class="pre">null</span></code>, it needs to be converted to <code class="docutils literal"><span class="pre">DateTime</span></code> only after performing <code class="docutils literal"><span class="pre">null</span></code>check.</p>
<p class="last">In the implementation example described above, a private method is created since same process is required for all three methods.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="implementation-of-resulthandler">
<span id="dataaccessmybatis3howtoextendresulthandler"></span><h3><a class="toc-backref" href="#id85">5.2.3.3. Implementation of ResultHandler</a><a class="headerlink" href="#implementation-of-resulthandler" title="Permalink to this headline">¶</a></h3>
<p>MyBatis3 provides a mechanism wherein search results are processed for each record.</p>
<p>When this mechanism is used and processes like,</p>
<ul class="simple">
<li>Value fetched by DB is processed in Java process</li>
<li>Values etc. fetched by DB are aggregated as Java process</li>
</ul>
<p>are performed, the amount of memory consumed simultaneously can be restricted to a minimum.</p>
<p>For example, when the process is to be implemented wherein, search results are downloaded as data in CSV format,
it is advisable to process the search results per record.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>It is strongly recommended to use this mechanism when the quantity of search results may be very large and when it is necessary to</strong>
<strong>process the search result for each record at a time in Java process.</strong></p>
<p>When this mechanism of processing the search result for each record is not used,
all the search result data, &#8220;Size of one data record * number of search result records&#8221;, is  stored in the memory at the same time,
and the data cannot be marked for GC till the process is completed for entire data.</p>
<p>In contrast, when a mechanism wherein the search results are processed one at a time, is used,
only the &#8220;size of one data record&#8221; is stored in the memory and that one data record can be marked for GC once the process for that data record is completed.</p>
<p>For example, when &#8220;size of one data record&#8221; is <code class="docutils literal"><span class="pre">2KB</span></code> and &#8220;number of search results&#8221; are <code class="docutils literal"><span class="pre">10,000</span></code> records, the concurrent memory consumption is as below.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">20MB</span></code> memory is consumed while performing the process collectively</li>
<li><code class="docutils literal"><span class="pre">2KB</span></code> memory is consumed while performing the process per record</li>
</ul>
<p>No particular issues have been observed in case of an application operated by a single thread.
However, problems may occur in case of an application like Web application that is operated by multiple threads.</p>
<p>If the process is performed for 100 threads at the same time, the concurrent memory consumption is as below.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">2GB</span></code> memory is consumed while performing the process collectively</li>
<li><code class="docutils literal"><span class="pre">200KB</span></code> memory is consumed while performing the process per record</li>
</ul>
<p>The results are as below.</p>
<ul class="simple">
<li>When the process is performed collectively, depending on the maximum heap size specified, system failure due to memory exhaustion and performance degradation due to frequent occurrence of full GC are more likely to occur.</li>
<li>When the process is performed per record, memory exhaustion or high-cost GC process can be controlled.</li>
</ul>
<p class="last">Please note that the numbers used above are just the guidelines and not the actual measured values.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>How to implement a process wherein the search results are downloaded as CSV data is given below.</p>
<ul class="simple">
<li>Defining the method in Repository interface.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoRepository</span> <span class="o">{</span>

    <span class="c1">// (1) (2)</span>
    <span class="kt">void</span> <span class="nf">collectAllByCriteria</span><span class="o">(</span><span class="n">TodoCriteria</span> <span class="n">criteria</span><span class="o">,</span> <span class="n">ResultHandler</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">resultHandler</span><span class="o">);</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Specify <code class="docutils literal"><span class="pre">org.apache.ibatis.session.ResultHandler</span></code> as an argument of the method.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Specify <code class="docutils literal"><span class="pre">void</span></code> type as the return value of the method.</p>
<p class="last">Precaution should be taken as, <code class="docutils literal"><span class="pre">ResultHandler</span></code> is not called when a type other than <code class="docutils literal"><span class="pre">void</span></code> is specified.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Defining SQL in mapping file.</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- (3) --&gt;</span>
<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;collectAllByCriteria&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;TodoCriteria&quot;</span> <span class="na">resultType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
    SELECT
        todo_id,
        todo_title,
        finished,
        created_at,
        version
    FROM
        t_todo
    <span class="nt">&lt;where&gt;</span>
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&quot;title != null&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;bind</span> <span class="na">name=</span><span class="s">&quot;titleContainingCondition&quot;</span>
                  <span class="na">value=</span><span class="s">&quot;@org.terasoluna.gfw.common.query.QueryEscapeUtils@toContainingCondition()&quot;</span> <span class="nt">/&gt;</span>
            todo_titile LIKE #{titleContainingCondition} ESCAPE &#39;~&#39;
        <span class="nt">&lt;/if&gt;</span>
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&quot;createdAt != null&quot;</span><span class="nt">&gt;</span>
            <span class="cp">&lt;![CDATA[</span>
<span class="cp">            AND created_at &lt; #{createdAt}</span>
<span class="cp">            ]]&gt;</span>
        <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;/where&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>Mapping file is implemented in the same way as the normal search process.</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Specifying fetchSize attribute</strong></p>
<p>When a query to return a large amount of data is to be described, an appropriate value should be set in <code class="docutils literal"><span class="pre">fetchSize</span></code> attribute.
<code class="docutils literal"><span class="pre">fetchSize</span></code> attribute is the parameter that sets the data records fetched in a single communication, during the communication between JDBC driver and database.</p>
<p class="last">Default value of JDBC driver is used when <code class="docutils literal"><span class="pre">fetchSize</span></code> attribute is omitted.
Hence, precaution must be taken, as default value can cause memory exhaustion when JDBC driver fetches all the records.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Apply DI to Repository in Service class and call Repository interface method.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoServiceImpl</span> <span class="kd">implements</span> <span class="n">TodoService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">DateTimeFormatter</span> <span class="n">DATE_FORMATTER</span> <span class="o">=</span>
        <span class="n">DateTimeFormat</span><span class="o">.</span><span class="na">forPattern</span><span class="o">(</span><span class="s">&quot;yyyy/MM/dd&quot;</span><span class="o">);</span>

    <span class="nd">@Inject</span>
    <span class="n">TodoRepository</span> <span class="n">todoRepository</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">downloadTodos</span><span class="o">(</span><span class="n">TodoCriteria</span> <span class="n">criteria</span><span class="o">,</span>
        <span class="kd">final</span> <span class="n">BufferedWriter</span> <span class="n">downloadWriter</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// (4)</span>
        <span class="n">ResultHandler</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResultHandler</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleResult</span><span class="o">(</span><span class="n">ResultContext</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Todo</span><span class="o">&gt;</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">Todo</span> <span class="n">todo</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getResultObject</span><span class="o">();</span>
                <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">todo</span><span class="o">.</span><span class="na">getTodoId</span><span class="o">());</span>
                    <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;,&quot;</span><span class="o">);</span>
                    <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">todo</span><span class="o">.</span><span class="na">getTodoTitle</span><span class="o">());</span>
                    <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;,&quot;</span><span class="o">);</span>
                    <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">todo</span><span class="o">.</span><span class="na">isFinished</span><span class="o">());</span>
                    <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;,&quot;</span><span class="o">);</span>
                    <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">DATE_FORMATTER</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">todo</span><span class="o">.</span><span class="na">getCreatedAt</span><span class="o">().</span><span class="na">getTime</span><span class="o">()));</span>
                    <span class="n">downloadWriter</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
                    <span class="n">downloadWriter</span><span class="o">.</span><span class="na">newLine</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="n">SystemException</span><span class="o">(</span><span class="s">&quot;e.xx.fw.9001&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">};</span>

        <span class="c1">// (5)</span>
        <span class="n">todoRepository</span><span class="o">.</span><span class="na">collectAllByCriteria</span><span class="o">(</span><span class="n">criteria</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>

    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td><p class="first">Generate <code class="docutils literal"><span class="pre">ResultHandler</span></code> instance.</p>
<p>Implement the process that is performed for each record in <code class="docutils literal"><span class="pre">handleResult</span></code> method of <code class="docutils literal"><span class="pre">ResultHandler</span></code>.</p>
<p class="last">In the above example, <code class="docutils literal"><span class="pre">ResultHandler</span></code> implementation class is not created and <code class="docutils literal"><span class="pre">ResultHandler</span></code> is implemented as an anonymous object.
Implementation class can also be created, however when it is not required to be shared by multiple processes, it need not be created.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td><p class="first">Call the method of Repository interface.</p>
<p>When calling the method, specify <code class="docutils literal"><span class="pre">ResultHandler</span></code> instance generated in (4), in the argument.</p>
<p>When <code class="docutils literal"><span class="pre">ResultHandler</span></code>is used, MyBatis repeats the following processes for the number of search results.</p>
<ul class="last simple">
<li>Records are fetched from search results and are mapped to JavaBean.</li>
<li><code class="docutils literal"><span class="pre">handleResult(ResultContext)</span></code> method of <code class="docutils literal"><span class="pre">ResultHandler</span></code> instance is called.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Precautions while using ResultHandler</strong></p>
<p>When <code class="docutils literal"><span class="pre">ResultHandler</span></code>is used, following two points should be considered.</p>
<ul class="last simple">
<li>MyBatis3 provides a mechanism wherein the search results are stored in local cache and global binary cache to improve the efficiency of search process. However, the data returned from the method which uses <code class="docutils literal"><span class="pre">ResultHandler</span></code> as an argument, is not cached.</li>
<li>When <code class="docutils literal"><span class="pre">ResultHandler</span></code> is used for the statement that maps data of multiple rows in a single Java object by using manual mapping, an object in the incomplete state (the status of related Entity object prior to mapping) can be passed.</li>
</ul>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>ResultContext method</strong></p>
<p>Following method is provided in <code class="docutils literal"><span class="pre">ResultContext</span></code> which is an argument of <code class="docutils literal"><span class="pre">ResultHandler#handleResult</span></code> method.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="17%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Method</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>getResultObject</td>
<td>A method for fetching object which mapped search results.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>getResultCount</td>
<td>A method for fetching the call count of <code class="docutils literal"><span class="pre">ResultHandler#handleResult</span></code> method.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>stop</td>
<td>A method to notify MyBatis to stop the processing for the subsequent records.
It is advisable to use this method when all the subsequent records are to be deleted.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p class="last">A method <code class="docutils literal"><span class="pre">isStopped</span></code> is also provided in <code class="docutils literal"><span class="pre">ResultContext</span></code> .However, its description is omitted since it is used by MyBatis.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="using-sql-execution-mode">
<span id="dataaccessmybatis3howtoextendexecutortype"></span><h3><a class="toc-backref" href="#id86">5.2.3.4. Using SQL execution mode</a><a class="headerlink" href="#using-sql-execution-mode" title="Permalink to this headline">¶</a></h3>
<p>Following three types of modes are provided in MyBatis3 to execute SQL. Default is <code class="docutils literal"><span class="pre">SIMPLE</span></code>.</p>
<p>Here,</p>
<ul class="simple">
<li>How to use execution mode</li>
<li>Precautions while using Repository of batch mode</li>
</ul>
<div class="line-block">
<div class="line">are explained.</div>
<div class="line">Refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3howtousesettingsexecutortype"><span>SQL execution mode settings</span></a>&#8221; for the explanation of execution mode.</div>
</div>
<div class="section" id="using-preparedstatement-reuse-mode">
<span id="dataaccessmybatis3howtoextendexecutortypereuse"></span><h4><a class="toc-backref" href="#id87">5.2.3.4.1. Using PreparedStatement reuse mode</a><a class="headerlink" href="#using-preparedstatement-reuse-mode" title="Permalink to this headline">¶</a></h4>
<p>When the execution mode is changed from <code class="docutils literal"><span class="pre">SIMPLE</span></code> to ``REUSE`` mode, the handling of <code class="docutils literal"><span class="pre">PreparedStatement</span></code> in MyBatis changes.
However, there is no change in behavior (use method) of MyBatis.</p>
<p>How to change the execution mode from default (<code class="docutils literal"><span class="pre">SIMPLE</span></code>) to <code class="docutils literal"><span class="pre">REUSE</span></code> is shown below.</p>
<ul class="simple">
<li>Settings are added to <code class="file docutils literal"><span class="pre">projectName-domain/src/main/resources/META-INF/mybatis/mybatis-config.xml</span></code>.</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE configuration</span>
<span class="cp">        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span>
<span class="cp">        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;settings&gt;</span>
        <span class="c">&lt;!-- (1) --&gt;</span>
        <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;defaultExecutorType&quot;</span> <span class="na">value=</span><span class="s">&quot;REUSE&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/settings&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Change <code class="docutils literal"><span class="pre">defaultExecutorType</span></code> to <code class="docutils literal"><span class="pre">REUSE</span></code>.</p>
<p class="last">When the settings given above are performed, default behavior changes to PreparedStatement reuse mode.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="using-batch-mode">
<span id="dataaccessmybatis3howtoextendexecutortypebatch"></span><h4><a class="toc-backref" href="#id88">5.2.3.4.2. Using batch mode</a><a class="headerlink" href="#using-batch-mode" title="Permalink to this headline">¶</a></h4>
<p>When all the Update system methods of Mapper interface are to be called in a batch mode,
execution mode can be changed to <code class="docutils literal"><span class="pre">BATCH</span></code> mode using the method same as &#8220;<a class="reference internal" href="#dataaccessmybatis3howtoextendexecutortypereuse"><span>Using PreparedStatement reuse mode</span></a>&#8220;</p>
<p>However, since batch mode has a number of constraints,
in actual application development, it is presumed to be used in combination with <code class="docutils literal"><span class="pre">SIMPLE</span></code> or <code class="docutils literal"><span class="pre">REUSE</span></code> mode.</p>
<p>For example,</p>
<ul class="simple">
<li>Batch mode is used in the process wherein the highest priority is to meet performance requirements associated with update of large amount of data.</li>
<li><code class="docutils literal"><span class="pre">SIMPLE</span></code> or  <code class="docutils literal"><span class="pre">REUSE</span></code> mode is used for a process wherein it is necessary to determine the update results to maintain data consistency such as in optimistic locking control etc.</li>
</ul>
<blockquote>
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>** Precautions while using the execution mode in combination**</p>
<p>When multiple execution modes are to be used in the application,
<strong>it should be noted that the execution mode cannot be changed within the same transaction.</strong></p>
<p>For example, if multiple execution modes are used within the same transaction, MyBatis detects inconsistency and throws an error.</p>
<p>This signifies that the processes below cannot be performed within the same transaction</p>
<ul class="simple">
<li>Calling XxxRepository method in <code class="docutils literal"><span class="pre">BATCH</span></code> mode</li>
<li>Calling YyyRepository method in <code class="docutils literal"><span class="pre">REUSE</span></code> mode.</li>
</ul>
<p>Service or Repository acts as the transaction boundary for the application that is created based on these guidelines.</p>
<p>Hence, <strong>when multiple execution modes are to be used in the application,</strong>
<strong>it is necessary to identify the execution mode while designing a Service or a Repository.</strong></p>
<p class="last">Transaction can be separated by specifying <code class="docutils literal"><span class="pre">&#64;Transactional(propagation</span> <span class="pre">=</span> <span class="pre">Propagation.REQUIRES_NEW)</span></code>as method annotation for Service or Repository.
Refer to &#8220;<a class="reference internal" href="../ImplementationAtEachLayer/DomainLayer.html#service-transaction-management"><span>Regarding transaction management</span></a>&#8221; for details of transaction control.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Hereafter,</p>
<ul class="simple">
<li>How to configure for using multiple execution modes in combination</li>
<li>How to implement an application</li>
</ul>
<p>are explained.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="settings-for-creating-an-individual-batch-mode-repository">
<span id="dataaccessmybatis3howtoextendexecutortypebatchindividualsetting"></span><h5>5.2.3.4.2.1. Settings for creating an individual batch mode Repository<a class="headerlink" href="#settings-for-creating-an-individual-batch-mode-repository" title="Permalink to this headline">¶</a></h5>
<p>When a batch mode Repository is to be created for a specific Repository,
a Bean can be defined for the Repository by using <code class="docutils literal"><span class="pre">org.mybatis.spring.mapper.MapperFactoryBean</span></code> provided by MyBatis-Spring.</p>
<p>A Bean is registered for</p>
<ul class="simple">
<li>A repository of <code class="docutils literal"><span class="pre">REUSE</span></code> mode as a Repository for normal use</li>
<li>A Repository of <code class="docutils literal"><span class="pre">BATCH</span></code> mode for a specific Repository</li>
</ul>
<p>in the configuration example below.</p>
<ul class="simple">
<li>Bean definition is added to - <code class="file docutils literal"><span class="pre">projectName-domain/src/main/resources/META-INF/spring/projectName-infra.xml</span></code>.</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
       <span class="na">xmlns:mybatis=</span><span class="s">&quot;http://mybatis.org/schema/mybatis-spring&quot;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&quot;</span>
<span class="s">       http://www.springframework.org/schema/beans</span>
<span class="s">       http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">       http://www.springframework.org/schema/context</span>
<span class="s">       http://www.springframework.org/schema/context/spring-context.xsd</span>
<span class="s">       http://mybatis.org/schema/mybatis-spring</span>
<span class="s">       http://mybatis.org/schema/mybatis-spring.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;sqlSessionFactory&quot;</span>
          <span class="na">class=</span><span class="s">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;configLocation&quot;</span>
                  <span class="na">value=</span><span class="s">&quot;classpath:META-INF/mybatis/mybatis-config.xml&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;sqlSessionTemplate&quot;</span>
          <span class="na">class=</span><span class="s">&quot;org.mybatis.spring.SqlSessionTemplate&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">ref=</span><span class="s">&quot;sqlSessionFactory&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;REUSE&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="nt">&lt;mybatis:scan</span> <span class="na">base-package=</span><span class="s">&quot;com.example.domain.repository&quot;</span>
                  <span class="na">template-ref=</span><span class="s">&quot;sqlSessionTemplate&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>

    <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;batchSqlSessionTemplate&quot;</span>
          <span class="na">class=</span><span class="s">&quot;org.mybatis.spring.SqlSessionTemplate&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">ref=</span><span class="s">&quot;sqlSessionFactory&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;BATCH&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!-- (4) --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;todoBatchRepository&quot;</span>
          <span class="na">class=</span><span class="s">&quot;org.mybatis.spring.mapper.MapperFactoryBean&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- (5) --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;mapperInterface&quot;</span>
                  <span class="na">value=</span><span class="s">&quot;com.example.domain.repository.todo.TodoRepository&quot;</span><span class="nt">/&gt;</span>
        <span class="c">&lt;!-- (6) --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;sqlSessionTemplate&quot;</span> <span class="na">ref=</span><span class="s">&quot;batchSqlSessionTemplate&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Define the Bean for <code class="docutils literal"><span class="pre">SqlSessionTemplate</span></code> to be used in the Repository for normal use.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Scan the Repository for normal use and register a Bean.</p>
<p class="last">Specify <code class="docutils literal"><span class="pre">SqlSessionTemplate</span></code> defined in (1), in <code class="docutils literal"><span class="pre">template-ref</span></code> attribute.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>Define a Bean for <code class="docutils literal"><span class="pre">SqlSessionTemplate</span></code> in order to use in the Repository of batch mode.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td><p class="first">Define a Bean for the Repository in batch mode.</p>
<p>Specify a value that does not overlap with the Bean name of Repository scanned in (2), in <code class="docutils literal"><span class="pre">id</span></code> attribute.
The Bean name of Repository scanned in (2) is a value for which the interface name is changed to &#8220;lowerCamelCase&#8221;.</p>
<p class="last">In the above example, <code class="docutils literal"><span class="pre">TodoRepository</span></code> for batch mode is registered in a Bean called <code class="docutils literal"><span class="pre">todoBatchRepository</span></code>.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td>Specify an interface name (FQCN) for Repository that uses a batch mode, in <code class="docutils literal"><span class="pre">mapperInterface</span></code> property.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td>Specify <code class="docutils literal"><span class="pre">SqlSessionTemplate</span></code> for batch mode that is defined in (3), in <code class="docutils literal"><span class="pre">sqlSessionTemplate</span></code> property.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If a Bean is defined for <code class="docutils literal"><span class="pre">SqlSessionTemplate</span></code>, following WARN log is output when the application is terminated.</p>
<p>This is because <code class="docutils literal"><span class="pre">close</span></code> method is called while terminating ApplicationContext of Spring since ``java.io.Closeable`` is inherited by <code class="docutils literal"><span class="pre">SqlSession</span></code> interface.</p>
<blockquote>
<div><div class="highlight-text"><div class="highlight"><pre>21:12:35.999 [Thread-2] WARN  o.s.b.f.s.DisposableBeanAdapter - Invocation of destroy method &#39;close&#39; failed on bean with name &#39;sqlSessionTemplate&#39;
java.lang.UnsupportedOperationException: Manual close is not allowed over a Spring managed SqlSession
    at org.mybatis.spring.SqlSessionTemplate.close(SqlSessionTemplate.java:310) ~[mybatis-spring-1.2.2.jar:1.2.2]
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_20]
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_20]
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_20]
    at java.lang.reflect.Method.invoke(Method.java:483) ~[na:1.8.0_20]
</pre></div>
</div>
</div></blockquote>
<p>If there are no specific issues related to system operation, this measure is not required since it does not affect the application behavior even after the log is output.</p>
<p>However, in case of any system operation issues like log monitoring etc,
log output can be controlled by specifying the method (<code class="docutils literal"><span class="pre">destroy-method</span></code> attribute) that is called while terminating Spring ApplicationContext.</p>
<p>In the example below, it is specified such that <code class="docutils literal"><span class="pre">getExecutorType</span></code> method is called.
<code class="docutils literal"><span class="pre">getExecutorType</span></code> is the method which is only used for returning the execution mode specified in constructor argument
and has no impact on other operations.</p>
<blockquote class="last">
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;batchSqlSessionTemplate&quot;</span>
      <span class="na">class=</span><span class="s">&quot;org.mybatis.spring.SqlSessionTemplate&quot;</span>
<span class="hll">      <span class="na">destroy-method=</span><span class="s">&quot;getExecutorType&quot;</span><span class="nt">&gt;</span>
</span>    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">ref=</span><span class="s">&quot;sqlSessionFactory&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;BATCH&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="settings-for-creating-batch-mode-repository-in-batch">
<span id="dataaccessmybatis3howtoextendexecutortypebatchbulksetting"></span><h5>5.2.3.4.2.2. Settings for creating Batch mode Repository in batch<a class="headerlink" href="#settings-for-creating-batch-mode-repository-in-batch" title="Permalink to this headline">¶</a></h5>
<p>When a batch mode Repository is to be created in a batch, a Bean can be defined for the Repository
by using the scan function (<code class="docutils literal"><span class="pre">mybatis:scan</span></code> element) provided by MyBatis-Spring.</p>
<p>In the configuration example below, Bean is registered for the Repositories of <code class="docutils literal"><span class="pre">REUSE</span></code> mode and <code class="docutils literal"><span class="pre">BATCH</span></code> mode, with respect to all the Repositories.</p>
<ul class="simple">
<li>Create <code class="docutils literal"><span class="pre">BeanNameGenerator</span></code>.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.config.BeanDefinition</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.support.BeanDefinitionRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.support.BeanNameGenerator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.util.ClassUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.beans.Introspector</span><span class="o">;</span>

<span class="c1">// (1)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BachRepositoryBeanNameGenerator</span> <span class="kd">implements</span> <span class="n">BeanNameGenerator</span> <span class="o">{</span>
    <span class="c1">// (2)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">generateBeanName</span><span class="o">(</span><span class="n">BeanDefinition</span> <span class="n">definition</span><span class="o">,</span> <span class="n">BeanDefinitionRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">defaultBeanName</span> <span class="o">=</span> <span class="n">Introspector</span><span class="o">.</span><span class="na">decapitalize</span><span class="o">(</span><span class="n">ClassUtils</span><span class="o">.</span><span class="na">getShortName</span><span class="o">(</span><span class="n">definition</span>
                <span class="o">.</span><span class="na">getBeanClassName</span><span class="o">()));</span>
        <span class="k">return</span> <span class="n">defaultBeanName</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">&quot;Repository&quot;</span><span class="o">,</span> <span class="s">&quot;BatchRepository&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Create a class that generates the Bean name to be registered in Spring ApplicationContext.</p>
<p class="last">This class is necessary to avoid duplication in the bean name of <code class="docutils literal"><span class="pre">REUSE</span></code> mode Repository for normal use and
the Bean name of <code class="docutils literal"><span class="pre">BATCH</span></code> mode.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Implement the method for generating a Bean name.</p>
<p class="last">In the above example, duplication of Bean name for <code class="docutils literal"><span class="pre">REUSE</span></code> mode Repository for normal use can be prevented by setting <code class="docutils literal"><span class="pre">BatchRepository</span></code> as the Bean name suffix.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Bean definition is added to <code class="file docutils literal"><span class="pre">projectName-domain/src/main/resources/META-INF/spring/projectName-infra.xml</span></code>.</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
       <span class="na">xmlns:mybatis=</span><span class="s">&quot;http://mybatis.org/schema/mybatis-spring&quot;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&quot;</span>
<span class="s">       http://www.springframework.org/schema/beans</span>
<span class="s">       http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">       http://www.springframework.org/schema/context</span>
<span class="s">       http://www.springframework.org/schema/context/spring-context.xsd</span>
<span class="s">       http://mybatis.org/schema/mybatis-spring</span>
<span class="s">       http://mybatis.org/schema/mybatis-spring.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;sqlSessionFactory&quot;</span>
          <span class="na">class=</span><span class="s">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;configLocation&quot;</span>
                  <span class="na">value=</span><span class="s">&quot;classpath:META-INF/mybatis/mybatis-config.xml&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!-- ... --&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;batchSqlSessionTemplate&quot;</span>
          <span class="na">class=</span><span class="s">&quot;org.mybatis.spring.SqlSessionTemplate&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">ref=</span><span class="s">&quot;sqlSessionFactory&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;BATCH&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;mybatis:scan</span> <span class="na">base-package=</span><span class="s">&quot;com.example.domain.repository&quot;</span>
        <span class="na">template-ref=</span><span class="s">&quot;batchSqlSessionTemplate&quot;</span>
        <span class="na">name-generator=</span><span class="s">&quot;com.example.domain.repository.BatchRepositoryBeanNameGenerator&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="17%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>-</td>
<td>Register the Bean for batch mode  Repository by using <code class="docutils literal"><span class="pre">mybatis:scan</span></code> element.</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>base-package</td>
<td><p class="first">Specify the base package that scans the Repository.</p>
<p class="last">Repository interface that exists under specified package is scanned
and a Bean is registered in Spring ApplicationContext.</p>
</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>template-ref</td>
<td>Specify Bean of <code class="docutils literal"><span class="pre">SqlSessionTemplate</span></code> for batch mode.</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>name-generator</td>
<td><p class="first">Specify a class for generating the Bean name of scanned Repository.</p>
<p>Basically, specify the class name (FQCN) for the class created in (1).</p>
<p class="last">If class name is not specified, Bean names are duplicated.
Hence, batch mode Repository is not registered in Spring ApplicationContext.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="how-to-use-the-repository-of-batch-mode">
<span id="dataaccessmybatis3howtoextendexecutortypebatchusage"></span><h5>5.2.3.4.2.3. How to use the Repository of batch mode<a class="headerlink" href="#how-to-use-the-repository-of-batch-mode" title="Permalink to this headline">¶</a></h5>
<p>An implementation example on how to access database by using batch mode Repository is given below.</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="nd">@Transactional</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoServiceImpl</span> <span class="kd">implements</span> <span class="n">TodoService</span> <span class="o">{</span>

    <span class="c1">// (1)</span>
    <span class="nd">@Inject</span>
    <span class="nd">@Named</span><span class="o">(</span><span class="s">&quot;todoBatchRepository&quot;</span><span class="o">)</span>
    <span class="n">TodoRepository</span> <span class="n">todoBatchRepository</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateTodos</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">todos</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Todo</span> <span class="n">todo</span> <span class="o">:</span> <span class="n">todos</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// (2)</span>
            <span class="n">todoBatchRepository</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">todo</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Inject the Repository of batch mode.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Call the method for batch mode Repository and update Entity.</p>
<p>In case of batch mode Repository, since the SQL is not executed in the timing when method is called.
As a result, the update results returned from method need to be ignored.</p>
<p class="last">The SQL for updating an Entity is executed in a batch immediately before committing a transaction
and the transaction is committed if there is no error.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Batch execution timing</strong></p>
<p>Timing of SQL batch execution is as below.</p>
<ul class="simple">
<li>Immediately before the transaction is committed</li>
<li>Immediately before executing the query (SELECT)</li>
</ul>
<p class="last">Notes of sequence of calling repository method refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3howtoextendexecutortypebatchnotesmethodcallorder"><span>Sequence of calling Repository method</span></a>&#8221;.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="precautions-when-using-batch-mode-repository">
<span id="dataaccessmybatis3howtoextendexecutortypebatchnotes"></span><h4><a class="toc-backref" href="#id89">5.2.3.4.3. Precautions when using batch mode Repository</a><a class="headerlink" href="#precautions-when-using-batch-mode-repository" title="Permalink to this headline">¶</a></h4>
<p>It is important to note the following points in implementation of Service class when using batch mode Repository.</p>
<ul class="simple">
<li><a class="reference internal" href="#dataaccessmybatis3howtoextendexecutortypebatchnotesupdateresult"><span>Determination of update results</span></a></li>
<li><a class="reference internal" href="#dataaccessmybatis3howtoextendexecutortypebatchnotesduplicate"><span>How to detect the unique constraint violation</span></a></li>
<li><a class="reference internal" href="#dataaccessmybatis3howtoextendexecutortypebatchnotesmethodcallorder"><span>Sequence of calling Repository method</span></a></li>
</ul>
<div class="section" id="determination-of-update-results">
<span id="dataaccessmybatis3howtoextendexecutortypebatchnotesupdateresult"></span><h5>5.2.3.4.3.1. Determination of update results<a class="headerlink" href="#determination-of-update-results" title="Permalink to this headline">¶</a></h5>
<p>When batch mode Repository is used, the validity of update results cannot be checked.</p>
<p>Update results returned from Mapper interface method when a batch mode is used, are as follows.</p>
<ul class="simple">
<li><a class="reference external" href="http://mybatis.github.io/mybatis-3/apidocs/reference/org/apache/ibatis/executor/BatchExecutor.html#BATCH_UPDATE_RETURN_VALUE">Fixed value</a>(<code class="docutils literal"><span class="pre">org.apache.ibatis.executor.BatchExecutor#BATCH_UPDATE_RETURN_VALUE</span></code>)  when return value is numeric (<code class="docutils literal"><span class="pre">int</span></code> or <code class="docutils literal"><span class="pre">long</span></code>)</li>
<li><code class="docutils literal"><span class="pre">false</span></code> when return value is <code class="docutils literal"><span class="pre">boolean</span></code></li>
</ul>
<p>This is due to the mechanism wherein SQL is not executed within the timing of calling  Mapper interface method
but is queued for batch execution (<code class="docutils literal"><span class="pre">java.sql.Statement#addBatch()</span></code>).</p>
<p><strong>In other words, batch mode cannot be used when it is necessary to check the validity of update results</strong>
<strong>(exclusive control process using optimistic locking etc).</strong></p>
<blockquote>
<div><div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>When the method (<code class="docutils literal"><span class="pre">flushStatements</span></code>) of <code class="docutils literal"><span class="pre">org.apache.ibatis.session.SqlSession</span></code> interface
is used as a functionality of MyBatis3 itself, SQL queued for batch execution is executed and
update results can be obtained.
However, since <code class="docutils literal"><span class="pre">SqlSession</span></code> is not presumed to be used directly in the guideline,
it is recommended not to use <code class="docutils literal"><span class="pre">SqlSession</span></code> directly as far as possible.</p>
<p>If it is absolutely necessary to use <code class="docutils literal"><span class="pre">SqlSession</span></code> interface method,
refer to &#8220;<a class="reference external" href="http://mybatis.github.io/spring/sqlsession.html">MyBatis-Spring REFERENCE DOCUMENTATION(Using an SqlSession)</a>&#8221;.</p>
<p class="last">The important point is to use <code class="docutils literal"><span class="pre">org.mybatis.spring.SqlSessionTemplate</span></code> provided by MyBatis-Spring.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Behavior of JDBC driver while using batch mode</strong></p>
<p>Although it has been explained that update results at the time of batch execution can be received if <code class="docutils literal"><span class="pre">SqlSession</span></code> interface is used,
it cannot be guaranteed that the update results returned from JDBC driver can be used as &#8220;number of processed records&#8221;.</p>
<p class="last">Since it also depends on the implementation of JDBC driver to be used,
it is necessary to check the specifications of the JDBC driver to be used.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>It signifies that the implementation given below cannot be performed.</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="nd">@Transactional</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoServiceImpl</span> <span class="kd">implements</span> <span class="n">TodoService</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="nd">@Named</span><span class="o">(</span><span class="s">&quot;todoBatchRepository&quot;</span><span class="o">)</span>
    <span class="n">TodoRepository</span> <span class="n">todoBatchRepository</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateTodos</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">todos</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Todo</span> <span class="n">todo</span> <span class="o">:</span> <span class="n">todos</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">boolean</span> <span class="n">updateSuccess</span> <span class="o">=</span> <span class="n">todoBatchRepository</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">todo</span><span class="o">);</span>
            <span class="c1">// (1)</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">updateSuccess</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// ...</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>When the implementation is performed as described above, update result is always <code class="docutils literal"><span class="pre">false</span></code>thereby always resulting in the execution of update failure process.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="how-to-detect-the-unique-constraint-violation">
<span id="dataaccessmybatis3howtoextendexecutortypebatchnotesduplicate"></span><h5>5.2.3.4.3.2. How to detect the unique constraint violation<a class="headerlink" href="#how-to-detect-the-unique-constraint-violation" title="Permalink to this headline">¶</a></h5>
<p>When batch mode Repository is used,
it is not possible to detect database errors like unique constraint violation etc. as a Service process.</p>
<p>This is due to the mechanism wherein SQL is not executed within the timing of calling a Mapper interface method
and is queued for the batch execution (<code class="docutils literal"><span class="pre">java.sql.Statement#addBatch()</span></code>).
It signifies that the implementation given below cannot be performed.</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="nd">@Transactional</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoServiceImpl</span> <span class="kd">implements</span> <span class="n">TodoService</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="nd">@Named</span><span class="o">(</span><span class="s">&quot;todoBatchRepository&quot;</span><span class="o">)</span>
    <span class="n">TodoRepository</span> <span class="n">todoBatchRepository</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">storeTodos</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">todos</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Todo</span> <span class="n">todo</span> <span class="o">:</span> <span class="n">todos</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">todoBatchRepository</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">todo</span><span class="o">);</span>
            <span class="c1">// (1)</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">DuplicateKeyException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// ....</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">When the implementation is performed as described above,
<code class="docutils literal"><span class="pre">org.springframework.dao.DuplicateKeyException</span></code> exception does not occur within that timing.
Hence, the process after <code class="docutils literal"><span class="pre">DuplicateKeyException</span></code> supplement is not executed.</p>
<p class="last">This is because SQL batch execution is performed after termination of Service process (just before the transaction is committed).</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="sequence-of-calling-repository-method">
<span id="dataaccessmybatis3howtoextendexecutortypebatchnotesmethodcallorder"></span><h5>5.2.3.4.3.3. Sequence of calling Repository method<a class="headerlink" href="#sequence-of-calling-repository-method" title="Permalink to this headline">¶</a></h5>
<p>Batch mode is used to improve the performance of update process.
However, if the calling sequence of Repository method is incorrect, no improvement is observed in the performance.</p>
<p>It is important to understand the MyBatis specifications given below, in order to improve the performance using batch mode.</p>
<ul class="simple">
<li>When query (SELECT) is executed, SQL waiting in the queue till then is executed in batch.</li>
<li><code class="docutils literal"><span class="pre">PreparedStatement</span></code> is generated for each update process (Repository method) called in succession and SQL is queued.</li>
</ul>
<p>It signifies that if the implementation is performed as below, advantages of using batch mode cannot be obtained.</p>
<ul class="simple">
<li>Example１</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="nd">@Transactional</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoServiceImpl</span> <span class="kd">implements</span> <span class="n">TodoService</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="nd">@Named</span><span class="o">(</span><span class="s">&quot;todoBatchRepository&quot;</span><span class="o">)</span>
    <span class="n">TodoRepository</span> <span class="n">todoBatchRepository</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">storeTodos</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">todos</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Todo</span> <span class="n">todo</span> <span class="o">:</span> <span class="n">todos</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// (1)</span>
            <span class="n">Todo</span> <span class="n">currentTodo</span> <span class="o">=</span> <span class="n">todoBatchRepository</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">todo</span><span class="o">.</span><span class="na">getTodoId</span><span class="o">());</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">currentTodo</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">todoBatchRepository</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">todo</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span><span class="o">{</span>
                <span class="n">todoBatchRepository</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">todo</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">When the implementation is performed as described in the above example, since a query is executed at the start of iteration process,
SQL is executed in a batch for each record.
This is almost same as the execution in simple mode (<code class="docutils literal"><span class="pre">SIMPLE</span></code>).</p>
<p class="last">When the process described above is necessary,
it is more effective to use Repository of PreparedStatement reuse mode (<code class="docutils literal"><span class="pre">REUSE</span></code>).</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>Example 2</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="nd">@Transactional</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoServiceImpl</span> <span class="kd">implements</span> <span class="n">TodoService</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="nd">@Named</span><span class="o">(</span><span class="s">&quot;todoBatchRepository&quot;</span><span class="o">)</span>
    <span class="n">TodoRepository</span> <span class="n">todoBatchRepository</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">storeTodos</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">todos</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Todo</span> <span class="n">todo</span> <span class="o">:</span> <span class="n">todos</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// (2)</span>
            <span class="n">todoBatchRepository</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">todo</span><span class="o">);</span>
            <span class="n">todoBatchRepository</span><span class="o">.</span><span class="na">createHistory</span><span class="o">(</span><span class="n">todo</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">When the process described above is necessary, Repository method is called alternately.
Hence, <code class="docutils literal"><span class="pre">PreparedStatement</span></code> is generated for each record.
This is almost same as executing a process in simple mode (<code class="docutils literal"><span class="pre">SIMPLE</span></code>).</p>
<p class="last">When the process described above is necessary,
it is more effective to use PreparedStatement reuse mode  Repository (<code class="docutils literal"><span class="pre">REUSE</span></code>).</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="implementation-of-a-stored-procedure">
<span id="dataaccessmybatis3howtoextendstoredprocedure"></span><h3><a class="toc-backref" href="#id90">5.2.3.5. Implementation of a stored procedure</a><a class="headerlink" href="#implementation-of-a-stored-procedure" title="Permalink to this headline">¶</a></h3>
<p>How to call a stored procedure or function registered in database from MyBatis3 is explained.</p>
<p>A function registered in PostgreSQL is called in the implementation example explained below.</p>
<ul class="simple">
<li>Register a stored procedure (function).</li>
</ul>
<blockquote>
<div><div class="highlight-guess"><div class="highlight"><pre><span class="cm">/* (1) */</span><span class="w"></span>
CREATE<span class="w"> </span>FUNCTION<span class="w"> </span>findTodo<span class="o">(</span>pTodoId<span class="w"> </span>CHAR<span class="o">)</span><span class="w"></span>
RETURNS<span class="w"> </span>TABLE<span class="o">(</span><span class="w"></span>
<span class="w">    </span>todo_id<span class="w"> </span>CHAR<span class="o">,</span><span class="w"></span>
<span class="w">    </span>todo_title<span class="w"> </span>VARCHAR<span class="o">,</span><span class="w"></span>
<span class="w">    </span>finished<span class="w"> </span>BOOLEAN<span class="o">,</span><span class="w"></span>
<span class="w">    </span>created_at<span class="w"> </span>TIMESTAMP<span class="o">,</span><span class="w"></span>
<span class="w">    </span>version<span class="w"> </span>BIGINT<span class="w"></span>
<span class="o">)</span><span class="w"> </span>AS<span class="w"> </span><span class="err">$$</span><span class="w"> </span>BEGIN<span class="w"> </span><span class="kr">RETURN</span><span class="w"> </span>QUERY<span class="w"></span>
<span class="kr">SELECT</span><span class="w"></span>
<span class="w">    </span>t<span class="o">.</span>todo_id<span class="o">,</span><span class="w"></span>
<span class="w">    </span>t<span class="o">.</span>todo_title<span class="o">,</span><span class="w"></span>
<span class="w">    </span>t<span class="o">.</span>finished<span class="o">,</span><span class="w"></span>
<span class="w">    </span>t<span class="o">.</span>created_at<span class="o">,</span><span class="w"></span>
<span class="w">    </span>t<span class="o">.</span>version<span class="w"></span>
FROM<span class="w"></span>
<span class="w">    </span>t_todo<span class="w"> </span>t<span class="w"></span>
WHERE<span class="w"></span>
<span class="w">    </span>t<span class="o">.</span>todo_id<span class="w"> </span><span class="o">=</span><span class="w"> </span>pTodoId<span class="err">;</span><span class="w"></span>
<span class="kr">END</span><span class="err">;</span><span class="w"></span>
<span class="err">$$</span><span class="w"> </span>LANGUAGE<span class="w"> </span>plpgsql<span class="err">;</span><span class="w"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>It is the function used to fetch records for specified ID.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Defining the method in Repository interface.</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="c1">// (2)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoRepository</span> <span class="kd">extends</span> <span class="n">Repository</span> <span class="o">{</span>
    <span class="n">Todo</span> <span class="nf">findOne</span><span class="o">(</span><span class="n">String</span> <span class="n">todoId</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>The interface should be same as the interface used while executing the SQL.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Call a stored procedure in the mapping file.</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot; &gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.todo.TodoRepository&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;string&quot;</span> <span class="na">resultType=</span><span class="s">&quot;Todo&quot;</span>
            <span class="na">statementType=</span><span class="s">&quot;CALLABLE&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- (4) --&gt;</span>
        {call findTodo(#{todoId})}
    <span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p class="first">Implement the statement to call the stored procedure.</p>
<p>Specify <code class="docutils literal"><span class="pre">CALLABLE</span></code> in <code class="docutils literal"><span class="pre">statementType</span></code> attribute when calling the stored procedure.
When <code class="docutils literal"><span class="pre">CALLABLE</span></code> is specified,
the stored procedure is called by using <code class="docutils literal"><span class="pre">java.sql.CallableStatement</span></code>.</p>
<p class="last">Specify <code class="docutils literal"><span class="pre">resultType</span></code> attribute or <code class="docutils literal"><span class="pre">resultMap</span></code> attribute in order to map the OUT parameter in JavaBean.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td><p class="first">Call the stored procedure.</p>
<p>When the stored procedure (faction) is to be called,</p>
<p>specify in <code class="docutils literal"><span class="pre">{call</span> <span class="pre">Procedure</span> <span class="pre">or</span> <span class="pre">Function</span> <span class="pre">name</span> <span class="pre">(IN</span> <span class="pre">parameter...)}</span></code> format.</p>
<p class="last">In the above example, the procedure is called by specifying an ID in the IN parameter for a function called <code class="docutils literal"><span class="pre">findTodo</span></code>.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="appendix">
<span id="dataaccessmybatis3appendix"></span><h2><a class="toc-backref" href="#id91">5.2.4. Appendix</a><a class="headerlink" href="#appendix" title="Permalink to this headline">¶</a></h2>
<div class="section" id="mapper-interface-mechanism">
<span id="dataaccessmybatis3appendixaboutmappermechanism"></span><h3><a class="toc-backref" href="#id92">5.2.4.1. Mapper interface mechanism</a><a class="headerlink" href="#mapper-interface-mechanism" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">When using a Mapper interface, the developer can execute SQL only by creating a Mapper interface and mapping file.</div>
<div class="line">when executing an application, implementation class of Mapper interface is generated by MyBatis3 using the Proxy function of JDK.
Hence, the developer need not create an implementation class of Mapper interface.</div>
</div>
<div class="line-block">
<div class="line">It is not necessary to define inheritance and annotation of interface provided by MyBatis3, for the Mapper interface and it
can be simply created as a Java interface.</div>
<div class="line">Example of how to create a Mapper interface and mapping file, and example of how to use it in the application (Service) are given below.</div>
<div class="line">Here, the focus should be on the main points related to explanation of code since the aim is to form an image of the deliverables to be created by developers.</div>
</div>
<ul>
<li><p class="first">How to create a Mapper interface</p>
<p>In this guideline, since it is presumed that that the Mapper interface of MyBatis3 is used as Repository interface,
interface name is in the format,  &#8220;Entity name&#8221; + <code class="docutils literal"><span class="pre">&quot;Repository&quot;</span></code> .</p>
</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.repository.todo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoRepository</span> <span class="o">{</span>
    <span class="n">Todo</span> <span class="nf">findOne</span><span class="o">(</span><span class="n">String</span> <span class="n">todoId</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
<ul>
<li><p class="first">How to create a mapping file</p>
<p>In the mapping file, FQCN (fully qualified class name) of Mapper interface is specified as namespace.
Its association with SQL that is executed while calling the method defined in the Mapper interface
can be formed by specifying a method name in id attribute of various statement tags (insert/update/delete/select tags).</p>
</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org/DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="hll"><span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.todo.TodoRepository&quot;</span><span class="nt">&gt;</span>
</span>
    <span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;todoResultMap&quot;</span> <span class="na">type=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&quot;todo_id&quot;</span> <span class="na">property=</span><span class="s">&quot;todoId&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&quot;title&quot;</span> <span class="na">property=</span><span class="s">&quot;title&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&quot;finished&quot;</span> <span class="na">property=</span><span class="s">&quot;finished&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/resultMap&gt;</span>

<span class="hll">    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;String&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;todoResultMap&quot;</span><span class="nt">&gt;</span>
</span>      SELECT
        todo_id,
        title,
        finished
      FROM
        t_todo
      WHERE
        todo_id = #{todoId}
    <span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
</div></blockquote>
<ul>
<li><p class="first">How to use Mapper interface in an application (Service)</p>
<p>When a method of Mapper interface is to be called from an application (Service), a method of Mapper object injected by Spring (DI container) is called.
The application (Service) transparently executes SQL by calling Mapper object method and can obtain SQL execution results.</p>
</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.service.todo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Todo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.domain.repository.todo.TodoRepository</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoServiceImpl</span> <span class="kd">implements</span> <span class="n">TodoService</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="n">TodoRepository</span> <span class="n">todoRepository</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">Todo</span> <span class="nf">getTodo</span><span class="o">(</span><span class="n">String</span> <span class="n">todoId</span><span class="o">){</span>
<span class="hll">        <span class="n">Todo</span> <span class="n">todo</span> <span class="o">=</span> <span class="n">todoRepository</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">todoId</span><span class="o">);</span>
</span>        <span class="k">if</span><span class="o">(</span><span class="n">todo</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">ResourceNotFoundException</span><span class="o">(</span>
                <span class="n">ResultMessages</span><span class="o">.</span><span class="na">error</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;e.ex.td.5001&quot;</span> <span class="o">,</span><span class="n">todoId</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">todo</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The process flow up to SQL execution when Mapper interface method is called, is shown below.</p>
<blockquote>
<div><div class="figure align-center" id="id15">
<a class="reference internal image-reference" href="../_images/DataAccessMyBatis3MapperMechanism.png"><img alt="Mapper mechanism" src="../_images/DataAccessMyBatis3MapperMechanism.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - Mapper mechanism</strong></span></p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Application calls the method defined in Mapper interface.</p>
<p class="last">The implementation class of Mapper interface (Proxy object of Mapper interface) is generated by MyBatis3 components at application startup time.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Proxy object of Mapper interface calls invoke method of <code class="docutils literal"><span class="pre">MapperProxy</span></code> .</p>
<p class="last">Role of <code class="docutils literal"><span class="pre">MapperProxy</span></code>  is to handle the method calling of Mapper interface.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p class="first"><code class="docutils literal"><span class="pre">MapperProxy</span></code>  generates <code class="docutils literal"><span class="pre">MapperMethod</span></code>  corresponding to the called Mapper interface method and calls execute method.</p>
<p class="last"><code class="docutils literal"><span class="pre">MapperMethod</span></code>  plays the role of calling <code class="docutils literal"><span class="pre">SqlSession</span></code>  method corresponding to the called Mapper interface method.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td><p class="first"><code class="docutils literal"><span class="pre">MapperMethod</span></code>  calls <code class="docutils literal"><span class="pre">SqlSession</span></code>  method.</p>
<p class="last">When a <code class="docutils literal"><span class="pre">SqlSession</span></code>  method is called, a key (hereafter referred to as &#8220;Statement ID&#8221;) is passed in order to specify the SQL statement to be executed.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">SqlSession</span></code>  fetches a SQL statement from a mapping file using the specified statement ID as a key.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td><code class="docutils literal"><span class="pre">SqlSession</span></code>  sets the value in bind variable specified in the SQL statement fetched by mapping file and executes SQL.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="7">
<li></li>
</ol>
</td>
<td><p class="first">Mapper interface (<code class="docutils literal"><span class="pre">SqlSession</span></code> ) converts SQL execution results to JavaBean etc. and returns it to the application.</p>
<p class="last">When number of records or number of updated records are to be fetched, primitive type or primitive wrapper type etc. form the return values.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>Statement ID</strong></p>
<p>Statement ID is a key to specify the SQL statement to be executed.
It is generated in accordance with the rule <strong>&#8220;FQCN of Mapper interface + &#8221;.&#8221; + name of the called Mapper interface method&#8221;</strong>.</p>
<p class="last">When SQL statement corresponding to the statement ID generated by <code class="docutils literal"><span class="pre">MapperMethod</span></code>  is to be defined in the mapping file,
it is necessary to specify &#8220;FQCN of Mapper interface&#8221; in the namespace of mapping file
and &#8220;method name of Mapper interface&#8221; in id attribute of various statement tags.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="dataaccessmybatis3appendixsettingstypealias">
<span id="id8"></span><h3><a class="toc-backref" href="#id93">5.2.4.2. TypeAlias settings</a><a class="headerlink" href="#dataaccessmybatis3appendixsettingstypealias" title="Permalink to this headline">¶</a></h3>
<p>TypeAlias should basically be configured per package by using <code class="docutils literal"><span class="pre">package</span></code>  element. However, following methods can also be used.</p>
<ul class="simple">
<li>A method to configure an alias name per class</li>
<li>A method to overwrite the alias name which is assigned as default (a method that specifies an optional alias name)</li>
</ul>
<div class="section" id="configuring-typealias-per-class">
<h4><a class="toc-backref" href="#id94">5.2.4.2.1. Configuring TypeAlias per class</a><a class="headerlink" href="#configuring-typealias-per-class" title="Permalink to this headline">¶</a></h4>
<p>TypeAlias can also be configured per class.</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">projectName-domain/src/main/resources/META-INF/mybatis/mybatis-config.xml</span></code></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;typeAliases&gt;</span>
<span class="hll">    <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;typeAlias</span>
</span><span class="hll">        <span class="na">type=</span><span class="s">&quot;com.example.domain.repository.account.AccountSearchCriteria&quot;</span> <span class="nt">/&gt;</span>
</span>    <span class="nt">&lt;package</span> <span class="na">name=</span><span class="s">&quot;com.example.domain.model&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/typeAliases&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Specify the fully qualified class name (FQCN) of the class for which alias is to be set, in <code class="docutils literal"><span class="pre">type</span></code>  attribute of <code class="docutils literal"><span class="pre">typeAlias</span></code>  element.</p>
<p>In the above example, alias name of <code class="docutils literal"><span class="pre">com.example.domain.repository.account.AccountSearchCriteria</span></code>  class becomes
<code class="docutils literal"><span class="pre">AccountSearchCriteria</span></code>  (part after removing package part).</p>
<p class="last">When an optional value is to be specified in the alias name, optional alias name can be specified in <code class="docutils literal"><span class="pre">alias</span></code>  attribute of <code class="docutils literal"><span class="pre">typeAlias</span></code>  element.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="overwriting-alias-name-assigned-as-default">
<h4><a class="toc-backref" href="#id95">5.2.4.2.2. Overwriting alias name assigned as default</a><a class="headerlink" href="#overwriting-alias-name-assigned-as-default" title="Permalink to this headline">¶</a></h4>
<p>When alias is set by using <code class="docutils literal"><span class="pre">package</span></code>  element or
when alias is set by omitting <code class="docutils literal"><span class="pre">alias</span></code>  attribute of <code class="docutils literal"><span class="pre">typeAlias</span></code>  element,
alias for TypeAlias is a part obtained after removing the package part from fully qualified class name (FQCN).</p>
<p>When optional alias is to be used instead of default alias,
it can be specified by specifying <code class="docutils literal"><span class="pre">&#64;org.apache.ibatis.type.Alias</span></code>  annotation in the class wherein TypeAlias to is to be configured.</p>
<ul class="simple">
<li>Java class for configuring alias</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.model.book</span><span class="o">;</span>

<span class="hll"><span class="nd">@Alias</span><span class="o">(</span><span class="s">&quot;BookAuthor&quot;</span><span class="o">)</span> <span class="c1">// (1)</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Author</span> <span class="o">{</span>
   <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.model.article</span><span class="o">;</span>

<span class="hll"><span class="nd">@Alias</span><span class="o">(</span><span class="s">&quot;ArticleAuthor&quot;</span><span class="o">)</span> <span class="c1">// (1)</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Author</span> <span class="o">{</span>
   <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Specify the alias name in <code class="docutils literal"><span class="pre">value</span></code>  attribute of <code class="docutils literal"><span class="pre">&#64;Alias</span></code>  annotation.</p>
<p>In the above example, the alias name for <code class="docutils literal"><span class="pre">com.example.domain.model.book.Author</span></code>  class is
<code class="docutils literal"><span class="pre">BookAuthor</span></code> .</p>
<p class="last">When a class with same name is stored in a different package, different alias names can be configured for each class by using this method.
However, in this guideline, it is recommended to design the class name such that duplication is avoided.
In the above example, <code class="docutils literal"><span class="pre">BookAuthor</span></code>  and <code class="docutils literal"><span class="pre">ArticleAuthor</span></code>  should be considered as class names.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>An alias name for TypeAlias is applied in the following priority order.</p>
<blockquote class="last">
<div><ul class="simple">
<li>Value specified for <code class="docutils literal"><span class="pre">alias</span></code>  attribute of <code class="docutils literal"><span class="pre">typeAlias</span></code>  element</li>
<li>Value specified for <code class="docutils literal"><span class="pre">value</span></code>  attribute of <code class="docutils literal"><span class="pre">&#64;Alias</span></code>  annotation</li>
<li>Alias name assigned as default (part after removing the package name from fully qualified class name)</li>
</ul>
</div></blockquote>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="sql-switching-by-the-database">
<span id="dataaccessmybatis3appendixswitchingsqlbydatabase"></span><h3><a class="toc-backref" href="#id96">5.2.4.3. SQL switching by the database</a><a class="headerlink" href="#sql-switching-by-the-database" title="Permalink to this headline">¶</a></h3>
<p>MyBatis3 provides a mechanism (<code class="docutils literal"><span class="pre">org.apache.ibatis.mapping.VendorDatabaseIdProvider</span></code>) wherein vendor information of database that is connected from JDBC driver, is fetched
and SQL to be used is switched.</p>
<p>This mechanism is effective when building an application that can support multiple databases as operating environment.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In this guideline, it is recommended to manage the components and configuration file that are dependent on the environment by a sub project called [projectName]-env
and create components and configuration file that are in execution environment at the time of building.</p>
<p>[projectName]-env is a sub-project to absorb differences in each of the following</p>
<ul class="simple">
<li>Development environment (local PC environment)</li>
<li>Various test environments</li>
<li>Commercial environment</li>
</ul>
<p>It can also be used in the development of an application that supports multiple databases.</p>
<p>Basically, it is recommended to manage environment-dependent components and configuration file
by using a sub-project called [projectName]-env.
However, the mechanism below can also be used if only a minor SQL difference is to be absorbed.</p>
<p class="last"><strong>Architects should try to achieve a uniform implementation for overall application by clearly identifying a guideline</strong>
<strong>on how to implement SQL environment dependency based on the differences in the database.</strong></p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Bean is defined in <code class="file docutils literal"><span class="pre">projectName-domain/src/main/resources/META-INF/spring/projectName-infra.xml</span></code>.</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:mybatis=</span><span class="s">&quot;http://mybatis.org/schema/mybatis-spring&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;</span>
<span class="s">        http://www.springframework.org/schema/beans</span>
<span class="s">        http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">        http://mybatis.org/schema/mybatis-spring</span>
<span class="s">        http://mybatis.org/schema/mybatis-spring.xsd</span>
<span class="s">    &quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&quot;classpath:/META-INF/spring/projectName-env.xml&quot;</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;databaseIdProvider&quot;</span>
          <span class="na">class=</span><span class="s">&quot;org.apache.ibatis.mapping.VendorDatabaseIdProvider&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- (2) --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;properties&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;props&gt;</span>
                <span class="nt">&lt;prop</span> <span class="na">key=</span><span class="s">&quot;H2&quot;</span><span class="nt">&gt;</span>h2<span class="nt">&lt;/prop&gt;</span>
                <span class="nt">&lt;prop</span> <span class="na">key=</span><span class="s">&quot;PostgreSQL&quot;</span><span class="nt">&gt;</span>postgresql<span class="nt">&lt;/prop&gt;</span>
            <span class="nt">&lt;/props&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;sqlSessionFactory&quot;</span>
        <span class="na">class=</span><span class="s">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span> <span class="nt">/&gt;</span>
        <span class="c">&lt;!-- (3) --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;databaseIdProvider&quot;</span> <span class="na">ref=</span><span class="s">&quot;databaseIdProvider&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;configLocation&quot;</span>
            <span class="na">value=</span><span class="s">&quot;classpath:/META-INF/mybatis/mybatis-config.xml&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="nt">&lt;mybatis:scan</span> <span class="na">base-package=</span><span class="s">&quot;com.example.domain.repository&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Define a Bean for <code class="docutils literal"><span class="pre">VendorDatabaseIdProvider</span></code> provided by MyBatis3.</p>
<p class="last"><code class="docutils literal"><span class="pre">VendorDatabaseIdProvider</span></code> is a class
for handling a product name (<code class="docutils literal"><span class="pre">java.sql.DatabaseMetaData#getDatabaseProductName()</span></code>) of a database that is fetched from JDBC driver, as a database ID.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Specify the mapping of database product name fetched from JDBC driver and database ID in <code class="docutils literal"><span class="pre">properties</span></code> property.</p>
<p class="last">Refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/configuration.html#databaseIdProvider">MyBatis3 REFERENCE DOCUMENTATION(Configuration-databaseIdProvider-)</a>&#8221; for specifications of mapping.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p class="first">Specify <code class="docutils literal"><span class="pre">DatabaseIdProvider</span></code> defined in (1) for the <code class="docutils literal"><span class="pre">databaseIdProvider</span></code> property of <code class="docutils literal"><span class="pre">SqlSessionFactoryBean</span></code> that uses database ID</p>
<p class="last">By specifying this, it is possible to refer the database ID from mapping file.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In this guideline, it is recommended to use a method to map the product name of database and database ID, by specifying <code class="docutils literal"><span class="pre">properties</span></code>property</p>
<p>This is due to possible change in the product name of database fetched from JDBC driver, based on the JDBC version.</p>
<p class="last">When <code class="docutils literal"><span class="pre">properties</span></code> property is used, the difference between product names of each version to be used can be managed at a single location.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Implementing mapping file.</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&quot;create&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;selectKey</span> <span class="na">keyProperty=</span><span class="s">&quot;todoId&quot;</span> <span class="na">resultType=</span><span class="s">&quot;string&quot;</span> <span class="na">order=</span><span class="s">&quot;BEFORE&quot;</span>
               <span class="na">databaseId=</span><span class="s">&quot;h2&quot;</span><span class="nt">&gt;</span>
        SELECT RANDOM_UUID()
    <span class="nt">&lt;/selectKey&gt;</span>
    <span class="nt">&lt;selectKey</span> <span class="na">keyProperty=</span><span class="s">&quot;todoId&quot;</span> <span class="na">resultType=</span><span class="s">&quot;string&quot;</span> <span class="na">order=</span><span class="s">&quot;BEFORE&quot;</span>
               <span class="na">databaseId=</span><span class="s">&quot;postgresql&quot;</span><span class="nt">&gt;</span>
        SELECT UUID_GENERATE_V4()
    <span class="nt">&lt;/selectKey&gt;</span>

    INSERT INTO
      t_todo
    (
        todo_id
        ,todo_title
        ,finished
        ,created_at
        ,version
    )
    VALUES
    (
        #{todoId}
        ,#{todoTitle}
        ,#{finished}
        ,#{createdAt}
        ,#{version}
    )
<span class="nt">&lt;/insert&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">When statement elements (<code class="docutils literal"><span class="pre">select</span></code> element, <code class="docutils literal"><span class="pre">update</span></code> element, <code class="docutils literal"><span class="pre">sql</span></code> element etc.) are to be changed for each database,
specify the database ID in <code class="docutils literal"><span class="pre">databaseId</span></code> attribute of each element.</p>
<p>When <code class="docutils literal"><span class="pre">databaseId</span></code> attribute is specified, the statement element that matches with database ID is used.</p>
<p class="last">In the above example, ID is generated, by calling the UUID generation function specific for each database.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>In the above example, <code class="docutils literal"><span class="pre">UUID_GENERATE_V4()</span></code> is called as the UUID generation function for PostgreSQL.
However, this function belongs to a sub-module called <a class="reference external" href="http://www.postgresql.org/docs/9.3/static/uuid-ossp.html">uuid-ossp</a>.</p>
<p class="last">When this function is to be used, uuid-ossp module should be enabled.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Database ID can also be referred in OGNL base expression (Expression language).</p>
<p>It signifies that database ID can be used as a condition for dynamic SQL.
How to implement is given below.</p>
<blockquote class="last">
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findAllByCreatedAtBefore&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;_int&quot;</span> <span class="na">resultType=</span><span class="s">&quot;Todo&quot;</span><span class="nt">&gt;</span>
    SELECT
        todo_id,
        todo_title,
        finished,
        created_at,
        version
    FROM
        t_todo
    WHERE
        <span class="nt">&lt;choose&gt;</span>
            <span class="c">&lt;!-- (2) --&gt;</span>
            <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">&quot;_databaseId == &#39;h2&#39;&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;bind</span> <span class="na">name=</span><span class="s">&quot;criteriaDate&quot;</span>
                      <span class="na">value=</span><span class="s">&quot;&#39;DATEADD(\&#39;DAY\&#39;,#{days} * -1,#{currentDate})&#39;&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/when&gt;</span>
            <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">&quot;_databaseId == &#39;postgresql&#39;&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;bind</span> <span class="na">name=</span><span class="s">&quot;criteriaDate&quot;</span>
                      <span class="na">value=</span><span class="s">&quot;&#39;#{currentDate}::DATE - (#{days} * INTERVAL \&#39;1 DAY\&#39;)&#39;&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/when&gt;</span>
        <span class="nt">&lt;/choose&gt;</span>
        <span class="cp">&lt;![CDATA[</span>
<span class="cp">            created_at &lt; ${criteriaDate}</span>
<span class="cp">        ]]&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Database ID is stored in a specific variable called <code class="docutils literal"><span class="pre">_databaseId</span></code>, in a OGNL base expression (Expression language).</p>
<p class="last">In the above example, the condition for extracting records that are created prior to &#8220;System date - specified date&#8221; is specified by using database function.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="how-to-fetch-a-related-entity-by-a-single-sql">
<span id="dataaccessmybatis3appendixacquirerelatedobjectsatonce"></span><h3><a class="toc-backref" href="#id97">5.2.4.4. How to fetch a related Entity by a single SQL</a><a class="headerlink" href="#how-to-fetch-a-related-entity-by-a-single-sql" title="Permalink to this headline">¶</a></h3>
<p>How to fetch a main Entity and a related Entity by a single SQL is explained below.</p>
<p>When a mechanism that fetches a main Entity and a related Entity together is to be used,
it is not necessary to build an Entity (JavaBean) in the Service class and Service class
can solely focus on implementation of business logic (business rules).</p>
<div class="line-block">
<div class="line">Further, this method can also be used to avoid the N+1.</div>
<div class="line">Refer to &#8220;<a class="reference internal" href="DataAccessCommon.html#data-access-common-howtosolve-n-plus-1"><span>How to resolve N+1</span></a>&#8221; for N+1.</div>
</div>
<blockquote>
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>It is important to note the following points when main Entity and related Entity are to be fetched together.</p>
<ul class="simple">
<li>In the explanation below, all the related Entities are fetched together by a single SQL.
However, when it is to be used in the actual project,
only the related Entities that are required in the process should be fetched.
If unused related Entities are fetched together, it results in generation of unnecessary objects and as mapping process is performed,
it causes efficiency deterioration.
<strong>Particularly, in the SQL that performs list search, in many cases, only the required related Entities are fetched.</strong></li>
</ul>
<p></p>
<ul>
<li><p class="first">For the related Entities which are used less frequently, the entities can be fetched independently without fetching them together.</p>
<p>If the related Entities that are used less frequently are fetched simultaneously,
unnecessary objects are generated and as mapping process is performed, it can cause efficiency deterioration.</p>
</li>
</ul>
<p></p>
<ul class="last simple">
<li>When multiple related Entities with 1:N relation are to be included,
it is advisable to adopt the method wherein the main Entity and related Entity are fetched separately.
When there are multiple related Entities with 1:N relation,
it becomes necessary to fetch unnecessary data from DB causing deterioration inefficiency.
Refer to &#8220;<a class="reference internal" href="DataAccessCommon.html#data-access-common-howtosolve-n-plus-1"><span>How to resolve N+1</span></a>&#8221; for how to fetch main Entity and related Entity separately.</li>
</ul>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Following methods are provided when it is necessary to separately fetch the related Entities that are used less frequently.</p>
<ul class="simple">
<li>By calling a method (SQL) that fetches a related Entity in the process of Service class.</li>
<li>By marking the related Entity as &#8220;Lazy Load&#8221; and transparently executing the SQL when Getter method is called.</li>
</ul>
<p>When &#8220;Lazy Load&#8221; mechanism is used,
it is not necessary to build an Entity (JavaBean) in Service class and
Service class can solely focus on implementation of business logic (business rules).</p>
<p><strong>When &#8220;Lazy Load&#8221; is used in SQL that performs list search, N+1 can occur. Hence adequate care must be taken.</strong></p>
<p class="last">Refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3appendixnestedselectlazysetting"><span>Settings to apply Lazy Load for related Entity</span></a>&#8221; for how to use &#8220;Lazy Load&#8221;.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>An implementation example is explained below wherein order data handled by a shopping site
is fetched together in a single SQL and mapped in main Entity and related Entity.</p>
<p>The implementation method explained here is just an example.
MyBatis3 provides a lot of functions that are not explained in this section and can perform a much higher level of mapping.</p>
<p>Refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/sqlmap-xml.html#Result_Maps">MyBatis3 REFERENCE DOCUMENTATION(Mapper XML Files-Result Maps-)</a> &#8221; for details of mapping function of MyBatis3.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="table-layout-and-data">
<span id="dataaccessmybatis3appendixacquirerelatedobjectsatoncetable"></span><h4><a class="toc-backref" href="#id98">5.2.4.4.1. Table layout and data</a><a class="headerlink" href="#table-layout-and-data" title="Permalink to this headline">¶</a></h4>
<p>Table used in the explanation is as given below.</p>
<blockquote>
<div><div class="figure align-center" id="id16">
<a class="reference internal image-reference" href="../_images/service_entity_table_layout.png"><img alt="ER diagram" src="../_images/service_entity_table_layout.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - ER diagram</strong></span></p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="17%" />
<col width="17%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Category</th>
<th class="head">Table name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Transaction system</td>
<td>t_order</td>
<td><p class="first">A table that stores order data.</p>
<p class="last">1 record is stored for one order.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>&nbsp;</td>
<td>t_order_item</td>
<td><p class="first">A table that stores the product data purchased by one order.</p>
<p class="last">When multiple products are purchased in a single order, the number of product records is stored.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>&nbsp;</td>
<td>t_order_coupon</td>
<td><p class="first">A table that stores data of coupons that are used in a single order.</p>
<p class="last">When multiple coupons are used in a single order, the number of coupon records is stored.
When coupons are not used, records are not stored.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>Master system</td>
<td>m_item</td>
<td>A master table that defines the product.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td>&nbsp;</td>
<td>m_category</td>
<td>A master table that defines product category.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td>&nbsp;</td>
<td>m_item_category</td>
<td><p class="first">A master table that defines the category to which a product belongs.</p>
<p class="last">It stores the mapping of product and category.
It is a model wherein one product can belong to multiple categories.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="7">
<li></li>
</ol>
</td>
<td>&nbsp;</td>
<td>m_coupon</td>
<td>A master table that defines a coupon.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="8">
<li></li>
</ol>
</td>
<td>Code</td>
<td>c_order_status</td>
<td>A code table that defines the order status.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>SQL (DDL and DML) for creating the storage data and the table layout used in the explanation are as follows.
(SQL is for H2 Database)</p>
<ul class="simple">
<li>DDL for creating a master table</li>
</ul>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">m_item</span> <span class="p">(</span>
    <span class="n">code</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">name</span> <span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span>
    <span class="n">price</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="k">CONSTRAINT</span> <span class="n">m_item_pk</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">m_category</span> <span class="p">(</span>
    <span class="n">code</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">name</span> <span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">m_category_pk</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">m_item_category</span> <span class="p">(</span>
    <span class="n">item_code</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">category_code</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">m_item_category_pk</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">item_code</span><span class="p">,</span> <span class="n">category_code</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">m_item_category_fk1</span> <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">item_code</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">m_item</span><span class="p">(</span><span class="n">code</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">m_item_category_fk2</span> <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">category_code</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">m_category</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">m_coupon</span> <span class="p">(</span>
    <span class="n">code</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">name</span> <span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span>
    <span class="n">price</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="k">CONSTRAINT</span> <span class="n">m_coupon_pk</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>DDL for creating a code table</li>
</ul>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">c_order_status</span> <span class="p">(</span>
    <span class="n">code</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">name</span> <span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">c_order_status_pk</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>DDL for creating a transaction table</li>
</ul>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">t_order</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="n">status_code</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">t_order_pk</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">t_order_fk</span> <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">status_code</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">c_order_status</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">t_order_item</span> <span class="p">(</span>
    <span class="n">order_id</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="n">item_code</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">quantity</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="k">CONSTRAINT</span> <span class="n">t_order_item_pk</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">order_id</span><span class="p">,</span> <span class="n">item_code</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">t_order_item_fk1</span> <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">order_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">t_order</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">t_order_item_fk2</span> <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">item_code</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">m_item</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">t_order_coupon</span> <span class="p">(</span>
    <span class="n">order_id</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="n">coupon_code</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">t_order_coupon_pk</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">order_id</span><span class="p">,</span> <span class="n">coupon_code</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">t_order_coupon_fk1</span> <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">order_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">t_order</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">t_order_coupon_fk2</span> <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">coupon_code</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">m_coupon</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>DML for data input</li>
</ul>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- Setup master tables</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">m_item</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;ITM0000001&#39;</span><span class="p">,</span><span class="s1">&#39;Orange juice&#39;</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">m_item</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;ITM0000002&#39;</span><span class="p">,</span><span class="s1">&#39;NotePC&#39;</span><span class="p">,</span><span class="mi">100000</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">m_category</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;CTG0000001&#39;</span><span class="p">,</span><span class="s1">&#39;Drink&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">m_category</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;CTG0000002&#39;</span><span class="p">,</span><span class="s1">&#39;PC&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">m_category</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;CTG0000003&#39;</span><span class="p">,</span><span class="s1">&#39;Hot selling&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">m_item_category</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;ITM0000001&#39;</span><span class="p">,</span><span class="s1">&#39;CTG0000001&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">m_item_category</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;ITM0000002&#39;</span><span class="p">,</span><span class="s1">&#39;CTG0000002&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">m_item_category</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;ITM0000002&#39;</span><span class="p">,</span><span class="s1">&#39;CTG0000003&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">m_coupon</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;CPN0000001&#39;</span><span class="p">,</span><span class="s1">&#39;Join coupon&#39;</span><span class="p">,</span><span class="mi">3000</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">m_coupon</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;CPN0000002&#39;</span><span class="p">,</span><span class="s1">&#39;PC coupon&#39;</span><span class="p">,</span><span class="mi">30000</span><span class="p">);</span>

<span class="c1">-- Setup code tables</span>
<span class="k">INSERT</span>  <span class="k">INTO</span>  <span class="n">c_order_status</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;accepted&#39;</span><span class="p">,</span><span class="s1">&#39;Order accepted&#39;</span><span class="p">);</span>
<span class="k">INSERT</span>  <span class="k">INTO</span>  <span class="n">c_order_status</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;checking&#39;</span><span class="p">,</span><span class="s1">&#39;Stock checking&#39;</span><span class="p">);</span>
<span class="k">INSERT</span>  <span class="k">INTO</span>  <span class="n">c_order_status</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;shipped&#39;</span><span class="p">,</span><span class="s1">&#39;Item Shipped&#39;</span><span class="p">);</span>

<span class="c1">-- Setup transaction tables</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t_order</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;accepted&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t_order</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;checking&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t_order_item</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;ITM0000001&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t_order_item</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;ITM0000002&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t_order_item</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;ITM0000001&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t_order_item</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;ITM0000002&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t_order_coupon</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;CPN0000001&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t_order_coupon</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;CPN0000002&#39;</span><span class="p">);</span>

<span class="k">COMMIT</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="entity-class-diagram">
<span id="dataaccessmybatis3appendixacquirerelatedobjectsatonceentity"></span><h4><a class="toc-backref" href="#id99">5.2.4.4.2. Entity class diagram</a><a class="headerlink" href="#entity-class-diagram" title="Permalink to this headline">¶</a></h4>
<p>In the implementation example, the records stored in the table above are mapped in the following Entity (JavaBean).</p>
<blockquote>
<div><div class="figure align-center" id="id17">
<a class="reference internal image-reference" href="../_images/dataaccess_entity.png"><img alt="Class(JavaBean) diagram" src="../_images/dataaccess_entity.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - Class(JavaBean) diagram</strong></span></p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="17%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Class name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Order</td>
<td><p class="first">JavaBean that represents 1 record of t_order table.</p>
<p>A single record of <code class="docutils literal"><span class="pre">OrderStatus</span></code> and multiple records of <code class="docutils literal"><span class="pre">OrderItem</span></code> and <code class="docutils literal"><span class="pre">OrderCoupon</span></code> are stored as related Entities.</p>
<blockquote class="last">
<div><div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Order</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">OrderStatus</span> <span class="n">orderStatus</span><span class="o">;</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">orderItems</span><span class="o">;</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderCoupon</span><span class="o">&gt;</span> <span class="n">orderCoupons</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>OrderItem</td>
<td><p class="first">JavaBean that represents 1 record of t_order_item table.</p>
<p><code class="docutils literal"><span class="pre">Item</span></code> is stored as related Entity.</p>
<blockquote class="last">
<div><div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderItem</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">orderId</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Item</span> <span class="n">item</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">quantity</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>OrderCoupon</td>
<td><p class="first">A JavaBean that represents 1 record of t_order_coupon table.</p>
<p><code class="docutils literal"><span class="pre">Coupon</span></code> is stored as related Entity.</p>
<blockquote class="last">
<div><div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderCoupon</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">orderId</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Coupon</span> <span class="n">coupon</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>Item</td>
<td><p class="first">JavaBean that represents 1 record of m_item table.</p>
<p>Multiple, associated <code class="docutils literal"><span class="pre">Category</span></code> records are stored as related objects.
Mapping with <code class="docutils literal"><span class="pre">Category</span></code> is performed by m_item_category table.</p>
<blockquote class="last">
<div><div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">code</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">price</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">categories</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td>Category</td>
<td><p class="first">JavaBean that represents 1 record of m_category table.</p>
<blockquote class="last">
<div><div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Category</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">code</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td>Coupon</td>
<td><p class="first">JavaBean that represents 1 record of m_coupon table.</p>
<blockquote class="last">
<div><div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Coupon</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">code</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">price</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="7">
<li></li>
</ol>
</td>
<td>OrderStatus</td>
<td><p class="first">A JavaBean that represents 1 record of c_order_status table.</p>
<blockquote class="last">
<div><div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderStatus</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">code</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="implementation-of-repository-interface">
<span id="dataaccessmybatis3appendixacquirerelatedobjectsatoncerepository"></span><h4><a class="toc-backref" href="#id100">5.2.4.4.3. Implementation of Repository interface</a><a class="headerlink" href="#implementation-of-repository-interface" title="Permalink to this headline">¶</a></h4>
<p>Following methods are implemented in the example.</p>
<ul class="simple">
<li>A method that fetches 1 record of Order object (<code class="docutils literal"><span class="pre">findOne</span></code>)</li>
<li>A method that fetches an Order object of corresponding page (<code class="docutils literal"><span class="pre">findPage</span></code>)</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="nn">com.example.domain.repository.order</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.domain.model.Order</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">OrderRepository</span> <span class="o">{</span>

    <span class="n">Order</span> <span class="nf">findOne</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="nf">findPage</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;pageable&quot;</span><span class="o">)</span> <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">);</span>

<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="sql-implementation">
<span id="dataaccessmybatis3appendixacquirerelatedobjectsatoncesql"></span><h4><a class="toc-backref" href="#id101">5.2.4.4.4. SQL implementation</a><a class="headerlink" href="#sql-implementation" title="Permalink to this headline">¶</a></h4>
<p>When related Entities are to be fetched together by a single SQL,
JOIN is performed on the tables to be fetched and all the records required for mapping are fetched.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot; &gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.order.OrderRepository&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;sql</span> <span class="na">id=</span><span class="s">&quot;selectFromJoin&quot;</span><span class="nt">&gt;</span>
        SELECT
            /* (2) */
            o.id,
            /* (3) */
            o.status_code,
            os.name AS status_name,
            /* (4) */
            oi.quantity,
            i.code AS item_code,
            i.name AS item_name,
            i.price AS item_price,
            /* (5) */
            ct.code AS category_code,
            ct.name AS category_name,
            /* (6) */
            cp.code AS coupon_code,
            cp.name AS coupon_name,
            cp.price AS coupon_price
        FROM
            ${orderTable} o
        /* (7) */
        INNER JOIN c_order_status os ON os.code = o.status_code
        INNER JOIN t_order_item oi ON oi.order_id = o.id
        INNER JOIN m_item i ON i.code = oi.item_code
        INNER JOIN m_item_category ic ON ic.item_code = i.code
        INNER JOIN m_category ct ON ct.code = ic.category_code
        /* (8) */
        LEFT JOIN t_order_coupon oc ON oc.order_id = o.id
        LEFT JOIN m_coupon cp ON cp.code = oc.coupon_code
    <span class="nt">&lt;/sql&gt;</span>

    <span class="c">&lt;!-- (9) --&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;_int&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;orderResultMap&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;bind</span> <span class="na">name=</span><span class="s">&quot;orderTable&quot;</span> <span class="na">value=</span><span class="s">&quot;&#39;t_order&#39;&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;include</span> <span class="na">refid=</span><span class="s">&quot;selectFromJoin&quot;</span><span class="nt">/&gt;</span>
        WHERE
            o.id = #{id}
        ORDER BY
            item_code ASC,
            category_code ASC,
            coupon_code ASC
    <span class="nt">&lt;/select&gt;</span>

    <span class="c">&lt;!-- (10) --&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findPage&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;orderResultMap&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;bind</span> <span class="na">name=</span><span class="s">&quot;orderTable&quot;</span> <span class="na">value=</span><span class="s">&quot;</span>
<span class="s">            &#39;(</span>
<span class="s">              SELECT</span>
<span class="s">                  *</span>
<span class="s">              FROM</span>
<span class="s">                  t_order</span>
<span class="s">              ORDER BY</span>
<span class="s">                  id DESC</span>
<span class="s">              LIMIT #{pageable.pageSize}</span>
<span class="s">              OFFSET #{pageable.offset}</span>
<span class="s">              )&#39;&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;include</span> <span class="na">refid=</span><span class="s">&quot;selectFromJoin&quot;</span><span class="nt">/&gt;</span>
        ORDER BY
            id DESC,
            item_code ASC,
            category_code ASC,
            coupon_code ASC
    <span class="nt">&lt;/select&gt;</span>

    <span class="c">&lt;!-- ... --&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Implement SELECT clause, FROM clause and JOIN clause for <code class="docutils literal"><span class="pre">findOne</span></code> method and <code class="docutils literal"><span class="pre">findPage</span></code> method.</p>
<p class="last">In the above example, the common location for <code class="docutils literal"><span class="pre">findOne</span></code> method and <code class="docutils literal"><span class="pre">findPage</span></code> method is standardized.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>Fetch the data required for generating an Order object.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p class="first">Fetch the data required for generating an OrderStatus object.</p>
<p class="last">Care must be taken to avoid duplicating the column name to be fetched.
In the above example, <code class="docutils literal"><span class="pre">name</span></code> column is duplicated.
Hence, an alias name (<code class="docutils literal"><span class="pre">status_</span></code> prefix) is specified using AS clause.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td><p class="first">Fetch the data required for generating an OrderItem object and Item object.</p>
<p class="last">Care must be taken to avoid duplication of column name to be fetched.
In the above example, <code class="docutils literal"><span class="pre">code</span></code>,<code class="docutils literal"><span class="pre">name</span></code> and  <code class="docutils literal"><span class="pre">price</span></code> are duplicated.
Hence, an alias name (<code class="docutils literal"><span class="pre">item_</span></code> prefix) is specified using AS clause.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td><p class="first">Fetch the data required for generating Category object.</p>
<p class="last">Care must be taken to avoid duplication of column name to be fetched.
In the above example, <code class="docutils literal"><span class="pre">code</span></code> and <code class="docutils literal"><span class="pre">name</span></code> are duplicated.
Hence, an alias name (<code class="docutils literal"><span class="pre">category_</span></code> prefix) is specified using AS clause.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td><p class="first">Fetch the data required for generating an OrderCoupon object and Coupon object.</p>
<p class="last">Care must be taken to avoid duplication of column name to be fetched.
In the above example, <code class="docutils literal"><span class="pre">code</span></code>,<code class="docutils literal"><span class="pre">name</span></code> and <code class="docutils literal"><span class="pre">price</span></code>are duplicated.
Hence, alias name (<code class="docutils literal"><span class="pre">coupon_</span></code> prefix) is specified using AS clause.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="7">
<li></li>
</ol>
</td>
<td>Perform JOIN for the tables that store data required for generating related objects.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="8">
<li></li>
</ol>
</td>
<td>Perform Outer JOIN for the table wherein records might not be stored.
When coupon is not used, it is necessary to perform Outer JOIN since records are not stored in t_order_coupon.
This is also applicable for t_coupon to be joined with t_order_coupon.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="9">
<li></li>
</ol>
</td>
<td><p class="first">Implement the SQL for <code class="docutils literal"><span class="pre">findOne</span></code> method.</p>
<p class="last">Specify alignment sequence of the Entity with 1:N relation, in ORDER BY clause.
In the above example, sorting is done in the ascending order of PK.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="10">
<li></li>
</ol>
</td>
<td>Implement SQL for <code class="docutils literal"><span class="pre">findPage</span></code> method.
Specify alignment sequence of Entity that has a 1:N relation with Order, in ORDER BY clause.
In the above example, Order is sorted in descending sequence of PK (new sequence) and related Entity is sorted in the ascending order of PK.</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>When it is necessary to perform a pagination search while fetching related Entities with 1:N relation together by a single SQL,
<code class="docutils literal"><span class="pre">RowBounds</span></code> provided by MyBatis3 cannot be used.</p>
<p>Following can be considered as alternative methods.</p>
<ul class="last simple">
<li>At first, a method is called which searches only main Entity and related Entities are then fetched by calling a separate method.</li>
<li>A virtual table that stores only main Entity within the page range is created by SQL
and all the records necessary for mapping are fetched by performing JOIN on the records of virtual table (<code class="docutils literal"><span class="pre">findPage</span></code> shown in the above example is implemented using this pattern)</li>
</ul>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>If SQL (findPage) above is executed, following records are fetched.
The order records are 2. However, a total of 9 records are fetched since the records are joined with a related table that stores multiple records.</p>
<p>The breakdown is</p>
<ul class="simple">
<li>1st to 3rd rows are records for generating <code class="docutils literal"><span class="pre">Order</span></code> object with order ID <code class="docutils literal"><span class="pre">2</span></code></li>
<li>4th to 9th rows are records for generating <code class="docutils literal"><span class="pre">Order</span></code> object with order ID <code class="docutils literal"><span class="pre">1</span></code></li>
</ul>
<p>How to map search results (<code class="docutils literal"><span class="pre">ResultSet</span></code>) to JavaBean is explained below using a record wherein order ID is <code class="docutils literal"><span class="pre">1</span></code>.</p>
<blockquote>
<div><div class="figure align-center" id="id18">
<a class="reference internal image-reference" href="../_images/dataaccess_sql_result.png"><img alt="Result Set of findPage" src="../_images/dataaccess_sql_result.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - Result Set of findPage</strong></span></p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="implementation-of-mapping">
<span id="dataaccessmybatis3appendixacquirerelatedobjectsatoncemapping"></span><h4><a class="toc-backref" href="#id102">5.2.4.4.5. Implementation of mapping</a><a class="headerlink" href="#implementation-of-mapping" title="Permalink to this headline">¶</a></h4>
<p>The definition for mapping the records described above in the <code class="docutils literal"><span class="pre">Order</span></code> object and related Entity is given below.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot; &gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.domain.repository.order.OrderRepository&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- ... --&gt;</span>

    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;orderResultMap&quot;</span> <span class="na">type=</span><span class="s">&quot;Order&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;id&quot;</span> <span class="na">column=</span><span class="s">&quot;id&quot;</span><span class="nt">/&gt;</span>
        <span class="c">&lt;!-- (2) --&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;orderStatus.code&quot;</span> <span class="na">column=</span><span class="s">&quot;status_code&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;orderStatus.name&quot;</span> <span class="na">column=</span><span class="s">&quot;status_name&quot;</span> <span class="nt">/&gt;</span>
        <span class="c">&lt;!-- (3) --&gt;</span>
        <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&quot;orderItems&quot;</span> <span class="na">ofType=</span><span class="s">&quot;OrderItem&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;orderId&quot;</span> <span class="na">column=</span><span class="s">&quot;id&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;item.code&quot;</span> <span class="na">column=</span><span class="s">&quot;item_code&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;quantity&quot;</span> <span class="na">column=</span><span class="s">&quot;quantity&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;association</span> <span class="na">property=</span><span class="s">&quot;item&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;itemResultMap&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/collection&gt;</span>
        <span class="c">&lt;!-- (4) --&gt;</span>
        <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&quot;orderCoupons&quot;</span> <span class="na">ofType=</span><span class="s">&quot;OrderCoupon&quot;</span>
                    <span class="na">notNullColumn=</span><span class="s">&quot;coupon_code&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;orderId&quot;</span> <span class="na">column=</span><span class="s">&quot;id&quot;</span><span class="nt">/&gt;</span>
            <span class="c">&lt;!-- (5) --&gt;</span>
            <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;coupon.code&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_code&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;coupon.name&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_name&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;coupon.price&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_price&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/collection&gt;</span>
    <span class="nt">&lt;/resultMap&gt;</span>

    <span class="c">&lt;!-- (6) --&gt;</span>
    <span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;itemResultMap&quot;</span> <span class="na">type=</span><span class="s">&quot;Item&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;code&quot;</span> <span class="na">column=</span><span class="s">&quot;item_code&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;name&quot;</span> <span class="na">column=</span><span class="s">&quot;item_name&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;price&quot;</span> <span class="na">column=</span><span class="s">&quot;item_price&quot;</span><span class="nt">/&gt;</span>
        <span class="c">&lt;!-- (7) --&gt;</span>
        <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&quot;categories&quot;</span> <span class="na">ofType=</span><span class="s">&quot;Category&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;code&quot;</span> <span class="na">column=</span><span class="s">&quot;category_code&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;name&quot;</span> <span class="na">column=</span><span class="s">&quot;category_name&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/collection&gt;</span>
    <span class="nt">&lt;/resultMap&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Definition to map fetched records in <code class="docutils literal"><span class="pre">Order</span></code> object.
Perform mapping of related Entities (<code class="docutils literal"><span class="pre">OrderStatus</span></code>, <code class="docutils literal"><span class="pre">OrderItem</span></code> and <code class="docutils literal"><span class="pre">OrderCoupon</span></code>).</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>Definition to map fetched records in <code class="docutils literal"><span class="pre">OrderStatus</span></code> object.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>Definition to map fetched records in <code class="docutils literal"><span class="pre">OrderItem</span></code> object.
Mapping to related Entities (<code class="docutils literal"><span class="pre">Item</span></code>) is delegated to another <code class="docutils literal"><span class="pre">resultMap</span></code>(6).</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>Definition to map fetched records in <code class="docutils literal"><span class="pre">OrderCoupon</span></code> object.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td>Definition to map fetched records in <code class="docutils literal"><span class="pre">Coupon</span></code> object.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td>Definition to map fetched records in <code class="docutils literal"><span class="pre">Item</span></code> object.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="7">
<li></li>
</ol>
</td>
<td>Definition to map fetched records in <code class="docutils literal"><span class="pre">Category</span></code>object.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="mapping-to-order-object">
<span id="dataaccessmybatis3appendixacquirerelatedobjectsatoncemappingorder"></span><h5>5.2.4.4.5.1. Mapping to Order object<a class="headerlink" href="#mapping-to-order-object" title="Permalink to this headline">¶</a></h5>
<p>Perform mapping to <code class="docutils literal"><span class="pre">Order</span></code> object.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="hll"><span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll"><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;orderResultMap&quot;</span> <span class="na">type=</span><span class="s">&quot;Order&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">    <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;id&quot;</span> <span class="na">column=</span><span class="s">&quot;id&quot;</span><span class="nt">/&gt;</span>
</span>    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;orderStatus.code&quot;</span> <span class="na">column=</span><span class="s">&quot;status_code&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;orderStatus.name&quot;</span> <span class="na">column=</span><span class="s">&quot;status_name&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&quot;orderItems&quot;</span> <span class="na">ofType=</span><span class="s">&quot;OrderItem&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;orderId&quot;</span> <span class="na">column=</span><span class="s">&quot;id&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;item.code&quot;</span> <span class="na">column=</span><span class="s">&quot;item_code&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;quantity&quot;</span> <span class="na">column=</span><span class="s">&quot;quantity&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;association</span> <span class="na">property=</span><span class="s">&quot;item&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;itemResultMap&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/collection&gt;</span>
    <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&quot;orderCoupons&quot;</span> <span class="na">ofType=</span><span class="s">&quot;OrderCoupon&quot;</span>
                <span class="na">notNullColumn=</span><span class="s">&quot;coupon_code&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;orderId&quot;</span> <span class="na">column=</span><span class="s">&quot;id&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;coupon.code&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_code&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;coupon.name&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_name&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;coupon.price&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_price&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/collection&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>
</pre></div>
</div>
<div class="figure align-center" id="id19">
<a class="reference internal image-reference" href="../_images/dataaccess_resultmap_order.png"><img alt="ResultMap for Order" src="../_images/dataaccess_resultmap_order.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - ResultMap for Order</strong></span></p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Map search results to <code class="docutils literal"><span class="pre">Order</span></code> object.</p>
<p class="last">Specify the class to be mapped in <code class="docutils literal"><span class="pre">type</span></code> attribute.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Value of <code class="docutils literal"><span class="pre">id</span></code> column of fetched records is set in <code class="docutils literal"><span class="pre">Order#id</span></code> property.</p>
<p class="last">Since <code class="docutils literal"><span class="pre">id</span></code> column is PK, mapping is performed by using <code class="docutils literal"><span class="pre">id</span></code> element.
If <code class="docutils literal"><span class="pre">id</span></code> element is used, records are grouped by the specified property values.
Basically, they are grouped in two groups - <code class="docutils literal"><span class="pre">id=1</span></code> and <code class="docutils literal"><span class="pre">id=2</span></code>.
Two <code class="docutils literal"><span class="pre">Order</span></code> objects are generated.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="mapping-to-orderstatus-object">
<span id="dataaccessmybatis3appendixacquirerelatedobjectsatoncemappingorderstatus"></span><h5>5.2.4.4.5.2. Mapping to OrderStatus object<a class="headerlink" href="#mapping-to-orderstatus-object" title="Permalink to this headline">¶</a></h5>
<p>Perform mapping to <code class="docutils literal"><span class="pre">OrderStatus</span></code> object.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p>For creating Entity class of &#8220;<a class="reference internal" href="../ImplementationAtEachLayer/DomainLayer.html#domainlayer-entity"><span>Implementation of Entity</span></a>&#8221;,
&#8220;Code table is handled as a basic type of java.lang.String rather than handling as an Entity.&#8221;.
This is because the data stored in the code table uses a different mechanism like &#8220;<a class="reference internal" href="Codelist.html"><em>Codelist</em></a>&#8221; etc.</p>
<p>The purpose of this section is to explain how to map to a related Entity (JavaBean),
hence the explanation on code table also being handled as an Entity is added.</p>
<p class="last">In the actual project, it is recommended to create an Entity based on the policies for creating an Entity class.</p>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;orderResultMap&quot;</span> <span class="na">type=</span><span class="s">&quot;Order&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;id&quot;</span> <span class="na">column=</span><span class="s">&quot;id&quot;</span><span class="nt">/&gt;</span>
<span class="hll">    <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;orderStatus.code&quot;</span> <span class="na">column=</span><span class="s">&quot;status_code&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">    <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;orderStatus.name&quot;</span> <span class="na">column=</span><span class="s">&quot;status_name&quot;</span> <span class="nt">/&gt;</span>
</span>    <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&quot;orderItems&quot;</span> <span class="na">ofType=</span><span class="s">&quot;OrderItem&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;orderId&quot;</span> <span class="na">column=</span><span class="s">&quot;id&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;item.code&quot;</span> <span class="na">column=</span><span class="s">&quot;item_code&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;quantity&quot;</span> <span class="na">column=</span><span class="s">&quot;quantity&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;association</span> <span class="na">property=</span><span class="s">&quot;item&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;itemResultMap&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/collection&gt;</span>
    <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&quot;orderCoupons&quot;</span> <span class="na">ofType=</span><span class="s">&quot;OrderCoupon&quot;</span>
                <span class="na">notNullColumn=</span><span class="s">&quot;coupon_code&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;orderId&quot;</span> <span class="na">column=</span><span class="s">&quot;id&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;coupon.code&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_code&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;coupon.name&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_name&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;coupon.price&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_price&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/collection&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>
</pre></div>
</div>
<div class="figure align-center" id="id20">
<a class="reference internal image-reference" href="../_images/dataaccess_resultmap_orderstatus.png"><img alt="ResultMap for OrderStatus" src="../_images/dataaccess_resultmap_orderstatus.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - ResultMap for OrderStatus</strong></span></p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Set the value of <code class="docutils literal"><span class="pre">status_code</span></code> column of fetched records
in <code class="docutils literal"><span class="pre">OrderStatus#code</span></code> property.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>Set the value of <code class="docutils literal"><span class="pre">status_name</span></code> column of fetched records
in <code class="docutils literal"><span class="pre">OrderStatus#name</span></code> property.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The value of records that are grouped in <code class="docutils literal"><span class="pre">id</span></code> column is set in <code class="docutils literal"><span class="pre">OrderStatus</span></code> object.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="mapping-to-orderitem-object">
<span id="dataaccessmybatis3appendixacquirerelatedobjectsatoncemappingorderitem"></span><h5>5.2.4.4.5.3. Mapping to OrderItem object<a class="headerlink" href="#mapping-to-orderitem-object" title="Permalink to this headline">¶</a></h5>
<p>Perform mapping to <code class="docutils literal"><span class="pre">OrderItem</span></code> object.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;orderResultMap&quot;</span> <span class="na">type=</span><span class="s">&quot;Order&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;id&quot;</span> <span class="na">column=</span><span class="s">&quot;id&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;orderStatus.code&quot;</span> <span class="na">column=</span><span class="s">&quot;status_code&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;orderStatus.name&quot;</span> <span class="na">column=</span><span class="s">&quot;status_name&quot;</span> <span class="nt">/&gt;</span>
<span class="hll">    <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&quot;orderItems&quot;</span> <span class="na">ofType=</span><span class="s">&quot;OrderItem&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;orderId&quot;</span> <span class="na">column=</span><span class="s">&quot;id&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;item.code&quot;</span> <span class="na">column=</span><span class="s">&quot;item_code&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- (4) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;quantity&quot;</span> <span class="na">column=</span><span class="s">&quot;quantity&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- (5) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;association</span> <span class="na">property=</span><span class="s">&quot;item&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;itemResultMap&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/collection&gt;</span>
</span>    <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&quot;orderCoupons&quot;</span> <span class="na">ofType=</span><span class="s">&quot;OrderCoupon&quot;</span>
                <span class="na">notNullColumn=</span><span class="s">&quot;coupon_code&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;orderId&quot;</span> <span class="na">column=</span><span class="s">&quot;id&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;coupon.code&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_code&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;coupon.name&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_name&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;coupon.price&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_price&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/collection&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>
</pre></div>
</div>
<div class="figure align-center" id="id21">
<a class="reference internal image-reference" href="../_images/dataaccess_resultmap_orderitem.png"><img alt="ResultMap for OrderItem" src="../_images/dataaccess_resultmap_orderitem.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - ResultMap for OrderItem</strong></span></p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Map search results in <code class="docutils literal"><span class="pre">OrderItem</span></code> object
and add to <code class="docutils literal"><span class="pre">Order#orderItems</span></code> property.</p>
<p class="last">When search results are to be mapped to the related Entities with 1:N relation, <code class="docutils literal"><span class="pre">collection</span></code> element is used.
Refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/sqlmap-xml.html#collection">MyBatis3 REFERENCE DOCUMENTATION(Mapper XML Files-collection-)</a>&#8221;
for details of &#8220;<code class="docutils literal"><span class="pre">collection</span></code> element.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Set the value of <code class="docutils literal"><span class="pre">id</span></code> column of fetched records in <code class="docutils literal"><span class="pre">OrderItem#orderId</span></code> property.</p>
<p class="last">Since <code class="docutils literal"><span class="pre">id</span></code> column is PK, the mapping is performed by using <code class="docutils literal"><span class="pre">id</span></code> element.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p class="first">Set the value of <code class="docutils literal"><span class="pre">item_code</span></code> column of fetched records in <code class="docutils literal"><span class="pre">Item#code</span></code> property.</p>
<p class="last">Since <code class="docutils literal"><span class="pre">item_code</span></code>column is PK, the mapping is performed by using <code class="docutils literal"><span class="pre">id</span></code> element.
If <code class="docutils literal"><span class="pre">id</span></code> element is used, the records are grouped in the specified property value.
Basically, they are grouped in two groups - <code class="docutils literal"><span class="pre">Item#code=ITM0000001</span></code> and <code class="docutils literal"><span class="pre">Item#code=ITM0000002</span></code>.
Two <code class="docutils literal"><span class="pre">OrderItem</span></code> objects are generated.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>Set the value of <code class="docutils literal"><span class="pre">quantity</span></code> column of fetched records in <code class="docutils literal"><span class="pre">OrderItem#quantity</span></code> property.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td><p class="first">Generation of <code class="docutils literal"><span class="pre">Item</span></code> object is delegated to a different <code class="docutils literal"><span class="pre">resultMap</span></code>,
and the generated object is set in <code class="docutils literal"><span class="pre">OrderItem#item</span></code> property.
For actual mapping,
refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3appendixacquirerelatedobjectsatoncemappingitem"><span>Mapping to Item object</span></a>&#8221; .</p>
<p class="last">When mapping is to be performed in the related Entities with a 1:1 relation, <code class="docutils literal"><span class="pre">association</span></code> element is used.
For details of <code class="docutils literal"><span class="pre">association</span></code> element,
refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/sqlmap-xml.html#association">MyBatis3 REFERENCE DOCUMENTATION (Mapper XML Files-association-)</a>&#8221; .</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In <code class="docutils literal"><span class="pre">OrderItem</span></code> object,
values of records that are grouped in <code class="docutils literal"><span class="pre">id</span></code> column and <code class="docutils literal"><span class="pre">item_code</span></code> column are set.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="mapping-to-item-object">
<span id="dataaccessmybatis3appendixacquirerelatedobjectsatoncemappingitem"></span><h5>5.2.4.4.5.4. Mapping to Item object<a class="headerlink" href="#mapping-to-item-object" title="Permalink to this headline">¶</a></h5>
<p>Perform mapping to <code class="docutils literal"><span class="pre">Item</span></code> object.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="hll"><span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll"><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;itemResultMap&quot;</span> <span class="na">type=</span><span class="s">&quot;Item&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">    <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;code&quot;</span> <span class="na">column=</span><span class="s">&quot;item_code&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">    <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;name&quot;</span> <span class="na">column=</span><span class="s">&quot;item_name&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">    <span class="c">&lt;!-- (4) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;price&quot;</span> <span class="na">column=</span><span class="s">&quot;item_price&quot;</span><span class="nt">/&gt;</span>
</span>    <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&quot;categories&quot;</span> <span class="na">ofType=</span><span class="s">&quot;Category&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;code&quot;</span> <span class="na">column=</span><span class="s">&quot;category_code&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;name&quot;</span> <span class="na">column=</span><span class="s">&quot;category_name&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/collection&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>
</pre></div>
</div>
<div class="figure align-center" id="id22">
<a class="reference internal image-reference" href="../_images/dataaccess_resultmap_item.png"><img alt="ResultMap for Item" src="../_images/dataaccess_resultmap_item.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - ResultMap for Item</strong></span></p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Map search results to <code class="docutils literal"><span class="pre">Item</span></code> object.</p>
<p class="last">Specify the class to be mapped in <code class="docutils literal"><span class="pre">type</span></code> attribute.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Set the value of <code class="docutils literal"><span class="pre">item_code</span></code> column of fetched records in <code class="docutils literal"><span class="pre">Item#code</span></code>.</p>
<p class="last">Since <code class="docutils literal"><span class="pre">item_code</span></code> column is PK, mapping is performed by using <code class="docutils literal"><span class="pre">id</span></code> element.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>Set the value of <code class="docutils literal"><span class="pre">item_name</span></code> column of fetched records in <code class="docutils literal"><span class="pre">Item#name</span></code>.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>Set the value of <code class="docutils literal"><span class="pre">item_price</span></code> column of fetched records in <code class="docutils literal"><span class="pre">Item#price</span></code>.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In <code class="docutils literal"><span class="pre">Item</span></code> object,
values of records that are grouped in <code class="docutils literal"><span class="pre">id</span></code> column and <code class="docutils literal"><span class="pre">item_code</span></code> column are set.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="mapping-to-category-object">
<span id="dataaccessmybatis3appendixacquirerelatedobjectsatoncemappingcategory"></span><h5>5.2.4.4.5.5. Mapping to Category object<a class="headerlink" href="#mapping-to-category-object" title="Permalink to this headline">¶</a></h5>
<p>Perform mapping to <code class="docutils literal"><span class="pre">Category</span></code> object.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;itemResultMap&quot;</span> <span class="na">type=</span><span class="s">&quot;Item&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;code&quot;</span> <span class="na">column=</span><span class="s">&quot;item_code&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;name&quot;</span> <span class="na">column=</span><span class="s">&quot;item_name&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;price&quot;</span> <span class="na">column=</span><span class="s">&quot;item_price&quot;</span><span class="nt">/&gt;</span>
<span class="hll">    <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&quot;categories&quot;</span> <span class="na">ofType=</span><span class="s">&quot;Category&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;code&quot;</span> <span class="na">column=</span><span class="s">&quot;category_code&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;name&quot;</span> <span class="na">column=</span><span class="s">&quot;category_name&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/collection&gt;</span>
</span><span class="nt">&lt;/resultMap&gt;</span>
</pre></div>
</div>
<div class="figure align-center" id="id23">
<a class="reference internal image-reference" href="../_images/dataaccess_resultmap_category.png"><img alt="ResultMap for Category" src="../_images/dataaccess_resultmap_category.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - ResultMap for Category</strong></span></p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Map the search results to <code class="docutils literal"><span class="pre">Category</span></code> object and add to <code class="docutils literal"><span class="pre">Item#categories</span></code> property.</p>
<p class="last">When mapping to related Entities with 1:N relation, <code class="docutils literal"><span class="pre">collection</span></code> element is used.
For details of <code class="docutils literal"><span class="pre">collection</span></code> element,
refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/sqlmap-xml.html#collection">MyBatis3 REFERENCE DOCUMENTATION (Mapper XML Files-collection-)</a>&#8221; .</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Set the value of <code class="docutils literal"><span class="pre">category_code</span></code> column of fetched records in <code class="docutils literal"><span class="pre">Category#code</span></code>.</p>
<p>Since <code class="docutils literal"><span class="pre">category_code</span></code> column is  PK, the mapping is performed by using <code class="docutils literal"><span class="pre">id</span></code> element.
If <code class="docutils literal"><span class="pre">id</span></code> element is used, the records are grouped by specified property values.</p>
<p>Basically, following objects are generated</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">Category</span></code> object of <code class="docutils literal"><span class="pre">Category#code=CTG0000001</span></code> as category of <code class="docutils literal"><span class="pre">Item#code=ITM0000001</span></code></li>
<li>Two <code class="docutils literal"><span class="pre">Category</span></code> objects of <code class="docutils literal"><span class="pre">Category#code=CTG0000002</span></code> and <code class="docutils literal"><span class="pre">Category#code=CTG0000003</span></code>as category of <code class="docutils literal"><span class="pre">Item#code=ITM0000002</span></code>.</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>Set the value of <code class="docutils literal"><span class="pre">category_name</span></code> column of fetched records in <code class="docutils literal"><span class="pre">Category#name</span></code> .</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In <code class="docutils literal"><span class="pre">Category</span></code> object,
values of records that are grouped in <code class="docutils literal"><span class="pre">id</span></code> column, <code class="docutils literal"><span class="pre">item_code</span></code> column and <code class="docutils literal"><span class="pre">category_code</span></code> column are set.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="mapping-to-ordercoupon-object">
<span id="dataaccessmybatis3appendixacquirerelatedobjectsatoncemappingordercoupon"></span><h5>5.2.4.4.5.6. Mapping to OrderCoupon object<a class="headerlink" href="#mapping-to-ordercoupon-object" title="Permalink to this headline">¶</a></h5>
<p>Perform mapping to <code class="docutils literal"><span class="pre">OrderCoupon</span></code> object.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;orderResultMap&quot;</span> <span class="na">type=</span><span class="s">&quot;Order&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;id&quot;</span> <span class="na">column=</span><span class="s">&quot;id&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;orderStatus.code&quot;</span> <span class="na">column=</span><span class="s">&quot;status_code&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;orderStatus.name&quot;</span> <span class="na">column=</span><span class="s">&quot;status_name&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&quot;orderItems&quot;</span> <span class="na">ofType=</span><span class="s">&quot;OrderItem&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;orderId&quot;</span> <span class="na">column=</span><span class="s">&quot;id&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;item.code&quot;</span> <span class="na">column=</span><span class="s">&quot;item_code&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;quantity&quot;</span> <span class="na">column=</span><span class="s">&quot;quantity&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;association</span> <span class="na">property=</span><span class="s">&quot;item&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;itemResultMap&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/collection&gt;</span>
<span class="hll">    <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&quot;orderCoupons&quot;</span> <span class="na">ofType=</span><span class="s">&quot;OrderCoupon&quot;</span> <span class="na">notNullColumn=</span><span class="s">&quot;coupon_code&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;orderId&quot;</span> <span class="na">column=</span><span class="s">&quot;id&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;coupon.code&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_code&quot;</span><span class="nt">/&gt;</span>
</span>        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;coupon.name&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_name&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;coupon.price&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_price&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/collection&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>
</pre></div>
</div>
<div class="figure align-center" id="id24">
<a class="reference internal image-reference" href="../_images/dataaccess_resultmap_ordercoupon.png"><img alt="ResultMap for OrderCoupon" src="../_images/dataaccess_resultmap_ordercoupon.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - ResultMap for OrderCoupon</strong></span></p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Map the search results to <code class="docutils literal"><span class="pre">OrderCoupon</span></code> object and add to <code class="docutils literal"><span class="pre">Order#orderCoupons</span></code> property.</p>
<p>When mapping to related Entities with 1:N relation, <code class="docutils literal"><span class="pre">collection</span></code> element is used.
For details of <code class="docutils literal"><span class="pre">collection</span></code> element,
refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/sqlmap-xml.html#collection">MyBatis3 REFERENCE DOCUMENTATION (Mapper XML Files-collection-)</a>&#8221; .</p>
<p>It is important to note that <code class="docutils literal"><span class="pre">notNullColumn</span></code> attribute is specified in the above example.</p>
<p>This setting is to avoid the generation of <code class="docutils literal"><span class="pre">OrderCoupon</span></code> object
when no records exist in <code class="docutils literal"><span class="pre">t_coupon</span></code> table.
In this implementation example, records of <code class="docutils literal"><span class="pre">t_coupon</span></code> table are not stored
in the data with <code class="docutils literal"><span class="pre">id</span></code> column <code class="docutils literal"><span class="pre">2</span></code>, hence from the search results, it is understood that the values of
<code class="docutils literal"><span class="pre">coupon_code</span></code>, <code class="docutils literal"><span class="pre">coupon_name</span></code> and <code class="docutils literal"><span class="pre">coupon_price</span></code> are <code class="docutils literal"><span class="pre">null</span></code>.</p>
<p>It is not necessary to specify <code class="docutils literal"><span class="pre">notNullColumn</span></code> attribute if the columns that are mapped to <code class="docutils literal"><span class="pre">OrderCoupon</span></code> object
are restricted to the three columns described above.
However, in the implementation example, since the value of <code class="docutils literal"><span class="pre">id</span></code> column is mapped in <code class="docutils literal"><span class="pre">OrderCoupon#orderId</span></code> property,
<code class="docutils literal"><span class="pre">notNullColumn</span></code> attribute should be specified.
This is because MyBatis generates an object when the value which is not <code class="docutils literal"><span class="pre">null</span></code> is set in the column for mapping.</p>
<p class="last">As shown in the above example, if <code class="docutils literal"><span class="pre">coupon_code</span></code> column is specified in the <code class="docutils literal"><span class="pre">notNullColumn</span></code> attribute, the object is generated only when the value of
<code class="docutils literal"><span class="pre">coupon_code</span></code> column is not <code class="docutils literal"><span class="pre">null</span></code>(in other words, when records exist).
Multiple columns can be specified in <code class="docutils literal"><span class="pre">notNullColumn</span></code>attribute.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Set the value of <code class="docutils literal"><span class="pre">id</span></code> column of fetched records in <code class="docutils literal"><span class="pre">OrderCoupon#orderId</span></code> property.</p>
<p class="last">Since <code class="docutils literal"><span class="pre">orderId</span></code> is PK, <code class="docutils literal"><span class="pre">id</span></code> element is used.</p>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p class="first">Set the value of <code class="docutils literal"><span class="pre">coupon_code</span></code> column of fetched records in <code class="docutils literal"><span class="pre">Coupon#code</span></code>.</p>
<p>Since <code class="docutils literal"><span class="pre">coupon_code</span></code> column is PK, the mapping is performed by using <code class="docutils literal"><span class="pre">id</span></code> element.
If <code class="docutils literal"><span class="pre">id</span></code>element is used, the records are grouped by the specified property value.</p>
<p class="last">Basically, they are grouped in 2 groups - <code class="docutils literal"><span class="pre">Coupon#code=CPN0000001</span></code> and <code class="docutils literal"><span class="pre">Coupon#code=CPN0000002</span></code>.
Then, two <code class="docutils literal"><span class="pre">OrderCoupon</span></code> objects are generated.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="mapping-to-coupon-object">
<span id="dataaccessmybatis3appendixacquirerelatedobjectsatoncemappingcoupon"></span><h5>5.2.4.4.5.7. Mapping to Coupon object<a class="headerlink" href="#mapping-to-coupon-object" title="Permalink to this headline">¶</a></h5>
<p>Perform mapping to <code class="docutils literal"><span class="pre">Coupon</span></code> object.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;orderResultMap&quot;</span> <span class="na">type=</span><span class="s">&quot;Order&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;id&quot;</span> <span class="na">column=</span><span class="s">&quot;id&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;orderStatus.code&quot;</span> <span class="na">column=</span><span class="s">&quot;status_code&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;orderStatus.name&quot;</span> <span class="na">column=</span><span class="s">&quot;status_name&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&quot;orderItems&quot;</span> <span class="na">ofType=</span><span class="s">&quot;OrderItem&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;orderId&quot;</span> <span class="na">column=</span><span class="s">&quot;id&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;item.code&quot;</span> <span class="na">column=</span><span class="s">&quot;item_code&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;quantity&quot;</span> <span class="na">column=</span><span class="s">&quot;quantity&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;association</span> <span class="na">property=</span><span class="s">&quot;item&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;itemResultMap&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/collection&gt;</span>
    <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&quot;orderCoupons&quot;</span> <span class="na">ofType=</span><span class="s">&quot;OrderCoupon&quot;</span> <span class="na">notNullColumn=</span><span class="s">&quot;coupon_code&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;orderId&quot;</span> <span class="na">column=</span><span class="s">&quot;id&quot;</span><span class="nt">/&gt;</span>
<span class="hll">        <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;coupon.code&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_code&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;coupon.name&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_name&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;coupon.price&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_price&quot;</span><span class="nt">/&gt;</span>
</span>    <span class="nt">&lt;/collection&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>
</pre></div>
</div>
<div class="figure align-center" id="id25">
<a class="reference internal image-reference" href="../_images/dataaccess_resultmap_coupon.png"><img alt="ResultMap for Coupon" src="../_images/dataaccess_resultmap_coupon.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - ResultMap for Coupon</strong></span></p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>Set the value of <code class="docutils literal"><span class="pre">coupon_code</span></code> column of fetched records in <code class="docutils literal"><span class="pre">Coupon#code</span></code>.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>Set the value of <code class="docutils literal"><span class="pre">coupon_name</span></code> column of fetched records in <code class="docutils literal"><span class="pre">Coupon#name</span></code>.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>Set the value of <code class="docutils literal"><span class="pre">coupon_price</span></code> column of fetched records in <code class="docutils literal"><span class="pre">Coupon#price</span></code>.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In <code class="docutils literal"><span class="pre">Coupon</span></code> object,
values of records that are grouped in <code class="docutils literal"><span class="pre">id</span></code> column and <code class="docutils literal"><span class="pre">coupon_code</span></code> column are set.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="object-diagram-after-mapping">
<span id="dataaccessmybatis3appendixacquirerelatedobjectsatonceobject"></span><h5>5.2.4.4.5.8. Object diagram after mapping<a class="headerlink" href="#object-diagram-after-mapping" title="Permalink to this headline">¶</a></h5>
<p>The status of <code class="docutils literal"><span class="pre">Order</span></code> object and related Entities that are actually mapped is as given below.</p>
<blockquote>
<div><div class="figure align-center" id="id26">
<a class="reference internal image-reference" href="../_images/dataaccess_object.png"><img alt="Mapped object diagram" src="../_images/dataaccess_object.png" style="width: 90%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - Mapped object diagram</strong></span></p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">Records and columns mapped to <code class="docutils literal"><span class="pre">Order</span></code> object are as follows:</div>
<div class="line">By specifying groupBy attribute, grayed out part is merged with the non-grayed part.</div>
</div>
<blockquote>
<div><div class="figure align-center" id="id27">
<a class="reference internal image-reference" href="../_images/dataaccess_sql_result_used.png"><img alt="Valid Result Set" src="../_images/dataaccess_sql_result_used.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text"><strong>Picture - Valid Result Set</strong></span></p>
</div>
</div></blockquote>
<blockquote id="dataaccessmybatis3appendixacquirerelatedobjectswarningsqlmapping">
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>It should be noted that when the records with 1:N relationship are mapped using JOINs, fetching the data of grayed out part becomes unnecessary.</p>
<p class="last">If the same SQL is used in a process that does not use data from the N part, it results in fetching of unnecessary data. Therefore, two separate SQLs, one that fetches the N part and another that does not fetch the N part should be created.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="how-to-fetch-a-related-entity-using-a-nested-sql">
<span id="dataaccessmybatis3appendixnestedselect"></span><h3><a class="toc-backref" href="#id103">5.2.4.5. How to fetch a related Entity using a nested SQL</a><a class="headerlink" href="#how-to-fetch-a-related-entity-using-a-nested-sql" title="Permalink to this headline">¶</a></h3>
<p>MyBatis3 provides a method wherein a related Entity is fetched at the time of mapping by using a different SQL (nested SQL).</p>
<p>When a related Entity is fetched by using a nested SQL, following can be performed easily.</p>
<ul class="simple">
<li>Individual SQL definition</li>
<li>Mapping definition of <code class="docutils literal"><span class="pre">resultMap</span></code> element</li>
</ul>
<blockquote>
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>It should be noted that even if the definitions are simplified, if nested SQL is used extensively,
it can cause N+1.</p>
<p>Default MyBatis3 behavior while using nested SQL is &#8220;Eager Load&#8221;.
It signifies that SQL is executed regardless of whether related Entities are used and the following risks are more likely to occur.</p>
<ul class="last simple">
<li>Unnecessary SQL execution and data fetching</li>
<li>N+1</li>
</ul>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>MyBatis3 provides an option to change the behavior to &#8220;Lazy Load&#8221; while fetching a related Entity using a nested SQL.</p>
<p class="last">Refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3appendixnestedselectlazysetting"><span>Settings to apply Lazy Load for related Entity</span></a>&#8221; for how to use &#8220;Lazy Load&#8221;.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="dataaccessmybatis3appendixnestedselectmapping">
<span id="id11"></span><h4><a class="toc-backref" href="#id104">5.2.4.5.1. How to fetch a related Entity using a nested SQL</a><a class="headerlink" href="#dataaccessmybatis3appendixnestedselectmapping" title="Permalink to this headline">¶</a></h4>
<p>Implementation example wherein a related Entity is fetched by using a nested SQL is shown below.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;itemResultMap&quot;</span> <span class="na">type=</span><span class="s">&quot;Item&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;code&quot;</span> <span class="na">column=</span><span class="s">&quot;item_code&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;name&quot;</span> <span class="na">column=</span><span class="s">&quot;item_name&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;price&quot;</span> <span class="na">column=</span><span class="s">&quot;item_price&quot;</span><span class="nt">/&gt;</span>
<span class="hll">    <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&quot;categories&quot;</span> <span class="na">column=</span><span class="s">&quot;item_code&quot;</span>
</span><span class="hll">        <span class="na">select=</span><span class="s">&quot;findAllCategoryByItemCode&quot;</span> <span class="nt">/&gt;</span>
</span><span class="nt">&lt;/resultMap&gt;</span>

<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findAllCategoryByItemCode&quot;</span>
    <span class="na">parameterType=</span><span class="s">&quot;string&quot;</span> <span class="na">resultType=</span><span class="s">&quot;Category&quot;</span><span class="nt">&gt;</span>
    SELECT
        ct.code,
        ct.name
    FROM
        m_item_category ic
    INNER JOIN m_category ct ON ct.code = ic.category_code
    WHERE
        ic.item_code = #{itemCode}
    ORDER BY
        code
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Specify the statement ID of an SQL to be called in <code class="docutils literal"><span class="pre">select</span></code> attribute of
<code class="docutils literal"><span class="pre">association</span></code> element or <code class="docutils literal"><span class="pre">collection</span></code> element.</p>
<p>Specify the column name that stores the parameter value to be passed to SQL, in <code class="docutils literal"><span class="pre">column</span></code> attribute.
In the above example, value of <code class="docutils literal"><span class="pre">item_code</span></code> column is passed as a parameter of <code class="docutils literal"><span class="pre">findAllCategoryByItemCode</span></code>.</p>
<p class="last">For details of attributes that can be specified,
refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/sqlmap-xml.html#Nested_Select_for_Association">MyBatis3 REFERENCE DOCUMENTATION(Mapper XML Files-Nested Select for Association-)</a>&#8221; .</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In the above example, since <code class="docutils literal"><span class="pre">fetchType</span></code> attribute is not specified,
whether to use &#8220;Lazy Load&#8221; or &#8220;Eager Load&#8221; depends on configuration of overall application.</p>
<p class="last">For configuration of overall application,
refer to &#8220;<a class="reference internal" href="#dataaccessmybatis3appendixnestedselectlazysettingmybatis"><span>MyBatis settings for using Lazy Load</span></a>&#8221;.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="settings-to-apply-lazy-load-for-related-entity">
<span id="dataaccessmybatis3appendixnestedselectlazysetting"></span><h4><a class="toc-backref" href="#id105">5.2.4.5.2. Settings to apply Lazy Load for related Entity</a><a class="headerlink" href="#settings-to-apply-lazy-load-for-related-entity" title="Permalink to this headline">¶</a></h4>
<p>Although default behavior of MyBatis3 while fetching a related Entity by using a nested SQL is &#8220;Eager Load&#8221;,
&#8220;Lazy Load&#8221; can also be used.</p>
<p>The minimum necessary settings for using &#8220;Lazy Load&#8221; and how to use &#8220;Lazy Load&#8221; are explained below.</p>
<p>For the configuration values that are not explained,
refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/configuration.html#settings">MyBatis3 REFERENCE DOCUMENTATION(Mapper XML Files-settings-)</a>&#8221; .</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="adding-a-bytecode-manipulation-library">
<span id="dataaccessmybatis3appendixnestedselectlazysettinglibrary"></span><h5>5.2.4.5.2.1. Adding a Bytecode Manipulation Library<a class="headerlink" href="#adding-a-bytecode-manipulation-library" title="Permalink to this headline">¶</a></h5>
<p>When &#8220;Lazy Load&#8221; is used, one of the libraries given below is necessary in order to generate a Proxy object for implementing &#8220;Lazy Load&#8221;.</p>
<ul class="simple">
<li>JAVASSIST</li>
<li>CGLIB</li>
</ul>
<p>CGLIB had been used as default until MyBatis 3.2 series.
From  MyBatis 3.3.0, JAVASSIST has been used as default at the MyBatis 3.3.0 or later version, which is supported by terasoluna-gfw-mybatis3 5.0.2.RELEASE.
In addition, it is possible to use &#8220;Lazy Load&#8221; without adding the library because the JAVASSIST is embedded in the MyBatis since MyBatis 3.3.0.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p>When CGLIB is to be used in MyBatis 3.3.0 or later,</p>
<ul class="simple">
<li>CGLIB artifact should be added to <code class="file docutils literal"><span class="pre">pom.xml</span></code></li>
<li>&#8220;<code class="docutils literal"><span class="pre">proxyFactory=CGLIB</span></code>&#8221; should be added to MyBatis configuration file (<code class="file docutils literal"><span class="pre">projectName-domain/src/main/resources/META-INF/mybatis/mybatis-config.xml</span></code>)</li>
</ul>
<p class="last">Refer to &#8220;<a class="reference external" href="http://mybatis.github.io/mybatis-3/dependencies.html#compile">MyBatis3 PROJECT DOCUMENTATION(Project Dependencies-compile-)</a>&#8221;  for information about CGLIB artifact.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="mybatis-settings-for-using-lazy-load">
<span id="dataaccessmybatis3appendixnestedselectlazysettingmybatis"></span><h5>5.2.4.5.2.2. MyBatis settings for using Lazy Load<a class="headerlink" href="#mybatis-settings-for-using-lazy-load" title="Permalink to this headline">¶</a></h5>
<p>In MyBatis3, availability of &#8220;Lazy Load&#8221; can be specified in the 2 locations given below.</p>
<ul class="simple">
<li>Overall configuration of application (MyBatis configuration file)</li>
<li>Individual configuration (mapping file)</li>
<li>Overall configuration of application is specified in MyBatis configuration file (<code class="file docutils literal"><span class="pre">projectName-domain/src/main/resources/META-INF/mybatis/mybatis-config.xml</span></code>).</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE configuration</span>
<span class="cp">        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span>
<span class="cp">        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;settings&gt;</span>
        <span class="c">&lt;!-- (1) --&gt;</span>
        <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;lazyLoadingEnabled&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/settings&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Specify default behavior of application as <code class="docutils literal"><span class="pre">lazyLoadingEnabled</span></code>.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">true</span></code>: &#8220;Lazy Load&#8221;</li>
<li><code class="docutils literal"><span class="pre">false</span></code>: &#8220;Eager Load&#8221; (Default)</li>
</ul>
<p class="last">When <code class="docutils literal"><span class="pre">fetchType</span></code> attribute of <code class="docutils literal"><span class="pre">association</span></code> element and <code class="docutils literal"><span class="pre">collection</span></code> element is to be specified,
the specified value of <code class="docutils literal"><span class="pre">fetchType</span></code> attribute is given priority.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>When <code class="docutils literal"><span class="pre">select</span></code> attribute of <code class="docutils literal"><span class="pre">association</span></code> element or <code class="docutils literal"><span class="pre">collection</span></code>element is used in &#8220;<code class="docutils literal"><span class="pre">false</span></code>: &#8220;Eager Load&#8221;&#8221; state,
exercise caution as SQL is executed at the time of mapping.</p>
<p class="last">It is recommended to set <code class="docutils literal"><span class="pre">lazyLoadingEnabled</span></code> to <code class="docutils literal"><span class="pre">true</span></code> unless there is a specific reason.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li>Individual settings are specified in <code class="docutils literal"><span class="pre">fetchType</span></code> attribute of <code class="docutils literal"><span class="pre">association</span></code> element and <code class="docutils literal"><span class="pre">collection</span></code> element of mapping file.</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre>    <span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;itemResultMap&quot;</span> <span class="na">type=</span><span class="s">&quot;Item&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;code&quot;</span> <span class="na">column=</span><span class="s">&quot;item_code&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;name&quot;</span> <span class="na">column=</span><span class="s">&quot;item_name&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;price&quot;</span> <span class="na">column=</span><span class="s">&quot;item_price&quot;</span><span class="nt">/&gt;</span>
        <span class="c">&lt;!-- (2) --&gt;</span>
        <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&quot;categories&quot;</span> <span class="na">column=</span><span class="s">&quot;item_code&quot;</span>
<span class="hll">            <span class="na">fetchType=</span><span class="s">&quot;lazy&quot;</span>
</span>            <span class="na">select=</span><span class="s">&quot;findAllCategoryByItemCode&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/resultMap&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findAllCategoryByItemCode&quot;</span>
        <span class="na">parameterType=</span><span class="s">&quot;string&quot;</span> <span class="na">resultType=</span><span class="s">&quot;Category&quot;</span><span class="nt">&gt;</span>
        SELECT
            ct.code,
            ct.name
        FROM
            m_item_category ic
        INNER JOIN m_category ct ON ct.code = ic.category_code
        WHERE
            ic.item_code = #{itemCode}
        ORDER BY
            code
    <span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">Specify <code class="docutils literal"><span class="pre">lazy</span></code> or <code class="docutils literal"><span class="pre">eager</span></code> in <code class="docutils literal"><span class="pre">fetchType</span></code> attribute of <code class="docutils literal"><span class="pre">association</span></code> element or <code class="docutils literal"><span class="pre">collection</span></code> element.</p>
<p class="last">If <code class="docutils literal"><span class="pre">fetchType</span></code> attribute is specified, overall configuration of application can be overwritten.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="settings-for-controlling-execution-timing-of-lazy-load">
<span id="dataaccessmybatis3appendixnestedselectlazysettingtiming"></span><h5>5.2.4.5.2.3. Settings for controlling execution timing of Lazy Load<a class="headerlink" href="#settings-for-controlling-execution-timing-of-lazy-load" title="Permalink to this headline">¶</a></h5>
<p>MyBatis3 provides an option to control the timing in which &#8220;Lazy Load&#8221; is executed.</p>
<p>The settings to control the timing in which &#8220;Lazy Load&#8221; is executed is
specified in MyBatis configuration file (<code class="file docutils literal"><span class="pre">projectName-domain/src/main/resources/META-INF/mybatis/mybatis-config.xml</span></code>).</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE configuration</span>
<span class="cp">        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span>
<span class="cp">        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;settings&gt;</span>
        <span class="c">&lt;!-- (1) --&gt;</span>
        <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;aggressiveLazyLoading&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/settings&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><p class="first">Specify the timing in which &#8220;Lazy Load&#8221; is executed in <code class="docutils literal"><span class="pre">aggressiveLazyLoading</span></code>.</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">true</span></code>: Executed when getter method of the object that stores the property for which &#8220;Lazy Load&#8221; is to be performed, is called (default)</li>
<li><code class="docutils literal"><span class="pre">false</span></code>: Executed when getter method of the property for which &#8220;Lazy Load&#8221; is to be performed, is called</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>In case of &#8220;<code class="docutils literal"><span class="pre">true</span></code>&#8221; (default), exercise caution since SQL is likely to be executed for fetching the unused data.</p>
<p>Basically, there is a case wherein the following mapping is carried out
and only the property for which &#8220;Lazy load&#8221; is not to be performed, is accessed.
In case of &#8220;<code class="docutils literal"><span class="pre">true</span></code>&#8221; (default), &#8220;Lazy Load&#8221; is executed even without directly
accessing the property for which &#8220;Lazy Load&#8221; is to be performed.</p>
<p>It is recommended to set <code class="docutils literal"><span class="pre">aggressiveLazyLoading</span></code> to &#8220;<code class="docutils literal"><span class="pre">false</span></code> unless there is a specific reason.</p>
<ul class="last">
<li><p class="first">Entity</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">code</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">price</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">categories</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Mapping file</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;itemResultMap&quot;</span> <span class="na">type=</span><span class="s">&quot;Item&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;code&quot;</span> <span class="na">column=</span><span class="s">&quot;item_code&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;name&quot;</span> <span class="na">column=</span><span class="s">&quot;item_name&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;price&quot;</span> <span class="na">column=</span><span class="s">&quot;item_price&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&quot;categories&quot;</span> <span class="na">column=</span><span class="s">&quot;item_code&quot;</span>
        <span class="na">fetchType=</span><span class="s">&quot;lazy&quot;</span> <span class="na">select=</span><span class="s">&quot;findByItemCode&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">Application code (Service)</p>
<div class="highlight-java"><div class="highlight"><pre>    <span class="n">Item</span> <span class="n">item</span> <span class="o">=</span> <span class="n">itemRepository</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">itemCode</span><span class="o">);</span>
<span class="hll">    <span class="c1">// (2)</span>
</span><span class="hll">    <span class="n">String</span> <span class="n">code</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="na">getCode</span><span class="o">();</span>
</span>    <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">price</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="na">getPrice</span><span class="o">();</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p class="first">In the above example, <code class="docutils literal"><span class="pre">categories</span></code> property targeted for &#8220;Lazy Load&#8221; is not accessed.
However, &#8220;Lazy Load&#8221; is executed while accessing <code class="docutils literal"><span class="pre">Item#code</span></code> property.</p>
<p class="last">In case of &#8220;<code class="docutils literal"><span class="pre">false</span></code>&#8221; (default), &#8220;Lazy Load&#8221; is not executed in the cases described above.</p>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</div></blockquote>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="DataAccessJpa.html" title="5.3. Database Access (JPA)"
             >next</a> |</li>
        <li class="right" >
          <a href="DataAccessCommon.html" title="5.1. Database Access (Common)"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.0.2.RELEASE documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >5. Architecture in Detail - TERASOLUNA Server Framework for Java (5.x)</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013-2016, NTT DATA.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.4.Theme by <a href="http://github.com/vkvn">vkvn</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>