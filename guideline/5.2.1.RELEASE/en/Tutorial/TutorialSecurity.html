<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>10.4. Spring Security Tutorial &#8212; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.2.1.RELEASE documentation</title>
    <link rel="stylesheet" href="../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.2.1.RELEASE',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="11. Appendix(Know How)" href="../Appendix/index.html" />
    <link rel="prev" title="10.3. Session tutorial" href="TutorialSession.html" /><script async src="https://www.googletagmanager.com/gtag/js?id=G-847V2Q99G8"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date()); gtag('config', 'G-847V2Q99G8');
</script>
<script src="../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../_static/solarized-dark.css" rel="stylesheet">
<link href="../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../Appendix/index.html" title="11. Appendix(Know How)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="TutorialSession.html" title="10.3. Session tutorial"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.2.1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">10. Tutorials</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">10.4. Spring Security Tutorial</a><ul>
<li><a class="reference internal" href="#introduction">10.4.1. Introduction</a><ul>
<li><a class="reference internal" href="#topics-covered-in-this-tutorial">10.4.1.1. Topics covered in this tutorial</a></li>
<li><a class="reference internal" href="#target-audience">10.4.1.2. Target Audience</a></li>
<li><a class="reference internal" href="#verification-environment">10.4.1.3. Verification environment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#overview-of-application-to-be-created">10.4.2. Overview of application to be created</a></li>
<li><a class="reference internal" href="#creating-environment">10.4.3. Creating environment</a><ul>
<li><a class="reference internal" href="#creating-a-project">10.4.3.1. Creating a project</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-an-application">10.4.4. Creating an application</a><ul>
<li><a class="reference internal" href="#implementing-domain-layer">10.4.4.1. Implementing domain layer</a><ul>
<li><a class="reference internal" href="#creating-a-domain-object">10.4.4.1.1. Creating a Domain Object</a></li>
<li><a class="reference internal" href="#creating-accountrepository">10.4.4.1.2. Creating AccountRepository</a></li>
<li><a class="reference internal" href="#creating-accountsharedservice">10.4.4.1.3. Creating AccountSharedService</a></li>
<li><a class="reference internal" href="#creating-authentication-service">10.4.4.1.4. Creating Authentication Service</a></li>
<li><a class="reference internal" href="#setting-database-initialization-script">10.4.4.1.5. Setting database initialization script</a></li>
<li><a class="reference internal" href="#package-explorer-after-creating-domain-layer">10.4.4.1.6. Package Explorer after creating Domain Layer</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementing-application-layer">10.4.4.2. Implementing Application Layer</a><ul>
<li><a class="reference internal" href="#spring-security-settings">10.4.4.2.1. Spring Security settings</a></li>
<li><a class="reference internal" href="#creating-login-page">10.4.4.2.2. Creating login page</a></li>
<li><a class="reference internal" href="#accessing-account-information-of-login-user-from-jsp">10.4.4.2.3. Accessing account information of login user from JSP</a></li>
<li><a class="reference internal" href="#adding-logout-button">10.4.4.2.4. Adding logout button</a></li>
<li><a class="reference internal" href="#accessing-account-information-of-login-user-from-controller">10.4.4.2.5. Accessing account information of login user from Controller</a></li>
<li><a class="reference internal" href="#package-explorer-after-creating-application-layer">10.4.4.2.6. Package explorer after creating application layer</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#summary">10.4.5. Summary</a></li>
<li><a class="reference internal" href="#appendix">10.4.6. Appendix</a><ul>
<li><a class="reference internal" href="#description-of-configuration-file">10.4.6.1. Description of configuration file</a><ul>
<li><a class="reference internal" href="#spring-security-xml">10.4.6.1.1. spring-security.xml</a></li>
<li><a class="reference internal" href="#spring-mvc-xml">10.4.6.1.2. spring-mvc.xml</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="TutorialSession.html"
                        title="previous chapter">10.3. Session tutorial</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../Appendix/index.html"
                        title="next chapter">11. Appendix(Know How)</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/Tutorial/TutorialSecurity.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="spring-security-tutorial">
<h1>10.4. Spring Security Tutorial<a class="headerlink" href="#spring-security-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a><ul>
<li><a class="reference internal" href="#topics-covered-in-this-tutorial" id="id2">Topics covered in this tutorial</a></li>
<li><a class="reference internal" href="#target-audience" id="id3">Target Audience</a></li>
<li><a class="reference internal" href="#verification-environment" id="id4">Verification environment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#overview-of-application-to-be-created" id="id5">Overview of application to be created</a></li>
<li><a class="reference internal" href="#creating-environment" id="id6">Creating environment</a><ul>
<li><a class="reference internal" href="#creating-a-project" id="id7">Creating a project</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-an-application" id="id8">Creating an application</a><ul>
<li><a class="reference internal" href="#implementing-domain-layer" id="id9">Implementing domain layer</a><ul>
<li><a class="reference internal" href="#creating-a-domain-object" id="id10">Creating a Domain Object</a></li>
<li><a class="reference internal" href="#creating-accountrepository" id="id11">Creating AccountRepository</a></li>
<li><a class="reference internal" href="#creating-accountsharedservice" id="id12">Creating AccountSharedService</a></li>
<li><a class="reference internal" href="#creating-authentication-service" id="id13">Creating Authentication Service</a></li>
<li><a class="reference internal" href="#setting-database-initialization-script" id="id14">Setting database initialization script</a></li>
<li><a class="reference internal" href="#package-explorer-after-creating-domain-layer" id="id15">Package Explorer after creating Domain Layer</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementing-application-layer" id="id16">Implementing Application Layer</a><ul>
<li><a class="reference internal" href="#spring-security-settings" id="id17">Spring Security settings</a></li>
<li><a class="reference internal" href="#creating-login-page" id="id18">Creating login page</a></li>
<li><a class="reference internal" href="#accessing-account-information-of-login-user-from-jsp" id="id19">Accessing account information of login user from JSP</a></li>
<li><a class="reference internal" href="#adding-logout-button" id="id20">Adding logout button</a></li>
<li><a class="reference internal" href="#accessing-account-information-of-login-user-from-controller" id="id21">Accessing account information of login user from Controller</a></li>
<li><a class="reference internal" href="#package-explorer-after-creating-application-layer" id="id22">Package explorer after creating application layer</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#summary" id="id23">Summary</a></li>
<li><a class="reference internal" href="#appendix" id="id24">Appendix</a><ul>
<li><a class="reference internal" href="#description-of-configuration-file" id="id25">Description of configuration file</a><ul>
<li><a class="reference internal" href="#spring-security-xml" id="id26">spring-security.xml</a></li>
<li><a class="reference internal" href="#spring-mvc-xml" id="id27">spring-mvc.xml</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">10.4.1. Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<div class="section" id="topics-covered-in-this-tutorial">
<h3><a class="toc-backref" href="#id2">10.4.1.1. Topics covered in this tutorial</a><a class="headerlink" href="#topics-covered-in-this-tutorial" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Basic authentication/authorization using Spring Security</li>
<li>Login using the account information in the database</li>
<li>How to fetch authenticated account object</li>
</ul>
</div>
<div class="section" id="target-audience">
<h3><a class="toc-backref" href="#id3">10.4.1.2. Target Audience</a><a class="headerlink" href="#target-audience" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Completed implementation of <a class="reference internal" href="TutorialTodo.html"><span class="doc">Tutorial (Todo Application)</span></a>(MyBatis3 should be used for implementing infrastructure layer)</li>
<li>Understands the basic operations of Maven</li>
</ul>
</div>
<div class="section" id="verification-environment">
<h3><a class="toc-backref" href="#id4">10.4.1.3. Verification environment</a><a class="headerlink" href="#verification-environment" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Similar to <a class="reference internal" href="TutorialTodo.html"><span class="doc">Tutorial (Todo Application)</span></a>.</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="overview-of-application-to-be-created">
<h2><a class="toc-backref" href="#id5">10.4.2. Overview of application to be created</a><a class="headerlink" href="#overview-of-application-to-be-created" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Login to application is possible by specifying ID and password on login page.</li>
<li>Store account information required for login in the database.</li>
<li>There is a Welcome page and Account information display page which can be viewed only by the logged in users.</li>
<li>Logout from application is possible.</li>
</ul>
<p>Overview of application is shown in the following figure.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/security_tutorial_applicatioin_overview.png"><img alt="../_images/security_tutorial_applicatioin_overview.png" src="../_images/security_tutorial_applicatioin_overview.png" style="width: 90%;" /></a>
</div>
<p>URL list is shown below.</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="20%" />
<col width="15%" />
<col width="15%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Process name</th>
<th class="head">HTTP method</th>
<th class="head">URL</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Login form display</td>
<td>GET</td>
<td>/login.jsp</td>
<td>Displays login form</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Login</td>
<td>POST</td>
<td>/authentication</td>
<td>Authenticates using username and password entered from login form (performed by Spring Security)</td>
</tr>
<tr class="row-even"><td>3</td>
<td>Welcome page display</td>
<td>GET</td>
<td>/</td>
<td>Displays Welcome page.</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>Account information display</td>
<td>GET</td>
<td>/account</td>
<td>Displays account information of logged-in user.</td>
</tr>
<tr class="row-even"><td>5</td>
<td>Logout</td>
<td>POST</td>
<td>/logout</td>
<td>Performs logout (performed by Spring Security)</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="creating-environment">
<h2><a class="toc-backref" href="#id6">10.4.3. Creating environment</a><a class="headerlink" href="#creating-environment" title="Permalink to this headline">¶</a></h2>
<div class="section" id="creating-a-project">
<h3><a class="toc-backref" href="#id7">10.4.3.1. Creating a project</a><a class="headerlink" href="#creating-a-project" title="Permalink to this headline">¶</a></h3>
<p>Create <a class="reference external" href="https://github.com/terasolunaorg/terasoluna-gfw-web-blank">A blank project of TERASOLUNA Server Framework for Java (5.x)</a> using Maven archetype.</p>
<p>In this tutorial, a blank project is created for MyBatis3.</p>
<p>Basic knowledge such as how to import to Spring Tool Suite(STS), how to start an application server, etc. is omitted in this tutorial,
since it is already described in <a class="reference internal" href="TutorialTodo.html"><span class="doc">Tutorial (Todo Application)</span></a>.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">mvn org.apache.maven.plugins:maven-archetype-plugin:2.4:generate -B^</span>
<span class="go"> -DarchetypeCatalog=http://repo.terasoluna.org/nexus/content/repositories/terasoluna-gfw-releases^</span>
<span class="go"> -DarchetypeGroupId=org.terasoluna.gfw.blank^</span>
<span class="go"> -DarchetypeArtifactId=terasoluna-gfw-web-blank-mybatis3-archetype^</span>
<span class="go"> -DarchetypeVersion=5.2.1.RELEASE^</span>
<span class="go"> -DgroupId=com.example.security^</span>
<span class="go"> -DartifactId=first-springsecurity^</span>
<span class="go"> -Dversion=1.0.0-SNAPSHOT</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Most of the settings which are required for executing this tutorial are already performed in blank project.
It is not mandatory to understand these settings just for executing the tutorial; however,
it is recommended that you understand the settings which are required to run the application.</p>
<p>For description about settings required to run the application (configuration file),
refer to “<a class="reference internal" href="#securitytutorialappendixconfigurationfiles"><span class="std std-ref">Description of configuration file</span></a>”.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="creating-an-application">
<h2><a class="toc-backref" href="#id8">10.4.4. Creating an application</a><a class="headerlink" href="#creating-an-application" title="Permalink to this headline">¶</a></h2>
<div class="section" id="implementing-domain-layer">
<h3><a class="toc-backref" href="#id9">10.4.4.1. Implementing domain layer</a><a class="headerlink" href="#implementing-domain-layer" title="Permalink to this headline">¶</a></h3>
<p>The flow of authentication process of Spring Security is as follows:</p>
<ol class="arabic simple">
<li>Search user information from the entered <code class="docutils literal"><span class="pre">username</span></code>.</li>
<li>When user information exists, compare the password stored in the corresponding user information with the hashed password that has been entered.</li>
<li>When passwords match, authentication is considered to be successful.</li>
</ol>
<p>If user information is not found or if the passwords do not match, authentication fails.</p>
<p>In domain layer, process to fetch Account object from user name is essential. The process is implemented in the following order.</p>
<ol class="arabic simple">
<li>Creation of Domain Object(<code class="docutils literal"><span class="pre">Account</span></code>)</li>
<li>Creation of <code class="docutils literal"><span class="pre">AccountRepository</span></code></li>
<li>Creation of <code class="docutils literal"><span class="pre">AccountSharedService</span></code></li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="creating-a-domain-object">
<h4><a class="toc-backref" href="#id10">10.4.4.1.1. Creating a Domain Object</a><a class="headerlink" href="#creating-a-domain-object" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Create <code class="docutils literal"><span class="pre">Account</span></code> class that stores authentication information (user name and password).</div>
<div class="line"><code class="docutils literal"><span class="pre">src/main/java/com/example/security/domain/model/Account.java</span></code></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.security.domain.model</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">username</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">firstName</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">lastName</span><span class="p">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getUsername</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">username</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUsername</span><span class="p">(</span><span class="n">String</span> <span class="n">username</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getPassword</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">password</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPassword</span><span class="p">(</span><span class="n">String</span> <span class="n">password</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFirstName</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">firstName</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFirstName</span><span class="p">(</span><span class="n">String</span> <span class="n">firstName</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">firstName</span> <span class="o">=</span> <span class="n">firstName</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getLastName</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">lastName</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLastName</span><span class="p">(</span><span class="n">String</span> <span class="n">lastName</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">lastName</span> <span class="o">=</span> <span class="n">lastName</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;Account [username=&quot;</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s">&quot;, password=&quot;</span> <span class="o">+</span> <span class="n">password</span>
                <span class="o">+</span> <span class="s">&quot;, firstName=&quot;</span> <span class="o">+</span> <span class="n">firstName</span> <span class="o">+</span> <span class="s">&quot;, lastName=&quot;</span> <span class="o">+</span> <span class="n">lastName</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="creating-accountrepository">
<h4><a class="toc-backref" href="#id11">10.4.4.1.2. Creating AccountRepository</a><a class="headerlink" href="#creating-accountrepository" title="Permalink to this headline">¶</a></h4>
<p>Implement a process to fetch <code class="docutils literal"><span class="pre">Account</span></code> object from the database.</p>
<div class="line-block">
<div class="line">Create <code class="docutils literal"><span class="pre">AccountRepository</span></code> interface.</div>
<div class="line"><code class="docutils literal"><span class="pre">src/main/java/com/example/security/domain/repository/account/AccountRepository.java</span></code></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.security.domain.repository.account</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.example.security.domain.model.Account</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AccountRepository</span> <span class="p">{</span>
    <span class="n">Account</span> <span class="nf">findOne</span><span class="p">(</span><span class="n">String</span> <span class="n">username</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">Define SQL for fetching single <code class="docutils literal"><span class="pre">Account</span></code> record, in Mapper file.</div>
<div class="line"><code class="docutils literal"><span class="pre">src/main/resources/com/example/security/domain/repository/account/AccountRepository.xml</span></code></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.security.domain.repository.account.AccountRepository&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;accountResultMap&quot;</span> <span class="na">type=</span><span class="s">&quot;Account&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&quot;username&quot;</span> <span class="na">column=</span><span class="s">&quot;username&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;password&quot;</span> <span class="na">column=</span><span class="s">&quot;password&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;firstName&quot;</span> <span class="na">column=</span><span class="s">&quot;first_name&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;lastName&quot;</span> <span class="na">column=</span><span class="s">&quot;last_name&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/resultMap&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;String&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;accountResultMap&quot;</span><span class="nt">&gt;</span>
        SELECT
            username,
            password,
            first_name,
            last_name
        FROM
            account
        WHERE
            username = #{username}
    <span class="nt">&lt;/select&gt;</span>
<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="creating-accountsharedservice">
<h4><a class="toc-backref" href="#id12">10.4.4.1.3. Creating AccountSharedService</a><a class="headerlink" href="#creating-accountsharedservice" title="Permalink to this headline">¶</a></h4>
<p>Implement a business process to fetch <code class="docutils literal"><span class="pre">Account</span></code> object from user name.</p>
<p>Since this process is to be used from Spring Security’s Authentication service, interface name would be <code class="docutils literal"><span class="pre">AccountSharedService</span></code> and class name would be <code class="docutils literal"><span class="pre">AccountSharedServiceImpl</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>This guideline does not recommend calling a Service from another Service.</p>
<p>To have common domain layer process (service),
it is recommended to name it as <code class="docutils literal"><span class="pre">XxxSharedService</span></code> instead of <code class="docutils literal"><span class="pre">XxxService</span></code> to indicate that
it is a service common across various service processes.</p>
<p class="last">The application created in this tutorial does not require common services.
However, in general application, it is assumed to have common services for processing the account information.
Therefore, in this tutorial, process to fetch the account information is implemented as SharedService.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">Create <code class="docutils literal"><span class="pre">AccountSharedService</span></code> interface.</div>
<div class="line"><code class="docutils literal"><span class="pre">src/main/java/com/example/security/domain/service/account/AccountSharedService.java</span></code></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.security.domain.service.account</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.example.security.domain.model.Account</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AccountSharedService</span> <span class="p">{</span>
    <span class="n">Account</span> <span class="nf">findOne</span><span class="p">(</span><span class="n">String</span> <span class="n">username</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">Create <code class="docutils literal"><span class="pre">AccountSharedServiceImpl</span></code> class.</div>
<div class="line"><code class="docutils literal"><span class="pre">src/main/java/com/example/security/domain/service/account/AccountSharedServiceImpl.java</span></code></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.security.domain.service.account</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.exception.ResourceNotFoundException</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.example.security.domain.model.Account</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.security.domain.repository.account.AccountRepository</span><span class="p">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccountSharedServiceImpl</span> <span class="kd">implements</span> <span class="n">AccountSharedService</span> <span class="p">{</span>
    <span class="nd">@Inject</span>
    <span class="n">AccountRepository</span> <span class="n">accountRepository</span><span class="p">;</span>

    <span class="nd">@Transactional</span><span class="p">(</span><span class="n">readOnly</span><span class="o">=</span><span class="kc">true</span><span class="p">)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Account</span> <span class="nf">findOne</span><span class="p">(</span><span class="n">String</span> <span class="n">username</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// (1)</span>
        <span class="n">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="n">accountRepository</span><span class="p">.</span><span class="na">findOne</span><span class="p">(</span><span class="n">username</span><span class="p">);</span>
        <span class="c1">// (2)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">account</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">ResourceNotFoundException</span><span class="p">(</span><span class="s">&quot;The given account is not found! username=&quot;</span>
                    <span class="o">+</span> <span class="n">username</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">account</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch single <code class="docutils literal"><span class="pre">Account</span></code> object that matches with the user name.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">If <code class="docutils literal"><span class="pre">Account</span></code> that matches with the user name does not exist, throw <code class="docutils literal"><span class="pre">ResourceNotFoundException</span></code> provided by common library.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="creating-authentication-service">
<span id="tutorial-createauthservice"></span><h4><a class="toc-backref" href="#id13">10.4.4.1.4. Creating Authentication Service</a><a class="headerlink" href="#creating-authentication-service" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Create a class to store authenticated user information which is used in Spring Security.</div>
<div class="line"><code class="docutils literal"><span class="pre">src/main/java/com/example/security/domain/service/userdetails/SampleUserDetails.java</span></code></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.security.domain.service.userdetails</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.security.core.authority.AuthorityUtils</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.core.userdetails.User</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.example.security.domain.model.Account</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleUserDetails</span> <span class="kd">extends</span> <span class="n">User</span> <span class="p">{</span> <span class="c1">// (1)</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="p">;</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Account</span> <span class="n">account</span><span class="p">;</span> <span class="c1">// (2)</span>

    <span class="kd">public</span> <span class="nf">SampleUserDetails</span><span class="p">(</span><span class="n">Account</span> <span class="n">account</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// (3)</span>
        <span class="kd">super</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getUsername</span><span class="p">(),</span> <span class="n">account</span><span class="p">.</span><span class="na">getPassword</span><span class="p">(),</span> <span class="n">AuthorityUtils</span>
                <span class="p">.</span><span class="na">createAuthorityList</span><span class="p">(</span><span class="s">&quot;ROLE_USER&quot;</span><span class="p">));</span> <span class="c1">// (4)</span>
        <span class="k">this</span><span class="p">.</span><span class="na">account</span> <span class="o">=</span> <span class="n">account</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">Account</span> <span class="nf">getAccount</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// (5)</span>
        <span class="k">return</span> <span class="n">account</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implement <code class="docutils literal"><span class="pre">org.springframework.security.core.userdetails.UserDetails</span></code> interface.</div>
<div class="line">Here, implement project specific <code class="docutils literal"><span class="pre">UserDetails</span></code> class, by inheriting <code class="docutils literal"><span class="pre">org.springframework.security.core.userdetails.User</span></code>  class that implements <code class="docutils literal"><span class="pre">UserDetails</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Maintain account information of this project in Spring’s authentication user class.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Call constructor of <code class="docutils literal"><span class="pre">User</span></code> class. The first argument is user name, the second is password and the third is authority list.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">As a simple implementation, create an authority having only a role named as <code class="docutils literal"><span class="pre">&quot;ROLE_USER&quot;</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create getter of account information. This enables fetching of <code class="docutils literal"><span class="pre">Account</span></code> object of login user.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">Create a service to fetch authentication user information which is used in Spring Security.</div>
<div class="line"><code class="docutils literal"><span class="pre">src/main/java/com/example/security/domain/service/userdetails/SampleUserDetailsService.java</span></code></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.security.domain.service.userdetails</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.security.core.userdetails.UserDetails</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.core.userdetails.UserDetailsService</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.core.userdetails.UsernameNotFoundException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.terasoluna.gfw.common.exception.ResourceNotFoundException</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.example.security.domain.model.Account</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.security.domain.service.account.AccountSharedService</span><span class="p">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleUserDetailsService</span> <span class="kd">implements</span> <span class="n">UserDetailsService</span> <span class="p">{</span> <span class="c1">// (1)</span>
    <span class="nd">@Inject</span>
    <span class="n">AccountSharedService</span> <span class="n">accountSharedService</span><span class="p">;</span> <span class="c1">// (2)</span>

    <span class="nd">@Transactional</span><span class="p">(</span><span class="n">readOnly</span><span class="o">=</span><span class="kc">true</span><span class="p">)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">UserDetails</span> <span class="nf">loadUserByUsername</span><span class="p">(</span><span class="n">String</span> <span class="n">username</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">UsernameNotFoundException</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="n">accountSharedService</span><span class="p">.</span><span class="na">findOne</span><span class="p">(</span><span class="n">username</span><span class="p">);</span> <span class="c1">// (3)</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">SampleUserDetails</span><span class="p">(</span><span class="n">account</span><span class="p">);</span> <span class="c1">// (4)</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">ResourceNotFoundException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">UsernameNotFoundException</span><span class="p">(</span><span class="s">&quot;user not found&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span> <span class="c1">// (5)</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Implement <code class="docutils literal"><span class="pre">org.springframework.security.core.userdetails.UserDetailsService</span></code> interface.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Inject <code class="docutils literal"><span class="pre">AccountSharedService</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Delegate the process of fetching <code class="docutils literal"><span class="pre">Account</span></code> object from <code class="docutils literal"><span class="pre">username</span></code> to <code class="docutils literal"><span class="pre">AccountSharedService</span></code>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Create project specific <code class="docutils literal"><span class="pre">UserDetails</span></code> object using the fetched <code class="docutils literal"><span class="pre">Account</span></code> object, and return as the return value of method.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Throw <code class="docutils literal"><span class="pre">UsernameNotFoundException</span></code> when target user is not found.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="setting-database-initialization-script">
<h4><a class="toc-backref" href="#id14">10.4.4.1.5. Setting database initialization script</a><a class="headerlink" href="#setting-database-initialization-script" title="Permalink to this headline">¶</a></h4>
<p>In this tutorial, H2 database (in memory database) is used as a database to store account information.
As a result, database initialization is necessary by executing SQL at the time of starting the application server.</p>
<div class="line-block">
<div class="line">Add the settings for executing SQL script that is used to initialize the database.</div>
<div class="line"><code class="docutils literal"><span class="pre">src/main/resources/META-INF/spring/first-springsecurity-env.xml</span></code></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="hll">    <span class="na">xmlns:jdbc=</span><span class="s">&quot;http://www.springframework.org/schema/jdbc&quot;</span>
</span>    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;</span>
<span class="hll"><span class="s">        http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc.xsd</span>
</span><span class="s">        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">    &quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;dateFactory&quot;</span> <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.common.date.jodatime.DefaultJodaTimeDateFactory&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;realDataSource&quot;</span> <span class="na">class=</span><span class="s">&quot;org.apache.commons.dbcp2.BasicDataSource&quot;</span>
        <span class="na">destroy-method=</span><span class="s">&quot;close&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;driverClassName&quot;</span> <span class="na">value=</span><span class="s">&quot;${database.driverClassName}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;url&quot;</span> <span class="na">value=</span><span class="s">&quot;${database.url}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span> <span class="na">value=</span><span class="s">&quot;${database.username}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">value=</span><span class="s">&quot;${database.password}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultAutoCommit&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxTotal&quot;</span> <span class="na">value=</span><span class="s">&quot;${cp.maxActive}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxIdle&quot;</span> <span class="na">value=</span><span class="s">&quot;${cp.maxIdle}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;minIdle&quot;</span> <span class="na">value=</span><span class="s">&quot;${cp.minIdle}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxWaitMillis&quot;</span> <span class="na">value=</span><span class="s">&quot;${cp.maxWait}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>


    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">class=</span><span class="s">&quot;net.sf.log4jdbc.Log4jdbcProxyDataSource&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">ref=</span><span class="s">&quot;realDataSource&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;jdbc:initialize-database</span> <span class="na">data-source=</span><span class="s">&quot;dataSource&quot;</span>
</span><span class="hll">        <span class="na">ignore-failures=</span><span class="s">&quot;ALL&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;jdbc:script</span> <span class="na">location=</span><span class="s">&quot;classpath:/database/${database}-schema.sql&quot;</span> <span class="na">encoding=</span><span class="s">&quot;UTF-8&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;jdbc:script</span> <span class="na">location=</span><span class="s">&quot;classpath:/database/${database}-dataload.sql&quot;</span> <span class="na">encoding=</span><span class="s">&quot;UTF-8&quot;</span> <span class="nt">/&gt;</span>
</span>    <span class="nt">&lt;/jdbc:initialize-database&gt;</span>

    <span class="c">&lt;!--  REMOVE THIS LINE IF YOU USE JPA</span>
<span class="c">    &lt;bean id=&quot;transactionManager&quot;</span>
<span class="c">        class=&quot;org.springframework.orm.jpa.JpaTransactionManager&quot;&gt;</span>
<span class="c">        &lt;property name=&quot;entityManagerFactory&quot; ref=&quot;entityManagerFactory&quot; /&gt;</span>
<span class="c">    &lt;/bean&gt;</span>
<span class="c">          REMOVE THIS LINE IF YOU USE JPA  --&gt;</span>
    <span class="c">&lt;!--  REMOVE THIS LINE IF YOU USE MyBatis3</span>
<span class="c">    &lt;bean id=&quot;transactionManager&quot;</span>
<span class="c">        class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span>
<span class="c">        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;</span>
<span class="c">        &lt;property name=&quot;rollbackOnCommitFailure&quot; value=&quot;true&quot; /&gt;</span>
<span class="c">    &lt;/bean&gt;</span>
<span class="c">          REMOVE THIS LINE IF YOU USE MyBatis3  --&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p class="first">Perform settings to execute SQL script that initializes the database in <code class="docutils literal"><span class="pre">&lt;jdbc:initialize-database&gt;</span></code> tag.</p>
<p class="last">Define these settings in <code class="docutils literal"><span class="pre">first-springsecurity-env.xml</span></code>, since they are normally used only during development (environment dependent settings).</p>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p class="first">Specify the SQL file where DDL statement for creating a table that stores account information is mentioned.</p>
<p class="last">As per blank project settings, <code class="docutils literal"><span class="pre">H2-schema.sql</span></code> is executed since <code class="docutils literal"><span class="pre">database=H2</span></code> is defined in <code class="docutils literal"><span class="pre">first-springsecurity-infra.properties</span></code>.</p>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p class="first">Specify SQL file, where DML statement to register the demo user is mentioned.</p>
<p class="last">As per blank project settings, <code class="docutils literal"><span class="pre">H2-dataload.sql</span></code>is executed since <code class="docutils literal"><span class="pre">database=H2</span></code> is defined in <code class="docutils literal"><span class="pre">first-springsecurity-infra.properties</span></code>.</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">Create DDL statement for creating a table that stores account information.</div>
<div class="line"><code class="docutils literal"><span class="pre">src/main/resources/database/H2-schema.sql</span></code></div>
</div>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">account</span><span class="p">(</span>
    <span class="n">username</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">),</span>
    <span class="n">password</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">60</span><span class="p">),</span>
    <span class="n">first_name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">),</span>
    <span class="n">last_name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">),</span>
    <span class="k">constraint</span> <span class="n">pk_tbl_account</span> <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">username</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">Create DML statement to register the demo user (username=demo, password=demo).</div>
<div class="line"><code class="docutils literal"><span class="pre">src/main/resources/database/H2-dataload.sql</span></code></div>
</div>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">account</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">)</span> <span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">,</span> <span class="s1">&#39;$2a$10$oxSJl.keBwxmsMLkcT9lPeAIxfNTPNQxpeywMrF7A3kVszwUTqfTK&#39;</span><span class="p">,</span> <span class="s1">&#39;Taro&#39;</span><span class="p">,</span> <span class="s1">&#39;Yamada&#39;</span><span class="p">);</span> <span class="c1">-- (1)</span>
<span class="k">COMMIT</span><span class="p">;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p class="first">As per blank project settings, <code class="docutils literal"><span class="pre">org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span></code> is set as a class to hash the password in <code class="docutils literal"><span class="pre">applicationContext.xml</span></code>.</p>
<p class="last">In this tutorial, a string called <code class="docutils literal"><span class="pre">&quot;demo&quot;</span></code> that is hashed using BCrypt algorithm is inserted in the password in order to perform password hashing using <code class="docutils literal"><span class="pre">BCryptPasswordEncoder</span></code>.</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="package-explorer-after-creating-domain-layer">
<h4><a class="toc-backref" href="#id15">10.4.4.1.6. Package Explorer after creating Domain Layer</a><a class="headerlink" href="#package-explorer-after-creating-domain-layer" title="Permalink to this headline">¶</a></h4>
<p>Confirm the file created in domain layer.</p>
<p>“Hierarchical” is being used for Package Presentation of Package Explorer.</p>
<div class="figure">
<img alt="security tutorial domain layer package explorer" src="../_images/security_tutorial-domain-layer-package-explorer.png" />
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="implementing-application-layer">
<h3><a class="toc-backref" href="#id16">10.4.4.2. Implementing Application Layer</a><a class="headerlink" href="#implementing-application-layer" title="Permalink to this headline">¶</a></h3>
<div class="section" id="spring-security-settings">
<h4><a class="toc-backref" href="#id17">10.4.4.2.1. Spring Security settings</a><a class="headerlink" href="#spring-security-settings" title="Permalink to this headline">¶</a></h4>
<p>Perform authentication/authorization settings using Spring Security in <code class="docutils literal"><span class="pre">spring-security.xml</span></code>.</p>
<p>Following are URL patterns to be handled by the application created in this tutorial.</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">URL</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Description</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">/login.jsp</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">URL to display login form</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">/login.jsp?error=true</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">URL to display transition page (login page) in case of authentication error</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">/login</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">URL for authentication</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">/logout</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">URL for logout</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">/</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">URL to display welcome page</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">/account</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">URL to display account information of login user.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block" id="tutorial-setting-spring-security">
<div class="line">Add following settings apart from the settings provided by blank project.</div>
<div class="line"><code class="docutils literal"><span class="pre">src/main/resources/META-INF/spring/spring-security.xml</span></code></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:sec=</span><span class="s">&quot;http://www.springframework.org/schema/security&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;</span>
<span class="s">        http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd</span>
<span class="s">        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">    &quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;sec:http</span> <span class="na">pattern=</span><span class="s">&quot;/resources/**&quot;</span> <span class="na">security=</span><span class="s">&quot;none&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;sec:http&gt;</span>
<span class="hll">        <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;sec:form-login</span>
</span><span class="hll">            <span class="na">login-page=</span><span class="s">&quot;/login.jsp&quot;</span>
</span><span class="hll">            <span class="na">authentication-failure-url=</span><span class="s">&quot;/login.jsp?error=true&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;sec:logout</span>
</span><span class="hll">            <span class="na">logout-success-url=</span><span class="s">&quot;/&quot;</span>
</span><span class="hll">            <span class="na">delete-cookies=</span><span class="s">&quot;JSESSIONID&quot;</span> <span class="nt">/&gt;</span>
</span>        <span class="nt">&lt;sec:access-denied-handler</span> <span class="na">ref=</span><span class="s">&quot;accessDeniedHandler&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;sec:custom-filter</span> <span class="na">ref=</span><span class="s">&quot;userIdMDCPutFilter&quot;</span> <span class="na">after=</span><span class="s">&quot;ANONYMOUS_FILTER&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;sec:session-management</span> <span class="nt">/&gt;</span>
<span class="hll">        <span class="c">&lt;!-- (3) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;sec:intercept-url</span> <span class="na">pattern=</span><span class="s">&quot;/login.jsp&quot;</span> <span class="na">access=</span><span class="s">&quot;permitAll&quot;</span> <span class="nt">/&gt;</span>
</span>        <span class="nt">&lt;sec:intercept-url</span> <span class="na">pattern=</span><span class="s">&quot;/**&quot;</span> <span class="na">access=</span><span class="s">&quot;isAuthenticated()&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/sec:http&gt;</span>

    <span class="nt">&lt;sec:authentication-manager&gt;</span>
        <span class="c">&lt;!-- com.example.security.domain.service.userdetails.SampleUserDetailsService</span>
<span class="c">          is scanned by component scan with @Service --&gt;</span>
<span class="hll">        <span class="c">&lt;!-- (4) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;sec:authentication-provider</span>
</span><span class="hll">            <span class="na">user-service-ref=</span><span class="s">&quot;sampleUserDetailsService&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="c">&lt;!-- (5) --&gt;</span>
</span><span class="hll">            <span class="nt">&lt;sec:password-encoder</span> <span class="na">ref=</span><span class="s">&quot;passwordEncoder&quot;</span> <span class="nt">/&gt;</span>
</span>        <span class="nt">&lt;/sec:authentication-provider&gt;</span>
    <span class="nt">&lt;/sec:authentication-manager&gt;</span>

    <span class="c">&lt;!-- CSRF Protection --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;accessDeniedHandler&quot;</span>
        <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.access.DelegatingAccessDeniedHandler&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;map&gt;</span>
                <span class="nt">&lt;entry</span>
                    <span class="na">key=</span><span class="s">&quot;org.springframework.security.web.csrf.InvalidCsrfTokenException&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;bean</span>
                        <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.access.AccessDeniedHandlerImpl&quot;</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;errorPage&quot;</span>
                            <span class="na">value=</span><span class="s">&quot;/WEB-INF/views/common/error/invalidCsrfTokenError.jsp&quot;</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;/bean&gt;</span>
                <span class="nt">&lt;/entry&gt;</span>
                <span class="nt">&lt;entry</span>
                    <span class="na">key=</span><span class="s">&quot;org.springframework.security.web.csrf.MissingCsrfTokenException&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;bean</span>
                        <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.access.AccessDeniedHandlerImpl&quot;</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;errorPage&quot;</span>
                            <span class="na">value=</span><span class="s">&quot;/WEB-INF/views/common/error/missingCsrfTokenError.jsp&quot;</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;/bean&gt;</span>
                <span class="nt">&lt;/entry&gt;</span>
            <span class="nt">&lt;/map&gt;</span>
        <span class="nt">&lt;/constructor-arg&gt;</span>
        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;bean</span>
                <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.access.AccessDeniedHandlerImpl&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;errorPage&quot;</span>
                    <span class="na">value=</span><span class="s">&quot;/WEB-INF/views/common/error/accessDeniedError.jsp&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/bean&gt;</span>
        <span class="nt">&lt;/constructor-arg&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!-- Put UserID into MDC --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;userIdMDCPutFilter&quot;</span> <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.security.web.logging.UserIdMDCPutFilter&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p class="first">Perform settings related to login form using <code class="docutils literal"><span class="pre">&lt;sec:form-login&gt;</span></code> tag.</p>
<p>Perform following settings in <code class="docutils literal"><span class="pre">&lt;sec:form-login&gt;</span></code> tag</p>
<ul class="last simple">
<li>URL to display login form in <code class="docutils literal"><span class="pre">login-page</span></code> attribute.</li>
<li>URL to display destination page in case of an authentication error in <code class="docutils literal"><span class="pre">authentication-failure-url</span></code> attribute</li>
<li>URL to perform authentication in <code class="docutils literal"><span class="pre">login-processing-url</span></code> attribute</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p class="first">Perform settings for logout using <code class="docutils literal"><span class="pre">&lt;sec:logout&gt;</span></code> tag.</p>
<p>Perform following settings in <code class="docutils literal"><span class="pre">&lt;sec:logout&gt;</span></code> tag.</p>
<ul class="last simple">
<li>URL to perform logout in <code class="docutils literal"><span class="pre">logout-url</span></code> attribute</li>
<li>URL to display destination page after performing logout in <code class="docutils literal"><span class="pre">logout-success-url</span></code> attribute (URL to display welcome page in this tutorial)</li>
<li>Cookie name to be deleted at the time of logout in <code class="docutils literal"><span class="pre">delete-cookies</span></code> attribute (Cookie name of session ID in this tutorial)</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p class="first">Perform authorization settings for each URL using <code class="docutils literal"><span class="pre">&lt;sec:intercept-url&gt;</span></code> tag.</p>
<p>Perform following settings in <code class="docutils literal"><span class="pre">&lt;sec:intercept-url&gt;</span></code> tag.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">permitAll</span></code> that allows all the users to access the URL to display login form</li>
<li><code class="docutils literal"><span class="pre">isAuthenticated()</span></code> that allows only the authenticated users to access the URLs other than the URLs mentioned above</li>
</ul>
<p class="last">However, all users can access the URL under <code class="docutils literal"><span class="pre">/resources/</span></code>,  since the settings are such that authentication/authorization is not performed by Spring Security (<code class="docutils literal"><span class="pre">&lt;sec:http</span> <span class="pre">pattern=&quot;/resources/**&quot;</span> <span class="pre">security=&quot;none&quot;/&gt;</span></code>).</p>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><p class="first">Perform settings of <code class="docutils literal"><span class="pre">org.springframework.security.authentication.AuthenticationProvider</span></code> that performs authentication using <code class="docutils literal"><span class="pre">&lt;sec:authentication-provider&gt;</span></code> tag.</p>
<p>By default, <code class="docutils literal"><span class="pre">UserDetails</span></code> is fetched using <code class="docutils literal"><span class="pre">UserDetailsService</span></code>, and a class (<code class="docutils literal"><span class="pre">org.springframework.security.authentication.dao.DaoAuthenticationProvider</span></code>) that performs user authentication by comparing hashed password in <code class="docutils literal"><span class="pre">UserDetails</span></code> with the password specified in login form, is used.</p>
<p class="last">Specify component bean name where <code class="docutils literal"><span class="pre">UserDetailsService</span></code> interface is implemented in <code class="docutils literal"><span class="pre">user-service-ref</span></code> attribute. In this tutorial, <code class="docutils literal"><span class="pre">SampleUserDetailsService</span></code> class created in domain layer is set.</p>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><p class="first">Perform settings for a class (<code class="docutils literal"><span class="pre">PasswordEncoder</span></code>) to hash the password specified in login form using <code class="docutils literal"><span class="pre">&lt;sec:password-encoder&gt;</span></code> tag.</p>
<p class="last">In this tutorial, <code class="docutils literal"><span class="pre">org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span></code> defined in <code class="docutils literal"><span class="pre">applicationContext.xml</span></code> is used.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Default URL provided by Spring Security is changed for the URLs that perform authentication and logout process.</p>
<p class="last">This is because, a string (<code class="docutils literal"><span class="pre">spring_security</span></code>) that implies the usage of Spring Security is included in these URLs.
When default URL is used as it is and if security vulnerability is detected in Spring Security,
please be careful as it becomes easy to receive attacks from a malicious user.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="creating-login-page">
<h4><a class="toc-backref" href="#id18">10.4.4.2.2. Creating login page</a><a class="headerlink" href="#creating-login-page" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Create login form on login page.</div>
<div class="line"><code class="docutils literal"><span class="pre">src/main/webapp/login.jsp</span></code></div>
</div>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>Login Page<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span>
    <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/resources/app/css/styles.css&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;wrapper&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h3&gt;</span>Login with Username and Password<span class="nt">&lt;/h3&gt;</span>

        <span class="c">&lt;!-- (1) --&gt;</span>
        <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">&quot;${param.containsKey(&#39;error&#39;)}&quot;</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- (2) --&gt;</span>
            <span class="nt">&lt;t:messagesPanel</span> <span class="na">messagesType=</span><span class="s">&quot;error&quot;</span>
                <span class="na">messagesAttributeName=</span><span class="s">&quot;SPRING_SECURITY_LAST_EXCEPTION&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/c:if&gt;</span>

        <span class="c">&lt;!-- (3) --&gt;</span>
        <span class="nt">&lt;form:form</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/login&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;table&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;</span>User:<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;username&quot;</span>
                        <span class="na">name=</span><span class="s">&quot;username&quot;</span> <span class="na">value=</span><span class="s">&#39;demo&#39;</span><span class="nt">&gt;</span>(demo)<span class="nt">&lt;/td&gt;</span><span class="c">&lt;!-- (4) --&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;</span>Password:<span class="nt">&lt;/label&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">id=</span><span class="s">&quot;password&quot;</span>
                        <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">value=</span><span class="s">&quot;demo&quot;</span> <span class="nt">/&gt;</span>(demo)<span class="nt">&lt;/td&gt;</span><span class="c">&lt;!-- (5) --&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;</span><span class="ni">&amp;nbsp;</span><span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">name=</span><span class="s">&quot;submit&quot;</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Login&quot;</span> <span class="nt">/&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/table&gt;</span>
        <span class="nt">&lt;/form:form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>When authentication fails, <code class="docutils literal"><span class="pre">&quot;/login.jsp?error=true&quot;</span></code> is called and login page is displayed.
Therefore, use <code class="docutils literal"><span class="pre">&lt;c:if&gt;</span></code> tag, so that error message is displayed only at the time after the display of authentication error.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p class="first">Display an error message using <code class="docutils literal"><span class="pre">&lt;t:messagesPanel&gt;</span></code> tag provided by common library.</p>
<p class="last">When authentication fails, an exception object of authentication error is stored with attribute name <code class="docutils literal"><span class="pre">&quot;SPRING_SECURITY_LAST_EXCEPTION&quot;</span></code> in session scope.</p>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p class="first">Set URL for authentication (<code class="docutils literal"><span class="pre">&quot;/login&quot;</span></code>) in <code class="docutils literal"><span class="pre">action</span></code> attribute of <code class="docutils literal"><span class="pre">&lt;form:form&gt;</span></code> tag. This URL is default for Spring Security.</p>
<p class="last">Send parameters necessary for authentication (user name and password) using POST method.</p>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><p class="first">Create a text box to specify user name.</p>
<p class="last">Spring Security’s default parameter name is <code class="docutils literal"><span class="pre">username</span></code>.</p>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><p class="first">Create a text box to specify password (text box for password).</p>
<p class="last">Spring Security’s default parameter name is <code class="docutils literal"><span class="pre">password</span></code>.</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">Ensure that exception object of authentication error stored in session scope could be fetched from JSP.</div>
<div class="line"><code class="docutils literal"><span class="pre">src/main/webapp/WEB-INF/views/common/include.jsp</span></code></div>
</div>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="hll"><span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">session</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="k">%&gt;</span> <span class="c">&lt;!-- (6) --&gt;</span>
</span><span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;c&quot;</span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://java.sun.com/jsp/jstl/fmt&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;fmt&quot;</span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/tags&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;spring&quot;</span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/tags/form&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;form&quot;</span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/security/tags&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;sec&quot;</span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://terasoluna.org/tags&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;t&quot;</span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://terasoluna.org/functions&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;f&quot;</span><span class="k">%&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td>Set <code class="docutils literal"><span class="pre">session</span></code> attribute of <code class="docutils literal"><span class="pre">page</span></code> directive to <code class="docutils literal"><span class="pre">true</span></code>.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As per default settings of blank project, session scope cannot be accessed from JSP.
This is to ensure that the session cannot be easily used; however,
in case of fetching an exception object of authentication error from JSP, it is necessary to be accessible from a JSP by session scope.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">Try to display the welcome page by entering  <a class="reference external" href="http://localhost:8080/first-springsecurity/">http://localhost:8080/first-springsecurity/</a> in browser address bar.</div>
<div class="line">Since the user is not logged in, it is transited to the set value of <code class="docutils literal"><span class="pre">login-page</span></code> attribute of <code class="docutils literal"><span class="pre">&lt;sec:form-login&gt;</span></code> tag (<a class="reference external" href="http://localhost:8080/first-springsecurity/login.jsp">http://localhost:8080/first-springsecurity/login.jsp</a>), and the screen below is displayed.</div>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/security_tutorial_login_page.png"><img alt="../_images/security_tutorial_login_page.png" src="../_images/security_tutorial_login_page.png" style="width: 80%;" /></a>
</div>
</div>
<div class="section" id="accessing-account-information-of-login-user-from-jsp">
<h4><a class="toc-backref" href="#id19">10.4.4.2.3. Accessing account information of login user from JSP</a><a class="headerlink" href="#accessing-account-information-of-login-user-from-jsp" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Access the account information of login user from JSP and display the name.</div>
<div class="line"><code class="docutils literal"><span class="pre">src/main/webapp/WEB-INF/views/welcome/home.jsp</span></code></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>Home<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span>
    <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/resources/app/css/styles.css&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>

<span class="hll"><span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll"><span class="nt">&lt;sec:authentication</span> <span class="na">property=</span><span class="s">&quot;principal.account&quot;</span> <span class="na">var=</span><span class="s">&quot;account&quot;</span> <span class="nt">/&gt;</span>
</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;wrapper&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h1&gt;</span>Hello world!<span class="nt">&lt;/h1&gt;</span>
        <span class="nt">&lt;p&gt;</span>The time on the server is ${serverTime}.<span class="nt">&lt;/p&gt;</span>
<span class="hll">        <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;p&gt;</span>Welcome ${f:h(account.firstName)} ${f:h(account.lastName)} !!<span class="nt">&lt;/p&gt;</span>
</span>        <span class="nt">&lt;ul&gt;</span>
            <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/account&quot;</span><span class="nt">&gt;</span>view account<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p class="first">Access <code class="docutils literal"><span class="pre">org.springframework.security.core.Authentication</span></code> object of login user using <code class="docutils literal"><span class="pre">&lt;sec:authentication&gt;</span></code> tag.</p>
<p>By using <code class="docutils literal"><span class="pre">property</span></code> attribute, any property retained by <code class="docutils literal"><span class="pre">Authentication</span></code> object can be accessed , and the property value that has been accessed can be stored in any scope using <code class="docutils literal"><span class="pre">var</span></code> attribute.
Page scope is set by default and referred within this JSP only.</p>
<p class="last">In this tutorial, <code class="docutils literal"><span class="pre">Account</span></code> object of login user is stored in page scope with attribute name <code class="docutils literal"><span class="pre">account</span></code>.</p>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>Access <code class="docutils literal"><span class="pre">Account</span></code> object of login user and display <code class="docutils literal"><span class="pre">firstName</span></code> and <code class="docutils literal"><span class="pre">lastName</span></code>.</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Click Login button on login page to display welcome page.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/security_tutorial_welcome_page.png"><img alt="../_images/security_tutorial_welcome_page.png" src="../_images/security_tutorial_welcome_page.png" style="width: 70%;" /></a>
</div>
</div>
<div class="section" id="adding-logout-button">
<h4><a class="toc-backref" href="#id20">10.4.4.2.4. Adding logout button</a><a class="headerlink" href="#adding-logout-button" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Add a button to perform logout.</div>
<div class="line"><code class="docutils literal"><span class="pre">src/main/webapp/WEB-INF/views/welcome/home.jsp</span></code></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>Home<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span>
    <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/resources/app/css/styles.css&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;sec:authentication</span> <span class="na">property=</span><span class="s">&quot;principal.account&quot;</span> <span class="na">var=</span><span class="s">&quot;account&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;wrapper&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h1&gt;</span>Hello world!<span class="nt">&lt;/h1&gt;</span>
        <span class="nt">&lt;p&gt;</span>The time on the server is ${serverTime}.<span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;p&gt;</span>Welcome ${f:h(account.firstName)} ${f:h(account.lastName)} !!<span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;p&gt;</span>
<span class="hll">            <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">            <span class="nt">&lt;form:form</span> <span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/logout&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span><span class="nt">&gt;</span>Logout<span class="nt">&lt;/button&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/form:form&gt;</span>
</span>        <span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;ul&gt;</span>
            <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/account&quot;</span><span class="nt">&gt;</span>view account<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p class="first">Add a form for logout using <code class="docutils literal"><span class="pre">&lt;form:form&gt;</span></code> tag.</p>
<p class="last">Add Logout button by specifying the URL for logout (<code class="docutils literal"><span class="pre">&quot;/logout&quot;</span></code>) in <code class="docutils literal"><span class="pre">action</span></code> attribute. This URL is default for Spring Security.</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Click Logout button to log out from the application (login page is displayed).</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/security_tutorial_add_logout.png"><img alt="../_images/security_tutorial_add_logout.png" src="../_images/security_tutorial_add_logout.png" style="width: 70%;" /></a>
</div>
</div>
<div class="section" id="accessing-account-information-of-login-user-from-controller">
<h4><a class="toc-backref" href="#id21">10.4.4.2.5. Accessing account information of login user from Controller</a><a class="headerlink" href="#accessing-account-information-of-login-user-from-controller" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Access account information of login user from Controller and pass it to View.</div>
<div class="line"><code class="docutils literal"><span class="pre">src/main/java/com/example/security/app/account/AccountController.java</span></code></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.security.app.account</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.security.core.annotation.AuthenticationPrincipal</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.example.security.domain.model.Account</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.security.domain.service.userdetails.SampleUserDetails</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;account&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccountController</span> <span class="p">{</span>

    <span class="nd">@RequestMapping</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">view</span><span class="p">(</span>
<span class="hll">            <span class="nd">@AuthenticationPrincipal</span> <span class="n">SampleUserDetails</span> <span class="n">userDetails</span><span class="p">,</span> <span class="c1">// (1)</span>
</span>            <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">        <span class="c1">// (2)</span>
</span><span class="hll">        <span class="n">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="n">userDetails</span><span class="p">.</span><span class="na">getAccount</span><span class="p">();</span>
</span><span class="hll">        <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">account</span><span class="p">);</span>
</span>        <span class="k">return</span> <span class="s">&quot;account/view&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Receive <code class="docutils literal"><span class="pre">UserDetails</span></code> object of login user by specifying <code class="docutils literal"><span class="pre">&#64;AuthenticationPrincipal</span></code> annotation.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Fetch <code class="docutils literal"><span class="pre">Account</span></code> object which is retained by <code class="docutils literal"><span class="pre">SampleUserDetails</span></code> object and store it in <code class="docutils literal"><span class="pre">Model</span></code> in order to pass it to View.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">Access the account information passed from Controller to display the same.</div>
<div class="line"><code class="docutils literal"><span class="pre">src/main/webapp/WEB-INF/views/account/view.jsp</span></code></div>
</div>
<div class="highlight-jsp"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>Home<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span>
    <span class="na">href=</span><span class="s">&quot;${pageContext.request.contextPath}/resources/app/css/styles.css&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;wrapper&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h1&gt;</span>Account Information<span class="nt">&lt;/h1&gt;</span>
        <span class="nt">&lt;table&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;th&gt;</span>Username<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;td&gt;</span>${f:h(account.username)}<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;th&gt;</span>First name<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;td&gt;</span>${f:h(account.firstName)}<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;th&gt;</span>Last name<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;td&gt;</span>${f:h(account.lastName)}<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/table&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Click ‘view account’ link on welcome page to display “Show account information” page of login user.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/security_tutorial_account_information_page.png"><img alt="../_images/security_tutorial_account_information_page.png" src="../_images/security_tutorial_account_information_page.png" style="width: 80%;" /></a>
</div>
</div>
<div class="section" id="package-explorer-after-creating-application-layer">
<h4><a class="toc-backref" href="#id22">10.4.4.2.6. Package explorer after creating application layer</a><a class="headerlink" href="#package-explorer-after-creating-application-layer" title="Permalink to this headline">¶</a></h4>
<p>Confirm the file created in application layer.</p>
<p>“Hierarchical” is being used for Package Presentation of Package Explorer.</p>
<div class="figure">
<img alt="security tutorial application layer package explorer" src="../_images/security_tutorial-application-layer-package-explorer.png" />
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id23">10.4.5. Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>We have covered the following topics in this tutorial.</p>
<ul class="simple">
<li>Basic authentication/authorization using Spring Security</li>
<li>How to customize authentication user object</li>
<li>Authentication settings using Repository and Service class</li>
<li>How to access logged in account information from JSP</li>
<li>How to access logged in account information from Controller</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="appendix">
<h2><a class="toc-backref" href="#id24">10.4.6. Appendix</a><a class="headerlink" href="#appendix" title="Permalink to this headline">¶</a></h2>
<div class="section" id="description-of-configuration-file">
<span id="securitytutorialappendixconfigurationfiles"></span><h3><a class="toc-backref" href="#id25">10.4.6.1. Description of configuration file</a><a class="headerlink" href="#description-of-configuration-file" title="Permalink to this headline">¶</a></h3>
<p>Describe configuration file to understand which settings are necessary for using Spring Security.</p>
<div class="section" id="spring-security-xml">
<h4><a class="toc-backref" href="#id26">10.4.6.1.1. spring-security.xml</a><a class="headerlink" href="#spring-security-xml" title="Permalink to this headline">¶</a></h4>
<p>Perform definitions related to Spring Security in <code class="docutils literal"><span class="pre">spring-security.xml</span></code>.</p>
<p><code class="docutils literal"><span class="pre">src/main/resources/META-INF/spring/spring-security.xml</span></code>of the blank project which has been created has following settings.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:sec=</span><span class="s">&quot;http://www.springframework.org/schema/security&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;</span>
<span class="s">        http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd</span>
<span class="s">        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">    &quot;</span><span class="nt">&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (1) --&gt;</span>
</span>    <span class="nt">&lt;sec:http</span> <span class="na">pattern=</span><span class="s">&quot;/resources/**&quot;</span> <span class="na">security=</span><span class="s">&quot;none&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;sec:http&gt;</span>
<span class="hll">        <span class="c">&lt;!-- (2) --&gt;</span>
</span>        <span class="nt">&lt;sec:form-login/&gt;</span>
<span class="hll">        <span class="c">&lt;!-- (3) --&gt;</span>
</span>        <span class="nt">&lt;sec:logout/&gt;</span>
<span class="hll">        <span class="c">&lt;!-- (4) --&gt;</span>
</span>        <span class="nt">&lt;sec:access-denied-handler</span> <span class="na">ref=</span><span class="s">&quot;accessDeniedHandler&quot;</span><span class="nt">/&gt;</span>
<span class="hll">        <span class="c">&lt;!-- (5) --&gt;</span>
</span>        <span class="nt">&lt;sec:custom-filter</span> <span class="na">ref=</span><span class="s">&quot;userIdMDCPutFilter&quot;</span> <span class="na">after=</span><span class="s">&quot;ANONYMOUS_FILTER&quot;</span><span class="nt">/&gt;</span>
<span class="hll">        <span class="c">&lt;!-- (6) --&gt;</span>
</span>        <span class="nt">&lt;sec:session-management</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/sec:http&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (7) --&gt;</span>
</span>    <span class="nt">&lt;sec:authentication-manager</span> <span class="nt">/&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (4) --&gt;</span>
</span>    <span class="c">&lt;!-- CSRF Protection --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;accessDeniedHandler&quot;</span>
        <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.access.DelegatingAccessDeniedHandler&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;map&gt;</span>
                <span class="nt">&lt;entry</span>
                    <span class="na">key=</span><span class="s">&quot;org.springframework.security.web.csrf.InvalidCsrfTokenException&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;bean</span>
                        <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.access.AccessDeniedHandlerImpl&quot;</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;errorPage&quot;</span>
                            <span class="na">value=</span><span class="s">&quot;/WEB-INF/views/common/error/invalidCsrfTokenError.jsp&quot;</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;/bean&gt;</span>
                <span class="nt">&lt;/entry&gt;</span>
                <span class="nt">&lt;entry</span>
                    <span class="na">key=</span><span class="s">&quot;org.springframework.security.web.csrf.MissingCsrfTokenException&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;bean</span>
                        <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.access.AccessDeniedHandlerImpl&quot;</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;errorPage&quot;</span>
                            <span class="na">value=</span><span class="s">&quot;/WEB-INF/views/common/error/missingCsrfTokenError.jsp&quot;</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;/bean&gt;</span>
                <span class="nt">&lt;/entry&gt;</span>
            <span class="nt">&lt;/map&gt;</span>
        <span class="nt">&lt;/constructor-arg&gt;</span>
        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;bean</span>
                <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.access.AccessDeniedHandlerImpl&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;errorPage&quot;</span>
                    <span class="na">value=</span><span class="s">&quot;/WEB-INF/views/common/error/accessDeniedError.jsp&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/bean&gt;</span>
        <span class="nt">&lt;/constructor-arg&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

<span class="hll">    <span class="c">&lt;!-- (5) --&gt;</span>
</span>    <span class="c">&lt;!-- Put UserID into MDC --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;userIdMDCPutFilter&quot;</span> <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.security.web.logging.UserIdMDCPutFilter&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p class="first">Control authentication/authorization for HTTP access using <code class="docutils literal"><span class="pre">&lt;sec:http&gt;</span></code> tag.</p>
<p class="last">As per the default settings of blank project , URL to access static resources (js, css, image files, etc.) is out of authentication/authorization scope.</p>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p class="first">Control login related operation which use form  authentication, by using <code class="docutils literal"><span class="pre">&lt;sec:form-login&gt;</span></code> tag.</p>
<p class="last">For usage method, refer to “<a class="reference internal" href="../Security/Authentication.html#form-login"><span class="std std-ref">Form authentication</span></a>”.</p>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><p class="first">Control logout related operations by using <code class="docutils literal"><span class="pre">&lt;sec:logout&gt;</span></code> tag.</p>
<p class="last">For usage method, refer to [<a class="reference internal" href="../Security/Authentication.html#springsecurityauthenticationlogout"><span class="std std-ref">Logout</span></a>].</p>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><p class="first">Control action after access is denied using <code class="docutils literal"><span class="pre">&lt;sec:access-denied-handler&gt;</span></code> tag.</p>
<p>Following settings are performed as default settings of blank project.</p>
<ul class="last simple">
<li>Destination when invalid CSRF token is detected (when <code class="docutils literal"><span class="pre">InvalidCsrfTokenException</span></code> occurs)</li>
<li>Destination when CSRF token cannot be fetched from token store (when <code class="docutils literal"><span class="pre">MissingCsrfTokenException</span></code> occurs)</li>
<li>Destination when access is denied in authorization (when <code class="docutils literal"><span class="pre">AccessDeniedException</span></code> other than above mentioned occurs)</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td>Enable servlet filter to store authentication user name of Spring Security in logger MDC.
Once this setting is enabled, authentication user name is output in log thereby enhancing the traceability.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><p class="first">Control session management method of Spring Security using <code class="docutils literal"><span class="pre">&lt;sec:session-management&gt;</span></code> tag.</p>
<p class="last">For usage method, refer to “<a class="reference internal" href="../Security/SessionManagement.html#springsecuritysessionmanagementsetup"><span class="std std-ref">Applying Session management function</span></a>”.</p>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><p class="first">Control authentication using <code class="docutils literal"><span class="pre">&lt;sec:authentication-manager&gt;</span></code> tag.</p>
<p class="last">For usage method, refer to “<a class="reference internal" href="../Security/Authentication.html#authenticationproviderconfiguration"><span class="std std-ref">Applying DB authentication</span></a>”.</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="spring-mvc-xml">
<h4><a class="toc-backref" href="#id27">10.4.6.1.2. spring-mvc.xml</a><a class="headerlink" href="#spring-mvc-xml" title="Permalink to this headline">¶</a></h4>
<p>Perform settings to link Spring Security and Spring MVC in <code class="docutils literal"><span class="pre">spring-mvc.xml</span></code>.</p>
<p><code class="docutils literal"><span class="pre">src/main/resources/META-INF/spring/spring-mvc.xml</span></code> of the blank project that has been created has following settings.
Description of settings not related to Spring Security is omitted.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
    <span class="na">xmlns:mvc=</span><span class="s">&quot;http://www.springframework.org/schema/mvc&quot;</span>
    <span class="na">xmlns:util=</span><span class="s">&quot;http://www.springframework.org/schema/util&quot;</span>
    <span class="na">xmlns:aop=</span><span class="s">&quot;http://www.springframework.org/schema/aop&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd</span>
<span class="s">        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd</span>
<span class="s">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span>
<span class="s">        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd</span>
<span class="s">    &quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;context:property-placeholder</span>
        <span class="na">location=</span><span class="s">&quot;classpath*:/META-INF/spring/*.properties&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;mvc:annotation-driven&gt;</span>
        <span class="nt">&lt;mvc:argument-resolvers&gt;</span>
            <span class="nt">&lt;bean</span>
                <span class="na">class=</span><span class="s">&quot;org.springframework.data.web.PageableHandlerMethodArgumentResolver&quot;</span> <span class="nt">/&gt;</span>
<span class="hll">            <span class="c">&lt;!-- (1) --&gt;</span>
</span><span class="hll">            <span class="nt">&lt;bean</span>
</span><span class="hll">                <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.method.annotation.AuthenticationPrincipalArgumentResolver&quot;</span> <span class="nt">/&gt;</span>
</span>        <span class="nt">&lt;/mvc:argument-resolvers&gt;</span>
        <span class="c">&lt;!-- workaround to CVE-2016-5007. --&gt;</span>
        <span class="nt">&lt;mvc:path-matching</span> <span class="na">path-matcher=</span><span class="s">&quot;pathMatcher&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/mvc:annotation-driven&gt;</span>

    <span class="nt">&lt;mvc:default-servlet-handler</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&quot;com.example.security.app&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;mvc:resources</span> <span class="na">mapping=</span><span class="s">&quot;/resources/**&quot;</span>
        <span class="na">location=</span><span class="s">&quot;/resources/,classpath:META-INF/resources/&quot;</span>
        <span class="na">cache-period=</span><span class="s">&quot;#{60 * 60}&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;mvc:interceptors&gt;</span>
        <span class="nt">&lt;mvc:interceptor&gt;</span>
            <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&quot;/**&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/resources/**&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/**/*.html&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;bean</span>
                <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.logging.TraceLoggingInterceptor&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/mvc:interceptor&gt;</span>
        <span class="nt">&lt;mvc:interceptor&gt;</span>
            <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&quot;/**&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/resources/**&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/**/*.html&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;bean</span>
                <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.token.transaction.TransactionTokenInterceptor&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/mvc:interceptor&gt;</span>
        <span class="nt">&lt;mvc:interceptor&gt;</span>
            <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&quot;/**&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/resources/**&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&quot;/**/*.html&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.codelist.CodeListInterceptor&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;codeListIdPattern&quot;</span> <span class="na">value=</span><span class="s">&quot;CL_.+&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/bean&gt;</span>
        <span class="nt">&lt;/mvc:interceptor&gt;</span>
        <span class="c">&lt;!--  REMOVE THIS LINE IF YOU USE JPA</span>
<span class="c">        &lt;mvc:interceptor&gt;</span>
<span class="c">            &lt;mvc:mapping path=&quot;/**&quot; /&gt;</span>
<span class="c">            &lt;mvc:exclude-mapping path=&quot;/resources/**&quot; /&gt;</span>
<span class="c">            &lt;mvc:exclude-mapping path=&quot;/**/*.html&quot; /&gt;</span>
<span class="c">            &lt;bean</span>
<span class="c">                class=&quot;org.springframework.orm.jpa.support.OpenEntityManagerInViewInterceptor&quot; /&gt;</span>
<span class="c">        &lt;/mvc:interceptor&gt;</span>
<span class="c">            REMOVE THIS LINE IF YOU USE JPA  --&gt;</span>
    <span class="nt">&lt;/mvc:interceptors&gt;</span>

    <span class="c">&lt;!-- Settings View Resolver. --&gt;</span>
    <span class="nt">&lt;mvc:view-resolvers&gt;</span>
        <span class="nt">&lt;mvc:bean-name</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;mvc:tiles</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;mvc:jsp</span> <span class="na">prefix=</span><span class="s">&quot;/WEB-INF/views/&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/mvc:view-resolvers&gt;</span>

    <span class="nt">&lt;mvc:tiles-configurer&gt;</span>
        <span class="nt">&lt;mvc:definitions</span> <span class="na">location=</span><span class="s">&quot;/WEB-INF/tiles/tiles-definitions.xml&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/mvc:tiles-configurer&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;requestDataValueProcessor&quot;</span>
        <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.mvc.support.CompositeRequestDataValueProcessor&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;constructor-arg&gt;</span>
            <span class="nt">&lt;util:list&gt;</span>
<span class="hll">                <span class="c">&lt;!-- (2) --&gt;</span>
</span><span class="hll">                <span class="nt">&lt;bean</span>
</span><span class="hll">                    <span class="na">class=</span><span class="s">&quot;org.springframework.security.web.servlet.support.csrf.CsrfRequestDataValueProcessor&quot;</span> <span class="nt">/&gt;</span>
</span>                <span class="nt">&lt;bean</span>
                    <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.token.transaction.TransactionTokenRequestDataValueProcessor&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/util:list&gt;</span>
        <span class="nt">&lt;/constructor-arg&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!-- Setting Exception Handling. --&gt;</span>
    <span class="c">&lt;!-- Exception Resolver. --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;systemExceptionResolver&quot;</span>
        <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.exception.SystemExceptionResolver&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionCodeResolver&quot;</span> <span class="na">ref=</span><span class="s">&quot;exceptionCodeResolver&quot;</span> <span class="nt">/&gt;</span>
        <span class="c">&lt;!-- Setting and Customization by project. --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;order&quot;</span> <span class="na">value=</span><span class="s">&quot;3&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionMappings&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;map&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;ResourceNotFoundException&quot;</span> <span class="na">value=</span><span class="s">&quot;common/error/resourceNotFoundError&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;BusinessException&quot;</span> <span class="na">value=</span><span class="s">&quot;common/error/businessError&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;InvalidTransactionTokenException&quot;</span> <span class="na">value=</span><span class="s">&quot;common/error/transactionTokenError&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;.DataAccessException&quot;</span> <span class="na">value=</span><span class="s">&quot;common/error/dataAccessError&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/map&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;statusCodes&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;map&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;common/error/resourceNotFoundError&quot;</span> <span class="na">value=</span><span class="s">&quot;404&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;common/error/businessError&quot;</span> <span class="na">value=</span><span class="s">&quot;409&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;common/error/transactionTokenError&quot;</span> <span class="na">value=</span><span class="s">&quot;409&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;common/error/dataAccessError&quot;</span> <span class="na">value=</span><span class="s">&quot;500&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/map&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultErrorView&quot;</span> <span class="na">value=</span><span class="s">&quot;common/error/systemError&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;defaultStatusCode&quot;</span> <span class="na">value=</span><span class="s">&quot;500&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
    <span class="c">&lt;!-- Setting AOP. --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;handlerExceptionResolverLoggingInterceptor&quot;</span>
        <span class="na">class=</span><span class="s">&quot;org.terasoluna.gfw.web.exception.HandlerExceptionResolverLoggingInterceptor&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exceptionLogger&quot;</span> <span class="na">ref=</span><span class="s">&quot;exceptionLogger&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;aop:config&gt;</span>
        <span class="nt">&lt;aop:advisor</span> <span class="na">advice-ref=</span><span class="s">&quot;handlerExceptionResolverLoggingInterceptor&quot;</span>
            <span class="na">pointcut=</span><span class="s">&quot;execution(* org.springframework.web.servlet.HandlerExceptionResolver.resolveException(..))&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/aop:config&gt;</span>

    <span class="c">&lt;!-- Setting PathMatcher. --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;pathMatcher&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.util.AntPathMatcher&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;trimTokens&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p class="first">Settings to ensure that <code class="docutils literal"><span class="pre">UserDetails</span></code> object of login user is received as Controller argument, by specifying <code class="docutils literal"><span class="pre">&#64;AuthenticationPrincipal</span></code> annotation.</p>
<p class="last">Specify <code class="docutils literal"><span class="pre">AuthenticationPrincipalArgumentResolver</span></code> in <code class="docutils literal"><span class="pre">&lt;mvc:argument-resolvers&gt;</span></code> tag.</p>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><p class="first">Settings to embed CSRF token value in HTML form using <code class="docutils literal"><span class="pre">&lt;form:form&gt;</span></code> tag (JSP tag library).</p>
<p class="last">Specify <code class="docutils literal"><span class="pre">CsrfRequestDataValueProcessor</span></code> in <code class="docutils literal"><span class="pre">CompositeRequestDataValueProcessor</span></code> constructor.</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../Appendix/index.html" title="11. Appendix(Know How)"
             >next</a> |</li>
        <li class="right" >
          <a href="TutorialSession.html" title="10.3. Session tutorial"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.2.1.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >10. Tutorials</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013-2017, NTT DATA Corporation.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.3.Theme by <a href="http://github.com/vkvn">vkvn</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>