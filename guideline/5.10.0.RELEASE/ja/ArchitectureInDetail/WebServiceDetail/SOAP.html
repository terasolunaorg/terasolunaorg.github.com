<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5.3. SOAP Web Service（サーバ/クライアント） &#8212; TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.10.0.RELEASE documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/solar.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/tabs.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="6. データアクセス" href="../DataAccessDetail/index.html" />
    <link rel="prev" title="5.2. RESTクライアント（HTTPクライアント）" href="RestClient.html" /><script src="../../_static/jquery.js" type="text/javascript"></script>
<script src="../../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../../_static/solarized-dark.css" rel="stylesheet">
<link href="../../_static/jquery.treeview.css" rel="stylesheet">
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../DataAccessDetail/index.html" title="6. データアクセス"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="RestClient.html" title="5.2. RESTクライアント（HTTPクライアント）"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.10.0.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U"><span class="section-number">5. </span>Web Service</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">5.3. </span>SOAP Web Service（サーバ/クライアント）</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox"> scroll sidebar</label>
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">5.3. SOAP Web Service（サーバ/クライアント）</a><ul>
<li><a class="reference internal" href="#overview">5.3.1. Overview</a><ul>
<li><a class="reference internal" href="#soap">5.3.1.1. SOAPとは</a></li>
<li><a class="reference internal" href="#soapjakarta-xml-web-services">5.3.1.2. SOAPとJakarta XML Web Services</a></li>
<li><a class="reference internal" href="#soapoverviewprerequisites">5.3.1.3. 本ガイドラインにおいて利用するJakarta XML Web Services実装ライブラリについて</a></li>
<li><a class="reference internal" href="#jakarta-xml-web-servicessoap-web-service">5.3.1.4. Jakarta XML Web Servicesを利用したSOAP Web Serviceの開発について</a></li>
<li><a class="reference internal" href="#soap-web-serviceurl">5.3.1.5. SOAP Web Serviceとして公開されるURL</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use">5.3.2. How to use</a><ul>
<li><a class="reference internal" href="#soaphowtousewebapplicationconstruction">5.3.2.1. SOAPサーバの作成</a><ul>
<li><a class="reference internal" href="#id4">5.3.2.1.1. プロジェクトの構成</a></li>
<li><a class="reference internal" href="#soapapplicationconfiguration">5.3.2.1.2. アプリケーションの設定</a></li>
<li><a class="reference internal" href="#web">5.3.2.1.3. Webサービスの実装</a></li>
<li><a class="reference internal" href="#soappackagenamespace">5.3.2.1.4. パッケージ名とネームスペースについて</a></li>
<li><a class="reference internal" href="#webservice">5.3.2.1.5. WebService実装クラスの作成</a></li>
<li><a class="reference internal" href="#soaphowtouseservervalidation">5.3.2.1.6. 入力チェックの実装</a></li>
<li><a class="reference internal" href="#id8">5.3.2.1.7. セキュリティ対策</a></li>
<li><a class="reference internal" href="#soaphowtouseserverexceptionhandler">5.3.2.1.8. 例外ハンドリングの実装</a></li>
<li><a class="reference internal" href="#mtom">5.3.2.1.9. MTOMを利用した大容量のバイナリデータを扱う方法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id10">5.3.2.2. クライアントの作成</a><ul>
<li><a class="reference internal" href="#id11">5.3.2.2.1. プロジェクトの構成</a></li>
<li><a class="reference internal" href="#soaphowtousewebserviceclient">5.3.2.2.2. Webサービス クライアントの実装</a></li>
<li><a class="reference internal" href="#id13">5.3.2.2.3. セキュリティ対策</a></li>
<li><a class="reference internal" href="#soapexceptiontype">5.3.2.2.4. WEBサービス クライアントで取り扱う例外の種類</a></li>
<li><a class="reference internal" href="#soaphowtouseexceptionhandler">5.3.2.2.5. 例外ハンドリングの実装</a></li>
<li><a class="reference internal" href="#id16">5.3.2.2.6. タイムアウトの設定</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#appendix">5.3.3. Appendix</a><ul>
<li><a class="reference internal" href="#soapappendixaddproject">5.3.3.1. SOAPサーバ用にプロジェクトの設定を変更する</a><ul>
<li><a class="reference internal" href="#id18">5.3.3.1.1. 既存プロジェクトの変更</a></li>
<li><a class="reference internal" href="#model">5.3.3.1.2. modelプロジェクトの作成</a></li>
<li><a class="reference internal" href="#id19">5.3.3.1.3. webserviceプロジェクトの作成</a></li>
</ul>
</li>
<li><a class="reference internal" href="#soapappendixpackageserver">5.3.3.2. SOAPサーバのパッケージ構成</a><ul>
<li><a class="reference internal" href="#server-projectname-domain">5.3.3.2.1. [server projectName]-domain</a></li>
<li><a class="reference internal" href="#server-projectname-web">5.3.3.2.2. [server projectName]-web</a></li>
<li><a class="reference internal" href="#server-projectname-env">5.3.3.2.3. [server projectName]-env</a></li>
<li><a class="reference internal" href="#server-projectname-model">5.3.3.2.4. [server projectName]-model</a></li>
<li><a class="reference internal" href="#server-projectname-webservice">5.3.3.2.5. [server projectName]-webservice</a></li>
</ul>
</li>
<li><a class="reference internal" href="#soapappendixpackageclient">5.3.3.3. クライアントのパッケージ構成</a><ul>
<li><a class="reference internal" href="#client-projectname-domain">5.3.3.3.1. [client projectName]-domain</a></li>
<li><a class="reference internal" href="#client-projectname-web">5.3.3.3.2. [client projectName]-web</a></li>
<li><a class="reference internal" href="#client-projectname-env">5.3.3.3.3. [client projectName]-env</a></li>
</ul>
</li>
<li><a class="reference internal" href="#webservicewsdl">5.3.3.4. WebServiceインターフェースの実装クラスとWSDLファイルの関係</a></li>
<li><a class="reference internal" href="#soapendpointaddress">5.3.3.5. テスト等でエンドポイントアドレスを上書き指定したい場合</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="RestClient.html"
                          title="previous chapter"><span class="section-number">5.2. </span>RESTクライアント（HTTPクライアント）</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../DataAccessDetail/index.html"
                          title="next chapter"><span class="section-number">6. </span>データアクセス</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/ArchitectureInDetail/WebServiceDetail/SOAP.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="soap-web-service">
<h1><span class="section-number">5.3. </span>SOAP Web Service（サーバ/クライアント）<a class="headerlink" href="#soap-web-service" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="id1">
<p class="topic-title">目次</p>
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id23">Overview</a></p>
<ul>
<li><p><a class="reference internal" href="#soap" id="id24">SOAPとは</a></p></li>
<li><p><a class="reference internal" href="#soapjakarta-xml-web-services" id="id25">SOAPとJakarta XML Web Services</a></p></li>
<li><p><a class="reference internal" href="#soapoverviewprerequisites" id="id26">本ガイドラインにおいて利用するJakarta XML Web Services実装ライブラリについて</a></p></li>
<li><p><a class="reference internal" href="#jakarta-xml-web-servicessoap-web-service" id="id27">Jakarta XML Web Servicesを利用したSOAP Web Serviceの開発について</a></p></li>
<li><p><a class="reference internal" href="#soap-web-serviceurl" id="id28">SOAP Web Serviceとして公開されるURL</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#how-to-use" id="id29">How to use</a></p>
<ul>
<li><p><a class="reference internal" href="#soaphowtousewebapplicationconstruction" id="id30">SOAPサーバの作成</a></p>
<ul>
<li><p><a class="reference internal" href="#id4" id="id31">プロジェクトの構成</a></p></li>
<li><p><a class="reference internal" href="#soapapplicationconfiguration" id="id32">アプリケーションの設定</a></p></li>
<li><p><a class="reference internal" href="#web" id="id33">Webサービスの実装</a></p></li>
<li><p><a class="reference internal" href="#soappackagenamespace" id="id34">パッケージ名とネームスペースについて</a></p></li>
<li><p><a class="reference internal" href="#webservice" id="id35">WebService実装クラスの作成</a></p></li>
<li><p><a class="reference internal" href="#soaphowtouseservervalidation" id="id36">入力チェックの実装</a></p></li>
<li><p><a class="reference internal" href="#id8" id="id37">セキュリティ対策</a></p></li>
<li><p><a class="reference internal" href="#soaphowtouseserverexceptionhandler" id="id38">例外ハンドリングの実装</a></p></li>
<li><p><a class="reference internal" href="#mtom" id="id39">MTOMを利用した大容量のバイナリデータを扱う方法</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id10" id="id40">クライアントの作成</a></p>
<ul>
<li><p><a class="reference internal" href="#id11" id="id41">プロジェクトの構成</a></p></li>
<li><p><a class="reference internal" href="#soaphowtousewebserviceclient" id="id42">Webサービス クライアントの実装</a></p></li>
<li><p><a class="reference internal" href="#id13" id="id43">セキュリティ対策</a></p></li>
<li><p><a class="reference internal" href="#soapexceptiontype" id="id44">WEBサービス クライアントで取り扱う例外の種類</a></p></li>
<li><p><a class="reference internal" href="#soaphowtouseexceptionhandler" id="id45">例外ハンドリングの実装</a></p></li>
<li><p><a class="reference internal" href="#id16" id="id46">タイムアウトの設定</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#appendix" id="id47">Appendix</a></p>
<ul>
<li><p><a class="reference internal" href="#soapappendixaddproject" id="id48">SOAPサーバ用にプロジェクトの設定を変更する</a></p>
<ul>
<li><p><a class="reference internal" href="#id18" id="id49">既存プロジェクトの変更</a></p></li>
<li><p><a class="reference internal" href="#model" id="id50">modelプロジェクトの作成</a></p></li>
<li><p><a class="reference internal" href="#id19" id="id51">webserviceプロジェクトの作成</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#soapappendixpackageserver" id="id52">SOAPサーバのパッケージ構成</a></p>
<ul>
<li><p><a class="reference internal" href="#server-projectname-domain" id="id53">[server projectName]-domain</a></p></li>
<li><p><a class="reference internal" href="#server-projectname-web" id="id54">[server projectName]-web</a></p></li>
<li><p><a class="reference internal" href="#server-projectname-env" id="id55">[server projectName]-env</a></p></li>
<li><p><a class="reference internal" href="#server-projectname-model" id="id56">[server projectName]-model</a></p></li>
<li><p><a class="reference internal" href="#server-projectname-webservice" id="id57">[server projectName]-webservice</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#soapappendixpackageclient" id="id58">クライアントのパッケージ構成</a></p>
<ul>
<li><p><a class="reference internal" href="#client-projectname-domain" id="id59">[client projectName]-domain</a></p></li>
<li><p><a class="reference internal" href="#client-projectname-web" id="id60">[client projectName]-web</a></p></li>
<li><p><a class="reference internal" href="#client-projectname-env" id="id61">[client projectName]-env</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#webservicewsdl" id="id62">WebServiceインターフェースの実装クラスとWSDLファイルの関係</a></p></li>
<li><p><a class="reference internal" href="#soapendpointaddress" id="id63">テスト等でエンドポイントアドレスを上書き指定したい場合</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="overview">
<span id="soapoverview"></span><h2><a class="toc-backref" href="#id23" role="doc-backlink"><span class="section-number">5.3.1. </span>Overview</a><a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p>本節では、SOAP Web Serviceの基本的な概念とJakarta XML Web Servicesを使用したSOAPサーバ、クライアント双方の開発について説明する。</p>
<p>実装に対する具体的な説明については、</p>
<ul>
<li><div class="line-block">
<div class="line">「<a class="reference internal" href="#soaphowtouse"><span class="std std-ref">How to use</span></a>」</div>
<div class="line">Jakarta XML Web Servicesを使用したSOAP Web Serviceのアプリケーション構成やAPIの実装方法について説明している。</div>
</div>
</li>
</ul>
<p>を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="soap">
<span id="soapoverviewaboutsoapwebservice"></span><h3><a class="toc-backref" href="#id24" role="doc-backlink"><span class="section-number">5.3.1.1. </span>SOAPとは</a><a class="headerlink" href="#soap" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line">SOAPとは、XMLで記述されたメッセージをコンピュータ間で送受信を行うためのプロトコルあり、W3Cによって仕様が定義されている。</div>
<div class="line">当初、「SOAP」は「<strong>S</strong>imple <strong>O</strong>bject <strong>A</strong>ccess <strong>P</strong>rotocol」の頭字語であったが、現在はそうではないとされている。</div>
<div class="line">SOAPの仕様についての詳細は、<a class="reference external" href="https://www.w3.org/TR/soap/">W3C -SOAP Specifications-</a>を参照されたい。</div>
</div>
<div class="line-block">
<div class="line">本ガイドラインでは、以下の図のような構成でのSOAP Web Serviceを行う場合を想定して説明する。</div>
<div class="line">ただし、下記の構成以外でのSOAP Web Serviceの場合にも応用可能である。（例：クライアントがバッチの場合など）</div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/SOAPServerAndClient.png"><img alt="Server and Client for SOAP" src="../../_images/SOAPServerAndClient.png" style="width: 100%;" /></a>
</figure>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">クライアントは、別のSOAPサーバへの通信を行うWebアプリケーションを想定している。</div>
<div class="line">クライアントと呼んでいるがWebアプリケーション想定なので注意が必要である。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">SOAPサーバは、Webサービスを公開し、クライアントからのSOAP Web ServiceによるXMLを受信して処理を行う。データベースなどにアクセスを行い、業務処理を行うことを想定している。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">SOAP Web ServiceではXMLを使用して情報のやり取りを行う。</div>
<div class="line">今回の想定では、SOAPサーバ、クライアントどちらもJavaである想定としているが、他のプラットフォームでも問題なく通信可能である。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="soapjakarta-xml-web-services">
<span id="soapoverviewaboutsoapservicedevelopment"></span><h3><a class="toc-backref" href="#id25" role="doc-backlink"><span class="section-number">5.3.1.2. </span>SOAPとJakarta XML Web Services</a><a class="headerlink" href="#soapjakarta-xml-web-services" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line"><a class="reference external" href="https://jakarta.ee/specifications/xml-web-services/3.0/jakarta-xml-ws-spec-3.0">Jakarta XML Web Services</a>とは、SOAPなどを使ったWebサービスを扱うためのJava標準APIである。</div>
<div class="line">Jakarta XML Web Servicesを用いることで、JavaのオブジェクトをSOAPの仕様に沿ったXMLに変換して送信することが可能である。</div>
<div class="line">そのため、Jakarta XML Web Servicesを利用してメッセージの送受信を行う場合、利用者はXMLの構造をあまり意識せずデータを扱うことができる。</div>
<div class="line">また、SOAPサーバ、クライアントの公開に関しても、通常のWebアプリケーション同様に、ブランクプロジェクト内のwebプロジェクトから作成したWARファイルをAPサーバにデプロイすることで、SOAP Web Serviceを簡単に実現することができる。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="soapoverviewprerequisites">
<span id="id2"></span><h3><a class="toc-backref" href="#id26" role="doc-backlink"><span class="section-number">5.3.1.3. </span>本ガイドラインにおいて利用するJakarta XML Web Services実装ライブラリについて</a><a class="headerlink" href="#soapoverviewprerequisites" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line">TERASOLUNA Server Framework for Java (5.x) 5.7 までは、Spring Frameworkが提供するJakarta XML Web Servicesの連携機能を利用した実装を推奨していたが、Spring Framework 6から、<code class="docutils literal notranslate"><span class="pre">org.springframework.remoting</span></code>パッケージが削除され、Jakarta XML Web Servicesの連携機能が利用できなくなった。（<a class="reference external" href="https://github.com/spring-projects/spring-framework/issues/27422">Spring#27422</a>）</div>
<div class="line">それに伴い、TERASOLUNA Server Framework for Java (5.x) 5.10 からはJakarta XML Web Servicesでの実装を推奨している。</div>
<div class="line"><br /></div>
<div class="line">システムで利用するJakarta XML Web Servicesの実装として、どのライブラリを採用すべきかは、どのAPサーバを利用するかに依存する事が多い。(APサーバ側からJakarta XML Web Servicesの実装ライブラリが提供されることが多いため)</div>
<div class="line">本ガイドラインでは、APサーバはTomcat、Jakarta XML Web Services実装としてApache CXF、通信プロトコルはSOAP1.2の利用を想定して説明を行う。</div>
<div class="line">APサーバやJakarta XML Web Services実装ライブラリとして異なるものを使う際には、設定などが異なることがあるので、そちらのマニュアルを参照する方がよい。</div>
<div class="line">TomcatはJakarta XML Web Servicesの実装ライブラリを提供しないため、「<a class="reference internal" href="#soapapplicationconfiguration"><span class="std std-ref">アプリケーションの設定</span></a>」に示すようにApache CXFを依存性に追加し、設定を行う必要があるため注意すること。</div>
<div class="line">また、SpringとJakarta XML Web Servicesを利用して開発を行う場合、以下の内容を留意する必要がある。</div>
</div>
<div class="line-block">
<div class="line"><strong>SpringとJakarta XML Web Services実装ライブラリを併用する場合の留意事項</strong></div>
</div>
<ul class="simple">
<li><p>WebServiceインターフェイス実装クラスはSpringのControllerクラスではないため、 <code class="docutils literal notranslate"><span class="pre">&#64;ControllerAdvice</span></code>や <code class="docutils literal notranslate"><span class="pre">&#64;ExceptionHandler</span></code> などが適用されない。</p></li>
<li><p>WebServiceインターフェイス実装クラスがSpringのDIコンテナ上で管理されないため、Springが管理するBeanのインジェクションや、AOPによる横断的な処理をかけることができない。（Spring統合が可能なJakarta XML Web Services実装ライブラリを利用すれば解消される）</p></li>
</ul>
<blockquote>
<div><p>Apache CXFは、Spring統合が可能なJakarta XML Web Services実装ライブラリであるため、２点目に記載しているBeanのインジェクションや、AOPによる横断的な処理をかけることができないという制約は解消される。</p>
</div></blockquote>
<div class="line-block">
<div class="line">また、上記制約以外にもAPサーバのJakarta XML Web Services実装によっては、Jakarta XML Web Services仕様への対応状況や実際のWebサービスの動作が異なる場合があり、必ずしも本ガイドラインの実装が全てのAPサーバで同様に動作するわけではない。</div>
<div class="line">開発を始める前には必ず、利用するAPサーバのマニュアルを確認されたい。</div>
</div>
<div class="line-block">
<div class="line"><strong>コードファーストベースの開発</strong></div>
</div>
<div class="line-block">
<div class="line">SOAP Web Serviceの開発では、コードファーストベースの開発と、契約ファーストベースの開発の２つのアプローチがある。</div>
<div class="line">コードファーストは、アノテーション等を使いプログラムを作成してから、それに基づいてWebサービスのWSDLファイル（契約）を自動生成するアプローチである。</div>
<div class="line">それに対して契約ファーストは、最初にWSDLファイル（契約）でメッセージのインターフェース定義を行い、その契約に基づいてプログラムを生成するアプローチである。</div>
<div class="line">本ガイドラインでは、WSDLファイルの記法をあまり意識しないで開発が行えるコードファーストベースでの方法を紹介する。</div>
<div class="line"><br /></div>
</div>
</section>
<section id="jakarta-xml-web-servicessoap-web-service">
<span id="soapoverviewjaxwsspring"></span><h3><a class="toc-backref" href="#id27" role="doc-backlink"><span class="section-number">5.3.1.4. </span>Jakarta XML Web Servicesを利用したSOAP Web Serviceの開発について</a><a class="headerlink" href="#jakarta-xml-web-servicessoap-web-service" title="Permalink to this heading">¶</a></h3>
<p>SOAPサーバ・クライアントの開発についての例として、SOAPサーバ・クライアントのプロジェクト構成と、SOAPサーバ・クライアントで利用するクラスと処理の流れを説明する。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>SOAPサーバ・クライアントのプロジェクト構成</strong></p>
<p>Jakarta XML Web Servicesを利用したWebサービスを作成する場合、既存のブランクプロジェクトとは別に以下2つのプロジェクトを追加することを推奨する。</p>
<ul class="simple">
<li><p>modelプロジェクト</p></li>
<li><p>webserviceプロジェクト</p></li>
</ul>
<div class="line-block">
<div class="line">modelプロジェクトは、Webサービスの引数や返り値に使用するDomain Objectを格納する。</div>
<div class="line">webserviceプロジェクトは、Webサービスを呼び出すインターフェースを格納する。</div>
<div class="line">この2つはSOAPサーバからクライアントに配布する必要があるクラスのみ格納するプロジェクトである。</div>
<div class="line">配布する範囲を明確に識別するため、別プロジェクトにすることを推奨している。</div>
</div>
<p>本ガイドラインでは、マルチプロジェクトで以下のような構成を用いる。</p>
<p>ここでもクライアントはWebアプリケーションであることを前提とするが、デスクトップアプリケーションやコマンドラインインターフェースから呼び出す場合も基本的な考え方は同じである。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/SOAPClientAndServerProjects.png"><img alt="Server and Client Projects for SOAP" src="../../_images/SOAPClientAndServerProjects.png" style="width: 80%;" /></a>
</figure>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">クライアントを作成する場合、従来のマルチプロジェクトにSOAPサーバから提供されるmodelプロジェクトとwebserviceプロジェクトを追加する。</div>
<div class="line">ここではサーバとクライアントをともに開発することを前提としている。</div>
<div class="line">これらのプロジェクトの詳細については「<a class="reference internal" href="#soaphowtousewebapplicationconstruction"><span class="std std-ref">SOAPサーバの作成</span></a>」で説明する。</div>
<div class="line">プロジェクトの追加方法については「<a class="reference internal" href="#soapappendixaddproject"><span class="std std-ref">SOAPサーバ用にプロジェクトの設定を変更する</span></a>」に記載しているので、開発を行う前に実施すること。</div>
<div class="line"><br /></div>
<div class="line">サーバとクライアントの開発が別々で、modelプロジェクトとwebserviceプロジェクトが提供されない場合、もしくはJava以外でSOAPサーバが作成されている場合には、modelプロジェクト内のDomain Objectとwebserviceプロジェクト内のWebサービスインターフェースを自分で作成する必要がある。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">SOAPサーバを作成する場合、従来のマルチプロジェクトに追加してmodelプロジェクトとwebserviceプロジェクトを追加する。</div>
<div class="line">クライアントにこれら2つのプロジェクトを公開する。</div>
<div class="line">クライアントへのmodelプロジェクト、webserviceプロジェクトの公開方法は、Mavenの依存関係への追加を想定している。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">結果として、プロジェクトは次のような構成となる。</div>
<div class="line">以下は、SOAPサーバのプロジェクト構成である。</div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/SOAPServerPackageExplorer.png"><img alt="Package explorer for SOAP server projects" src="../../_images/SOAPServerPackageExplorer.png" style="width: 50%;" /></a>
</figure>
<p>以下は、クライアントのプロジェクト構成である。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/SOAPClientPackageExplorer.png"><img alt="Package explorer for SOAP client projects" src="../../_images/SOAPClientPackageExplorer.png" style="width: 42%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>SOAPサーバ・クライアントで利用するクラスと処理の流れ</strong></p>
<div class="line-block">
<div class="line">以下はJakarta XML Web Services実装ライブラリを用いた場合のSOAPサーバ/クライアントにおいて、SOAP Webサービスの呼び出しがどのように行われるかを示した図である。開発者が実装すべき箇所と、Jakarta XML Web Services実装が提供する箇所は、色を分けて表現している。</div>
<div class="line">ここではSOAPのクライアント(図左)であるWebアプリケーションがSOAPサーバ(図右)にアクセスすることを前提としている。</div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/SOAPProcessFlow.png"><img alt="Server and Client Projects for SOAP" src="../../_images/SOAPProcessFlow.png" style="width: 80%;" /></a>
</figure>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">[クライアント] ControllerがServiceを呼び出す。</div>
<div class="line">通常の呼び出しと変更点は特にない。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">[クライアント] ServiceがSOAPサーバ提供側で用意したWebServiceインターフェースを呼び出す。</div>
<div class="line">この図では、ServiceがWebServiceインターフェースを呼び出しているが、要件に応じてControllerから直接WebServiceインターフェースを呼び出してもよい。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">[クライアント] WebServiceインターフェースが呼び出されると実体として「動的プロキシ(Dynamic Proxy)」(以下「プロキシ」)が呼び出される。</div>
<div class="line">このプロキシは<code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.Service</span></code>が生成したWebServiceインターフェースの実装クラスである。</div>
<div class="line">この実装クラスがServiceにインジェクションされ、ServiceはWebServiceインターフェースのメソッドを呼び出すだけで、SOAP Web Serviceを利用した処理を行うことができる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">プロキシが、SOAPサーバのWebServiceインターフェースを呼び出す。</div>
<div class="line">SOAPサーバとクライアントでの値のやり取りはDomain Objectを使用して行う。</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>厳密には、SOAPサーバとクライアントはXMLを使用して通信を行っている。
送信時、および受信時にはJAXBを使用して、Domain ObjectとXMLの相互変換が行われているが、SOAP Web Service作成者はXMLをあまり意識せず、開発を行うことができるようになっている。</p>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">[サーバ] WebServiceインターフェースが呼び出されると実体としてWebService実装クラスが呼び出される。</div>
<div class="line">SOAPサーバでは、WebServiceインターフェースの実装クラスとしてWebService実装クラスを用意する。</div>
<div class="line">このWebService実装クラスは、<code class="docutils literal notranslate"><span class="pre">org.springframework.web.context.support.SpringBeanAutowiringSupport</span></code>を継承することで、SpringのDIコンテナ上のBeanを<code class="docutils literal notranslate"><span class="pre">&#64;Autowired</span></code>などでインジェクションすることができる。</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>「<a class="reference internal" href="#soapoverviewprerequisites"><span class="std std-ref">本ガイドラインにおいて利用するJakarta XML Web Services実装ライブラリについて</span></a>」のとおりJakarta XML Web Servicesの実装によっては、SpringのDIコンテナ上のBeanをインジェクションできない場合があるため、留意する必要がある。</p>
<p>また、SOAPサーバは、<code class="docutils literal notranslate"><span class="pre">&#64;Inject</span></code>ではなく、<code class="docutils literal notranslate"><span class="pre">&#64;Autowired</span></code>でインジェクションすることを推奨する。</p>
<p><code class="docutils literal notranslate"><span class="pre">&#64;Inject</span></code>の場合、Jakarta EE（Java EE）サーバが提供するDI機能で使用されるため、Jakarta EE（Java EE）サーバのDIコンテナに存在しないとエラーになってしまう。</p>
<p>上記に対して、<code class="docutils literal notranslate"><span class="pre">&#64;Autowired</span></code>であればSpringのDI機能のみで使用されるため、意図せずJakarta EE（Java EE）サーバのDI機能でエラーになるのを防止することができる。</p>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">[サーバ] WebService実装クラスでは、業務処理を行うServiceを呼び出す。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">[サーバ] Serviceでは、Repositoryなどを使用して業務処理を実行する。</div>
<div class="line">通常の呼び出しと変更点は特にない。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="soap-web-serviceurl">
<span id="soapwebpublishurl"></span><h3><a class="toc-backref" href="#id28" role="doc-backlink"><span class="section-number">5.3.1.5. </span>SOAP Web Serviceとして公開されるURL</a><a class="headerlink" href="#soap-web-serviceurl" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line">SOAP Web Serviceを作成するとWSDL（<strong>W</strong>eb <strong>S</strong>ervices <strong>D</strong>escription <strong>L</strong>anguage）というWebサービスのインターフェース定義が公開され、クライアントはこの定義をもとにSOAP Web Serviceを実行する。</div>
<div class="line">WSDLの詳細は、<a class="reference external" href="https://www.w3.org/TR/2001/NOTE-wsdl-20010315">W3C -Web Services Description Language (WSDL)-</a>を参照されたい。</div>
</div>
<div class="line-block">
<div class="line">WSDL内には、Webサービス実行時のアクセスURLやメソッド名、引数、戻り値などが定義される。</div>
<div class="line">本ガイドラインの通りにSOAP Web Serviceを作成すると、以下のURLでWSDLが公開される。</div>
<div class="line">クライアントではこのURLを指定するか、取得したWSDLファイルをクライアントに配置し、そのファイルパスを指定する必要がある。</div>
</div>
<ul class="simple">
<li><p><cite>http://AAA.BBB.CCC.DDD:XXXX/[server projectName]-web/ws/TodoWebService?wsdl</cite></p></li>
</ul>
<p>WSDL内で定義されるエンドポイントアドレスは以下のURLである。</p>
<ul class="simple">
<li><p><cite>http://AAA.BBB.CCC.DDD:XXXX/コンテキストパス/ws/Webサービス名</cite></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">Webサービスを、<code class="docutils literal notranslate"><span class="pre">/ws</span></code>にマッピングする設定は、「<a class="reference internal" href="#soapapplicationconfiguration"><span class="std std-ref">アプリケーションの設定</span></a>」に記載しているので参照されたい。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="how-to-use">
<span id="soaphowtouse"></span><h2><a class="toc-backref" href="#id29" role="doc-backlink"><span class="section-number">5.3.2. </span>How to use</a><a class="headerlink" href="#how-to-use" title="Permalink to this heading">¶</a></h2>
<div class="line-block">
<div class="line">本節では、SOAP Web Serviceの具体的な作成方法について説明する。</div>
<div class="line">実装するアプリケーションは、Todoアプリケーションを例に説明を行う。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="soaphowtousewebapplicationconstruction">
<span id="id3"></span><h3><a class="toc-backref" href="#id30" role="doc-backlink"><span class="section-number">5.3.2.1. </span>SOAPサーバの作成</a><a class="headerlink" href="#soaphowtousewebapplicationconstruction" title="Permalink to this heading">¶</a></h3>
<section id="id4">
<h4><a class="toc-backref" href="#id31" role="doc-backlink"><span class="section-number">5.3.2.1.1. </span>プロジェクトの構成</a><a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h4>
<p><strong>各プロジェクトの依存関係</strong></p>
<div class="line-block">
<div class="line">「<a class="reference internal" href="#soapoverviewjaxwsspring"><span class="std std-ref">Jakarta XML Web Servicesを利用したSOAP Web Serviceの開発について</span></a>」で述べたとおり、modelプロジェクトとwebserviceプロジェクトを追加する。</div>
<div class="line">プロジェクトの追加方法は「<a class="reference internal" href="#soapappendixaddproject"><span class="std std-ref">SOAPサーバ用にプロジェクトの設定を変更する</span></a>」に記載しているので、内容に沿って追加すること。</div>
<div class="line">またそれに伴い、既存のプロジェクトに依存関係を追加することが必要となる。</div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/SOAPServerProjects.png"><img alt="Server Projects for SOAP" src="../../_images/SOAPServerProjects.png" style="width: 80%;" /></a>
</figure>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 30.0%" />
<col style="width: 60.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>プロジェクト名</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">webプロジェクト</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Webサービス実装クラスを配置する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">domainプロジェクト</div>
</div>
</td>
<td><div class="line-block">
<div class="line">WebServiceの実装クラスから呼び出されるServiceを配置する。</div>
<div class="line">その他、Repositoryなどは従来と同じである。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">webserviceプロジェクト</div>
</div>
</td>
<td><div class="line-block">
<div class="line">公開するWebServiceのインターフェースをここに配置する。</div>
<div class="line">クライアントはこのインターフェースを使用してWebサービスを実行する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">modelプロジェクト</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ドメイン層に属するクラスのうち、SOAP Web Serviceで使用するクラスのみをここに配置する。</div>
<div class="line">クライアントからの入力値や返却結果はこのプロジェクト内のクラスを使用する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="soapapplicationconfiguration">
<span id="id5"></span><h4><a class="toc-backref" href="#id32" role="doc-backlink"><span class="section-number">5.3.2.1.2. </span>アプリケーションの設定</a><a class="headerlink" href="#soapapplicationconfiguration" title="Permalink to this heading">¶</a></h4>
<p><strong>Webサービスの公開について</strong></p>
<div class="line-block">
<div class="line">APサーバとしてTomcatを利用する場合、Jakarta XML Web Services実装が存在しない。</div>
<div class="line">そのため、本節で説明するSOAPサーバは、Jakarta XML Web Servicesの実装プロダクトとして<a class="reference external" href="https://cxf.apache.org/">Apache CXF</a>を使用している。</div>
<div class="line">また、Apache CXFを使用してWebサービスを公開するには、<code class="docutils literal notranslate"><span class="pre">CXFServlet</span></code>の設定を追加する必要がある。</div>
<div class="line"><br /></div>
<div class="line">他のAPサーバーを利用する場合は、APサーバによってWebサービスの公開方法は異なるので、詳細は各APサーバーのマニュアルを参照されたい。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>CXFServletを使用する設定</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">CXFServlet</span></code>を使用するため、<code class="docutils literal notranslate"><span class="pre">pom.xml</span></code>にライブラリの設定を記述する。</p>
<p><em>[server projectName]-web/pom.xml</em></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.apache.cxf<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>cxf-rt-frontend-jaxws<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.apache.cxf<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>cxf-rt-transports-http<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="cm">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>com.sun.xml.messaging.saaj<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>saaj-impl<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">CXFServlet</span></code>を使用するため、Apache CXFライブラリへの依存関係を追加する。</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>cxf-rt-frontend-jaxwsとcxf-rt-transports-httpは、依存ライブラリのバージョンをBOMプロジェクトである terasoluna-dependencies で管理する前提であるため、pom.xmlでのバージョンの指定は不要である。</p>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">CXFServlet</span></code>で使用されるSAAJライブラリへの依存関係を追加する。</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>saaj-implのバージョンはterasoluna-dependenciesが依存している<a class="reference external" href="https://docs.spring.io/spring-boot/3.4.1/appendix/dependency-versions/coordinates.html">Spring Boot</a>で管理されているため、pom.xmlでのバージョンの指定は不要である。</p>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>次に<code class="docutils literal notranslate"><span class="pre">web.xml</span></code>にSOAP Web Serviceを受け付ける<code class="docutils literal notranslate"><span class="pre">CXFServlet</span></code>を定義する。</p>
<p><em>[server projectName]-web/src/main/webapp/WEB-INF/web.xml</em></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;servlet&gt;</span>
<span class="w">    </span><span class="nt">&lt;servlet-name&gt;</span>cxfServlet<span class="nt">&lt;/servlet-name&gt;</span>
<span class="w">    </span><span class="nt">&lt;servlet-class&gt;</span>org.apache.cxf.transport.servlet.CXFServlet<span class="nt">&lt;/servlet-class&gt;</span>
<span class="w">    </span><span class="nt">&lt;init-param&gt;</span>
<span class="w">        </span><span class="nt">&lt;param-name&gt;</span>config-location<span class="nt">&lt;/param-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;param-value&gt;</span>classpath:/META-INF/spring/cxf-servlet.xml<span class="nt">&lt;/param-value&gt;</span>
<span class="w">    </span><span class="nt">&lt;/init-param&gt;</span>
<span class="w">    </span><span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
<span class="nt">&lt;/servlet&gt;</span>
<span class="cm">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;servlet-mapping&gt;</span>
<span class="w">    </span><span class="nt">&lt;servlet-name&gt;</span>cxfServlet<span class="nt">&lt;/servlet-name&gt;</span>
<span class="w">    </span><span class="nt">&lt;url-pattern&gt;</span>/ws/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/servlet-mapping&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">org.apache.cxf.transport.servlet.CXFServlet</span></code>のサーブレット定義を行う。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">config-location</span></code>に設定する<code class="docutils literal notranslate"><span class="pre">cxf-servlet.xml</span></code>は、作成したWebサービスを公開する際に必要な定義となる。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">cxf-servlet.xml</span></code>の定義方法については、「<a class="reference internal" href="#soapwebserviceimpl"><span class="std std-ref">WebService実装クラスの作成</span></a>」にて説明を行う。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">定義したサーブレットへのマッピングを定義する。この場合、コンテキスト名/ws配下にWebサービスが作成される。</div>
<div class="line">このマッピング定義が、「<a class="reference internal" href="#soapwebpublishurl"><span class="std std-ref">SOAP Web Serviceとして公開されるURL</span></a>」で説明していた設定となる。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>パッケージのコンポーネントスキャン設定</strong></p>
<div class="line-block">
<div class="line">Webサービスで使用するコンポーネントをスキャンするため、Javaで定義する場合は<code class="docutils literal notranslate"><span class="pre">[server</span> <span class="pre">projectName]WsConfig.java</span></code>、XMLで定義する場合は<code class="docutils literal notranslate"><span class="pre">[server</span> <span class="pre">projectName]-ws.xml</span></code>を作成し、コンポーネントスキャンの定義を行い、Webサービスにインジェクションできるようにする。</div>
</div>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-0-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-0-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-0-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-0-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[server</span> <span class="pre">projectName]-web/src/main/java/com/example/config/ws/[server</span> <span class="pre">projectName]WsConfig.java</span></code></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span><span class="p">(</span><span class="n">basePackages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;com.example.ws&quot;</span><span class="w"> </span><span class="p">})</span><span class="w">  </span><span class="c1">// (1)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ServerProjectNameWsConfig</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Webサービスで使用するコンポーネントが格納されているパッケージを指定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div><div aria-labelledby="tab-0-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[server</span> <span class="pre">projectName]-web/src/main/resources/META-INF/spring/[server</span> <span class="pre">projectName]-ws.xml</span></code></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="w">    </span><span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
<span class="w">    </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;</span>
<span class="s">        http://www.springframework.org/schema/beans</span>
<span class="s">        https://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">        http://www.springframework.org/schema/context</span>
<span class="s">        https://www.springframework.org/schema/context/spring-context.xsd&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;context:component-scan</span><span class="w"> </span><span class="na">base-package=</span><span class="s">&quot;com.example.ws&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Webサービスで使用するコンポーネントが格納されているパッケージを指定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>web.xmlにConfiguration定義を追加する。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-1-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-1-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-1-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-1-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[server</span> <span class="pre">projectName]-web/src/main/webapp/WEB-INF/web.xml</span></code></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;context-param&gt;</span>
<span class="w">    </span><span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- Root ApplicationContext --&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;param-value&gt;</span>
<span class="w">        </span>com.example.config.app.ApplicationContextConfig
<span class="w">        </span>com.example.config.web.SpringSecurityConfig
<span class="w">        </span>com.example.config.ws.[server<span class="w"> </span>projectName]WsConfig
<span class="w">    </span><span class="nt">&lt;/param-value&gt;</span>
<span class="nt">&lt;/context-param&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[server</span> <span class="pre">projectName]WsConfig</span></code>をルート<code class="docutils literal notranslate"><span class="pre">ApplicationContext</span></code>生成時の読み込み対象に加える。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div><div aria-labelledby="tab-1-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[server</span> <span class="pre">projectName]-web/src/main/webapp/WEB-INF/web.xml</span></code></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;context-param&gt;</span>
<span class="w">    </span><span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- Root ApplicationContext --&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;param-value&gt;</span>
<span class="w">        </span>classpath*:META-INF/spring/applicationContext.xml
<span class="w">        </span>classpath*:META-INF/spring/spring-security.xml
<span class="w">        </span>classpath*:META-INF/spring/[server<span class="w"> </span>projectName]-ws.xml
<span class="w">    </span><span class="nt">&lt;/param-value&gt;</span>
<span class="nt">&lt;/context-param&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[server</span> <span class="pre">projectName]-ws.xml</span></code>をルート<code class="docutils literal notranslate"><span class="pre">ApplicationContext</span></code>生成時の読み込み対象に加える。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>入力チェックを行うための定義</strong></p>
<div class="line-block">
<div class="line">入力チェックには<a class="reference internal" href="../WebApplicationDetail/Validation.html#methodvalidation"><span class="std std-ref">メソッドバリデーション</span></a>を使用するため、以下の定義を追加する。</div>
<div class="line">メソッドバリデーションにおける入力チェックルールの実装方法は <a class="reference internal" href="#soaphowtouseservervalidation"><span class="std std-ref">入力チェックの実装</span></a>を参照されたい。</div>
</div>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-2-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-2-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-2-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-2-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-2-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[server</span> <span class="pre">projectName]-web/src/main/java/com/example/config/app/ApplicationContextConfig.java</span></code></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Bean</span>
<span class="kd">public</span><span class="w"> </span><span class="n">MethodValidationPostProcessor</span><span class="w"> </span><span class="nf">methodValidationPostProcessor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">MethodValidationPostProcessor</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MethodValidationPostProcessor</span><span class="p">();</span>
<span class="w">    </span><span class="n">bean</span><span class="p">.</span><span class="na">setValidator</span><span class="p">(</span><span class="n">validator</span><span class="p">());</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<span class="p">}</span>

<span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;validator&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">LocalValidatorFactoryBean</span><span class="w"> </span><span class="nf">validator</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LocalValidatorFactoryBean</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</div><div aria-labelledby="tab-2-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[server</span> <span class="pre">projectName]-web/src/main/resources/META-INF/spring/applicationContext.xml</span></code></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.springframework.validation.beanvalidation.MethodValidationPostProcessor&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;validator&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;validator&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;validator&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.springframework.validation.beanvalidation.LocalValidatorFactoryBean&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</pre></div>
</div>
</li>
</ul>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="web">
<span id="soaphowtousewebserviceimpl"></span><h4><a class="toc-backref" href="#id33" role="doc-backlink"><span class="section-number">5.3.2.1.3. </span>Webサービスの実装</a><a class="headerlink" href="#web" title="Permalink to this heading">¶</a></h4>
<p>以下の作成を行う。</p>
<ul class="simple">
<li><p>Domain Objectの作成</p></li>
<li><p>WebServiceインターフェイスの作成</p></li>
<li><p>WebService実装クラスの作成</p></li>
</ul>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/SOAPServerClass.png"><img alt="Server Projects for SOAP" src="../../_images/SOAPServerClass.png" style="width: 80%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Domain Objectの作成</strong></p>
<div class="line-block">
<div class="line">modelプロジェクト内に、Webサービスの引数や返り値に使用するDomain Objectを作成する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">java.io.Serializable</span></code>インターフェースを実装した一般のJavaBeanと特に変わりはない。</div>
</div>
<p><em>[server projectName]-model/src/main/java/com/example/domain/model/Todo.java</em></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.domain.model</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.Serializable</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Date</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Todo</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">todoId</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">title</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">finished</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// omitted setter and getter</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>WebServiceインターフェイスの作成</strong></p>
<p>webserviceプロジェクト内にWebサービスを呼び出すインターフェースを作成する。</p>
<p><em>[server projectName]-webservice/src/main/java/com/example/ws/todo/TodoWebService.java</em></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.ws.todo</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.jws.WebMethod</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.jws.WebParam</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.jws.WebResult</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.jws.WebService</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.domain.model.Todo</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.ws.webfault.WebFaultException</span><span class="p">;</span>

<span class="nd">@WebService</span><span class="p">(</span><span class="n">targetNamespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://example.com/todo&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">TodoWebService</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@WebMethod</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="nd">@WebResult</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;todo&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (3)</span>
<span class="w">    </span><span class="n">Todo</span><span class="w"> </span><span class="nf">getTodo</span><span class="p">(</span><span class="nd">@WebParam</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;todoId&quot;</span><span class="p">)</span><span class="w"> </span><span class="cm">/* (4) */</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">todoId</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">WebFaultException</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;WebService</span></code>を付けることで、WebServiceインターフェースであることを宣言する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">targetNamespace</span></code>属性には、名前空間を定義するが、これは作成するWebサービスのパッケージ名と合わせることを推奨する。</div>
<div class="line">詳細は、「<a class="reference internal" href="#soappackagenamespace"><span class="std std-ref">パッケージ名とネームスペースについて</span></a>」 を参照されたい。</div>
<div class="line"><strong>targetNamespace属性の値は、&#64;WebService付与クラスごとに設定する必要がある。そのため、ガイドライン上のソースを流用する場合は必ず変更すること。</strong></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">targetNamespace</span></code>属性の値はWSDL上に定義され、このWebサービスの名前空間を決定し、一意に特定するために使用される。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Webサービスのメソッドとして公開するメソッドに<code class="docutils literal notranslate"><span class="pre">&#64;WebMethod</span></code>を付ける。</div>
<div class="line">このアノテーションを付けることにより、WSDL上にメソッドが公開され、外部から使用することが可能になる。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">返り値に<code class="docutils literal notranslate"><span class="pre">&#64;WebResult</span></code>を付け、名前を<code class="docutils literal notranslate"><span class="pre">name</span></code>属性に指定する。返り値がない場合は不要。</div>
<div class="line">このアノテーションを付けることにより、WSDL上に返り値として公開される。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">引数に<code class="docutils literal notranslate"><span class="pre">&#64;WebParam</span></code>を付け、名前を<code class="docutils literal notranslate"><span class="pre">name</span></code>属性に指定する。</div>
<div class="line">このアノテーションを付けることにより、WSDL上に引数が公開され、外部から呼び出すときの必要なパラメータとして定義される。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">WebFaultException</span></code>の詳細は「<a class="reference internal" href="#soaphowtouseexceptionhandler"><span class="std std-ref">例外ハンドリングの実装</span></a>」を参照されたい。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="soappackagenamespace">
<span id="id6"></span><h4><a class="toc-backref" href="#id34" role="doc-backlink"><span class="section-number">5.3.2.1.4. </span>パッケージ名とネームスペースについて</a><a class="headerlink" href="#soappackagenamespace" title="Permalink to this heading">¶</a></h4>
<p><strong>パッケージ名および、ネームスペースの付け方について</strong></p>
<div class="line-block">
<div class="line">パッケージ名が以下のような形式になっている場合</div>
</div>
<ul class="simple">
<li><p>【ドメイン】.【アプリケーション名(システム名)】.ws.【ユースケース名】</p></li>
</ul>
<div class="line-block">
<div class="line">本ガイドラインでは、以下のようなネームスペースにすることを推奨する。</div>
<div class="line">Webサービスをユースケース単位で分割する場合は、アプリケーション名の後にユースケース名を追加する。</div>
<div class="line">他に分割する粒度があれば、その粒度でもよい。</div>
</div>
<ul class="simple">
<li><p><a class="reference external" href="http:/">http:/</a>/【ドメイン】/【アプリケーション名(システム名)】/（【ユースケース名】）</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>ネームスペースとパッケージ名の関係</strong></p>
<div class="line-block">
<div class="line">仕様ではないが、Namespaceとパッケージの命名について、<a class="reference external" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_fuse/6.0/html/developing_applications_using_jax-ws/jaxwsdatanamespacemapping">XML Namespace Mapping(Red Hat JBoss Fuse)</a>にまとまっている。</div>
<div class="line">この命名規則に沿って例を示すが、ドメインをcom.example、アプリケーション名をtodoとした場合、以下のNamespaceとJavaのパッケージ名とするとよい。</div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/SOAPURL.png"><img alt="Server and Client Projects for SOAP" src="../../_images/SOAPURL.png" style="width: 50%;" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="webservice">
<span id="soapwebserviceimpl"></span><h4><a class="toc-backref" href="#id35" role="doc-backlink"><span class="section-number">5.3.2.1.5. </span>WebService実装クラスの作成</a><a class="headerlink" href="#webservice" title="Permalink to this heading">¶</a></h4>
<p>webプロジェクト内にWebServiceインターフェースの実装クラスを作成する。</p>
<p><em>[server projectName]-web/src/main/java/com/example/ws/todo/TodoWebServiceImpl.java</em></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.ws.todo</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.jws.WebService</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.xml.ws.BindingType</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.xml.ws.soap.SOAPBinding</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.context.support.SpringBeanAutowiringSupport</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.domain.model.Todo</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.domain.service.TodoService</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.ws.webfault.WebFaultException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.ws.exception.WsExceptionHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.ws.todo.TodoWebService</span><span class="p">;</span>


<span class="nd">@WebService</span><span class="p">(</span>
<span class="w">        </span><span class="n">targetNamespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://example.com/todo&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">serviceName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;TodoWebService&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">portName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;TodoWebPort&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">endpointInterface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;com.example.ws.todo.TodoWebService&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="nd">@BindingType</span><span class="p">(</span><span class="n">SOAPBinding</span><span class="p">.</span><span class="na">SOAP12HTTP_BINDING</span><span class="p">)</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoWebServiceImpl</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">SpringBeanAutowiringSupport</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">TodoWebService</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (3)</span>

<span class="w">    </span><span class="nd">@Autowired</span><span class="w"> </span><span class="c1">// (4)</span>
<span class="w">    </span><span class="n">TodoService</span><span class="w"> </span><span class="n">todoService</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span><span class="w"> </span><span class="c1">// (5)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Todo</span><span class="w"> </span><span class="nf">getTodo</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">todoId</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">WebFaultException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">todoService</span><span class="p">.</span><span class="na">getTodo</span><span class="p">(</span><span class="n">todoId</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;WebService</span></code>を付けることで、WebServiceの実装クラスであることを宣言する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">targetNamespace</span></code>属性は、WSDL上で使用されるネームスペース。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">serviceName</span></code>属性は、WSDL上のサービス名として公開される。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">portName</span></code>属性は、WSDL上のポート名として公開される。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">endpointInterface</span></code>属性は、このクラスが実装しているWebサービスのインターフェース名を定義する。</div>
<div class="line"><br /></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">targetNamespace</span></code>、<code class="docutils literal notranslate"><span class="pre">serviceName</span></code>、<code class="docutils literal notranslate"><span class="pre">portName</span></code>の説明は、「<a class="reference internal" href="#soapwebservicewsdl"><span class="std std-ref">WebServiceインターフェースの実装クラスとWSDLファイルの関係</span></a>」を参照されたい。</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">TodoWebService</span></code>インターフェースでは、<code class="docutils literal notranslate"><span class="pre">&#64;WebService</span></code>の属性として<code class="docutils literal notranslate"><span class="pre">portName</span></code>属性, <code class="docutils literal notranslate"><span class="pre">serviceName</span></code>属性, <code class="docutils literal notranslate"><span class="pre">endpointInterface</span></code>属性を設定してはいけない。これは、このインターフェースはWSDL上の<code class="docutils literal notranslate"><span class="pre">portType</span></code>要素に対応しており、Webサービスの内容を記述する要素ではないためである。</p>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;BindingType</span></code>を付けることで、バインディングの方式を設定する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">SOAPBinding.SOAP12HTTP_BINDING</span></code>を定義するとSOAP1.2でのバインディングとなる。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">先ほど作成した<code class="docutils literal notranslate"><span class="pre">TodoWebService</span></code>インターフェースを実装する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">org.springframework.web.context.support.SpringBeanAutowiringSupport</span></code>を継承することで、SpringのBeanをDIできるようにする。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Serviceをインジェクションする。</div>
<div class="line">通常のControllerでServiceを呼び出す場合と変わりはない。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Serviceを呼び出して業務処理を実行する。</div>
<div class="line">通常のControllerでServiceを呼び出す場合と変わりはない。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Webサービス関連のクラスはwsパッケージ配下にまとめることを推奨する。これは、アプリケーション層のクラスはappパッケージ配下に配置することを推奨しており、それらと区別をしやすくするためである。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>WebService実装クラスを公開するために、CXFServlet用のBean定義ファイルに、SOAPのエンドポイントとなるクラス名およびアドレスを定義する。</p>
<p><em>[server projectName]-web/src/main/resources/META-INF/spring/cxf-servlet.xml</em></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;beans</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="w">    </span><span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
<span class="w">    </span><span class="na">xmlns:jaxws=</span><span class="s">&quot;http://cxf.apache.org/jaxws&quot;</span><span class="w"> </span><span class="na">xmlns:soap=</span><span class="s">&quot;http://cxf.apache.org/bindings/soap&quot;</span>
<span class="w">    </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans</span>
<span class="s">         https://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">         http://www.springframework.org/schema/context</span>
<span class="s">         https://www.springframework.org/schema/context/spring-context.xsd</span>
<span class="s">         http://cxf.apache.org/jaxws</span>
<span class="s">         http://cxf.apache.org/schemas/jaxws.xsd</span>
<span class="s">         http://cxf.apache.org/bindings/soap</span>
<span class="s">         http://cxf.apache.org/schemas/configuration/soap.xsd&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;jaxws:endpoint</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;todoWebEndpoint&quot;</span><span class="w"> </span><span class="na">implementor=</span><span class="s">&quot;com.example.ws.todo.TodoWebServiceImpl&quot;</span>
<span class="w">        </span><span class="na">address=</span><span class="s">&quot;/TodoWebService&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">org.apache.cxf.transport.servlet.CXFServlet</span></code>内で動作するWebサービスのエンドポイントを定義する。</div>
<div class="line"><br /></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">implementor</span></code>属性に公開するWebサービスの実装クラスを指定する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">address</span></code>属性にWebサービスを公開するアドレスを指定する。</div>
<div class="line">アドレスは、公開するエンドポイントのパス部分のみ記述する。</div>
<div class="line">属性の詳細については<a class="reference external" href="https://cwiki.apache.org/confluence/display/CXF20DOC/JAX-WS+Configuration">Apache CXF JAX-WS Configuration</a>を参照されたい。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="soaphowtouseservervalidation">
<span id="id7"></span><h4><a class="toc-backref" href="#id36" role="doc-backlink"><span class="section-number">5.3.2.1.6. </span>入力チェックの実装</a><a class="headerlink" href="#soaphowtouseservervalidation" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">SOAP Web Serviceにより送信されたパラメータの入力チェックには、Springから提供されているメソッドバリデーションを使用する。</div>
<div class="line">メソッドバリデーションの詳細については<a class="reference internal" href="../WebApplicationDetail/Validation.html#methodvalidationonspringframeworkhowtouseapplytarget"><span class="std std-ref">Method Validation対象のメソッドにするための定義方法</span></a>を参照されたい。</div>
<div class="line">以下のように、Serviceのインターフェースに入力チェック内容を定義する。</div>
</div>
<p><em>[server projectName]-domain/src/main/java/com/example/domain/service/todo/TodoService.java</em></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.domain.service.todo</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.Valid</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.NotEmpty</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.groups.Default</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.validation.annotation.Validated</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.domain.model.Todo</span><span class="p">;</span>

<span class="nd">@Validated</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">TodoService</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">Todo</span><span class="w"> </span><span class="nf">getTodo</span><span class="p">(</span><span class="nd">@NotEmpty</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">todoId</span><span class="p">);</span><span class="w"> </span><span class="c1">// (2)</span>

<span class="w">    </span><span class="nd">@Validated</span><span class="p">({</span><span class="w"> </span><span class="n">Default</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">Todo</span><span class="p">.</span><span class="na">Create</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="c1">// (3)</span>
<span class="w">    </span><span class="n">Todo</span><span class="w"> </span><span class="nf">createTodo</span><span class="p">(</span><span class="nd">@Valid</span><span class="w"> </span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="p">);</span><span class="w"> </span><span class="c1">// (4)</span>

<span class="w">    </span><span class="nd">@Validated</span><span class="p">({</span><span class="w"> </span><span class="n">Default</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">Todo</span><span class="p">.</span><span class="na">Update</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="n">Todo</span><span class="w"> </span><span class="nf">updateTodo</span><span class="p">(</span><span class="nd">@Valid</span><span class="w"> </span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>
</div>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;Validated</span></code>を付けることで、このインターフェースの実装クラスが入力チェック対象であることを宣言する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">引数をチェックする場合には、引数自体にアノテーションを付ける。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;Validated</span></code>にグループを指定し、特定の条件を絞って入力チェックすることも可能である。</div>
<div class="line">入力チェックのグループ化については「<a class="reference internal" href="../WebApplicationDetail/Validation.html#validationgroupvalidation"><span class="std std-ref">バリデーションのグループ化</span></a>」を参照されたい。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">JavaBeanの入力チェックを行う場合も、引数に<code class="docutils literal notranslate"><span class="pre">&#64;Valid</span></code>を付ける。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><em>[server projectName]-model/src/main/java/com/example/domain/model/Todo.java</em></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.domain.model</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.NotEmpty</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.Null</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.Serializable</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Date</span><span class="p">;</span>

<span class="c1">// (1)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Todo</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">Create</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">Update</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Null</span><span class="p">(</span><span class="n">groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Create</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@NotEmpty</span><span class="p">(</span><span class="n">groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Update</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">todoId</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@NotEmpty</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">title</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">finished</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Null</span><span class="p">(</span><span class="n">groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Create</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// omitted setter and getter</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Bean ValidationでJavaBeanの入力チェックを定義する。</div>
<div class="line">詳細は「<a class="reference internal" href="../WebApplicationDetail/Validation.html"><span class="doc">入力チェック</span></a>」を参照されたい。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">バリデーションのグループ化を行うために使用するインターフェースを定義する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id8">
<h4><a class="toc-backref" href="#id37" role="doc-backlink"><span class="section-number">5.3.2.1.7. </span>セキュリティ対策</a><a class="headerlink" href="#id8" title="Permalink to this heading">¶</a></h4>
<p><strong>認証処理</strong></p>
<div class="line-block">
<div class="line">SOAPの認証・認可方式に関して、本ガイドラインではSpring SecurityでBasic認証を行う方法とServiceでの認可の方法のみ紹介する。</div>
<div class="line">詳細な利用方法は、「<a class="reference internal" href="../../Security/Authentication.html"><span class="doc">認証</span></a>」と「<a class="reference internal" href="../../Security/Authorization.html"><span class="doc">認可</span></a>」を参照されたい。</div>
</div>
<p>以下にSOAP Web Serviceに対して、Basic認証を行うSpring Securityの設定例を示す。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-3-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-3-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-3-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-3-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-3-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-3-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[server</span> <span class="pre">projectName]-web/src/main/java/com/example/config/web/SpringSecurityConfig.java</span></code></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// (1)</span>
<span class="nd">@Bean</span>
<span class="kd">public</span><span class="w"> </span><span class="n">SecurityFilterChain</span><span class="w"> </span><span class="nf">filterChain</span><span class="p">(</span><span class="n">HttpSecurity</span><span class="w"> </span><span class="n">http</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">http</span><span class="p">.</span><span class="na">securityMatcher</span><span class="p">(</span><span class="n">antMatcher</span><span class="p">(</span><span class="s">&quot;/ws/**&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="n">http</span><span class="p">.</span><span class="na">sessionManagement</span><span class="p">(</span><span class="n">session</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">sessionCreationPolicy</span><span class="p">(</span><span class="n">SessionCreationPolicy</span><span class="p">.</span><span class="na">STATELESS</span><span class="p">));</span>
<span class="w">    </span><span class="n">http</span><span class="p">.</span><span class="na">csrf</span><span class="p">(</span><span class="n">csrf</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">csrf</span><span class="p">.</span><span class="na">disable</span><span class="p">());</span>
<span class="w">    </span><span class="n">http</span><span class="p">.</span><span class="na">httpBasic</span><span class="p">(</span><span class="n">Customizer</span><span class="p">.</span><span class="na">withDefaults</span><span class="p">());</span>
<span class="w">    </span><span class="n">http</span><span class="p">.</span><span class="na">authorizeHttpRequests</span><span class="p">(</span><span class="n">authz</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">authz</span><span class="p">.</span><span class="na">requestMatchers</span><span class="p">(</span><span class="n">antMatcher</span><span class="p">(</span><span class="s">&quot;/**&quot;</span><span class="p">)).</span><span class="na">permitAll</span><span class="p">());</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">http</span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// (2)</span>
<span class="nd">@Bean</span>
<span class="kd">public</span><span class="w"> </span><span class="n">AuthenticationManager</span><span class="w"> </span><span class="nf">authenticationManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ProviderManager</span><span class="p">(</span><span class="n">authenticationProvider</span><span class="p">());</span>
<span class="p">}</span>

<span class="c1">// (2)</span>
<span class="nd">@Bean</span>
<span class="kd">public</span><span class="w"> </span><span class="n">AuthenticationProvider</span><span class="w"> </span><span class="nf">authenticationProvider</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">DaoAuthenticationProvider</span><span class="w"> </span><span class="n">authProvider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DaoAuthenticationProvider</span><span class="p">();</span>
<span class="w">    </span><span class="n">authProvider</span><span class="p">.</span><span class="na">setUserDetailsService</span><span class="p">(</span><span class="n">sampleUserDetailsService</span><span class="p">());</span>
<span class="w">    </span><span class="n">authProvider</span><span class="p">.</span><span class="na">setPasswordEncoder</span><span class="p">(</span><span class="n">passwordEncoder</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">authProvider</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">httpBasic(Customizer.withDefaults())</span></code>を記述するとBasic認証を行うことができる。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">securityMatcher</span></code>を使用して、Webサービスを実行する部分のみ認証を行う。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">AuthenticationProvider</span></code>を利用して、認証方式を定義する。</div>
<div class="line">実際の認証およびユーザ情報取得は<code class="docutils literal notranslate"><span class="pre">UserDetailsService</span></code>を作成して実施する必要がある。</div>
<div class="line">詳細は「<a class="reference internal" href="../../Security/Authentication.html"><span class="doc">認証</span></a>」を参照されたい。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div><div aria-labelledby="tab-3-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-3-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[server</span> <span class="pre">projectName]-web/src/main/resources/META-INF/spring/spring-security.xml</span></code></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;sec:http</span><span class="w"> </span><span class="na">pattern=</span><span class="s">&quot;/ws/**&quot;</span><span class="w"> </span><span class="na">request-matcher=</span><span class="s">&quot;ant&quot;</span><span class="w"> </span><span class="na">create-session=</span><span class="s">&quot;stateless&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;sec:csrf</span><span class="w"> </span><span class="na">disabled=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;sec:http-basic</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;sec:intercept-url</span><span class="w"> </span><span class="na">pattern=</span><span class="s">&quot;/**&quot;</span><span class="w"> </span><span class="na">access=</span><span class="s">&quot;permitAll&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/sec:http&gt;</span>

<span class="cm">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;sec:authentication-manager&gt;</span>
<span class="w">    </span><span class="nt">&lt;sec:authentication-provider</span><span class="w"> </span><span class="na">user-service-ref=</span><span class="s">&quot;sampleUserDetailsService&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;sec:password-encoder</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;passwordEncoder&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/sec:authentication-provider&gt;</span>
<span class="nt">&lt;/sec:authentication-manager&gt;</span>
</pre></div>
</div>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">sec:http-basic</span></code>タグを記述するとBasic認証を行うことができる。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">pattern</span></code>属性を使用して、Webサービスを実行する部分のみ認証を行う。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">authentication-provider</span></code>を利用して、認証方式を定義する。</div>
<div class="line">実際の認証およびユーザ情報取得は<code class="docutils literal notranslate"><span class="pre">UserDetailsService</span></code>を作成して実施する必要がある。</div>
<div class="line">詳細は「<a class="reference internal" href="../../Security/Authentication.html"><span class="doc">認証</span></a>」を参照されたい。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>認可処理</strong></p>
<div class="line-block">
<div class="line">認可はServiceごとにアノテーションを付けて行う。</div>
<div class="line">詳細は「<a class="reference internal" href="../../Security/Authorization.html"><span class="doc">認可</span></a>」のアクセス認可(Method)を参照されたい。</div>
</div>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-4-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-4-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-4-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-4-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-4-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-4-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[server</span> <span class="pre">projectName]-web/src/main/java/com/example/config/web/SpringSecurityConfig.java</span></code></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Configuration</span>
<span class="nd">@EnableWebSecurity</span>
<span class="nd">@EnableMethodSecurity</span><span class="w">  </span><span class="c1">// (1)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SpringSecurityConfig</span><span class="w"> </span><span class="p">{</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;EnableMethodSecurity</span></code>アノテーションを付与する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div><div aria-labelledby="tab-4-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-4-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[server</span> <span class="pre">projectName]-web/src/main/resources/META-INF/spring/spring-security.xml</span></code></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;sec:method-security/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;sec:method-security/&gt;</span></code>要素を指定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><em>[server projectName]-domain/src/main/java/com/example/domain/service/todo/TodoServiceImpl.java</em></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">TodoService</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// omitted</span>

<span class="w">    </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="nd">@PreAuthorize</span><span class="p">(</span><span class="s">&quot;isAuthenticated()&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getTodos</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PreAuthorize</span><span class="p">(</span><span class="s">&quot;hasRole(&#39;ROLE_ADMIN&#39;)&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Todo</span><span class="w"> </span><span class="nf">createTodo</span><span class="p">(</span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// omitted</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">認可処理を行うメソッドに<code class="docutils literal notranslate"><span class="pre">org.springframework.security.access.prepost.PreAuthorize</span></code>アノテーションを設定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>CSRF対策の無効化</strong></p>
<div class="line-block">
<div class="line">SOAP Web Serviceはセッションを利用せず、ステートレスな通信にすべきである。</div>
<div class="line">しかし、ブランクプロジェクトのデフォルトの設定では、CSRF対策が有効化されている。</div>
<div class="line">そのため、以下の設定を追加し、SOAP Web Serviceのリクエストに対して、CSRF対策の処理が行われないようにする。</div>
</div>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-5-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-5-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-5-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-5-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-5-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-5-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[server</span> <span class="pre">projectName]-web/src/main/java/com/example/config/web/SpringSecurityConfig.java</span></code></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// (1)</span>
<span class="nd">@Bean</span>
<span class="kd">public</span><span class="w"> </span><span class="n">SecurityFilterChain</span><span class="w"> </span><span class="nf">filterChain</span><span class="p">(</span><span class="n">HttpSecurity</span><span class="w"> </span><span class="n">http</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">http</span><span class="p">.</span><span class="na">securityMatcher</span><span class="p">(</span><span class="n">antMatcher</span><span class="p">(</span><span class="s">&quot;/ws/**&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="n">http</span><span class="p">.</span><span class="na">sessionManagement</span><span class="p">(</span><span class="n">session</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">sessionCreationPolicy</span><span class="p">(</span><span class="n">SessionCreationPolicy</span><span class="p">.</span><span class="na">STATELESS</span><span class="p">));</span>
<span class="w">    </span><span class="n">http</span><span class="p">.</span><span class="na">csrf</span><span class="p">(</span><span class="n">csrf</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">csrf</span><span class="p">.</span><span class="na">disable</span><span class="p">());</span>
<span class="w">    </span><span class="n">http</span><span class="p">.</span><span class="na">httpBasic</span><span class="p">(</span><span class="n">Customizer</span><span class="p">.</span><span class="na">withDefaults</span><span class="p">());</span>
<span class="w">    </span><span class="n">http</span><span class="p">.</span><span class="na">authorizeHttpRequests</span><span class="p">(</span><span class="n">authz</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">authz</span><span class="p">.</span><span class="na">requestMatchers</span><span class="p">(</span><span class="n">antMatcher</span><span class="p">(</span><span class="s">&quot;/**&quot;</span><span class="p">)).</span><span class="na">permitAll</span><span class="p">());</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">http</span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">SOAP Web Service用のSpring Securityの定義を追加する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">securityMatcher</span></code>にSOAP Web Service用のリクエストパスのURLパターンを指定する。</div>
<div class="line">このコード例では、<code class="docutils literal notranslate"><span class="pre">/ws/</span></code>で始まるリクエストパスをSOAP Web Service用のリクエストパスとしている。</div>
<div class="line">また、<code class="docutils literal notranslate"><span class="pre">sessionManagement</span></code>にセッション作成ポリシーとして<code class="docutils literal notranslate"><span class="pre">SessionManagementConfigurer#sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span></code>を指定する事で、</div>
<div class="line">Spring Securityの処理でセッションが使用されなくなる。</div>
<div class="line"><br /></div>
<div class="line">CSRF対策を無効化するために、<code class="docutils literal notranslate"><span class="pre">csrf</span></code>に<code class="docutils literal notranslate"><span class="pre">CsrfConfigurer#disable</span></code>を指定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div><div aria-labelledby="tab-5-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-5-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[server</span> <span class="pre">projectName]-web/src/main/resources/META-INF/spring/spring-security.xml</span></code></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;sec:http</span><span class="w"> </span><span class="na">pattern=</span><span class="s">&quot;/ws/**&quot;</span><span class="w"> </span><span class="na">request-matcher=</span><span class="s">&quot;ant&quot;</span><span class="w"> </span><span class="na">create-session=</span><span class="s">&quot;stateless&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;sec:csrf</span><span class="w"> </span><span class="na">disabled=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;sec:http-basic</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;sec:intercept-url</span><span class="w"> </span><span class="na">pattern=</span><span class="s">&quot;/**&quot;</span><span class="w"> </span><span class="na">access=</span><span class="s">&quot;permitAll&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/sec:http&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">SOAP Web Service用のSpring Securityの定義を追加する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;sec:http&gt;</span></code>要素の<code class="docutils literal notranslate"><span class="pre">pattern</span></code>属性にSOAP Web Service用のリクエストパスのURLパターンを指定する。</div>
<div class="line">このコード例では、<code class="docutils literal notranslate"><span class="pre">/ws/</span></code>で始まるリクエストパスをSOAP Web Service用のリクエストパスとしている。</div>
<div class="line">また、<code class="docutils literal notranslate"><span class="pre">create-session</span></code>属性を<code class="docutils literal notranslate"><span class="pre">stateless</span></code>とする事で、Spring Securityの処理でセッションが使用されなくなる。</div>
<div class="line"><br /></div>
<div class="line">CSRF対策を無効化するために、<code class="docutils literal notranslate"><span class="pre">&lt;sec:csrf&gt;</span></code>要素の<code class="docutils literal notranslate"><span class="pre">disabled</span></code>属性を<code class="docutils literal notranslate"><span class="pre">true</span></code>に指定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="soaphowtouseserverexceptionhandler">
<span id="id9"></span><h4><a class="toc-backref" href="#id38" role="doc-backlink"><span class="section-number">5.3.2.1.8. </span>例外ハンドリングの実装</a><a class="headerlink" href="#soaphowtouseserverexceptionhandler" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">Jakarta XML Web Servicesの仕様となるが、SOAPサーバで例外が発生した場合に、<code class="docutils literal notranslate"><span class="pre">WebFault</span></code>アノテーションを付与した専用の例外クラスをスローすることにより、SOAPのエラー電文としてクライアントに返却することができる。</div>
<div class="line">本ガンドラインでも上記例外の機能を利用しているが、詳細なエラー情報を送るために独自の例外ハンドリングの仕組みを追加で実装している。</div>
<div class="line"><br /></div>
<div class="line">SOAPサーバにおける例外処理の実装には、以下のことが必要である。</div>
</div>
<ol class="arabic simple">
<li><p>WebFaultExceptionクラスとその関連クラスの実装</p></li>
<li><p>サーバで発生する例外を、WebFaultExceptionでラップする例外ハンドラの作成</p></li>
<li><p>例外発生箇所での例外ハンドラの呼び出し</p></li>
</ol>
<p>以降ではこれらの具体的方法を説明する。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>WebFaultExceptionクラスとその関連クラスの実装</strong></p>
<p>SOAPサーバで発生した例外はこれから記述する例外を実装したクラス（SOAPFault）を使用することで、クライアントへの通知メッセージを決定することができる。</p>
<p>具体的には以下のクラスを作成する。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 30.0%" />
<col style="width: 60.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>クラス名</p></th>
<th class="head"><p>概要</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">ErrorBean</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">発生した例外のコードとメッセージなどを保持するクラス。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">WebFaultType</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">例外の種類を判別するために使用する列挙型。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">WebFaultBean</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">ErrorBean</span></code>と<code class="docutils literal notranslate"><span class="pre">WebFaultType</span></code>を保持するクラス。<code class="docutils literal notranslate"><span class="pre">ErrorBean</span></code>を<code class="docutils literal notranslate"><span class="pre">List</span></code>で保持して例外情報を複数保持できる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">WebFaultException</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">WebFaultBean</span></code>を保持する例外クラス。<code class="docutils literal notranslate"><span class="pre">&#64;WebFault</span></code>を付けて、SOAPFaultであることを宣言する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>これらの例外はSOAPサーバ、クライアントで共用するため、[server projectName]-webserviceに配置する。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><em>[server projectName]-webservice/src/main/java/com/example/ws/webfault/ErrorBean.java</em></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.ws.webfault</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ErrorBean</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">code</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">path</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// omitted setter and getter</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">例外のメッセージなどを保持するクラスを作成する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><em>[server projectName]-webservice/src/main/java/com/example/ws/webfault/WebFaultType.java</em></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.ws.webfault</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="n">WebFaultType</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="n">AccessDeniedFault</span><span class="p">,</span>
<span class="w">    </span><span class="n">BusinessFault</span><span class="p">,</span>
<span class="w">    </span><span class="n">ResourceNotFoundFault</span><span class="p">,</span>
<span class="w">    </span><span class="n">ValidationFault</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">例外の種類を判別するために使用する列挙型を定義する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><em>[server projectName]-webservice/src/main/java/com/example/ws/webfault/WebFaultBean.java</em></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.ws.webfault</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WebFaultBean</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (3)</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">WebFaultType</span><span class="w"> </span><span class="n">type</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ErrorBean</span><span class="o">&gt;</span><span class="w"> </span><span class="n">errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ErrorBean</span><span class="o">&gt;</span><span class="p">();</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">WebFaultBean</span><span class="p">(</span><span class="n">WebFaultType</span><span class="w"> </span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addError</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">code</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">addError</span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addError</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">code</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">errors</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ErrorBean</span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// omitted setter and getter</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">ErrorBean</span></code>と<code class="docutils literal notranslate"><span class="pre">WebFaultType</span></code>を保持するクラスを作成する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><em>[server projectName]-webservice/src/main/java/com/example/ws/webfault/WebFaultException.java</em></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.ws.webfault</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.xml.ws.WebFault</span><span class="p">;</span>

<span class="nd">@WebFault</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;WebFault&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">targetNamespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://example.com/todo&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// (1)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WebFaultException</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">WebFaultBean</span><span class="w"> </span><span class="n">faultInfo</span><span class="p">;</span><span class="w"> </span><span class="c1">// (3)</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">WebFaultException</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">WebFaultException</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">WebFaultBean</span><span class="w"> </span><span class="n">faultInfo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">faultInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">faultInfo</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">WebFaultException</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">WebFaultBean</span><span class="w"> </span><span class="n">faultInfo</span><span class="p">,</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">faultInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">faultInfo</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ErrorBean</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getErrors</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">faultInfo</span><span class="p">.</span><span class="na">getErrors</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">WebFaultType</span><span class="w"> </span><span class="nf">getType</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">faultInfo</span><span class="p">.</span><span class="na">getType</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// omitted setter and getter</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Exception継承クラスに<code class="docutils literal notranslate"><span class="pre">&#64;WebFault</span></code>を付けて、SOAPFaultであることを宣言する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">name</span></code>属性には、クライアントに送信するSOAPFaultの<code class="docutils literal notranslate"><span class="pre">name</span></code>属性を設定する。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">targetNamespace</span></code>属性には、使用するネームスペースを設定する。Webサービスと同じにする必要がある。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ここで、<code class="docutils literal notranslate"><span class="pre">WebFaultException</span></code>の親クラスを<code class="docutils literal notranslate"><span class="pre">RuntimeException</span></code>ではなく<code class="docutils literal notranslate"><span class="pre">Exception</span></code>としているのは、<a class="reference external" href="https://jakarta.ee/specifications/xml-web-services/4.0/jakarta-xml-ws-spec-4.0#j2w11except">Jakarta XML Web Services 4.0 -3.7. Service Specific Exception</a>において、</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">java.lang.RuntimeExceptions</span></code>、<code class="docutils literal notranslate"><span class="pre">java.rmi.RemoteExceptions</span></code>を含むサブクラスは、WebServiceで取り扱う例外として利用してはならないこと、WSDL自体にもマッピングしてはならないことの2点が禁止事項として記載されている事による。</div>
<div class="line">実際に<code class="docutils literal notranslate"><span class="pre">WebFaultException</span></code>の親クラスを<code class="docutils literal notranslate"><span class="pre">RuntimeException</span></code>とした場合、APサーバのJakarta XML Web Servicesに実装依存するが、クライアントで<code class="docutils literal notranslate"><span class="pre">&#64;WebFault</span></code>を付けた例外クラス（<code class="docutils literal notranslate"><span class="pre">WebFaultException</span></code>）を取得することができず、エラーの種類やメッセージを取得することができなくなる。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">faultInfoをフィールドに保持させるとともに、コード例のように以下のようなコンストラクタとメソッドを持たせる。</div>
</div>
<ul class="simple">
<li><p>メッセージ文字列とfaultInfoを引数とするコンストラクタ</p></li>
<li><p>メッセージ文字列とfaultInfoと原因例外を引数とするコンストラクタ</p></li>
<li><p>getFaultInfoメソッド</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>WebFaultExceptionのコンストラクタとフィールドについて</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">WebFaultException</span></code>には、デフォルトコンストラクタと各フィールドに対応するsetterが必須となる。これは、クライアントの内部処理で、<code class="docutils literal notranslate"><span class="pre">WebFaultException</span></code>を作成する際に使用するためである。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>サーバで発生する例外を、WebFaultExceptionでラップする例外ハンドラの作成</strong></p>
<p>Serviceから発生する実行時例外をSOAPFaultでラップするために例外ハンドラークラスを作成する。
本ガイドラインではWebService実装クラスがこのハンドラーを用いて例外を変換してスローする方針とする。</p>
<p>Serviceからスローされる例外は以下を想定している。必要に応じて追加されたい。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 60.0%" />
<col style="width: 40.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>例外名</p></th>
<th class="head"><p>内容</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">org.springframework.security.access.AccessDeniedException</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">認可エラー時の例外</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">jakarta.validation.ConstraintViolationException</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">入力チェックエラー時の例外</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.common.exception.ResourceNotFoundException</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">リソースが見つからない場合の例外</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">org.terasoluna.gfw.common.exception.BusinessException</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">業務例外</div>
</div>
</td>
</tr>
</tbody>
</table>
<p><em>[server projectName]-web/src/main/java/com/example/ws/exception/WsExceptionHandler.java</em></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.ws.exception</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Iterator</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Locale</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Set</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.ConstraintViolation</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.ConstraintViolationException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.Path</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.MessageSource</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.access.AccessDeniedException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.exception.BusinessException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.exception.ExceptionCodeResolver</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.exception.ExceptionLogger</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.exception.ResourceNotFoundException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.exception.SystemException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.message.ResultMessage</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.message.ResultMessages</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.ws.webfault.WebFaultBean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.ws.webfault.WebFaultException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.ws.webfault.WebFaultType</span><span class="p">;</span>

<span class="nd">@Component</span><span class="w">  </span><span class="c1">// (1)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WsExceptionHandler</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="n">MessageSource</span><span class="w"> </span><span class="n">messageSource</span><span class="p">;</span><span class="w"> </span><span class="c1">// (2)</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="n">ExceptionCodeResolver</span><span class="w"> </span><span class="n">exceptionCodeResolver</span><span class="p">;</span><span class="w"> </span><span class="c1">// (3)</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="n">ExceptionLogger</span><span class="w"> </span><span class="n">exceptionLogger</span><span class="p">;</span><span class="w"> </span><span class="c1">// (4)</span>

<span class="w">    </span><span class="c1">// (5)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">translateException</span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">WebFaultException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">loggingException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="w">        </span><span class="n">WebFaultBean</span><span class="w"> </span><span class="n">faultInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">AccessDeniedException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">faultInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WebFaultBean</span><span class="p">(</span><span class="n">WebFaultType</span><span class="p">.</span><span class="na">AccessDeniedFault</span><span class="p">);</span>
<span class="w">            </span><span class="n">faultInfo</span><span class="p">.</span><span class="na">addError</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getName</span><span class="p">(),</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">ConstraintViolationException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">faultInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WebFaultBean</span><span class="p">(</span><span class="n">WebFaultType</span><span class="p">.</span><span class="na">ValidationFault</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">addErrors</span><span class="p">(</span><span class="n">faultInfo</span><span class="p">,</span><span class="w"> </span><span class="p">((</span><span class="n">ConstraintViolationException</span><span class="p">)</span><span class="w"> </span><span class="n">e</span><span class="p">).</span><span class="na">getConstraintViolations</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">ResourceNotFoundException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">faultInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WebFaultBean</span><span class="p">(</span><span class="n">WebFaultType</span><span class="p">.</span><span class="na">ResourceNotFoundFault</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">addErrors</span><span class="p">(</span><span class="n">faultInfo</span><span class="p">,</span><span class="w"> </span><span class="p">((</span><span class="n">ResourceNotFoundException</span><span class="p">)</span><span class="w"> </span><span class="n">e</span><span class="p">).</span><span class="na">getResultMessages</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">faultInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WebFaultBean</span><span class="p">(</span><span class="n">WebFaultType</span><span class="p">.</span><span class="na">BusinessFault</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">addErrors</span><span class="p">(</span><span class="n">faultInfo</span><span class="p">,</span><span class="w"> </span><span class="p">((</span><span class="n">BusinessException</span><span class="p">)</span><span class="w"> </span><span class="n">e</span><span class="p">).</span><span class="na">getResultMessages</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// not translate.</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SystemException</span><span class="p">(</span><span class="s">&quot;e.xx.fw.9001&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WebFaultException</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">(),</span><span class="w"> </span><span class="n">faultInfo</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getCause</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">loggingException</span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">exceptionLogger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addErrors</span><span class="p">(</span><span class="n">WebFaultBean</span><span class="w"> </span><span class="n">faultInfo</span><span class="p">,</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">ConstraintViolation</span><span class="o">&lt;?&gt;&gt;</span><span class="w"> </span><span class="n">constraintViolations</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ConstraintViolation</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">constraintViolations</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Path</span><span class="p">.</span><span class="na">Node</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pathIt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="na">getPropertyPath</span><span class="p">().</span><span class="na">iterator</span><span class="p">();</span>
<span class="w">            </span><span class="n">pathIt</span><span class="p">.</span><span class="na">next</span><span class="p">();</span><span class="w"> </span><span class="c1">// method name node (skip)</span>
<span class="w">            </span><span class="n">Path</span><span class="p">.</span><span class="na">Node</span><span class="w"> </span><span class="n">methodArgumentNameNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pathIt</span><span class="p">.</span><span class="na">next</span><span class="p">();</span>
<span class="w">            </span><span class="n">faultInfo</span><span class="p">.</span><span class="na">addError</span><span class="p">(</span>
<span class="w">                </span><span class="n">v</span><span class="p">.</span><span class="na">getConstraintDescriptor</span><span class="p">().</span><span class="na">getAnnotation</span><span class="p">().</span><span class="na">annotationType</span><span class="p">().</span><span class="na">getSimpleName</span><span class="p">(),</span>
<span class="w">                </span><span class="n">v</span><span class="p">.</span><span class="na">getMessage</span><span class="p">(),</span>
<span class="w">                </span><span class="n">pathIt</span><span class="p">.</span><span class="na">hasNext</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">pathIt</span><span class="p">.</span><span class="na">next</span><span class="p">().</span><span class="na">toString</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">methodArgumentNameNode</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addErrors</span><span class="p">(</span><span class="n">WebFaultBean</span><span class="w"> </span><span class="n">faultInfo</span><span class="p">,</span><span class="w"> </span><span class="n">ResultMessages</span><span class="w"> </span><span class="n">resultMessages</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Locale</span><span class="w"> </span><span class="n">locale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Locale</span><span class="p">.</span><span class="na">getDefault</span><span class="p">();</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ResultMessage</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">resultMessages</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">faultInfo</span><span class="p">.</span><span class="na">addError</span><span class="p">(</span>
<span class="w">                </span><span class="n">message</span><span class="p">.</span><span class="na">getCode</span><span class="p">(),</span>
<span class="w">                </span><span class="n">messageSource</span><span class="p">.</span><span class="na">getMessage</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">getCode</span><span class="p">(),</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="na">getArgs</span><span class="p">(),</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="na">getText</span><span class="p">(),</span><span class="w"> </span><span class="n">locale</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">本クラスをDIコンテナに管理をさせるため、<code class="docutils literal notranslate"><span class="pre">&#64;Component</span></code>を付ける。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">出力するメッセージを取得するために<code class="docutils literal notranslate"><span class="pre">MessageSource</span></code>を使用する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">共通ライブラリが提供する<code class="docutils literal notranslate"><span class="pre">ExceptionCodeResolverMessageSource</span></code>を使用して例外の種類と例外コードをマッピングする。</div>
<div class="line">詳細は、「<a class="reference internal" href="../WebApplicationDetail/ExceptionHandling.html"><span class="doc">例外ハンドリング</span></a>」を参照されたい。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">共通ライブラリが提供する<code class="docutils literal notranslate"><span class="pre">ExceptionLogger</span></code>を使用して例外情報を例外に出力する。</div>
<div class="line">詳細は、「<a class="reference internal" href="../WebApplicationDetail/ExceptionHandling.html"><span class="doc">例外ハンドリング</span></a>」を参照されたい。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Serviceから発生しうる各例外について、<code class="docutils literal notranslate"><span class="pre">SOAPFault</span></code>へのラップを行う。</div>
<div class="line">例外のマッピングは冒頭の表を参考されたい。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>その他の例外の扱いについて</strong></p>
<p>その他の例外発生時（上記の<code class="docutils literal notranslate"><span class="pre">translateException</span></code>メソッドのelse部分）では、クライアントでは詳細な例外の内容は通知されず、<code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.soap.SOAPFaultException</span></code>が発生するのみとなる。他の例外同様にラップしてクライアント側に通知することも可能である。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>例外発生箇所での例外ハンドラの呼び出し</strong></p>
<p>Webサービスクラスにて、例外ハンドラーを呼び出す。以下はその例である。</p>
<p><em>[server projectName]-web/src/main/java/com/example/ws/todo/TodoWebServiceImpl.java</em></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@WebService</span><span class="p">(</span>
<span class="w">        </span><span class="n">targetNamespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://example.com/todo&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">serviceName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;TodoWebService&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">portName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;TodoWebPort&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">endpointInterface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;com.example.ws.todo.TodoWebService&quot;</span><span class="p">)</span>
<span class="nd">@BindingType</span><span class="p">(</span><span class="n">SOAPBinding</span><span class="p">.</span><span class="na">SOAP12HTTP_BINDING</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoWebServiceImpl</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">SpringBeanAutowiringSupport</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">TodoWebService</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="n">TodoService</span><span class="w"> </span><span class="n">todoService</span><span class="p">;</span>
<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="n">WsExceptionHandler</span><span class="w"> </span><span class="n">handler</span><span class="p">;</span><span class="w"> </span><span class="c1">// (1)</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Todo</span><span class="w"> </span><span class="nf">getTodo</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">todoId</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">WebFaultException</span><span class="w"> </span><span class="cm">/* (2) */</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">todoService</span><span class="p">.</span><span class="na">getTodo</span><span class="p">(</span><span class="n">todoId</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">RuntimeException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">handler</span><span class="p">.</span><span class="na">translateException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span><span class="w"> </span><span class="c1">// (3)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">例外ハンドラーをインジェクションする。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">WebFaultException</span></code>にラップしてスローするため、throws句を付ける。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">実行時例外が発生した場合は、例外ハンドラークラスに処理を委譲する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="mtom">
<h4><a class="toc-backref" href="#id39" role="doc-backlink"><span class="section-number">5.3.2.1.9. </span>MTOMを利用した大容量のバイナリデータを扱う方法</a><a class="headerlink" href="#mtom" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">SOAPでは、バイナリデータを扱う場合、Byte配列にマッピングすることで、送受信を行うことができる。</div>
<div class="line">ただし、大容量のバイナリデータを扱う場合、ヒープが枯渇するなどの問題が発生することがある。</div>
<div class="line">上記問題の発生を防ぐため、MTOM（Message Transmission Optimization Mechanism）に準拠した実装を行うことで、最適化した状態で添付ファイルとしてバイナリデータを扱うことができる。</div>
<div class="line">詳細な定義は <a class="reference external" href="https://www.w3.org/TR/soap12-mtom/">W3C -SOAP Message Transmission Optimization Mechanism-</a>を参照されたい。</div>
<div class="line">以下にその方法を記述する。</div>
</div>
<p><em>[server projectName]-webservice/src/main/java/com/example/ws/todo/TodoWebService.java</em></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.ws.todo</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.activation.DataHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.jws.WebMethod</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.jws.WebParam</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.jws.WebResult</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.jws.WebService</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.xml.bind.annotation.XmlMimeType</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.domain.model.Todo</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.ws.webfault.WebFaultException</span><span class="p">;</span>

<span class="nd">@WebService</span><span class="p">(</span><span class="n">targetNamespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://example.com/todo&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">TodoWebService</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// omitted</span>

<span class="w">    </span><span class="nd">@WebMethod</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">uploadFile</span><span class="p">(</span><span class="nd">@XmlMimeType</span><span class="p">(</span><span class="s">&quot;application/octet-stream&quot;</span><span class="p">)</span><span class="w"> </span><span class="cm">/* (1) */</span><span class="w"> </span><span class="n">DataHandler</span><span class="w"> </span><span class="n">dataHandler</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">WebFaultException</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">バイナリデータを処理する<code class="docutils literal notranslate"><span class="pre">jakarta.activation.DataHandler</span></code>に対して<code class="docutils literal notranslate"><span class="pre">&#64;XmlMimeType</span></code>を付ける。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><em>[server projectName]-web/src/main/java/com/example/ws/todo/TodoWebServiceImpl.java</em></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.ws.todo</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.IOException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.InputStream</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.activation.DataHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.jws.WebService</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.xml.ws.BindingType</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.xml.ws.soap.MTOM</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.xml.ws.soap.SOAPBinding</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.context.support.SpringBeanAutowiringSupport</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.terasoluna.gfw.common.exception.SystemException</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.domain.model.Todo</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.domain.service.TodoService</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.ws.webfault.WebFaultException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.ws.exception.WsExceptionHandler</span><span class="p">;</span>

<span class="c1">// (1)</span>
<span class="nd">@MTOM</span>
<span class="nd">@WebService</span><span class="p">(</span>
<span class="w">        </span><span class="n">targetNamespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://example.com/todo&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">serviceName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;TodoWebService&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">portName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;TodoWebPort&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">endpointInterface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;com.example.ws.todo.TodoWebService&quot;</span><span class="p">)</span>
<span class="nd">@BindingType</span><span class="p">(</span><span class="n">SOAPBinding</span><span class="p">.</span><span class="na">SOAP12HTTP_BINDING</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoWebServiceImpl</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">SpringBeanAutowiringSupport</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">TodoWebService</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="n">TodoService</span><span class="w"> </span><span class="n">todoService</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// omitted</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">uploadFile</span><span class="p">(</span><span class="n">DataHandler</span><span class="w"> </span><span class="n">dataHandler</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">WebFaultException</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">InputStream</span><span class="w"> </span><span class="n">inputStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataHandler</span><span class="p">.</span><span class="na">getInputStream</span><span class="p">()){</span><span class="w"> </span><span class="c1">// (2)</span>
<span class="w">            </span><span class="n">todoService</span><span class="p">.</span><span class="na">uploadFile</span><span class="p">(</span><span class="n">inputStream</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">handler</span><span class="p">.</span><span class="na">translateException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;MTOM</span></code>を付けて、MTOMに準拠した実装を使用することを宣言する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">jakarta.activation.DataHandler</span></code>から<code class="docutils literal notranslate"><span class="pre">java.io.InputStream</span></code>を取得してファイルを扱う。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="id10">
<h3><a class="toc-backref" href="#id40" role="doc-backlink"><span class="section-number">5.3.2.2. </span>クライアントの作成</a><a class="headerlink" href="#id10" title="Permalink to this heading">¶</a></h3>
<section id="id11">
<h4><a class="toc-backref" href="#id41" role="doc-backlink"><span class="section-number">5.3.2.2.1. </span>プロジェクトの構成</a><a class="headerlink" href="#id11" title="Permalink to this heading">¶</a></h4>
<p>「<a class="reference internal" href="#soapoverviewjaxwsspring"><span class="std std-ref">Jakarta XML Web Servicesを利用したSOAP Web Serviceの開発について</span></a>」で述べたとおり、modelプロジェクトとwebserviceプロジェクトをSOAPサーバから受領する前提である。</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/SOAPClientProjects.png"><img alt="Client Projects for SOAP" src="../../_images/SOAPClientProjects.png" style="width: 80%;" /></a>
</figure>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 30.0%" />
<col style="width: 60.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>プロジェクト名</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">webプロジェクト</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Controllerを作成する。</div>
<div class="line">通常の画面遷移時のControllerと特に変更点はない。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">domainプロジェクト</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Serviceクラスからwebserviceプロジェクトで用意されたWebServeインターフェースを使用してWebサービスを呼び出す。</div>
<div class="line">SOAPサーバと通信する際に使用するWebServiceインターフェースを実装したプロキシを定義する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">webserviceプロジェクト</div>
</div>
</td>
<td><div class="line-block">
<div class="line">SOAPサーバと同じ資材を配置する。</div>
<div class="line">クライアントはこのインターフェースを使用してWebサービスを実行する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">modelプロジェクト</div>
</div>
</td>
<td><div class="line-block">
<div class="line">SOAPサーバと同じ資材を配置する。</div>
<div class="line">SOAPサーバに渡す入力値や返却結果はこのプロジェクト内のクラスを使用する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">envプロジェクト</div>
</div>
</td>
<td><div class="line-block">
<div class="line">domainプロジェクトで定義したプロキシの環境依存する値を定義する。</div>
<div class="line">プロキシの定義から環境依存する値をプロパティファイルに集約し、プロパティファイルのみenvプロジェクトに配置する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>プロキシの定義ついて</strong></p>
<p>試験用SOAPサーバ、本番用SOAPサーバ等、複数環境向けのプロキシを定義する際に発生する重複部分を排除し、管理を容易にするために、当ガイドラインではプロキシの定義はdomainプロジェクトで行い、環境依存する値はプロパティファイルに集約、プロパティファイルのみenvプロジェクトに配置することを推奨する。</p>
<p>ユニットテストでプロキシのスタブやモックを使用する場合は、ユニットテスト用のコンポーネントを定義するためのBean定義ファイル(test-context.xml)にBeanを定義する。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="soaphowtousewebserviceclient">
<span id="id12"></span><h4><a class="toc-backref" href="#id42" role="doc-backlink"><span class="section-number">5.3.2.2.2. </span>Webサービス クライアントの実装</a><a class="headerlink" href="#soaphowtousewebserviceclient" title="Permalink to this heading">¶</a></h4>
<p>以下のクラスの実装を行う。</p>
<ul class="simple">
<li><p>WebServiceインターフェースを実装したプロキシの定義</p></li>
<li><p>ServiceクラスからWebServiceインターフェース経由でWebサービスを呼び出す。</p></li>
</ul>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/SOAPClientClass.png"><img alt="Server Projects for SOAP" src="../../_images/SOAPClientClass.png" style="width: 80%;" /></a>
</figure>
<p><strong>WebServiceインターフェースを実装したプロキシの作成</strong></p>
<div class="line-block">
<div class="line">WebServiceインターフェースを実装したプロキシの定義を行う。</div>
<div class="line"><br /></div>
<div class="line">サービス名をもとに、<code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.Service</span></code>を生成する。</div>
<div class="line">そして、生成した<code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.Service</span></code>からWebサービスのポートを特定し、そのポートを実装したプロキシを生成する。</div>
<div class="line">以下はその設定例となる。</div>
</div>
<div class="line-block">
<div class="line">サービスやポートの説明は、「<a class="reference internal" href="#soapwebservicewsdl"><span class="std std-ref">WebServiceインターフェースの実装クラスとWSDLファイルの関係</span></a>」を参照されたい。</div>
</div>
<div class="line-block">
<div class="line">テスト等でWSDLファイルに記載されているエンドポイントアドレス以外を指定したい場合の設定については、「<a class="reference internal" href="#soapendpointaddress"><span class="std std-ref">テスト等でエンドポイントアドレスを上書き指定したい場合</span></a>」を参照されたい。</div>
</div>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-6-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-6-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-6-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-6-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-6-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-6-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[client</span> <span class="pre">projectName]-domain/src/main/java/com/example/config/app/[client</span> <span class="pre">projectName]DomainConfig.java</span></code></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// (3)</span>
<span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${webservice.todoWebService.wsdlDocumentResource}&quot;</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">wsdlDocumentResource</span><span class="p">;</span>

<span class="c1">// (1)</span>
<span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;wsService&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">Service</span><span class="w"> </span><span class="nf">wsService</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">MalformedURLException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">QName</span><span class="w"> </span><span class="n">serviceName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">QName</span><span class="p">(</span><span class="s">&quot;http://example.com/todo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TodoWebService&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// (2)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Service</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">URL</span><span class="p">(</span><span class="n">wsdlDocumentResource</span><span class="p">),</span><span class="w"> </span><span class="n">serviceName</span><span class="p">);</span><span class="w">  </span><span class="c1">// (3)</span>
<span class="p">}</span>

<span class="c1">// (4)</span>
<span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;todoWebService&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">TodoWebService</span><span class="w"> </span><span class="nf">todoWebService</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">MalformedURLException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">QName</span><span class="w"> </span><span class="n">portName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">QName</span><span class="p">(</span><span class="s">&quot;http://example.com/todo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TodoWebPort&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// (5)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">wsService</span><span class="p">().</span><span class="na">getPort</span><span class="p">(</span><span class="n">portName</span><span class="p">,</span><span class="w"> </span><span class="n">TodoWebService</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">  </span><span class="c1">// (6)</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">[client</span> <span class="pre">projectName]-env/src/main/resources/META-INF/spring/[client</span> <span class="pre">projectName]-infra.properties</span></code></p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="c1"># (7)</span>
<span class="na">webservice.todoWebService.wsdlDocumentResource</span><span class="o">=</span><span class="s">classpath:META-INF/spring/soap/todoWebService.wsdl</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.Service</span></code>の定義を行う。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">WSDLファイルからサービスを特定するために、<code class="docutils literal notranslate"><span class="pre">javax.xml.namespace.QName</span></code>を定義する。</div>
<div class="line">引数には、SOAPサーバーで公開しているWEBサービスのNamespace、サービス名を指定する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.Service</span></code>の生成を行う。</div>
<div class="line">引数には、SOAPサーバーで公開しているWSDLのURLかファイルパス、サービスを特定するために生成した<code class="docutils literal notranslate"><span class="pre">javax.xml.namespace.QName</span></code>を指定する。</div>
<div class="line">WSDLのパスは、後述するプロパティファイルから取得する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">WebServiceの動的プロキシの定義を行う。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">WSDLファイルからポートを特定するために、<code class="docutils literal notranslate"><span class="pre">javax.xml.namespace.QName</span></code>を定義する。</div>
<div class="line">引数には、SOAPサーバーで公開しているWEBサービスのNamespace、ポート名を指定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.Service</span></code>からポートの動的プロキシを取得する。</div>
<div class="line">引数には、ポートを特定するために生成した<code class="docutils literal notranslate"><span class="pre">javax.xml.namespace.QName</span></code>、WebServiceのインターフェースを指定する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">WSDLのパスを設定する。</div>
<div class="line"><br /></div>
<div class="line">WSDLファイルをクライアントに配備し、プロパティファイルにWSDLのファイルパスを指定することを推奨する。</div>
<div class="line">URLを指定してしまうと、Bean生成時にSOAPサーバに対してWSDLファイルを取得しに行ってしまい、SOAPサーバが起動していない場合エラーとなり、クライアントアプリケーションが起動できなくなってしまう。</div>
<div class="line">上記対応を行うと、SOAPサーバが起動していない場合でもクライアントアプリケーションを起動させることができる。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div><div aria-labelledby="tab-6-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-6-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[client</span> <span class="pre">projectName]-domain/src/main/resources/META-INF/spring/[client</span> <span class="pre">projectName]-domain.xml</span></code></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;wsService&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;jakarta.xml.ws.Service&quot;</span><span class="w"> </span><span class="na">factory-method=</span><span class="s">&quot;create&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- (3) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;constructor-arg</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;java.net.URL&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${webservice.todoWebService.wsdlDocumentResource}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="cm">&lt;!-- (3) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;constructor-arg&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">        </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;javax.xml.namespace.QName&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;constructor-arg</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;java.lang.String&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;http://example.com/todo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;constructor-arg</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;java.lang.String&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;TodoWebService&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/bean&gt;</span>
<span class="w">    </span><span class="nt">&lt;/constructor-arg&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="cm">&lt;!-- (4) --&gt;</span>
<span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;todoWebService&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;com.example.ws.todo.TodoWebService&quot;</span><span class="w"> </span><span class="na">factory-bean=</span><span class="s">&quot;wsService&quot;</span><span class="w"> </span><span class="na">factory-method=</span><span class="s">&quot;getPort&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- (6) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;constructor-arg&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- (5) --&gt;</span>
<span class="w">        </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;javax.xml.namespace.QName&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;constructor-arg</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;java.lang.String&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;http://example.com/todo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;constructor-arg</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;java.lang.String&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;TodoWebPort&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/bean&gt;</span>
<span class="w">    </span><span class="nt">&lt;/constructor-arg&gt;</span>
<span class="w">    </span><span class="nt">&lt;constructor-arg</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;java.lang.Class&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;com.example.ws.todo.TodoWebService&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">[client</span> <span class="pre">projectName]-env/src/main/resources/META-INF/spring/[client</span> <span class="pre">projectName]-infra.properties</span></code></p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="c1"># (7)</span>
<span class="na">webservice.todoWebService.wsdlDocumentResource</span><span class="o">=</span><span class="s">classpath:META-INF/spring/soap/todoWebService.wsdl</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.Service</span></code>の定義を行う。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">WSDLファイルからサービスを特定するために、<code class="docutils literal notranslate"><span class="pre">javax.xml.namespace.QName</span></code>を定義する。</div>
<div class="line">引数には、SOAPサーバーで公開しているWEBサービスのNamespace、サービス名を指定する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.Service</span></code>の生成を行う。</div>
<div class="line">引数には、SOAPサーバーで公開しているWSDLのURLかファイルパス、サービスを特定するために生成した<code class="docutils literal notranslate"><span class="pre">javax.xml.namespace.QName</span></code>を指定する。</div>
<div class="line">WSDLのパスは、後述するプロパティファイルから取得する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">WebServiceの動的プロキシの定義を行う。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">WSDLファイルからポートを特定するために、<code class="docutils literal notranslate"><span class="pre">javax.xml.namespace.QName</span></code>を定義する。</div>
<div class="line">引数には、SOAPサーバーで公開しているWEBサービスのNamespace、ポート名を指定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.Service</span></code>からポートの動的プロキシを取得する。</div>
<div class="line">引数には、ポートを特定するために生成した<code class="docutils literal notranslate"><span class="pre">javax.xml.namespace.QName</span></code>、WebServiceのインターフェースを指定する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">WSDLのパスを設定する。</div>
<div class="line"><br /></div>
<div class="line">WSDLファイルをクライアントに配備し、プロパティファイルにWSDLのファイルパスを指定することを推奨する。</div>
<div class="line">URLを指定してしまうと、Bean生成時にSOAPサーバに対してWSDLファイルを取得しに行ってしまい、SOAPサーバが起動していない場合エラーとなり、クライアントアプリケーションが起動できなくなってしまう。</div>
<div class="line">上記対応を行うと、SOAPサーバが起動していない場合でもクライアントアプリケーションを起動させることができる。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>ServiceからWebサービスを呼び出す</strong></p>
<p>上記で作成したWebサービスをServiceでインジェクションして実行する。</p>
<p><em>[client projectName]-domain/src/main/java/com/example/domain/service/todo/TodoServiceImpl.java</em></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.soap.domain.service.todo</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.domain.model.Todo</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.ws.webfault.WebFaultException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.ws.todo.TodoWebService</span><span class="p">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">TodoService</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="n">TodoWebService</span><span class="w"> </span><span class="n">todoWebService</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">createTodo</span><span class="p">(</span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// (1)</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">todoWebService</span><span class="p">.</span><span class="na">createTodo</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">WebFaultException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// (2)</span>
<span class="w">            </span><span class="c1">// handle exception…</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">TodoWebService</span></code>をインジェクションして、実行対象のServiceを呼び出す。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">サーバ側で、例外が発生した場合は、<code class="docutils literal notranslate"><span class="pre">WebFaultException</span></code>にラップされて送信される。</div>
<div class="line">内容に応じて処理を行う。</div>
<div class="line">例外処理の詳細は「<a class="reference internal" href="#soaphowtouseexceptionhandler"><span class="std std-ref">例外ハンドリングの実装</span></a>」を参照されたい。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>レスポンスの情報取得</strong></p>
<p>リトライを考慮するなど、レスポンスの情報をクライアントで取得可能な場合、以下のように<code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.BindingProvider</span></code>クラスにキャストすることで取得できる。</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BindingProvider</span><span class="w"> </span><span class="n">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">BindingProvider</span><span class="p">)</span><span class="w"> </span><span class="n">todoWebService</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">provider</span><span class="p">.</span><span class="na">getResponseContext</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="n">MessageContext</span><span class="p">.</span><span class="na">HTTP_RESPONSE_CODE</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id13">
<h4><a class="toc-backref" href="#id43" role="doc-backlink"><span class="section-number">5.3.2.2.3. </span>セキュリティ対策</a><a class="headerlink" href="#id13" title="Permalink to this heading">¶</a></h4>
<p><strong>認証処理</strong></p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.Service</span></code>を使用して、Basic認証を使用しているSOAPサーバと通信をする際には、<code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.BindingProvider</span></code>で取得できる<code class="docutils literal notranslate"><span class="pre">RequestContext</span></code>にユーザーとパスワードを設定することで認証を行うことができる。</div>
<div class="line">設定の方法は以下の通りである。</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.Service</span></code>の定義が複雑になるため、FactoryBeanを使用してBean定義を行う。</p>
<p><em>[client projectName]-domain/src/main/java/com/example/domain/service/todo/factory/TodoWebServiceFactoryBean.java</em></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoWebServiceFactoryBean</span><span class="w"> </span><span class="kd">implements</span>
<span class="w">                                        </span><span class="n">FactoryBean</span><span class="o">&lt;</span><span class="n">TodoWebService</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">wsdlDocumentResource</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userName</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">TodoWebService</span><span class="w"> </span><span class="nf">getObject</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">QName</span><span class="w"> </span><span class="n">serviceName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">QName</span><span class="p">(</span><span class="s">&quot;http://example.com/todo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TodoWebService&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">QName</span><span class="w"> </span><span class="n">portName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">QName</span><span class="p">(</span><span class="s">&quot;http://example.com/todo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TodoWebPort&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="n">Service</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Service</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">URL</span><span class="p">(</span><span class="n">wsdlDocumentResource</span><span class="p">),</span><span class="w"> </span><span class="n">serviceName</span><span class="p">);</span>
<span class="w">        </span><span class="n">TodoWebService</span><span class="w"> </span><span class="n">todoWebService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">getPort</span><span class="p">(</span><span class="n">portName</span><span class="p">,</span><span class="w"> </span><span class="n">TodoWebService</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

<span class="w">        </span><span class="n">BindingProvider</span><span class="w"> </span><span class="n">bindingProvider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">BindingProvider</span><span class="p">)</span><span class="w"> </span><span class="n">todoWebService</span><span class="p">;</span>
<span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">requestContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bindingProvider</span><span class="p">.</span><span class="na">getRequestContext</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// (1)</span>
<span class="w">        </span><span class="n">requestContext</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">BindingProvider</span><span class="p">.</span><span class="na">USERNAME_PROPERTY</span><span class="p">,</span><span class="w"> </span><span class="n">userName</span><span class="p">);</span>
<span class="w">        </span><span class="n">requestContext</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">BindingProvider</span><span class="p">.</span><span class="na">PASSWORD_PROPERTY</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">todoWebService</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setWsdlDocumentResource</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">wsdlDocumentResource</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">wsdlDocumentResource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wsdlDocumentResource</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUserName</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">userName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">userName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userName</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setPassword</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">password</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">getObjectType</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">TodoWebService</span><span class="p">.</span><span class="na">class</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">取得した<code class="docutils literal notranslate"><span class="pre">RequestContext</span></code>に対して、Basic認証で使用するユーザー名、パスワードの設定を追加する。</div>
<div class="line">ユーザー名のキーに<code class="docutils literal notranslate"><span class="pre">BindingProvider.USERNAME_PROPERTY</span></code>を設定し、値にはユーザー名を設定する。</div>
<div class="line">パスワードのキーに<code class="docutils literal notranslate"><span class="pre">BindingProvider.PASSWORD_PROPERTY</span></code>を設定し、値にはパスワードを設定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>FactoryBeanのBean定義を行う。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-7-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-7-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-7-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-7-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-7-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-7-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[client</span> <span class="pre">projectName]-domain/src/main/java/com/example/config/app/[client</span> <span class="pre">projectName]DomainConfig.java</span></code></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${webservice.todoWebService.wsdlDocumentResource}&quot;</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">wsdlDocumentResource</span><span class="p">;</span>

<span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${webservice.todoWebService.username}&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">// (1)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">;</span>

<span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${webservice.todoWebService.password}&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">// (1)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">;</span>

<span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;todoWebService&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">TodoWebServiceFactoryBean</span><span class="w"> </span><span class="nf">todoWebService</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">TodoWebServiceFactoryBean</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TodoWebServiceFactoryBean</span><span class="p">();</span>
<span class="w">    </span><span class="n">factory</span><span class="p">.</span><span class="na">setWsdlDocumentResource</span><span class="p">(</span><span class="n">wsdlDocumentResource</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="n">factory</span><span class="p">.</span><span class="na">setUserName</span><span class="p">(</span><span class="n">username</span><span class="p">);</span>
<span class="w">    </span><span class="n">factory</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="n">password</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">[client</span> <span class="pre">projectName]-env/src/main/resources/META-INF/spring/[client</span> <span class="pre">projectName]-infra.properties</span></code></p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="c1"># (2)</span>
<span class="na">webservice.todoWebService.username</span><span class="o">=</span><span class="s">testuser</span>
<span class="na">webservice.todoWebService.password</span><span class="o">=</span><span class="s">password</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">後述するプロパティファイルからユーザー名、パスワードの値を取得し、<code class="docutils literal notranslate"><span class="pre">FactoryBean</span></code>に設定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">認証に使用するユーザ名とパスワードを定義する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div><div aria-labelledby="tab-7-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-7-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[client</span> <span class="pre">projectName]-domain/src/main/resources/META-INF/spring/[client</span> <span class="pre">projectName]-domain.xml</span></code></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;todoWebService&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;com.example.domain.service.todo.factory.TodoWebServiceFactoryBean&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;wsdlDocumentResource&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${webservice.todoWebService.wsdlDocumentResource}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;userName&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${webservice.todoWebService.username}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;password&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${webservice.todoWebService.password}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">[client</span> <span class="pre">projectName]-env/src/main/resources/META-INF/spring/[client</span> <span class="pre">projectName]-infra.properties</span></code></p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="c1"># (2)</span>
<span class="na">webservice.todoWebService.username</span><span class="o">=</span><span class="s">testuser</span>
<span class="na">webservice.todoWebService.password</span><span class="o">=</span><span class="s">password</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">後述するプロパティファイルからユーザー名、パスワードの値を取得し、<code class="docutils literal notranslate"><span class="pre">FactoryBean</span></code>に設定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">認証に使用するユーザ名とパスワードを定義する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="soapexceptiontype">
<span id="id14"></span><h4><a class="toc-backref" href="#id44" role="doc-backlink"><span class="section-number">5.3.2.2.4. </span>WEBサービス クライアントで取り扱う例外の種類</a><a class="headerlink" href="#soapexceptiontype" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">WEBサービス クライアントからSOAPサーバーに通信を行う際に、発生する例外は以下の通りとなる。</div>
<div class="line">以下で定義した例外は、必要に応じてクライアントでハンドリングを行う必要がある例外となる。</div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 40.0%" />
<col style="width: 60.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>例外名</p></th>
<th class="head"><p>内容</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.WebServiceException</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">WEBサービス全般で利用される実行時例外であり、SOAPサーバーとの通信時の障害、設定の不備等の広域の例外を表現する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.soap.SOAPFaultException</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">SOAP固有のエラー情報を保持した例外であり、SOAPサーバにて予期せぬ例外が発生した場合等に、Jakarta XML Web Servicesにより生成される例外。</div>
<div class="line">「<a class="reference internal" href="#soaphowtouseserverexceptionhandler"><span class="std std-ref">例外ハンドリングの実装</span></a>」にてハンドリングできなかった例外が本例外に該当する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">com.example.ws.webfault.WebFaultException</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">SOAPサーバの「<a class="reference internal" href="#soaphowtouseserverexceptionhandler"><span class="std std-ref">例外ハンドリングの実装</span></a>」にてラップした例外。</div>
<div class="line">主に、業務ロジックにて検知可能な例外が本例外に該当する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="soaphowtouseexceptionhandler">
<span id="id15"></span><h4><a class="toc-backref" href="#id45" role="doc-backlink"><span class="section-number">5.3.2.2.5. </span>例外ハンドリングの実装</a><a class="headerlink" href="#soaphowtouseexceptionhandler" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">SOAPサーバでは、<code class="docutils literal notranslate"><span class="pre">WebFaultException</span></code>に例外をラップして、スローすることを推奨している。</div>
<div class="line">クライアントは<code class="docutils literal notranslate"><span class="pre">WebFaultException</span></code>をキャッチして、その原因例外を判定してそれぞれの処理を行う。</div>
<div class="line">以下の例では、<code class="docutils literal notranslate"><span class="pre">WebServiceException</span></code>と<code class="docutils literal notranslate"><span class="pre">SOAPFaultException</span></code>をシステム例外扱いとしているためクライアントでのハンドリングは行っていない。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">WebServiceException</span></code>と<code class="docutils literal notranslate"><span class="pre">SOAPFaultException</span></code>に関してもクライアントで例外処理を追加したい場合は、ハンドリングする必要がある。</div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">createTodo</span><span class="p">(</span><span class="n">Todo</span><span class="w"> </span><span class="n">todo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// (1)</span>
<span class="w">        </span><span class="n">todoWebService</span><span class="p">.</span><span class="na">createTodo</span><span class="p">(</span><span class="n">todo</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">WebFaultException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// (2)</span>
<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getFaultInfo</span><span class="p">().</span><span class="na">getType</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">ValidationFault</span><span class="p">:</span>
<span class="w">            </span><span class="c1">// handle exception…</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">BusinessFault</span><span class="p">:</span>
<span class="w">            </span><span class="c1">// handle exception…</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">default</span><span class="p">:</span>
<span class="w">            </span><span class="c1">// handle exception…</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Webサービスを呼び出す。throwsがついているため、<code class="docutils literal notranslate"><span class="pre">WebFaultException</span></code>をキャッチする必要がある。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">faultInfo</span></code>の種別で例外を判定し、それぞれの処理を記述する（画面にメッセージを出す、例外をスローするなど）</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id16">
<h4><a class="toc-backref" href="#id46" role="doc-backlink"><span class="section-number">5.3.2.2.6. </span>タイムアウトの設定</a><a class="headerlink" href="#id16" title="Permalink to this heading">¶</a></h4>
<p>クライアントで指定できるタイムアウトは大きく以下の2つがある。</p>
<ul class="simple">
<li><p>SOAPサーバとのコネクションタイムアウト</p></li>
<li><p>SOAPサーバへのリクエストタイムアウト</p></li>
</ul>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.Service</span></code>を使用して、タイムアウトの設定をするには、<code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.BindingProvider</span></code>で取得できる<code class="docutils literal notranslate"><span class="pre">RequestContext</span></code>にタイムアウト値を設定する必要がある。</div>
<div class="line">設定の方法は以下の通りである。</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.Service</span></code>の定義が複雑になるため、FactoryBeanを使用してBean定義を行う。</p>
<p><em>[client projectName]-domain/src/main/java/com/example/domain/service/todo/factory/TodoWebServiceFactoryBean.java</em></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoWebServiceFactoryBean</span><span class="w"> </span><span class="kd">implements</span>
<span class="w">                                            </span><span class="n">FactoryBean</span><span class="o">&lt;</span><span class="n">TodoWebService</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">wsdlDocumentResource</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">connectionTimeout</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">requestTimeout</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">TodoWebService</span><span class="w"> </span><span class="nf">getObject</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">QName</span><span class="w"> </span><span class="n">serviceName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">QName</span><span class="p">(</span><span class="s">&quot;http://example.com/todo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TodoWebService&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">QName</span><span class="w"> </span><span class="n">portName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">QName</span><span class="p">(</span><span class="s">&quot;http://example.com/todo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TodoWebPort&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="n">Service</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Service</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">URL</span><span class="p">(</span><span class="n">wsdlDocumentResource</span><span class="p">),</span><span class="w"> </span><span class="n">serviceName</span><span class="p">);</span>
<span class="w">        </span><span class="n">TodoWebService</span><span class="w"> </span><span class="n">todoWebService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">getPort</span><span class="p">(</span><span class="n">portName</span><span class="p">,</span><span class="w"> </span><span class="n">TodoWebService</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

<span class="w">        </span><span class="n">BindingProvider</span><span class="w"> </span><span class="n">bindingProvider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">BindingProvider</span><span class="p">)</span><span class="w"> </span><span class="n">todoWebService</span><span class="p">;</span>
<span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">requestContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bindingProvider</span><span class="p">.</span><span class="na">getRequestContext</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// (1)</span>
<span class="w">        </span><span class="n">requestContext</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;jakarta.xml.ws.client.connectionTimeout&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">connectionTimeout</span><span class="p">);</span>
<span class="w">        </span><span class="n">requestContext</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;jakarta.xml.ws.client.receiveTimeout&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">requestTimeout</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">todoWebService</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setWsdlDocumentResource</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">wsdlDocumentResource</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">wsdlDocumentResource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wsdlDocumentResource</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setConnectionTimeout</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">connectionTimeout</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">connectionTimeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connectionTimeout</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setRequestTimeout</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">requestTimeout</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">requestTimeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requestTimeout</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">getObjectType</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">TodoWebService</span><span class="p">.</span><span class="na">class</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">取得した<code class="docutils literal notranslate"><span class="pre">RequestContext</span></code>に対して、タイムアウトの設定を追加する。</div>
<div class="line">コネクションタイムアウトのキーに<code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.client.connectionTimeout</span></code>を設定し、値にはコネクションタイムアウト値を設定する。</div>
<div class="line">リクエストタイムアウトのキーに<code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.client.receiveTimeout</span></code>を設定し、値にはリクエストタイムアウト値を設定する。</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>タイムアウト定義に使用するキーについて</strong></p>
<p>それぞれのタイムアウトを定義するキーはJakarta XML Web Servicesの実装により異なる値を設定する必要がある。
詳細は<a class="reference external" href="https://github.com/javaee/metro-jax-ws/issues/1166">JAX_WS-1166 Standardize timeout settings</a>を参照されたい。</p>
<p>なお、Apache CXF 3.x までは、タイムアウトのキーとして<code class="docutils literal notranslate"><span class="pre">javax.xml.ws.client.connectionTimeout</span></code>、<code class="docutils literal notranslate"><span class="pre">javax.xml.ws.client.receiveTimeout</span></code>を利用していたが、Apache CXF 4.x 以降は、<code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.client.connectionTimeout</span></code>、<code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.client.receiveTimeout</span></code>にキーが変更となっている。</p>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>FactoryBeanのBean定義を行う。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-8-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-8-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-8-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-8-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-8-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-8-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[client</span> <span class="pre">projectName]-domain/src/main/java/com/example/config/app/[client</span> <span class="pre">projectName]DomainConfig.java</span></code></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${webservice.todoWebService.wsdlDocumentResource}&quot;</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">wsdlDocumentResource</span><span class="p">;</span>

<span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${webservice.connect.timeout}&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">// (1)</span>
<span class="kd">private</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">connectionTimeout</span><span class="p">;</span>

<span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${webservice.request.timeout}&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">// (1)</span>
<span class="kd">private</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">requestTimeout</span><span class="p">;</span>

<span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;todoWebService&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">TodoWebServiceFactoryBean</span><span class="w"> </span><span class="nf">todoWebService</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">TodoWebServiceFactoryBean</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TodoWebServiceFactoryBean</span><span class="p">();</span>
<span class="w">    </span><span class="n">factory</span><span class="p">.</span><span class="na">setWsdlDocumentResource</span><span class="p">(</span><span class="n">wsdlDocumentResource</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="n">factory</span><span class="p">.</span><span class="na">setConnectionTimeout</span><span class="p">(</span><span class="n">connectionTimeout</span><span class="p">);</span>
<span class="w">    </span><span class="n">factory</span><span class="p">.</span><span class="na">setRequestTimeout</span><span class="p">(</span><span class="n">requestTimeout</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">[client</span> <span class="pre">projectName]-env/src/main/resources/META-INF/spring/[client</span> <span class="pre">projectName]-infra.properties</span></code></p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="c1"># (2)</span>
<span class="na">webservice.connect.timeout</span><span class="o">=</span><span class="s">3000</span>
<span class="na">webservice.request.timeout</span><span class="o">=</span><span class="s">3000</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">後述するプロパティファイルからコネクションタイムアウト、リクエストタイムアウトの値を取得し、<code class="docutils literal notranslate"><span class="pre">FactoryBean</span></code>に設定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">コネクションタイムアウト値、リクエストタイムアウト値を定義する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div><div aria-labelledby="tab-8-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-8-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[client</span> <span class="pre">projectName]-domain/src/main/resources/META-INF/spring/[client</span> <span class="pre">projectName]-domain.xml</span></code></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;todoWebService&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;com.example.domain.service.todo.factory.TodoWebServiceFactoryBean&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;wsdlDocumentResource&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${webservice.todoWebService.wsdlDocumentResource}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;connectionTimeout&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${webservice.connect.timeout}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;requestTimeout&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${webservice.request.timeout}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">[client</span> <span class="pre">projectName]-env/src/main/resources/META-INF/spring/[client</span> <span class="pre">projectName]-infra.properties</span></code></p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="c1"># (2)</span>
<span class="na">webservice.connect.timeout</span><span class="o">=</span><span class="s">3000</span>
<span class="na">webservice.request.timeout</span><span class="o">=</span><span class="s">3000</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">後述するプロパティファイルからコネクションタイムアウト、リクエストタイムアウトの値を取得し、<code class="docutils literal notranslate"><span class="pre">FactoryBean</span></code>に設定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">コネクションタイムアウト値、リクエストタイムアウト値を定義する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
</section>
<section id="appendix">
<h2><a class="toc-backref" href="#id47" role="doc-backlink"><span class="section-number">5.3.3. </span>Appendix</a><a class="headerlink" href="#appendix" title="Permalink to this heading">¶</a></h2>
<section id="soapappendixaddproject">
<span id="id17"></span><h3><a class="toc-backref" href="#id48" role="doc-backlink"><span class="section-number">5.3.3.1. </span>SOAPサーバ用にプロジェクトの設定を変更する</a><a class="headerlink" href="#soapappendixaddproject" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line">SOAPサーバを作成する場合、ブランクプロジェクトにmodelプロジェクトとwebserviceプロジェクトを追加することを推奨する。</div>
<div class="line">以下にその方法を記述する。</div>
</div>
<div class="line-block">
<div class="line">ブランクプロジェクトの初期状態は以下の構成になっている。</div>
<div class="line">なお、artifactIdにはブランクプロジェクト作成時に指定したartifactIdが設定される。</div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">artifactId</span>
<span class="go">├── pom.xml</span>
<span class="go">├── artifactId-domain</span>
<span class="go">├── artifactId-env</span>
<span class="go">├── artifactId-initdb</span>
<span class="go">├── artifactId-selenium</span>
<span class="go">└── artifactId-web</span>
</pre></div>
</div>
<p>以下のようなプロジェクト構成にする。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">artifactId</span>
<span class="go">├── pom.xml</span>
<span class="go">├── artifactId-domain</span>
<span class="go">├── artifactId-env</span>
<span class="go">├── artifactId-initdb</span>
<span class="go">├── artifactId-selenium</span>
<span class="go">├── artifactId-web</span>
<span class="go">├── artifactId-model</span>
<span class="go">└── artifactId-webservice</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="id18">
<h4><a class="toc-backref" href="#id49" role="doc-backlink"><span class="section-number">5.3.3.1.1. </span>既存プロジェクトの変更</a><a class="headerlink" href="#id18" title="Permalink to this heading">¶</a></h4>
<div class="line-block">
<div class="line">ブランクプロジェクトの初期状態では、ControllerなどWebアプリケーションの簡易実装が含まれている。</div>
<div class="line">そのままにしてもSOAP Web Serviceは実現可能だが、不要であるため、削除することを推奨する。</div>
<div class="line">削除対象は、「<a class="reference internal" href="../../ImplementationAtEachLayer/CreateWebApplicationProject.html"><span class="doc">Webアプリケーション向け開発プロジェクトの作成</span></a> の <a class="reference internal" href="../../ImplementationAtEachLayer/CreateWebApplicationProject.html#createwebapplicationprojectconfigurationmulti"><span class="std std-ref">マルチプロジェクトの構成</span></a>」を参照されたい。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="model">
<h4><a class="toc-backref" href="#id50" role="doc-backlink"><span class="section-number">5.3.3.1.2. </span>modelプロジェクトの作成</a><a class="headerlink" href="#model" title="Permalink to this heading">¶</a></h4>
<p>modelプロジェクトの構成について説明する。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">artifactId-model</span>
<span class="go">    ├── pom.xml  ... (1)</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">項番</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">説明</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>modelモジュールの構成を定義するPOM(Project Object Model)ファイル。
このファイルでは、以下の定義を行う。</p>
<ul class="simple">
<li><p>依存ライブラリとビルド用プラグインの定義</p></li>
<li><p>jarファイルを作成するための定義</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">pom.xml</span></code>は以下のようなイメージになる。必要に応じて編集する必要がある。</div>
<div class="line">実際には、「artifactId」と「groupId」はブランクプロジェクト作成時に指定した値を設定する必要がある。</div>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;project</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="w"> </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>artifactId-model<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>
<span class="w">    </span><span class="nt">&lt;parent&gt;</span>
<span class="w">        </span><span class="nt">&lt;groupId&gt;</span>groupId<span class="nt">&lt;/groupId&gt;</span>
<span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>artifactId<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;version&gt;</span>1.0.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;relativePath&gt;</span>../pom.xml<span class="nt">&lt;/relativePath&gt;</span>
<span class="w">    </span><span class="nt">&lt;/parent&gt;</span>
<span class="w">    </span><span class="nt">&lt;dependencies&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- == Begin TERASOLUNA == --&gt;</span>
<span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">            </span><span class="nt">&lt;groupId&gt;</span>org.terasoluna.gfw<span class="nt">&lt;/groupId&gt;</span>
<span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>terasoluna-gfw-common-dependencies<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">            </span><span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
<span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- == End TERASOLUNA == --&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="id19">
<h4><a class="toc-backref" href="#id51" role="doc-backlink"><span class="section-number">5.3.3.1.3. </span>webserviceプロジェクトの作成</a><a class="headerlink" href="#id19" title="Permalink to this heading">¶</a></h4>
<p>webserviceプロジェクトの構成について説明する。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">artifactId-webservice</span>
<span class="go">    ├── pom.xml  ... (1)</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">項番</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">説明</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><p>webserviceモジュールの構成を定義するPOM(Project Object Model)ファイル。
このファイルでは、以下の定義を行う。</p>
<ul class="simple">
<li><p>依存ライブラリとビルド用プラグインの定義</p></li>
<li><p>jarファイルを作成するための定義</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">pom.xml</span></code>は以下のようなイメージになる。必要に応じて編集する必要がある。</div>
<div class="line">実際には、「artifactId」と「groupId」はブランクプロジェクト作成時に指定した値を設定する必要がある。</div>
<div class="line">なお、webserviceプロジェクトのコンパイルにはJakarta XML Web Services APIが必要となるため、<code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws-api</span></code>を依存関係に追加する必要がある。</div>
<div class="line">追加する<code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws-api</span></code>のバージョンに関しては、Apache CXFが使用するJakarta XML Web Services APIのバージョンに合わせて設定する必要があるため、「<a class="reference internal" href="#soapapplicationconfiguration"><span class="std std-ref">アプリケーションの設定</span></a>」に記載されているApache CXFのバージョンに合わせて設定を行う場合は、以下の<code class="docutils literal notranslate"><span class="pre">pom.xml</span></code>に記載されたバージョンを指定する必要がある。</div>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;project</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="w"> </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>artifactId-webservice<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>
<span class="w">    </span><span class="nt">&lt;parent&gt;</span>
<span class="w">        </span><span class="nt">&lt;groupId&gt;</span>groupId<span class="nt">&lt;/groupId&gt;</span>
<span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>artifactId<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;version&gt;</span>1.0.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;relativePath&gt;</span>../pom.xml<span class="nt">&lt;/relativePath&gt;</span>
<span class="w">    </span><span class="nt">&lt;/parent&gt;</span>
<span class="w">    </span><span class="nt">&lt;dependencies&gt;</span>
<span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">            </span><span class="nt">&lt;groupId&gt;</span>${project.groupId}<span class="nt">&lt;/groupId&gt;</span>
<span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>artifactId-model<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>

<span class="w">        </span><span class="cm">&lt;!-- == Begin TERASOLUNA == --&gt;</span>
<span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">            </span><span class="nt">&lt;groupId&gt;</span>org.terasoluna.gfw<span class="nt">&lt;/groupId&gt;</span>
<span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>terasoluna-gfw-security-core-dependencies<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">            </span><span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
<span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- == End TERASOLUNA == --&gt;</span>

<span class="w">        </span><span class="cm">&lt;!-- == Start Jakarta XML Web Services  == --&gt;</span>
<span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">            </span><span class="nt">&lt;groupId&gt;</span>jakarta.xml.ws<span class="nt">&lt;/groupId&gt;</span>
<span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>jakarta.xml.ws-api<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">            </span><span class="nt">&lt;version&gt;</span>4.0.2<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- == End Jakarta XML Web Services  == --&gt;</span>

<span class="w">    </span><span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="soapappendixpackageserver">
<span id="id20"></span><h3><a class="toc-backref" href="#id52" role="doc-backlink"><span class="section-number">5.3.3.2. </span>SOAPサーバのパッケージ構成</a><a class="headerlink" href="#soapappendixpackageserver" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line">SOAPサーバを作成するときの推奨する構成について、説明する。</div>
<div class="line">ガイドラインに従いプロジェクトを追加すると以下の構成となる。</div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>プロジェクト名</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">[server projectName]-domain</div>
</div>
</td>
<td><div class="line-block">
<div class="line">SOAPサーバのドメイン層に関するクラス・設定ファイルを格納するプロジェクト</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">[server projectName]-web</div>
</div>
</td>
<td><div class="line-block">
<div class="line">SOAPサーバのアプリケーション層に関するクラス・設定ファイルを格納するプロジェクト</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">[server projectName]-env</div>
</div>
</td>
<td><div class="line-block">
<div class="line">SOAPサーバの環境に依存するファイル等を格納するプロジェクト</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">[server projectName]-model</div>
</div>
</td>
<td><div class="line-block">
<div class="line">SOAPサーバのドメイン層に関するクラスの中で、Webサービス実行時に使用し、クライアントと共有するクラスを格納するプロジェクト</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">[server projectName]-webservice</div>
</div>
</td>
<td><div class="line-block">
<div class="line">SOAPサーバが提供するWebサービスのインターフェースを格納するプロジェクト</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="server-projectname-domain">
<h4><a class="toc-backref" href="#id53" role="doc-backlink"><span class="section-number">5.3.3.2.1. </span>[server projectName]-domain</a><a class="headerlink" href="#server-projectname-domain" title="Permalink to this heading">¶</a></h4>
<p>[server projectName]-modelの依存関係を追加するため、<code class="docutils literal notranslate"><span class="pre">pom.xml</span></code>に以下を追加する。</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>${project.groupId}<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>artifactId-model<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<p>その他のパッケージ構成は、通常のdomainプロジェクトと変わらないため、「<a class="reference internal" href="../../Overview/ApplicationLayering.html"><span class="doc">アプリケーションのレイヤ化</span></a> の <a class="reference internal" href="../../Overview/ApplicationLayering.html#application-layering-project-structure"><span class="std std-ref">プロジェクト構成</span></a>」を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="server-projectname-web">
<h4><a class="toc-backref" href="#id54" role="doc-backlink"><span class="section-number">5.3.3.2.2. </span>[server projectName]-web</a><a class="headerlink" href="#server-projectname-web" title="Permalink to this heading">¶</a></h4>
<p>[server projectName]-webserviceの依存関係を追加するため、<code class="docutils literal notranslate"><span class="pre">pom.xml</span></code>に以下を追加する。</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>${project.groupId}<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>artifactId-webservice<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>依存性の解決について</strong></p>
<p>[server projectName]-modelの依存関係の定義は不要である。これは[server projectName]-webserviceから[server projectName]-modelへの依存関係が定義されているため、推移的に依存関係が追加されるためである。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Jakarta XML Web Servicesでは、XML電文のシリアライズにJAXBを利用しており、アプリケーションの実行にはJAXBがクラスパスに登録されている必要がある。</p>
<p>Apache CXFを利用する場合は、org.glassfish.jaxb:jaxb-runtimeのJAXBが自動的に依存関係に追加されることを確認しているが、本ガイドラインでは<a class="reference internal" href="../../Appendix/Java17Settings.html#remove-jaxb-from-java11"><span class="std std-ref">JAXBの追加</span></a>で説明のとおり、com.sun.xml.bind:jaxb-implを使用することを前提とするため、<a class="reference external" href="https://github.com/terasolunaorg/terasoluna-dependencies/tree/2.0.0.RELEASE">terasoluna-gfw-dependencies</a>で定義しているApache CXFからJAXBの依存関係を抜いている。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>[server projectName]-webのプロジェクト推奨構成を、以下に示す。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-9-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-9-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-9-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-9-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-9-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-9-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[server projectName]-web</span>
<span class="go">  └src</span>
<span class="go">      └main</span>
<span class="go">          ├java</span>
<span class="go">          │  └com</span>
<span class="go">          │      └example</span>
<span class="go">          │          ├app...(1)</span>
<span class="go">          │          ├config</span>
<span class="go">          │          │  ├app</span>
<span class="go">          │          │  │  └ApplicationContextConfig.java...(2)</span>
<span class="go">          │          │  ├web</span>
<span class="go">          │          │  │  ├SpringMvcConfig.java...(3)</span>
<span class="go">          │          │  │  └SpringSecurityConfig.java...(4)</span>
<span class="go">          │          │  └ws</span>
<span class="go">          │          │      └[server projectName]WsConfig.java...(5)</span>
<span class="go">          │          └ws...(6)</span>
<span class="go">          │            ├exception...(7)</span>
<span class="go">          │            │  └WsExceptionHandler.java</span>
<span class="go">          │            ├abc</span>
<span class="go">          │            │  └AbcWebServiceImpl.java</span>
<span class="go">          │            └def</span>
<span class="go">          │                └DefWebServiceImpl.java</span>
<span class="go">          ├resources</span>
<span class="go">          │  ├META-INF</span>
<span class="go">          │  │  └spring</span>
<span class="go">          │  │      └application.properties...(8)</span>
<span class="go">          │  └i18n</span>
<span class="go">          │      └application-messages.properties...(9)</span>
<span class="go">          └webapp</span>
<span class="go">              ├resources...(10)</span>
<span class="go">              └WEB-INF</span>
<span class="go">                  ├views ...(11)</span>
<span class="go">                  └web.xml...(12)</span>
</pre></div>
</div>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">アプリケーション層の構成要素を格納するパッケージ。</div>
<div class="line">Webサービスのみ作成する場合は削除してもよい。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">アプリケーション全体に関するBean定義を行う。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Spring MVCの設定を行うBean定義を行う。</div>
<div class="line">Webサービスのみ作成する場合は削除してもよい。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Spring Securityの設定を行うBean定義を行う。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Webサービスに関するBean定義を行う。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Webサービスの関連クラスを格納するパッケージ。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Webサービスの例外ハンドラーなどを格納するパッケージ。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">アプリケーションで使用するプロパティを定義する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">画面表示用のメッセージ(国際化対応)定義を行う。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">静的リソース(css、js、画像など)を格納する。</div>
<div class="line">Webサービスのみ作成する場合は削除してもよい。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(11)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">View(jsp)を格納する。</div>
<div class="line">Webサービスのみ作成する場合は削除してもよい。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(12)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Servletのデプロイメント定義を行う。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div><div aria-labelledby="tab-9-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-9-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[server projectName]-web</span>
<span class="go">  └src</span>
<span class="go">      └main</span>
<span class="go">          ├java</span>
<span class="go">          │  └com</span>
<span class="go">          │      └example</span>
<span class="go">          │          ├app...(1)</span>
<span class="go">          │          └ws...(2)</span>
<span class="go">          │            ├exception...(3)</span>
<span class="go">          │            │  └WsExceptionHandler.java</span>
<span class="go">          │            ├abc</span>
<span class="go">          │            │  └AbcWebServiceImpl.java</span>
<span class="go">          │            └def</span>
<span class="go">          │                └DefWebServiceImpl.java</span>
<span class="go">          ├resources</span>
<span class="go">          │  ├META-INF</span>
<span class="go">          │  │  └spring</span>
<span class="go">          │  │      ├applicationContext.xml...(4)</span>
<span class="go">          │  │      ├application.properties...(5)</span>
<span class="go">          │  │      ├spring-mvc.xml ...(6)</span>
<span class="go">          │  │      ├spring-security.xml...(7)</span>
<span class="go">          │  │      └[server projectName]-ws.xml...(8)</span>
<span class="go">          │  └i18n</span>
<span class="go">          │      └application-messages.properties...(9)</span>
<span class="go">          └webapp</span>
<span class="go">              ├resources...(10)</span>
<span class="go">              └WEB-INF</span>
<span class="go">                  ├views ...(11)</span>
<span class="go">                  └web.xml...(12)</span>
</pre></div>
</div>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">アプリケーション層の構成要素を格納するパッケージ。</div>
<div class="line">Webサービスのみ作成する場合は削除してもよい。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Webサービスの関連クラスを格納するパッケージ。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Webサービスの例外ハンドラーなどを格納するパッケージ。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">アプリケーション全体に関するBean定義を行う。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">アプリケーションで使用するプロパティを定義する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Spring MVCの設定を行うBean定義を行う。</div>
<div class="line">Webサービスのみ作成する場合は削除してもよい。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Spring Securityの設定を行うBean定義を行う。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Webサービスに関するBean定義を行う。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">画面表示用のメッセージ(国際化対応)定義を行う。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">静的リソース(css、js、画像など)を格納する。</div>
<div class="line">Webサービスのみ作成する場合は削除してもよい。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(11)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">View(jsp)を格納する。</div>
<div class="line">Webサービスのみ作成する場合は削除してもよい。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(12)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Servletのデプロイメント定義を行う。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>SOAPサーバの不要なファイル</strong></p>
<p>SOAPサーバで、Webサービスのみを作成する場合、ブランクプロジェクトに存在するSpring MVCの設定ファイルなどは不要となるため、削除したほうが望ましい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="server-projectname-env">
<h4><a class="toc-backref" href="#id55" role="doc-backlink"><span class="section-number">5.3.3.2.3. </span>[server projectName]-env</a><a class="headerlink" href="#server-projectname-env" title="Permalink to this heading">¶</a></h4>
<p>[server projectName]-envについては、通常のenvプロジェクトと変わらないため、「<a class="reference internal" href="../../Overview/ApplicationLayering.html"><span class="doc">アプリケーションのレイヤ化</span></a> の <a class="reference internal" href="../../Overview/ApplicationLayering.html#application-layering-project-structure"><span class="std std-ref">プロジェクト構成</span></a>」を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="server-projectname-model">
<h4><a class="toc-backref" href="#id56" role="doc-backlink"><span class="section-number">5.3.3.2.4. </span>[server projectName]-model</a><a class="headerlink" href="#server-projectname-model" title="Permalink to this heading">¶</a></h4>
<p>[server projectName]-modelのプロジェクト推奨構成を、以下に示す。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[server projectName]-model</span>
<span class="go">  └src</span>
<span class="go">      └main</span>
<span class="go">          └java</span>
<span class="go">              └com</span>
<span class="go">                  └example</span>
<span class="go">                      └domain ...(1)</span>
<span class="go">                          └model ...(2)</span>
<span class="go">                              ├Xxx.java</span>
<span class="go">                              ├Yyy.java</span>
<span class="go">                              └Zzz.java</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ドメイン層の構成要素を格納するパッケージ。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Domain Objectの中でWebサービス実行時に使用するクラスを格納するパッケージ。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="server-projectname-webservice">
<h4><a class="toc-backref" href="#id57" role="doc-backlink"><span class="section-number">5.3.3.2.5. </span>[server projectName]-webservice</a><a class="headerlink" href="#server-projectname-webservice" title="Permalink to this heading">¶</a></h4>
<p>[server projectName]-webserviceのプロジェクト推奨構成を、以下に示す。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[server projectName]-webservice</span>
<span class="go">  └src</span>
<span class="go">      └main</span>
<span class="go">          └java</span>
<span class="go">              └com</span>
<span class="go">                  └example</span>
<span class="go">                      └ws...(1)</span>
<span class="go">                        ├webfault...(2)</span>
<span class="go">                        ├abc</span>
<span class="go">                        │  └AbcWebService.java</span>
<span class="go">                        └def</span>
<span class="go">                            └DefWebService.java</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Webサービスのインターフェースを格納するパッケージ。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Webサービスのwebfaultを格納するパッケージ。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="soapappendixpackageclient">
<span id="id21"></span><h3><a class="toc-backref" href="#id58" role="doc-backlink"><span class="section-number">5.3.3.3. </span>クライアントのパッケージ構成</a><a class="headerlink" href="#soapappendixpackageclient" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line">クライアントを作成するときの推奨する構成について、説明する。</div>
<div class="line">ガイドラインに従いプロジェクトをSOAPサーバから提供されると以下の構成となる。</div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>プロジェクト名</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">[client projectName]-domain</div>
</div>
</td>
<td><div class="line-block">
<div class="line">クライアントのドメイン層に関するクラス・設定ファイルを格納するプロジェクト</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">[client projectName]-web</div>
</div>
</td>
<td><div class="line-block">
<div class="line">クライアントのアプリケーション層に関するクラス・設定ファイルを格納するプロジェクト</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">[client projectName]-env</div>
</div>
</td>
<td><div class="line-block">
<div class="line">クライアントの環境に依存するファイル等を格納するプロジェクト</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>[server projectName]-modelと[server projectName]-webserviceについては、前述の「 <a class="reference internal" href="#soapappendixpackageserver"><span class="std std-ref">SOAPサーバのパッケージ構成</span></a>」を参照されたい。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<section id="client-projectname-domain">
<h4><a class="toc-backref" href="#id59" role="doc-backlink"><span class="section-number">5.3.3.3.1. </span>[client projectName]-domain</a><a class="headerlink" href="#client-projectname-domain" title="Permalink to this heading">¶</a></h4>
<p>SOAPサーバから提供される[server projectName]-webserviceの依存関係を追加するため、<code class="docutils literal notranslate"><span class="pre">pom.xml</span></code>に以下を追加する。</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>${project.groupId}<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>artifactId-webservice<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>依存性の解決について</strong></p>
<p>[server projectName]-webと同様に、この<code class="docutils literal notranslate"><span class="pre">pom.xml</span></code>には、[server projectName]-modelの依存関係の定義は不要である。これは[server projectName]-webserviceから[server projectName]-modelへの依存関係が定義されているため、推移的に依存関係が追加されるためである。</p>
</div>
<p>その他のパッケージ構成は、通常のdomainプロジェクトと変わらないため、「<a class="reference internal" href="../../Overview/ApplicationLayering.html"><span class="doc">アプリケーションのレイヤ化</span></a> の <a class="reference internal" href="../../Overview/ApplicationLayering.html#application-layering-project-structure"><span class="std std-ref">プロジェクト構成</span></a>」を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="client-projectname-web">
<h4><a class="toc-backref" href="#id60" role="doc-backlink"><span class="section-number">5.3.3.3.2. </span>[client projectName]-web</a><a class="headerlink" href="#client-projectname-web" title="Permalink to this heading">¶</a></h4>
<p>[client projectName]-webについては、通常のwebプロジェクトと変わらないため、「<a class="reference internal" href="../../Overview/ApplicationLayering.html"><span class="doc">アプリケーションのレイヤ化</span></a> の <a class="reference internal" href="../../Overview/ApplicationLayering.html#application-layering-project-structure"><span class="std std-ref">プロジェクト構成</span></a>」を参照されたい。</p>
</section>
<section id="client-projectname-env">
<h4><a class="toc-backref" href="#id61" role="doc-backlink"><span class="section-number">5.3.3.3.3. </span>[client projectName]-env</a><a class="headerlink" href="#client-projectname-env" title="Permalink to this heading">¶</a></h4>
<p>[client projectName]-envのプロジェクト推奨構成を、以下に示す。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-10-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-10-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-10-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-10-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-10-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-10-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[projectName]-env</span>
<span class="go">  ├configs ...(1)</span>
<span class="go">  │   └[envName] ...(2)</span>
<span class="go">  │       ├java ...(3)</span>
<span class="go">  │       └resources ...(4)</span>
<span class="go">  └src</span>
<span class="go">      └main</span>
<span class="go">          ├java ...(5)</span>
<span class="go">          │  └com</span>
<span class="go">          │      └example</span>
<span class="go">          │          └config</span>
<span class="go">          │             └app</span>
<span class="go">          │                └[projectName]EnvConfig.java...(6)</span>
<span class="go">          └resources ...(7)</span>
<span class="go">              ├META-INF</span>
<span class="go">              │  └spring</span>
<span class="go">              │      └[projectName]-infra.properties ...(8)</span>
<span class="go">              └logback.xml ...(9)</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">全環境の環境依存ファイルを管理するためのディレクトリ。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">環境毎の環境依存ファイルを管理するためのディレクトリ。</div>
<div class="line">ディレクトリ名は、環境を識別する名前を指定する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">環境毎のJavaで記載したBean定義を管理するためのディレクトリ。</div>
<div class="line">サブディレクトリの構成や管理する設定ファイルは、(5)と同様。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">環境毎の設定ファイルを管理するためのディレクトリ。</div>
<div class="line">サブディレクトリの構成や管理する設定ファイルは、(7)と同様。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ローカル開発環境用のJavaで記載したBean定義を管理するためのディレクトリ。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ローカル開発環境用のBean定義を行う。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ローカル開発環境用の設定ファイルを管理するためのディレクトリ。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ローカル開発環境用のプロパティを定義する。</div>
<div class="line">WSDLのURLなど環境ごとに変更の可能性がある値を設定する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ローカル開発環境用のログ出力定義を行う。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div><div aria-labelledby="tab-10-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-10-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[projectName]-env</span>
<span class="go">  ├configs ...(1)</span>
<span class="go">  │   └[envName] ...(2)</span>
<span class="go">  │       └resources ...(3)</span>
<span class="go">  └src</span>
<span class="go">      └main</span>
<span class="go">          └resources ...(4)</span>
<span class="go">              ├META-INF</span>
<span class="go">              │  └spring</span>
<span class="go">              │      ├[projectName]-env.xml ...(5)</span>
<span class="go">              │      └[projectName]-infra.properties ...(6)</span>
<span class="go">              └logback.xml ...(7)</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">全環境の環境依存ファイルを管理するためのディレクトリ。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">環境毎の環境依存ファイルを管理するためのディレクトリ。</div>
<div class="line">ディレクトリ名は、環境を識別する名前を指定する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">環境毎の設定ファイルを管理するためのディレクトリ。</div>
<div class="line">サブディレクトリの構成や管理する設定ファイルは、(4)と同様。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ローカル開発環境用の設定ファイルを管理するためのディレクトリ。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ローカル開発環境用のBean定義を行う。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ローカル開発環境用のプロパティを定義する。</div>
<div class="line">WSDLのURLなど環境ごとに変更の可能性がある値を設定する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">ローカル開発環境用のログ出力定義を行う。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="webservicewsdl">
<span id="soapwebservicewsdl"></span><h3><a class="toc-backref" href="#id62" role="doc-backlink"><span class="section-number">5.3.3.4. </span>WebServiceインターフェースの実装クラスとWSDLファイルの関係</a><a class="headerlink" href="#webservicewsdl" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line">Webサービスを作成する際、登場するネームスペース、サービス、ポートの説明と、それぞれの関係を説明する。</div>
<div class="line">ネームスペース、サービス、ポートは、WSDLに定義される項目となるため、WSDLファイルの構造とともに説明を行う。</div>
</div>
<p><em>公開されるWSDLファイル</em></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;wsdl:definitions</span><span class="w"> </span><span class="na">xmlns:xsd=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>
<span class="w">                </span><span class="na">xmlns:wsdl=</span><span class="s">&quot;http://schemas.xmlsoap.org/wsdl/&quot;</span>
<span class="w">                </span><span class="na">xmlns:tns=</span><span class="s">&quot;http://example.com/todo&quot;</span>
<span class="w">                </span><span class="na">xmlns:soap12=</span><span class="s">&quot;http://schemas.xmlsoap.org/wsdl/soap12/&quot;</span>
<span class="w">                </span><span class="na">xmlns:ns1=</span><span class="s">&quot;http://schemas.xmlsoap.org/soap/http&quot;</span>
<span class="w">                </span><span class="na">targetNamespace=</span><span class="s">&quot;http://example.com/todo&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>

<span class="w">    </span>//<span class="w"> </span>omitted

<span class="w">    </span><span class="nt">&lt;wsdl:binding</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;TodoWebServiceSoapBinding&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;tns:TodoWebService&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;soap12:binding</span><span class="w"> </span><span class="na">style=</span><span class="s">&quot;document&quot;</span><span class="w"> </span><span class="na">transport=</span><span class="s">&quot;http://schemas.xmlsoap.org/soap/http&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;wsdl:operation</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;getTodo&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;soap12:operation</span><span class="w"> </span><span class="na">soapAction=</span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="na">style=</span><span class="s">&quot;document&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;wsdl:input</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;getTodo&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;soap12:body</span><span class="w"> </span><span class="na">use=</span><span class="s">&quot;literal&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/wsdl:input&gt;</span>
<span class="w">            </span><span class="nt">&lt;wsdl:output</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;getTodoResponse&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;soap12:body</span><span class="w"> </span><span class="na">use=</span><span class="s">&quot;literal&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/wsdl:output&gt;</span>
<span class="w">            </span><span class="nt">&lt;wsdl:fault</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;WebFaultException&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;soap12:fault</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;WebFaultException&quot;</span><span class="w"> </span><span class="na">use=</span><span class="s">&quot;literal&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/wsdl:fault&gt;</span>
<span class="w">        </span><span class="nt">&lt;/wsdl:operation&gt;</span>
<span class="w">    </span><span class="nt">&lt;/wsdl:binding&gt;</span>

<span class="w">    </span><span class="nt">&lt;wsdl:service</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;TodoWebService&quot;</span><span class="nt">&gt;</span><span class="w">  </span><span class="cm">&lt;!-- (2) --&gt;</span>
<span class="w">        </span><span class="nt">&lt;wsdl:port</span><span class="w"> </span><span class="na">binding=</span><span class="s">&quot;tns:TodoWebServiceSoapBinding&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;TodoWebPort&quot;</span><span class="nt">&gt;</span><span class="w">  </span><span class="cm">&lt;!-- (3) --&gt;</span>
<span class="w">            </span><span class="nt">&lt;soap12:address</span><span class="w"> </span><span class="na">location=</span><span class="s">&quot;http://AAA.BBB.CCC.DDD:XXXX/[server projectName]-web/ws/TodoWebService&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w">  </span><span class="cm">&lt;!-- (4) --&gt;</span>
<span class="w">        </span><span class="nt">&lt;/wsdl:port&gt;</span>
<span class="w">    </span><span class="nt">&lt;/wsdl:service&gt;</span>
<span class="nt">&lt;/wsdl:definitions&gt;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">WebServiceで定義する<code class="docutils literal notranslate"><span class="pre">targetNamespace</span></code>は、名前空間を指定する項目となり、サービスやポート等の要素を一意に特定するために使用される。</div>
<div class="line">WSDLでは、最上位要素である<code class="docutils literal notranslate"><span class="pre">&lt;wsdl:definitions&gt;</span></code>に設定され、この名前空間をもとに他の要素（service, port）を特定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">WebServiceで定義する<code class="docutils literal notranslate"><span class="pre">serviceName</span></code>は、WSDLの<code class="docutils literal notranslate"><span class="pre">&lt;wsdl:service&gt;</span></code>要素に対応する。</div>
<div class="line">この要素は、一つ以上の<code class="docutils literal notranslate"><span class="pre">&lt;wsdl:port&gt;</span></code>要素を子要素として持ち、クライアントが利用できるエンドポイント（port）の情報を集約する役割を担う。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">WebServiceで定義する<code class="docutils literal notranslate"><span class="pre">portName</span></code>は、WSDLの<code class="docutils literal notranslate"><span class="pre">&lt;wsdl:port&gt;</span></code>要素に対応する。</div>
<div class="line">ポートは、関連付けられたバインディング（<code class="docutils literal notranslate"><span class="pre">&lt;wsdl:binding&gt;</span></code>）使用して、Webサービスがどのように振る舞うかを規定する。</div>
<div class="line">クライアントはこのポート情報をもとにWebサービスにアクセスを行う。</div>
<div class="line"><br /></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;wsdl:binding&gt;</span></code>は、プロトコルや、データ形式、入出力、エラー等の情報を定義する要素となる。</div>
<div class="line">詳しくは、「<a class="reference external" href="https://www.w3.org/TR/2001/NOTE-wsdl-20010315">Web Services Description Language (WSDL) 1.1</a>」を参照されたい。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">address</span></code>は、WebServiceで直接定義する項目ではなく、Jakarta XML Web Services実装ライブラリによって自動的に設定される。</div>
<div class="line">location属性に実際のエンドポイントアドレスが定義され、このアドレスがSOAPサーバーにアクセスする際に利用される。</div>
<div class="line">Jakarta XML Web Services実装ライブラリが、<code class="docutils literal notranslate"><span class="pre">&lt;soap:address&gt;</span></code>要素に定義されたエンドポイントアドレスを特定するため、利用者は特に意識する必要はない。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="soapendpointaddress">
<span id="id22"></span><h3><a class="toc-backref" href="#id63" role="doc-backlink"><span class="section-number">5.3.3.5. </span>テスト等でエンドポイントアドレスを上書き指定したい場合</a><a class="headerlink" href="#soapendpointaddress" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line">WSDLファイルには、Webサービス実行時のアクセスURL（エンドポイントアドレス）が記述されているため、クライアントではアクセスURLの設定は不要である。</div>
<div class="line">ただし、WSDLファイルに記述されているURLではないURLにアクセスする場合、<code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.BindingProvider</span></code>で取得できる<code class="docutils literal notranslate"><span class="pre">RequestContext</span></code>に<code class="docutils literal notranslate"><span class="pre">BindingProvider.ENDPOINT_ADDRESS_PROPERTY</span></code>を設定することで上書きすることができる。</div>
<div class="line">テストなどで、環境を切り替える場合に使用するとよい。</div>
<div class="line">以下はその設定例である。</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">jakarta.xml.ws.Service</span></code>の定義が複雑になるため、FactoryBeanを使用してBean定義を行う。</p>
<p><em>[client projectName]-domain/src/main/java/com/example/domain/service/todo/factory/TodoWebServiceFactoryBean.java</em></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TodoWebServiceFactoryBean</span><span class="w"> </span><span class="kd">implements</span>
<span class="w">                                            </span><span class="n">FactoryBean</span><span class="o">&lt;</span><span class="n">TodoWebService</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// (1)</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">wsdlDocumentResource</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">endpointAddress</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">TodoWebService</span><span class="w"> </span><span class="nf">getObject</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">QName</span><span class="w"> </span><span class="n">serviceName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">QName</span><span class="p">(</span><span class="s">&quot;http://example.com/todo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TodoWebService&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">QName</span><span class="w"> </span><span class="n">portName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">QName</span><span class="p">(</span><span class="s">&quot;http://example.com/todo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TodoWebPort&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="n">Service</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Service</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">URL</span><span class="p">(</span><span class="n">wsdlDocumentResource</span><span class="p">),</span><span class="w"> </span><span class="n">serviceName</span><span class="p">);</span>
<span class="w">        </span><span class="n">TodoWebService</span><span class="w"> </span><span class="n">todoWebService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">getPort</span><span class="p">(</span><span class="n">portName</span><span class="p">,</span><span class="w"> </span><span class="n">TodoWebService</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

<span class="w">        </span><span class="n">BindingProvider</span><span class="w"> </span><span class="n">bindingProvider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">BindingProvider</span><span class="p">)</span><span class="w"> </span><span class="n">todoWebService</span><span class="p">;</span><span class="w">  </span><span class="c1">// (2)</span>
<span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">requestContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bindingProvider</span><span class="p">.</span><span class="na">getRequestContext</span><span class="p">();</span><span class="w">  </span><span class="c1">// (3)</span>
<span class="w">        </span><span class="n">requestContext</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">BindingProvider</span><span class="p">.</span><span class="na">ENDPOINT_ADDRESS_PROPERTY</span><span class="p">,</span><span class="w"> </span><span class="n">endpointAddress</span><span class="p">);</span><span class="w">  </span><span class="c1">// (4)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">todoWebService</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setWsdlDocumentResource</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">wsdlDocumentResource</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">wsdlDocumentResource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wsdlDocumentResource</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// (4)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setEndpointAddress</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">endpointAddress</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">endpointAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">endpointAddress</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">getObjectType</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">TodoWebService</span><span class="p">.</span><span class="na">class</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">FactoryBean</span></code>を実装する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">生成した動的プロキシを<code class="docutils literal notranslate"><span class="pre">BindingProvider</span></code>に変換する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">BindingProvider</span></code>から<code class="docutils literal notranslate"><span class="pre">RequestContext</span></code>を取得する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">取得した<code class="docutils literal notranslate"><span class="pre">RequestContext</span></code>に対して、エンドポイントアドレスの設定を追加する。</div>
<div class="line">キーに<code class="docutils literal notranslate"><span class="pre">BindingProvider.ENDPOINT_ADDRESS_PROPERTY</span></code>を設定し、値にはエンドポイントアドレスを設定する。</div>
<div class="line">エンドポイントアドレスの値は外部から指定できるように、<code class="docutils literal notranslate"><span class="pre">FactoryBean</span></code>の<code class="docutils literal notranslate"><span class="pre">setter</span></code>として定義を行う。</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">BindingProvider</span></code>には、他にも設定できる項目や、使用用途が存在している。</p>
<p><code class="docutils literal notranslate"><span class="pre">BindingProvider</span></code>の詳細については <a class="reference external" href="https://jakarta.ee/specifications/xml-web-services/4.0/jakarta-xml-ws-spec-4.0#bindingproviderif">Jakarta XML Web Services 4.0 -4.2 jakarta.xml.ws.BindingProvider-</a>を参照されたい。</p>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>FactoryBeanのBean定義を行う。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-11-SmF2YSBDb25maWc=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-11-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tab" tabindex="0">Java Config</button><button aria-controls="panel-11-WE1MIENvbmZpZw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-11-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tab" tabindex="-1">XML Config</button></div><div aria-labelledby="tab-11-SmF2YSBDb25maWc=" class="sphinx-tabs-panel group-tab" id="panel-11-SmF2YSBDb25maWc=" name="SmF2YSBDb25maWc=" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[client</span> <span class="pre">projectName]-domain/src/main/java/com/example/config/app/[client</span> <span class="pre">projectName]DomainConfig.java</span></code></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${webservice.todoWebService.wsdlDocumentResource}&quot;</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">wsdlDocumentResource</span><span class="p">;</span>

<span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${webservice.todoWebService.endpointAddress}&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">// (1)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">endpointAddress</span><span class="p">;</span>

<span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;todoWebService&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="n">TodoWebServiceFactoryBean</span><span class="w"> </span><span class="nf">todoWebService</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">TodoWebServiceFactoryBean</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TodoWebServiceFactoryBean</span><span class="p">();</span>
<span class="w">    </span><span class="n">factory</span><span class="p">.</span><span class="na">setWsdlDocumentResource</span><span class="p">(</span><span class="n">wsdlDocumentResource</span><span class="p">);</span>
<span class="w">    </span><span class="n">factory</span><span class="p">.</span><span class="na">setEndpointAddress</span><span class="p">(</span><span class="n">endpointAddress</span><span class="p">);</span><span class="w">  </span><span class="c1">// (1)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">[client</span> <span class="pre">projectName]-env/src/main/resources/META-INF/spring/[client</span> <span class="pre">projectName]-infra.properties</span></code></p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="c1"># (2)</span>
<span class="na">webservice.todoWebService.endpointAddress</span><span class="o">=</span><span class="s">http://AAA.BBB.CCC.DDD:XXXX/[server projectName]-web/ws/TodoWebService</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">後述するプロパティファイルからエンドポイントアドレスの値を取得し、<code class="docutils literal notranslate"><span class="pre">FactoryBean</span></code>に設定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">エンドポイントアドレスを定義する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div><div aria-labelledby="tab-11-WE1MIENvbmZpZw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-11-WE1MIENvbmZpZw==" name="WE1MIENvbmZpZw==" role="tabpanel" tabindex="0"><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[client</span> <span class="pre">projectName]-domain/src/main/resources/META-INF/spring/[client</span> <span class="pre">projectName]-domain.xml</span></code></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;todoWebService&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;com.example.domain.service.todo.factory.TodoWebServiceFactoryBean&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;wsdlDocumentResource&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${webservice.todoWebService.wsdlDocumentResource}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;endpointAddress&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${webservice.todoWebService.endpointAddress}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">[client</span> <span class="pre">projectName]-env/src/main/resources/META-INF/spring/[client</span> <span class="pre">projectName]-infra.properties</span></code></p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="c1"># (2)</span>
<span class="na">webservice.todoWebService.endpointAddress</span><span class="o">=</span><span class="s">http://AAA.BBB.CCC.DDD:XXXX/[server projectName]-web/ws/TodoWebService</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 90.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項番</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">後述するプロパティファイルからエンドポイントアドレスの値を取得し、<code class="docutils literal notranslate"><span class="pre">FactoryBean</span></code>に設定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="line-block">
<div class="line">エンドポイントアドレスを定義する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../DataAccessDetail/index.html" title="6. データアクセス"
             >next</a> |</li>
        <li class="right" >
          <a href="RestClient.html" title="5.2. RESTクライアント（HTTPクライアント）"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TERASOLUNA Server Framework for Java (5.x) Development Guideline 5.10.0.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" ><span class="section-number">5. </span>Web Service</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">5.3. </span>SOAP Web Service（サーバ/クライアント）</a></li> 
      </ul>
    </div>
    <div class="footer">
      © Copyright 2024, NTT DATA Group Corporation. © Copyright 2013, NTT Corporation.
      Created using <a href="https://www.sphinx-doc.org/en/master/">Sphinx</a> 7.0.1.Theme is <a href="https://pypi.org/project/solar-theme/">Solar</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    </script>
  </body>
</html>